{"version":3,"sources":["webpack:///./jscdk/jscdkLogger.js","webpack:///./jscdk/jscdkClient.js","webpack:///./jscdk/util.js","webpack:///./jscdk/controllers/messageHandler.js","webpack:///./jscdk/controllers/router.js","webpack:///./desktop/rtav/logservice.js","webpack:///./desktop/common/appblast-util.js","webpack:///./common/commondialog/dialog_service_error.html","webpack:///./desktop/channels/mksvchan.js","webpack:///./jscdk/controllers/setUserGlobalPrefHandler.js","webpack:///./jscdk/controllers/getLaunchItemsHandler.js","webpack:///./jscdk/model/jscdkBrokerError.js","webpack:///./desktop/common/signal.js","webpack:///./jscdk/controllers/getDesktopsHandler.js","webpack:///./template-module.js","webpack:////Users/yuez/gitvmware/htmlaccess1/ui/~/ng-dialog/css/ngDialog.css","webpack:///./styles/modal-dialogs.css","webpack:///./desktop/channels/vdpservice.js","webpack:///./jscdk/controllers/getTunnelConnectionHandler.js","webpack:///./jscdk/controllers/killSessionHandler.js","webpack:///./jscdk/timer/timer-util.js","webpack:///./common/commondialog/dialog_service_confirm.html","webpack:///./common/module.js","webpack:///./desktop/multimon/common/module.js","webpack:///./desktop/common/string-utils.js","webpack:///./desktop/multimon/common/bitbuffer.js","webpack:///./desktop/multimon/common/fullscreen-service.js","webpack:///./desktop/multimon/common/normalization-service.js","webpack:///./desktop/multimon/common/render-cache-service.js","webpack:///./desktop/multimon/common/vnc-decoder.js","webpack:///./desktop/multimon/common/wmks-base-service.js","webpack:///./jscdk/controllers/doLogoutHandler.js","webpack:///./jscdk/controllers/getAuthenticationStatusHandler.js","webpack:///./jscdk/controllers/resetDesktopHandler.js","webpack:////Users/yuez/gitvmware/htmlaccess1/ui/bower_components/webmks/build/static/wmks/wmks.js","webpack:///./desktop/common/appblast-log.js","webpack:///./desktop/remoteapp/unity.js","webpack:///./jscdk/controllers/doLockHandler.js","webpack:///./jscdk/controllers/getConfigurationHandler.js","webpack:///./jscdk/controllers/getUserGlobalPrefHandler.js","webpack:///./jscdk/controllers/jscdkClientController.js","webpack:///./jscdk/controllers/restartDesktopHandler.js","webpack:///./jscdk/controllers/setLastUserActivityHandler.js","webpack:///./jscdk/controllers/urlHandler.js","webpack:///./jscdk/timer/idleTimeoutTimerController.js","webpack:///./icons/desktop-small2x.png","webpack:///./icons/shadow-desktop-small2x.png","webpack:///./common/aboutdialog/about_dialog.html","webpack:///./desktop/common/clip_ft_help_template.html","webpack:///./app-center-controller.js","webpack:///./desktop/module.js","webpack:///./launcher/module.js","webpack:////Users/yuez/gitvmware/htmlaccess1/ui/bower_components/webmks/build/static/wmks/css/wmks-all.css","webpack:////Users/yuez/gitvmware/htmlaccess1/ui/~/jquery-ui-dist/jquery-ui.css","webpack:////Users/yuez/gitvmware/htmlaccess1/ui/~/toastr/build/toastr.css","webpack:///./styles/appblast.css","webpack:///./styles/clipboard.css","webpack:///./styles/sidebar.css","webpack:///./styles/style.css","webpack:///./app-htmlaccess.js","webpack:///./common/aboutdialog/about-dialog-controller.js","webpack:///./common/commondialog/dialog-service.js","webpack:///./common/constant/app-constant.js","webpack:///./common/directive/dialog-accessibility.js","webpack:///./common/directive/scrollable-dialog-fuzzy-free.js","webpack:///./common/directive/scrollable-dialog.js","webpack:///./common/model/baseviewclient-model.js","webpack:///./common/model/blastsessions-model.js","webpack:///./common/model/clientid-model.js","webpack:///./common/model/connection-server-model.js","webpack:///./common/model/connection-uri-model.js","webpack:///./common/model/os-model.js","webpack:///./common/model/viewclient-model.js","webpack:///./common/service/base-view-service.js","webpack:///./common/service/broker-session-storage-service.js","webpack:///./common/service/credentialclean-service.js","webpack:///./common/service/dpi-service.js","webpack:///./common/service/localize-service.js","webpack:///./common/service/multisite-service.js","webpack:///./common/service/prefdata.js","webpack:///./common/service/safe-storage-service.js","webpack:///./common/service/storage-service.js","webpack:///./common/service/toast-service.js","webpack:///./common/service/uri-param-validator.js","webpack:///./common/service/userglbpref.js","webpack:///./common/service/username-util.js","webpack:///./common/service/ws1-service.js","webpack:///./common/timezone/timezone.js","webpack:///./desktop/channels/commonSvc-service.js","webpack:///./desktop/channels/rde-main-channel.js","webpack:///./desktop/channels/rdpdr-channel-manager.js","webpack:///./desktop/channels/tsdr-channel.js","webpack:///./desktop/clipboard/clipboard.js","webpack:///./desktop/common/ajax-busy-overlay.js","webpack:///./desktop/common/applicationsessions-model.js","webpack:///./desktop/common/audio-service.js","webpack:///./desktop/common/blast-wmks-service.js","webpack:///./desktop/common/desktop-controller.js","webpack:///./desktop/common/entitleditems-model.js","webpack:///./desktop/common/entitleditems-service.js","webpack:///./desktop/common/idle-session-service.js","webpack:///./desktop/common/jscdk-desktop-invoker.js","webpack:///./desktop/common/messagehandler-service.js","webpack:///./desktop/common/panel-service.js","webpack:///./desktop/common/print-service.js","webpack:///./desktop/common/runningitems-model.js","webpack:///./desktop/common/wmks-service-event-handler.js","webpack:///./desktop/common/wmks-service.js","webpack:///./desktop/filetransfer/file-transfer-download-service.js","webpack:///./desktop/filetransfer/file-transfer-helper.js","webpack:///./desktop/filetransfer/file-transfer-panel.js","webpack:///./desktop/filetransfer/file-transfer-service.js","webpack:///./desktop/filetransfer/file-transfer-upload-service.js","webpack:///./desktop/multimon/main-page/extended-monitor-service.js","webpack:///./desktop/multimon/main-page/extended-monitor.js","webpack:///./desktop/multimon/main-page/module.js","webpack:///./desktop/multimon/main-page/monitor-manage-service.js","webpack:///./desktop/multimon/main-page/multimon-model.js","webpack:///./desktop/multimon/main-page/multimon-rendering-service.js","webpack:///./desktop/multimon/main-page/multimon-service.js","webpack:///./desktop/multimon/main-page/primary-monitor-service.js","webpack:///./desktop/multimon/multimon-setting-window/multimon-setting-window-controller.js","webpack:///./desktop/re-auth/changepassword-controller.js","webpack:///./desktop/re-auth/reauth-controller.js","webpack:///./desktop/remoteapp/unity-service.js","webpack:///./desktop/route.js","webpack:///./desktop/rtav/audiocapture.js","webpack:///./desktop/rtav/devicemessagemanager.js","webpack:///./desktop/rtav/dialogservice.js","webpack:///./desktop/rtav/frameratecontroller.js","webpack:///./desktop/rtav/mediacapture.js","webpack:///./desktop/rtav/mediaencoder.js","webpack:///./desktop/rtav/messagewaitmanager.js","webpack:///./desktop/rtav/resourcemanager.js","webpack:///./desktop/rtav/rtav-service.js","webpack:///./desktop/rtav/rtavconstants.js","webpack:///./desktop/rtav/rtavprotocolservice.js","webpack:///./desktop/rtav/rtavsession.js","webpack:///./desktop/rtav/rtavsessioncontroller.js","webpack:///./desktop/rtav/rtavsettings.js","webpack:///./desktop/rtav/synctimer.js","webpack:///./desktop/rtav/typedarraysupport.js","webpack:///./desktop/rtav/videocapture.js","webpack:///./desktop/rtav/wmksadapter.js","webpack:///./desktop/setting-dialog/settings-window-controller.js","webpack:///./desktop/sidebar/context-menu-manager.js","webpack:///./desktop/sidebar/sidebar.js","webpack:///./desktop/sidebar/vertical-slider.js","webpack:///./jscdk/commands/cancelAuthenticationCommand.js","webpack:///./jscdk/commands/cancelCurrentRequestCommand.js","webpack:///./jscdk/commands/connectToApplicationCommand.js","webpack:///./jscdk/commands/connectToBrokerCommand.js","webpack:///./jscdk/commands/connectToDesktopCommand.js","webpack:///./jscdk/commands/disconnectSessionCommand.js","webpack:///./jscdk/commands/doLockCommand.js","webpack:///./jscdk/commands/doUnlockCommand.js","webpack:///./jscdk/commands/getAuthenticationStatusCommand.js","webpack:///./jscdk/commands/getDesktopsCommand.js","webpack:///./jscdk/commands/getLaunchItemsCommand.js","webpack:///./jscdk/commands/getTunnelConnectionCommand.js","webpack:///./jscdk/commands/getUserGlobalPrefCommand.js","webpack:///./jscdk/commands/handleURICommand.js","webpack:///./jscdk/commands/initRouterCommand.js","webpack:///./jscdk/commands/killSessionCommand.js","webpack:///./jscdk/commands/logoutBrokerCommand.js","webpack:///./jscdk/commands/reconnectApplicationSessionsCommand.js","webpack:///./jscdk/commands/resetDesktopCommand.js","webpack:///./jscdk/commands/restartDesktopCommand.js","webpack:///./jscdk/commands/rollbackDesktopCommand.js","webpack:///./jscdk/commands/setEnvironmentInfoCommand.js","webpack:///./jscdk/commands/setLastUserActivityCommand.js","webpack:///./jscdk/commands/setUserGlobalPrefCommand.js","webpack:///./jscdk/commands/setViewURICommand.js","webpack:///./jscdk/commands/submitAuthInfoCommand.js","webpack:///./jscdk/commands/timerCtrlCommand.js","webpack:///./jscdk/controllers/addClientInfoHandler.js","webpack:///./jscdk/controllers/certAuthHandler.js","webpack:///./jscdk/controllers/changeWindowsPasswordHandler.js","webpack:///./jscdk/controllers/disclaimerHandler.js","webpack:///./jscdk/controllers/doCancelAuthenticationHandler.js","webpack:///./jscdk/controllers/doDisconnectSessionHandler.js","webpack:///./jscdk/controllers/doSubmitAuthenticationHandler.js","webpack:///./jscdk/controllers/doUnlockHandler.js","webpack:///./jscdk/controllers/frontController.js","webpack:///./jscdk/controllers/getApplicationConnectionHandler.js","webpack:///./jscdk/controllers/getApplicationSessionConnectionHandler.js","webpack:///./jscdk/controllers/getDesktopConnectionHandler.js","webpack:///./jscdk/controllers/killAllApplicationSessionsCtrl.js","webpack:///./jscdk/controllers/reconnectApplicationSessionsCtrl.js","webpack:///./jscdk/controllers/rollbackCheckoutDesktopHandler.js","webpack:///./jscdk/controllers/samlHandler.js","webpack:///./jscdk/controllers/securIDNextTokenCodeHandler.js","webpack:///./jscdk/controllers/securIDPasscodeHandler.js","webpack:///./jscdk/controllers/securIDPinChangeHandler.js","webpack:///./jscdk/controllers/securIDWaitHandler.js","webpack:///./jscdk/controllers/setLocaleHandler.js","webpack:///./jscdk/controllers/unauthHandler.js","webpack:///./jscdk/controllers/winCredsHandler.js","webpack:///./jscdk/model/jscdkError.js","webpack:///./jscdk/timer/timer.js","webpack:///./jscdk/timer/userActiveTimeSyncCtrl.js","webpack:///./launcher/common/blastdesktop-controller.js","webpack:///./launcher/common/common-directive.js","webpack:///./launcher/common/header-controller.js","webpack:///./launcher/common/homewarning-controller.js","webpack:///./launcher/common/jscdk-launcher-invoker.js","webpack:///./launcher/common/main-service.js","webpack:///./launcher/common/tabsync-service.js","webpack:///./launcher/common/timeout-service.js","webpack:///./launcher/common/util-service.js","webpack:///./launcher/common/validate-directive.js","webpack:///./launcher/common/view-service.js","webpack:///./launcher/common/viewctrl-service.js","webpack:///./launcher/launchitems/items-controller.js","webpack:///./launcher/launchitems/itemsctrl-service.js","webpack:///./launcher/login/anonymous-select-directive.js","webpack:///./launcher/login/changepassword-controller.js","webpack:///./launcher/login/disclaimer-controller.js","webpack:///./launcher/login/domain-select-menu-directive.js","webpack:///./launcher/login/login-controller.js","webpack:///./launcher/login/securidnexttokencode-controller.js","webpack:///./launcher/login/securidpasscode-controller.js","webpack:///./launcher/login/securidpinchange-controller.js","webpack:///./launcher/login/securidwait-controller.js","webpack:///./launcher/login/unauthenticated-controller.js","webpack:///./launcher/login/windowspassword-controller.js","webpack:///./launcher/route.js","webpack:///./launcher/setting-dialog/setting-dialog-controller.js","webpack:///./icons/Desktop2x.png","webpack:///./icons/attention2x.png","webpack:///./icons/icon-app-202x.png","webpack:///./icons/icon-app-282x.png","webpack:///./icons/shadow-desktop2x.png","webpack:///./icons/spinner-login2x.gif","webpack:///./icons/spinner2x.gif","webpack:///./common/commondialog/dialog_service_cancel_confirm.html","webpack:///./common/timezone/time-zone-list.html","webpack:///./desktop/clipboard/clipboard_template.html","webpack:///./desktop/common/desktop.html","webpack:///./desktop/filetransfer/file_transfer_template.html","webpack:///./desktop/multimon/multimon-setting-window/multimon_setting_window_template.html","webpack:///./desktop/re-auth/dialog_service_reauth.html","webpack:///./desktop/setting-dialog/settings_window_template.html","webpack:///./desktop/sidebar/sidebar_template.html","webpack:///./launcher/common/blast-desktop.html","webpack:///./launcher/common/header-default.html","webpack:///./launcher/common/home-warning.html","webpack:///./launcher/common/progress-circle.html","webpack:///./launcher/launchitems/launchitems.html","webpack:///./launcher/login/change-password.html","webpack:///./launcher/login/login.html","webpack:///./launcher/login/securid-nexttokencode.html","webpack:///./launcher/login/securid-pinchange.html","webpack:///./launcher/login/securid-wait.html","webpack:///./launcher/setting-dialog/setting-dialog-launcher.html"],"names":["getCallerDetail","callerDetail","err","callerLine","index","content","str","callStack","callerIndex","functionName","fileName","lineNum","fileNameAndLineNumStr","fileNameAndLineNumArray","objFuncRegExp","funcRegExp","lineNumRegExp","Error","error","stack","navigator","userAgent","toLowerCase","indexOf","split","trim","substring","lastIndexOf","length","ua","window","isIE","slice","exec","e","pad","value","maxLen","string","toString","negative","JSCDKLogger","LEVEL_TRACE","LEVEL_DEBUG","LEVEL_INFO","LEVEL_WARNING","LEVEL_ERROR","LEVEL_DESC","LOG_LEVEL","logAppender","logFunction","trace","args","log","debug","info","warning","level","logTime","logString","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","append","console","setLogLevel","logLevel","setLogAppender","setLogFunction","logFn","jscdkClientSetUIController","UIEventToJSCDK","JSCDKSetUI","globalArray","clientInfoAPIVersion","applicationAPIVersion","applicationParamVersion","brokerVersion","ws1Mode","workspaceOneServerHostname","controller","action","actionArray","parseJSON","getInstance","execute","mainUIController","getObject","responseToJSCDKEvent","util","brokerSupportApplication","parseFloat","brokerSupportRestartDesktop","findFirstItemWithPropertyInList","propertyName","targetValue","list","key","hasOwnProperty","createElement","name","attrArray","defParamLength","actParamLength","arguments","xmlText","attrText","attrKey","attrValue","validateXML","escapeElement","createXML","handlerList","composedMessage","handlerKey","handler","requestXML","messageText","findHandlerInArray","targetArray","messageName","XMLToString","xmlDoc","xmlString","serializer","XMLSerializer","serializeToString","xml","array","getChildNode","parentNode","idx","childNode","getElementsByTagName","addItemForJson","jsonObject","getUrlParam","url","paramName","param","paramKey","paramValue","i","ret","params","getDecodedUrlParam","urlParam","decodeURIComponent","text","replace","c","charCodeAt","unescapeElement","isValid","len","parseXML","find","children","parseURL","a","document","href","source","protocol","host","hostname","port","query","search","seg","s","file","pathname","match","hash","path","relative","segments","isChromeExtension","chrome","extension","getUuid","random","d","seed","Math","abs","r","floor","token","v","toUpperCase","censorMessage","message","type","censoredMessage","secretParams","messageType","secretNode","secretKey","obj","Array","prototype","call","inArray","JSON","stringify","serializeError","detail","getSelfDefinedErrorObjectBy","xmlHandler","errorMessage","errorDetail","ErrorObj","errorKey","errorType","errorText","l10N","supportedLocale","locale","translatedTable","getLocale","setLocaleAndLoad","acceptLanguage","self","selectedLocale","data","language","userLanguage","getBestLocale","ajax","dataType","cache","success","jqXHR","textStatus","errorThrown","translate","msgid","translatedStr","mNum","offset","fullStr","retStr","intNum","parseInt","charAt","matchedLocale","matchedRank","accepted","kv","parts","thisRank","localeAndRank","getSupportedLocale","returnRank","langCode","specifiers","_","InfoCombiner","waitNumber","mergingFunc","callbackParam","mergingThreshold","mergingFunction","mergingCallbackParam","containerList","onInfoReceived","infoObj","push","isWS1Mode","getWS1Hostname","MessageHandler","StateEnum","INIT","PENDING","DONE","FAIL","constructor","responseTag","state","dependencyList","observerList","subHandlerList","parentHandler","composedHandlerList","requestId","requestIdKV","xhrObject","setMessageName","getMessageName","getMessageText","setRequestXML","getRequestXML","setState","hasSubHandler","removeSubHandler","onUpdated","appendContent","getState","getXhrObject","setXhrObject","resetData","parsedResult","doneCnt","msgerror","subError","msgError","errorCode","jscdkError","triggerExecution","userMessage","getError","JSCDK_BROKER_ERROR_UNKNOWN","onBroadcast","msg","addObserver","inputHandler","attributeName","removeObserver","splice","registerHandler","unregisterHandler","removeFromContent","composeHandlerList","cancelRequest","isFunction","abort","clearSubHandlers","subHandler","appendSubHandler","Router","doLogout","doCancelAuthentication","receiver","brokerUrl","brokerUrlWithTimestamp","recentXhrObject","ajaxWasAborted","setDoLogout","setDoCancelAuthentication","setBrokerUrl","appendTimestamp","censorResponse","$xml","getParameterByName","regex","results","RegExp","postMessage","async","timeout","postMessageText","composeMessages","contextInfo","connector","now","requestHandlerList","undefined","jscdkPost","jscdkSuccess","onResponse","responseData","j","responseText","requestHandler","foundHandler","responseTagList","parseResponseTagList","pushResponseToHandler","parseResult","responseBody","brokerElem","responseTagElems","childNodes","currentElem","nodeName","settings","cacheThis","jscdkXHR","successData","jscdkPostError","reference","errorObject","JSCDK_BROKER_ERROR_TIMEOUT","JSCDK_BROKER_ERROR_CONNECT_TO_BROKER_ERROR","JSCDK_BROKER_ERROR_CONNECT_TO_BROKER_UNKNOWN","getErrorCode","getErrorMessage","pushErrorToUser","ensureTimerStopped","idleTimerObject","ensureStopped","errorAction","actionContent","authInfoObject","getDesktopsObject","getLaunchItemsObject","getTunnelConnObject","getConfigObject","setlocaleAndGetConfiguration","setLocaleObject","getConfigurationObject","router","each","errorValue","encodeURIComponent","JSCDK_BROKER_ERROR_AUTHENTICATION_FAILED","JSCDK_BROKER_ERROR_NOT_AUTHENTICATED","needCallbackFlag","workForSilentModeFlag","JSCDK_BROKER_ERROR_UNRECOGNIZED_CONTENT","JSCDK_BROKER_ERROR_UNSUPPORTED_VERSION","JSCDK_BROKER_ERROR_ALREADY_AUTHENTICATED","JSCDK_BROKER_ERROR_DESKTOPS_ERROR","srcHandlerName","getHandler","suffix","pushSelfDefinedError","object","require","RTAV","logService","coreServer","functionMap","getDataString","needStringify","arg","needList","argType","Object","getLogFunction","logName","bind","logtext","defineFunctions","setLevel","getLevel","module","exports","AB","LOGGER","initialize","CONST","MIN_VERSION","CLICK","RAW_MOUSE","XHR_READY_STATE","INVALID_CARET_POS","KEY_CODE","FORCE_RAW_KEY_CODE","HTTP_RESPONSE_CODE","EVENT_NAME","TOGGLE_NAV_SELECTION","START_NAV_ITEM","BLAST_SEND_KEYCODE","BLAST_SEND_STRING","BLAST_HIGH_RES_MODE","BLAST_ELEMENT_REPOSITION","CLOSE_WINDOW","TOGGLE_GESTURE_HELP","ZOOM_TYPE","CUSTOM","NATIVE","COOKIE","cookieName","delimitter","gestureHelp","audioWarn","clipboardHelp","DISCONNECT_REASON","RECONNECT_FAILED","HEARTBEAT_TIMEOUT","DISCONNECT_REQUEST_TIMEOUT","IDLE_TIMEOUT","ITEMS_TYPE","LOADING_ITEM","LOADING_APP","NEED_ATTENTION","DESKTOP","APP","ITEMS_STATE","CONNECTED","CONNECTING","DISCONNECTED","ICONS","BIG_DEFAULT_ICON","SMALL_DEFAULT_ICON","LOADING_ICON","ATTENTION_ICON","DIALOG_PARENT_ID","CANVAS_PARENT_ID","CANVAS_ID","UTIL","INFO","copyEnabled","pasteEnabled","clipboardMaxSize","minScreenWidth","minScreenHeight","version","buildNum","deployMode","conversionCanvas","isLoadingItem","item","isLoadingApp","isNeedAttention","isDesktop","isIPhone","isApp","isConnected","isConnecting","isDisconnected","isUsingWebcam","resourceManager","hasOccupiedResources","wmksKey","wmksAdapter","isUsingDevices","isAskingWebcam","isAskingPremission","isUsingMicrophone","isAskingMicrophone","closeRTAVDevices","closeDevices","bgraMapToPNG","bgra","width","height","canvas","context","imageData","x","y","bgraIndex","imageIndex","getContext","createImageData","putImageData","toDataURL","getClipboardText","windowObject","originalEvent","clipboardData","getData","setClipboardText","setData","getAppIconIndex","icons","targetIconSize","iconIndex","currentSelectedIconSize","currentIconSize","getDesiredResolution","wmks","w","h","scale","BROWSER","isIOS","isAndroid","documentElement","clientWidth","clientHeight","isTouchDevice","TOUCH","isPortraitOrientation","screen","innerWidth","innerHeight","getTouchDeviceDesiredResolution","callback","noChangeCountToEnd","noEndTimeout","interval","end","lastClientWidth","lastClientHeight","noChangeCount","clearInterval","clearTimeout","setInterval","setTimeout","isMP4Supported","isMediaSourceSupported","testObject","isChrome","major","MediaSource","WebKitMediaSource","isRTAVSupported","isSafari","loadConfigInfo","ajaxMethod","infoData","clientVersion","internalVersion","splitVersionInfo","clamp","minValue","maxValue","min","max","returnToLauncher","launchPageURL","location","origin","itemNameContainsQuery","toLocaleLowerCase","itemSortHelper","item1","item2","supportPostMessage","isEdge","MKSVchan","PACKET_TYPE","CLIPBOARD_DATA_TEXT","CLIPBOARD_REQUEST","CLIPBOARD_DATA_CP","CLIPBOARD_CAPABILITIES","CLIPBOARD_LOCALE","FILE_TRANSFER_REQUEST","FILE_TRANSFER_DATA_FILE","FILE_TRANSFER_CONFIG","FILE_TRANSFER_ERROR","CAPABILITY_CLIPBOARD","TEXT","IMAGE_AND_RTF","NOTIFY_ON_CHANGE","CLIPBOARD_ERROR","NONE","MAX_LIMIT_EXCEEDED","FILE_TRANSFER_FILE_TYPE","FILE","DIRECTORY","SYMLINK","FILE_TRANSFER_POLICY","MIN","DISABLED","DEFAULT","BIDIRECTIONAL","ONLY_TO_SERVER","ONLY_TO_CLIENT","MAX","NO_ENOUGH_DISK","IS_TRANSFERRING","UNKNOWN_ERROR","PRINT_TIMEOUT","SEND_FILES","CANCEL_SEND_FILES","SEND_SPECIFIC_FILES","CANCEL_SEND_SPECIFIC_FILES","CANCEL_RECEIVE_SPECIFIC_FILE","FILE_LIST","PRINT_CONFIG","FILE_TRANSFER_CLIENT","WINDOWS","MAC","LINUX","WEB","ANDROID","IOS","FILE_TRANSFER_CONSUMER","FT","PRINT","FILE_TRANSFER_MAX_FILE_SIZE","FILE_TRANSFER_MAX_TOTAL_SIZE","ENABLE_NOTIFY_ON_CHANGE","MAX_BYTES_TEXT","MAX_BYTES_IMAGE_AND_RTF","MAX_KBYTES_IMAGE_AND_RTF","CHANNEL_NAME_PREFIX","CHANNEL_DATA_OBJECT","CHANNEL_CTRL_OBJECT","CP_FORMAT","UNKNOWN","FILELIST","RTF","FILELIST_URI","FILECONTENTS","IMG_PNG","FILEATTRIBUTES","BIFF12","ART_GVML_CLIPFORMAT","HTML_FORMAT","Clipboard","items","changed","clear","getTotalSize","size","byteLength","getItem","format","setItem","excess","Uint8Array","subarray","getText","clipboardFormat","textStr","uint8ArrayToString","setText","stringToUint8Array","setChanged","getChanged","FTUtil","downloadList","uploadList","fileChunkQueue","currentDownloadService","config","serverVersion","downloadEnabled","printDownloadEnabled","uploadEnabled","chunkSize","maxChunkSize","maxChunkNum","parseDownloadListString","fileList","resList","fileListArray","fileNum","fileInfoObj","fileType","fileSize","fullPath","relPath","uuid","readableSize","getReadableSize","contentData","progress","transferError","stopTransfer","kb","mb","gb","toFixed","downloadServiceSwitcher","services","chunkNum","chunkFileIdentifier","service","searchReceiveFile","updateConfig","policy","searchFileFromList","tryNormalizeUnicodeForMac","platform","normalize","Client","vdpService","vdpChannel","vdpControlObject","vdpDataObject","sendRPC","sendClipboardCapabilities","sendClipboardLocale","sendFileTransferConfig","handleRPCFromServer","handleClipboardCapabilities","handleClipboardDataText","handleClipboardDataCP","handleFileTransferData","handleFileTransferRequest","handleFileTransferConfig","handleFileTransferError","clipboard","onReady","onClipboardChanged","onDownloadFilesChange","onPrintDownloadFilesChange","onFileChunkReceived","onFileTransferConfigChange","onFileTransferError","onPrintError","capabilities","notifyOnChangeEnabled","uploadService","downloadServices","addChannelCreatedListener","channel","connectChannel","onDisconnect","id","onInvoke","rpc","sendClipboardRequest","onDone","onAbort","sendFileTransferRequest","consumer","packet","Packet","createNewPacketLE","uint8Consumer","writeUint16","writeArray","sendFileChunk","totalChunkNum","chunkIdentifier","chunkData","uint8IdArray","writeUint32","sendClipboardText","utf8Text","rpcDone","sendClipboard","writeUint8","sendStopUploadRequest","uint8FileName","sendStopDownloadRequest","fileIdentifier","uint8Id","command","invoke","RPC_TYPE","REQUEST","caps","clientType","createFromBufferLE","readUint32","formats","exists","readUint8","readArray","bytesRemaining","fileListStr","chunkDataSize","chunkIdentifierSize","chunkIdentifierData","downloadService","readUint16","reassembleChunks","requestType","fileListLength","fileListData","clientVersionSentToServer","ftError","SetUserGlobalPrefHandler","favoriteIds","apply","pref","prefElements","responseXML","brokerTag","result","errorCodeNode","errorMessageNode","resultElem","favoriteItems","prefNodes","resp","hasChildNodes","nodeValue","ignoreData","GetLaunchItemsHandler","skipTunnelAndPref","skipTimer","getUserGlobalPref","notifyUI","supportedDesktopProtocols","supportedAppTypes","nameElement","protocolElement","sessionElement","protocolsElement","desktopsElement","typeElement","typeNameElement","typesElement","applicationElement","shadowSessionElement","launchItemsElement","protocols","launchItems","types","l","urlHandler","allowCollaboration","environmentInfo","infoElements","environmentElement","getLaunchItemsAction","urlParams","idleTimeout","userActivityXMLSendingInterval","desktops","applications","applicationSessions","shadowSessions","desktopId","desktopProtocol","targetProtocol","getIdleTimeoutValue","getSendIntervalValue","timerInfo","launchItemsResponse","desktopsNodes","desktopsLength","applicationsNodes","applicationsLength","sessions","applicationSessionsNodes","applicationSessionsLength","shadowSessionsNodes","shadowSessionsLength","desktop","application","session","attr","aDesktopInstance","setLaunchItemName","setLaunchItemId","setResponseState","setSessionId","setInMaintenanceMode","setProtocolMatch","setProtocols","setDesktopUserPrefs","setCanLogoff","setResetAllowed","setResetAllowedOnSession","setCanRollback","isDisabledItem","aApplicationInstance","setApplicationType","setLaunchItemOriginId","setApplicationVersion","setApplicationPublisher","setApplicationLaunchPath","setApplicationIcons","aApplicationSessionInstance","setApplicationSessionRemoteAssetsType","aShadowSessionInstance","aLaunchItemInstance","launchItemNode","matchNode","userPreferencesNode","preferenceNode","hasDefault","protocolsNode","protocolNode","protocolName","preferenceNameAttr","isDefaultNode","supportPreferredProtocol","getAttribute","desktopNode","launchItemIdNode","launchItemId","launchItemNameNode","launchItemName","launchItemDisabledNode","inMaintenanceModeNode","inMaintenanceMode","responseStateNode","responseState","responseStateLower","resetAllowedNode","resetAllowed","resetAllowedOnSessionNode","resetAllowedOnSession","sessionIdNode","sessionId","offlineStateNode","offlineState","applicationNode","applicationTypeNode","applicationType","launchItemOriginIdNode","launchItemOriginId","applicationVersionNode","applicationVersion","applicationPublisherNode","applicationPublisher","applicationLaunchPathNode","applicationLaunchPath","iconsNode","iconNode","iconPath","iconWidth","iconHeight","icon","applicationSessionNode","applicationSessionRemoteAssetNode","applicationSessionRemoteAsset","disconnectDesktop","logoutBrokerObject","resetDesktop","resetDesktopObject","restartDesktop","restartDesktopObject","restartData","logoffDesktop","killSessionObject","findDesktop","targetDesktop","oneDesktop","JSCDKBrokerError","JSCDK_BROKER_ERROR_BROKER_DISABLED","JSCDK_BROKER_ERROR_DESKTOP_LAUNCH_ERROR","JSCDK_BROKER_ERROR_DESKTOP_MAINTENANCE_ERROR","JSCDK_BROKER_ERROR_DESKTOP_ROLLBACK_CHECKOUT_ERROR","JSCDK_BROKER_ERROR_APPLICATION_LAUNCH_ERROR","JSCDK_BROKER_ERROR_LAUNCH_ITEMS_ERROR","JSCDK_BROKER_ERROR_INVALID_ROOT_ELEMENT","JSCDK_BROKER_ERROR_INVALID_VERSION","JSCDK_BROKER_ERROR_INVALID_XML","JSCDK_BROKER_ERROR_KILL_SESSION_ERROR","JSCDK_BROKER_ERROR_MISSING_CONTENT","JSCDK_BROKER_ERROR_MISSING_VERSION","JSCDK_BROKER_ERROR_NOT_ENTITLED","JSCDK_BROKER_ERROR_PREFERENCES_ERROR","JSCDK_BROKER_ERROR_READ_ERROR","JSCDK_BROKER_ERROR_RESET_DESKTOP_ERROR","JSCDK_BROKER_ERROR_TUNNEL_ERROR","signal","dispatch","table","method","errNoInstance","errNoMethod","createSignal","handlers","emit","addEventListener","makeObservable","signals","addSignal","GetDesktopsHandler","doSubmitAuthenticationObject","supportedProtocols","getDesktopsAction","desktopResponse","setDesktopName","setDesktopId","setCheckedOut","desktopIdNode","desktopNameNode","desktopName","checkoutGuid","checkedOut","checkedOutNode","angular","VDPService","freeze","CHANNEL_STATE","CLOSED","CLOSING","OPEN","NOT_READY","READY","POST","VARIANT_TYPE","SIGNED_INTEGER","CHAR","UNSIGNED_INTEGER","UNSIGNED_INTEGER_8","STRING","BLOB","RPC_ACTION","RESPONSE","CHANNEL_COMMANDS","CREATE_OBJECT","DESTROY_OBJECT","EXCHANGE_SECRET","SEND_PCOIP_SIDECHANNAME","BEAT_REQUEST","BEAT_REPLY","RPC_DATA_FORMAT","INVALID_CHANNEL_OBJECT_ID","START_REQUEST_ID","MINIMUM_RETURN_SECTION_LENGTH","CAPABILITY","RPC_HEADER_SIZE","XDRBuffer","readPosition","ensureWrite","ensureRead","setUint8Array","seekToNextBlock","initEncoder","initDecoder","encodedArrayBuffer","getReadPosition","write","writeVariant","writeString","utf8Array","writeBlob","setInt32","writeInt32","position","reqBytes","signed","writeType","vt","readInt32","readUint64","readInt64","readString","stringData","readBlob","blob","readVariant","String","fromCharCode","skipWriteBytes","num","seekReadPosition","pos","buffer","reqLength","newLength","set","seekWrite","Service","vvc","vvcSession","vvcListener","vdpChannels","onPeerChannelOpen","onChannelCloseError","onChannelCreatedListeners","createListener","onpeeropen","desiredObjectNames","Channel","acceptChannel","getChannel","desiredObjects","rejectChannel","disconnectChannel","close","isChannelPresent","channelID","onclose","onerror","vvcChannel","requestID","pendingRequests","onVVCMessage","encode","decode","handleCreateObject","handleDestroyObject","handleOnInvoke","findOpenObjectByID","findOpenObjectByName","openObjects","isRequestPending","onmessage","event","warn","userRPC","objID","contexts","sendBuffer","objName","send","getEncodeFunction","getDecodeFunction","xdr","returnCode","returnParams","userCancelled","abortCode","numOfContexts","numOfParams","numOfReturnParams","reqID","request","vdpRPC","GetTunnelConnectionHandler","bypassTunnel","responses","tunnelConnectionResponse","nameText","localName","baseName","KillSessionHandler","itemId","itemType","callbackFunction","setCallbackFunction","killSessionResponse","sessionIdElem","killSessionAction","getItemsObject","targetApplication","targetApplicationSession","itemInfo","launchItemTypeIsDesktop","errorObj","requestLastActiveTimeFromPortal","requestLastActiveTimeFromRemoteSession","prepareForAlreadyAuthenticated","requestLastActiveTime","ActionName","requestLastUserActiveTimeAction","factory","filter","directive","constant","StringUtils","CHUNK_SZ","escape","join","nullTerminate","utf8String","unescape","uint8ArrayIndexOf","element","start","uint8ArrayTokenize","resultArray","bitBuffer","BitBuffer","_buf","_size","_readCount","_overflow","_thisByte","_thisByteBits","readBits0","val","nr","mask","_bits","readBits","origNr","readEliasGamma","bit","origidx","origbit","newInstance","fullscreenSubService","fullscreenService","$window","isFullscreen","fullScreenElement","msFullscreenElement","mozFullScreen","webkitIsFullScreen","waitCondition","condition","waitMaxTime","waitTime","checkInterval","checkFunction","waitTimer","$timeout","fullscreenHandler","onFullscreenChanged","onEnterFullscreen","tolerent","screenX","availLeft","screenY","availTop","onExitFullscreen","enterFullscreen","elem","requestFullScreen","mozRequestFullScreen","webkitRequestFullscreen","ALLOW_KEYBOARD_INPUT","webkitRequestFullScreen","msRequestFullscreen","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","bindFullScreen","$","on","unbindFullScreen","off","normalizationService","_perMonitorMode","_rawSetting","_normalizationModel","_normalizedSettings","_defaultModel","_agentDPI","_DPIEnabled","setAgentDPI","dpi","setPerMonitor","usePerMonitor","isPerMonitorMode","getFactor","baseDPI","devicePixelRatio","monitorDPI","compensateFactor","clientFactor","setDPISync","enabled","_getNormalizationParam","target","refer","k","tx","ty","point","model","round","revert","_getStablePoint","baseId","isLeft","isRight","isTop","isDown","_generateModel","stablePoint","Number","_calculateNormalizedSetting","startPoint","isModified","_clipSettings","setScreenModel","setRawSetting","setting","removeRawSetting","calculate","getNormalizationModel","getNormalizedSettings","getSizeFactor","isScaleMismatched","renderCacheService","decodeToCacheEntry","updateCache","updateCacheEntries","cacheOperationType","updateCacheOpInit","updateCacheOpBegin","updateCacheOpEnd","updateCacheOpReplay","fail","releaseImage","rect","image","_evictUpdateCacheEntry","slot","_executeUpdateCacheInit","_updateCacheInsideBeginEnd","_updateCacheInitialized","_executeUpdateCacheBegin","maskBitBuf","maskState","maskCount","dataLength","overflow","imageWidth","imageHeight","_executeUpdateCacheEnd","update","count","dstx","dsty","dstw","ceil","dsth","srcx","srcy","srcw","srch","availwidth","bitbuf","targetPoint","encodedMaskRect","maskLength","vncDecoder","_normalize","_context","drawImage","_executeUpdateCacheReplay","updateBitBuf","updateState","updateCount","_lighten","color","globalCompositeOperation","fillStyle","fillRect","operateOnCache","opcode","setImage","setVncDecoder","decoder","decodingCache","_canvas","encodingTypes","encCopyRect","encTightPNG","encUpdateCache","subEncFill","_screenBase","initScreen","p","_copyRectBlit","srcX","srcY","dstX","dstY","_backgroundContext","_backgroundCanvas","_fillRectWithColor","newStyle","canvas2dCtx","_renderImage","setCanvas","_backgroundCanvasObject","remove","css","onDPIChanged","render","onRenderDone","pSrc","encoding","subEncoding","releaseRectData","wmksBaseService","getEventPosition","docX","docY","defaultPosition","normalizedPosition","pageX","pageY","clientX","clientY","body","scrollLeft","scrollTop","getScreenSetting","offsetX","offsetY","shouldPreventDefault","specialKeys","hasSpecialKey","forEach","keyName","DoLogoutHandler","setPrefHandler","needClearURIFlag","setNeedClearURIFlag","logoutResponse","logoutAction","GetAuthenticationStatusHandler","setWorkForSilentModeFlag","needCallback","response","userActiveTimeSyncCtrl","dealWithAuthenticationStatusXML","returnAuthenticationStatus","authStatusAction","sso","idleTimeoutTimerController","resultText","authStatusResponse","ssoNode","ssoText","timeToSsoLockNode","ResetDesktopHandler","tokenText","resetDesktopResponse","desktopIdElem","resetDesktopAction","nullFunc","levels","LEVEL_WARN","getMethod","stackTrace","Unity","CAP_UNITY","CAP_STATUS","CAP_WORK_AREA","CAP_MULTIMON","CAP_TASKBAR","CAP_WINDOW_CONTENTS","CAP_SHELL_ACTION_RUN","CAP_SET_FOCUSED_WINDOW","CAP_MOUSE_BUTTON_SWAPPING","CAP_SET_APP_ENTITLEMENT_MAP","CAP_TRAY_ICONS","ADD_HIDDEN_WINDOWS_TO_TRACKER","INTERLOCK_MINIMIZE_OPERATION","SEND_WINDOW_CONTENTS","DISABLE_COMPOSITING_IN_GUEST","DISABLE_MOUSE_BUTTON_SWAPPING","SHOW_FLOATING_LANGUAGE_BAR","WINDOW_TYPE_NONE","WINDOW_TYPE_NORMAL","WINDOW_TYPE_PANEL","WINDOW_TYPE_DIALOG","WINDOW_TYPE_MENU","WINDOW_TYPE_TOOLTIP","WINDOW_TYPE_SPLASH","WINDOW_TYPE_TOOLBAR","WINDOW_TYPE_DOCK","WINDOW_TYPE_DESKTOP","WINDOW_TYPE_COMBOBOX","WINDOW_TYPE_WIDGET","WINDOW_TYPE_METRO_OBSOLETE","WINDOW_TYPE_START_SCREEN","WINDOW_TYPE_SLIDE_IN_PANEL","WINDOW_TYPE_TASKBAR","WINDOW_TYPE_METRO_FULLSCREEN_APP","WINDOW_TYPE_METRO_DOCKED_APP","MAX_WINDOW_TYPES","WINDOW_ATTR_BORDERLESS","WINDOW_ATTR_MINIMIZABLE","WINDOW_ATTR_MAXIMIZABLE","WINDOW_ATTR_MAXIMIZED","WINDOW_ATTR_CLOSABLE","WINDOW_ATTR_HAS_TITLEBAR","WINDOW_ATTR_VISIBLE","WINDOW_ATTR_CHILD_WINDOW","WINDOW_ATTR_HAS_TASKBAR_BTN","WINDOW_ATTR_MOVABLE","WINDOW_ATTR_RESIZABLE","WINDOW_ATTR_ALWAYS_ABOVE","WINDOW_ATTR_ALWAYS_BELOW","WINDOW_ATTR_DISABLED","WINDOW_ATTR_NOACTIVATE","WINDOW_ATTR_SYSMENU","WINDOW_ATTR_TOOLWINDOW","WINDOW_ATTR_APPWINDOW","WINDOW_ATTR_FULLSCREENABLE","WINDOW_ATTR_FULLSCREENED","WINDOW_ATTR_ATTN_WANTED","WINDOW_ATTR_SHADEABLE","WINDOW_ATTR_SHADED","WINDOW_ATTR_STICKABLE","WINDOW_ATTR_STICKY","WINDOW_ATTR_MODAL","WINDOW_ATTR_MINIMIZED","WINDOW_ATTR_FOCUSED","WINDOW_ATTR_TRANSPARENT","MAX_ATTRIBUTES","RPC_ENTER","RPC_GET_BINARY_INFO","RPC_WINDOW_SETTOP","RPC_WINDOW_CLOSE","RPC_GET_ICON_DATA","RPC_EXIT","RPC_GET_UPDATE_FULL","RPC_GET_UPDATE_INCREMENTAL","RPC_WINDOW_UNMINIMIZE","RPC_SET_OPTIONS","RPC_GET_EXEC_INFO_HASH","RPC_PUSH_UPDATE_CMD","RPC_ACTIVE","RPC_NOTIFY_CLIENT","SERVER_UNITY_INFO_MSG","SERVER_UNITY_PLUGIN_MSG","CLIENT_UNITY_PLUGIN_MSG","OPTIONS_V1","EXEC_INFO_HASH_V1","ACTIVE_V1","ICON_TYPE_MAIN","DEFAULT_ICON_CHUNK_SIZE","Mgr","mainChannel","requests","seqNo","pendingIconRequests","unitySvcObject","getIconDataChunk","serializeRPCParameter","parseUnityMessage","parseUnityCapabilities","parseUnityUpdate","splitStringComponents","removeWindow","handleGetBinaryInfoMessage","handleGetIconDataMessage","handleGetExecInfoHashMessage","handleUnityUpdateMessage","handleUnityActiveMessage","handleNotifyReadyMessage","vdpServiceMainChannel","addMessageHandler","windows","windowCount","isOn","paused","features","requestUpdate","windowId","removedWindow","onUpdateComplete","fullUpdate","getBinaryInfo","windowPath","setTopWindows","windowIds","closeWindow","getIconData","iconChunkSize","unminimize","getExecInfoHash","execPath","pause","unpause","getPendingIconRequestCount","getPendingRPCCount","iconPosition","previousCookie","newCookie","pendingRequest","iconData","cookie","xdrEncodeArgs","rpcString","xdrBuffer","parameter","serializedString","rpcName","messageContents","status","capsCount","timestamp","invalidRPCCommand","lastTokenIndex","tokenIndex","spaceCharCode","parse","rpcContentsInvalid","callbacks","onVisibilityChanged","capsArray","capArray","serverCaps","pop","onCapsChanged","updateComponents","shouldCheckExists","shouldExist","updateContentsInvalid","temp1","temp2","attributes","title","substr","onAdd","onTitleChanged","onAttrChanged","onTypeChanged","onIconChanged","components","Function","shift","onRemove","tokenObject","images","imageCount","imageBGRASize","iconRequest","fullIconLength","returnedIconLength","iconChunk","xdrObjectVersion","xdrObjectMoreData","xdrObjectData","messageComponents","listenerCalled","xdrActiveVersion","xdrActiveData","onActiveChanged","onReadyChanged","DoLockHandler","doLockAction","needDisplayDialogs","notifyLockEventToUI","doLockResponse","errorCodeElem","errorMessageElem","userMessageElem","GetConfigurationHandler","HaveAuthTypesEnum","HAVEAUTHTYPE_DEFAULT","HAVEAUTHTYPE_SAML","HAVEAUTHTYPE_UNAUTH","PasscodeAuthLabel","PASSCODE_AUTH_LABEL_RSA_SECURID","authTypes","ignoreResponseFlag","ignoreResponse","samlNameElem","unauthNameElem","haveAuthTypesElem","contentElem","supprotedFeatures","getAuthTypes","sendGetAuthenticationStatus","getAuthenticationStatusObject","handleParsedResult","authentication","responseTagElem","authElem","authScreenElem","clientConfigElem","clientConfiguration","workspaceElem","screenNameElem","screenNameText","paramsElem","paramsLength","child","valueList","default","setAuthTypes","isReauth","samlSecret","submitAuthInfoAction","label","authenticationAction","authType","authChallenge","domains","userName","username","domainName","tokenUserName","secret","reAuth","accept","usernames","usernameReadOnly","domain","domainReadOnly","clientConfig","GetUserGlobalPrefHandler","prefData","favorites","launchitemsHandler","markFavorite","favorite","keys","JSCDKClientController","JSCDKFrontController","addCommand","_instance","RestartDesktopHandler","restartDesktopResponse","idElem","typeElem","desktopElem","restartDesktopAction","SetLastUserActivityHandler","inactiveTime","errorInfo","setLastUserActivityResponse","UrlHandler","ActionEnum","STARTSESSION","BROWSE","LOGOFF","RESET","UrlHandlerError","URI_ERROR_INVALID_URL_PARAMETER","samlArt","collabSessionId","applicationId","applicationName","schemeName","horizonId","mid","unauthenticatedAccessEnabled","unauthenticatedAccessAccount","spID","handleUrlParams","parsedUriInfo","fillParams","isErrorInParameters","loadParams","urlKey","formatArgs","parseParam","refresh","resetParams","pushErrorToUI","IdleTimeoutTimerController","brokerVersionInvalid","timeSyncBuff","ui","broker","local","globalName","aboutToIdleTimeout","userActivityInterval","hintTime","intervalTimer","aboutToTimeoutTimer","timeoutTimer","requestLastActiveTimeFunction","userActivityEvent","aboutToIdleTimeoutEvent","idleTimeoutEvent","initCore","initType","setEnable","setDisable","init","sendSetLastUserActivityXMLtoBrokerWith","setLastUserActivityObject","inactiveTimeVar","inactiveTimeStr","sendDoLockXML","doLockObject","setlocalTimeForCompare","localTargetTime","getTargetTime","reset","ensureUpdatedOrStarted","stop","discard","updateTimeoutValue","setlastUserActiveTime","lastUserActiveTime","needSendXML","needRefreshTimer","currentTime","getTime","setUITimeForCompare","UIlastUserActiveTime","requestBrokerTimeForCompareFor","actionTrigger","callBackType","ctrlName","requestBrokerSSOTime","setBrokerTimeForCompare","timeToBrokerLocked","brokerAheadTime","brokerlastUserActiveTime","compareToAct","newestTime","needSendLastUserActivityXML","timeDelayTolerance","showAboutToTimeoutDialoagAction","showTime","detectBrokerLocked","AppCenterController","$scope","$rootScope","constants","baseViewService","connectionURIModel","CLIENT_MODE","LAUNCHER","showPreference","$on","next","current","isBackInLauncher","locationChange","preventDefault","isBackFromDesktop","isHWSession","goBackToLauncherFromDesktop","isRefreshingLauncher","transitionState","scope","CLIENT_LOGIN_KEY","oldValue","newValue","onpageshow","persisted","reload","run","AboutDialogCtrl","viewClientModel","localize","getHelpLink","map","linkModel","en","helpUrl","rebrandHelpUrl","ngDialogProvider","dialogService","setDefaults","className","showClose","closeByEscape","closeByDocument","ngDialog","_DEFAULT_ERROR_OPTIONS","templateUrl","_DEFAULT_CONFIRM_OPTOINS","confirm","options","defaultOptions","extend","open","confirmWithCancelAsDefault","predefined","isConfirmDialog","openConfirm","isDialogOpen","dialogID","isOpen","hasDialogOpen","dialog","viewclientType","DPI_100_PERCENT","ANONYMOUS_MODE_KEY","SP_ID_FOR_WS1_KEY","dialogTabindex","dialogPreventKeyUp","dialogTabScope","restrict","link","attrs","scopeCtrl","inited","addChoosableElement","keydown","keyCode","isDialogServiceKeyPress","$element","reseted","choosableArray","currentTabIndex","isInnerElement","parent","contains","compareDocumentPosition","getDefaultIndex","startIndex","indexSlot","indexNumber","findIndex","targetTabIndex","getNextElementIndex","onTabDown","nextElementIndex","focus","onKeyDown","focusOnDefault","defaultElement","onFocus","onFocusOut","workingDialog","keyDownFunc","relatedTarget","focusout","fuzzyFree","$watch","offsetHeight","newHeight","oldHeight","scrollableDialog","defaultHeight","windowResizeHandler","outerHeight","unbind","brokerSessionStorageService","BaseViewClientModel","vendor","arch","product","clientID","ipAddress","rebrandName","rebrandGotoForumUrl","windowsTimezone","clientHideDomainList","read","clientHideServerInformation","credentialCleanup","isAnonymousMode","blastSessionsModel","isNotValidString","isInvalidBlastSession","hasBlastInfoIn","getFormatConvertedInfo","getFormatConvertedInfoFromSessionInfo","hasSessionInfoInStorage","readFromStorage","writeToStorage","isInvalidLaunchResponse","sessionInfo","protocolIsBlast","needNewConnectionWithBlast","originId","convertedSessionInfo","blastUrl","exist","getFullSessionInfoWith","sessionInfoList","validSessionInfoList","saveFromXmlResponse","validSessionInfo","clientIdFactory","clientUID","isAnIP","hostAddress","segmentArray","segmentLength","temp","isIPv4Address","isIPv6Address","isAnAccessableDomain","testText","getRootDomain","rootDomain","setClientUIDFromCookie","cookies","cookiesLength","writeClientUIDToCookie","expires","setTime","toGMTString","generateRandomArray","platformID","arrayToBase64","uidIntArray","arrayLength","h1","h2","h3","number","c1","c2","c3","c4","toBase64Table","charsArray","indexAc","generateUID","getClientID","connectionServerModel","ServerModel","connectionProtocol","tokenUsername","loadFromURIModel","srcKey","keyList","specialKeyMap","serverModel","storageService","usernameUtil","reuseSession","isIdenticalUser","oldHost","_isSwitchingToAnonymous","_getUsername","oldUserName","COOKIE_USER_NAME","oldDomainName","COOKIE_DOMAIN_NAME","oldTokenUsername","COOKIE_TOKEN_USER_NAME","oldHorizonId","COOKIE_HORIZON_ID","usernameEquals","domainEquals","isAnonymous","isF5Session","isSamlUsed","getSpID","generateRelayInfo","relayInfo","getF5postFix","ignoreCaseEquals","str1","str2","username1","username2","domainInUsername","getUsername","domainName1","domainName2","getDomain","needReuseSession","osModel","detectOS","prefix","os","getOSLiteral","mIsWin32","mIsWin64","mIsWinMobile","mIsLinux32","mIsLinux64","mIsMacOS","mIsIOS","mIsAndroid","mIsChromeOS","osNames","win32","win64","winmobile","linux32","linux64","mac","android","ios","chromeos","unknown","osLiteral","clientInfo","clientModel","vs","appVersion","failToInited","onInitCallback","nativeInstallerLink","initClientInfo","clientIPAddress","machineName","browserName","isNaN","rebrandEnable","installerLink","contextPath","onFailReadingClientInfo","mIsIE","mVersionIE","mIsWebKit","mVersionWebKit","mIsOpera","mVersionOpera","mIsChrome","mVersionChrome","mIsGecko","mVersionGecko","mIsIEMobile","mIsIPhone","mIsIOSSafari","$location","credCleanService","changeLocation","gotoPortal","setFlagBeforePageJumping","nextHash","_getHashFromURL","currentHash","isJumpingToDesktop","loc","getFullKey","isManagedKey","storage","keyHeader","localStorage","removeItem","itemKey","fullKey","itemkey","userGlobalPref","_isPageJump","_actionForPageTearDown","_sendLogoutAction","uiController","invokeJSCDK","toFlatFormat","dpiService","logger","getDPI","getPrefData","enableDPISync","i18n","localizationReady","lang","getHTMLLang","$emit","isArray","input","multiSiteService","redirectAndStartSession","redirectProperties","serverAddress","SAMLart","isHighResolution","useMacOSXKeyMappings","enableWindowsKey","timezoneSync","equals","sort","toJSON","safeStorageService","itemOperators","managedKeyPool","isSessionStorageAllowed","sessionStorage","privateKey","encodedData","privateKeyString","encodedValue","extendedkey","callbackWithDecodedData","decodedData","clearAllManagedItems","removeItemCallback","COOKIE_VALUE_DELIMITER","COOKIE_IDLE_TIMEOUT","COOKIE_SEND_TIME_INTERVAL","days","date","base64","clearSessionCookies","isEnabled","cookieEnabled","test","o1","o2","o3","h4","bits","chrTable","ac","tmpArray","btoa","utf8","b64","atob","utftext","LOCAL_STORAGE_COOKIE","add","regexp","getKey","getValue","identifier","toastService","TOAST_TYPE","PREDEFINED","LEVEL","SUCCESS","WARNING","ERROR","COMMON_OPTIONS","DEFAULT_OPTIONS","PRINT_OPTIONS","FT_OPTIONS","copy","timeOut","_currentToast","_toastArray","setOptions","_showToast","optionCache","toast","clearCurrentToast","clearEarlyToast","clearAll","URIParamValidator","URIParams","$log","initialized","dirty","commandName","postPrefData","clearPrefData","readyToSend","onDataSent","setPrefData","enableMP4","updatePrefData","favArray","isDomainUsername","isUPN","getUsernameFromDomainUsername","backslash","getDomainFromDomainUsername","getUsernameFromUPN","at","getDomainFromUPN","isUsernameLegal","isDomainLegal","isDomainInDomainList","ws1Service","redirectToWS1","ws1ServerName","appName","serverAPI","spURLParam","storeSpId","isLaunchedFromWS1","timezoneListDirective","timezone","timeZoneMap","isDaylightSaving","stdTimezoneOffset","jan","jul","getTimezoneOffset","dst","today","getTimezoneOffsetData","getWindowsTimezone","timezoneOffset","WindowsTimezone","commonSvcService","wmksServiceEventHandler","comSvcMgrMap","COMMON_SVC","DPI_SYNC_VERSION","MSG_TYPE","CLIENT_COMMON_PLUGIN_MSG","ENVIRONMENT_VAR_INFO_MSG","DPI_SYNC_MSG","DPI_SYNC_COMMAND_TYPE","DPI_SYNC_COMMAND_NONE","DPI_SYNC_COMMAND_VERSION","DPI_SYNC_COMMAND_DPI","wmksService","commonSvcObject","remoteDPI","WMKS","commandType","displayScale","wmksSession","getWmksSession","setRemoteDPI","getRemoteDPI","updateResolution","isInited","onWmksSessionConnecting","isApplicationSession","mgr","onWmksSessionConnected","onWmksSessionDisconnected","destroyComSvcMgr","onWmksSessionRemoved","wmksServiceInstance","listenerReadyForModule","MODULE_NAME","COMMON_SVC_SERVICE","getCommonSvcMgr","isInitedForSession","mainChannelService","vdpServiceMainChannelNamePrefix","ChannelObj","msgHandlers","RdpdrChannelManager","FOLDER_REDIRECTION_CMD","FOLDER_REDIRECTION_NOTIFICATION","RDPDR_POLICY","TSDR_RDPDR_HEADER_SIZE","TSDR_POLICY_HEADER_SIZE","TSDR_GLOBAL_POLICY_SIZE","TSDR_FOLDER_POLICY_SIZE","TSDR_DEVID_AC_SHIFT","TSDR_DEVID_AC_MASK","TSDR_FOLDER_PERMISSION","TSDR_PERM_UNKNOWN","TSDR_PERM_OPEN_READ_ONLY","TSDR_PERM_READ_ONLY","TSDR_PERM_OPEN_WRITE_ONLY","TSDR_PERM_WRITE_ONLY","TSDR_PERM_NORMAL","RDPDR_TYPE","RDPDR_CTYP_CORE","RDPDR_CTYP_PRN","PAKID_CORE_SERVER_ANNOUNCE","PAKID_CORE_CLIENTID_CONFIRM","PAKID_CORE_CLIENT_NAME","PAKID_CORE_DEVICELIST_ANNOUNCE","PAKID_CORE_DEVICE_REPLY","PAKID_CORE_DEVICE_IOREQUEST","PAKID_CORE_DEVICE_IOCOMPLETION","PAKID_CORE_SERVER_CAPABILITY","PAKID_CORE_CLIENT_CAPABILITY","PAKID_CORE_DEVICELIST_REMOVE","PAKID_PRN_CACHE_DATA","PAKID_CORE_USER_LOGGEDON","PAKID_PRN_USING_XPS","RDPDR_DEVICE_REMOVE_PDUS","RDPDR_CLIENT_DISPLAY_NAME_PDU","RDPDR_USER_LOGGEDON_PDU","BASE_TYPE","IRP_MJ_CREATE","IRP_MJ_CLOSE","IRP_MJ_READ","IRP_MJ_WRITE","IRP_MJ_DEVICE_CONTROL","IRP_MJ_QUERY_VOLUME_INFORMATION","IRP_MJ_SET_VOLUME_INFORMATION","IRP_MJ_QUERY_INFORMATION","IRP_MJ_SET_INFORMATION","IRP_MJ_DIRECTORY_CONTROL","IRP_MJ_LOCK_CONTROL","IRP_MN_QUERY_DIRECTORY","IRP_MN_NOTIFY_CHANGE_DIRECTORY","FILE_ACCESS_DELETE","FILE_ACCESS_GENERIC_ALL","FILE_ACCESS_GENERIC_WRITE","RDP_LOWIO_OP_SHAREDLOCK","RDP_LOWIO_OP_EXCLUSIVELOCK","RDP_LOWIO_OP_UNLOCK","RDP_LOWIO_OP_UNLOCK_MULTIPLE","CAP_TYPES","CAP_GENERAL_TYPE","CAP_PRINTER_TYPE","CAP_PORT_TYPE","CAP_DRIVE_TYPE","CAP_SMARTCARD_TYPE","GENERAL_CAPABILITY_VERSION","GENERAL_CAPABILITY_VERSION_01","GENERAL_CAPABILITY_VERSION_02","RDPDR_DTYP_SMARTCARD","PREFERRED_DOS_NAME_LENGTH","DEVICE_DATA_LOCAL_NAME_LENGTH","DEVICE_TYPE","SMARTCARD_MAX_DEVICE_ID","RDPDR_DTYPE_FILESYSTEM","FORMAT","RDPDR_HEADER","Map","DR_CORE_SERVER_ANNOUNCE_REQ","DR_CORE_CLIENT_ANNOUNCE_RSP","DR_CORE_CLIENT_NAME_REQ","RDP_DR_DEVICE_IOREQUEST","RDP_LOCK_INFO","DR_DEVICE_IOREQUEST","RDP_DR_DEVICE_IOCOMPLETION","formate","DR_DEVICE_IOCOMPLETION","DR_CORE_ANNOUNCE_REQ","CAPABILITY_HEADER","GENERAL_CAPS_SET","PRINTER_CAPS_SET","PORT_CAPS_SET","DRIVE_CAPS_SET","SMARTCARD_CAPS_SET","DR_CORE_CAPABILITY_REQ","DEVICE_ANNOUNCE_HEADER","DR_CORE_DEVICELIST_ANNOUNCE_REQ","DR_CORE_DEVICE_ANNOUNCE_RSP","DR_DEVICELIST_REMOVE","TDSR_TYPE","TSDR_COMPONENT_CAPS","TSDR_PACKID_VERSION_EXCHANGE","TSDR_PACKID_AGENT_POLICY","TSDR_FOLDER_ENUM_BUF_SIZE","TSDR_CAPS_MUL_ENTRIES","TSDR_CAPS_VERSION_EXCHANGE_REQ","Header","Version","Caps","MIN_TSDR_CAPS_VERSION_EXCHANGE_REQ_SIZE","VERSION","TSDR_VERSION_UNKNOWN","TSDR_VERSION_V1","TSDR_VERSION_V2","TSDR_VERSION_V3","StreamHelper","getBytes","bytes","getUint8","getUint16","getUint32","getUint64","getRest","getOffset","StreamWriter","pushBytes","pushUint8","pushUint16","pushUint32","pushUint64","getStream","getArray","hasData","pushUnitCode","charCode","pushString","getString","hexNumbers","ProtocolHelper","baseTypes","coodbook","convertToCaml","isInvalidType","parseByStruct","streamHelper","struct","propertyKey","logBase","propertySlot","subStruct","unionType","hasMatchedType","some","parseByName","streamifyByStruct","streamWriter","propertyValue","arrayMatcher","matchedArray","varientTypes","varientType","varientName","varientStruct","varientData","splittedString","arrayType","arrayLengthString","macroName","lengthPropertyName","arrayData","arrayStruct","streamifyByName","streamify","tsdrChannel","tsdrControlObject","deviceIdCounter","selectedFolders","userLoggedOn","pPolicy","protocolHelper","handleVersionExchange","handleTsdrPolicy","clipCString","deviceListAnnounce","folder","deviceId","deviceType","folderName","folderPermission","dosName","deviceAnnounce","header","component","packetId","deviceCount","deviceList","deviceDataLength","deviceData","sendResponse","redirectSelectedFolders","onUserReady","handleServerAnnounce","serverVersionInfo","versionMajor","clientVersionInfo","versionMinor","sendClientCapability","generalCapsSet","capabilityType","capabilityLength","osType","osVersion","protocolMajorVersion","protocolMinorVersion","ioCode1","ioCode2","extendedPDU","extraFlags1","extraFlags2","specialTypeDeviceCap","printerCapSet","portCapSet","driveCapSet","smartcardCapSet","clientCapability","numCapabilities","padding","capabilityMessage","sendClientName","clientName","unicodeFlag","codePage","computerNameLen","computerName","handleServerCapability","handleDeviceReply","handleIoRequest","parameters","parsed","typeMap","minorMap","minorFunction","majorFunction","resultType","handleUserLoggedon","processData","stream","rdpdrHeader","FALSE","onRequestCallback","dataBuffer","handleTSDRFromServer","tsdrChannelService","tsdrChannelNamePrefix","tsdrControlObj","tsdrDataObj","tsdr","objectName","clipboardController","clipboardInput","panelNotification","panelService","savedClipboardHeight","panelServiceInstance","getService","addPanelElement","resizable","containment","draggable","handle","getNewZIndex","resizeClipboardContents","showClipboardText","toggleClipboardText","addClass","removeClass","defaultText","clipboardPolicy","focused","showNotification","showClipboardPanel","hasClipboardData","clipboardReady","isMacOS","setDefaultPolicyText","policyText","focusInput","select","clipboardClear","clearClipboard","clipboardCopy","clipboardPaste","clipboardFocus","clipboardBlur","toggleClipboardPanel","$event","stopPropagation","openClipboardHelp","modKey","CLIPBOARD","template","msgKey","html","ajaxBusyOverlay","ajaxBusyOverlayController","showAjaxBusyOverlay","flag","applicationSessionsModel","jscdkDesktopInvoker","callbackBuff","getApplicationSessions","targetList","applicationSessionSet","applicationSessionKey","onStorageReaded","localContent","callbackFunc","jscdkHandler","useBuffedData","handlerGetLaunchItems","setEnvironmentInfo","sendLaunchItemsXML","audioService","audioEnabled","audioUseOpus","audioUseAac","audioUseWebAudioAPI","MAX_CHANNEL_NUMBER","MSG_TYPE_CHANNEL_VOLUME_MUTE","MSG_TYPE_CHANNEL_VOLUME_CHANGE","AudioServiceFactory","globalAudioContext","Audio","URL","webkitURL","canPlayType","e2","AudioContext","webkitAudioContext","createGain","createGainNode","audioNextTime","volumeInfo","isMuted","lastUpdateChannelId","isAudioEnabled","updateAudioMixer","audioMixerInfo","volumeNumber","db","msgType","pow","channelId","canAudioUseOpus","canAudioUseAac","initializeAudioForTouch","silentTone","gainNode","createOscillator","gain","connect","destination","frequency","noteOn","playAudio","audioInfo","ArrayBuffer","bufferView","playAudioWithWebAudioAPI","playAudioWithAudioObject","createBufferSource","noteOff","decodeAudioData","audioBuffer","gainNodeArray","curTime","delay","startTime","duration","containerSize","overlap","sampleRate","durationDiff","fadeInBy","fadeOutAt","endTime","numberOfChannels","numChannels","channelSplitter","channelMerger","createChannelSplitter","createChannelMerger","linearRampToValueAtTime","setValueAtTime","audio","audioType","flags","VNCDecoder","audioflagFmtMask","audioflagFmtShift","mimeType","audioFlagFmtClipsOpus","Blob","playClip","muted","volume","play","revokeObjectURL","src","createObjectURL","getAudioServiceInstance","blastWmks","BlastWMKS","BSG_TIMEOUT_MS","INIT_BACKOFF_DELAY_MS","REQUEST_DISCONNECT_TIMEOUT","MAP_META_TO_CTRL_FOR_KEYS","IGNORE_RAW_KEY_CODES","WIN_KEY_CODES","RTAVService","multimonRenderingService","$q","containerId","mp4Enabled","isShadow","isWmksConnected","isWmksActive","isDestroyed","wasWmksConnectedOnce","isActive","canvasId","multimonServerEnabled","isMP4Enabled","wmksOfflineMessageQueue","backoffDelayMs","heartbeatTimeout","reconnectTimeout","backoffTimeout","disconnectRequestTimeout","wmksContainer","requestedDisconnect","isEmpty","mksVchanClient","closeReasonFromBlast","disconnectedDialog","disconnectedDialogOption","cursorFactor","cursorHandler","postResize","hotx","hoty","ratio","resolve","reject","img","Image","onload","then","ctx","hx","hy","targetUrl","screenSize","ignoredRawKeyCodes","enableHighResMode","useMacOSXKeySettings","fitGuest","fitToParent","cancel","concat","isDefined","appendTo","display","border","hideLoading","useVNCHandshake","useUnicodeKeyboardInput","enableOpusAudioClips","enableAacAudioClips","enableVMWSessionClose","enableSubRectangleCache","enableVMWAudioMixer","sendProperMouseWheelDeltas","retryConnectionInterval","useNativePixels","mapMetaToCtrlForKeys","resolutionHandler","multimonRenderer","onConnected","onConnecting","closeReason","onDisconnected","code","onHeartbeat","onClipboardChange","itemName","toggleState","onReconnectToken","noCopyUI","noPasteUI","updateClipboardCapabilities","setUserActivityTime","reconnectTokenData","fromJson","setVisibility","isShow","show","openDisconnectedDialog","reconnecting","reason","hide","toggleVisibility","setEmpty","resetStateAndInitHeartbeat","sendQueueMessages","sessionOnConnected","client","onClipboardReady","handleDownloadListChange","handlePrintDownloadListChange","handleClipboardReceived","handleFileTransferConfigChange","handlePrintError","sessionOnConnecting","noReconnectAgain","closeDisconnectedDialog","setDimension","isWidth","desiredValue","minReached","diff","minimum","dimensionName","rescale","beforeunload","destroy","cleanup","destroyWmks","sessionOnDisconnected","isSessionTimedOut","isDisconnectedDialogOpen","shadowHeartbeat","recoverHeartbeat","toJson","widget","requestDisconnect","isIgnoreReconnect","removeReconnectToken","openDisconnectedDialogCallback","triedSSLVerify","redirectUrl","dialogText","numPages","history","pushState","buttonLabelConfirm","buttonLabelCancel","buttonLabel","closePromise","sessionOnRemoved","getWmksSessionInstance","DesktopCtrl","entitledItemsService","entitledItemsModel","entitledItems","onEntitleItemsRead","onDeviceStatusChanged","desktopKey","shadowSessionKey","shadowSession","applicationKey","iconSrc","getEntitledItems","getIdleTimeout","idleSessionService","_applicationSessions","_desktops","_applications","_callBackfunc","_callBackParam","_itemTypeEnum","_canReuseBlastSession","_jscdkHandler","_fillInDesktopsAndApplicationList","_findItemWithPropertyInList","itemList","_findDesktop","_findApplication","_sessionExisting","currentFarmId","_getNeedDisconnectedSessionForLaunching","existingSession","_launchDesktop","launchDesktop","_launchApplication","currentConnectedFarmID","launchApplication","badSession","applicationCache","disconnectApplicationSession","_setCallbackFunction","_initTimer","initTimerAction","_sendLastUserActiveTime","sendLastUserActiveTimeAction","ajaxBusy","doNotBlock","actionString","invokeCallback","invokeCallbackWithCallbackParam","handleItemConnect","actionData","blastURL","sessionLocked","handleDisconnect","handleError","userMsg","errorMsg","handleSuccessResponse","handlerReconnectResponse","successSessionInfo","handleAuthenticationStatusLocked","reAuthDialog","handleLastUserActiveTime","actionName","handleAuthenticationStatusReAuth","appConnectCallBack","actionObj","isJSCDKResponse","getUserGlobalPrefDeferred","logout","connectToBrokerWithCallback","sendDoUnlock","reWindowsPasswordExpired","initDoneDeferred","initJSCDK","responseHandler","defer","onBrokerUrlReaded","brokerUrlInfo","itemTypeEnum","launch","hasApplicationSession","deferred","promise","resetAllApplications","resetAllApplicationSessions","killItem","resetItem","reconnectApplicationSessions","targetAppSessionIdList","excludedOriginalId","unitTestStatusSetters","setCallback","setCanReuseBlastSession","canReuse","setApplicationCache","connectToBroker","authenticationStatusCheck","ondone","addInitDoneCallback","abortRequest","cancelCurrentRequest","submitWindowsPasswordWithCallback","password","submitWindowsPassword","startIdleTimer","brokerSupportIdleTimeout","handleUserActivityCallback","stopIdleTimer","initTimer","sendLastUserActiveTime","bypassApplicationVersionCheck","sendLastUserActiveTimeToTimerCtrl","actionType","handleNotAuthenticate","_invokeJSCDK","killItemAction","isDesktopReAuth","changePassword","oldPassword","newPassword1","newPassword2","doneAction","applicationsession","resetApplicationSessionAction","killAllApplicationSessions","targetSessionIds","reconnectApplicationSessionsAction","disconnectAll","_getEnvironmentInfo","appInfo","selectApplicationAction","maximized","preferences","resolution","launchParam","selectDesktopAction","connectBrokerAction","clientCommonInfo","clientStats","addClientCommonInfo","addClientStats","isHandheldDevice","matches","browserVersion","browserArch","address","sendDoUnlockAction","authStatusCheckAction","workForSilentMode","setEnvironmentInfoAction","messageHandlerService","launchingFunc","brokerAddress","invalidHWSData","dealWithHWSMessage","receiveMessage","onStorageChange","eventKey","localInfo","registerLaunchCallback","launchCallback","isFromHWS","maxYValue","maxXValue","offsetWidth","clampY","clampX","zIndex","panelList","showPanel","offsetTop","offsetLeft","top","left","printFrame","PrintController","linkFn","postPrint","isPrinting","recoverAllHeartbeatForPrint","printNextFile","isFirefox","frame","isString","viewerReady","contentWindow","print","TransferHelper","transferHelper","beginDownload","mksClient","downloadFiles","downloadReady","ifLatestFileHasTransferError","isFileDownloadingInCurrentSession","searchForNextDownloadList","printFile","mksClientList","getAllmksClient","downloadFileList","sendMsg","shadowAllHeartbeatForPrint","clearFileDataAfterPrint","updateDownloadFileList","addStatusListener","initTransferService","runningItemsModel","unityService","runningItems","runningVisibleItemsMap","runningApplicationMap","runningItemsMap","runningDesktopMap","loadingSessionsItem","loadingSessionsMap","getApplicationItems","removeApplicationItems","updateApplicationAttribute","updateApplicationFocusedItem","addRunningItem","setCanvasVisibility","updateRunningItemVisibility","removeRunningItem","updateRunningItem","updateRunningItemAttribute","updateRunningItemType","isRunningItemVisibleOnUI","checkVisibleWindows","removeAllRunningItemsPerSession","changeRunningItemStatus","generateApplicationId","generateRunningItemId","checkVisibleWindowTimer","checkVisibleWindowTimeout","unityReadyTimer","unityReadyTimeout","onUnityReady","addDesktopItem","removeDesktopItem","addLoadingPlaceholder","removeLoadingPlaceholder","addAttentionRequired","removeAttentionRequired","changeFocusedSession","onSessionRemoved","currentFocusWmksKey","createNew","newApplication","focusedItem","isCollapsed","instances","orderedInstances","isFocusedItem","getAppAttr","currentApp","appIndex","windowTitle","applicationIdKey","isFocused","newItem","applicationItem","windowType","isTransparent","isToolWindow","isMinimized","removed","currentItem","itemIndex","orderedItemIndex","visibleChanged","isFromVisibleMap","isChanged","runningItem","ignoreUnity","isUnityRunning","runningItemKey","newDesktopItem","desktopItemIndex","currentDesktopItem","newSessionInstance","currentSessionInstance","newSessionItem","sessionItem","runningApplicationKey","hasApps","RUNNING_ITEMS","getRunningItems","getInternalState","SIDEBAR","UNITY_SERVICE","FT_CONTROLLER","FT_HELPER","PRINT_HELPER","_initStatus","sidebar","fileTransferController","fileTransferHelper","printHelper","listenersReady","moduleName","_checkInitStatus","multimonService","sendFileDownloadRequest","readAndSendFileChunks","stopFileDownload","stopFileUpload","isFileTransferringForAllSession","isFileTransferringInSession","isFileTransferringInCurrentSession","isFileDownloadingInSession","isPrintFileTransferringForAllSession","isPrintFileTransferringInSession","isPrintFileTransferringInCurrentSession","handleClipboardFailure","handleFileTransferFailure","readSessionData","sessionData","handleSessionData","handleUserActivity","stopTimer","userActivityTime","setIdleTimeoutWarning","closeOnExit","pageFlowAfterDisconnect","handleResize","handleTouchResize","handleTouchStart","readRunningSession","writeRunningSession","sortRunningSession","executeRunningSession","connectToServer","sendCtrlAltDel","sendEsc","launchKeyboard","sessionIdleTimeout","idleWarningTimeBeforeDisconnect","idleWarningTimer","sessionTimedOut","isHighResModeSupported","toggleHighResMode","isHighResModeEnabled","toggleMP4","toggleUseMacOSXKeyMappings","areMacOSXKeyMappingsSupported","areMacOSXKeyMappingsEnabled","toggleWindowsKey","isWindowsKeyEnabled","applyInitialHighResSetting","applyInitialHighResSettingCallback","getCurrentMKSVchanClient","pushClipboard","hasMultimonCapacity","addMonitor","quitMultimon","destroyMultimon","whenNotInMultimon","enterMultimon","disconnectEventConnections","recoveryEventConnections","connectToDesktop","changeWmksSession","activateWmksSession","connectToApplication","connectToAllApplications","allAppsReconnected","wmksSessionMap","currentWmksSession","currentActiveSessionKey","isCurrentSession","isCurrentSessionApp","isCurrentSessionDesktop","isCurrentSessionHasDPIChannelInited","getCurrentSessionDPI","updateEmptySession","prepareForSessionReset","sessionResetDone","globalClipboard","shadowAllHeartbeatWhenSafariHidden","recoverAllHeartbeatWhenSafariVisible","shouldPassKeyboard","isContentEditable","hidden","trigger","isHighResolutionSupported","focusedSession","runningSessions","tempArray","runningSession","currentSession","sessionParams","user","referer","rebrand","desktopInfo","userInfo","webSocketUrl","focusedSessionKey","sessionList","timeoutHandler","canReuseSession","addSession","activeSessionKey","isNewSession","sessionIdleTimeoutMS","timeElapsedMS","warningTimeMS","wmksInstance","getMultimonSession","uiCallback","closeSidebar","enableH264","switchToSingleMon","processingFunction","enterMultimonMode","isTransferringFileWithNoDialog","fileChunks","fileReader","FileReader","chunkBlob","readerOnload","readerOnerror","fileChunk","fileRef","currentChunkSize","evt","uint8Array","readAsArrayBuffer","appSession","resetWmksKey","wmksKeys","wasCurrentSession","deletedWmksKey","deletedItemIsApplication","FTDownloadService","fileTransferService","downloadFileNum","totalFileSize","unusedFileList","baseService","openErrorDialog","verifyTotalSize","newSize","getTotalFileSizeForList","getDownloadFileNum","downloadedFileNum","getAlreadyDownloadedFileNum","isTransferring","transferProgess","onTransferFinish","getPathAndUUIDFromIdentifier","tryStopUnusedFileDownload","tryAddUnknownFileToList","stopUnusedFile","FTUploadService","isAdded","func","fileTransferPanel","fileTransferInput","fileDrop","fileChange","minHeight","minWidth","resizeFileContent","disableFTPanel","showFileTransferPanel","showFileDownload","showFileUpload","uploadFiles","clipboardToServer","clipboardToClient","selectFile","uploadHandler","beginUpload","PANEL_TAB","DOWNLOAD","UPLOAD","errorDialog","switchFileTab","toggleFileTransferPanel","closePanel","ftPanelFocus","ftPanelBlur","openFileTransferHelp","clearDownloadList","isTransferringFile","removeDownloadFile","clearUploadList","clearFileInput","files","dataTransfer","queued","checkFileNameLength","checkIllegalCharater","$apply","chooseUploadFiles","click","uploadReady","saveFile","inputEle","wrap","closest","get","unwrap","adjustFileTransferPolicy","updateMKSvchanClient","MAX_LENGTH","errorDgName","checkFileSize","res","checkFolderExist","checkSymlinkExist","NUMBER_OF_CHUNK_SEND_ONE_TIME","currentNumChunkSendOneTime","chunkSendNum","queueFileChunks","fileChunkNum","configChunkSize","removeFileChunksFromQueue","sendNextFileChunks","chunks","chunk","checkFileValid","onValidDone","fileTester","fileIndex","currentFile","reader","oneByteBlob","checkUploadStatus","extendedMonitorService","getTranslateMap","translationMap","statusMap","opened","readyToDisplay","displaying","confirmedQuit","onMouseButton","isDownEvent","bmask","onMouseMove","onMouseWheel","dx","dy","onKeyEvent","onBlur","ExtendedMonitor","canRender","sendMessage","uid","extendedWindow","setStatus","onStatusChanged","initPage","sendUnmaximizableRegion","regions","unmaximizableRegions","onPostMessage","onRegionUpdated","region","renderingIndeces","onRenderingDone","containingMonitor","updateUnmaxizableRegions","allUsedRegions","assign","startDisplay","screenBase","screenModel","sizeFactor","vncRects","currentFrameId","frameWaitTimer","frameWaitTime","appendChange","frameId","sendDisplayChange","onDisplayChanged","renderingIndex","skipRelease","onCursorChanged","cursorAddress","removeEventListener","showDisplay","hideDisplay","monitorManageService","multimonModel","canvasBuffer","canvasContainer","getElementById","quitConfirmDialog","renderingList","renderingCallback","monitorBounds","caches","_cacheInited","_isDisplaying","_isH264Enabled","_activeBackground","cursorObserver","MutationObserver","mutations","mutationRecord","setMonitorBounds","baseX","monitorSettings","baseY","forEachSettings","clearRenderStatus","monitorIndex","frameIndex","monitors","isOutsideBound","bound","shouldDispatch","rectWidth","rectHeight","initImageBuffer","style","sessionContainer","backgroundCanvas","backgroundVideo","clearImageBuffer","switchDelay","switchToMultiMonitor","onQuitMultimon","onEnterMultimon","onSingleMonitor","onMultiMonitor","onTopologyChanged","onMonitorChanged","primaryMonitor","switchToSingleMonitor","onLocationChanged","quitMultimonMode","$off","startSpyCursor","observe","attributeFilter","stopSpyCursor","disconnect","usingMultimon","disable","keepInMultimon","updateSettings","onPrimaryMonitorQuit","cancelAsDefault","alreadyEnter","enable","screenModels","getSetting","setScreenBase","onDPISettingChanged","readyToEnterMultimon","isNotEmpty","getMonitorInfo","monitorInfo","ready","monitorCount","stillUpdating","renderingNext","MAX_SAFE_INTEGER","_hideDisplay","entries","_showDisplay","prepareTimeEstimation","rectStream","appendData","onError","dispatchCount","h264Stream","onDecodeComplete","onDecodeMP4Error","primaryMonitorService","idCounter","extendedMonitor","minX","NaN","minY","processFunction","onInit","onSuccess","streamId","onData","onRectData","onQuitUICallback","sendTopologyRequest","allReady","switchToMultimon","topologySettings","requestedWidth","requestedHeight","primaryCanvas","canvasContent","conflictEventTime","browserSizeFactor","buttonStatus","factor","createPrimaryCanvas","canvasContainner","appendChild","oncontextmenu","onMouseDown","onMouseUp","onKeyUp","onKeyPress","isPrimaryCanvasEvent","srcElement","button","wheelDeltaX","wheelDeltaY","destroyPrimaryCanvas","removeChild","startRegionDetector","lastRegion","detectRegionChange","stillUpdate","currentRegion","availHeight","availWidth","detectTimer","stopRegionDetector","allRegions","cursor","onConflictEvent","onQuit","mayHasConflict","conflictTime","multimonSettingWindowController","addButtonEnabled","hasConflictedDetector","startConfiguring","hasTooLargeMonitor","verticalMonitorNumber","maxMonitorNumber","rectanglesCoincide","rectA","rectB","rectanglesShareArea","minAx","minAy","maxAx","maxAy","minBx","minBy","maxBx","maxBy","aLeftOfB","aRightOfB","aAboveB","aBelowB","hasConflict","targetKey","targetRect","comparedRect","getPreviewSettings","maxWidth","maxHeight","baseOffset","currentRect","visibleScaleFactor","canvasSize","overallWidth","overallHeight","scaleFactor","rects","overallRect","maxX","maxY","conflicted","canvasOffset","InRange","rectanglesAdjacent","tolerentY","minAxInBx","maxAxInBx","minAyInBy","maxAyInBy","minBxInAx","maxBxInAx","minByInAy","maxByInAy","someAxInBx","someAyInBy","someBxInAx","someByInAy","axEqualBx","ayEqualBy","xShareRange","yShareRange","hasNonAdjacentRect","k1","k2","rect1","rect2","hasAdjacent","isTooLargeMonitor","checkTooLargeMonitor","agentScale","devideFactor","updatePreview","previewSettings","previewCanvas","previewContext","rectNumber","hasNonAdjacentMonitors","beginPath","fill","lineWidth","strokeStyle","stroke","setMultimonStarted","collapseSidebar","showErrorMessage","contentKey","massageParam","startMultimon","closeThisDialog","multimonCancelClicked","multimonOkClicked","initPreview","initialContent","reAuthChangePasswordCtrl","renderData","oldpassword","credential","loadingAllow","ngDialogData","newpassword","newpasswordRepeat","form","$valid","keyPress","reAuthCtrl","isPhone","userNameReadOnly","loginCallback","MAX_ERROR","maxLogin","login","backContent","unityMgrMap","unityFeatures","handleWindowAdded","handleWindowRemove","handleTitleChanged","handleAttrChanged","handleTypeChanged","handleIconChanged","handleActiveChanged","handleCapsChanged","handleReadyChanged","handleVisibilityChanged","initEventsListener","removeEventsListener","getIconDataHelper","destroyUnityMgr","unityMgr","iconSizeSets","iconSize","isAdd","active","helper","closeWindows","toggleWindow","unityWindow","execInfoHash","routeConfig","$routeProvider","when","reloadOnSearch","AudioCapture","clipBuffer","ClipBuffer","clipTarget","clipBufferLen","previousSampleRate","bufferLen","machineSampleRate","statusEnum","Uninited","Inited","Working","getStatus","audioParam","syncTimer","devError","resampler","Resampler","scriptNode","mediaCtx","mediaStreamSource","audioContext","losingDevice","deviceUnpluged","localStream","numChannelsIn","numChannelsOut","lastValidTime","freezeCount","createMediaStreamSource","createScriptProcessor","onaudioprocess","clip","capturedData","resampledBuff","updateActiveStatus","inputBuffer","getChannelData","process","getClip","freezeTolerence","emitDeviceStatusChanged","buffsize","buff","Uint16Array","tailIndex","lastTimeStamp","newTimeStamp","convertToShort","floatNum","maxShortValue","timeStamp","getExtendedIndex","srcIndex","minIndex","resultLength","sampleExtenedIndex","newExtenedIndex","lastIndex","addup","originalRate","targetRate","inputSize","sampleIndexInc","buffSize","sampleStartIndex","getResampledData","endIndex","is","ie","ws","we","sum","isInRange","isInCorrectOrder","sampleIndexStart","sampleIndexEnd","validSubRange","deleteUsed","getResampledArray","resampled","DeviceMessageManager","unprocessedMessageQueues","actionMap","actionIDMap","permissionDialogPending","localMessageController","nextTargetDeviceInfo","actionNames","messageWaitManager","video","none","deviceMessageManager","MessageWaitManager","getFinalAction","queue","clearQueue","pushUnprocessedMessage","processMessage","enableAudioIn","disableAudioIn","enableVideoIn","disableVideoIn","processAction","isPermissionPending","onMessage","processWhenHaveResources","canProcess","precessHoldMessage","needReinit","pendingDeviceType","pendingMessageType","finalAction","restartStream","onPermissionHandled","onPermissionAsked","uiDialogCallback","setDialogFunction","dialogFunction","showDialog","okCallback","cancelCallback","FrameRateController","lastCaptureTime","targetInterval","fpsLogTime","fpsInfo","setFPS","fps","getNow","getWaitTime","passedTime","updateRealFPS","difftime","onFrameCaptured","MediaCapture","supportHTML5Audio","MediaStream","mozAudioContext","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","mediaDevices","webkitMediaStream","getAudioTracks","track","getVideoTracks","SyncTimer","audioCapture","videoCapture","VideoCapture","streamStarted","resourcesHold","disableAll","stopCapturing","openDone","deviceMessageController","deviceRequest","successCallback","errorCallback","startStream","deviceParam","audioCallback","videoCallback","sample","MediaEncoder","LimitedSet","workers","headers","resourcesCount","encodingEnvs","encoderStatus","messageManager","resetEncoder","initInstance","arrayCopy","setMergedHeader","handleMessage","handleAudioMessage","handleVideoMessage","clearWorker","capacity","occupied","Boolean","valueOf","insert","fetch","merged","beingUsed","Worker","srcPtr","dstPtr","srcArray","dstArray","streamHeaderLength","videoHeaderLength","audioHeaderLength","mergedLength","mergedHeaderBuffer","env","envId","metaData","others","videoParam","headerCallback","videoWorker","audioWorker","encodeAudio","encodeVideo","fetchCachedHeader","utTestingAPIs","notInUse","setMessageManager","manager","previousActions","actionQueue","actionWaitMap","defaultWaitTime","maxRecordDuration","setMaxRecordDuration","updateBufferedActions","getWaitTimeForAction","getDefaultActionWaitTime","processQueue","onProcess","onWait","time","oldestRecoderTime","clipIndex","previousAction","alreadyWaitTime","actionWaitTime","waitInfo","nextAction","APIforUT","getPreviousActions","getActionQueue","getMaxRecordDuration","getWaitTimer","activeSessionID","resourcePool","initResourcesPool","deviceStatusChangeCallback","mediaSrc","mediaEnc","hasUsableResources","sessionID","occupyResources","releaseResources","forcibly","getWorkingSessionId","stealSession","userStopSession","rtavProtocolService","RtavSessionController","RtavSession","activeSession","removeSession","setDialogHandler","AVPluginState","STChannelClose","STChannelOpen","STOff","STOn","STPending_AIn","STEnabled_AIn","STEnabled_V","STEnabled_VAIn","STError","rtavTypes","PMsgGetConfig","PMsgSetConfig","PMsgGetCliSettings","PMsgSetCliSettings","PMsgStart_A","PMsgStart_A_Ack","PMsgStart_A_Ack_Err","PMsgStop_A","PMsgStop_A_Ack","PMsgStop_A_Ack_Err","PMsgStart_V","PMsgStart_V_Ack","PMsgStart_V_Ack_Err","PMsgStop_V","PMsgStop_V_Ack","PMsgStop_V_Ack_Err","PMsgStartStream","PMsgStopStream","PMsgBinData","getSendingBinary","parseRecievedMessage","codecTypes","CodecNone","CodecSpeex","CodecTheora","CodecTheoraSpeex","CodecVmwSpeex","CodecVmwTheora","CodecVmwTheoraSpeex","convertU32","n","reduce","b","getNetWork","uint32ToUint8","getRtavControlPacket32","extendZeros","getDevPrefsNet","streamlizersMap","array32","length8","buff8","Uint32Array","array8","dataArray","networkBytes","headerLength","typeCode","localConfig","audioSettings","videoSettings","audioPrefs","videoPrefs","audioInDevPrefsNet","videoCamDevPrefsNet","audFrameUnitLenMS","audFrameUnitCount","queueLen","bitsPerSample","channels","inputStreams","framesPerPacket","samplesPerSec","fWidth","fHeight","frameRate","tPauseMS","sendConfig","configArray","versionNum","vdoRes","vdoFPS","reserved","networkArray","sendStartAudioAck","sendStartAudioNak","sendStopAudioAck","sendStopAudioNak","sendStartVideoAck","codecPref","sendStartVideoNak","sendStopVideoAck","sendStopVideoNak","sendStream","messageData","streamData","streamHeader","dataCount","sendClientSettings","sendStopStream","getMessageStruct","parseStruct","parseAdminPolicy","rtavMessage","adminPolicy","parsedMessage","RtavChannel","rtavChannel","openChannel","onopen","setRecievedListener","RtavSettingManager","setLocalConfig","localWidth","localHeight","localMaxFPS","vdoDefResWidth","vdoMaxResWidth","defResWidth","vdoDefResHeight","vdoMaxResHeight","defResHeight","vdoMaxFPS","defMaxFPS","setAdminPolicy","getLocalConfig","getAudioDeviceSetting","getVideoDeviceSetting","RtavStatus","currentStatus","statusName","processAllowed","settingManager","deviceConfig","rtavMessageTypes","binaryData","stopMediaIn","startMediaIn","binaryStream","userStop","isSendingStream","sendingFunc","metaCacheA","metaCacheV","dataChannel","audioEnable","videoEnable","videoMissing","hasResources","massageManager","initDoneCallback","audioDataCallback","videoDataCallback","resetProperties","initResources","closeResources","setResources","sendingFunction","libHeader","isFackInit","resources","stolenSessionId","confirmDeviceSteal","cancelDeviceSteal","metaCount","onDoneCallback","encoderParam","whenHasResources","enableSuccess","missingDevice","processFunc","appendFunction","ArrayClass","typedArray","from","Int16Array","frameRateController","dataCallback","setAttribute","sessionCount","getNextFrame","imgData","getImageData","sessionMap","settingsWindowController","resetButtonEnabled","toggleDPISync","_toggleDPISync","toggleSwitches","_toggleMP4","isSupported","toggle","_resetResultCallback","resetApplications","showWarning","contextMenuManager","openedMenuId","closeCallback","bodySettingsMenuOpenedClickHandler","toggleMenu","menuId","openCallback","currentMenuId","closeMenu","runningItemsFilter","availableItemsFilter","SidebarController","sidebarDirective","output","instanceQueryFilter","queryInstances","matchedInstances","availableItems","onlyFavorites","SECURITY_SERVER_RESET_ERROR","PROTOCOL_ERROR","_searchElem","_touchDeviceRunner","showGlobalContextMenu","showItemContextMenu","showClipboardButton","contextMenuItem","queryText","showOnlyFavorites","arePrefsDirty","prefPromise","notAuthenticatedDialogOpen","idleTimeoutWarningDialog","multimonSettingWindow","showLaunchPanel","multimonOptionVisible","multimonStarted","toggleIsCollapsed","activateItem","_activateItem","selectedItem","activateWindow","_findEntitledItem","isIOSSafari","isAndroidChrome","updateMultimonMenuVisibility","isSupportedBrowser","isSupportedDevice","currentSessionIsDesktop","agentSupportMultimon","DPIConnectionReady","globalContextMenuClicked","contextMenuClicked","entitledDesktop","getBoundingClientRect","showLogOffDesktop","showResetDesktop","showRestartDesktop","ctrlAltDeleteClicked","escClicked","_sessionOpResultCallback","rawMessage","_confirmSessionOp","isTransferringPrintFile","showWarn","closeRunningApp","sortedInstances","instanceIds","localeCompare","_logOffDesktopCallback","_toggleShowPanel","panelElement","blur","_reviseAppPanelHeight","logOffDesktop","_resetDesktopCallback","isRunningDesktopExist","_restartDesktopCallback","settingsClicked","showWarningMessage","multimonClicked","enableHighResolution","exitMultimonClicked","ExitMultimonDialog","aboutClicked","toggleKeyboard","isSupportedMobileDevice","openClipboardClicked","openFileTransferPanel","_logoutCallback","logoutClicked","closeRunningInstance","instance","prefs","_notAuthenticatedCallback","keepConnected","_findRunningItemNameById","_confirmRTAVsessionSteal","stolenDesktopName","launchItem","_launchItem","timeoutID","serverNotRespondingDialog","canLogoff","isCopy","isPasted","enableShowOnlyFavorites","disableShowOnlyFavorites","toggleFavorite","started","isCurrentItemApp","appHasFocus","unityWindowHasFocused","resizeHandler","newMaxHeight","scrollHandler","handleDestroyEvent","prefsPromise","launchItem4HWS","itemIsApp","targetItem","transclude","verticalSliderDirective","startY","moving","moved","sidebarMouseMove","oldY","sidebarMouseUp","onClick","toggleClass","elementDragStyles","bodyDragStyles","onMove","CancelAuthenticationCommand","cancelAuthenticationAction","cancelAuthObject","CancelCurrentRequestCommand","cancelRequestAction","ConnectToApplicationCommand","getApplicationConnObject","saveOriginId","ConnectToBrokerCommand","unauthenticated","oneProtocol","submitAuthenticationObject","addClientInfoObject","ConnectToDesktopCommand","getDesktopConnObject","desktopPreferences","setPreferences","DisconnectSessionCommand","disconnectSessionAction","disconnectSessionObject","supportedAppProtocols","DoLockCommand","DoLockAction","DoUnlockCommand","DoUnlockAction","doUnlockObject","GetAuthenticationStatusCommand","GetAuthenticationStatusAction","GetDesktopsCommand","GetLaunchItemsCommand","GetTunnelConnectionCommand","getTunnelConnAction","GetUserGlobalPrefCommand","getGlbUserPrefObj","HandleURICommand","handleURIAction","operationType","InitRouterCommand","initRouterAction","jscdkRouter","KillSessionCommand","killSingleSession","sendGetLaunchItems","killAllApplicationSessionsObject","getLaunchItemsObjectNameHeader","LogoutBrokerCommand","logoutBrokerAction","needClearURI","ReconnectApplicationSessionsCommand","selectApplicationSessionAction","reconnectCtrl","presetInfo","getLaunchItemsHeader","ResetDesktopCommand","RestartDesktopCommand","RestartDesktopAction","RestartDesktopObject","RestartData","RollbackDesktopCommand","rollbackDesktopAction","rollbackDesktopObject","SetEnvironmentInfoCommand","SetEnvironmentInfoAction","SetLastUserActivityCommand","SetLastUserActivityAction","SetUserGlobalPrefCommand","setPrefAction","SetViewURICommand","setViewURIAction","queryString","SubmitAuthInfoCommand","setAuthAction","setReAuthFlag","setDesktopReAuthFlag","clearCreds","TimerCtrlCommand","timerCtrlAction","AddClientInfoHandler","addClientStatsListElements","addClientStatsList","clientStatsList","CertAuthHandler","acceptText","paramText","paramsText","ChangeWindowsPasswordHandler","oldPasswordText","newPassword1Text","newPassword2Text","DisclaimerHandler","authResponse","DoCancelAuthenticationHandler","cancelAuthResponse","cancelAuthAction","DisconnectSessionHandler","disconnectSessionResponse","DoSubmitAuthenticationHandler","authAction","reAuthFlag","credsHandler","isReAuth","desktopReAuthFlag","pin1","pin2","screenXML","partialError","isReadOnly","winCredsHandler","cachedDomainUsername","onAuthenticationDone","protocolsJson","doReAuthAction","DoUnlockHandler","unlockResponse","authTag","authScreenTag","FrontController","_commands","commandClass","getCommand","removeCommand","containCommand","GetApplicationConnectionHandler","BlastType","CURRENT","NEW","blastType","setPrefObject","isAppParamSupported","getParamElement","paramElements","commandLineElement","applicationIdElement","maximizedElement","samlElement","needConnectionText","launchArgs","showApplicationAction","applicationResolution","enableUsb","enableMmr","createAppBlastLaunchApplicationAction","applicationConnectionResponse","listeners","listenersNode","listenerNode","listener","agentResponseNode","agentResponse","protocolObj","launchUrl","encodeURI","GetApplicationSessionConnectionHandler","targetAppSessionId","setOriginId","applicationSessionId","applicationSessionIdElement","disconnectAllElement","getConvertedResponse","responseAction","responseObj","orgResponse","hasError","getErrorResponseBy","handleSelfDefinedError","errorResponse","handleSuccess","convertedResult","showApplicationSessionAction","applicationSessionResolution","createAppBlastLaunchApplicationSessionAction","applicationSessionConnectionResponse","GetDesktopConnectionHandler","desktopIdElement","showDesktopAction","desktopResolution","createAppBlastLaunchAction","desktopConnectionResponse","parseRedirectProperties","properties","property","attrName","textContent","KillAllApplicationSessionsCtrl","dealWithResponses","dataList","killAllApplicationSessionsAction","failIdList","getValidAndInvalidIdLists","applicationSessionIdList","invalidOriginIdList","valid","invalid","pushResetFailToUser","validAndInvalidIdLists","targetApplicationSessionId","infoCombiner","ReconnectAllApplicationSessionsCtrl","successList","pushReconnectSuccessToUser","failedSessionIdList","successSessionList","reconnectError","getAllValidAppSession","sessionOriginId","idList","originIdList","excludedId","getInvalidIdList","tergetIdList","invalidRequestedSessionIdList","targetId","targetSessionIdExist","pushReconnectFailToUser","successSessionContent","reconnectSuccessAction","getOriginIdList","invalidIdList","allValidAppSessionInfo","targetIds","targetOriginIds","targetOriginId","AppSessionReconnector","notExistingSessionIdList","RollbackCheckoutDesktopHandler","rollbackCheckoutDesktopResponse","logoutFromBrokerAction","SamlHandler","secretText","SecurIDNextTokenCodeHandler","tokenCode","tokenCodeText","SecurIDPasscodeHandler","passcode","usernameText","passcodeText","SecurIDPinChangeHandler","pin1Text","pin2Text","SecurIDWaitHandler","SetLocaleHandler","UnauthHandler","WinCredsHandler","domainText","passwordText","JSCDKError","Timer","timerTypeEnum","timerType","timerValue","timerId","eventCallbackFunc","targetTime","timerCreateFunction","milliSecends","timerStopFunction","getCurrentTime","restTime","newTimerValue","UserActiveTimeSyncCtrl","dealWithSSOTime","BlastDesktopCtrl","mainService","viewService","jscdkLauncherInvoker","containsAt","saveDesktopData","goBlastPage","initView","currentController","savedData","closeOnExitFlag","scrollTopDirective","viewAutofocusDirective","unstorablePasswordDirective","fallbackSrcDirective","progressCircleDirective","helpLinkDirective","downloadLinkdirective","highlightDirective","isHighlighted","animate","ctrl","setFocus","viewAutofocus","$observe","prop","postLink","iElement","iAttrs","ngSrc","fallbackSrc","utilService","showLink","getLinkByType","showHelpLink","highlight","headerDirective","HeaderCtrl","searchInput","showLogoutDialog","showAllStyle","showFavStyle","closeAboutDialog","showAll","showFavorites","showSetting","showHelp","enterKeypress","HomeWarningCtrl","browserCompatible","isCompatibleBrowser","canvasSupported","hasCanvasAndContext","helpLinkAddress","showCookieWarning","continueAllowed","isMobileBrowser","goNext","applicationSessionArray","isNumber","invokeTimerCtrl","sendInitTimerXML","onlyEnableIntervalTimer","logoffDesktopAction","restart","cancelAuthentication","stopTimerAction","goServerLanding","setURI","viewURIAction","brokerURL","retrieveLaunchItems","_findApplicationSession","applicationOriginId","isApplicationConnected","disconnectApplication","checkAuthenticationStatus","acceptDisclaimer","submitUnauthenticated","submitSecurIDNextTokenCode","submitSecurIDPasscode","submitSecurIDPinChange","submitSecurIDWait","$route","timeoutService","viewCtrlService","COMANAGEMENT_ERROR","TUNNEL_ERROR","bindUserActivity","connecting","isCurrentController","isNewAuthenticating","authenticationNameList","favoriteHandler","showError","getLastUserActivityTime","timeoutDialog","doLockDialog","initTimers","initIntervalTimer","isLaunchAction","doAction","currentApplication","focusElement","bufferedArgs","applicationCanSet","certAuth","updateClientConfig","supportLocalStorage","tearDown","switchView","getOKCallbackOnBrokerError","callbackParams","runFunctionIfNotHWSOrF5","currentDesktop","logOffConfirmation","tabSyncService","opener","uriInfo","localStorageObj","_readTimerFromCookieToConnectionServerModel","isWebKitBrowser","getQueryStringFromModel","getLargestIcon","iconsLength","largeFlag","callBackWhenUnlocked","callbackParameters","targetItemType","clearAction","popAction","Chrome","IE","Gecko","WebKit","isHidden","isVADC","storeClientConfig","equalToDirective","serverNameDirective","checkEquals","changedTagValue","currentTagValue","$viewValue","anotherTagValue","equalTo","$setValidity","$parsers","unshift","checkForProtocol","Start","WindowsPasswordExpired","SecurIDNextTokenCode","SecurIDPinChange","SecurIDWait","GetLaunchItems","ShowAppBlastDesktop","ShowAppBlastApplication","Warning","Portal","Logout","logoutToPortal","Brokers","SecurIDPasscode","gotoStart","WindowsPassword","Disclaimer","Unauthenticated","isAuthenticating","home","striphide","footer","protocolRegister","exit","sendLogoff","isExit","hideHeader","hideStrip","disabled","parentController","LaunchItemsCtrl","LaunchItemsCtrlService","storeUserInfo","writeTimerInfoFromConnectionServerModel2Cookie","storeInfoForBlastSideBar","objectSet","activeItem","EntitledItems","ClientInfo","ip","BrokerUrlInfo","renderLaunchItems","searchbar","favTip","unfavTip","showline","moveFocus","switchUserDialog","highlightItems","launchCurrentApplication","makeFavorite","showNoFavorites","noDesktopFav","noAppFavorites","itemTitle","keypressHandler","keyboardHandler","moveFocusUpRow","curr","above","moveFocusDownRow","bottom","moveFocusLeft","moveFocusRight","removeHighlight","clearTimer","isLaunchingItem","processURIAction4App","processURIAction4Desktop","logoffEnabled","resetEnabled","restartEnabled","storeLaunchingItemInfoForBlastSideBar","originID","handleURI","searchedItems","shouldClearPreviousAction","isIdentical","canContinuePreviousAction","handlePreviousAction","previousTargetItem","targetItemId","_logoffDesktop","logoffCallback","_resetDesktop","resetCallback","_restartDesktop","restartCallback","nextStepFlags","anonymousSelectDirective","ngModel","selectmenu","my","selectMenu","isExpand","ChangePasswordCtrl","DisclaimerCtrl","disclaimerText","domainSelectMenuDirective","LoginCtrl","WaitingCtrl","widgets","doCompatibilityCheckAndInitialize","ok","showWaiting","SecuridNextTokenCodeCtrl","challengeString","SecuridPasscodeCtrl","titleString","updateUsername","SecuridPinChangeCtrl","prompt","pin1Type","pin1ReadOnly","SecuridWaitCtrl","UnauthenticatedCtrl","_getDefaultUser","_renderData","_setDisplayName","currentUsername","_tryAutoConnect","displayName","_verifyUsername","usernameObj","_loginWithUsername","WindowsPasswordCtrl","isReauthentication","_checkUsername","checkSameUser","activeDownlist","_isUsernameAndDomainLegal","usernameChange","otherwise","redirectTo","LauncherSettingsWindowController","setUp","$dialog","showDefaultTimezone","saveTimezone","supportDPISync","isAutoTimezoneEnabled","mIsTouchDevice","toggleTimezone","defaultTimezone","change","applicationSession","showResetConfirmDialog","timezoneList","selectedIndex","onKeypress"],"mappings":"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C,EAHkD,CAGF;AACA;;AAEhD,OAAI,KAAKpjB,KAAL,KAAe,0BAAUJ,IAA7B,EAAmC;AAChC,UAAI,CAAC,CAAE,KAAKpR,OAAL,CAAa,cAAb,CAAH,IACD,KAAKA,OAAL,CAAa,cAAb,EAA6B,QAA7B,MAA2C,IAD9C,EACoD;AACjD,+BAAYiD,KAAZ,CAAkB,yBAAlB;;AAEA;AACAi5C,8BAAqB,EAAC91C,MAAM,cAAP,EAAuB6uB,QAAQ,IAA/B,EAArB;AACA,sCAAWpoB,KAAKC,SAAL,CAAeovC,kBAAf,CAAX;AACF;AACH;;AAED;AACA,oBAAOxvC,SAAP,CAAiB2L,eAAjB,CAAiC,IAAjC;AACF,CAnBD,C;;;;;;;AC3FA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,qBAAqB,YAAY;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA,cAAc,cAAc;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAS,YAAY;AACrB;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA,IAAI;;AAEJ;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,gCAAgC,kCAAkC;AAClE,gCAAgC,kCAAkC;AAClE,gCAAgC,iCAAiC;AACjE,gCAAgC,iCAAiC;AACjE,gCAAgC,kCAAkC;;AAElE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,8BAA8B,aAAa,EAAE;AAC7C,+BAA+B,cAAc;;AAE7C;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA,IAAI;AACJ,oEAAoE;AACpE;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0CAA0C;AAC1C,uBAAuB;AACvB;AACA,OAAO;AACP;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,wBAAwB;AACxB,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mCAAmC;AACnC,wBAAwB;;AAExB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC;;AAElC;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,yCAAyC;;AAEzC;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,IAAI;AACJ;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;;AAEJ;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,wCAAwC,iBAAiB;AACzD;AACA,aAAa;AACb,UAAU;AACV;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,yBAAyB,gCAAgC;AACzD;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;;AAEA;AACA,8BAA8B,GAAG;AACjC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,kCAAkC,4BAA4B;AAC9D,kCAAkC,2BAA2B;AAC7D,kCAAkC,4BAA4B;AAC9D,kCAAkC,iCAAiC;;AAEnE;AACA;AACA;AACA;AACA;;AAEA;AACA,6BAA6B,4BAA4B;AACzD,6BAA6B,uBAAuB;;AAEpD;AACA,wCAAwC,QAAQ;;AAEhD;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,oBAAoB,yBAAyB;AAC7C;AACA;AACA,OAAO;AACP;AACA;AACA,IAAI;;AAEJ;AACA;AACA;;AAEA,oBAAoB,yBAAyB;AAC7C;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;;AAGA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,6BAA6B;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B;;AAE1B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oBAAoB;AACpB,sBAAsB;;AAEtB;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA,IAAI;;AAEJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC,gCAAgC;AAChC,yCAAyC;AACzC,mCAAmC;AACnC,2CAA2C;AAC3C,+BAA+B;AAC/B,oCAAoC;AACpC,kDAAkD;AAClD,8CAA8C;AAC9C,mDAAmD;AACnD,wCAAwC;AACxC,iEAAiE;AACjE,qDAAqD;AACrD,8BAA8B;AAC9B,6CAA6C;AAC7C,qCAAqC;AACrC,+CAA+C;AAC/C,qDAAqD;AACrD;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,CAAC;;;;;;AAMD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;AAOA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc,kBAAkB;AAChC;AACA;AACA;AACA;;;;;;AAMA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,0CAA0C;AAC1C,qBAAqB;AACrB,mBAAmB;AACnB,+BAA+B;AAC/B,+BAA+B;AAC/B,wCAAwC;AACxC,mBAAmB;AACnB,mBAAmB;AACnB;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAgB;AAChB,iBAAiB;AACjB;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,0BAA0B;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc,sBAAsB;AACpC;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB,oBAAoB;AACpB,6BAA6B;AAC7B,mBAAmB;AACnB,uBAAuB;AACvB;AACA,IAAI;AACJ;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,oCAAoC;AACpC,2CAA2C;;AAE3C;AACA,uCAAuC;;AAEvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B;AAC1B,0BAA0B;;AAE1B;AACA;AACA,uBAAuB;AACvB;AACA,6BAA6B;AAC7B,6BAA6B;;AAE7B;AACA;AACA;;AAEA;AACA;;AAEA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAgB,QAAQ;AACxB,iBAAiB,OAAO;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,cAAc,OAAO;AACrB;AACA,iBAAiB,oBAAoB;AACrC;AACA;AACA;;AAEA,cAAc,OAAO;AACrB;AACA,iBAAiB,oBAAoB;AACrC;AACA;AACA;;AAEA,gCAAgC;AAChC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,sBAAsB;AACtB;AACA;AACA,sBAAsB;AACtB;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,iBAAiB,iBAAiB;AAClC,oBAAoB,gBAAgB;AACpC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,aAAa;AAClD;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,IAAI,kCAAkC;AACtC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,IAAI;AACJ;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAY,0BAA0B;AACtC;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA,+DAA+D;AAC/D;AACA;AACA;AACA;AACA,0CAA0C,WAAW;AACrD;AACA;AACA;AACA,UAAU;AACV,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gEAAgE,WAAW;AAC3E,OAAO;AACP;AACA;AACA;AACA,6CAA6C;AAC7C;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+CAA+C,mBAAmB;AAClE;AACA;;AAEA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,cAAc,6BAA6B;AAC3C;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,cAAc,6BAA6B;AAC3C;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,oBAAoB,8CAA8C;AAClE;AACA;AACA;;AAEA;AACA,IAAI;;;AAGJ;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,IAAI;;AAEJ;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,IAAI;AACJ;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;AAEA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA,iBAAiB,gBAAgB;AACjC;AACA;AACA;AACA;AACA,IAAI;AACJ,iBAAiB,gBAAgB;AACjC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;;;;;;AAMA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mBAAmB,0BAA0B;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB;AACnB,oBAAoB;AACpB,uBAAuB;AACvB;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,kBAAkB;AAClB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA,kDAAkD;AAClD,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AAMA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qCAAqC;AACrC,oBAAoB;AACpB;AACA;AACA,mBAAmB;AACnB;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sCAAsC;AACtC,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,0CAA0C;AAC1C,qBAAqB;AACrB,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,iBAAiB,YAAY;AAC7B;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,6CAA6C,WAAW;AACxD;AACA;AACA;AACA,aAAa;AACb,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mEAAmE,WAAW;AAC9E,UAAU;AACV;AACA;AACA,gDAAgD;AAChD;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;;AAIA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA,4BAA4B,iDAAiD;;AAE7E;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;;;AAGA,wCAAwC;AACxC,iCAAiC;;AAEjC;AACA;AACA;AACA,IAAI;;AAEJ;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,0DAA0D,QAAQ;AAClE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sDAAsD;;AAEtD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB;AACxB,yBAAyB;AACzB;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B,8BAA8B;AAC9B;AACA;AACA,aAAa;AACb;AACA;AACA,+BAA+B;AAC/B,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;;AAEA,iBAAiB,oCAAoC;AACrD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,iCAAiC;AAClD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B,gBAAgB;AAChB,+BAA+B;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;;AAEA;;AAEA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,gBAAgB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sCAAsC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,6CAA6C;AAC7C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;AAIA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,QAAQ;AACR,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,QAAQ;AACR;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,EAAE;AACrB,yBAAyB,IAAI;AAC7B,mCAAmC,UAAU;AAC7C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA,cAAc,kCAAkC;AAChD;AACA;AACA;AACA;AACA;;AAEA,cAAc,gCAAgC;AAC9C;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,IAAI;AACJ;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,aAAa;AACb;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,oCAAoC;;AAEpC;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kEAAkE;AAClE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,cAAc;AACd;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,UAAU;;AAEV;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB,0DAA0D;AAChF;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kEAAkE,gBAAgB;AAClF,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA2B,gCAAgC;AAC3D;AACA;AACA,OAAO;AACP;AACA,2BAA2B,+BAA+B;AAC1D;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA,OAAO;AACP;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,UAAU;AACV;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV,OAAO;AACP;AACA;AACA,UAAU;AACV;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mCAAmC,4BAA4B;AAC/D;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sCAAsC,4BAA4B;AAClE;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,8BAA8B;AAC9B;AACA,UAAU;AACV;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,8BAA8B;AAC9B;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,UAAU;AACV;AACA;AACA,UAAU;AACV;AACA;AACA,UAAU;AACV;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA,UAAU;;AAEV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,gCAAgC;AAChC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD;AAChD,wCAAwC,6BAA6B,EAAE;AACvE,wCAAwC,8BAA8B,EAAE;AACxE,wCAAwC,uCAAuC,EAAE;AACjF,wCAAwC,qCAAqC,EAAE;AAC/E,wCAAwC,mCAAmC,EAAE;AAC7E,wCAAwC,sCAAsC,EAAE;AAChF;;AAEA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;;;AAGJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA,cAAc;AACd,IAAI;;;AAGJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;;;AAGJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;;;AAGJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;;AAGJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;;AAGJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,OAAO;AACrD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,cAAc;AACd;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,WAAW;AACX;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,OAAO;AACrD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,cAAc;AACd;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA,WAAW;AACX;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,OAAO;AACrD;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B,UAAU;AACV;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,kBAAkB;AAC1C;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,yBAAyB,EAAE;;AAEpE;AACA,sCAAsC,wBAAwB,EAAE;;AAEhE;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,cAAc,EAAE;AAC7D;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,cAAc,qBAAqB;AACnC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,8BAA8B,QAAQ;AACtC;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iBAAiB,0BAA0B;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;;AAEA,IAAI;AACJ;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,2BAA2B,gBAAgB;AAC3C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,uCAAuC;AAChF,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,2CAA2C,+BAA+B;AAC1E,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gCAAgC;AAChC;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,oDAAoD;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,OAAO;;AAEP;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;;AAEV;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,CAAC,IAAI;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oBAAoB,6CAA6C;AACjE;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,OAAO;;AAEP;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA,UAAU;AACV;AACA;AACA,UAAU;;AAEV;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA,UAAU;;AAEV;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA,UAAU;AACV;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,4BAA4B,cAAc;AAC1C,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,4BAA4B,aAAa,GAAG,aAAa,GAAG,aAAa;AACzE,OAAO;AACP;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;;AAEA,CAAC;AACD;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,6BAA6B,KAAK,8BAA8B;AACxE;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB,WAAW,OAAO;AAClB,WAAW,uBAAuB;AAClC;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,uBAAuB;AAClC;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,WAAW,uBAAuB;AAClC,WAAW,uBAAuB;AAClC;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,WAAW,uBAAuB;AAClC;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,WAAW,uBAAuB;AAClC;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,WAAW;AACvB;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY,YAAY;AACxB;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;AAEA,cAAc,kBAAkB;AAChC;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,WAAW;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,YAAY;AACxB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,WAAW;AACvB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA,8CAA8C,eAAe;AAC7D;AACA,UAAU;AACV;AACA;AACA;AACA;AACA,GAAG,+BAA+B;AAClC,GAAG,+BAA+B;AAClC;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,UAAU;AACtB,YAAY,YAAY;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,WAAW;AACvB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,4BAA4B;AACxC,YAAY,OAAO;AACnB,YAAY,aAAa;AACzB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,cAAc,6BAA6B;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,YAAY;AACxB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,aAAa;AACzB;AACA;AACA;AACA;;AAEA,cAAc,4BAA4B;AAC1C;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,WAAW;AACvB,YAAY,cAAc;AAC1B;AACA;AACA;AACA;;AAEA,cAAc,4BAA4B;AAC1C;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,UAAU;AACtB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,6BAA6B;AACrC;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,WAAW,WAAW;AACtB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,uBAAuB;AACnC,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,WAAW,MAAM;AACjB;;;AAGA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB;;;AAGA;AACA;AACA;AACA;AACA,WAAW,MAAM;AACjB;;;AAGA;AACA;AACA;AACA;AACA,WAAW,aAAa;AACxB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW,WAAW;AACtB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;;AAGA;AACA;AACA,aAAa;AACb;AACA;;;AAGA;AACA;AACA,aAAa;AACb;AACA;AACA;;;AAGA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,YAAY;AACxB;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,iBAAiB,8BAA8B;AAC/C;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,WAAW;AACvB,YAAY,WAAW;AACvB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,wBAAwB;AACxB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,WAAW;AACvB,YAAY,qBAAqB;AACjC,YAAY,WAAW;AACvB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,WAAW;AACvB,YAAY,sBAAsB;AAClC,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,WAAW;AACvB,YAAY,sBAAsB;AAClC,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,aAAa;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,8BAA8B;AAChD;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB,WAAW,OAAO;AAClB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAU;AACV;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,8BAA8B,yCAAyC;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ,qBAAqB,wBAAwB;AAC7C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,YAAY;AACxB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,YAAY;AACxB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,YAAY;AACxB,YAAY,mBAAmB;AAC/B,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,YAAY;AACxB,YAAY,OAAO;AACnB,YAAY,kBAAkB;AAC9B,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,YAAY;AACxB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY;AACZ;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,QAAQ,yBAAyB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,IAAI;AAChB,YAAY,4BAA4B;AACxC,YAAY,OAAO;AACnB,YAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB;;;AAGA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB,WAAW,WAAW;AACtB;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW,WAAW;AACtB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,sBAAsB;AAC9B;AACA;AACA;AACA;AACA;AACA,WAAW,IAAI;AACf,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,WAAW;AACvB,YAAY,YAAY;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,WAAW;AACvB,YAAY,OAAO;AACnB,YAAY,WAAW;AACvB,YAAY,YAAY;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,WAAW;AACvB,YAAY,WAAW;AACvB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,YAAY,WAAW;AACvB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,UAAU;AACtB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,sBAAsB;AACtB;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,WAAW;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,YAAY;AACxB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA,cAAc,2BAA2B;AACzC;;AAEA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,cAAc,sBAAsB;AACpC;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB;AACA;AACA;AACA;;AAEA;;AAEA,cAAc,sBAAsB;AACpC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB,WAAW,qBAAqB;AAChC,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD,oBAAoB;AACvE;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,sDAAsD,aAAa;AACnE;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB,WAAW,sBAAsB;AACjC;AACA;AACA;AACA;;AAEA;AACA,kBAAkB;;AAElB;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,IAAI;AACJ,kBAAkB;AAClB;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,aAAa;AACzB,YAAY,YAAY;AACxB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,cAAc,oBAAoB;AAClC;AACA;;AAEA;AACA;AACA;;AAEA,cAAc,oBAAoB;AAClC;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,0BAA0B;AACtC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,WAAW;AACvB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,WAAW;AACvB,YAAY,uBAAuB;AACnC,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,kBAAkB;AAC9B,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,WAAW;AACvB,YAAY,kBAAkB;AAC9B,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,WAAW;AACvB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,MAAM;AACjB;;;AAGA;AACA;AACA;AACA,WAAW,MAAM;AACjB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,oCAAoC;;AAEpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA,UAAU;AACV;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mCAAmC,4BAA4B;AAC/D;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oEAAoE,wBAAwB;AAC5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oBAAoB,6CAA6C;AACjE;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,OAAO;;AAEP;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA,UAAU;AACV;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B,cAAc;AAC1C;;AAEA;AACA;AACA;AACA;AACA,4BAA4B,aAAa,GAAG,aAAa,GAAG,aAAa;AACzE;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,oBAAoB;AACpB;;AAEA;AACA;AACA;AACA,4BAA4B;AAC5B,aAAa;AACb,4BAA4B;AAC5B,aAAa;AACb,4BAA4B;AAC5B;AACA,UAAU;AACV;AACA;AACA,4BAA4B;AAC5B,aAAa;AACb,4BAA4B;AAC5B,aAAa;AACb,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,CAAC;AACD;AACA,CAAC;;;AAGD;AACA;AACA,CAAC,e;;;;;;;;;;;;;AC3xlBD;;;;AAIA;;;;;;;;;AAUA,IAAIrV,MAAO,YAAW;AACnB,OAAIm5C,WAAW,SAAXA,QAAW,GAAW,CACtB,CADJ;AAAA,OAEGpzC,MAAM,EAFT;AAAA,OAGGqzC,SAAS,CAAC,OAAD,EAAU,OAAV,EAAmB,MAAnB,EAA2B,MAA3B,EAAmC,OAAnC,CAHZ;;AAMArzC,OAAI1G,WAAJ,GAAkB,CAAlB;AACA0G,OAAIzG,WAAJ,GAAkB,CAAlB;AACAyG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","file":"app-htmlaccess.cc050c0b31e6616b259f.js","sourcesContent":["/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * jscdkLogger.js --\n *\n *      Log class for the web client.\n */\n\nimport $ from 'jquery';\n\n\n/**\n * get caller details, such as caller function name, line num, file name\n *\n * @return Object detail JSON\n */\nfunction getCallerDetail() {\n   // now support Firefox 3.5 or higher, IE 8 or higher, Chrome 3 or higher,\n   // Safari 5.0 or higher IE before version 10 and Safari don't support\n   // Error.stack, so no caller detail will be showed\n   let callerDetail = {}; // caller detail JSON to return\n   let err, callerLine, index, content, str, callStack, callerIndex;\n   let functionName = \"\", fileName = \"\", lineNum = \"\";\n   let fileNameAndLineNumStr, fileNameAndLineNumArray;\n   let objFuncRegExp, funcRegExp, lineNumRegExp;\n\n   // throw error to get caller details\n   try {\n      throw new Error('');\n   } catch (error) {\n      err = error;\n   }\n\n   if (!err || !err.stack) {\n      return callerDetail;\n   }\n\n   try {\n      if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {\n         // the index of line containing caller's detail is 3\n         callerLine = err.stack.split('\\n')[3];\n         fileNameAndLineNumStr = $.trim(\n            callerLine.substring(callerLine.lastIndexOf('/') + 1,\n               callerLine.length));\n         fileNameAndLineNumArray = fileNameAndLineNumStr.split(\":\");\n         // the array only has two elements\n         fileName = fileNameAndLineNumArray[0];\n         lineNum = fileNameAndLineNumArray[1];\n         // there is no function name in error stack other than some function\n         // related data, so put empty string to it\n         functionName = \"\";\n      } else {\n         /**\n          * For error stack information is used here, details of direct\n          * caller of JSCDKLogger are on the line with index 4 or 5,\n          * depending on the browser.\n          */\n         callStack = err.stack.split('\\n');\n         if (callStack.length < 2) {\n            return callerDetail;\n         }\n         callerIndex = 3; // set default value\n         const ua = window.navigator.userAgent.toLowerCase();\n         let isIE = ua.indexOf('msie') !== -1 ||\n            ua.indexOf('trident') !== -1 ||\n            ua.indexOf('edge') !== -1;\n         if (navigator.userAgent.toLowerCase().indexOf('AppleWebKit') > -1) {\n            // Chrome puts Error in the callstack, however, error stack on\n            // chrome may contains \"at Error...\" in the second line or not,\n            // so add a branch to determine callerIndex\n            if (callStack[1].indexOf(\"at Error\") !== -1) {\n               callerIndex = 5;\n            } else {\n               callerIndex = 4;\n            }\n         } else if (isIE) {\n            // old-version IE except IE10 don't support Error.stack, so this\n            // branch will not be entered by them IE10 doesn't put Error in\n            // the callstack, so we look at index 4.\n            callerIndex = 4;\n         }\n         if (callStack.length <= callerIndex) {\n            return callerDetail;\n         }\n         callerLine = callStack[callerIndex];\n         index = callerLine.indexOf('at ');\n         // 3 represents the length of 'at '\n         content = callerLine.slice(index + 3, callerLine.length);\n\n         objFuncRegExp = /Object\\.(.*?)\\(/; // regexp to handle function in\n                                            // Object\n         funcRegExp = /(.*?)\\(/; // regexp to handle normal function\n\n         // get function name\n         str = objFuncRegExp.exec(content);\n         // handle functions in object and normal functions below\n         functionName =\n            $.trim((str ? str[1] : funcRegExp.exec(content)[1])) + \"()\";\n\n         // get line number\n         lineNumRegExp = /(.*?):(.*?):(.*?):/;\n         // 3 represents index of lineNum in results which match this regular\n         // expression\n         lineNum = $.trim(lineNumRegExp.exec(content)[3]);\n\n         // get file name\n         // 2 represents index of string which contains file name to be\n         // parsed\n         str = lineNumRegExp.exec(content)[2];\n         fileName =\n            $.trim(str.substring(str.lastIndexOf('/') + 1, str.length));\n      }\n   } catch (e) {\n   }\n\n\n   callerDetail.functionName = functionName;\n   callerDetail.fileName = fileName;\n   callerDetail.lineNum = lineNum;\n\n   return callerDetail;\n}\n\n\n/**\n * Helper function used to create a string with a desired length by padding\n * it with preceding zeroes, if necessary.\n *   pad(1, 5) will return \"00001\".\n *   pad(\"100\", 1) will return \"100\".\n *   pad(-1, 5) will return \"-00001\".\n *   pad(\"-10\", 4) will return \"-0010\".\n *\n * @param value[in] value that will be padded, if necessary.\n * @param maxLen[in] length that will be used to pad zeroes, if necessary.\n * @return string padded to appropriate length.\n */\nfunction pad(value, maxLen) {\n   const string = value.toString(),\n      negative = (string.indexOf(\"-\") === 0),\n      length = negative ? string.length - 1 : string.length;\n   return length < maxLen ? pad(negative ? \"-0\" + string.slice(1)\n         : \"0\" + string, maxLen)\n      : string;\n}\n\n\nconst JSCDKLogger = {\n   LEVEL_TRACE: 0,\n   LEVEL_DEBUG: 1,\n   LEVEL_INFO: 2,\n   LEVEL_WARNING: 3,\n   LEVEL_ERROR: 4,\n\n   LEVEL_DESC: [\"Trace\", \"Debug\", \"Info\", \"Warning\", \"Error\"],\n\n   // Default log level is set to DEBUG.\n   LOG_LEVEL: 1,\n\n   logAppender: null,\n\n   logFunction: null,\n\n   trace: function(args) {\n      this.log(args, this.LEVEL_TRACE);\n   },\n   debug: function(args) {\n      this.log(args, this.LEVEL_DEBUG);\n   },\n   info: function(args) {\n      this.log(args, this.LEVEL_INFO);\n   },\n   warning: function(args) {\n      this.log(args, this.LEVEL_WARNING);\n   },\n   error: function(args) {\n      this.log(args, this.LEVEL_ERROR);\n   },\n\n   log: function(args, level) {\n      let logTime,\n         logString,\n         callerDetail = {},\n         functionName,\n         fileName,\n         lineNum;\n\n      if (level >= this.LOG_LEVEL) {\n         if (args) {\n            logTime = new Date();\n            callerDetail = getCallerDetail();\n            functionName =\n               !!callerDetail.functionName ? callerDetail.functionName : \"\";\n            fileName = !!callerDetail.fileName ? callerDetail.fileName : \"\";\n            lineNum = !!callerDetail.lineNum ? callerDetail.lineNum : \"\";\n            logString = \"[\" + logTime.getFullYear() + \"-\" +\n               pad(logTime.getMonth() + 1, 2) + \"-\" +\n               pad(logTime.getDate(), 2) + \"T\" +\n               pad(logTime.getHours(), 2) + \":\" + pad(logTime.getMinutes(), 2) +\n               \":\" +\n               pad(logTime.getSeconds(), 2) + \".\" +\n               pad(logTime.getMilliseconds(), 3) +\n               \"][\" + this.LEVEL_DESC[level] + \"]\";\n            if (!((functionName === \"\") && (fileName === \"\") &&\n               (lineNum === \"\"))) {\n               logString +=\n                  \"[\" + functionName + \" \" + fileName + \":\" + lineNum + \"]\";\n            }\n            logString += \": \" + args;\n         }\n\n         if (this.logAppender) {\n            $(this.logAppender).append(logString + \"<br />\");\n         }\n         if (typeof(this.logFunction) === \"function\") {\n            this.logFunction(logString);\n         }\n         if (!!window.console && (typeof window.console.log === \"function\")) {\n            window.console.log(logString);\n         }\n      }\n   },\n\n   /**\n    * Set the log level.\n    *\n    * @param logLevel [in] the log level of the application.\n    */\n   setLogLevel: function(logLevel) {\n      this.LOG_LEVEL = logLevel;\n   },\n\n   /**\n    * Set the log appender.\n    *\n    * @param logAppender [in] a div object to show the logs.\n    */\n   setLogAppender: function(logAppender) {\n      this.logAppender = logAppender;\n   },\n\n   /**\n    * Set the custom log function.\n    *\n    * @param logFn [in] a function used to log.\n    */\n   setLogFunction: function(logFn) {\n      this.logFunction = logFn;\n   }\n};\n\nexport default JSCDKLogger;\n\n\n// WEBPACK FOOTER //\n// ./jscdk/jscdkLogger.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * jscdkClient.js --\n *\n *      Interfaces between UI and JSCDK.\n */\n\nimport $ from 'jquery';\nimport JSCDKClientController from './controllers/jscdkClientController';\nimport util from './util';\n\nexport let globalArray = {\n   // set 6.0 as the API version of supporting setClientInfo\n   clientInfoAPIVersion: \"6.0\",\n\n   // set 9.0 as the API version of supporting getLaunchItems and idle timeout\n   applicationAPIVersion: \"9.0\",\n   applicationParamVersion: \"12.0\",\n   /* set >=6.0  to support clientInfo,\n    *     >=7.0  to support SAML,\n    *     >=9.0  to further support applications and idle timeout,\n    *     >=10.0 to support disconnect session,\n    *     >=12.0 to support RDSH application launching params,\n    *     >=13.0 to support restart desktop,\n    * this value will be rewrite according to response of XML\n    */\n   brokerVersion: \"13.0\",\n   // whether broker is set to ws1 mode\n   ws1Mode: false,\n   workspaceOneServerHostname: ''\n};\n\n\n/**\n * Set the UI controller to JSCDK library to let UI response to JSCDK's\n * events.\n *\n * @param controller [in] the main UI controller.\n */\nexport function jscdkClientSetUIController(controller) {\n   // if (!globalArray[\"uiController\"]) {\n   globalArray[\"uiController\"] = controller;\n   //    JSCDKLogger.debug(\"UI Controller is set to JSCDK.\");\n   // } else {\n   //    JSCDKLogger.warning(\"UI Controller has already been set.\");\n   // }\n}\n\n\n/**\n * Interface from UI to JSCDK.\n *\n * @param action [in] a JSON string describes the action content.\n */\nexport function UIEventToJSCDK(action) {\n   let actionArray = $.parseJSON(action);\n   JSCDKClientController.getInstance().execute(actionArray);\n}\n\n\n/**\n * Interface from JSCDK to UI.\n *\n * @param action [in] a JSON string describes the action content.\n */\nexport function JSCDKSetUI(action) {\n   let mainUIController = util.getObject(globalArray, \"uiController\");\n   if (mainUIController) {\n      mainUIController.responseToJSCDKEvent(action);\n   }\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/jscdkClient.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * util.js --\n *\n *      common functions used in jscdk\n *      may replace the current utils.js in the future\n */\n\nimport JSCDKLogger from './jscdkLogger.js';\nimport $ from 'jquery';\nimport {globalArray} from './jscdkClient';\n\n/*global XMLSerializer, chrome, document */\n\n\nconst util = {\n   /**\n    * check whether broker version support application and idel timeout\n    *\n    * @return bool satisfied\n    */\n   brokerSupportApplication: function() {\n      if (!!globalArray[\"brokerVersion\"] &&\n         !!globalArray[\"applicationAPIVersion\"] &&\n         parseFloat(globalArray[\"brokerVersion\"]) >=\n         parseFloat(globalArray[\"applicationAPIVersion\"])\n      ) {\n         return true;\n      }\n      return false;\n   },\n\n   /**\n    * check whether broker version support restart desktop.\n    * this was supported from broker 13.0\n    * @return bool satisfied\n    */\n   brokerSupportRestartDesktop: function() {\n      if (!!globalArray[\"brokerVersion\"] &&\n         parseFloat(globalArray[\"brokerVersion\"]) > 12) {\n         return true;\n      }\n      return false;\n   },\n\n   /**\n    * find the first element in the given list that contains the given property\n    *\n    * @param propertyName[in]: of type \"string\"\n    *   the compare will be done for this preperty for each element\n    * @param targetValue[in]: of type \"any class that support ===\"\n    *   the property value of the searching target\n    * @param list[in]: of type \"Array/Object\"\n    *   the list that search alone with.\n    */\n   findFirstItemWithPropertyInList: function(propertyName, targetValue, list) {\n      let key;\n      for (key in list) {\n         if (list.hasOwnProperty(key) && !!list[key] &&\n            list[key][propertyName] === targetValue) {\n            return list[key];\n         }\n      }\n      return null;\n   },\n\n   /**\n    * create a new xml element\n    *\n    * We don't use the document object because the \"param\" node can't be add to\n    * the document object correctly in Javascript.\n    * @param name[in]  the name of the XML node\n    * @param content[in]  the content of the XML node, can be nested XML\n    * @param attrArray[in]  key-value pairs for xml attributes\n    * @return a new element\n    */\n   createElement: function(name, content, attrArray) {\n      // Length of parameters defined in function below\n      let defParamLength = util.createElement.length;\n      // Length of actual parameters below\n      let actParamLength = arguments.length;\n      let xmlText = \"\";\n      let attrText = \"\";\n      let attrKey;\n      let attrValue;\n\n      if (defParamLength === actParamLength) {\n         for (attrKey in attrArray) {\n            if (attrArray.hasOwnProperty(attrKey)) {\n               attrValue = attrArray[attrKey];\n               attrText += (\" \" + attrKey + \"='\" + attrValue + \"'\");\n            }\n         }\n      }\n      if ((typeof content === \"undefined\") || content === \"\") {\n         xmlText = \"<\" + name + attrText + \"/>\";\n      } else {\n         if (util.validateXML(content) === true) {\n            xmlText = \"<\" + name + attrText + \">\" + content + \"</\" + name + \">\";\n         } else {\n            // if content is pure text, escape content\n            xmlText =\n               \"<\" + name + attrText + \">\" + util.escapeElement(content) + \"</\" +\n               name +\n               \">\";\n         }\n      }\n\n      return xmlText;\n   },\n\n   /**\n    * compose messages for handlerList using jQuery\n    *\n    * @param handlerList[in] list including handlers whose messages can be sent\n    *    together\n    * @param brokerVersion[in]  broker version used in xml\n    * @return the xml message composed\n    */\n   createXML: function(handlerList, brokerVersion) {\n      let composedMessage = \"\"; // the composed message to be returned\n      let handlerKey;\n      let handler;\n      let content;\n      composedMessage +=\n         \"<?xml version='1.0' encoding='UTF-8'?><broker version='\" +\n         brokerVersion + \"'>\";\n      for (handlerKey in handlerList) {\n         if (handlerList.hasOwnProperty(handlerKey)) {\n            handler = handlerList[handlerKey];\n            content = handler.requestXML;\n            if ((typeof content === \"undefined\") || content === \"\") {\n               composedMessage += \"<\" + handler.messageText + \"/>\";\n            } else {\n               composedMessage += \"<\" + handler.messageText + \">\";\n               composedMessage += content;\n               composedMessage += \"</\" + handler.messageText + \">\";\n            }\n         }\n      }\n      composedMessage += \"</broker>\";\n      return composedMessage;\n   },\n\n\n   /**\n    * Find whether one handler is in the target array using handler's message\n    * name as the key.\n    *\n    * @param handler[in] the handler to find.\n    * @param targetArray[in] the target array to find.\n    * @return -1 if not found, else the position of the handler in the target\n    *         array.\n    */\n   findHandlerInArray: function(handler, targetArray) {\n      let index = 0;\n      for (index = 0; index < targetArray.length; index++) {\n         if (targetArray[index].messageName === handler.messageName) {\n            return index;\n         }\n      }\n      return -1;\n   },\n\n\n   /**\n    * Convert XML document to string\n    *\n    * @param xmlDoc[in] the XML document needs to be converted.\n    * @return the converted string.\n    */\n   XMLToString: function(xmlDoc) {\n      let xmlString = \"\",\n         serializer;\n\n      try {\n         if (typeof XMLSerializer === 'function') {\n            serializer = new XMLSerializer();\n            xmlString = serializer.serializeToString(xmlDoc);\n         }\n      } catch (error) {\n         // For IE browsers which don't support XMLSerializer.\n         xmlString = xmlDoc.xml || '';\n      }\n\n      return xmlString;\n   },\n\n   /**\n    * get object from array named \"name\"\n    *\n    * @param array[in] the array to look for\n    * @param name[in] the object's name\n    * @return the object named \"name\"\n    */\n   getObject: function(array, name) {\n      if (!array) {\n         return null;\n      } else {\n         return array[name];\n      }\n   },\n\n   /**\n    * get child element node named \"name\",\n    set idx to 0 if only 2 parameters exist\n    *\n    * @param parentNode[in] whose child to be got\n    * @param name[in] child's name\n    * @param idx[in] child's index\n    * @return the available child node\n    */\n   getChildNode: function(parentNode, name, idx) {\n      let childNode;\n      // Length of parameters defined in function below\n      let defParamLength = util.getChildNode.length;\n      // Length of actual parameters below\n      let actParamLength = arguments.length;\n      if (defParamLength === actParamLength) {\n         if (!parentNode) {\n            return null;\n         } else {\n            childNode = parentNode.getElementsByTagName(name);\n            if (!childNode) {\n               return null;\n            } else {\n               if (childNode.length <= idx) {\n                  return null;\n               } else {\n                  return childNode[idx];\n               }\n            }\n         }\n      } else if ((defParamLength - 1) === actParamLength) {\n         // only 2 parameter, set idx to 0 by default\n         util.getChildNode(parentNode, name, 0);\n      }\n   },\n\n   /**\n    * add new key-value item for jsonObject\n    *\n    * @param jsonObject[in] the json object to be handled\n    * @param key[in] new item's key to be added\n    * @param value[in] new item's value to be added\n    * @return the status of this operation, true/false\n    */\n   addItemForJson: function(jsonObject, key, value) {\n      if (!jsonObject) {\n         return false;\n      } else {\n         jsonObject[key] = value;\n         return true;\n      }\n   },\n\n   /**\n    * get the value of param named paramName from url\n    *\n    * @param url[in] the url to be handled\n    * @param paramName[in] param name in url to be used\n    * @return param value of param named paramName in url\n    */\n   getUrlParam: function(url, paramName) {\n      let param, paramKey, paramValue, i;\n      let ret = null;\n      let params = url.slice(url.indexOf('?') + 1).split('&');\n      for (i = 0; i < params.length; i++) {\n         param = params[i].split('=');\n         paramKey = param[0];\n         paramValue = param[1];\n         if (paramKey === paramName) {\n            ret = paramValue;\n         }\n      }\n      return ret;\n   },\n\n   /**\n    * get decoded value of param named paramName from url\n    *\n    * @param url[in] the url to be handled\n    * @param paramName[in] param name in url to be used\n    * @return decoded value of param named paramName in url\n    */\n   getDecodedUrlParam: function(url, paramName) {\n      let ret = null;\n      let urlParam = util.getUrlParam(url, paramName);\n      if (!!urlParam) {\n         ret = decodeURIComponent(urlParam);\n      }\n      return ret;\n   },\n\n   /**\n    * escape illegal characters in XML element string, such as '&', '<'\n    * @param text[in] XML element string containing illegal characters\n    * @return escaped XML element string\n    */\n\n   escapeElement: function(text) {\n      // Characters like \"<\" and \"&\" are illegal in XML elements.\n      // see\n      // https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references\n      if (!!text) {\n         return text.replace(/[\"&'<>]/g, function(c) {\n            if (c === '\"') {\n               return \"&quot;\";\n            } else if (c === \"'\") {\n               return \"&apos;\";\n            } else if (c === \"<\") {\n               return \"&lt;\";\n            } else if (c === \">\") {\n               return \"&gt;\";\n            } else if (c === \"&\") {\n               return \"&amp;\";\n            } else {\n               return '&#' + c.charCodeAt(0) + ';';\n            }\n         });\n      }\n      return text;\n   },\n\n   /**\n    * unescape characters in XML element string, such as '&amp;', '&lt;'\n    * @param text[in] XML element string to unescape\n    * @return unescaped XML element string\n    */\n\n   unescapeElement: function(text) {\n      // Characters like \"<\" and \"&\" are illegal in XML elements.\n      // refer to: http://www.w3schools.com/xml/xml_cdata.asp\n      if (!!text) {\n         text = text.replace(/\\&quot;/g, '\"');\n         text = text.replace(/\\&apos;/g, \"'\");\n         text = text.replace(/\\&lt;/g, \"<\");\n         text = text.replace(/\\&gt;/g, \">\");\n         text = text.replace(/\\&amp;/g, \"&\");\n      }\n      return text;\n   },\n\n   /**\n    * validate xmlString whether it is pure text without xml elements\n    * @param xmlString[in] xmlString to be validated\n    * @return true/false, whether xmlString is pure text without xml elements\n    */\n\n   validateXML: function(xmlString) {\n      let xmlDoc;\n      let isValid;\n      let len;\n\n      try {\n         /**\n          * add a root element \"<validate></validate>\" to avoid XML validation\n          * error caused by mutiple XML elements (this case is valid) in\n          * xmlString\n          */\n         xmlDoc = $.parseXML('<validate>' + xmlString + '</validate>');\n         len = $(xmlDoc).find(\"validate\").children().length;\n         if (len === 0) {\n            /**\n             * \"len === 0\" indicates that xmlString is a text string,\n             * without XML elements in it.\n             */\n            isValid = false;\n         } else {\n            /**\n             * xmlString has one or mutiple XML elements but it is valid.\n             * For example,\n             * \"<name>username</name><values><value>haijiang</value></values>\".\n             * It is valid as a part of final xml string, because\n             * createElement() has been called three times to generate this\n             * string\n             */\n            isValid = true;\n         }\n      } catch (e) {\n         /**\n          * \"validate error\" indicates that xmlString has special characters to\n          * escape\n          */\n         isValid = false;\n         JSCDKLogger.error(\"validate XML error: \" + e);\n      }\n      return isValid;\n   },\n\n   /**\n    * Parses a URL into its components\n    * XXX TODO: Potentially rewrite this.\n    *\n    * @param url[in] URL to parse\n    * @return object containing information about the URL\n    */\n   parseURL: function(url) {\n      let a = document.createElement('a');\n\n      try {\n         /*\n          * IE10 (possibly among others) has problems parsing a link if there is no protocol\n          * attached to it.\n          */\n         if (url.indexOf(\"://\") !== -1) {\n            a.href = url;\n         } else {\n            a.href = \"https://\" + url;\n         }\n         return {\n            source: url,\n            protocol: a.protocol.replace(':', ''),\n            host: a.hostname,\n            port: a.port,\n            query: a.search,\n            params: (function() {\n               let ret = {},\n                  seg = a.search.replace(/^\\?/, '').split('&'),\n                  len = seg.length, i = 0, s;\n               for (i = 0; i < len; i++) {\n                  if (!seg[i]) {\n                     continue;\n                  }\n                  s = seg[i].split('=');\n                  ret[s[0]] = s[1];\n               }\n               return ret;\n            }()),\n            file: (a.pathname.match(/\\/([^\\/?#]+)$/i) || ['', ''])[1],\n            hash: a.hash.replace('#', ''),\n            path: a.pathname.replace(/^([^\\/])/, '/$1'),\n            relative: (a.href.match(/tps?:\\/\\/[^\\/]+(.+)/) || ['', ''])[1],\n            segments: a.pathname.replace(/^\\//, '').split('/')\n         };\n      } catch (e) {\n         /*\n          * Browsers may throw an exception if the URL is not valid.  Return an object\n          * with the expected members all empty so the applications don't have to check\n          * whether a member exists before using it.\n          */\n         return {\n            source: url,\n            protocol: \"\",\n            host: \"\",\n            port: \"\",\n            query: \"\",\n            params: {},\n            file: \"\",\n            hash: \"\",\n            path: \"\",\n            relative: \"\",\n            segments: \"\"\n         };\n      }\n   },\n\n   /**\n    * Check whether the code is running under Chrome Extension enviroment.\n    * If chrome.extension APIs are defined, it is running in Chrome Extension\n    * enviroment.\n    *\n    * @return true if it is in Chrome Extension enviroment, else false.\n    */\n\n   isChromeExtension: function() {\n      if (navigator.userAgent.toLowerCase().indexOf('chrome') > -1) {\n         if (!!chrome && !!chrome.extension) {\n            return true;\n         }\n      }\n      return false;\n   },\n\n\n   /**\n    * Compute a random 128-bit string to use as the random token in the direct\n    * connect case. Returns the result a string in the following format:\n    * xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\n    *\n    * This UUID follows RFC 4122 type 4. 'x's map to random hex digits and 'y'\n    * maps to 8, 9, a, or b.\n    *\n    * This code is based on BSG code for generating routing tokens.\n    */\n   getUuid: function() {\n      /**\n       * Generate random numbers between 0 and 1 seeded using the current time.\n       */\n      let random = function() {\n         let d = new Date();\n         let seed = Math.abs(1000 * d.getSeconds() + d.getMilliseconds());\n         let r = seed * Math.random();\n         return r - Math.floor(r);\n      };\n\n      /**\n       * Generate a version 4 UUID using the random() function to generate\n       * each hex digit.\n       */\n      let token = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,\n         function(c) {\n            let r = random() * 16 | 0,\n               v = ((c === 'x') ? r : (r & 0x3 | 0x8));\n\n            return v.toString(16);\n         }).toUpperCase();\n\n      return token;\n   },\n\n   /**\n    * Replace the secret field's value such as password before logging it.\n    *\n    * @param message [in] message needs to be censored.\n    * @param type    [in] message type: XML or JSON, default type is XML.\n    * @return the censored string, or \"CENSORING FAILED\" when translation fails.\n    */\n   censorMessage: function(message, type) {\n      let censoredMessage = message,\n         secretParams =\n            [\"framework-channel-ticket\", \"newPassword1\", \"newPassword2\",\n               \"oldPassword\", \"passcode\", \"password\", \"pin1\", \"pin2\",\n               \"smartCardPIN\",\n               \"secret\", \"token\", \"tokencode\", \"url\"],\n         messageType = type || 'XML',\n         xmlDoc,\n         xml,\n         secretNode,\n         secretKey,\n         obj,\n         i;\n\n      try {\n         if (messageType.toLowerCase() === 'xml') {\n            xmlDoc = $.parseXML(censoredMessage);\n            xml = $(xmlDoc);\n            secretNode = xml.find('param');\n            secretNode = Array.prototype.slice.call(secretNode);\n            for (secretKey in secretNode) {\n               // Skip non-properties to avoid bugs like 1732807\n               if (!secretNode.hasOwnProperty(secretKey)) {\n                  continue;\n               }\n               if ($.inArray($(secretNode[secretKey]).children('name').text(),\n                     secretParams) !== -1) {\n                  $(secretNode[secretKey]).find('value').text(\"[REDACTED]\");\n               }\n            }\n            censoredMessage = util.XMLToString(xmlDoc);\n         } else {\n            obj = $.parseJSON(censoredMessage);\n            for (i = 0; i < secretParams.length; i++) {\n               secretKey = secretParams[i];\n               if (obj.hasOwnProperty(secretKey)) {\n                  obj[secretKey] = '[REDACTED]';\n               }\n            }\n            censoredMessage = JSON.stringify(obj);\n         }\n\n         return censoredMessage;\n      } catch (e) {\n         // Parse document fail\n         return \"CENSORING FAILED\";\n      }\n   },\n\n   /**\n    * Serializes information about an error into a string.  I used to just\n    * stringify the entire error object but sometimes it would have circular\n    * references which would throw its own exception.  The next best thing\n    * is to just log the top-level items in the error object.\n    *\n    * @param e[in] error object to serialize.\n    * @return string containing error serialization.\n    */\n   serializeError: function(e) {\n      let key,\n         detail = \"\";\n      for (key in e) {\n         if (e.hasOwnProperty(key)) {\n            detail += \"\\r\\n   \" + key + \": \" + e[key];\n         }\n      }\n      return detail;\n   },\n\n   getSelfDefinedErrorObjectBy: function(xmlHandler, errorMessage,\n                                         errorDetail) {\n      let ErrorObj = {};\n      let errorKey;\n\n      errorKey =\n         xmlHandler.name || xmlHandler.messageName || \"self-defined error\";\n      JSCDKLogger.error(\"error from \" + errorKey + \": \" + errorMessage);\n\n      ErrorObj.errorType = errorKey;\n      ErrorObj.errorText = errorMessage;\n      if (!!errorDetail) {\n         ErrorObj.errorDetail = errorDetail;\n      }\n      return ErrorObj;\n   },\n\n   /**\n    * Deals with some of the L10N features like using display text based on\n    * user's locale.\n    */\n   l10N: {\n\n      // Mapping of supported locales to the corresponding JSON file.\n      supportedLocale: {\n         \"en\": \"en\",\n         \"es\": \"es\",\n         \"de\": \"de\",\n         \"fr\": \"fr\",\n         \"ja\": \"ja\",\n         \"ko\": \"ko\",\n         \"zh\": \"zh_CN\",\n         \"en-us\": \"en\",\n         \"es-es\": \"es\",\n         \"de-de\": \"de\",\n         \"fr-fr\": \"fr\",\n         \"ja-jp\": \"ja\",\n         \"ko-kr\": \"ko\",\n         \"zh-cn\": \"zh_CN\",\n         \"zh-hans\": \"zh_CN\",\n         \"zh-hant\": \"zh_TW\",\n         \"zh-tw\": \"zh_TW\",\n         \"zh-hk\": \"en\",\n         \"zh-mo\": \"en\",\n         \"zh-hans-hk\": \"en\",\n         \"zh-hant-hk\": \"en\",\n         \"zh-hans-mo\": \"en\",\n         \"zh-hant-mo\": \"en\"\n      },\n\n      // Locale to be used during translation. Default is English.\n      locale: 'en',\n\n      // JSON object containing the translated text.\n      translatedTable: null,\n\n      // Get Locale info\n      getLocale: function() {\n         if (!this.translatedTable) {\n            // Set locale and load JSON translation table.\n            this.setLocaleAndLoad();\n         }\n\n         return this.locale;\n      },\n\n      // Set the locale and load the corresponding JSON translation table.\n      setLocaleAndLoad: function(acceptLanguage) {\n         let self = this,\n            url,\n            selectedLocale,\n            data;\n\n         if (!acceptLanguage) {\n            // The language version of the platform\n            acceptLanguage = navigator.language || navigator.userLanguage;\n         }\n\n         if (!!acceptLanguage) {\n            // Determine the corresponding JSON translation file.\n            selectedLocale = this.getBestLocale(acceptLanguage);\n            if (!!selectedLocale) {\n               this.locale = selectedLocale;\n            }\n         }\n\n         JSCDKLogger.debug('Load translation table for locale: ' + this.locale);\n         if (this.locale === 'en') {\n            // There is no need to load the English translation table.\n            this.translatedTable = {};\n            return;\n         }\n\n         /**\n          * Load language JSON file according to browser's locale setting using\n          * AJAX synchronous call.\n          */\n         url = '../locale/' + this.locale + '.json';\n         $.ajax({\n            type: \"GET\",\n            url: url,\n            dataType: \"json\",\n            cache: false,\n            success: function(data) {\n               if (!!data) {\n                  self.translatedTable = data;\n               } else {\n                  JSCDKLogger.error(\n                     'Invalid translation data from url: ' + url);\n               }\n            },\n            error: function(jqXHR, textStatus, errorThrown) {\n               JSCDKLogger.error(\n                  'Failed to load translation data, url: ' + url +\n                  ', status: ' + textStatus + ', errorThrown: ' + errorThrown);\n            }\n         });\n      },\n\n      translate: function(msgid, args) {\n         let translatedStr;\n\n         /**\n          * If the translated msgid exists, return the translated string, else\n          * return the original string.\n          */\n         if (!!this.translatedTable[msgid] &&\n            this.translatedTable[msgid][1].length > 0) {\n            /**\n             * The tool po2json used for converting po to json puts the\n             * translated string to an array and the translated result is in\n             * the second element.\n             */\n            translatedStr = this.translatedTable[msgid][1];\n         } else {\n            translatedStr = msgid;\n         }\n\n\n         return translatedStr.replace(/\\{(\\d+)\\}/g,\n            function(match, mNum, offset, fullStr) {\n               let retStr;\n               let intNum = parseInt(mNum, 10);\n               // For escaped case, remove the duplicated \"{\" and \"}\".\n               if (fullStr.charAt(offset - 1) === \"{\" &&\n                  fullStr.charAt(offset + match.length) === \"}\") {\n                  return mNum;\n               }\n               if (!!args[intNum + 1]) {\n                  retStr = args[intNum + 1];\n               } else {\n                  retStr = match;\n               }\n\n               return retStr;\n            });\n      },\n\n      /**\n       * For a given list of desired locales, determine which language out of\n       * our supported languages we should display.\n       */\n      getBestLocale: function(acceptLanguage) {\n         let matchedLocale = null,\n            matchedRank = 0,\n            accepted,\n            i,\n            kv,\n            parts,\n            thisRank,\n            localeAndRank;\n\n         if (!acceptLanguage) {\n            return null;\n         }\n\n         /**\n          * For each of the languages in the acceptLanguage param, see\n          * if getSupportedLocale likes it. If so, set the currently\n          * preferred language and its rank ('q=' value.) Do this for\n          * all languages.\n          */\n         accepted = acceptLanguage.split(',');\n         for (i = 0; i < accepted.length; i++) {\n            if (accepted[i].indexOf('*') >= 0) {\n               // Ignore the wildcard.\n               continue;\n            }\n\n            /*\n             * There may be a 'q=' section with a rank for this language.\n             * Set rank value to 1 by default.\n             */\n            thisRank = 1;\n            parts = $.trim(accepted[i]).split(';', 2);\n            if (parts.length === 2) {\n               kv = parts[1].split('=', 2);\n               if (kv[0] === 'q' && kv.length === 2) {\n                  thisRank = parseFloat(kv[1]);\n               }\n            } else if (parts.length < 1) {\n               continue;\n            }\n\n            /**\n             * If this locale entry is supported, compare its rank to the\n             * highest matched rank thus far.\n             */\n            localeAndRank = this.getSupportedLocale(parts[0], thisRank);\n            if (!!localeAndRank) {\n               if (localeAndRank[1] > matchedRank) {\n                  matchedLocale = localeAndRank[0];\n                  matchedRank = localeAndRank[1];\n               }\n            }\n         }\n\n         return matchedLocale;\n      },\n\n      /**\n       * For a given locale, determine the best supported localization\n       * fit for that language using the supportedLocale dictionary.\n       */\n      getSupportedLocale: function(locale, returnRank) {\n         let langCode,\n            selectedLocale,\n            specifiers;\n\n         // Convert to lower-case.\n         locale = locale.toLowerCase();\n\n         if (this.supportedLocale.hasOwnProperty(locale)) {\n            // The full locale is specifically supported.\n            selectedLocale = this.supportedLocale[locale];\n         } else {\n            specifiers = locale.split('-');\n            if (specifiers.length > 2) {\n               // Locale string like 'zh-hant' or 'zh-hant'.\n               langCode = specifiers[0] + '-' + specifiers[1];\n               if (this.supportedLocale.hasOwnProperty(langCode)) {\n                  // The language is zh-hans or zh-hant\n                  selectedLocale = this.supportedLocale[langCode];\n               }\n            }\n            if (!selectedLocale && specifiers.length > 0) {\n               // Locale string like 'en-us' or 'zh-tw'.\n               langCode = specifiers[0];\n               if (this.supportedLocale.hasOwnProperty(langCode)) {\n                  /**\n                   * The language is supported, but not in the desired locale,\n                   * the request is generic (xx instead of xx-YY)\n                   */\n                  selectedLocale = this.supportedLocale[langCode];\n               }\n            }\n         }\n\n         if (!!selectedLocale) {\n            return [selectedLocale, returnRank];\n         }\n\n         return null;\n      }\n   },\n\n   /**\n    * Get the translated strings for user's current language with printable\n    * style. The {number} tags are replaced by the order of the arguments\n    * followed. The number should start from 0 and continously. The arguments\n    * followed are printed in the number orders to support different orders for\n    * the same sentence in different languages. Use {{number}} to print\n    * {number} in the string.\n    *\n    * A tutorial for English strings:\n    *     Input                          Output\n    * _(\"Test text.\")                \"Test text.\"\n    * _(\"{0} text.\", \"Test\")         \"Test text.\"\n    * _(\"{1} {0}.\", \"text\", \"Test\")  \"Test text.\"\n    * _(\"Test text {{0}}\", \"fail\")   \"Test text {0}\"\n    * _(\"Test text {0}\")             \"Test text {0}\"\n    * @param msgid[in] key for the translated string.\n    * @param arguments...[in] variable arguments for printf style strings, use\n    *    {0}, {1}, etc as the format parameters.\n    * @return the translated string if found, else the original string.\n    */\n\n   _: function(msgid) {\n      let args = arguments;\n\n      /**\n       * Load the resources when the _ function first called.\n       */\n      if (!util.l10N.translatedTable) {\n         // Load translation table according to the desired locale.\n         util.l10N.setLocaleAndLoad();\n      }\n\n      return util.l10N.translate(msgid, args);\n   },\n\n   /**\n    * workflow control class for info merging.\n    *\n    * @param waitNumber: of int\n    *    if the input info number is greater or equal to this number,\n    *    the merging will be preformed\n    * @param mergingFunc: of function\n    */\n   InfoCombiner: function(waitNumber, mergingFunc, callbackParam) {\n      // private:\n      let mergingThreshold = waitNumber,\n         mergingFunction = mergingFunc,\n         mergingCallbackParam = callbackParam,\n         containerList = [];\n\n      // privileged:\n      this.onInfoReceived = function(infoObj) {\n         containerList.push(infoObj);\n         if (containerList.length >= mergingThreshold) {\n            mergingFunction(containerList, mergingCallbackParam);\n            containerList = [];\n         }\n      };\n   },\n\n   isWS1Mode: function() {\n      return globalArray.ws1Mode;\n   },\n\n   getWS1Hostname: function() {\n      return globalArray.workspaceOneServerHostname;\n   }\n};\n\nexport default util;\n\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/util.js","/**********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * messageHandler.js --\n *\n *      Implementation of the prototype of all message handlers.\n */\n\nimport $ from 'jquery';\nimport JSCDKLogger from '../jscdkLogger';\nimport util from '../util';\nimport JSCDKBrokerError from '../model/jscdkBrokerError';\n\n\n// all states of a message handler\nexport const StateEnum = {\n   INIT: \"init\",\n   PENDING: \"pending\",\n   DONE: \"done\",\n   FAIL: \"fail\"\n};\n\nMessageHandler.prototype = new MessageHandler(); // MessageHandler prototype\nMessageHandler.constructor = MessageHandler; // constructor\n\nexport function MessageHandler() {\n   this.messageName = \"\"; // name of this messages handler, using XML\n                          // protocols message\n   this.messageText = \"\"; // the text needed to send to the broker\n   this.responseTag = \"\"; // indicate which response this handler should handle\n   this.content = {}; // data generated (key-value) by current handler,\n                      // including response result, local info, etc.\n   this.requestXML = \"\"; // XML document needs to send.\n   this.state = StateEnum.INIT; // the state of the current handler, set to\n                                // INIT firstly\n   this.dependencyList = []; // list of other handlers who current handler\n                             // depends on\n   this.observerList = []; // list of handlers who depend on current handler\n   this.subHandlerList = []; // one message handler may have some sub messages,\n                             // such as \"do-submit-authentication\"\n   this.parentHandler = null; // when setting a handler's sub handler, we also\n                              // set it as the sub handler's parent handler\n   this.composedHandlerList = []; // list of handlers who can be sent together\n                                  // in a single message\n   this.requestId = 0; // suffix of responseTag to distinguish mutiple\n                       // instances of a handler\n   this.requestIdKV = {}; // key-value pairs, value is requestId, key can be\n                          // responseTag+desktopId or other\n   this.xhrObject = {}; // XHR object for the http request\n}\n\nMessageHandler.prototype.setMessageName = function(messageName) {\n   this.messageName = messageName;\n};\n\nMessageHandler.prototype.getMessageName = function() {\n   return this.messageName;\n};\n\nMessageHandler.prototype.getMessageText = function() {\n   return this.messageText;\n};\n\nMessageHandler.prototype.setRequestXML = function(requestXML) {\n   this.requestXML = requestXML;\n};\n\nMessageHandler.prototype.getRequestXML = function() {\n   return this.requestXML;\n};\n\nMessageHandler.prototype.setState = function(state) {\n   let key;\n   let handler;\n   let parentHandler;\n\n   if (state === StateEnum.DONE) {\n      if (this.hasSubHandler()) {\n         JSCDKLogger.error(\"Failed to set \" + this.getMessageName() +\n            \"'s state to DONE because it has sub handlers to execute.\");\n         return;\n      }\n   }\n\n   JSCDKLogger.trace(\"Set \" + this.getMessageName() + \"'s state from \" +\n      this.state + \" to \" + state);\n   this.state = state;\n\n   if ((this.state === StateEnum.DONE) || (this.state === StateEnum.FAIL)) {\n      parentHandler = this.parentHandler;\n      if (!!parentHandler) {\n         parentHandler.removeSubHandler(this);\n         if (this.state === StateEnum.FAIL) {\n            parentHandler.setState(StateEnum.FAIL);\n         } else {\n            parentHandler.onUpdated();\n         }\n      }\n\n      if (!!(this.observerList[\"state\"])) {\n         for (key in this.observerList[\"state\"]) {\n            if (this.observerList[\"state\"].hasOwnProperty(key)) {\n               handler = this.observerList[\"state\"][key];\n               if (this.state === StateEnum.FAIL) {\n                  if (!!this.content[\"error\"]) {\n                     handler.appendContent(this.content[\"error\"]);\n                  }\n               }\n               handler.onUpdated();\n            }\n         }\n      }\n   }\n};\n\nMessageHandler.prototype.getState = function() {\n   return this.state;\n};\n\n\nMessageHandler.prototype.getXhrObject = function() {\n   return this.xhrObject;\n};\n\n\nMessageHandler.prototype.setXhrObject = function(xhrObject) {\n   this.xhrObject = xhrObject;\n};\n\n\n/**\n * Reset the handler's state and content which can't be reused twice.\n *\n */\n\nMessageHandler.prototype.resetData = function() {\n   this.setState(StateEnum.INIT);\n   this.content = {};\n   this.subHandlerList = [];\n   this.parentHandler = null;\n};\n\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nMessageHandler.prototype.onUpdated = function() {\n   // XXX TODO: branches here, such as state transition\n   // XXX TODO: check attribute \"content\" whether all dependencies are ready\n   let parsedResult;\n   let i;\n   let handler;\n   let doneCnt;\n   let msgerror = {};\n   let error = {};\n   let subError = {};\n   let msgError = {};\n   let errorCode;\n   let errorKey;\n   let jscdkError;\n   let key;\n   if (this.getState() === StateEnum.INIT) {\n      this.setState(StateEnum.PENDING);\n   }\n   // check parsed result in property \"content\"\n   if (!!(this.content[\"parsedResult\"])) {\n      parsedResult = this.content[\"parsedResult\"];\n      if (!!parsedResult[\"result\"]) {\n         if (parsedResult[\"result\"] === \"ok\") {\n            if (this.hasSubHandler()) {\n               // trigger all sub handlers' executions.\n               for (key in this.subHandlerList) {\n                  if (this.subHandlerList.hasOwnProperty(key)) {\n                     handler = this.subHandlerList[key];\n                     handler.triggerExecution();\n                  }\n               }\n            }\n\n            // check all dependencies' status\n            if (!!(this.dependencyList[\"state\"])) {\n               doneCnt = 0;\n               for (i = 0; i < this.dependencyList[\"state\"].length; ++i) {\n                  handler = this.dependencyList[\"state\"][i];\n                  JSCDKLogger.debug(this.messageName + \" depends on \" +\n                     handler.messageName);\n                  if (handler.getState() === StateEnum.DONE) {\n                     JSCDKLogger.debug(\n                        handler.messageName + \"'s state is DONE.\");\n                     ++doneCnt;\n                  }\n                  if (handler.getState() === StateEnum.FAIL) {\n                     JSCDKLogger.debug(\n                        handler.messageName + \"'s state is FAIL.\");\n                     this.setState(StateEnum.FAIL);\n                     break;\n                  }\n               }\n               if (doneCnt === this.dependencyList[\"state\"].length) {\n                  this.setState(StateEnum.DONE);\n               }\n            } else {\n               this.setState(StateEnum.DONE);\n            }\n         } else if (parsedResult[\"result\"] === \"error\") {\n            /**\n             * if result from broker is error, it should not be triggered by\n             * any dependency; reset data to avoid entering this branch for\n             * multiple times if error occurs\n             */\n            this.content = {};\n\n            // handle general errors\n            if (!!(parsedResult[\"error-code\"])) {\n               errorCode = parsedResult[\"error-code\"];\n               errorKey = this.messageName;\n               subError.errorCode = errorCode;\n               if (!!parsedResult[\"error-message\"]) {\n                  subError.errorMessage = parsedResult[\"error-message\"];\n               }\n               if (!!parsedResult[\"user-message\"]) {\n                  subError.userMessage = parsedResult[\"user-message\"];\n               }\n               if (!!parsedResult[\"workspaceOneServerHostname\"]) {\n                  subError.workspaceOneServerHostname =\n                     parsedResult[\"workspaceOneServerHostname\"];\n               }\n               msgError[errorKey] = subError;\n               error[\"error\"] = msgError;\n               this.appendContent(error);\n               this.setState(StateEnum.FAIL);\n            }\n         }\n      } else {\n         /**\n          * if result from broker doesn't exist, it should not be triggered by\n          * any dependency; reset data to avoid entering this branch for\n          * multiple times if error occurs\n          */\n         this.content = {};\n\n         JSCDKLogger.error(\n            \"no result in parsed result of \" + this.getMessageName());\n         msgerror[this.getMessageName()] = JSCDKBrokerError.getError(\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_UNKNOWN).toString();\n         error[\"error\"] = msgerror;\n         this.appendContent(error);\n         this.setState(StateEnum.FAIL);\n      }\n   } else {\n      JSCDKLogger.debug(\n         \"no parsed result for \" + this.getMessageName() + \" yet\");\n   }\n   JSCDKLogger.debug(this.getMessageName() + \"'s state: \" + this.getState());\n};\n\n/**\n * Broadcast here, such as doLogout, etc.\n *\n * @param msg [in] the message to be broadcast, such as \"doLogout\", etc.\n */\nMessageHandler.prototype.onBroadcast = function(msg) {\n   if (msg === \"doLogout\" || msg === \"doCancelAuthentication\") {\n      JSCDKLogger.debug(this.messageName + \" reset data\");\n      // Reset data on logout or authentication cancellation.\n      this.resetData();\n   }\n};\n\n/**\n * add a new observer into observerList\n *\n * @param  inputHandler [in] the observer handler to be added\n * @param  attributeName [in] name of the attribute whose observerList is\n *    handled\n */\nMessageHandler.prototype.addObserver = function(inputHandler, attributeName) {\n   if ((this.observerList[attributeName]) !== null) {\n      if (typeof this.observerList[attributeName] === \"undefined\") {\n         this.observerList[attributeName] = [];\n      }\n      if (util.findHandlerInArray(inputHandler,\n            this.observerList[attributeName]) === -1) {\n         this.observerList[attributeName].push(inputHandler);\n      } else {\n         JSCDKLogger.warning(\"Adding twice to the observer list for handler \"\n            + inputHandler.messageName);\n      }\n   }\n};\n\n/**\n * remove a specific observer from observerList\n *\n * @param  inputHandler [in] the observer handler to be removed\n * @param  attributeName [in] name of the attribute whose observerList is\n *    handled\n */\nMessageHandler.prototype.removeObserver =\n   function(inputHandler, attributeName) {\n      let list = this.observerList[attributeName];\n      if (!!list) {\n         let index = list.indexOf(inputHandler);\n         if (index > -1) {\n            list.splice(index, 1);\n         }\n      }\n   };\n\n/**\n * register the router and handlers here\n *\n * @param  inputHandler [in | out] the handler to be handled, update current\n *    handler's dependencyList and inputHandler's observerList\n * @param  attributeName [in] name of the attribute whose observerList is\n *    handled\n */\nMessageHandler.prototype.registerHandler =\n   function(inputHandler, attributeName) {\n      // handle inputHandler's observer\n      inputHandler.addObserver(this, attributeName);\n      // handle its dependency\n      if (!(this.dependencyList[attributeName])) {\n         this.dependencyList[attributeName] = [];\n      }\n      this.dependencyList[attributeName].push(inputHandler);\n   };\n\n/**\n * unregister the router and handlers here\n *\n * @param  inputHandler [in | out] the handler to be handled, update current\n *    handler's dependencyList and inputHandler's observerList\n * @param  attributeName [in] name of the attribute whose observerList is\n *    handled\n */\nMessageHandler.prototype.unregisterHandler =\n   function(inputHandler, attributeName) {\n      let index;\n      let list;\n      // handle inputHandler's observer\n      inputHandler.removeObserver(this, attributeName);\n      // handle its dependency\n      list = this.dependencyList[attributeName];\n\n      if (!!list) {\n         index = list.indexOf(inputHandler);\n         if (index > -1) {\n            list.splice(index, 1);\n         }\n      }\n   };\n\n/**\n * append relative content(key-value pairs) to the content of current handler\n *\n * @param content[in] key-value pair to be appended\n */\nMessageHandler.prototype.appendContent = function(content) {\n   let key;\n   for (key in content) {\n      if (content.hasOwnProperty(key)) {\n         this.content[key] = content[key];\n         JSCDKLogger.debug(this.messageName + \" this.content[\" + key + \"]: \" +\n            util.censorMessage(JSON.stringify(this.content[key]), 'JSON'));\n      }\n   }\n};\n\n/**\n * remove corresponding content(key-value pairs) from this.content of this\n * handler\n * @param key[in] key of the item to remove\n */\nMessageHandler.prototype.removeFromContent = function(key) {\n   if (this.content.hasOwnProperty(key)) {\n      delete this.content[key];\n   }\n};\n\n/**\n * compose list of message handlers who can be sent together in a single message\n *\n */\nMessageHandler.prototype.composeHandlerList = function() {\n   if (this.composedHandlerList.length === 0) {\n      this.composedHandlerList.push(this);\n   }\n   return this.composedHandlerList;\n};\n\n\n/**\n * Cancel http request for the handler.\n *\n */\n\nMessageHandler.prototype.cancelRequest = function() {\n   if (!!this.xhrObject && $.isFunction(this.xhrObject.abort)) {\n      this.xhrObject.abort();\n   }\n   this.resetData();\n};\n\n/**\n * Clear sub handler list.\n *\n */\nMessageHandler.prototype.clearSubHandlers = function() {\n   let subHandler,\n      i;\n\n   for (i = 0; i < this.subHandlerList.length; i++) {\n      subHandler = this.subHandlerList[i];\n      subHandler.resetData();\n   }\n\n   this.subHandlerList = [];\n};\n\n/*\n * Checks whether the current handler has any sub handler.\n *\n * @return true if it has, false otherwise.\n */\nMessageHandler.prototype.hasSubHandler = function() {\n   if (this.subHandlerList.length > 0) {\n      return true;\n   }\n\n   return false;\n};\n\n/**\n * Append a new sub handler into subHandlerList\n *\n * @param  subHandler [in] the sub handler to be appended\n */\nMessageHandler.prototype.appendSubHandler = function(subHandler) {\n   let list = this.subHandlerList;\n\n   if (!list) {\n      this.subHandlerList = [];\n      list = this.subHandlerList;\n   }\n\n   if (util.findHandlerInArray(subHandler, list) === -1) {\n      list.push(subHandler);\n      subHandler.parentHandler = this;\n      JSCDKLogger.trace(this.messageName + \": adding one sub handler: \" +\n         subHandler.messageName);\n   } else {\n      JSCDKLogger.error(\"Adding \" + subHandler.messageName +\n         \"twice to \" + this.messageName + \"'s sub handler list\");\n   }\n};\n\n/**\n * Remove a sub handler from subHandlerList\n *\n * @param  inputHandler [in] the sub handler to be removed\n */\nMessageHandler.prototype.removeSubHandler = function(subHandler) {\n   let index,\n      list = this.subHandlerList;\n\n   if (!!list) {\n      index = list.indexOf(subHandler);\n      if (index > -1) {\n         list.splice(index, 1);\n         subHandler.parentHandler = null;\n      }\n   }\n};\n\n/**\n * Trigger a handler to begin execution\n *\n */\nMessageHandler.prototype.triggerExecution = function() {\n   /**\n    * Here we just provide an interface.\n    * It should be overwitten by derived class when needed.\n    */\n   JSCDKLogger.trace(\n      \"Calling \" + this.messageName + \"'s triggerExecution function.\");\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/messageHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * router.js --\n *\n *      Implementation of the router for posting to the view broker and parsing\n * the response.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport JSCDKBrokerError from '../model/jscdkBrokerError';\nimport {prepareForAlreadyAuthenticated} from '../timer/timer-util';\n\n\nexport default function Router() {\n   // member variables\n   this.name = \"router\";\n   this.doLogout = \"doLogout\"; // attribute \"doLogout\" to be registered\n   this.doCancelAuthentication = \"doCancelAuthentication\";\n   this.receiver = \"receiver\"; // attribute \"receiver\" to be registered\n   this.observerList = [];\n   this.brokerUrl = \"\";\n   this.brokerUrlWithTimestamp = false;\n   this.content = {}; // data generated (key-value) by router, such as error,\n                      // etc.\n   this.recentXhrObject = {}; // Recent XHR object for AJAX request.\n}\n\nRouter.prototype.ajaxWasAborted = false;\n\nRouter.prototype.setDoLogout = function() {\n   // traverse the observerList of attribute \"doLogout\", and call each\n   // handler's onBroadcast()\n   let key,\n      handler;\n   if (!!this.observerList[this.doLogout]) {\n      for (key in this.observerList[this.doLogout]) {\n         if (this.observerList[this.doLogout].hasOwnProperty(key)) {\n            handler = this.observerList[this.doLogout][key];\n            handler.onBroadcast(this.doLogout);   // onBroadcast callback here\n         }\n      }\n   }\n};\n\nRouter.prototype.setDoCancelAuthentication = function() {\n   /*\n    * Traverse the observerList of attribute \"doCancelAuthentication\", and call\n    * each handler's onBroadcast().\n    */\n   let key;\n   let handler;\n   if (!!this.observerList[this.doCancelAuthentication]) {\n      for (key in this.observerList[this.doCancelAuthentication]) {\n         if (this.observerList[this.doCancelAuthentication].hasOwnProperty(\n               key)) {\n            handler = this.observerList[this.doCancelAuthentication][key];\n            handler.onBroadcast(this.doCancelAuthentication);   // onBroadcast\n                                                                // callback\n                                                                // here\n         }\n      }\n   }\n};\n\n/**\n * Set the request URL of the broker and specify\n * whether timestamp is needed to appended to each request.\n *\n * Appending a timestamp to the URL is to fix a iOS6 Ajax cache problem.\n *\n * @param brokerUrl [in] The URL address of the broker\n * @param appendTimestamp [in] Optional. A boolean value indicating whether to\n *                               append a timestamp. If undefined, the value is\n *    false.\n */\nRouter.prototype.setBrokerUrl = function(brokerUrl, appendTimestamp) {\n   this.brokerUrl = brokerUrl;\n\n   // only enable in DEV MODE\n   // this.brokerUrl = \"https://localhost/portal/broker/xml\";\n\n\n   // For iOS6 system, a timestamp is appended to each post request, so that\n   // browser doesn't cache the response.\n   this.brokerUrlWithTimestamp = !!appendTimestamp;\n};\n\n/**\n * Replace the secret field's value when logging get-destop-connection resposne\n *\n * @param message [in] XML response from broker.\n * @return the censored string, or \"CENSORING FAILED\" when translation fails.\n */\n\nRouter.prototype.censorResponse = function(message) {\n   try {\n      let censoredMessage = message,\n         secretParams = [\"framework-channel-ticket\", \"password\", \"token\"],\n         xmlDoc = $.parseXML(censoredMessage),\n         $xml = $(xmlDoc),\n         i,\n         secretNode,\n         secretKey;\n      secretNode = $xml.find('desktop-connection');\n      secretNode = Array.prototype.slice.call(secretNode);\n      for (i = 0; i < secretParams.length; i++) {\n         secretKey = secretParams[i];\n         if (typeof($(secretNode).find(secretParams[secretKey]).text())\n            !== 'undefined' &&\n            $(secretNode).find(secretParams[secretKey]).text() !== \"\" &&\n            $(secretNode).find(secretParams[secretKey]).text() !== null) {\n            $(secretNode).find(secretParams[secretKey]).text(\"[REDACTED]\");\n         }\n      }\n\n      return util.XMLToString(xmlDoc);\n   } catch (e) {\n      // Parse document fail\n      return \"CENSORING FAILED\";\n   }\n};\n\n\n/**\n * Get the qurey parameter value\n * @param url the URL\n * @param name the parameter name\n * @returns the parameter value if the url has the parameter.  Otherwise,\n * return null\n */\nRouter.prototype.getParameterByName = function(url, name) {\n   let param, regex, results;\n\n   param = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n   regex = new RegExp(\"[?&]\" + param + \"(=([^&#]*)|&|#|$)\");\n   results = regex.exec(url);\n   if (!results) {\n      return null;\n   }\n   if (!results[2]) {\n      return '';\n   }\n   return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n};\n\n\n/**\n * post messages using xmlhttprequest here, if response is ready, callback\n * onResponse() will be called\n *\n * @param handlerList[in] handlerList is list of handlers who can be sent\n *    together in a single message\n */\nRouter.prototype.postMessage = function(handlerList, async, timeout) {\n   let postMessageText = this.composeMessages(handlerList),\n      handler,\n      i,\n      contextInfo = {},\n      xhrObject,\n      brokerUrl,\n      connector;\n\n   if (this.brokerUrlWithTimestamp) {\n      connector = !!this.getParameterByName(this.brokerUrl, \"mid\") ? '&' : '?';\n      brokerUrl = this.brokerUrl + connector + '_ab=' + $.now();\n   } else {\n      brokerUrl = this.brokerUrl;\n   }\n\n   if (!!postMessageText) {\n      for (i = 0; i < handlerList.length; ++i) {\n         handler = handlerList[i];\n         handler.setState(StateEnum.PENDING);\n      }\n   }\n\n   contextInfo.messageText = postMessageText;\n   contextInfo.requestId = handlerList[0].requestId;\n   contextInfo.requestHandlerList = handlerList;\n   if (async !== undefined && !!timeout) {\n      xhrObject =\n         this.jscdkPost(brokerUrl, contextInfo, this.jscdkSuccess, async,\n            timeout);\n   } else if (async !== undefined) {\n      xhrObject =\n         this.jscdkPost(brokerUrl, contextInfo, this.jscdkSuccess, async);\n   } else {\n      xhrObject = this.jscdkPost(brokerUrl, contextInfo, this.jscdkSuccess);\n   }\n   this.recentXhrObject = xhrObject;\n   for (i = 0; i < handlerList.length; i++) {\n      handler = handlerList[i];\n      handler.setXhrObject(xhrObject);\n   }\n   JSCDKLogger.trace(util.censorMessage(postMessageText));\n\n};\n\n\n/**\n * compose all messages of handlers in handlerList to a single message\n *\n * @param handlerList[in] handlerList is list of handlers who can be sent\n *    together in a single message\n * @return the single message composed\n */\nRouter.prototype.composeMessages = function(handlerList) {\n   let composedMessage = \"\";\n   let brokerVersion = \"\";\n   if (!!globalArray) {\n      brokerVersion = globalArray[\"brokerVersion\"];\n   }\n   composedMessage = util.createXML(handlerList, brokerVersion);\n   return composedMessage;\n};\n\n/**\n * when router receives messages, it will notify message handlers who are\n * registered to it and own these responses.\n *\n * @param responseText [in] responseText to be handled and distributed to\n *    corresponding handlers\n */\nRouter.prototype.onResponse = function(responseData) {\n   let i,\n      j,\n      handler,\n      requestId = responseData.requestId,\n      responseText = responseData.data,\n      requestHandlerList = responseData.requestHandlerList,\n      requestHandler,\n      responseTag,\n      foundHandler = false;\n\n   JSCDKLogger.trace(this.censorResponse(util.XMLToString(responseText)));\n   let responseTagList = this.parseResponseTagList(responseText);\n   for (i = 0; i < responseTagList.length; ++i) {\n      responseTag = responseTagList[i];\n      // get the request handler\n      for (j = 0; j < requestHandlerList.length; j++) {\n         requestHandler = requestHandlerList[j];\n         if (requestHandler.responseTag === responseTag) {\n            // The handler's responseTag equals that of the XML reponse.\n            handler = requestHandler;\n            break;\n         }\n      }\n      if (!handler) {\n         // if a handler is not allow to have mutiple instances, just use\n         // responseTag with no suffix to locate this handler in global array\n         handler = util.getObject(globalArray, responseTag);\n      }\n      if (!handler) { // for handlers who can have mutiple instances\n         // locate this handler by responseTag with requestId suffixed\n         handler = util.getObject(globalArray, responseTag + requestId);\n      }\n      if (!!handler) {\n         this.pushResponseToHandler(handler, responseText);\n         foundHandler = true;\n      }\n   }\n   if (!foundHandler) {\n      requestHandler = requestHandlerList[0];\n      if (!!requestHandler) {\n         this.pushResponseToHandler(requestHandler, responseText);\n      } else {\n         JSCDKLogger.error(\"Unable to locate any handler for response.\");\n      }\n   }\n   /*\n    * Don't clear the handler here because if we do, canceling a broker request and\n    * canceling authentication at about the same time will not be handled correctly.\n    */\n};\n\n/**\n * handles a response from the broker by pushing the response text to the\n * specified handler.\n *\n * @param  handler [in] the handler to be updated with the response\n * @param  responseText [in] the parsed response text to send to the handler.\n */\nRouter.prototype.pushResponseToHandler = function(handler, responseText) {\n   let parsedResult,\n      content = {};\n\n   parsedResult = handler.parseResult(responseText);\n   // XXX TODO: append relative content to properties\n   if (!!parsedResult[\"result\"]) {\n      JSCDKLogger.debug(\n         handler.messageName + \" result: \" + parsedResult[\"result\"]);\n   }\n   content[\"parsedResult\"] = parsedResult;\n   handler.appendContent(content); // store key-value information(state, etc.)\n                                   // in relative handler's \"content\"\n   handler.onUpdated(); // handlers' onUpdated callback here\n};\n\n/**\n * add a new observer into observerList\n *\n * @param  inputHandler [in] the observer handler to be added\n * @param  attributeName [in] name of the attribute whose observerList is\n *    handled\n */\nRouter.prototype.addObserver = function(inputHandler, attributeName) {\n   if ((this.observerList[attributeName]) !== null) {\n      if (typeof this.observerList[attributeName] === \"undefined\") {\n         this.observerList[attributeName] = [];\n      }\n      this.observerList[attributeName].push(inputHandler);\n   }\n};\n\n/**\n * remove a specific observer from observerList\n *\n * @param  inputHandler [in] the observer handler to be removed\n * @param  attributeName [in] name of the attribute whose observerList is\n *    handled\n */\nRouter.prototype.removeObserver = function(inputHandler, attributeName) {\n   let index;\n   let list = this.observerList[attributeName];\n   if (!!list) {\n      index = list.indexOf(inputHandler);\n      if (index > -1) {\n         list.splice(index, 1);\n      }\n   }\n};\n\n/**\n * parse response tags from the response XML\n *\n * @param responseText[in]  response XML of xmlhttprequest\n * @return a list containing all response tags\n */\n\nRouter.prototype.parseResponseTagList = function(responseText) {\n   if (!responseText || (responseText === \"\")) {\n      return null;\n   }\n   let responseTagList = [];\n   let responseBody = $(responseText);\n   let brokerElem = responseBody.find(\"broker\");\n   if (!brokerElem) {\n      JSCDKLogger.error(\"parse response tag error.\");\n      return null;\n   }\n\n   let responseTagElems = brokerElem[0].childNodes;\n   let i;\n   let currentElem;\n   let responseTag;\n   for (i = 0; i < responseTagElems.length; ++i) {\n      currentElem = responseTagElems[i];\n      responseTag = currentElem.nodeName;\n      if (responseTag !== \"#text\") {\n         responseTagList.push(responseTag);\n      }\n   }\n   return responseTagList;\n};\n\n/**\n * post data to server\n *\n * @param  brokerUrl  broker URL\n * @param  contextInfo context data for posting message.\n * @param  jscdkSuccess  callback which will be called\n * @param  async  true(default) represents async, while false(used in test)\n *    represents sync\n * @param  timeout limit of the request posted\n * @return the post status for test\n */\nRouter.prototype.jscdkPost =\n   function(brokerUrl, contextInfo, jscdkSuccess, async, timeout) {\n      let defParamLength = Router.prototype.jscdkPost.length; // Length of\n                                                              // parameters\n                                                              // defined in\n                                                              // function\n      let actParamLength = arguments.length; // Length of actual parameters\n      let settings;\n      let ret; // for test\n      let cacheThis = this;\n      let messageText = contextInfo.messageText;\n      let requestId = contextInfo.requestId;\n      let requestHandlerList = contextInfo.requestHandlerList;\n\n      if (typeof messageText === \"undefined\" ||\n         typeof requestId === \"undefined\") {\n         JSCDKLogger.error(\"ContextInfo struct illegal.\");\n         return null;\n      }\n\n      try {\n         if (defParamLength === actParamLength) {\n            settings = {\n               \"type\": \"POST\",\n               \"url\": brokerUrl,\n               \"data\": messageText,\n               \"cache\": false,\n               \"success\": function(data, textStatus, jscdkXHR) {\n                  var successData = {};\n                  successData.data = data;\n                  successData.requestId = requestId;\n                  successData.requestHandlerList = requestHandlerList;\n                  ret = textStatus;\n                  if (textStatus === \"success\") {\n                     JSCDKLogger.debug(\"jscdkPost with 5 parameters success\");\n                     jscdkSuccess(cacheThis, successData, textStatus, jscdkXHR);\n                  } else if (textStatus === \"error\") {\n                     JSCDKLogger.debug(\n                        \"receive response of xmlhttprequest error\");\n                  }\n               },\n               \"error\": function(jscdkXHR, textStatus, errorThrown) {\n                  cacheThis.jscdkPostError(messageText, jscdkXHR, textStatus,\n                     errorThrown);\n               },\n               \"async\": async,\n               \"timeout\": timeout\n            };\n         } else if (actParamLength === (defParamLength - 1)) {\n            settings = {\n               \"type\": \"POST\",\n               \"url\": brokerUrl,\n               \"data\": messageText,\n               \"cache\": false,\n               \"success\": function(data, textStatus, jscdkXHR) {\n                  var successData = {};\n                  successData.data = data;\n                  successData.requestId = requestId;\n                  successData.requestHandlerList = requestHandlerList;\n                  ret = textStatus;\n                  if (textStatus === \"success\") {\n                     JSCDKLogger.debug(\"jscdkPost with 4 parameters success\");\n                     jscdkSuccess(cacheThis, successData, textStatus, jscdkXHR);\n                  } else if (textStatus === \"error\") {\n                     JSCDKLogger.debug(\n                        \"receive response of xmlhttprequest error\");\n                  }\n               },\n               \"error\": function(jscdkXHR, textStatus, errorThrown) {\n                  cacheThis.jscdkPostError(messageText, jscdkXHR, textStatus,\n                     errorThrown);\n               },\n               \"async\": async\n            };\n         } else if (actParamLength === (defParamLength - 2)) {\n            settings = {\n               \"type\": \"POST\",\n               \"url\": brokerUrl,\n               \"data\": messageText,\n               \"cache\": false,\n               \"success\": function(data, textStatus, jscdkXHR) {\n                  var successData = {};\n                  successData.data = data;\n                  successData.requestId = requestId;\n                  successData.requestHandlerList = requestHandlerList;\n                  ret = textStatus;\n                  if (textStatus === \"success\") {\n                     JSCDKLogger.debug(\"jscdkPost with 3 parameters success\");\n                     jscdkSuccess(cacheThis, successData, textStatus, jscdkXHR);\n                  } else if (textStatus === \"error\") {\n                     JSCDKLogger.debug(\n                        \"receive response of xmlhttprequest error\");\n                  }\n               },\n               \"error\": function(jscdkXHR, textStatus, errorThrown) {\n                  cacheThis.jscdkPostError(messageText, jscdkXHR, textStatus,\n                     errorThrown);\n               }\n            };\n         } else {\n            JSCDKLogger.error(\"post parameter error.\");\n            return null;\n         }\n         if (this.ajaxWasAborted) {\n            ret = null;\n            this.ajaxWasAborted = false;\n         } else {\n            ret = $.ajax(settings);\n         }\n      } catch (err) {\n         JSCDKLogger.error(\"post request error: \" + err);\n         ret = null;\n      }\n      return ret;\n   };\n\n\n/**\n * delete the cookie with specified key for one url.\n * @param url [in] url for the cookie\n * @param key [in] key for the cookie\n *\n * NOTE: not used now.\n */\n\n// Router.prototype.deleteCookie = function(url, key) {\n//    let detail = {};\n//    /*\n//     * XXX TODO: Only implement for Chrome now, add more browsers support\n// when\n//     * needed.\n//     */\n//    if (util.isChromeExtension()) {\n//       detail.url = url;\n//       detail.name = key;\n//       chrome.cookies.remove(detail, function(details) {\n//          JSCDKLogger.debug(\"Cookie is deleted: \" + JSON.stringify(details));\n//       });\n//    } else {\n//       JSCDKLogger.error(\"Delete cookie not implemented for the current\n// browser yet.\"); } };\n\n\n/**\n * callback for the successful response\n *\n * @param  reference[in]  reference of object to call\n * @param  data[in]  a JSON data contains requestId, the reference of request\n *    handler and resposne data.\n * @param  textStatus  response status, can be \"timeout\", \"error\",\n *    \"notmodified\", \"success\", \"parsererror\"\n * @param  jscdkXHR  a super class of XMLHttpRequest\n */\nRouter.prototype.jscdkSuccess =\n   function(reference, data, textStatus, jscdkXHR) {\n      reference.recentXhrObject = {};\n      reference.onResponse(data); // onResponse callback here\n   };\n\n/**\n * set handlers' state to FAIL when jscdkPost error occurs\n * @param contextInfo[in] contextInfo for jscdkPost\n * @return null if request message is invalid, else return \"done\"\n */\nRouter.prototype.jscdkPostError =\n   function(contextInfo, jscdkXHR, textStatus, errorThrown) {\n      let error = {},\n         subError = {},\n         msgerror = {},\n         errorObject,\n         messageText = contextInfo.messageText;\n\n      this.recentXhrObject = {};\n\n      /*\n       * If user cancels http request, don't treat it as an error. In this case,\n       * UI should be controlled by UI layer, so just return \"done\" here.\n       */\n      if (textStatus === \"abort\") {\n         JSCDKLogger.debug(\"User aborts http request.\");\n         return \"done\";\n      }\n\n      if (textStatus === \"timeout\") {\n         errorObject = JSCDKBrokerError.getError(\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_TIMEOUT);\n      } else if (textStatus === \"error\") {\n         errorObject = JSCDKBrokerError.getError(\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_CONNECT_TO_BROKER_ERROR);\n      } else {\n         errorObject = JSCDKBrokerError.getError(\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_CONNECT_TO_BROKER_UNKNOWN);\n      }\n\n      JSCDKLogger.debug(\"jscdkPostError: \" + this.name);\n      subError.errorCode = errorObject.getErrorCode();\n      subError.errorMessage = errorObject.getErrorMessage();\n      subError.userMessage = errorObject.getErrorMessage();\n      msgerror[this.name] = subError;\n      error[\"error\"] = msgerror;\n      this.appendContent(error);\n      this.pushErrorToUser(this);\n      return \"done\";\n   };\n\nfunction ensureTimerStopped() {\n   let idleTimerObject;\n   if (util.brokerSupportApplication()) {\n      idleTimerObject = util.getObject(globalArray, \"idle-timeout-timer\");\n      if (!!idleTimerObject) {\n         idleTimerObject.ensureStopped();\n      }\n   }\n}\n\n/**\n * push coresponding error to user if its condition is satisfied\n * @param handler[in] which handler's error to push\n */\nRouter.prototype.pushErrorToUser = function(handler) {\n   // if the error is special for this handler, alert\n   let messageText,\n      errorAction = {},\n      actionContent = {},\n      cacheThis = this,\n      authInfoObject,\n      getDesktopsObject,\n      getLaunchItemsObject,\n      getTunnelConnObject,\n      getConfigObject,\n      setlocaleAndGetConfiguration = function() {\n         var handlerList,\n            setLocaleObject = globalArray[\"set-locale\"],\n            getConfigurationObject = globalArray[\"get-configuration\"],\n            router = globalArray[\"router\"];\n\n         if (!getConfigurationObject) {\n            JSCDKLogger.error(\n               \"getConfigurationObject do not exist when calling setlocaleAndGetConfiguration()\");\n            return;\n         }\n         getConfigurationObject.setRequestXML();\n         handlerList = getConfigurationObject.composeHandlerList();\n         router.postMessage(handlerList);\n      };\n\n   if (!!handler.content[\"error\"]) {\n      JSCDKLogger.info(\n         \"pushErrorToUser: \" + JSON.stringify(handler.content[\"error\"]));\n      $.each(handler.content[\"error\"], function(errorKey, errorValue) {\n         if (!!handler.name) {\n            actionContent.brokerUrl = encodeURIComponent(cacheThis.brokerUrl);\n         } else if (handler.getMessageName() === \"get-configuration\") {\n            if (errorValue.errorCode ===\n               JSCDKBrokerError.JSCDK_BROKER_ERROR_CONNECT_TO_BROKER_ERROR) {\n               actionContent.brokerUrl =\n                  encodeURIComponent(cacheThis.brokerUrl);\n            }\n         } else if (handler.getMessageName() === \"do-submit-authentication\") {\n            if (errorValue.errorCode ===\n               JSCDKBrokerError.JSCDK_BROKER_ERROR_AUTHENTICATION_FAILED) {\n               getConfigObject = globalArray[\"get-configuration\"];\n               ensureTimerStopped();\n            }\n         } else if (handler.getMessageName() === \"get-authentication-status\") {\n            // broker with new version but session is not authed\n            if (errorValue.errorCode ===\n               JSCDKBrokerError.JSCDK_BROKER_ERROR_NOT_AUTHENTICATED) {\n               if (handler.needCallbackFlag) {\n                  handler.needCallbackFlag = false;\n                  JSCDKLogger.log(\"tab sync fail, the session is expired now\");\n               } else if (handler.workForSilentModeFlag) {\n                  handler.workForSilentModeFlag = false;\n                  JSCDKLogger.log(\n                     \"deal with getAuthenticationStatus response before act in desktop-select page failed, the session is expired now\");\n               } else {\n                  setlocaleAndGetConfiguration();\n                  return;\n               }\n            }\n            // broker with old version\n            if (errorValue.errorCode ===\n               JSCDKBrokerError.JSCDK_BROKER_ERROR_UNRECOGNIZED_CONTENT ||\n               errorValue.errorCode ===\n               JSCDKBrokerError.JSCDK_BROKER_ERROR_UNSUPPORTED_VERSION)// ToCheck:\n                                                                       // need\n                                                                       // this\n                                                                       // condition?\n            {\n               if (!util.brokerSupportApplication()) {\n                  //ignore this error and work as old version\n                  setlocaleAndGetConfiguration();\n                  return;\n               } else {\n                  JSCDKLogger.debug(\n                     \"with new broker but meet error when sending <get-authentication-status>\");\n               }\n            }\n         }\n\n         if (errorValue.errorCode === \"OUT_OF_SEQUENCE_ERROR\") {\n            // ignore this error. \"OUT_OF_SEQUENCE_ERROR\" is only used in\n            // JSCDk, so have no need to be added in JSCDKBrokerError\n            return;\n         } else if (errorValue.errorCode ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_ALREADY_AUTHENTICATED) {\n            prepareForAlreadyAuthenticated();\n         } else if (errorValue.errorCode ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_NOT_AUTHENTICATED) {\n            // Not authenticated\n            if (!!globalArray) {\n               // Get DoSubmitAuthenticationHandler\n               authInfoObject = globalArray[\"do-submit-authentication\"];\n               if (!!authInfoObject) {\n                  // Initialize DoSubmitAuthenticationHandler\n                  authInfoObject.resetData();\n               }\n            }\n            ensureTimerStopped();\n         }\n\n         JSCDKLogger.error(\n            \"error from \" + errorKey + \": \" + errorValue.errorMessage);\n         if (!!errorValue.userMessage || !!errorValue.errorMessage) {\n            if (!!errorValue.userMessage) {\n               messageText = errorValue.userMessage;\n            } else {\n               if (errorValue.errorCode ===\n                  JSCDKBrokerError.JSCDK_BROKER_ERROR_DESKTOPS_ERROR) {\n                  // The error message of 'DESKTOPS_ERROR' is not user\n                  // friendly. Reterm the error message here.\n                  messageText = util._(\n                     \"The connection to the Connection Server has timed out.\");\n               } else {\n                  messageText = errorValue.errorMessage;\n               }\n            }\n            actionContent.errorType = errorValue.errorCode;\n            actionContent.errorText = messageText;\n            actionContent.errorMessage = errorValue.errorMessage;\n            if (!!errorValue.errorDetail) {\n               actionContent.errorDetail = errorValue.errorDetail;\n            }\n            if (!!errorValue.workspaceOneServerHostname) {\n               actionContent.workspaceOneServerHostname =\n                  errorValue.workspaceOneServerHostname;\n            }\n            actionContent.srcHandlerName = errorKey;\n            errorAction.name = \"ShowError\";\n            errorAction.content = actionContent;\n            JSCDKSetUI(JSON.stringify(errorAction));\n            handler.removeFromContent(\"error\"); // clear error data after error\n                                                // is pushed to user\n         }\n         /**\n          * XXX TODO: if userMessage in error doesn't exist, the whole page\n          * will be disabled it should be discussed and updated further\n          */\n      });\n   }\n};\n\n/**\n * append relative content(key-value pairs) to the content of router\n *\n * @param content[in] key-value pair to be appended\n */\nRouter.prototype.appendContent = function(content) {\n   let key;\n   for (key in content) {\n      if (content.hasOwnProperty(key)) {\n         this.content[key] = content[key];\n         JSCDKLogger.debug(this.name + \" this.content[\" + key + \"]: \" +\n            JSON.stringify(this.content[key]));\n      }\n   }\n};\n\n/**\n * remove corresponding content(key-value pairs) from this.content of router\n * @param key[in] key of the item to remove\n */\nRouter.prototype.removeFromContent = function(key) {\n   if (this.content.hasOwnProperty(key)) {\n      delete this.content[key];\n   }\n};\n\n/**\n * get handler by responseTag and suffix\n * @param responseTag[in] responseTag of handler\n * @param suffix[in] desktopId or other to be combined with responseTag\n * @return the available handler\n */\nRouter.prototype.getHandler = function(responseTag, suffix) {\n   let requestId;\n   let handler;\n   requestId = MessageHandler.prototype.requestIdKV[responseTag + suffix];\n   if (!!requestId) {\n      handler = util.getObject(globalArray, responseTag + requestId);\n   }\n   return handler;\n};\n\n/**\n * push self-defined errors to UI which are not returned from broker.\n * @param object[in] object instance who generates this error\n * @param userMessage[in] user message to push\n * @param errorDetail[in] extra info, could be of type object(not including\n *    null)\n */\nRouter.prototype.pushSelfDefinedError =\n   function(object, userMessage, errorDetail) {\n      let errorAction = {};\n      let actionContent = {};\n      let errorKey;\n\n      errorKey = object.name || object.messageName || \"self-defined error\";\n      JSCDKLogger.error(\"error from \" + errorKey + \": \" + userMessage);\n\n      actionContent.errorType = errorKey;\n      actionContent.errorText = userMessage;\n      if (!!errorDetail) {\n         actionContent.errorDetail = errorDetail;\n      }\n      errorAction.name = \"ShowError\";\n      errorAction.content = actionContent;\n      JSCDKSetUI(JSON.stringify(errorAction));\n   };\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/router.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview logservice.js -- logService\n * service to handle logs, depend on log which is defined in\n * appblast-log.js\n */\n\n/**\n *  NOTE: this is the workaround for RTAV workers.\n *  We don't use webpack for these workers as there are many complex function\n *  in them. As a result, we have to use this ugly way to expose 'log' to other\n *  webpack module, but not for worker context.\n */\nvar log;\nif (typeof require === 'function') {\n   log = require('../common/appblast-log');\n}\n\n\nvar RTAV = {};\n\nvar logService = (function() {\n   var ret = {},\n      coreServer = log,\n      functionMap = {\n         \"trace\": \"trace\",\n         \"debug\": \"debug\",\n         \"log\": \"info\",\n         \"warn\": \"warn\",\n         \"devError\": \"error\",\n         \"error\": \"error\"\n      };\n\n   /**\n    * Helper function used to create a string with a desired length by padding\n    * it with preceding zeroes, if necessary.\n    *   pad(1, 5) will return \"00001\".\n    *   pad(\"100\", 1) will return \"100\".\n    *   pad(-1, 5) will return \"-00001\".\n    *   pad(\"-10\", 4) will return \"-0010\".\n    *\n    * @param  {number} value  The number need to be padded\n    * @param  {number} maxLen The padding max length\n    * @return {number}        This returns the number which is padded to the\n    *     appropriate length.\n    */\n   function pad(value, maxLen) {\n      var string = value.toString(),\n         negative = (string.indexOf(\"-\") === 0),\n         length = negative ? string.length - 1 : string.length;\n      return length < maxLen ?\n         pad(negative ? \"-0\" + string.slice(1) : \"0\" + string, maxLen) : string;\n   }\n\n   /**\n    * Get current time as string\n    * @return {string} This returns the current time\n    */\n   function getDataString() {\n      var logTime = new Date();\n\n      return \"[\" + logTime.getFullYear() + \"-\" +\n         pad(logTime.getMonth() + 1, 2) + \"-\" + pad(logTime.getDate(), 2) +\n         \"T\" +\n         pad(logTime.getHours(), 2) + \":\" + pad(logTime.getMinutes(), 2) + \":\" +\n         pad(logTime.getSeconds(), 2) + \".\" +\n         pad(logTime.getMilliseconds(), 3) +\n         \"]: \";\n   }\n\n   /**\n    * Determind whether a object need to be stringified\n    * @param  {any} arg The param we need to print out in the log\n    * @return {boolean} This returns whether the arg will looks better in the\n    *    stringified format\n    */\n   function needStringify(arg) {\n      var needList = ['Event', 'Object'],\n         argType = Object.prototype.toString.call(arg),\n         i;\n\n      for (i = 0; i < needList.length; i++) {\n         if (argType === '[object ' + needList[i] + ']') {\n            return true;\n         }\n      }\n      return false;\n   }\n\n   /**\n    * Return the log function which will print log with current time with\n    * logName\n    * @param  {string} logName The name of log function in the logService\n    * @return {function} This returns the log function corresponding to logName\n    */\n   function getLogFunction(logName) {\n      return function(arg) {\n         var logFunction = coreServer[functionMap[logName]].bind(coreServer),\n            logtext;\n         // stringfy only for real Object, array or other data has better look\n         // in the non-json format\n         if (needStringify(arg)) {\n            logtext = getDataString() + JSON.stringify(arg);\n         } else {\n            logtext = getDataString() + arg;\n         }\n         logFunction(logtext);\n      };\n   }\n\n   /**\n    * Define log functions with key in functionMap\n    */\n   function defineFunctions() {\n      var key;\n      for (key in functionMap) {\n         if (functionMap.hasOwnProperty(key)) {\n            ret[key] = getLogFunction(key);\n         }\n      }\n   }\n\n   /**\n    * Sets the current log level for coreServer.\n    * @param {number} level A interger from [0,4]\n    */\n   ret.setLevel = function(level) {\n      if (!coreServer) {\n         console.error(\n            \"the coreServer is not defined in the RTAV.logService when set log level\");\n      }\n      coreServer.setLevel(level);\n      this.debug(\"the rtav log service is ready, while level is as \" + level);\n   };\n\n   /**\n    * Gets the current log level for coreServer.\n    * @return {number} This returns a interger from [0,4]\n    */\n   ret.getLevel = function() {\n      if (!coreServer) {\n         console.error(\n            \"the coreServer is not defined in the RTAV.logService when get log level\");\n         return 2;\n      }\n      return coreServer.logLevel;\n   };\n\n   defineFunctions();\n\n   return ret;\n}());\n\nRTAV.logService = logService;\n\n/**\n *  NOTE: this is the workaround for RTAV workers.\n */\nif (typeof module !== \"undefined\" && module.exports) {\n   module.exports = RTAV;\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/logservice.js","/******************************************************************************\n * Copyright 2013-2017 VMware, Inc.  All rights reserved.\n *****************************************************************************/\n\n/**\n * appblast-util.js\n *\n *    Initialize a top level namespace for Appblast. This file should be loaded\n *    before others can initialize.\n *\n *    This contains the following:\n *    1. Global constants (AB.CONST)\n *    2. Utility and helper functions that are not appblast specific.\n *       a. AB.LOGGER:  Logging with different log levels.\n *       b. AB.L10N:    String translation with parameter substitution.\n *       c. AB.BASE_64: Base64 encoding and decoding.\n *       d. AB.UTIL:    Utility helper functions.\n *\n *    NOTE: Namespace should be in upper case.\n */\n\nimport $ from 'jquery';\nimport RTAV from '../rtav/logservice';\nimport WMKS from 'WMKS';\nimport log from './appblast-log';\nimport BIG_DEFAULT_ICON_URI from'../../icons/icon-app-282x.png';\nimport SMALL_DEFAULT_ICON_URI from  '../../icons/icon-app-202x.png';\nimport LOADING_ICON_URI from  '../../icons/spinner2x.gif';\nimport ATTENTION_ICON_URI from  '../../icons/attention2x.png';\n\nlet AB = {\n   /*\n    * AB.LOGGER\n    *\n    *    Namespace for log utility. See appblast-log.js.\n    */\n   LOGGER: log,\n\n   /*\n    * AB.initialize()\n    *\n    *    This is an initialization function that overwrites default values\n    *    args - IN: json object containing init values.\n    *        .LOG_LEVEL - See appblast-log.js\n    *        .LOCALE - Locale for locale specific messages. (default: 'en')\n    */\n   initialize: function(args) {\n      if (args) {\n         if (args.LOG_LEVEL !== undefined) {\n            this.LOGGER.setLevel(args.LOG_LEVEL);\n         }\n      }\n   }\n}; // End of AB namespace.\n\n/*\n * AB.CONST\n *\n *    Namespace that holds common constants.\n */\nAB.CONST = {\n   // Based on bug: 958148#2 update.\n   MIN_VERSION: {\n      'IE': 9,\n      'Gecko': 15,\n      'Chrome': 22,\n      'WebKit': 510\n   },\n\n   // See http://api.jquery.com/event.which/\n   CLICK: {\n      'left': 1,\n      'middle': 2,\n      'right': 3\n   },\n\n   // Like Click, but what AppBlast/Windows wants to see\n   RAW_MOUSE: {\n      'leftDown': 0x2,\n      'leftUp': 0x4,\n      'rightDown': 0x8,\n      'rightUp': 0x10,\n      'middleDown': 0x20,\n      'middleUp': 0x40,\n      'wheelmove': 0x800\n   },\n\n   /*\n    * Compensating for JavaScript's lack of enumerated values for the AJAX Ready\n    * State.  Maintenance of this enum does not occur against our own code.\n    * Rather, as the XML HTTP Request object changes over time (thankfully, not\n    * often), this enum must be kept in sync.\n    */\n   XHR_READY_STATE: {\n      'NOT_INITIALIZED': 0,\n      'CONNECTION_ESTABLISHED': 1,\n      'REQUEST_RECEIVED': 2,\n      'PROCESSING_REQUEST': 3,\n      'RESPONSE_READY': 4\n   },\n\n   // Shared between touch and session\n   INVALID_CARET_POS: 0x7fffffff,\n\n   KEY_CODE: {\n      'Shift': 16,\n      'Ctrl': 17,\n      'Alt': 18\n   },\n\n   FORCE_RAW_KEY_CODE: {\n      8: true, // backspace\n      9: true, // tab\n      13: true // newline\n   },\n\n   /*\n    * Compensating for JavaScript's lack of enumerated values for HTTP response codes.\n    */\n   HTTP_RESPONSE_CODE: {\n      'OK': 200,\n      'CREATED': 201,\n      'ACCEPTED': 202,\n      'NON_AUTHORITATIVE_INFORMATION': 203,\n      'NO_CONTENT': 204,\n      'RESET_CONTENT': 205,\n      'PARTIAL_CONTENT': 206,\n\n      'MULTIPLE_CHOICES': 300,\n      'MOVED_PERMANENTLY': 301,\n      'FOUND': 302,\n      'SEE_OTHER': 303,\n      'NOT_MODIFIED': 304,\n      'USE_PROXY': 305,\n      'RESERVED_UNUSED': 306,\n      'TEMPORARY_REDIRECT': 307,\n\n      'BAD_REQUEST': 400,\n      'UNAUTHORIZED': 401,\n      'PAYMENT_REQUIRED': 402,\n      'FORBIDDEN': 403,\n      'NOT_FOUND': 404,\n      'METHOD_NOT_ALLOWED': 405,\n      'NOT_ACCEPTABLE': 406,\n      'PROXY_AUTHENTICATION_REQUIRED': 407,\n      'REQUEST_TIMEOUT': 408,\n      'CONFLICT': 409,\n      'GONE': 410,\n      'LENGTH_REQUIRED': 411,\n      'PRECONDITION_FAILED': 412,\n      'REQUEST_ENTITY_TOO_LARGE': 413,\n      'REQUEST_URI_TOO_LONG': 414,\n      'UNSUPPORTED_MEDIA_TYPE': 415,\n      'REQUESTED_RANGE_NOT_SATISFIABLE': 416,\n      'EXPECTATION_FAILED': 417,\n      /* STORY OF MY LIFE */\n\n      'INTERNAL_SERVER_ERROR': 500,\n      'NOT_IMPLEMENTED': 501,\n      'BAD_GATEWAY': 502,\n      'SERVICE_UNAVAILABLE': 503,\n      'GATEWAY_TIMEOUT': 504,\n      'HTTP_VERSION_NOT_SUPPORTED': 505\n   },\n\n   // Common event click names to be triggered.\n   EVENT_NAME: {\n      // NOTE: We are not using a click event as it closes an open keyboard.\n      // This event trigger toggles the nav item selection.\n      TOGGLE_NAV_SELECTION: 'touchend.toggle_nav_select',\n      // This event trigger launches the menu item.\n      START_NAV_ITEM: 'touchend',\n      // This event triggers a request to send webmks keycodes.\n      BLAST_SEND_KEYCODE: 'blast.send_keycode',\n      // Event triggers a request to send a string input to blast.\n      BLAST_SEND_STRING: 'blast.send_string',\n      // Event triggers a request to toggle high-resolution mode.\n      BLAST_HIGH_RES_MODE: 'blast.toggle_high_res_mode',\n      // Event to request html element repositioning so it stays within the canvas region.\n      BLAST_ELEMENT_REPOSITION: 'blast.reposition',\n      // This event trigger invokes handlePageFlow() which either closes the window or takes user to the previous page.\n      // and if non existant, it closes with window.\n      CLOSE_WINDOW: 'close_window.toolbar',\n      // This event trigger a toggle request on the gesture guide.\n      TOGGLE_GESTURE_HELP: 'toolbar.toggle_gesture_guide'\n   },\n\n   ZOOM_TYPE: {\n      CUSTOM: 'custom',\n      NATIVE: 'native'\n   },\n\n   // Constants related to cookies.\n   COOKIE: {\n      cookieName: 'VMwareBlast', // Name of a cookie - store user state / pref.\n      delimitter: '||', // Use to separate the cookie key=value pairs.\n      gestureHelp: 'gH', // Gesture guide is only shown the first time.\n      audioWarn: 'aW', // Audio warning shown first time.\n      clipboardHelp: 'cpH' // copy/paste help dialog shown.\n   },\n\n   /*\n    * Defines disconnection codes for all of our expected disconnection cases.\n    * The codes 3000-3999 are reserved for client use, so we can define our own\n    * error codes.\n    */\n   DISCONNECT_REASON: {\n      RECONNECT_FAILED: 3000,\n      HEARTBEAT_TIMEOUT: 3001,\n      DISCONNECT_REQUEST_TIMEOUT: 3002,\n      IDLE_TIMEOUT: 3003\n   },\n\n   /*\n    * Defines the different types of running/available items, in order of priority\n    * on the sidebar display. These numbers will be used to sort the lists of running\n    * and available items for display, with 0 displayed first, then 1, and such\n    */\n   ITEMS_TYPE: {\n      LOADING_ITEM: 0, // placeholder item that holds all connecting sessions\n      LOADING_APP: 1, // placeholder for apps that have not received app data\n      NEED_ATTENTION: 2, // session placeholders for unity paused sessions\n      DESKTOP: 3,\n      APP: 4\n   },\n\n   /*\n    * Defines the different running item states. States are only assigned on actual\n    * running items as opposed to placeholder items (LOADING_ITEM, NEED_ATTENTION)\n    * to signal the UI to display them differently on the sidebar.\n    */\n   ITEMS_STATE: {\n      CONNECTED: 0,\n      CONNECTING: 1,\n      DISCONNECTED: 2\n   },\n\n   ICONS: {\n      BIG_DEFAULT_ICON: BIG_DEFAULT_ICON_URI,\n      SMALL_DEFAULT_ICON: SMALL_DEFAULT_ICON_URI,\n      LOADING_ICON: LOADING_ICON_URI,\n      ATTENTION_ICON: ATTENTION_ICON_URI\n   },\n\n   // Miscellaneous constants.\n   DIALOG_PARENT_ID: '#dialog-holder', // The div id where dialogs/event triggers are tied to.\n   CANVAS_PARENT_ID: '#canvas-container', // This is used to position dialogs.\n   CANVAS_ID: 'canvas' // Canvas id to be used globally.\n}; // End of AB.CONST namespace\n\n/*\n * AB.UTIL\n *\n *    Namespace that holds helper functions that are globally used.\n */\nAB.UTIL = {\n   // Stores the server side global information in JSON.\n   // Ex: version, build number, deployMode, etc.\n   // TODO: Its better to sync up with Blast server for min screen size.\n   INFO: {\n      copyEnabled: false,\n      pasteEnabled: false,\n      clipboardMaxSize: 5000, // Max size of copy paste dialog to use.\n      minScreenWidth: 320, // Min screen width thats allowed.\n      minScreenHeight: 240, // Min screen height thats allowed.\n      version: __VDM_WEB_CLIENT_VERSION__, // Display version, defined in defs.mk.\n      buildNum: __BUILD_NUMBER__,\n      acceptLanguage: 'en-US',\n      deployMode: 'default'\n   },\n\n   conversionCanvas: null,\n\n   /**\n    * isLoadingItem\n    *\n    * Checks if a running/entitled item is the loading sessions item\n    *\n    * @param item: the item instance to be checked\n    */\n   isLoadingItem: function(item) {\n      return (item.type === AB.CONST.ITEMS_TYPE.LOADING_ITEM);\n   },\n\n   /**\n    * isLoadingApp\n    *\n    * Checks if a running/entitled item is a loading app\n    *\n    * @param item: the item instance to be checked\n    */\n   isLoadingApp: function(item) {\n      return (item.type === AB.CONST.ITEMS_TYPE.LOADING_APP);\n   },\n\n   /**\n    * isNeedAttention\n    *\n    * Checks if a running/entitled item is a need attention item\n    *\n    * @param item: the item instance to be checked\n    */\n   isNeedAttention: function(item) {\n      return (item.type === AB.CONST.ITEMS_TYPE.NEED_ATTENTION);\n   },\n\n   /**\n    * isDesktop\n    *\n    * Checks if a running/entitled item is a desktop\n    *\n    * @param item: the item instance to be checked\n    */\n   isDesktop: function(item) {\n      return (item.type === AB.CONST.ITEMS_TYPE.DESKTOP);\n   },\n\n   /**\n    * WMKS does not provide a method to tell if it's iPhone device.\n    * Add this one here.\n    */\n   isIPhone: function() {\n      return window.navigator.userAgent.toLowerCase().indexOf('iphone') > -1;\n   },\n\n   /**\n    * isApp\n    *\n    * Checks if a running/entitled item is an app. Loading apps are considered as apps\n    * that have not yet received attribute data, but can otherwise be treated as a\n    * functional app item.\n    *\n    * @param item: the item instance to be checked\n    */\n   isApp: function(item) {\n      return (item.type === AB.CONST.ITEMS_TYPE.LOADING_APP ||\n         item.type === AB.CONST.ITEMS_TYPE.APP);\n   },\n\n   /**\n    * isConnected\n    *\n    * Checks if a running item is connected\n    *\n    * @param item: the item instance to be checked\n    */\n   isConnected: function(item) {\n      return (item.state === AB.CONST.ITEMS_STATE.CONNECTED);\n   },\n\n   /**\n    * isConnecting\n    *\n    * Checks if a running item is connecting\n    *\n    * @param item: the item instance to be checked\n    */\n   isConnecting: function(item) {\n      return (item.state === AB.CONST.ITEMS_STATE.CONNECTING);\n   },\n\n   /**\n    * isDisconnected\n    *\n    * Checks if a running item is disconnected\n    *\n    * @param item: the item instance to be checked\n    */\n   isDisconnected: function(item) {\n      return (item.state === AB.CONST.ITEMS_STATE.DISCONNECTED);\n   },\n\n   /**\n    * isUsingWebcam\n    *\n    * Checks if a running item is using the rtav devices\n    * Only show icons for Desktops\n    *\n    * @param item: the item instance to be checked\n    */\n   isUsingWebcam: function(item) {\n      return this.isDesktop(item) &&\n         RTAV.resourceManager.hasOccupiedResources(item.wmksKey) &&\n         RTAV.wmksAdapter.isUsingDevices(item.wmksKey, 'video');\n   },\n\n   /**\n    * isAskingWebcam\n    *\n    * Checks if the premission of a device is being asked.\n    *\n    * @param item: the item instance to be checked\n    */\n   isAskingWebcam: function(item) {\n      return RTAV.wmksAdapter.isAskingPremission(item.wmksKey, 'video');\n   },\n\n   /**\n    * isUsingMicrophone\n    *\n    * Checks if a running item is owning the rtav devices\n    * Only show icons for Desktops\n    *\n    * @param item: the item instance to be checked\n    */\n   isUsingMicrophone: function(item) {\n      return this.isDesktop(item) &&\n         RTAV.resourceManager.hasOccupiedResources(item.wmksKey) &&\n         RTAV.wmksAdapter.isUsingDevices(item.wmksKey, 'audio');\n   },\n\n   /**\n    * isAskingMicrophone\n    *\n    * Checks if the premission of a device is being asked.\n    *\n    * @param item: the item instance to be checked\n    */\n   isAskingMicrophone: function(item) {\n      return RTAV.wmksAdapter.isAskingPremission(item.wmksKey, 'audio');\n   },\n\n   /**\n    * closeRTAVDevices\n    *\n    * close the devices RTAV is using\n    */\n   closeRTAVDevices: function(item) {\n      RTAV.resourceManager.closeDevices(item.wmksKey);\n   },\n\n   /*\n    * bgraMapToPNG\n    *\n    *    Converts a bgra bitmap (Uint8ClampedArray) to a PNG format\n    *\n    *    returns a PNG formatted data string for web (data:image/png;base64...)\n    */\n   bgraMapToPNG: function(bgra, width, height) {\n      let canvas, context, imageData, x, y, bgraIndex, imageIndex;\n      try {\n         // Use a canvas to convert the bitmap image format to png\n         if (!this.conversionCanvas) {\n            this.conversionCanvas = document.createElement('canvas');\n            if (!this.conversionCanvas.getContext) {\n               this.conversionCanvas = null;\n               return \"\";\n            }\n         }\n\n         canvas = this.conversionCanvas;\n\n         canvas.width = width;\n         canvas.height = height;\n         context = canvas.getContext(\"2d\");\n         imageData = context.createImageData(width, height);\n\n         // Individually write each pixel to canvas data\n         for (x = 0; x < width; x++) {\n            for (y = 0; y < height; y++) {\n               // format is bottom-to-top, convert to top-to-bottom\n               bgraIndex = 4 * (x + width * y);\n               imageIndex = 4 * (x + width * (height - 1 - y));\n\n               // convert bgra pixel to rgba\n               imageData.data[imageIndex] = bgra[bgraIndex + 2];\n               imageData.data[imageIndex + 1] = bgra[bgraIndex + 1];\n               imageData.data[imageIndex + 2] = bgra[bgraIndex];\n               imageData.data[imageIndex + 3] = bgra[bgraIndex + 3];\n            }\n         }\n         context.putImageData(imageData, 0, 0);\n         // extracts image data in 'data:image/png;base64' format\n         return canvas.toDataURL('image/png');\n      } catch (e) {\n         return \"\";\n      }\n   },\n\n   /*\n    * getClipboardText\n    *\n    *    Gets text data from the user's clipboard.\n    *    e - a copy or paste event from the browser, is required for non-IE\n    *    browsers because they store clipboard data on the event\n    *\n    * @param windowObject the window object to use, if undefined the global window\n    *                     object will be used. The normal use case is for this to be\n    *                     undefined, but we use the parameter for unit tests where we\n    *                     do not want to manipulate the actual window object.\n    */\n   getClipboardText: function(e, windowObject) {\n\n      /* istanbul ignore if */\n      if (!windowObject) {\n         windowObject = window;\n      }\n\n      if (e && e.originalEvent && e.originalEvent.clipboardData) {\n         // For non-IE browsers\n         return e.originalEvent.clipboardData.getData(\"text/plain\");\n      } else if (windowObject.clipboardData) {\n         // For IE\n         return windowObject.clipboardData.getData(\"text\");\n      }\n      return \"\";\n   },\n\n   /*\n    * setClipboardText\n    *\n    *    Sets text data on the user's clipboard.\n    *    e - a copy or paste event from the browser, is required for non-IE\n    *    browsers because they store clipboard data on the event\n    *    text - the text to be pasted to clipboard\n    *\n    * @param windowObject the window object to use, if undefined the global window\n    *                     object will be used. The normal use case is for this to be\n    *                     undefined, but we use the parameter for unit tests where we\n    *                     do not want to manipulate the actual window object.\n    */\n   setClipboardText: function(e, text, windowObject) {\n\n      /* istanbul ignore if */\n      if (!windowObject) {\n         windowObject = window;\n      }\n\n      if (e && e.originalEvent && e.originalEvent.clipboardData) {\n         // For non-IE browsers\n         e.originalEvent.clipboardData.setData(\"text/plain\", text);\n      } else if (windowObject.clipboardData) {\n         // For IE\n         windowObject.clipboardData.setData(\"text\", text);\n      }\n   },\n\n   /*\n    * getAppIconIndex\n    *\n    *    return a proper icon index from an icon set.\n    *    If we have target size icon, we will use it.\n    *    Otherwise, use the next larger icon.\n    *    Otherwise, use the next smaller icon.\n    *    Otherwise, we return -1 to index there is no icon found.\n    *\n    * param icons a set of icon candidate.\n    * param targetIconSize icon size we are looking for.\n    */\n   getAppIconIndex: function(icons, targetIconSize) {\n      let iconIndex = -1,\n         i,\n         currentSelectedIconSize = 0,\n         currentIconSize = 0;\n      for (i in icons) {\n         /* istanbul ignore else */\n         if (icons.hasOwnProperty(i)) {\n            // Assume the width is always equal to height;\n            currentIconSize = parseInt(icons[i].width, 10);\n            if (currentIconSize === targetIconSize) {\n               currentSelectedIconSize = currentIconSize;\n               iconIndex = i;\n               break;\n            } else if (currentIconSize > targetIconSize) {\n               // Find the closest larger icon.\n               if (currentSelectedIconSize < targetIconSize ||\n                  currentIconSize < currentSelectedIconSize) {\n                  currentSelectedIconSize = currentIconSize;\n                  iconIndex = i;\n               }\n            } else {\n               // Find the closest smaller icon\n               if (currentIconSize > currentSelectedIconSize &&\n                  currentSelectedIconSize < targetIconSize) {\n                  currentSelectedIconSize = currentIconSize;\n                  iconIndex = i;\n               }\n            }\n         }\n      }\n      return iconIndex;\n   },\n\n   /**\n    *\n    * getDesiredResolution\n    *\n    * This function computes the desired resolution for the desktop for all\n    * device and desktop browsers.\n    *\n    * @param windowObject the window object to use, if undefined the global window\n    *                     object will be used. The normal use case is for this to be\n    *                     undefined, but we use the parameter for unit tests where we\n    *                     do not want to manipulate the actual window object.\n    *\n    * @param wmks the wmks Object to use, if undefined the global wmks object will be\n    *             used. This is for unit testing purposes to avoid modifying a global\n    *             object.\n    *\n    * return a JSON object containing width and height.\n    */\n   getDesiredResolution: function(windowObject, wmks) {\n      let w, h, scale;\n\n      /* istanbul ignore if */\n      if (!windowObject) {\n         windowObject = window;\n      }\n\n      /* istanbul ignore if */\n      if (!wmks) {\n         wmks = WMKS;\n      }\n\n      if (wmks.BROWSER.isIOS() || wmks.BROWSER.isAndroid()) {\n         /*\n            For more information please refer 1572136\n            For iOS 9, we need to use document.documentElement.clientWidth/clientHeight\n         */\n         w = windowObject.document.documentElement.clientWidth;\n         h = windowObject.document.documentElement.clientHeight;\n      } else if (wmks.BROWSER.isTouchDevice()) {\n\n         if (wmks.UTIL.TOUCH.isPortraitOrientation()) {\n            w = windowObject.screen.width;\n         } else {\n            w = windowObject.screen.height;\n         }\n\n         // Calculate the viewport scale.\n         scale = w / windowObject.innerWidth;\n         // Calculate the screen height.\n         h = Math.floor(windowObject.innerHeight * scale);\n      } else {\n         /*\n          * In desktop mode on a desktop, resize the desktop to fit the browser\n          * window, not the size of the whole local screen.\n          */\n         w = windowObject.innerWidth;\n         h = windowObject.innerHeight;\n\n      }\n\n      return [w, h];\n   },\n\n\n   /**\n    * getTouchDeviceDesiredResolution\n    *\n    * orientationchange is fired after window.orientation\n    * property has changed, but before the orientation is reflected in the UI.\n    * Inspecting dimensions of elements (e.g. window.innerWidth or window.innerHeight)\n    * gives the dimensions of the elements in the pre-orientation change state.\n    *\n    * There is no way to capture the end of the orientation change event because\n    * handling of the orientation change varies from browser to browser. Drawing\n    * a balance between the most reliable and the fastest way to detect the end\n    * of orientation change requires racing interval and timeout.\n    *\n    */\n   getTouchDeviceDesiredResolution: function(callback, windowObject) {\n      let noChangeCountToEnd = 100,\n         noEndTimeout = 1000,\n         interval,\n         timeout,\n         end,\n         lastClientWidth,\n         lastClientHeight,\n         noChangeCount;\n\n      /* istanbul ignore if */\n      if (!windowObject) {\n         windowObject = window;\n      }\n\n      end = function () {\n         clearInterval(interval);\n         clearTimeout(timeout);\n\n         interval = null;\n         timeout = null;\n         // \"orientationchangeend\"\n         callback([lastClientWidth, lastClientHeight]);\n      };\n\n      interval = setInterval(function () {\n         if (windowObject.document.documentElement.clientWidth === lastClientWidth &&\n            windowObject.document.documentElement.clientHeight === lastClientHeight) {\n            noChangeCount++;\n\n            if (noChangeCount === noChangeCountToEnd) {\n               end();\n            }\n         } else {\n            lastClientWidth = windowObject.document.documentElement.clientWidth;\n            lastClientHeight = windowObject.document.documentElement.clientHeight;\n            noChangeCount = 0;\n         }\n      });\n      timeout = setTimeout(function () {\n         // The timeout happened first.\n         end();\n      }, noEndTimeout);\n   },\n\n   /*\n    * isMP4Supported\n    *\n    * Test if media source object is supported on this browser.\n    * For EA, we only support Chrome browser for now.\n    *\n    *\n    * @param windowObject the window object to use, if undefined the global window\n    *                     object will be used. The normal use case is for this to be\n    *                     undefined, but we use the parameter for unit tests where we\n    *                     do not want to manipulate the actual window object.\n    *\n    * @param wmks the wmks Object to use, if undefined the global wmks object will be\n    *             used. This is for unit testing purposes to avoid modifying a global\n    *             object.\n    *\n    */\n   isMP4Supported: function(windowObject, wmks) {\n      let isMediaSourceSupported = true,\n         testObject = null;\n\n      /* istanbul ignore if */\n      if (!windowObject) {\n         windowObject = window;\n      }\n\n      /* istanbul ignore if */\n      if (!wmks) {\n         wmks = WMKS;\n      }\n\n      // For MP4 feature, we only support Chrome browser 45 and above.\n      if (!wmks.BROWSER.isChrome() || (wmks.BROWSER.version.major < 45) || WMKS.BROWSER.isAndroid()) {\n         return false;\n      }\n\n      try {\n         windowObject.MediaSource = windowObject.MediaSource || windowObject.WebKitMediaSource;\n         testObject = new windowObject.MediaSource();\n         testObject = null;\n      } catch (e) {\n         isMediaSourceSupported = false;\n      }\n\n      return isMediaSourceSupported;\n   },\n\n   /*\n    * isRTAVSupported\n    *\n    * We donn't support RTAV on IE and Safari\n    *\n    * @param wmks the wmks Object to use, if undefined the global wmks object will be\n    *             used. This is for unit testing purposes to avoid modifying a global\n    *             object.\n    */\n   isRTAVSupported: function(wmks) {\n      /* istanbul ignore if */\n      if (!wmks) {\n         wmks = WMKS;\n      }\n\n      // For RTAV feature, we don't support IE and Safari.\n      return !((wmks.BROWSER.isIE() && wmks.BROWSER.version.major <= 11) || wmks.BROWSER.isSafari());\n   },\n\n   /*\n    * loadConfigInfo\n    *\n    *    Loads server side info containing the following.\n    *    0. Internal version (1.0.0)\n    *    1. Version (2.2)\n    *    2. Build number (123456)\n    *    3. toolbar type - Identifies the toolbar to load.\n    */\n   loadConfigInfo: function(ajaxMethod) {\n      let self = this;\n\n      ajaxMethod({\n         type: 'GET',\n         url: '../info.jsp',\n         dataType: 'json',\n         cache: false,\n         async: false,\n         success: function(infoData) {\n            if (infoData) {\n               if (infoData.acceptLanguage) {\n                  self.INFO.acceptLanguage = infoData.acceptLanguage;\n               }\n\n               if (infoData.clientVersion) {\n                  self.INFO.internalVersion = infoData.clientVersion;\n                  let splitVersionInfo = infoData.clientVersion.split('-');\n                  self.INFO.version = splitVersionInfo[0];\n                  self.INFO.buildNum = splitVersionInfo[1];\n\n                  // Todo: Replace with real data\n                  self.INFO.deployMode = \"view\";\n                  self.INFO.clipboardMaxSize = 5000;\n                  self.INFO.copyEnabled = false;\n                  self.INFO.pasteEnabled = false;\n               }\n            } else {\n               AB.LOGGER.error('Invalid /info json response.');\n            }\n         },\n         error: function() {\n            AB.LOGGER.error('Error loading /info from server.');\n         }\n      });\n   },\n\n   /*\n    * clamp\n    *\n    *    Given three parameters value, minValue, maxValue returns:\n    *       minValue if value < minValue\n    *       maxValue if min > maxValue\n    *       otherwise returns value\n    *    In the case where minValue > maxValue the behavior is undefined\n    */\n   clamp: function(value, minValue, maxValue) {\n      return Math.min(maxValue, Math.max(value, minValue));\n   },\n\n   /*\n    * returnToLauncher\n    *\n    *    Redirects the client back to the launcher page\n    *\n    * @param windowObject the window object to use, if undefined the global window\n    *                     object will be used. The normal use case is for this to be\n    *                     undefined, but we use the parameter for unit tests where we\n    *                     do not want to manipulate the actual window object.\n    */\n   returnToLauncher: function(windowObject) {\n      let launchPageURL;\n\n      /* istanbul ignore if */\n      if (!windowObject) {\n         windowObject = window;\n      }\n\n      // Redirect us back to main launcher page. We cannot use\n      // window.document.referrer because if the user came in here by using a URI\n      // then the referrer will just return us to the client\n      if (!windowObject.location.origin) {\n         launchPageURL = windowObject.location.protocol + \"//\" +\n            windowObject.location.hostname +\n            (windowObject.location.port ? ':' + windowObject.location.port : '');\n      } else {\n         launchPageURL = windowObject.location.origin;\n      }\n\n      windowObject.location.href = launchPageURL;\n   },\n\n   /*\n    * itemNameContainsQuery\n    *\n    *    Predicate that returns where an item's name property matches a query\n    *    string. Returns true if query === \"\" or if the item name contains query.\n    *    This does a case insensitive comparison.\n    */\n   itemNameContainsQuery: function(item, query) {\n      if (query === \"\") {\n         return true;\n      }\n\n      // Use indexOf along with toLocaleLowerCase() to see if the search string\n      // is in the item\n      return (item.name.toLocaleLowerCase().indexOf(\n         query.toLocaleLowerCase()) !== -1);\n   },\n\n   /*\n    * itemSortHelper\n    *\n    *    Help function is used in Array.sort(). We always put desktop item on the\n    *    top of list. If it is the same type, follow the alphabet order.\n    */\n   itemSortHelper: function(item1, item2) {\n      if (item1.type === item2.type) {\n         // If it is the same type, sort the item by alphabet order.\n         if (item1.name === item2.name) {\n            return 0;\n         } else {\n            return item1.name > item2.name ? 1 : -1;\n         }\n      } else {\n         return item1.type > item2.type ? 1 : -1;\n      }\n   },\n\n   /**\n    * @return {Boolean} This returns whether current browser is IE with version equal\n    *    or lower than 11 which doesn't postMessage well.\n    */\n   supportPostMessage: function() {\n      let ua = window.navigator.userAgent.toLowerCase();\n      let isIE = ua.indexOf('msie') > -1 || ua.indexOf('trident') > -1;\n      let isEdge = ua.indexOf('edge') > -1;\n      return !isIE || isEdge;\n   }\n\n}; // End of AB.UTIL namespace\n\n/*\n * Initialize the AB namespace with dynamic content from the server side.\n */\n\n// Load and store the server info data including version, build, etc.\nAB.UTIL.loadConfigInfo($.ajax);\n\nexport default AB;\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/appblast-util.js","var path = 'common/commondialog/dialog_service_error.html';\nvar html = \"<div class=\\\"dialog-title\\\">{{(ngDialogData.title) || ('ERROR' | i18n)}}</div>\\n<div class=\\\"dialog-content\\\">\\n   <div class=\\\"session-ops-window-text\\\">{{ngDialogData.errorMessage}}</div>\\n</div>\\n<div class=\\\"dialog-button-row\\\" dialog-tab-scope>\\n   <button class=\\\"modal-button-base modal-button-right modal-button-blue\\\" ng-click=\\\"close() || closeThisDialog()\\\"  id=\\\"closeDialogBtn\\\" dialog-tabindex=\\\"1\\\" dialog-prevent-key-up>\\n      {{(ngDialogData.buttonLabel) || ('OK' | i18n)}}\\n   </button>\\n</div>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./common/commondialog/dialog_service_error.html\n// module id = 10\n// module chunks = 0","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * mksvchan.js --\n *\n * Interface used to send and receive MKSVchan RPCs and updates.\n */\n\nimport WMKS from 'WMKS';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport VDPService from './vdpservice';\nimport StringUtils from '../common/string-utils';\n\n\nlet MKSVchan = {\n   // Some constants copied from bora/apps/rde/mksvchan\n   PACKET_TYPE: {\n      CLIPBOARD_DATA_TEXT: 0,\n      CLIPBOARD_REQUEST: 1,\n      CLIPBOARD_DATA_CP: 2,\n      CLIPBOARD_CAPABILITIES: 3,\n      CLIPBOARD_LOCALE: 4,\n      FILE_TRANSFER_REQUEST: 5,\n      FILE_TRANSFER_DATA_FILE: 6,\n      FILE_TRANSFER_CONFIG: 7,\n      FILE_TRANSFER_ERROR: 8\n   },\n\n   CAPABILITY_CLIPBOARD: {\n      TEXT: 0,\n      IMAGE_AND_RTF: 1,\n      NOTIFY_ON_CHANGE: 2\n   },\n\n   CLIPBOARD_ERROR: {\n      NONE: 0,\n      MAX_LIMIT_EXCEEDED: 1\n   },\n\n   FILE_TRANSFER_FILE_TYPE: {\n      FILE: 0,\n      DIRECTORY: 1,\n      SYMLINK: 2\n   },\n\n   FILE_TRANSFER_POLICY: {\n      MIN: 0,\n      DISABLED: 0,\n      DEFAULT: 0,\n      BIDIRECTIONAL: 1,\n      ONLY_TO_SERVER: 2,\n      ONLY_TO_CLIENT: 3,\n      MAX: 3\n   },\n\n   FILE_TRANSFER_ERROR: {\n      NO_ENOUGH_DISK: 0,\n      IS_TRANSFERRING: 1,\n      UNKNOWN_ERROR: 2,\n      PRINT_TIMEOUT: 3\n   },\n\n   FILE_TRANSFER_REQUEST: {\n      SEND_FILES: 0,\n      CANCEL_SEND_FILES: 1,\n      SEND_SPECIFIC_FILES: 2,\n      CANCEL_SEND_SPECIFIC_FILES: 3,\n      CANCEL_RECEIVE_SPECIFIC_FILE: 4,\n      // New added file list format\n      FILE_LIST: 5,\n      PRINT_CONFIG: 6\n   },\n\n   FILE_TRANSFER_CLIENT: {\n      WINDOWS: 0,\n      MAC: 1,\n      LINUX: 2,\n      WEB: 3,\n      ANDROID: 4,\n      IOS: 5\n   },\n\n   FILE_TRANSFER_CONSUMER: {\n      FT: 0,\n      PRINT: 1,\n      DEFAULT: 0,\n      MIN: 0,\n      MAX: 1\n   },\n\n   FILE_TRANSFER_MAX_FILE_SIZE: 1024 * 1024 * 500,\n   FILE_TRANSFER_MAX_TOTAL_SIZE: 1024 * 1024 * 1000,\n\n   /**\n    * The capability bit that enables automatic mksVchan updates on clipboard\n    * change. When this capability is enabled, we will listen to mksVchan's\n    * automatic updates, rather than the old updates from Blast, which will be\n    * disabled by agent.\n    */\n   ENABLE_NOTIFY_ON_CHANGE: (1 << 8),\n\n   /*\n    * The current limit for MAX_BYTES_TEXT comes from the mksVchanPlugin, see\n    * MKSVchanPlugin_GetCapsMaxClipboardBytes. The limit is 1mb (minus header)\n    * since the new clipboard functionality was added.\n    */\n   MAX_BYTES_TEXT: 1024 * 1024 - 100,\n   MAX_BYTES_IMAGE_AND_RTF: 1024 * 1024,\n   MAX_KBYTES_IMAGE_AND_RTF: 1024,\n\n   CHANNEL_NAME_PREFIX: \"RPC#MKSVchan#\",\n   CHANNEL_DATA_OBJECT: \"MKSVchanDataObj\",\n   CHANNEL_CTRL_OBJECT: \"MKSVchanControlObj\",\n\n\n   /**\n    * List of data formats that the clipboard supports\n    * Copied from bora/lib/public/dnd.h\n    * NOTE: View does not support all of these\n    * @enum {Number}\n    */\n   CP_FORMAT: {\n      UNKNOWN: 0,\n      MIN: 1,\n      TEXT: 1,\n      FILELIST: 2,\n      RTF: 3,\n      FILELIST_URI: 4,\n      FILECONTENTS: 5,\n      IMG_PNG: 6,\n      FILEATTRIBUTES: 7,\n      BIFF12: 8,\n      ART_GVML_CLIPFORMAT: 9,\n      HTML_FORMAT: 10,\n      MAX: 11\n   },\n\n\n   /**\n    * Create a new clipboard object\n    *\n    * @classdesc\n    *    A clipboard object which handles every data format.\n    *    Mimics lib/dnd/dndClipboard CPClipboard_x\n    * @constructor\n    * @return {MKSVchan.Clipboard}\n    */\n   Clipboard: function() {\n      let items,\n         changed;\n\n      /**\n       * Clear the data in the clipboard.\n       */\n      this.clear = function() {\n         let i;\n         items = [];\n         changed = false;\n\n         for (i = MKSVchan.CP_FORMAT.MIN; i < MKSVchan.CP_FORMAT.MAX; ++i) {\n            items[i] = null;\n         }\n      };\n\n      // Call this.clear to initialise the clipboard\n      this.clear();\n\n\n      /**\n       * Return the total size of the data stored in the clipboard.\n       *\n       * @return {Number} size\n       *    Size of all data in the clipboard.\n       */\n      this.getTotalSize = function() {\n         let size = 0,\n            i;\n\n         for (i = 0; i < items.length; ++i) {\n            size += items[i] ? items[i].byteLength : 0;\n         }\n\n         return size;\n      };\n\n\n      /**\n       * Return the clipboard item for the specified format.\n       *\n       * @param  {MKSVchan.CP_FORMAT} format\n       *    The item format.\n       * @return {Uint8Array?} data\n       *    The data in the clipboard, or null.\n       */\n      this.getItem = function(format) {\n         if (format < MKSVchan.CP_FORMAT.MIN ||\n            format > MKSVchan.CP_FORMAT.MAX) {\n            JSCDKLogger.error('Clipboard.getItem invalid format');\n            return null;\n         }\n\n         return items[format];\n      };\n\n\n      /**\n       * Set the clipboard data for a specific format.\n       *\n       * Will automatically attempt to trim text data to fit, or attempt to\n       * trim the clipboard's existing text data to fit non-text data.\n       *\n       * @param {MKSVchan.CP_FORMAT} format\n       *    The format of the data to set.\n       * @param {Uint8Array} data\n       *    The actual data to set.\n       * @return {Boolean} success\n       *    Returns true on success, false on failure\n       */\n      this.setItem = function(format, data) {\n         let size,\n            excess,\n            text;\n\n         if (format < MKSVchan.CP_FORMAT.MIN ||\n            format > MKSVchan.CP_FORMAT.MAX) {\n            JSCDKLogger.error('Clipboard.setItem invalid format');\n            return false;\n         }\n\n         if (data && !(data instanceof Uint8Array)) {\n            JSCDKLogger.error(\n               'Clipboard.setItem expects data to be a Uint8Array');\n            return false;\n         }\n\n         // Get size of current clipboard contents\n         size = this.getTotalSize();\n\n         // If we are replacing an item, subtract size of item we are replacing\n         if (!!items[format]) {\n            size -= items[format].byteLength;\n         }\n\n         // Add size of new clipboard contents\n         if (data) {\n            size += data.byteLength;\n         }\n\n         // Ensure we do not exceed the maximum clipboard data size\n         if (size >= MKSVchan.MAX_BYTES_IMAGE_AND_RTF) {\n            excess = size - MKSVchan.MAX_BYTES_IMAGE_AND_RTF;\n\n            if (format === MKSVchan.CP_FORMAT.TEXT) {\n               // Attempt to trim excess from the new text data\n               if (excess < data.byteLength) {\n                  JSCDKLogger.debug('Clipboard.setItem has trimmed ' + excess +\n                     ' bytes from the new text data');\n                  data = data.subarray(0, data.byteLength - excess);\n                  excess = 0;\n               }\n            } else if (items[MKSVchan.CP_FORMAT.TEXT]) {\n               // Attempt to trim excess from existing text item to fit new data\n               text = items[MKSVchan.CP_FORMAT.TEXT];\n\n               if (excess < text.byteLength) {\n                  JSCDKLogger.debug('Clipboard.setItem has trimmed ' + excess +\n                     ' bytes from existing text data');\n                  items[MKSVchan.CP_FORMAT.TEXT] =\n                     text.subarray(0, text.byteLength - excess);\n                  excess = 0;\n               }\n            }\n\n            if (excess > 0) {\n               JSCDKLogger.debug(\n                  'Clipboard.setItem will cause clipboard to exceed maximum size.' +\n                  ' data size: ' + data.byteLength +\n                  ' clipboard size: ' + this.getTotalSize() +\n                  ' maximum size: ' + MKSVchan.MAX_BYTES_IMAGE_AND_RTF);\n               return false;\n            }\n         }\n\n         changed = true;\n         items[format] = data;\n         return true;\n      };\n\n      /**\n       * Returns the clipboard's text value as a string.\n       *\n       * @param format: clipboard format, default value text\n       */\n      this.getText = function(format) {\n         if (format < MKSVchan.CP_FORMAT.MIN ||\n            format > MKSVchan.CP_FORMAT.MAX) {\n            JSCDKLogger.error('Clipboard.getText invalid format');\n            return null;\n         }\n         let clipboardFormat = format || MKSVchan.CP_FORMAT.TEXT,\n            text = this.getItem(clipboardFormat);\n\n         if (text == null) {\n            return null;\n         }\n         if (text.length > 0 && text[text.length - 1] === 0) {\n            text = text.subarray(0, text.length - 1);\n         }\n\n         /**\n          * Replace \\n with \\r\\n if it is MKSVchan.CP_FORMAT.TEXT\n          * See bug 1512956\n          * mksvchan server will trim \\r\\n to \\n. Client need to add it back.\n          */\n         let textStr = StringUtils.uint8ArrayToString(text);\n         if (clipboardFormat === MKSVchan.CP_FORMAT.TEXT) {\n            textStr = textStr.replace(/\\r?\\n/g, \"\\r\\n\");\n         }\n         return textStr;\n      };\n\n      /**\n       * Sets the clipboard's text value.\n       *\n       * @param text: a string of text to set the clipboard to.\n       * @param format: clipboard format, default value text\n       */\n      this.setText = function(text, format) {\n         if (format < MKSVchan.CP_FORMAT.MIN ||\n            format > MKSVchan.CP_FORMAT.MAX) {\n            JSCDKLogger.error('Clipboard.setText invalid format');\n            return;\n         }\n         let clipboardFormat = format || MKSVchan.CP_FORMAT.TEXT;\n         this.setItem(clipboardFormat,\n            StringUtils.stringToUint8Array(text, true)\n         );\n      };\n\n      /**\n       * Set the value of the changed flag.\n       *\n       * @parameter {Boolean} value\n       *    New value of the changed flag.\n       */\n      this.setChanged = function(value) {\n         changed = value;\n      };\n\n\n      /**\n       * Gets the value of the changed flag.\n       *\n       * @return {Boolean} changed\n       *    Value of the changed flag.\n       */\n      this.getChanged = function(value) {\n         return changed;\n      };\n   },\n\n\n   /**\n    * Create a new file transfer util\n    *\n    * @classdesc\n    *    File transfer util. Each MKSVchan client should keep its own one.\n    *\n    * @constructor\n    * @return {MKSVchan.FTUtil}\n    */\n   FTUtil: function() {\n      this.downloadList = {};\n      this.downloadList[MKSVchan.FILE_TRANSFER_CONSUMER.FT] = [];\n      this.downloadList[MKSVchan.FILE_TRANSFER_CONSUMER.PRINT] = [];\n      this.uploadList = [];\n      this.fileChunkQueue = [];\n      this.currentDownloadService = null;\n\n      this.config = {\n         // Second release version, set it to 1 as default\n         serverVersion: 1,\n         clientVersion: 1,\n         // For file transfer download only\n         downloadEnabled: 0,\n         // For print file download only\n         printDownloadEnabled: 0,\n         uploadEnabled: 0,\n         // Default chunk size is 32KB\n         chunkSize: 1024 * 32,\n         // Largest chunk size for HTML Access\n         maxChunkSize: 65535,\n         // Largest chunk number for HTML Access\n         maxChunkNum: 65535\n      };\n\n      this.parseDownloadListString = function(fileList) {\n         if (!fileList) {\n            JSCDKLogger.info(\"parseFileListString: empty string found.\");\n            return [];\n         }\n\n         let resList = [],\n            fileListArray = fileList.split('\\0'),\n            fileNum = fileListArray.length / 5,\n            fileInfoObj,\n            fileType,\n            fileSize,\n            i;\n\n         if (fileListArray.length % 5 !== 0) {\n            JSCDKLogger.error(\n               \"parseFileListString: string format is not right.\");\n            return [];\n         }\n\n         for (i = 0; i < fileNum; i++) {\n            fileType = parseInt(fileListArray[fileNum * 3 + i]);\n            fileSize = parseInt(fileListArray[fileNum * 2 + i]);\n            fileInfoObj = {\n               fullPath: fileListArray[i],\n               relPath: fileListArray[fileNum + i],\n               uuid: fileListArray[fileNum * 4 + i],\n               size: fileSize,\n               readableSize: this.getReadableSize(\n                  fileListArray[fileNum * 2 + i]),\n               fileType: fileType,\n               contentData: null,\n               progress: 0,\n               transferError: (fileType !== 0 || fileSize === 0 ||\n               fileSize > MKSVchan.FILE_TRANSFER_MAX_FILE_SIZE),\n               stopTransfer: false\n            };\n            resList.push(fileInfoObj);\n         }\n\n         return resList;\n      };\n\n      this.getReadableSize = function(size) {\n         size = parseInt(size);\n         if (typeof size !== 'number') {\n            JSCDKLogger.error(size + \"is not legal number\");\n            return 0;\n         }\n\n         let kb = 1024,\n            mb = 1024 * 1024,\n            gb = 1024 * 1024 * 1024;\n\n         if (size === 0) {\n            return '0 byte';\n         } else if (size < kb) {\n            return size.toFixed(2) + 'bytes';\n         } else if (size >= kb && size < mb) {\n            return (size / kb).toFixed(2) + 'KB';\n         } else if (size >= mb && size < gb) {\n            return (size / mb).toFixed(2) + 'MB';\n         } else if (size >= gb) {\n            return (size / gb).toFixed(2) + 'GB';\n         } else {\n            JSCDKLogger.info(\"getReadableSize: file is too large.\");\n         }\n      };\n\n      this.downloadServiceSwitcher = function(services, chunkNum,\n                                              chunkFileIdentifier) {\n         if (!services || services.length < 1 || !chunkFileIdentifier) {\n            JSCDKLogger.debug(\"Params illegal\");\n            return null;\n         }\n\n         // No need to switch service if there is only one.\n         if (services.length === 1) {\n            return services[0];\n         }\n\n         // Only run service detection for the first packet.\n         if (chunkNum > 0 && !! this.currentDownloadService) {\n            return this.currentDownloadService;\n         }\n\n         let i,\n            service = null;\n         for (i = 0; i < services.length; i++) {\n            service = services[i];\n            if (!!service.searchReceiveFile &&\n               !!service.searchReceiveFile(chunkFileIdentifier)) {\n               this.currentDownloadService = service;\n               return service;\n            }\n         }\n         JSCDKLogger.error('Cannot find appropriate download service for' +\n            ' the packet!');\n         return null;\n      };\n\n      this.updateConfig = function(serverVersion, policy, chunkSize) {\n         if (serverVersion !== this.config.clientVersion) {\n            JSCDKLogger.warning(\n               'File transfer server version is: ' + serverVersion +\n               '. But the client version is: ' + this.config.clientVersion +\n               '. Only part of functionality can be used');\n            this.config.serverVersion = serverVersion;\n         }\n\n         if (policy < MKSVchan.FILE_TRANSFER_POLICY.MIN ||\n            policy > MKSVchan.FILE_TRANSFER_POLICY.MAX) {\n            JSCDKLogger.error(\n               'Wrong file transfer policy, use default setting.');\n            return;\n         }\n\n         if (chunkSize < 0 || chunkSize > this.config.maxChunkSize) {\n            JSCDKLogger.error(\n               'Wrong file transfer chunk size, use default setting.');\n            return;\n         }\n\n         // If parameter is right, set it to env\n         this.config.chunkSize = chunkSize;\n         this.config.uploadEnabled =\n            (policy === MKSVchan.FILE_TRANSFER_POLICY.BIDIRECTIONAL ||\n            policy === MKSVchan.FILE_TRANSFER_POLICY.ONLY_TO_SERVER);\n         this.config.downloadEnabled =\n            (policy === MKSVchan.FILE_TRANSFER_POLICY.BIDIRECTIONAL ||\n            policy === MKSVchan.FILE_TRANSFER_POLICY.ONLY_TO_CLIENT);\n      };\n\n      this.searchFileFromList = function(fileList, file) {\n         if (!fileList || !file || !file.fullPath) {\n            return null;\n         }\n\n         let i;\n         for (i = 0; i < fileList.length; i++) {\n            if (fileList[i].fullPath === file.fullPath) {\n               return fileList[i];\n            }\n         }\n         return null;\n      };\n\n      this.tryNormalizeUnicodeForMac = function(string) {\n         if (!string) {\n            return \"\";\n         }\n\n         // Try to normalize filename for Mac, see bug 1655526 for detail\n         if (window.navigator.platform.toLowerCase().indexOf('mac') >= 0) {\n            try {\n               string = string.normalize('NFC');\n            } catch (e) {\n               JSCDKLogger.warning('Failed to normalize filename: ' + e);\n            }\n         }\n         return string;\n      };\n   },\n\n\n   Client: function(vdpService) {\n      let self = this,\n\n      // Private variables\n         vdpChannel = null,\n         vdpControlObject = null,\n         vdpDataObject = null,\n\n      // Private functions\n         sendRPC = null,\n         sendClipboardCapabilities = null,\n         sendClipboardLocale = null,\n         sendFileTransferConfig = null,\n         handleRPCFromServer = null,\n         handleClipboardCapabilities = null,\n         handleClipboardDataText = null,\n         handleClipboardDataCP = null,\n         handleFileTransferData = null,\n         handleFileTransferRequest = null,\n         handleFileTransferConfig = null,\n         handleFileTransferError = null;\n\n      /**\n       * The locale of text in the clipboard.\n       * @type {Number}\n       */\n      this.locale = 0;\n\n      /**\n       * The local copy of the remote clipboard.\n       * @type {MKSVchan.Clipboard}\n       */\n      this.clipboard = new MKSVchan.Clipboard();\n\n      /**\n       * The local copy of file transfer util.\n       * @type {MKSVchan.FTUtil}\n       */\n      this.FTUtil = new MKSVchan.FTUtil();\n\n      /**\n       * Called when the vdp channel becomes ready\n       */\n      this.onReady = null;\n\n      /**\n       * Called when the local clipboard has been changed by the remote.\n       * @callback MKSVchan~onClipboardChanged\n       * @param {MKSVchan.Clipboard} clipboard\n       * @type {MKSVchan.onClipboardChanged}\n       */\n      this.onClipboardChanged = null;\n\n      /**\n       * Called when the download files are changed by the remote.\n       * @callback MKSVchan~onDownloadFilesChange\n       * @param {Array} Download file list\n       * @type {MKSVchan.onDownloadFilesChange}\n       */\n      this.onDownloadFilesChange = null;\n\n      /**\n       * Called when the print download files are changed by the remote.\n       * @callback MKSVchan~onPrintDownloadFilesChange\n       * @param {Array} Download file list\n       * @type {MKSVchan.onPrintDownloadFilesChange}\n       */\n      this.onPrintDownloadFilesChange = null;\n\n      /**\n       * Called when the receive file chunks.\n       * @callback MKSVchan~onFileChunkReceived\n       * @param {Number} Chunk params\n       * @type {MKSVchan.onFileChunkReceived}\n       */\n      this.onFileChunkReceived = null;\n\n      /**\n       * Called when the server return file transfer\n       * configuration.\n       * @callback MKSVchan~onFileTransferConfigChange\n       * @param {Object} Error object\n       * @type {MKSVchan.onFileTransferConfigChange}\n       */\n      this.onFileTransferConfigChange = null;\n\n      /**\n       * Called when the server return file transfer\n       * error number.\n       * @callback MKSVchan~onFileTransferError\n       * @param {Number} Error number\n       * @type {MKSVchan.onFileTransferError}\n       */\n      this.onFileTransferError = null;\n\n      /**\n       * Called when the server return printer takes too long time to convert\n       * PDF.\n       * @callback MKSVchan~onPrintError\n       * @param {Number} Error number\n       * @type {MKSVchan.onPrintError}\n       */\n      this.onPrintError = null;\n\n      /**\n       * The supported capabilites of MKSVchan.Client.\n       * @type {Object}\n       */\n      this.capabilities = {\n         version: MKSVchan.CAPABILITY_CLIPBOARD.NOTIFY_ON_CHANGE,\n         notifyOnChangeEnabled: true,\n         size: MKSVchan.MAX_KBYTES_IMAGE_AND_RTF\n      };\n\n      // Reference service for file transfer\n      this.uploadService = null;\n      this.downloadServices = {};\n      this.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.FT] = null;\n      this.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.PRINT] = null;\n\n      /**\n       * Initialize the MKSVchan client.\n       *\n       * Adds a listener on vdpService for channel created.\n       */\n      this.initialize = function() {\n         if (!vdpService) {\n            JSCDKLogger.error('mksVchan init failed: no vdpService specified');\n            return;\n         }\n         vdpService.addChannelCreatedListener(function(channel) {\n            if (channel.name.indexOf(MKSVchan.CHANNEL_NAME_PREFIX) === 0) {\n               if (vdpService.connectChannel(channel)) {\n                  JSCDKLogger.debug(\n                     'Successfully accepted MKSVchan main channel');\n               } else {\n                  JSCDKLogger.error('Failed to open MKSVchan main channel');\n                  return;\n               }\n\n               vdpChannel = channel;\n\n               channel.onReady = function(object) {\n                  if (object.name === MKSVchan.CHANNEL_DATA_OBJECT) {\n                     vdpDataObject = object;\n                     JSCDKLogger.debug(\n                        'MKSVchan data channel is ready for traffic.');\n                  } else if (object.name === MKSVchan.CHANNEL_CTRL_OBJECT) {\n                     vdpControlObject = object;\n                     JSCDKLogger.debug(\n                        'MKSVchan control channel is ready for traffic.');\n                  }\n                  if (self.onReady) {\n                     self.onReady();\n                  }\n               };\n\n               channel.onDisconnect = function(object) {\n                  if (object) {\n                     if (vdpControlObject &&\n                        vdpControlObject.id === object.id) {\n                        vdpControlObject = null;\n                        JSCDKLogger.debug(\n                           'MKSVchan control channel was closed by ' +\n                           'the remote desktop.');\n                     } else if (vdpDataObject &&\n                        vdpDataObject.id === object.id) {\n                        vdpDataObject = null;\n                        JSCDKLogger.debug(\n                           'MKSVchan data channel was closed by ' +\n                           'the remote desktop.');\n                     }\n                  } else {\n                     // If object is not specified, everything disconnected!\n                     vdpDataObject = null;\n                     vdpControlObject = null;\n                     JSCDKLogger.debug(\n                        'MKSVchan control and data channel was ' +\n                        'closed by the remote desktop.');\n                  }\n               };\n\n               channel.onInvoke = function(rpc) {\n                  handleRPCFromServer(rpc);\n               };\n            }\n         });\n      };\n\n\n      /**\n       * Send request to receive remote clipboard.\n       *\n       * @param {Function} onDone\n       *    Called when the request clipboard rpc has completed.\n       * @param {Function} onAbort\n       *    Called if the request clipboard rpc has aborted.\n       * @return {Boolean} success\n       *    Returns true on success, false on failure\n       */\n      this.sendClipboardRequest = function(onDone, onAbort) {\n         return sendRPC(MKSVchan.PACKET_TYPE.CLIPBOARD_REQUEST,\n            null,\n            onDone,\n            onAbort);\n      };\n\n\n      /**\n       * Send request to receive remote files.\n       *\n       * @param {Integer} consumer\n       *    Ft consumer\n       * @param {Function} onDone\n       *    Called when the request files rpc has completed.\n       * @param {Function} onAbort\n       *    Called if the request files rpc has aborted.\n       */\n      this.sendFileTransferRequest = function(consumer, onDone, onAbort) {\n         // Default request all the files from server\n         let packet = WMKS.Packet.createNewPacketLE(),\n            uint8Consumer = StringUtils.stringToUint8Array(consumer, true);\n\n         packet.writeUint16(MKSVchan.FILE_TRANSFER_REQUEST.SEND_FILES);\n\n         if (self.FTUtil.config.serverVersion === 0) {\n            // old ft request\n            packet.writeUint16(0);\n         } else if (self.FTUtil.config.serverVersion === 1) {\n            // new ft request\n            packet.writeUint16(uint8Consumer.length);\n            packet.writeArray(uint8Consumer);\n         }\n\n         return sendRPC(MKSVchan.PACKET_TYPE.FILE_TRANSFER_REQUEST,\n            packet,\n            onDone,\n            onAbort);\n      };\n\n\n      /**\n       * Send file chunk to MKSVchan server.\n       */\n      this.sendFileChunk = function(chunkNum, totalChunkNum, chunkSize,\n                                    chunkIdentifier, chunkData, fileSize,\n                                    onDone, onAbort) {\n         chunkIdentifier =\n            this.FTUtil.tryNormalizeUnicodeForMac(chunkIdentifier);\n\n         let packet = WMKS.Packet.createNewPacketLE(),\n            uint8IdArray = StringUtils.stringToUint8Array(chunkIdentifier,\n               true);\n         packet.writeUint16(chunkNum);\n         packet.writeUint16(totalChunkNum);\n         packet.writeUint16(chunkSize);\n         packet.writeUint16(uint8IdArray.length);\n         packet.writeUint32(fileSize);\n         packet.writeArray(uint8IdArray);\n         packet.writeArray(chunkData);\n\n         sendRPC(MKSVchan.PACKET_TYPE.FILE_TRANSFER_DATA_FILE,\n            packet,\n            onDone,\n            onAbort);\n      };\n\n\n      /**\n       * Send text to remote clipboard.\n       *\n       * @param {String} text\n       *    The text to upload to remote clipboard.\n       * @param {Function} onDone\n       *    Called when the send clipboard rpc has completed.\n       * @param {Function} onAbort\n       *    Called if the send clibpoard rpc has aborted.\n       * @return {Boolean} success\n       *    Returns true on success, false on failure\n       */\n      this.sendClipboardText = function(text, onDone, onAbort) {\n         let packet = WMKS.Packet.createNewPacketLE(),\n            error = MKSVchan.CLIPBOARD_ERROR.NONE,\n            utf8Text = StringUtils.stringToUint8Array(text, true),\n            rpcDone;\n\n         if (utf8Text.length > MKSVchan.MAX_BYTES_TEXT) {\n            utf8Text = utf8Text.subarray(0, MKSVchan.MAX_BYTES_TEXT);\n            utf8Text[MKSVchan.MAX_BYTES_TEXT - 1] = 0;\n            error = MKSVchan.CLIPBOARD_ERROR.MAX_LIMIT_EXCEEDED;\n         }\n\n         rpcDone = function() {\n            onDone(text, error);\n         };\n\n         packet.writeArray(utf8Text);\n         return sendRPC(MKSVchan.PACKET_TYPE.CLIPBOARD_DATA_TEXT, packet,\n            rpcDone, onAbort);\n      };\n\n\n      /**\n       * Upload a MKSVchan.Clipboard object.\n       *\n       * Equivalent to the format in bora/lib/dnd:\n       *    uint32 max_formats\n       *    for i = 1 -> max_formats\n       *       uint8 exists\n       *       uint32 size\n       *       uint8 data[size]\n       *    uint8 changed\n       *\n       * @param  {MKSVchan.Clipboard} clipboard\n       *    The clipboard data to upload\n       * @param  {Function} onDone\n       *    Called when the send clipboard rpc has completed.\n       * @param  {Function} onAbort\n       *    Called if the send clipboard rpc has aborted.\n       * @return {Boolean} success\n       *    Returns true on success, false on failure\n       */\n      this.sendClipboard = function(clipboard, onDone, onAbort) {\n         let packet = WMKS.Packet.createNewPacketLE(),\n            data,\n            i;\n\n         packet.writeUint32(MKSVchan.CP_FORMAT.MAX);\n\n         if (!(clipboard instanceof MKSVchan.Clipboard)) {\n            JSCDKLogger.error(\n               'MKSVchan.sendClipboard expects a MKSVchan.Clipboard object');\n            return false;\n         }\n\n         if (clipboard.getTotalSize() > MKSVchan.MAX_BYTES_IMAGE_AND_RTF) {\n            JSCDKLogger.error(\n               'MKSVchan.sendClipboard clipboard exceeds maximum size. ' +\n               'Clipboard data must only be modified using the clipboard.setItem method');\n            return false;\n         }\n\n         for (i = MKSVchan.CP_FORMAT.MIN; i < MKSVchan.CP_FORMAT.MAX; ++i) {\n            data = clipboard.getItem(i);\n\n            if (!!data) {\n               JSCDKLogger.debug('Sending clipboard data format: ' + i +\n                  ', length: ' + data.byteLength);\n               packet.writeUint8(1);\n               packet.writeUint32(data.byteLength);\n               packet.writeArray(data);\n            } else {\n               packet.writeUint8(0);\n               packet.writeUint32(0);\n            }\n         }\n\n         packet.writeUint8(clipboard.getChanged());\n         return sendRPC(MKSVchan.PACKET_TYPE.CLIPBOARD_DATA_CP, packet, onDone,\n            onAbort);\n      };\n\n      this.sendStopUploadRequest = function(fileName, onDone, onAbort) {\n         fileName = this.FTUtil.tryNormalizeUnicodeForMac(fileName);\n\n         // Default request all the files from server\n         let packet = WMKS.Packet.createNewPacketLE(),\n            uint8FileName = StringUtils.stringToUint8Array(fileName, true);\n         packet.writeUint16(\n            MKSVchan.FILE_TRANSFER_REQUEST.CANCEL_RECEIVE_SPECIFIC_FILE);\n         packet.writeUint16(uint8FileName.length);\n         packet.writeArray(uint8FileName);\n\n         return sendRPC(MKSVchan.PACKET_TYPE.FILE_TRANSFER_REQUEST,\n            packet,\n            onDone,\n            onAbort);\n      };\n\n      this.sendStopDownloadRequest = function(fileIdentifier, onDone, onAbort) {\n         // Default request all the files from server\n         let packet = WMKS.Packet.createNewPacketLE(),\n            uint8Id = StringUtils.stringToUint8Array(fileIdentifier, true);\n         packet.writeUint16(\n            MKSVchan.FILE_TRANSFER_REQUEST.CANCEL_SEND_SPECIFIC_FILES);\n         packet.writeUint16(uint8Id.length);\n         packet.writeArray(uint8Id);\n\n         return sendRPC(MKSVchan.PACKET_TYPE.FILE_TRANSFER_REQUEST,\n            packet,\n            onDone,\n            onAbort);\n      };\n\n      /**\n       * Utility wrapper around vdpChannel invoke for sending RPCs.\n       *\n       * @param {PACKET_TYPE} command\n       *    The command to invoke over rpc.\n       * @param {WMKS.Packet} [packet]\n       *    The packet of data to send with the command.\n       * @param {Function} [onDone]\n       *    Called when the rpc has completed.\n       * @param {Function} [onAbort]\n       *    Called if the rpc has aborted.\n       * @return {Boolean} success\n       *    Returns true on success, false on failure\n       */\n      sendRPC = function(command, packet, onDone, onAbort) {\n         if (!vdpChannel) {\n            JSCDKLogger.error('RPC send failed: vdpChannel not initialized');\n            onAbort();\n            return;\n         }\n         return !!vdpChannel.invoke({\n            object: vdpControlObject,\n            command: command,\n            type: VDPService.RPC_TYPE.REQUEST,\n            params: packet ? [packet.getData()] : [],\n            onDone: onDone,\n            onAbort: onAbort\n         });\n      };\n\n\n      /**\n       * Send the capabilities of the client clipboard.\n       *\n       * @param {Number} capabilities\n       *    The capabilities supported by the client clipboard.\n       * @param {Function} onDone\n       *    Called when the clipboard capabilities rpc has completed.\n       * @param {Function} onAbort\n       *    Called if the clipboard capabilities rpc has aborted.\n       * @return {Boolean} success\n       *    Returns true on success, false on failure\n       */\n      sendClipboardCapabilities = function(caps, onDone, onAbort) {\n         let packet = WMKS.Packet.createNewPacketLE();\n         packet.writeUint32(caps);\n         return sendRPC(MKSVchan.PACKET_TYPE.CLIPBOARD_CAPABILITIES, packet,\n            onDone, onAbort);\n      };\n\n\n      /**\n       * Sends the locale of the client clipboard.\n       *\n       * @param {Number} locale\n       *    The locale of client clipboard.\n       * @param {Function} onDone\n       *    Called when the clipboard locale rpc has completed.\n       * @param {Function} onAbort\n       *    Called if the clipboard locale rpc has aborted.\n       * @return {Boolean} success\n       *    Returns true on success, false on failure\n       */\n      sendClipboardLocale = function(locale, onDone, onAbort) {\n         let packet = WMKS.Packet.createNewPacketLE();\n         packet.writeUint32(locale);\n         return sendRPC(MKSVchan.PACKET_TYPE.CLIPBOARD_LOCALE, packet, onDone,\n            onAbort);\n      };\n\n      /**\n       * Send final file transfer config to MKSVchan server.\n       */\n      sendFileTransferConfig = function(clientVersion, clientType, chunkSize) {\n         clientType = clientType << 4;\n\n         let packet = WMKS.Packet.createNewPacketLE();\n         packet.writeUint8(clientVersion);\n         packet.writeUint8(clientType);\n         packet.writeUint16(chunkSize);\n         return sendRPC(MKSVchan.PACKET_TYPE.FILE_TRANSFER_CONFIG, packet,\n            function() {\n               JSCDKLogger.debug('File transfer caps sent successfully');\n            }, function() {\n               JSCDKLogger.debug('File transfer caps cannot be sent.');\n            });\n      };\n\n\n      /**\n       * Handle the remote clipboard capabilities.\n       *\n       * As a client, we must reply with our capabilities and locale.\n       *\n       * @param {Object} rpc\n       *    The incoming RPC object.\n       */\n      handleClipboardCapabilities = function(rpc) {\n         let packet = WMKS.Packet.createFromBufferLE(rpc.params[0]),\n            caps = packet.readUint32(),\n            version = caps & 0xffff,\n            size = caps >> 16,\n            notifyOnChangeEnabled = false,\n            capabilities = null;\n\n         // Negotiate minimum common version and size\n         version = Math.min(version, self.capabilities.version);\n\n         if (version >= MKSVchan.CAPABILITY_CLIPBOARD.IMAGE_AND_RTF) {\n            size = Math.min(size, self.capabilities.size);\n         } else {\n            size = 0;\n         }\n\n         if (version >= MKSVchan.CAPABILITY_CLIPBOARD.NOTIFY_ON_CHANGE) {\n            notifyOnChangeEnabled = true;\n         } else {\n            JSCDKLogger.debug(\n               'mksVchan version does not support clipboard auto notifications, copying will be broken');\n         }\n\n         self.capabilities.version = version;\n         self.capabilities.notifyOnChangeEnabled = notifyOnChangeEnabled;\n         self.capabilities.size = size;\n\n         capabilities = version | (size << 16);\n         if (notifyOnChangeEnabled) {\n            capabilities = capabilities | MKSVchan.ENABLE_NOTIFY_ON_CHANGE;\n         }\n\n         // Reply with our capabilities and locale\n         sendClipboardCapabilities(capabilities);\n         sendClipboardLocale(self.locale);\n      };\n\n\n      /**\n       * Handle the remote clipboard text data.\n       *\n       * @param {Object} rpc\n       *    The incoming RPC object.\n       */\n      handleClipboardDataText = function(rpc) {\n         self.clipboard.setItem(MKSVchan.CP_FORMAT.TEXT, rpc.params[0]);\n\n         if (self.onClipboardChanged) {\n            self.onClipboardChanged(self.clipboard);\n         }\n      };\n\n\n      /**\n       * Handle the remote clipboard binary data.\n       *\n       * @param {Object} rpc\n       *    The incoming RPC object.\n       */\n      handleClipboardDataCP = function(rpc) {\n         let packet = null,\n            error = MKSVchan.CLIPBOARD_ERROR.NONE,\n            formats = null,\n            exists,\n            size,\n            data,\n            i;\n\n         // If first parameter is a number, it is an error code.\n         if (typeof rpc.params[0] === 'number') {\n            error = rpc.params[0];\n         } else {\n            if (rpc.params[1]) {\n               error = rpc.params[1];\n            }\n            packet = WMKS.Packet.createFromBufferLE(rpc.params[0]);\n            formats = packet.readUint32();\n\n            // Limit to our known formats\n            formats = Math.max(formats, MKSVchan.CP_FORMAT.MAX);\n\n            // Read clipboard data for all format types\n            for (i = MKSVchan.CP_FORMAT.MIN; i < formats; ++i) {\n               exists = packet.readUint8();\n               size = packet.readUint32();\n               data = packet.readArray(size);\n               self.clipboard.setItem(i, data);\n            }\n\n            // If we have only 1 byte left, it's the changed flag\n            if (packet.bytesRemaining() === 1) {\n               self.clipboard.setChanged(packet.readUint8());\n            } else {\n               self.clipboard.setChanged(true);\n            }\n         }\n\n         let fileListStr = self.clipboard.getText(MKSVchan.CP_FORMAT.FILELIST),\n            fileList = self.FTUtil.parseDownloadListString(fileListStr);\n\n         if (!!fileList && fileList.length > 0 && self.onDownloadFilesChange) {\n            // Update download list\n            self.onDownloadFilesChange(fileList, error);\n         }\n\n         if (self.onClipboardChanged) {\n            self.onClipboardChanged(self.clipboard, error);\n         }\n      };\n\n\n      /**\n       * Handle the file chunk data.\n       *\n       * @param {Object} rpc\n       *    The incoming RPC object.\n       */\n      handleFileTransferData = function(rpc) {\n         let packet = null,\n            error = MKSVchan.CLIPBOARD_ERROR.NONE,\n            chunkNum = null,\n            totalChunkNum = null,\n            chunkDataSize = null,\n            chunkIdentifierSize = null,\n            fileSize = null,\n            chunkIdentifierData = null,\n            chunkIdentifier,\n            chunkData,\n            downloadService = null,\n            services = [];\n\n         // If first parameter is a number, it is an error code.\n         if (typeof rpc.params[0] === 'number') {\n            error = rpc.params[0];\n         } else {\n            if (rpc.params[1]) {\n               error = rpc.params[1];\n            }\n            packet = WMKS.Packet.createFromBufferLE(rpc.params[0]);\n\n            chunkNum = packet.readUint16();\n            totalChunkNum = packet.readUint16();\n            chunkDataSize = packet.readUint16();\n            chunkIdentifierSize = packet.readUint16();\n            fileSize = packet.readUint32();\n\n            chunkIdentifierData = packet.readArray(chunkIdentifierSize);\n            chunkIdentifier =\n               StringUtils.uint8ArrayToString(chunkIdentifierData);\n            chunkData = packet.readArray(chunkDataSize);\n\n            if (!!self.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.FT]) {\n               services.push(\n                  self.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.FT]);\n            }\n            if (!!self.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.PRINT]) {\n               services.push(\n                  self.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.PRINT]);\n            }\n\n            downloadService = self.FTUtil.downloadServiceSwitcher(services, chunkNum,\n               chunkIdentifier);\n            /**\n             * If cannot find download service, choose a default one by the\n             * order:\n             * 1. File transfer\n             * 2. Print\n             */\n            if (!downloadService) {\n               downloadService = self.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.FT]\n                  || self.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.PRINT];\n            }\n\n            // If still cannot find, throw error\n            if (!downloadService) {\n               throw 'Cannot find download service!';\n            }\n\n            downloadService.reassembleChunks(chunkNum, totalChunkNum, chunkIdentifier,\n               chunkData, fileSize, error);\n         }\n      };\n\n\n      /**\n       * Handle the file transfer request.\n       *\n       * @param {Object} rpc\n       *    The incoming RPC object.\n       */\n      handleFileTransferRequest = function(rpc) {\n         let packet = null,\n            error = MKSVchan.CLIPBOARD_ERROR.NONE,\n            requestType = null;\n\n         // If first parameter is a number, it is an error code.\n         if (typeof rpc.params[0] === 'number') {\n            error = rpc.params[0];\n         } else {\n            if (rpc.params[1]) {\n               error = rpc.params[1];\n            }\n            packet = WMKS.Packet.createFromBufferLE(rpc.params[0]);\n            requestType = packet.readUint16();\n            switch (requestType) {\n               case MKSVchan.FILE_TRANSFER_REQUEST.SEND_FILES:\n               case MKSVchan.FILE_TRANSFER_REQUEST.CANCEL_SEND_FILES:\n               case MKSVchan.FILE_TRANSFER_REQUEST.SEND_SPECIFIC_FILES:\n               case MKSVchan.FILE_TRANSFER_REQUEST.CANCEL_SEND_SPECIFIC_FILES:\n               case MKSVchan.FILE_TRANSFER_REQUEST.CANCEL_RECEIVE_SPECIFIC_FILE:\n                  JSCDKLogger.debug('Not support the requests yet.');\n                  break;\n               case MKSVchan.FILE_TRANSFER_REQUEST.FILE_LIST: {\n                  let consumer = packet.readUint8(),\n                     fileListLength = null,\n                     fileListData = null,\n                     fileListStr = null,\n                     fileList = null;\n\n                  if (consumer > MKSVchan.FILE_TRANSFER_CONSUMER.MAX ||\n                     consumer < MKSVchan.FILE_TRANSFER_CONSUMER.MIN) {\n                     JSCDKLogger.debug('Invalid consumer type.');\n                     return;\n                  }\n\n                  // We don't need the last null terminate.\n                  fileListLength = packet.readUint32() - 1;\n                  fileListData = packet.readArray(fileListLength);\n                  fileListStr = StringUtils.uint8ArrayToString(fileListData);\n                  fileList = self.FTUtil.parseDownloadListString(fileListStr);\n\n                  if (!fileList || fileList.length < 1) {\n                     JSCDKLogger.error('Cannot find download files from server msg');\n                     return;\n                  }\n\n                  switch (consumer) {\n                     case MKSVchan.FILE_TRANSFER_CONSUMER.FT: {\n                        // Treat it as normal file transfer case\n                        if (!!self.onDownloadFilesChange) {\n                           // Update download list\n                           self.onDownloadFilesChange(fileList, error);\n                        }\n                        break;\n                     }\n                     case MKSVchan.FILE_TRANSFER_CONSUMER.PRINT: {\n                        // Send the data to print service\n                        if (!!self.onPrintDownloadFilesChange) {\n                           // Update download list\n                           self.onPrintDownloadFilesChange(fileList, error);\n                        }\n                        break;\n                     }\n                     default:\n                        JSCDKLogger.error('Unsupported file transfer consumer');\n                  }\n                  break;\n               }\n               case MKSVchan.FILE_TRANSFER_REQUEST.PRINT_CONFIG: {\n                  let version = packet.readUint8();\n                  JSCDKLogger.debug('Print version is: ' + version);\n                  // If no print config received, it is not enabled on agent.\n                  self.FTUtil.config.printDownloadEnabled = true;\n                  break;\n               }\n               default:\n                  JSCDKLogger.debug('Illegal request found.');\n            }\n         }\n      };\n\n\n      /**\n       * Handle the file transfer config change.\n       *\n       * @param {Object} rpc\n       *    The incoming RPC object.\n       */\n      handleFileTransferConfig = function(rpc) {\n         let packet = null,\n            error = MKSVchan.CLIPBOARD_ERROR.NONE,\n            serverVersion = null,\n            policy = null,\n            chunkSize = null,\n            clientVersionSentToServer = self.FTUtil.config.clientVersion;\n\n         // If first parameter is a number, it is an error code.\n         if (typeof rpc.params[0] === 'number') {\n            error = rpc.params[0];\n         } else {\n            if (rpc.params[1]) {\n               error = rpc.params[1];\n            }\n            packet = WMKS.Packet.createFromBufferLE(rpc.params[0]);\n            serverVersion = packet.readUint8();\n            policy = packet.readUint8();\n            chunkSize = packet.readUint16();\n\n            JSCDKLogger.debug('File transfer version from server: ' +\n               serverVersion);\n            JSCDKLogger.debug('File transfer policy from server: ' + policy);\n            JSCDKLogger.debug(\n               'File transfer chunk size from server: ' + chunkSize);\n\n            self.FTUtil.updateConfig(serverVersion, policy, chunkSize);\n            if (serverVersion < self.FTUtil.config.clientVersion) {\n               // Adjust client version to server's for backward compatibility\n               clientVersionSentToServer = serverVersion;\n            }\n            sendFileTransferConfig(clientVersionSentToServer,\n               MKSVchan.FILE_TRANSFER_CLIENT.WEB, chunkSize);\n         }\n\n         if (self.onFileTransferConfigChange) {\n            self.onFileTransferConfigChange(error);\n         }\n      };\n\n\n      /**\n       * Handle the file transfer error from server.\n       *\n       * @param {Object} rpc\n       *    The incoming RPC object.\n       */\n      handleFileTransferError = function(rpc) {\n         let packet = null,\n            error = MKSVchan.CLIPBOARD_ERROR.NONE,\n            ftError = null;\n\n         // If first parameter is a number, it is an error code.\n         if (typeof rpc.params[0] === 'number') {\n            error = rpc.params[0];\n         } else {\n            if (rpc.params[1]) {\n               error = rpc.params[1];\n            }\n            packet = WMKS.Packet.createFromBufferLE(rpc.params[0]);\n            ftError = packet.readUint8();\n\n            JSCDKLogger.debug('File transfer error from server: ' + ftError);\n         }\n\n         switch (ftError) {\n            case MKSVchan.FILE_TRANSFER_ERROR.NO_ENOUGH_DISK:\n            case MKSVchan.FILE_TRANSFER_ERROR.IS_TRANSFERRING:\n            case MKSVchan.FILE_TRANSFER_ERROR.UNKNOWN_ERROR: {\n               if (self.onFileTransferError) {\n                  self.onFileTransferError(ftError);\n               }\n               break;\n            }\n            case MKSVchan.FILE_TRANSFER_ERROR.PRINT_TIMEOUT: {\n               if (self.onPrintError) {\n                  self.onPrintError(ftError);\n               }\n               break;\n            }\n            default:\n               JSCDKLogger.error('Unknown error number: ' + ftError);\n         }\n      };\n\n\n      /**\n       * Handle incoming RPCs and redirect them based on command.\n       *\n       * @param {Object} rpc\n       *    The incoming RPC object.\n       */\n      handleRPCFromServer = function(rpc) {\n         switch (rpc.command) {\n            case MKSVchan.PACKET_TYPE.CLIPBOARD_DATA_TEXT:\n               handleClipboardDataText(rpc);\n               break;\n            case MKSVchan.PACKET_TYPE.CLIPBOARD_DATA_CP:\n               handleClipboardDataCP(rpc);\n               break;\n            case MKSVchan.PACKET_TYPE.CLIPBOARD_CAPABILITIES:\n               handleClipboardCapabilities(rpc);\n               break;\n            case MKSVchan.PACKET_TYPE.FILE_TRANSFER_DATA_FILE:\n               handleFileTransferData(rpc);\n               break;\n            case MKSVchan.PACKET_TYPE.FILE_TRANSFER_REQUEST:\n               handleFileTransferRequest(rpc);\n               break;\n            case MKSVchan.PACKET_TYPE.FILE_TRANSFER_CONFIG:\n               handleFileTransferConfig(rpc);\n               break;\n            case MKSVchan.PACKET_TYPE.FILE_TRANSFER_ERROR:\n               handleFileTransferError(rpc);\n               break;\n            default:\n               JSCDKLogger.error(\n                  'MKSVchan received unexpected command: ' + rpc.command);\n         }\n      };\n   }\n};\n\nexport default MKSVchan;\n\n\n// WEBPACK FOOTER //\n// ./desktop/channels/mksvchan.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * setUserGlobalPrefCommand.js --\n *    Implementation of the message handler to set user global setting.\n */\n\nimport $ from 'jquery';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler} from './messageHandler';\n\n\nexport default function SetUserGlobalPrefHandler() {\n   // member variables\n   this.messageName = \"set-user-global-preferences\";\n   this.messageText = \"set-user-global-preferences\";\n\n   this.responseTag = \"set-user-global-preferences\";\n\n   this.subHandlerList = [];\n   this.composedHandlerList = [];\n   this.favoriteIds = [];\n}\n\n// inherits MessageHandler prototype\nSetUserGlobalPrefHandler.prototype = new MessageHandler();\nSetUserGlobalPrefHandler.constructor = SetUserGlobalPrefHandler;\n\n/**\n * Reset handler's state and content.\n *\n */\nSetUserGlobalPrefHandler.prototype.resetData = function() {\n   MessageHandler.prototype.resetData.apply(this);\n};\n\n/**\n * Set the request XML for global preferece.\n *\n * @param pref [in] preference json object\n */\nSetUserGlobalPrefHandler.prototype.setRequestXML = function(pref) {\n   let key,\n      prefElements = \"\";\n\n   for (key in pref) {\n      if (pref.hasOwnProperty(key)) {\n         prefElements += util.createElement('preference', pref[key], {\n            name: key\n         });\n      }\n   }\n\n   this.requestXML = util.createElement('user-preferences', prefElements);\n};\n\n/**\n * parse user global preference information from the response XML\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\nSetUserGlobalPrefHandler.prototype.parseResult = function(responseXML) {\n   let responseBody = responseXML,\n      brokerTag = util.getChildNode(responseBody, \"broker\", 0),\n      result,\n      errorCodeNode,\n      errorMessageNode,\n      resultElem,\n      favoriteItems = {},\n      prefNodes,\n      resp = {},\n      i,\n      pref = {},\n      value = \"\",\n      len,\n      name,\n      key;\n\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of SetUserGlobalPref error.\");\n      return null;\n   }\n\n   resultElem = util.getChildNode(brokerTag, this.responseTag, 0);\n   resultElem = util.getChildNode(resultElem, 'result', 0);\n   if (!resultElem || !(resultElem.hasChildNodes())) {\n      return null;\n   }\n   result = resultElem.childNodes[0].nodeValue;\n   resp[\"result\"] = result;\n   if (result === \"error\") {\n      errorCodeNode = util.getChildNode(responseBody, \"error-code\", 0);\n      if (!!errorCodeNode) {\n         resp[\"error-code\"] = $(errorCodeNode).text();\n      }\n      errorMessageNode = util.getChildNode(responseBody, \"error-message\", 0);\n      if (!!errorMessageNode) {\n         resp[\"error-message\"] = $(errorMessageNode).text();\n      }\n   }\n   return resp;\n};\n\nSetUserGlobalPrefHandler.prototype.onUpdated = function() {\n   JSCDKSetUI(JSON.stringify({\n      ignoreData: true,\n      name: 'SetUserGlobalPref'\n   }));\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/setUserGlobalPrefHandler.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getLaunchItems.js --\n *\n *      Implementation of the message handler to get launchItems.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport Router from './router';\nimport DoLogoutHandler from './doLogoutHandler';\nimport KillSessionHandler from './killSessionHandler';\nimport ResetDesktopHandler from './resetDesktopHandler';\nimport RestartDesktopHandler from './restartDesktopHandler';\nimport GetUserGlobalPrefHandler from './getUserGlobalPrefHandler';\n\n\nexport default function GetLaunchItemsHandler(skipTunnelAndPref, skipTimer) {\n   let router,\n      getTunnelConnObject,\n      getUserGlobalPref;\n\n   // member variables\n   this.messageName = \"get-launch-items\";\n   this.messageText = \"get-launch-items\";\n   this.responseTag = \"launch-items\";\n\n   // whether to notify UI on get-launchItems response.\n   this.notifyUI = true;\n   this.skipTimer = skipTimer || false;\n\n   this.subHandlerList = [];\n   this.observerList = [];\n\n   if (!skipTunnelAndPref) {\n      if (!globalArray[\"get-user-global-preferences\"]) {\n         getUserGlobalPref = new GetUserGlobalPrefHandler();\n         globalArray[\"get-user-global-preferences\"] = getUserGlobalPref;\n      } else {\n         getUserGlobalPref = globalArray[\"get-user-global-preferences\"];\n      }\n      getUserGlobalPref.registerHandler(this, \"state\");\n\n      this.composedHandlerList = [this, getUserGlobalPref];\n\n      // register dependencies here\n      getTunnelConnObject =\n         util.getObject(globalArray, \"get-tunnel-connection\");\n      if (!!getTunnelConnObject) {\n         this.registerHandler(getTunnelConnObject, \"state\");\n      } else {\n         JSCDKLogger.error(\"The get-tunnel-connection object is null!\");\n      }\n   } else {\n      this.composedHandlerList = [];\n   }\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\nGetLaunchItemsHandler.prototype = new MessageHandler(); // inherits\n                                                        // MessageHandler\n                                                        // prototype\nGetLaunchItemsHandler.constructor = GetLaunchItemsHandler;\n\n/**\n * Reset handler's state and content.\n *\n */\nGetLaunchItemsHandler.prototype.resetData = function() {\n   MessageHandler.prototype.resetData.apply(this);\n\n   this.notifyUI = true;\n};\n\n/**\n * Set the request XML for getLaunchItems.\n *\n * @param supportedDesktopProtocols [in] array for supported protocols.\n * @param supportedAppTypes [in] array of supported app types.  Each app type\n *    is an object with .name and optionally .protocols.\n * @param notifyUI [in] whether to notify the UI on XML-API response.\n */\nGetLaunchItemsHandler.prototype.setRequestXML =\n   function(supportedDesktopProtocols, supportedAppTypes, notifyUI) {\n      let nameElement,\n         protocolElement,\n         sessionElement,\n         protocolsElement = \"\",\n         desktopsElement = \"\",\n         typeElement,\n         typeNameElement,\n         typesElement = \"\",\n         applicationElement = \"\",\n         shadowSessionElement = \"\",\n         launchItemsElement = \"\",\n         protocols = \"\",\n         launchItems = \"\",\n         type = \"\",\n         types = \"\",\n         i,\n         l,\n         urlHandler = null;\n\n      for (i = 0; i < supportedDesktopProtocols.length; i++) {\n         nameElement = util.createElement(\"name\", supportedDesktopProtocols[i]);\n         protocolElement = util.createElement(\"protocol\", nameElement);\n         protocols += protocolElement;\n      }\n      protocolsElement = util.createElement(\"supported-protocols\", protocols);\n      desktopsElement = util.createElement(\"desktops\", protocolsElement);\n      launchItemsElement += desktopsElement;\n\n      for (i = 0; i < supportedAppTypes.length; i++) {\n         protocols = \"\";\n         typeNameElement =\n            util.createElement(\"name\", supportedAppTypes[i][\"name\"]);\n         for (l = 0; l < supportedAppTypes[i].protocols.length; l++) {\n            nameElement =\n               util.createElement(\"name\", supportedAppTypes[i].protocols[l]);\n            protocolElement = util.createElement(\"protocol\", nameElement);\n            protocols += protocolElement;\n         }\n         protocolsElement =\n            util.createElement(\"supported-protocols\", protocols);\n         type = typeNameElement + protocolsElement;\n         typeElement = util.createElement(\"type\", type);\n         types += typeElement;\n      }\n      typesElement = util.createElement(\"supported-types\", types);\n      applicationElement = util.createElement(\"applications\", typesElement);\n      launchItemsElement += applicationElement;\n\n      urlHandler = util.getObject(globalArray, \"url-handler\");\n      if (!!urlHandler && urlHandler.params.allowCollaboration === \"1\") {\n         // Todo: add requested session id from URI to support CPA.\n         for (i = 0; i < supportedDesktopProtocols.length; i++) {\n            nameElement = util.createElement(\"name\", supportedDesktopProtocols[i]);\n            protocolElement = util.createElement(\"protocol\", nameElement);\n            protocols += protocolElement;\n         }\n         protocolsElement = util.createElement(\"supported-protocols\", protocols);\n         shadowSessionElement = util.createElement(\"shadow-sessions\", protocolsElement);\n         launchItemsElement += shadowSessionElement;\n      }\n\n      sessionElement = util.createElement(\"application-sessions\");\n      launchItemsElement += sessionElement;\n\n      /**\n       * Generate the <environment-info> section if it was specified to support:\n       * https://jira-hzn.eng.vmware.com/browse/DPM-1211\n       */\n      let environmentInfo = globalArray['environment-information'];\n      if (typeof(environmentInfo) === \"object\") {\n         let infoElements = \"\";\n         for (let key in environmentInfo) {\n            if (environmentInfo.hasOwnProperty(key)) {\n               infoElements += util.createElement(\"info\", environmentInfo[key],\n                  {\"name\": key});\n            }\n         }\n         let environmentElement =\n            util.createElement(\"environment-information\", infoElements);\n         launchItemsElement += environmentElement;\n      }\n\n      this.requestXML = launchItemsElement;\n\n      if (typeof notifyUI === 'boolean') {\n         // Whether to notify UI on get-launchItems response.\n         this.notifyUI = notifyUI;\n      } else {\n         // Always notify UI on get-launchItems response.\n         this.notifyUI = true;\n      }\n   };\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nGetLaunchItemsHandler.prototype.onUpdated = function() {\n   let getLaunchItemsAction = {},\n      actionContent = {},\n      router,\n      urlHandler,\n      urlParams,\n      idleTimerObject,\n      idleTimeout,\n      userActivityXMLSendingInterval;\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if ((this.state === StateEnum.DONE)) {\n      if (this.notifyUI) {\n         // Compose refresh UI request.\n         getLaunchItemsAction.name = \"GetLaunchItems\";\n         if (!!globalArray) {\n            router = globalArray[\"router\"];\n            if (!!router) {\n               actionContent.brokerUrl = router.brokerUrl;\n            }\n         }\n         if (!!(this.content[\"parsedResult\"])) {\n            actionContent.desktops = this.content.parsedResult.desktops;\n            actionContent.applications = this.content.parsedResult.applications;\n            actionContent.applicationSessions =\n               this.content.parsedResult[\"application-sessions\"];\n            actionContent.shadowSessions =\n               this.content.parsedResult[\"shadow-sessions\"];\n         }\n         // Handle the desktopId passed through URI.\n         urlHandler = util.getObject(globalArray, \"url-handler\");\n         if (!!urlHandler) {\n            urlParams = urlHandler.params;\n            if (!!urlParams.desktopId) {\n               actionContent.desktopId = urlParams.desktopId;\n               actionContent.action = urlParams.action;\n               if (!!urlParams.desktopProtocol) {\n                  actionContent.targetProtocol =\n                     urlParams.desktopProtocol.toUpperCase();\n               }\n            }\n         }\n         if (util.brokerSupportApplication() && !this.skipTimer) {\n            //launch idle timer\n            idleTimerObject = globalArray[\"idle-timeout-timer\"];\n            if (!idleTimerObject) {\n               JSCDKLogger.error(\n                  \"timer don't exist when displaying apps & desktops\");\n               return;\n            }\n            idleTimeout = idleTimerObject.getIdleTimeoutValue();\n            userActivityXMLSendingInterval =\n               idleTimerObject.getSendIntervalValue();\n         } else {// for older broker, just set value to -1;\n            idleTimeout = -1;\n            userActivityXMLSendingInterval = -1;\n         }\n         getLaunchItemsAction.timerInfo = {\n            \"idleTimeout\": idleTimeout,\n            \"userActivityXMLSendingInterval\": userActivityXMLSendingInterval\n         };\n\n         getLaunchItemsAction.content = actionContent;\n         JSCDKSetUI(JSON.stringify(getLaunchItemsAction));\n      }\n   }\n   // if the error is special for this handler, alert\n   Router.prototype.pushErrorToUser(this);\n};\n\n/**\n * parse launchItems information from the response XML\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\nGetLaunchItemsHandler.prototype.parseResult = function(responseXML) {\n   let responseBody = responseXML;\n   let launchItemsResponse = {};\n   let result;\n   let resultElem;\n   let desktops = {};\n   let desktopsNodes;\n   let desktopsLength;\n   let applications = {};\n   let applicationsNodes;\n   let applicationsLength;\n   let sessions = {};\n   let applicationSessionsNodes;\n   let applicationSessionsLength;\n   let shadowSessions = {};\n   let shadowSessionsNodes;\n   let shadowSessionsLength;\n   let errorCodeNode;\n   let errorMessageNode;\n   let desktop;\n   let application;\n   let session;\n   let i;\n   let len;\n   let brokerTag = util.getChildNode(responseBody, \"broker\", 0);\n\n   // Make sure brokerVersion will be set even without getAuthencationStatus\n   globalArray[\"brokerVersion\"] = $(brokerTag).attr(\"version\");\n\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of GetLaunchItems error.\");\n      return null;\n   }\n   resultElem = util.getChildNode(brokerTag, this.responseTag, 0);\n   resultElem = util.getChildNode(resultElem, 'result', 0);\n   if (!resultElem || !(resultElem.hasChildNodes())) {\n      return null;\n   }\n   result = resultElem.childNodes[0].nodeValue;\n   launchItemsResponse[\"result\"] = result;\n   if (result === \"ok\") {\n      desktopsNodes = brokerTag.getElementsByTagName(\"desktop\");\n      desktopsLength = desktopsNodes.length;\n      for (i = 0; i < desktopsLength; i++) {\n         let aDesktopInstance = {};\n\n         // set desktop name\n         this.setLaunchItemName(aDesktopInstance, desktopsNodes[i]);\n\n         // set desktop id\n         this.setLaunchItemId(aDesktopInstance, desktopsNodes[i]);\n\n         // set response state\n         this.setResponseState(aDesktopInstance, desktopsNodes[i]);\n\n         // set sessionId\n         this.setSessionId(aDesktopInstance, desktopsNodes[i]);\n\n         // set inMaintenanceMode\n         this.setInMaintenanceMode(aDesktopInstance, desktopsNodes[i]);\n\n         // set protocol match\n         this.setProtocolMatch(aDesktopInstance, desktopsNodes[i]);\n\n         // set preferred protocol, defaultProtocol and supportedProtocol\n         this.setProtocols(aDesktopInstance, desktopsNodes[i]);\n\n         // set desktop user preferences\n         this.setDesktopUserPrefs(aDesktopInstance, desktopsNodes[i]);\n\n         // set canLogoff: whether the desktop can logoff\n         this.setCanLogoff(aDesktopInstance, desktopsNodes[i]);\n\n         // set resetAllowed\n         this.setResetAllowed(aDesktopInstance, desktopsNodes[i]);\n\n         // set resetAllowedOnSession\n         this.setResetAllowedOnSession(aDesktopInstance, desktopsNodes[i]);\n\n         // set canRollback: whether the desktop can rollback\n         this.setCanRollback(aDesktopInstance, desktopsNodes[i]);\n\n         if (this.isDisabledItem(desktopsNodes[i])) {\n            JSCDKLogger.debug(\n               \"DesktopInstance disabled: \" + JSON.stringify(aDesktopInstance));\n         } else {\n            util.addItemForJson(desktops, i, aDesktopInstance);\n            JSCDKLogger.debug(\n               \"aDesktopInstance: \" + JSON.stringify(aDesktopInstance));\n         }\n      }\n      // XXX TODO: more desktop properties to handle\n      JSCDKLogger.debug(\"desktops: \" + JSON.stringify(desktops));\n      util.addItemForJson(launchItemsResponse, \"desktops\", desktops);\n\n      applicationsNodes = brokerTag.getElementsByTagName(\"application\");\n      applicationsLength = applicationsNodes.length;\n      for (i = 0; i < applicationsLength; i++) {\n         let aApplicationInstance = {};\n\n         // set desktop name\n         this.setLaunchItemName(aApplicationInstance, applicationsNodes[i]);\n\n         // set application id\n         this.setLaunchItemId(aApplicationInstance, applicationsNodes[i]);\n\n         // set application type\n         this.setApplicationType(aApplicationInstance, applicationsNodes[i]);\n\n         // set application origin id\n         this.setLaunchItemOriginId(aApplicationInstance, applicationsNodes[i]);\n\n         // set application version\n         this.setApplicationVersion(aApplicationInstance, applicationsNodes[i]);\n\n         // set application publisher\n         this.setApplicationPublisher(aApplicationInstance,\n            applicationsNodes[i]);\n\n         // set launch-path\n         this.setApplicationLaunchPath(aApplicationInstance,\n            applicationsNodes[i]);\n\n         // set protocol match\n         this.setProtocolMatch(aApplicationInstance, applicationsNodes[i]);\n\n         // set preferred protocol, defaultProtocol and supportedProtocol\n         this.setProtocols(aApplicationInstance, applicationsNodes[i]);\n\n         // set application icons\n         this.setApplicationIcons(aApplicationInstance, applicationsNodes[i]);\n\n         if (this.isDisabledItem(applicationsNodes[i])) {\n            JSCDKLogger.debug(\"ApplicationInstance disabled: \" +\n               JSON.stringify(aApplicationInstance));\n         } else {\n            util.addItemForJson(applications, i, aApplicationInstance);\n            JSCDKLogger.debug(\n               \"aApplicationInstance: \" + JSON.stringify(aApplicationInstance));\n         }\n      }\n      // XXX TODO: more application properties to handle\n      JSCDKLogger.debug(\"applications: \" + JSON.stringify(applications));\n      util.addItemForJson(launchItemsResponse, \"applications\", applications);\n\n      applicationSessionsNodes =\n         brokerTag.getElementsByTagName(\"application-session\");\n      applicationSessionsLength = applicationSessionsNodes.length;\n      for (i = 0; i < applicationSessionsLength; i++) {\n         let aApplicationSessionInstance = {};\n\n         this.setLaunchItemId(aApplicationSessionInstance,\n            applicationSessionsNodes[i]);\n\n         // set application session origin id\n         this.setLaunchItemOriginId(aApplicationSessionInstance,\n            applicationSessionsNodes[i]);\n\n         // set application session state\n         this.setResponseState(aApplicationSessionInstance,\n            applicationSessionsNodes[i]);\n\n         // set application sessin asset info\n         this.setApplicationSessionRemoteAssetsType(aApplicationSessionInstance,\n            applicationSessionsNodes[i]);\n\n         // set protocol match\n         this.setProtocolMatch(aApplicationSessionInstance,\n            applicationSessionsNodes[i]);\n\n         // set preferred protocol, defaultProtocol and supportedProtocol\n         this.setProtocols(aApplicationSessionInstance,\n            applicationSessionsNodes[i]);\n\n         if (this.isDisabledItem(applicationSessionsNodes[i])) {\n            JSCDKLogger.debug(\"ApplicationSessionInstance disabled: \" +\n               JSON.stringify(aApplicationSessionInstance));\n         } else {\n            util.addItemForJson(sessions, i, aApplicationSessionInstance);\n            JSCDKLogger.debug(\"aApplicationSessionInstance: \" +\n               JSON.stringify(aApplicationSessionInstance));\n         }\n      }\n      // XXX TODO: more application properties to handle\n      JSCDKLogger.debug(\"application-sessions: \" + JSON.stringify(sessions));\n      util.addItemForJson(launchItemsResponse, \"application-sessions\",\n         sessions);\n\n      shadowSessionsNodes =\n         brokerTag.getElementsByTagName(\"shadow-session\");\n      shadowSessionsLength = shadowSessionsNodes.length;\n      for (i = 0; i < shadowSessionsLength; i++) {\n         let aShadowSessionInstance = {};\n\n         this.setLaunchItemId(aShadowSessionInstance, shadowSessionsNodes[i]);\n\n         this.setLaunchItemName(aShadowSessionInstance, shadowSessionsNodes[i]);\n\n         this.setProtocols(aShadowSessionInstance, shadowSessionsNodes[i]);\n\n         this.setProtocolMatch(aShadowSessionInstance, shadowSessionsNodes[i]);\n\n         this.setApplicationType(aShadowSessionInstance, shadowSessionsNodes[i]);\n\n         util.addItemForJson(shadowSessions, i, aShadowSessionInstance);\n      }\n\n      JSCDKLogger.debug(\"shadow-sessions: \" + JSON.stringify(shadowSessions));\n      util.addItemForJson(launchItemsResponse, \"shadow-sessions\", shadowSessions);\n\n   } else if (result === \"error\") {\n      errorCodeNode = util.getChildNode(responseBody, \"error-code\", 0);\n      if (!!errorCodeNode) {\n         util.addItemForJson(launchItemsResponse, \"error-code\",\n            $(errorCodeNode).text());\n      }\n      errorMessageNode = util.getChildNode(responseBody, \"error-message\", 0);\n      if (!!errorMessageNode) {\n         util.addItemForJson(launchItemsResponse, \"error-message\",\n            $(errorMessageNode).text());\n      }\n   }\n   return launchItemsResponse;\n};\n\n/**\n * set protocol match or not\n *\n * @param aDesktopInstance[out] a launchItem instance to store corresponding\n *    info\n * @param launchItemNode[in] get information from this launchItem node\n */\nGetLaunchItemsHandler.prototype.setProtocolMatch =\n   function(aLaunchItemInstance, launchItemNode) {\n      let matchNode = util.getChildNode(launchItemNode, 'protocol-match', 0),\n         match = !!matchNode ? $(matchNode).text() : 'true';\n\n      util.addItemForJson(aLaunchItemInstance, 'protocol-match', match);\n   };\n\n/**\n * set preferredProtocol, defaultProtocol and supportedProtocol\n *\n * @param aLaunchItemInstance[out] a launchItem instance to store corresponding\n *    info\n * @param launchItemNode[in] get information from this launchItem node\n */\nGetLaunchItemsHandler.prototype.setProtocols =\n   function(aLaunchItemInstance, launchItemNode) {\n      let userPreferencesNode;\n      let preferenceNode;\n      let j;\n      let hasDefault = false;\n      let protocolsNode;\n      let protocolNode;\n      let protocolName;\n      let protocols = {};\n      let preferenceNameAttr;\n      let isDefaultNode;\n      let supportPreferredProtocol = false;\n      userPreferencesNode =\n         util.getChildNode(launchItemNode, \"user-preferences\", 0);\n      if (!!userPreferencesNode) {\n         preferenceNode =\n            userPreferencesNode.getElementsByTagName(\"preference\");\n      }\n      if (!!preferenceNode) {\n         for (j = 0; j < preferenceNode.length; j++) {\n            preferenceNameAttr = preferenceNode[j].getAttribute(\"name\");\n            // set preferred protocol here\n            if (preferenceNameAttr === \"protocol\") {\n               util.addItemForJson(aLaunchItemInstance, \"preferredProtocol\",\n                  $(preferenceNode[j]).text());\n            }\n         }\n      }\n      protocolsNode = util.getChildNode(launchItemNode, \"protocols\", 0);\n      if (!!protocolsNode) {\n         protocolNode = protocolsNode.getElementsByTagName(\"protocol\");\n      }\n      if (!!protocolNode) {\n         for (j = 0; j < protocolNode.length; j++) {\n            protocolName =\n               $(util.getChildNode(protocolNode[j], \"name\", 0)).text();\n            protocols[j] = protocolName;\n            if (protocolName === aLaunchItemInstance[\"preferredProtocol\"]) {\n               supportPreferredProtocol = true;\n            }\n            isDefaultNode = util.getChildNode(protocolNode[j], \"is-default\", 0);\n            if (!!isDefaultNode && $(isDefaultNode).text() === \"true\") {\n               // set default protocol if \"is-default\" is not null\n               hasDefault = true;\n               util.addItemForJson(aLaunchItemInstance, \"defaultProtocol\",\n                  protocolName);\n            }\n         }\n      }\n      // if \"is-default\" is null, set first protocol as default protocol\n      if (!hasDefault && !!protocolNode && (protocolNode.length > 0)) {\n         aLaunchItemInstance[\"defaultProtocol\"] =\n            $(util.getChildNode(protocolNode[0], \"name\", 0)).text();\n      }\n      // if no preferred protocol in user preference, set default protocol as it\n      if (!aLaunchItemInstance[\"preferredProtocol\"] ||\n         !supportPreferredProtocol) {\n         util.addItemForJson(aLaunchItemInstance, \"preferredProtocol\",\n            aLaunchItemInstance[\"defaultProtocol\"]);\n      }\n      // set supported protocols here\n      util.addItemForJson(aLaunchItemInstance, \"protocols\", protocols);\n   };\n\n/**\n * set desktop user preferences\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetLaunchItemsHandler.prototype.setDesktopUserPrefs =\n   function(aDesktopInstance, desktopNode) {\n      let preferenceNameAttr;\n      let j;\n      let userPreferencesNode;\n      let preferenceNode;\n      userPreferencesNode =\n         util.getChildNode(desktopNode, \"user-preferences\", 0);\n      if (!!userPreferencesNode) {\n         preferenceNode =\n            userPreferencesNode.getElementsByTagName(\"preference\");\n      }\n      if (!!preferenceNode) {\n         for (j = 0; j < preferenceNode.length; j++) {\n            preferenceNameAttr = preferenceNode[j].getAttribute(\"name\");\n            if (preferenceNameAttr === \"alwaysConnect\") {\n               // set alwaysConnect\n               util.addItemForJson(aDesktopInstance, \"alwaysConnect\",\n                  $(preferenceNode[j]).text());\n            }\n            if (preferenceNameAttr === \"screenSize\") {\n               // set screenSize\n               util.addItemForJson(aDesktopInstance, \"screenSize\",\n                  $(preferenceNode[j]).text());\n            }\n         }\n      }\n   };\n\n/**\n * set launchItem id\n *\n * @param aDesktopInstance[out] a launchItem instance to store corresponding\n *    info\n * @param launchItemNode[in] get information from this launchItem node\n */\nGetLaunchItemsHandler.prototype.setLaunchItemId =\n   function(aLaunchItemInstance, launchItemNode) {\n      let launchItemIdNode = util.getChildNode(launchItemNode, \"id\", 0),\n         launchItemId = !!launchItemIdNode ? $(launchItemIdNode).text() : \"\";\n\n      util.addItemForJson(aLaunchItemInstance, \"id\", launchItemId);\n   };\n\n/**\n * set launchItem name\n *\n * @param aDesktopInstance[out] a launchItem instance to store corresponding\n *    info\n * @param launchItemNode[in] get information from this launchItem node\n */\nGetLaunchItemsHandler.prototype.setLaunchItemName =\n   function(aLaunchItemInstance, launchItemNode) {\n      let launchItemNameNode = util.getChildNode(launchItemNode, \"name\", 0),\n         launchItemName = !!launchItemNameNode ? $(launchItemNameNode).text() :\n            \"\";\n\n      JSCDKLogger.debug(\"launchItemName: \" + launchItemName);\n      util.addItemForJson(aLaunchItemInstance, \"name\", launchItemName);\n   };\n\n/**\n * is accessable item\n *\n * @param launchItemNode[in] get information from this launchItem node\n */\nGetLaunchItemsHandler.prototype.isDisabledItem = function(launchItemNode) {\n   let launchItemDisabledNode = util.getChildNode(launchItemNode,\n      \"html-access-disabled\", 0);\n   return !!launchItemDisabledNode;\n};\n\n/**\n * set canLogoff\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetLaunchItemsHandler.prototype.setCanLogoff =\n   function(aDesktopInstance, desktopNode) {\n      let inMaintenanceModeNode =\n            util.getChildNode(desktopNode, \"in-maintenance-mode\", 0),\n         inMaintenanceMode = !!inMaintenanceModeNode ?\n            $(inMaintenanceModeNode).text() : \"false\",\n         responseStateNode =\n            util.getChildNode(desktopNode, \"state\", 0),\n         responseState = !!responseStateNode ? $(responseStateNode).text() :\n            \"No Session\",\n         responseStateLower = responseState.toLowerCase();\n\n      if (inMaintenanceMode === \"true\" ||\n         (responseStateLower !== \"connected\" &&\n         responseStateLower !== \"disconnected\")) {\n         /*\n          * Logoff of a desktop from the desktop selector is not possible if it is\n          * in maintenance mode, if it is checked out by another machine, or if\n          * the desktop state is something other than \"connected\" or \"disconnected\".\n          */\n         util.addItemForJson(aDesktopInstance, \"canLogoff\", \"false\");\n      } else {\n         util.addItemForJson(aDesktopInstance, \"canLogoff\", \"true\");\n      }\n   };\n\n/**\n * set reset-allowed\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetLaunchItemsHandler.prototype.setResetAllowed =\n   function(aDesktopInstance, desktopNode) {\n      let resetAllowedNode =\n            util.getChildNode(desktopNode, \"reset-allowed\", 0),\n         resetAllowed = !!resetAllowedNode ? $(resetAllowedNode).text() :\n            \"false\";\n\n      util.addItemForJson(aDesktopInstance, \"reset-allowed\", resetAllowed);\n   };\n\n/**\n * set reset-allowed-on-session\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetLaunchItemsHandler.prototype.setResetAllowedOnSession =\n   function(aDesktopInstance, desktopNode) {\n      let resetAllowedOnSessionNode =\n            util.getChildNode(desktopNode, \"reset-allowed-on-session\", 0),\n         resetAllowedOnSession = !!resetAllowedOnSessionNode ?\n            $(resetAllowedOnSessionNode).text() : \"false\";\n\n      util.addItemForJson(aDesktopInstance, \"reset-allowed-on-session\",\n         resetAllowedOnSession);\n   };\n\n/**\n * set in-maintenance-mode\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetLaunchItemsHandler.prototype.setInMaintenanceMode =\n   function(aDesktopInstance, desktopNode) {\n      let inMaintenanceModeNode =\n            util.getChildNode(desktopNode, \"in-maintenance-mode\", 0),\n         inMaintenanceMode = !!inMaintenanceModeNode ?\n            $(inMaintenanceModeNode).text() : \"false\";\n\n      util.addItemForJson(aDesktopInstance, \"in-maintenance-mode\",\n         inMaintenanceMode);\n   };\n\n/**\n * set response state\n *\n * @param aDesktopInstance[out] a launchItem instance to store corresponding\n *    info\n * @param launchItemNode[in] get information from this launchItem node\n */\nGetLaunchItemsHandler.prototype.setResponseState =\n   function(aDesktopInstance, launchItemNode) {\n      let responseStateNode =\n            util.getChildNode(launchItemNode, \"state\", 0),\n         responseState = !!responseStateNode ? $(responseStateNode).text() :\n            \"No Session\";\n\n      util.addItemForJson(aDesktopInstance, \"state\", responseState);\n   };\n\n/**\n * set session-id\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetLaunchItemsHandler.prototype.setSessionId =\n   function(aDesktopInstance, desktopNode) {\n      let sessionIdNode =\n            util.getChildNode(desktopNode, \"session-id\", 0),\n         sessionId = !!sessionIdNode ? $(sessionIdNode).text() : \"\";\n\n      util.addItemForJson(aDesktopInstance, \"session-id\", sessionId);\n   };\n\n/**\n * set canRollback\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetLaunchItemsHandler.prototype.setCanRollback =\n   function(aDesktopInstance, desktopNode) {\n      let offlineStateNode =\n            util.getChildNode(desktopNode, \"offline-state\", 0),\n         offlineState = !!offlineStateNode ? $(offlineStateNode).text() : \"\";\n\n      if (offlineState === \"checked out\") {\n         util.addItemForJson(aDesktopInstance, \"canRollback\", \"true\");\n      } else {\n         util.addItemForJson(aDesktopInstance, \"canRollback\", \"false\");\n      }\n   };\n\n/**\n * set application type\n *\n * @param aApplicationInstance[out] a application instance to store\n *    corresponding info\n * @param applicationNode[in] get information from this application node\n */\nGetLaunchItemsHandler.prototype.setApplicationType =\n   function(aApplicationInstance, applicationNode) {\n      let applicationTypeNode = util.getChildNode(applicationNode, \"type\", 0),\n         applicationType = !!applicationTypeNode ?\n            $(applicationTypeNode).text() : \"\";\n\n      util.addItemForJson(aApplicationInstance, \"type\", applicationType);\n   };\n\n/**\n * set application type\n *\n * @param aApplicationInstance[out] a application instance to store\n *    corresponding info\n * @param applicationNode[in] get information from this application node\n */\nGetLaunchItemsHandler.prototype.setLaunchItemOriginId =\n   function(aLaunchItemInstance, launchItemNode) {\n      let launchItemOriginIdNode = util.getChildNode(launchItemNode,\n         \"origin-id\", 0),\n         launchItemOriginId = !!launchItemOriginIdNode ?\n            $(launchItemOriginIdNode).text() : \"\";\n\n      util.addItemForJson(aLaunchItemInstance, \"origin-id\", launchItemOriginId);\n   };\n\n/**\n * set application type\n *\n * @param aApplicationInstance[out] a application instance to store\n *    corresponding info\n * @param applicationNode[in] get information from this application node\n */\nGetLaunchItemsHandler.prototype.setApplicationVersion =\n   function(aApplicationInstance, applicationNode) {\n      let applicationVersionNode = util.getChildNode(applicationNode, \"version\",\n         0),\n         applicationVersion = !!applicationVersionNode ?\n            $(applicationVersionNode).text() : \"\";\n\n      util.addItemForJson(aApplicationInstance, \"version\", applicationVersion);\n   };\n\n/**\n * set application type\n *\n * @param aApplicationInstance[out] a application instance to store\n *    corresponding info\n * @param applicationNode[in] get information from this application node\n */\nGetLaunchItemsHandler.prototype.setApplicationPublisher =\n   function(aApplicationInstance, applicationNode) {\n      let applicationPublisherNode = util.getChildNode(applicationNode,\n         \"publisher\", 0),\n         applicationPublisher = !!applicationPublisherNode ?\n            $(applicationPublisherNode).text() : \"\";\n\n      util.addItemForJson(aApplicationInstance, \"publisher\",\n         applicationPublisher);\n   };\n\n/**\n * set application type\n *\n * @param aApplicationInstance[out] a application instance to store\n *    corresponding info\n * @param applicationNode[in] get information from this application node\n */\nGetLaunchItemsHandler.prototype.setApplicationLaunchPath =\n   function(aApplicationInstance, applicationNode) {\n      let applicationLaunchPathNode = util.getChildNode(applicationNode,\n         \"launch-path\", 0),\n         applicationLaunchPath = !!applicationLaunchPathNode ?\n            $(applicationLaunchPathNode).text() : \"\";\n\n      util.addItemForJson(aApplicationInstance, \"launch-path\",\n         applicationLaunchPath);\n   };\n\n/**\n * set application type\n *\n * @param aApplicationInstance[out] a application instance to store\n *    corresponding info\n * @param applicationNode[in] get information from this application node\n */\nGetLaunchItemsHandler.prototype.setApplicationIcons =\n   function(aApplicationInstance, applicationNode) {\n      let iconsNode;\n      let iconNode;\n      let iconPath;\n      let iconWidth;\n      let iconHeight;\n      let icon;\n      let icons = {};\n      let j;\n\n      iconsNode = util.getChildNode(applicationNode, \"icons\", 0);\n      if (!!iconsNode) {\n         iconNode = iconsNode.getElementsByTagName(\"icon\");\n      }\n      if (!!iconNode) {\n         for (j = 0; j < iconNode.length; j++) {\n            icon = {};\n            iconPath = $(util.getChildNode(iconNode[j], \"path\", 0)).text();\n            iconWidth = $(util.getChildNode(iconNode[j], \"width\", 0)).text();\n            iconHeight = $(util.getChildNode(iconNode[j], \"height\", 0)).text();\n            util.addItemForJson(icon, \"path\", iconPath);\n            util.addItemForJson(icon, \"width\", iconWidth);\n            util.addItemForJson(icon, \"height\", iconHeight);\n            icons[j] = icon;\n         }\n      }\n\n      util.addItemForJson(aApplicationInstance, \"icons\", icons);\n   };\n\n/**\n * set application type\n *\n * @param aApplicationInstance[out] a application instance to store\n *    corresponding info\n * @param applicationNode[in] get information from this application node\n */\nGetLaunchItemsHandler.prototype.setApplicationSessionRemoteAssetsType =\n   function(aApplicationSessionInstance, applicationSessionNode) {\n      let applicationSessionRemoteAssetNode = util.getChildNode(\n         applicationSessionNode, \"has-remotable-assets\", 0),\n         applicationSessionRemoteAsset = !!applicationSessionRemoteAssetNode ?\n            $(applicationSessionRemoteAssetNode).text() : \"false\";\n\n      util.addItemForJson(aApplicationSessionInstance, \"has-remotable-assets\",\n         applicationSessionRemoteAsset);\n   };\n\n/**\n * action to disconnect desktop\n *\n */\nGetLaunchItemsHandler.prototype.disconnectDesktop = function() {\n   let logoutBrokerObject;\n   let router;\n   let handlerList;\n\n   logoutBrokerObject = util.getObject(globalArray, \"do-logout\");\n   if (!logoutBrokerObject) {\n      logoutBrokerObject = new DoLogoutHandler();\n      globalArray[logoutBrokerObject.messageName] = logoutBrokerObject;\n      globalArray[logoutBrokerObject.responseTag] = logoutBrokerObject;\n   } else {\n      logoutBrokerObject.resetData();\n   }\n\n   router = util.getObject(globalArray, \"router\");\n\n   if (!!logoutBrokerObject && !!router) {\n      handlerList = logoutBrokerObject.composeHandlerList();\n      router.postMessage(handlerList);\n   }\n};\n\n/**\n * action to reset desktop\n *\n * @param desktopId [in] desktop's id used to reset desktop\n */\nGetLaunchItemsHandler.prototype.resetDesktop = function(desktopId) {\n   let resetDesktopObject;\n   let router;\n   let handlerList;\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router && !!desktopId) {\n      /**\n       * each reset-desktop object corresponds to a desktop-id\n       * if the object already exists, reset data; otherwise create a new\n       * instance firstly locate handler from\n       * MessageHandler.prototype.requestIdKV\n       */\n      resetDesktopObject = router.getHandler(\"reset-desktop\", desktopId);\n      if (!resetDesktopObject) {\n         resetDesktopObject = new ResetDesktopHandler();\n         globalArray[resetDesktopObject.messageName +\n         resetDesktopObject.requestId] = resetDesktopObject;\n         globalArray[resetDesktopObject.responseTag +\n         resetDesktopObject.requestId] = resetDesktopObject;\n         /**\n          * update MessageHandler.prototype.requestIdKV\n          * the format is {responseTag1+desktop-id1 : requestId1,\n          * responseTag2+desktop-id2 : requestId2} such as key of\n          * ResetDesktopHandler is \"reset-desktop\"+desktopId\n          */\n         MessageHandler.prototype.requestIdKV[resetDesktopObject.responseTag +\n         desktopId]\n            = resetDesktopObject.requestId;\n      } else {\n         resetDesktopObject.resetData();\n      }\n\n      if (!!resetDesktopObject && !!router) {\n         resetDesktopObject.setRequestXML(desktopId);\n         handlerList = resetDesktopObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   }\n};\n\n/**\n * action to restart desktop\n *\n * @param desktopId [in] desktop's id used to restart desktop\n */\nGetLaunchItemsHandler.prototype.restartDesktop = function(desktopId) {\n   let restartDesktopObject;\n   let router;\n   let handlerList;\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router && !!desktopId) {\n      /**\n       * each restart-desktop object corresponds to a desktop-id\n       * if the object already exists, restart data; otherwise create a new\n       * instance firstly locate handler from\n       * MessageHandler.prototype.requestIdKV\n       */\n      restartDesktopObject = router.getHandler(\"restart-desktop\", desktopId);\n      if (!restartDesktopObject) {\n         restartDesktopObject = new RestartDesktopHandler();\n         globalArray[restartDesktopObject.messageName +\n         restartDesktopObject.requestId] = restartDesktopObject;\n         globalArray[restartDesktopObject.responseTag +\n         restartDesktopObject.requestId] = restartDesktopObject;\n         /**\n          * update MessageHandler.prototype.requestIdKV\n          * the format is {responseTag1+desktop-id1 : requestId1,\n          * responseTag2+desktop-id2 : requestId2} such as key of\n          * RestartDesktopHandler is \"restart-desktop\"+desktopId\n          */\n         MessageHandler.prototype.requestIdKV[restartDesktopObject.responseTag +\n         desktopId]\n            = restartDesktopObject.requestId;\n      } else {\n         restartDesktopObject.restartData();\n      }\n\n      if (!!restartDesktopObject && !!router) {\n         restartDesktopObject.setRequestXML(desktopId);\n         handlerList = restartDesktopObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   }\n};\n\n/**\n * action to logoff desktop\n *\n * @param desktopId [in] desktop's id used to log off desktop\n * @param sessionId [in] desktop's sessionId to use\n */\nGetLaunchItemsHandler.prototype.logoffDesktop = function(desktopId, sessionId) {\n   let killSessionObject;\n   let router;\n   let handlerList;\n\n   router = util.getObject(globalArray, \"router\");\n\n   if (!!router && !!desktopId && !!sessionId && (sessionId.trim() !== \"\")) {\n      /**\n       * each kill-session object corresponds to a desktop-id\n       * if the object already exists, reset data; otherwise create a new\n       * instance firstly locate handler from\n       * MessageHandler.prototype.requestIdKV\n       */\n      killSessionObject = router.getHandler(\"kill-session\", desktopId);\n      if (!killSessionObject) {\n         killSessionObject = new KillSessionHandler();\n         globalArray[killSessionObject.messageName +\n         killSessionObject.requestId] = killSessionObject;\n         globalArray[killSessionObject.responseTag +\n         killSessionObject.requestId] = killSessionObject;\n         /**\n          * update MessageHandler.prototype.requestIdKV\n          * the format is {responseTag1+desktop-id1 : requestId1,\n          * responseTag2+desktop-id2 : requestId2} such as key of\n          * KillSessionHandler is \"kill-session\"+desktopId\n          */\n         MessageHandler.prototype.requestIdKV[killSessionObject.responseTag +\n         desktopId]\n            = killSessionObject.requestId;\n      } else {\n         killSessionObject.resetData();\n      }\n\n      if (!!killSessionObject && !!router) {\n         killSessionObject.setRequestXML(sessionId);\n         handlerList = killSessionObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   }\n};\n\n/**\n * find desktop by desktopId(desktop id or desktop name)\n *\n * @param desktopId [in] desktop id to use.\n * @param desktops [in] desktop list to be located.\n * @return target desktop whose id equals desktopId\n */\nGetLaunchItemsHandler.prototype.findDesktop = function(desktopId, desktops) {\n   let targetDesktop;\n   let oneDesktop;\n\n   if (!!desktopId) {\n      for (oneDesktop in desktops) {\n         /*\n          * Use normalized (URL encoded and lower case) DN as the desktop\n          * ID to follow Horizon's new rule.\n          * Also, user may use the desktop as the desktop ID.\n          */\n         if (encodeURIComponent(desktops[oneDesktop].id.toLowerCase())\n            === encodeURIComponent(desktopId.toLowerCase()) ||\n            desktops[oneDesktop].name.toLowerCase()\n            === desktopId.toLowerCase()) {\n            targetDesktop = desktops[oneDesktop];\n            break;\n         }\n      }\n   }\n   return targetDesktop;\n};\n// add more functions here\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/getLaunchItemsHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * jscdkBrokerError.js --\n *\n * Enums JSCDK broker errors.\n *\n */\n\nimport util from '../util';\nimport JSCDKError from './jscdkError';\n\n\nlet JSCDKBrokerError = {\n\n   JSCDK_BROKER_ERROR_ALREADY_AUTHENTICATED: \"ALREADY_AUTHENTICATED\",\n   JSCDK_BROKER_ERROR_AUTHENTICATION_FAILED: \"AUTHENTICATION_FAILED\",\n   JSCDK_BROKER_ERROR_BROKER_DISABLED: \"BROKER_DISABLED\",\n   JSCDK_BROKER_ERROR_DESKTOP_LAUNCH_ERROR: \"DESKTOP_LAUNCH_ERROR\",\n   JSCDK_BROKER_ERROR_DESKTOP_MAINTENANCE_ERROR: \"DESKTOP_MAINTENANCE_ERROR\",\n   JSCDK_BROKER_ERROR_DESKTOP_ROLLBACK_CHECKOUT_ERROR: \"DESKTOP_ROLLBACK_CHECKOUT_ERROR\",\n   JSCDK_BROKER_ERROR_APPLICATION_LAUNCH_ERROR: \"APPLICATION_LAUNCH_ERROR\",\n   JSCDK_BROKER_ERROR_DESKTOPS_ERROR: \"DESKTOPS_ERROR\",\n   JSCDK_BROKER_ERROR_LAUNCH_ITEMS_ERROR: \"LAUNCH_ITEMS_ERROR\",\n   JSCDK_BROKER_ERROR_INVALID_ROOT_ELEMENT: \"INVALID_ROOT_ELEMENT\",\n   JSCDK_BROKER_ERROR_INVALID_VERSION: \"INVALID_VERSION\",\n   JSCDK_BROKER_ERROR_INVALID_XML: \"INVALID_XML\",\n   JSCDK_BROKER_ERROR_KILL_SESSION_ERROR: \"KILL_SESSION_ERROR\",\n   JSCDK_BROKER_ERROR_MISSING_CONTENT: \"MISSING_CONTENT\",\n   JSCDK_BROKER_ERROR_MISSING_VERSION: \"MISSING_VERSION\",\n   JSCDK_BROKER_ERROR_NOT_AUTHENTICATED: \"NOT_AUTHENTICATED\",\n   JSCDK_BROKER_ERROR_NOT_ENTITLED: \"NOT_ENTITLED\",\n   JSCDK_BROKER_ERROR_PREFERENCES_ERROR: \"PREFERENCES_ERROR\",\n   JSCDK_BROKER_ERROR_READ_ERROR: \"READ_ERROR\",\n   JSCDK_BROKER_ERROR_RESET_DESKTOP_ERROR: \"RESET_DESKTOP_ERROR\",\n   JSCDK_BROKER_ERROR_TUNNEL_ERROR: \"TUNNEL_ERROR\",\n   JSCDK_BROKER_ERROR_UNRECOGNIZED_CONTENT: \"UNRECOGNIZED_CONTENT\",\n   JSCDK_BROKER_ERROR_UNSUPPORTED_VERSION: \"UNSUPPORTED_VERSION\",\n   JSCDK_BROKER_ERROR_TIMEOUT: \"TIMEOUT\",\n   JSCDK_BROKER_ERROR_CONNECT_TO_BROKER_ERROR: \"CONNECT_TO_BROKER_ERROR\",\n   JSCDK_BROKER_ERROR_UNKNOWN: \"UNKNOWN\",\n\n   getError: function(errorCode) {\n      let error = null;\n\n      if (errorCode === this.JSCDK_BROKER_ERROR_TIMEOUT) {\n         error = new JSCDKError('TIMEOUT',\n            util._(\"AJAX post request timeout.\"));\n      } else if (errorCode ===\n         this.JSCDK_BROKER_ERROR_CONNECT_TO_BROKER_ERROR) {\n         error = new JSCDKError('CONNECT_TO_BROKER_ERROR',\n            util._(\"Failed to connect to the Connection Server.\"));\n      } else if (errorCode === this.JSCDK_BROKER_ERROR_UNKNOWN) {\n         error = new JSCDKError('UNKNOWN',\n            util._(\"An unknown error occurred.\"));\n      }\n\n      return error;\n   }\n};\n\nexport default JSCDKBrokerError;\n\n\n// WEBPACK FOOTER //\n// ./jscdk/model/jscdkBrokerError.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * signal.js --\n *\n * Make arbitrary objects follow the observer pattern.\n */\n\nimport AB from './appblast-util';\n\nlet signal = (function () {\n   /**\n    * dispatch\n    *\n    * Returns a function which proxies for a call on the named method\n    * on an object found in the given dispatch table. The first\n    * parameter of the returned function is a 'name', which is used to\n    * index into the dispatch table. All other parameters are passed\n    * to the underlying method.\n    *\n    * @param table         The dispatch table, a map from string -> object\n    * @param method        The name of the method to invoke on the found object.\n    * @param errNoInstance Error to throw if instance name isn't found\n    * @param errNoMethod   Error to throw if instance method isn't found.\n    */\n\n   function dispatch (table, method, errNoInstance, errNoMethod) {\n      return function (name) {\n         // strip off the first argument, which is used as the key.\n         let args = Array.prototype.slice.call(arguments, 1);\n\n         if (table.hasOwnProperty(name)) {\n            /* istanbul ignore else */\n            if (table[name] !== undefined) {\n               table[name][method].apply(table[name], args);\n            } else {\n               throw /* istanbul ignore next */ errNoMethod || 'MethodNotFound';\n            }\n         } else {\n            AB.LOGGER.log(name, 'not one of', table);\n            throw /* istanbul ignore next */ errNoInstance || 'InstanceNotFound';\n         }\n      };\n   }\n\n   return {\n      /**\n       * createSignal\n       *\n       * Returns a new 'signal' object, which represents an observable\n       * event on an object.\n       */\n      createSignal: function () {\n         let handlers = [];\n         let i;\n\n         return {\n            /*\n             * emit\n             *\n             * Calls all registered listeners. All arguments passed\n             * to emit() are passed to each listener.\n             */\n            emit: function () {\n               for (i = 0; i < handlers.length; i++) {\n                  handlers[i].apply(null, arguments);\n               }\n            },\n\n            /*\n             * addEventListener\n             *\n             * Register a new signal handler to the signal. If the\n             * function is already registered, an error is raised.\n             *\n             * @param handler A signal handler callback\n             */\n            addEventListener: function (handler) {\n               if (handlers.indexOf(handler) === -1) {\n                  handlers.push(handler);\n               } else {\n                  throw 'Duplicate event listener';\n               }\n            },\n         };\n      },\n\n      /**\n       * makeObservable\n       *\n       * Makes an arbitrary object conform to the 'observable' pattern by\n       * implementing 'addEventListener', 'emit', and 'addSignal'\n       * methods.\n       *\n       * @param object The object to be made observable.\n       */\n      makeObservable: function (object) {\n         let signals = {};\n\n         /**\n          * addEventListener\n          *\n          * Register a handler for the named signal.\n          *\n          * @param name The signal name to observe.\n          */\n         object.addEventListener = dispatch(signals,\n                                            'addEventListener',\n                                            'InvalidSignal');\n\n         /**\n          * emit\n          *\n          * Emit the named signal on an observable object. All\n          * handlers registered with that signal will be invoked. Each\n          * handler will be invoked with the extra arguments passed to\n          * emit() (all arguments after 'name').\n          *\n          * @param name The signal name to emit.\n          */\n         object.emit = dispatch(signals, 'emit', 'InvalidSignal');\n\n         /**\n          * addSignal\n          *\n          * Register a new signal with an observable object. After\n          * calling this, handlers may be connected to the named signal\n          * via 'addEventListener'. If the signal has already been\n          * registered, an error is thrown.\n          *\n          * @param name The signal to create.\n          */\n         object.addSignal = function (name) {\n            if (signals.hasOwnProperty(name)) {\n               throw \"DuplicateSignal\";\n            }\n\n            signals[name] = signal.createSignal(name);\n         };\n      }\n   };\n}());\n\nexport default signal;\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/signal.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getDesktopsHandler.js --\n *\n *      Implementation of the message handler to get desktops.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport Router from './router';\nimport DoLogoutHandler from './doLogoutHandler';\nimport KillSessionHandler from './killSessionHandler';\nimport ResetDesktopHandler from './resetDesktopHandler';\n\n\nexport default function GetDesktopsHandler() {\n   let doSubmitAuthenticationObject;\n   let router;\n   let getTunnelConnObject;\n\n   // member variables\n   this.messageName = \"get-desktops\";\n   this.messageText = \"get-desktops\";\n   this.responseTag = \"desktops\";\n\n   // whether to notify UI on get-desktops response.\n   this.notifyUI = true;\n\n   this.subHandlerList = [];\n   this.composedHandlerList = [];\n\n   // register dependencies here\n   getTunnelConnObject =\n      util.getObject(globalArray, \"get-tunnel-connection\");\n   if (!!getTunnelConnObject) {\n      this.registerHandler(getTunnelConnObject, \"state\");\n   } else {\n      JSCDKLogger.error(\"The get-tunnel-connection object is null!\");\n   }\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nGetDesktopsHandler.prototype = new MessageHandler();\nGetDesktopsHandler.constructor = GetDesktopsHandler;\n\n/**\n * Reset handler's state and content.\n *\n */\nGetDesktopsHandler.prototype.resetData = function() {\n   MessageHandler.prototype.resetData.apply(this);\n\n   this.notifyUI = true;\n};\n\n/**\n * Set the request XML for getDesktops.\n *\n * @param supportedProtocols [in] array for supported protocols.\n */\nGetDesktopsHandler.prototype.setRequestXML =\n   function(supportedProtocols, notifyUI) {\n      let nameElement,\n         protocolElement,\n         protocolsElement = \"\",\n         i;\n      for (i = 0; i < supportedProtocols.length; i++) {\n         nameElement = util.createElement(\"name\", supportedProtocols[i]);\n         protocolElement = util.createElement(\"protocol\", nameElement);\n         protocolsElement += protocolElement;\n      }\n      this.requestXML =\n         util.createElement(\"supported-protocols\", protocolsElement);\n\n      if (typeof notifyUI === 'boolean') {\n         // Whether to notify UI on get-desktops response.\n         this.notifyUI = notifyUI;\n      } else {\n         // Always notify UI on get-desktops response.\n         this.notifyUI = true;\n      }\n   };\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nGetDesktopsHandler.prototype.onUpdated = function() {\n   let getDesktopsAction = {},\n      actionContent = {},\n      router,\n      urlHandler,\n      urlParams;\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if ((this.state === StateEnum.DONE)) {\n      if (this.notifyUI) {\n         // Compose refresh UI request.\n         getDesktopsAction.name = \"GetLaunchItems\";//this whole handler will be\n                                                   // merged to getLuanchItems\n                                                   // later( TODO: ), the\n                                                   // interface of this file is\n                                                   // changed just for now,\n                                                   // later there will be no\n                                                   // more get desktops\n         if (!!globalArray) {\n            router = globalArray[\"router\"];\n            if (!!router) {\n               actionContent.brokerUrl = router.brokerUrl;\n            }\n         }\n         if (!!(this.content[\"parsedResult\"])) {\n            actionContent.desktops = this.content.parsedResult.desktops;\n         }\n         // Handle the desktopId passed through URI.\n         urlHandler = util.getObject(globalArray, \"url-handler\");\n         if (!!urlHandler) {\n            urlParams = urlHandler.params;\n            if (!!urlParams.desktopId) {\n               actionContent.desktopId = urlParams.desktopId;\n               actionContent.action = urlParams.action;\n               if (!!urlParams.desktopProtocol) {\n                  actionContent.targetProtocol =\n                     urlParams.desktopProtocol.toUpperCase();\n               }\n            }\n         }\n\n         getDesktopsAction.content = actionContent;\n         JSCDKSetUI(JSON.stringify(getDesktopsAction));\n      }\n   }\n   // if the error is special for this handler, alert\n   Router.prototype.pushErrorToUser(this);\n};\n\n/**\n * parse desktops information from the response XML\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\nGetDesktopsHandler.prototype.parseResult = function(responseXML) {\n   let responseBody = responseXML;\n   let desktopResponse = {};\n   let result;\n   let resultElem;\n   let desktops = {};\n   let desktopsNodes;\n   let desktopsLength;\n   let errorCodeNode;\n   let errorMessageNode;\n   let desktop;\n   let i;\n   let brokerTag = util.getChildNode(responseBody, \"broker\", 0);\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of GetDesktops error.\");\n      return null;\n   }\n   resultElem = util.getChildNode(brokerTag, \"result\", 0);\n   if (!resultElem || !(resultElem.hasChildNodes())) {\n      return null;\n   }\n   result = resultElem.childNodes[0].nodeValue;\n   desktopResponse[\"result\"] = result;\n   if (result === \"ok\") {\n      desktopsNodes = brokerTag.getElementsByTagName(\"desktop\");\n      desktopsLength = desktopsNodes.length;\n      for (i = 0; i < desktopsLength; i++) {\n         let aDesktopInstance = {};\n\n         // set desktop name\n         this.setDesktopName(aDesktopInstance, desktopsNodes[i]);\n\n         // set desktop id\n         this.setDesktopId(aDesktopInstance, desktopsNodes[i]);\n\n         // set response state\n         this.setResponseState(aDesktopInstance, desktopsNodes[i]);\n\n         // set sessionId\n         this.setSessionId(aDesktopInstance, desktopsNodes[i]);\n\n         // set checkedOut\n         this.setCheckedOut(aDesktopInstance, desktopsNodes[i]);\n\n         // set inMaintenanceMode\n         this.setInMaintenanceMode(aDesktopInstance, desktopsNodes[i]);\n\n         // set protocol match\n         this.setProtocolMatch(aDesktopInstance, desktopsNodes[i]);\n\n         // set preferred protocol, defaultProtocol and supportedProtocol\n         this.setProtocols(aDesktopInstance, desktopsNodes[i]);\n\n         // set desktop user preferences\n         this.setDesktopUserPrefs(aDesktopInstance, desktopsNodes[i]);\n\n         // set canLogoff: whether the desktop can logoff\n         this.setCanLogoff(aDesktopInstance, desktopsNodes[i]);\n\n         // set resetAllowed\n         this.setResetAllowed(aDesktopInstance, desktopsNodes[i]);\n\n         // set resetAllowedOnSession\n         this.setResetAllowedOnSession(aDesktopInstance, desktopsNodes[i]);\n\n         // set canRollback: whether the desktop can rollback\n         this.setCanRollback(aDesktopInstance, desktopsNodes[i]);\n\n         util.addItemForJson(desktops, i, aDesktopInstance);\n         JSCDKLogger.debug(\n            \"aDesktopInstance: \" + JSON.stringify(aDesktopInstance));\n      }\n      // XXX TODO: more desktop properties to handle\n      JSCDKLogger.debug(\"desktops: \" + JSON.stringify(desktops));\n      util.addItemForJson(desktopResponse, \"desktops\", desktops);\n   } else if (result === \"error\") {\n      errorCodeNode = util.getChildNode(responseBody, \"error-code\", 0);\n      if (!!errorCodeNode) {\n         util.addItemForJson(desktopResponse, \"error-code\",\n            $(errorCodeNode).text());\n      }\n      errorMessageNode = util.getChildNode(responseBody, \"error-message\", 0);\n      if (!!errorMessageNode) {\n         util.addItemForJson(desktopResponse, \"error-message\",\n            $(errorMessageNode).text());\n      }\n   }\n   return desktopResponse;\n};\n\n/**\n * set protocol match or not\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setProtocolMatch =\n   function(aDesktopInstance, desktopNode) {\n      let matchNode = util.getChildNode(desktopNode, 'protocol-match', 0),\n         match = !!matchNode ? $(matchNode).text() : 'true';\n\n      util.addItemForJson(aDesktopInstance, 'protocol-match', match);\n   };\n\n/**\n * set preferredProtocol, defaultProtocol and supportedProtocol\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setProtocols =\n   function(aDesktopInstance, desktopNode) {\n      let userPreferencesNode;\n      let preferenceNode;\n      let j;\n      let hasDefault = false;\n      let protocolsNode;\n      let protocolNode;\n      let protocolName;\n      let protocols = {};\n      let preferenceNameAttr;\n      let isDefaultNode;\n      let supportPreferredProtocol = false;\n      userPreferencesNode =\n         util.getChildNode(desktopNode, \"user-preferences\", 0);\n      if (!!userPreferencesNode) {\n         preferenceNode =\n            userPreferencesNode.getElementsByTagName(\"preference\");\n      }\n      if (!!preferenceNode) {\n         for (j = 0; j < preferenceNode.length; j++) {\n            preferenceNameAttr = preferenceNode[j].getAttribute(\"name\");\n            // set preferred protocol here\n            if (preferenceNameAttr === \"protocol\") {\n               util.addItemForJson(aDesktopInstance, \"preferredProtocol\",\n                  $(preferenceNode[j]).text());\n            }\n         }\n      }\n      protocolsNode = util.getChildNode(desktopNode, \"protocols\", 0);\n      if (!!protocolsNode) {\n         protocolNode = protocolsNode.getElementsByTagName(\"protocol\");\n      }\n      if (!!protocolNode) {\n         for (j = 0; j < protocolNode.length; j++) {\n            protocolName =\n               $(util.getChildNode(protocolNode[j], \"name\", 0)).text();\n            protocols[j] = protocolName;\n            if (protocolName === aDesktopInstance[\"preferredProtocol\"]) {\n               supportPreferredProtocol = true;\n            }\n            isDefaultNode = util.getChildNode(protocolNode[j], \"is-default\", 0);\n            if (!!isDefaultNode && $(isDefaultNode).text() === \"true\") {\n               // set default protocol if \"is-default\" is not null\n               hasDefault = true;\n               util.addItemForJson(aDesktopInstance, \"defaultProtocol\",\n                  protocolName);\n            }\n         }\n      }\n      // if \"is-default\" is null, set first protocol as default protocol\n      if (!hasDefault && !!protocolNode && (protocolNode.length > 0)) {\n         aDesktopInstance[\"defaultProtocol\"] =\n            $(util.getChildNode(protocolNode[0], \"name\", 0)).text();\n      }\n      // if no preferred protocol in user preference, set default protocol as it\n      if (!aDesktopInstance[\"preferredProtocol\"] || !supportPreferredProtocol) {\n         util.addItemForJson(aDesktopInstance, \"preferredProtocol\",\n            aDesktopInstance[\"defaultProtocol\"]);\n      }\n      // set supported protocols here\n      util.addItemForJson(aDesktopInstance, \"protocols\", protocols);\n   };\n\n/**\n * set desktop user preferences\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setDesktopUserPrefs =\n   function(aDesktopInstance, desktopNode) {\n      let preferenceNameAttr;\n      let j;\n      let userPreferencesNode;\n      let preferenceNode;\n      userPreferencesNode =\n         util.getChildNode(desktopNode, \"user-preferences\", 0);\n      if (!!userPreferencesNode) {\n         preferenceNode =\n            userPreferencesNode.getElementsByTagName(\"preference\");\n      }\n      if (!!preferenceNode) {\n         for (j = 0; j < preferenceNode.length; j++) {\n            preferenceNameAttr = preferenceNode[j].getAttribute(\"name\");\n            if (preferenceNameAttr === \"alwaysConnect\") {\n               // set alwaysConnect\n               util.addItemForJson(aDesktopInstance, \"alwaysConnect\",\n                  $(preferenceNode[j]).text());\n            }\n            if (preferenceNameAttr === \"screenSize\") {\n               // set screenSize\n               util.addItemForJson(aDesktopInstance, \"screenSize\",\n                  $(preferenceNode[j]).text());\n            }\n         }\n      }\n   };\n\n/**\n * set desktop id\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setDesktopId =\n   function(aDesktopInstance, desktopNode) {\n      let desktopIdNode = util.getChildNode(desktopNode, \"id\", 0),\n         desktopId = !!desktopIdNode ? $(desktopIdNode).text() : \"\";\n\n      util.addItemForJson(aDesktopInstance, \"id\", desktopId);\n   };\n\n/**\n * set desktop name\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setDesktopName =\n   function(aDesktopInstance, desktopNode) {\n      let desktopNameNode = util.getChildNode(desktopNode, \"name\", 0),\n         desktopName = !!desktopNameNode ? $(desktopNameNode).text() : \"\";\n\n      JSCDKLogger.debug(\"desktopName: \" + desktopName);\n      util.addItemForJson(aDesktopInstance, \"name\", desktopName);\n   };\n\n/**\n * set canLogoff\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setCanLogoff =\n   function(aDesktopInstance, desktopNode) {\n      let inMaintenanceModeNode =\n            util.getChildNode(desktopNode, \"in-maintenance-mode\", 0),\n         checkoutGuid =\n            util.getChildNode(desktopNode, \"checkout-guid\", 0),\n         inMaintenanceMode = !!inMaintenanceModeNode ?\n            $(inMaintenanceModeNode).text() : \"false\",\n         checkedOut = (!!checkoutGuid && $(checkoutGuid).text() !== \"\") ?\n            \"true\" : \"false\",\n         responseStateNode =\n            util.getChildNode(desktopNode, \"state\", 0),\n         responseState = !!responseStateNode ? $(responseStateNode).text() :\n            \"No Session\",\n         responseStateLower = responseState.toLowerCase();\n\n      if (inMaintenanceMode === \"true\" || checkedOut === \"true\" ||\n         (responseStateLower !== \"connected\" &&\n         responseStateLower !== \"disconnected\")) {\n         /*\n          * Logoff of a desktop from the desktop selector is not possible if it is\n          * in maintenance mode, if it is checked out by another machine, or if\n          * the desktop state is something other than \"connected\" or \"disconnected\".\n          */\n         util.addItemForJson(aDesktopInstance, \"canLogoff\", \"false\");\n      } else {\n         util.addItemForJson(aDesktopInstance, \"canLogoff\", \"true\");\n      }\n   };\n\n/**\n * set reset-allowed\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setResetAllowed =\n   function(aDesktopInstance, desktopNode) {\n      let resetAllowedNode =\n            util.getChildNode(desktopNode, \"reset-allowed\", 0),\n         resetAllowed = !!resetAllowedNode ? $(resetAllowedNode).text() :\n            \"false\";\n\n      util.addItemForJson(aDesktopInstance, \"reset-allowed\", resetAllowed);\n   };\n\n/**\n * set reset-allowed-on-session\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setResetAllowedOnSession =\n   function(aDesktopInstance, desktopNode) {\n      let resetAllowedOnSessionNode =\n            util.getChildNode(desktopNode, \"reset-allowed-on-session\", 0),\n         resetAllowedOnSession = !!resetAllowedOnSessionNode ?\n            $(resetAllowedOnSessionNode).text() : \"false\";\n\n      util.addItemForJson(aDesktopInstance, \"reset-allowed-on-session\",\n         resetAllowedOnSession);\n   };\n\n/**\n * set in-maintenance-mode\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setInMaintenanceMode =\n   function(aDesktopInstance, desktopNode) {\n      let inMaintenanceModeNode =\n            util.getChildNode(desktopNode, \"in-maintenance-mode\", 0),\n         inMaintenanceMode = !!inMaintenanceModeNode ?\n            $(inMaintenanceModeNode).text() : \"false\";\n\n      util.addItemForJson(aDesktopInstance, \"in-maintenance-mode\",\n         inMaintenanceMode);\n   };\n\n/**\n * set checkedOut\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setCheckedOut =\n   function(aDesktopInstance, desktopNode) {\n      let checkedOut = \"false\";\n      let checkedOutNode =\n         util.getChildNode(desktopNode, \"checkout-guid\", 0);\n      if (!!checkedOutNode && $(checkedOutNode).text().length > 0) {\n         checkedOut = \"true\";\n      }\n\n      util.addItemForJson(aDesktopInstance, \"checkedOut\", checkedOut);\n   };\n\n\n/**\n * set response state\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setResponseState =\n   function(aDesktopInstance, desktopNode) {\n      let responseStateNode =\n            util.getChildNode(desktopNode, \"state\", 0),\n         responseState = !!responseStateNode ? $(responseStateNode).text() :\n            \"No Session\";\n\n      util.addItemForJson(aDesktopInstance, \"state\", responseState);\n   };\n\n/**\n * set session-id\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setSessionId =\n   function(aDesktopInstance, desktopNode) {\n      let sessionIdNode =\n            util.getChildNode(desktopNode, \"session-id\", 0),\n         sessionId = !!sessionIdNode ? $(sessionIdNode).text() : \"\";\n\n      util.addItemForJson(aDesktopInstance, \"session-id\", sessionId);\n   };\n\n/**\n * set canRollback\n *\n * @param aDesktopInstance[out] a desktop instance to store corresponding info\n * @param desktopNode[in] get information from this desktop node\n */\nGetDesktopsHandler.prototype.setCanRollback =\n   function(aDesktopInstance, desktopNode) {\n      let offlineStateNode =\n            util.getChildNode(desktopNode, \"offline-state\", 0),\n         offlineState = !!offlineStateNode ? $(offlineStateNode).text() : \"\";\n\n      if (offlineState === \"checked out\") {\n         util.addItemForJson(aDesktopInstance, \"canRollback\", \"true\");\n      } else {\n         util.addItemForJson(aDesktopInstance, \"canRollback\", \"false\");\n      }\n   };\n\n/**\n * action to disconnect desktop\n *\n */\nGetDesktopsHandler.prototype.disconnectDesktop = function() {\n   let logoutBrokerObject;\n   let router;\n   let handlerList;\n\n   logoutBrokerObject = util.getObject(globalArray, \"do-logout\");\n   if (!logoutBrokerObject) {\n      logoutBrokerObject = new DoLogoutHandler();\n      globalArray[logoutBrokerObject.messageName] = logoutBrokerObject;\n      globalArray[logoutBrokerObject.responseTag] = logoutBrokerObject;\n   } else {\n      logoutBrokerObject.resetData();\n   }\n\n   router = util.getObject(globalArray, \"router\");\n\n   if (!!logoutBrokerObject && !!router) {\n      handlerList = logoutBrokerObject.composeHandlerList();\n      router.postMessage(handlerList);\n   }\n};\n\n/**\n * action to reset desktop\n *\n * @param desktopId [in] desktop's id used to reset desktop\n */\nGetDesktopsHandler.prototype.resetDesktop = function(desktopId) {\n   let resetDesktopObject;\n   let router;\n   let handlerList;\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router && !!desktopId) {\n      /**\n       * each reset-desktop object corresponds to a desktop-id\n       * if the object already exists, reset data; otherwise create a new\n       * instance firstly locate handler from\n       * MessageHandler.prototype.requestIdKV\n       */\n      resetDesktopObject = router.getHandler(\"reset-desktop\", desktopId);\n      if (!resetDesktopObject) {\n         resetDesktopObject = new ResetDesktopHandler();\n         globalArray[resetDesktopObject.messageName +\n         resetDesktopObject.requestId] = resetDesktopObject;\n         globalArray[resetDesktopObject.responseTag +\n         resetDesktopObject.requestId] = resetDesktopObject;\n         /**\n          * update MessageHandler.prototype.requestIdKV\n          * the format is {responseTag1+desktop-id1 : requestId1,\n          * responseTag2+desktop-id2 : requestId2} such as key of\n          * ResetDesktopHandler is \"reset-desktop\"+desktopId\n          */\n         MessageHandler.prototype.requestIdKV[resetDesktopObject.responseTag +\n         desktopId]\n            = resetDesktopObject.requestId;\n      } else {\n         resetDesktopObject.resetData();\n      }\n\n      if (!!resetDesktopObject && !!router) {\n         resetDesktopObject.setRequestXML(desktopId);\n         handlerList = resetDesktopObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   }\n};\n\n/**\n * action to logoff desktop\n *\n * @param desktopId [in] desktop's id used to log off desktop\n * @param sessionId [in] desktop's sessionId to use\n */\nGetDesktopsHandler.prototype.logoffDesktop = function(desktopId, sessionId) {\n   let killSessionObject;\n   let router;\n   let handlerList;\n\n   router = util.getObject(globalArray, \"router\");\n\n   if (!!router && !!desktopId && !!sessionId && (sessionId.trim() !== \"\")) {\n      /**\n       * each kill-session object corresponds to a desktop-id\n       * if the object already exists, reset data; otherwise create a new\n       * instance firstly locate handler from\n       * MessageHandler.prototype.requestIdKV\n       */\n      killSessionObject = router.getHandler(\"kill-session\", desktopId);\n      if (!killSessionObject) {\n         killSessionObject = new KillSessionHandler();\n         globalArray[killSessionObject.messageName +\n         killSessionObject.requestId] = killSessionObject;\n         globalArray[killSessionObject.responseTag +\n         killSessionObject.requestId] = killSessionObject;\n         /**\n          * update MessageHandler.prototype.requestIdKV\n          * the format is {responseTag1+desktop-id1 : requestId1,\n          * responseTag2+desktop-id2 : requestId2} such as key of\n          * KillSessionHandler is \"kill-session\"+desktopId\n          */\n         MessageHandler.prototype.requestIdKV[killSessionObject.responseTag +\n         desktopId]\n            = killSessionObject.requestId;\n      } else {\n         killSessionObject.resetData();\n      }\n\n      if (!!killSessionObject && !!router) {\n         killSessionObject.setRequestXML(sessionId);\n         handlerList = killSessionObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   }\n};\n\n/**\n * find desktop by desktopId(desktop id or desktop name)\n *\n * @param desktopId [in] desktop id to use.\n * @param desktops [in] desktop list to be located.\n * @return target desktop whose id equals desktopId\n */\nGetDesktopsHandler.prototype.findDesktop = function(desktopId, desktops) {\n   let targetDesktop;\n   let oneDesktop;\n\n   if (!!desktopId) {\n      for (oneDesktop in desktops) {\n         /*\n          * Use normalized (URL encoded and lower case) DN as the desktop\n          * ID to follow Horizon's new rule.\n          * Also, user may use the desktop as the desktop ID.\n          */\n         if (encodeURIComponent(desktops[oneDesktop].id.toLowerCase())\n            === encodeURIComponent(desktopId.toLowerCase()) ||\n            desktops[oneDesktop].name.toLowerCase()\n            === desktopId.toLowerCase()) {\n            targetDesktop = desktops[oneDesktop];\n            break;\n         }\n      }\n   }\n   return targetDesktop;\n};\n// add more functions here\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/getDesktopsHandler.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default angular.module(\"com.vmware.vdi.htmlaccess.template\", []).name;\n\n\n// WEBPACK FOOTER //\n// ./template-module.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// /Users/yuez/gitvmware/htmlaccess1/ui/~/ng-dialog/css/ngDialog.css\n// module id = 20\n// module chunks = 0 1","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./styles/modal-dialogs.css\n// module id = 21\n// module chunks = 0 1","/**********************************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n **********************************************************************/\n\n/**\n * VDPService.js\n *\n *   Interface that lies between the View Virtual Channel(VVC) APIs and the Unity client\n *   plugin providing easy communication with the remote application using Remote\n *   Procedure Calls. Tbe server side VDPService written in C++ can be found at\n *   bora/apps/rde/vdpservice.\n *\n *   A root VDPService.Service instance needs to be created. Then listeners can be added\n *   which are called when a channel is opened by the remote application:\n *      .addChannelCreatedListener This listener is called when the server creates a new\n *                                 channel.\n *\n *   Please refer to VDPService.Service documentation.\n *\n *   A VDPService.Channel instance is a RPC wrapper to VVCChannel. The following listeners\n *   must be added:\n *      .onReady                 Called when the VDPService.Channel instance is ready to\n *                               send RPCs.\n *      .onDisconnect            Called when the VDPService.Channel is disconnected and\n *                               can no longer send RPCs.\n *      .onInvoke                Called when the server on the other end of the channel\n *                               called Invoke(), that is, when there is a new RPC message\n *                               received.\n *\n *   Please refer to VDPService.Channel documentation.\n */\n\n\nimport StringUtils from '../common/string-utils';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\n\nlet VDPService = Object.freeze({\n   /**\n    * VDPService.Channel state.\n    *\n    * @enum {Integer}\n    * @readonly\n    */\n   CHANNEL_STATE : {\n      CLOSED : 0, // Channel has been closed.\n      CLOSING : 1, // Channel has been requested to close.\n      OPEN : 2, // Channel open.\n      NOT_READY : 3, // Channel accepted but a Channel Object is PENDING.\n      READY: 4 // Channel is ready to send RPCs.\n   },\n\n   /**\n    * RPC type.\n    *    REQUEST: A response will be sent back with the return parameters.\n    *    POST: The RPC does not have a response.\n    *\n    * @enum {String}\n    * @readonly\n    */\n   RPC_TYPE : {\n      REQUEST : \"REQUEST\",\n      POST  : \"POST\"\n   },\n\n   /*\n    * Used internally to read/set the RPC data types\n    * used by the RPC Encoder/Decoder.\n    * https://opengrok.eng.vmware.com/source/xref/bfg-main.perforce.1666/bora/apps/rde/vdpservice/public/vdprpc_defines.h#95\n    * @type {Integer}\n    * @readonly\n    */\n   VARIANT_TYPE : {\n      SIGNED_INTEGER : 3,\n      CHAR : 16,\n      UNSIGNED_INTEGER : 19,\n      UNSIGNED_INTEGER_8: 21,//64bits\n      STRING : 30,\n      BLOB : 65\n   },\n\n   /*\n    * Used internally to inform the server about the required action to be taken\n    * for the RPC and also process incoming RPCs accordingly.\n    *\n    * @enum {Integer}\n    * @readonly\n    */\n   RPC_ACTION : {\n      REQUEST : 1,\n      RESPONSE : 3,\n      POST : 4\n   },\n\n   /*\n    * The command IDs of channel RPCs.\n    *\n    * @enum {Integer}\n    * @readonly\n    */\n   CHANNEL_COMMANDS : {\n      CREATE_OBJECT : 0xffffff9c,\n      DESTROY_OBJECT: 0x65,\n      EXCHANGE_SECRET: 0x66,\n      SEND_PCOIP_SIDECHANNAME: 0x67,\n      BEAT_REQUEST: 0x68,\n      BEAT_REPLY: 0x69\n   },\n\n   /*\n    * Identifier of internal RPC messages.\n    *\n    * @type {Integer}\n    * @readonly\n    */\n   RPC_DATA_FORMAT : 0xffffff9c,\n\n   /*\n    * The invalid RPC Channel Object ID.\n    *\n    * @type {Integer}\n    * @readonly\n    */\n   INVALID_CHANNEL_OBJECT_ID : 0xfffffffe,\n\n   /*\n    * The starting RPC request ID.\n    *\n    * @type {Integer}\n    * @readonly\n    */\n   START_REQUEST_ID : 1,\n\n   /*\n    * The minimum length of the RESPONSE section of an encoded header.\n    *\n    * @type {Integer}\n    * @readonly\n    */\n   MINIMUM_RETURN_SECTION_LENGTH : 20,\n\n   /*\n    * This version of VDPService supports POST RPCs and side channel\n    * is disabled. Set the last two bits of the 32-bit capability\n    * field. (capability = 0x3)\n    *\n    * @type {Integer}\n    * @readonly\n    */\n   CAPABILITY : 3,\n\n   /*\n    * The length of the RPC header.\n    *\n    * @type {Integer}\n    * @readonly\n    */\n   RPC_HEADER_SIZE : 24,\n\n   /**\n    * Interface to encode/decode RPCs in External Data Representation.\n    * Reference:\n    * https://www.ietf.org/rfc/rfc1832.txt\n    *\n    * @constructor\n    */\n   XDRBuffer : function () {\n      let self = this,\n\n         /**\n          * The read position of the encoded buffer.\n          *\n          * @private\n          * @type {Integer}\n          */\n         readPosition = 0,\n\n         /**\n          * Avoid JSLINT warning by forward defining the\n          * functions here.\n          */\n         ensureWrite = null,\n         ensureRead = null,\n         setUint8Array = null,\n         seekToNextBlock = null;\n\n      /**\n       * The encoded buffer.\n       *\n       * @type {Uint8Array}\n       */\n      this.data = null;\n\n      /**\n       * The current length of the contents in the buffer.\n       *\n       * @type {Integer}\n       */\n      this.length = 0;\n\n      /**\n       * Initializes the encoder with the given size of the buffer with the default as\n       * 512 bytes.\n       *\n       * @param {Integer} size -  Initial size of the Uint8Array buffer.\n       */\n      this.initEncoder = function (size) {\n         this.length = 0;\n         this.data = new Uint8Array(size || 512);\n      };\n\n      /**\n       * Initializes the decoder with the given encoded buffer.\n       *\n       * @param {Uint8Array} encodedArrayBuffer - The XDR encoded buffer format to\n       *                                          be decoded.\n       * @returns {Boolean} true if successful.\n       */\n      this.initDecoder = function (encodedArrayBuffer) {\n         if (!(encodedArrayBuffer instanceof Uint8Array)) {\n            return false;\n         }\n\n         this.data = encodedArrayBuffer;\n         this.length = encodedArrayBuffer.length;\n         readPosition = 0;\n\n         return true;\n      };\n\n      /**\n       * Returns the internal buffer contents splicing the unused buffer.\n       *\n       * @returns {Uint8Array} - The buffer.\n       */\n      this.getData = function () {\n         let data = null;\n\n         if (this.data) {\n            data = this.data.subarray(0, this.length);\n         }\n\n         return data;\n      };\n\n      /**\n       * Get the read position of XDRBuffer.\n       * @returns {Integer} the read position of the XDRBuffer.\n       */\n      this.getReadPosition = function () {\n         return readPosition;\n      };\n\n      /**\n       * Generic function to write a variable to the buffer.  Uses the\n       * variable's type to determine which write function to use.\n       *\n       * @param value - The value to be written.\n       * @return {Boolean} - true if the write was successful, false otherwise.\n       */\n      this.write = function (value) {\n         return this.writeVariant(value, true, false);\n      };\n\n      /**\n       * Writes a string at the end of the buffer in XDR format.  The string is\n       * converted from the native JavaScript UTF-16 to UTF-8 before putting it\n       * on the buffer.\n       *          0     1     2     3     4     5   ...\n       *       +-----+-----+-----+-----+-----+-----+...+-----+-----+...+-----+\n       *       |        length n       |byte0|byte1|...| n-1 |  0  |...|  0  |\n       *       +-----+-----+-----+-----+-----+-----+...+-----+-----+...+-----+\n       *       |<-------4 bytes------->|<------n bytes------>|<---r bytes--->|\n       *                               |<----n+r (where (n+r) mod 4 = 0)---->|\n       *\n       * @param {String} value - The value to be written.\n       */\n      this.writeString = function (value) {\n         let utf8Array = StringUtils.stringToUint8Array(value);\n\n         /*\n          * If the string wasn't empty but the conversion result is, that means\n          * that it wasn't able to be converted.\n          */\n         if (utf8Array.length === 0 && value.length > 0) {\n            JSCDKLogger.error('XDRBuffer: Failed to convert string ' + value +\n                              ' to UTF-8.');\n            return;\n         }\n\n         // Now write the resulting UTF-8 data.\n         this.writeBlob(utf8Array);\n      };\n\n      /**\n       * Writes a Uint8Array at the end of the buffer in XDR format.\n       *          0     1     2     3     4     5   ...\n       *       +-----+-----+-----+-----+-----+-----+...+-----+-----+...+-----+\n       *       |        length n       |byte0|byte1|...| n-1 |  0  |...|  0  |\n       *       +-----+-----+-----+-----+-----+-----+...+-----+-----+...+-----+\n       *       |<-------4 bytes------->|<------n bytes------>|<---r bytes--->|\n       *                               |<----n+r (where (n+r) mod 4 = 0)---->|\n       *\n       * @param {Uint8Array} value - The value to be written.\n       */\n      this.writeBlob = function (value) {\n         this.writeUint32(value.length);\n         setUint8Array(value);\n      };\n\n      /**\n       * Writes a 8-bit unsigned integer at the end of the buffer in XDR format.\n       * XDR operates on a boundary of 4 bytes so the value is added at byte 3\n       * with leading 0s.\n       *            (MSB)                   (LSB)\n       *       +-------+-------+-------+-------+\n       *       |byte 0 |byte 1 |byte 2 |byte 3 |\n       *       +-------+-------+-------+-------+\n       *       <------------32 bits------------>\n       *\n       * @param {Integer} value - The value to be written.\n       */\n      this.writeUint8 = function (value) {\n         ensureWrite(4);\n         this.length += 3;\n         this.data[this.length++] = value & 0xff;\n      };\n\n      /**\n       * Writes a 32-bit unsigned integer at the end of the buffer\n       * in XDR format.\n       *\n       *            (MSB)                   (LSB)\n       *       +-------+-------+-------+-------+\n       *       |byte 0 |byte 1 |byte 2 |byte 3 |\n       *       +-------+-------+-------+-------+\n       *       <------------32 bits------------>\n       *\n       * @param {Integer} value - The value to be written.\n       */\n      this.writeUint32 = function (value) {\n         this.setInt32(this.length, value);\n      };\n\n      /**\n       * Writes a 32-bit signed integer at the end of the buffer\n       * in XDR format.\n       *\n       *            (MSB)                   (LSB)\n       *       +-------+-------+-------+-------+\n       *       |byte 0 |byte 1 |byte 2 |byte 3 |\n       *       +-------+-------+-------+-------+\n       *       <------------32 bits------------>\n       *\n       * @param {Integer} value - The value to be written.\n       */\n      this.writeInt32 = function (value) {\n         this.setInt32(this.length, value);\n      };\n\n      /**\n       * Writes a 32-bit integer at the specified position\n       * of the buffer in XDR format.\n       *\n       * @param {Integer} position - The write position.\n       * @param {Integer} value - The value to be written.\n       */\n      this.setInt32 = function (position, value) {\n         let reqBytes = position - this.length + 4;\n\n         if (reqBytes > 0) {\n            ensureWrite(reqBytes);\n            this.length += reqBytes;\n         }\n\n         this.data[position++] = (value >> 24) & 0xff;\n         this.data[position++] = (value >> 16) & 0xff;\n         this.data[position++] = (value >> 8) & 0xff;\n         this.data[position++] = value & 0xff;\n      };\n\n      /**\n       * Writes the variant type and the value at the end of the buffer in XDR format.\n       *\n       * @param {Number|String|Uint8Array} value - The value to be written.\n       * @param {Boolean} signed - true if the value should be interpreted by the server\n       *                           as a signed integer.\n       * @param {Boolean} writeType - true (default) if the type header should be written\n       * @returns {Boolean} true if the value was successfully written.\n       */\n      this.writeVariant = function (value, signed, writeType) {\n         let vt;\n\n         if (writeType === undefined) {\n            writeType = true;\n         }\n\n         if (typeof value === 'string') {\n            if (writeType) {\n               this.writeUint32(VDPService.VARIANT_TYPE.STRING);\n            }\n            this.writeString(value);\n         } else if (typeof value === 'number') {\n            vt = VDPService.VARIANT_TYPE.UNSIGNED_INTEGER;\n\n            if (signed || false) {\n               vt = VDPService.VARIANT_TYPE.SIGNED_INTEGER;\n            }\n\n            if (writeType) {\n               this.writeUint32(vt);\n            }\n            this.writeUint32(value);\n         } else if (value instanceof Uint8Array) {\n            if (writeType) {\n               this.writeUint32(VDPService.VARIANT_TYPE.BLOB);\n            }\n            this.writeBlob(value);\n         } else {\n            return false;\n         }\n\n         return true;\n      };\n\n      /**\n       * Reads the encoded 8-bit unsigned integer from the current position\n       * skipping 3 bytes.\n       *\n       * @returns {Integer} The value read or null if data was not available.\n       */\n      this.readUint8 = function () {\n         let param = null;\n\n         if (ensureRead(4)) {\n            readPosition += 3;\n            param = this.data[readPosition++];\n         }\n\n         return param;\n      };\n\n      /**\n       * Reads the 32-bit unsigned integer from the current position.\n       *\n       * @returns {Integer} The value read or null if data was not available.\n       */\n      this.readUint32 = function () {\n         let param = this.readInt32();\n\n         if (param) {\n            param = param >>> 0;\n         }\n\n         return param;\n      };\n\n\n      /**\n       * Reads the 32-bit unsigned integer from the current position.\n       *\n       * @returns {Integer} The value read or null if data was not available.\n       */\n      this.readUint64 = function () {\n         let param = this.readInt64();\n\n         if (param) {\n            param = param >>> 0;\n         }\n\n         return param;\n      };\n\n      /**\n       * Reads the 32-bit signed integer from the current position.\n       *\n       * @returns {Integer} The value read or null if data was not available.\n       */\n      this.readInt64 = function () {\n         let param = null;\n\n         if (ensureRead(8)) {\n            param = ((0xff & this.data[readPosition++]) << 56) |\n               ((0xff & this.data[readPosition++]) << 48) |\n               ((0xff & this.data[readPosition++]) << 40) |\n               ((0xff & this.data[readPosition++]) << 32)|\n               ((0xff & this.data[readPosition++]) << 24) |\n               ((0xff & this.data[readPosition++]) << 16) |\n               ((0xff & this.data[readPosition++]) << 8) |\n               ((0xff & this.data[readPosition++]));\n         }\n\n         return param;\n      };\n\n      /**\n       * Reads the 64-bit signed integer from the current position.\n       *\n       * @returns {Integer} The value read or null if data was not available.\n       */\n      this.readInt32 = function () {\n         let param = null;\n\n         if (ensureRead(4)) {\n            param = ((0xff & this.data[readPosition++]) << 24) |\n               ((0xff & this.data[readPosition++]) << 16) |\n               ((0xff & this.data[readPosition++]) << 8) |\n               ((0xff & this.data[readPosition++]));\n         }\n\n         return param;\n      };\n\n      /**\n       * Reads a string from current position. Reads the length from the string and\n       * then the actual string.\n       *\n       * @returns {String} The value read or null if data was not available.\n       */\n      this.readString = function () {\n         let stringData,\n             string = null;\n\n         stringData = this.readBlob();\n         if (!!stringData) {\n            if (stringData.length > 0) {\n               string = StringUtils.uint8ArrayToString(stringData);\n            } else {\n               string = '';\n            }\n         }\n\n         return string;\n      };\n\n      /**\n       * Read the encoded blob {Uint8array} from the current position. Reads the length\n       * from the buffer and then the actual Blob.\n       *\n       * @returns {Uint8Array} The value read or null if data was not available.\n       */\n      this.readBlob = function () {\n         let blob = null,\n             len = this.readUint32();\n\n         if (len && ensureRead(len)) {\n            blob = this.data.subarray(readPosition, readPosition + len);\n            readPosition += len;\n            seekToNextBlock(false);\n         }\n\n         // Return an empty blob when the length read from the XDRBuffer is 0.\n         if (len === 0) {\n            return new Uint8Array(0);\n         }\n\n         return blob;\n      };\n\n      /**\n       * Read the variant type and then the data from the current position. Reads the\n       * type first and then data accordingly.\n       *\n       * @returns {Number|String|Blob} The value read or null if data was not available.\n       */\n      this.readVariant = function () {\n         let param = null,\n             type = this.readUint32();\n\n         switch (type) {\n            case VDPService.VARIANT_TYPE.STRING:\n               param = this.readString();\n               break;\n            case VDPService.VARIANT_TYPE.SIGNED_INTEGER:\n               param = this.readInt32();\n               break;\n            case VDPService.VARIANT_TYPE.UNSIGNED_INTEGER:\n               param = this.readUint32();\n               break;\n            case VDPService.VARIANT_TYPE.UNSIGNED_INTEGER_8:\n               param = this.readUint64();\n               console.error(\"UNSIGNED_INTEGER_8\", param);\n               break;\n            case VDPService.VARIANT_TYPE.BLOB:\n               param = this.readBlob();\n               break;\n            case VDPService.VARIANT_TYPE.CHAR:\n               param = this.readUint8();\n               if (param !== null) {\n                  param = String.fromCharCode(param);\n               }\n               break;\n            default:\n               JSCDKLogger.error(\"Failed to read the variant due to invalid type: \" + type);\n         }\n\n         return param;\n      };\n\n      /**\n       * Skips the number of bytes. Note that all elements are initialized to\n       * 0 by default.\n       *\n       * @param {Integer} pos - The number of bytes to skip.\n       */\n      this.skipWriteBytes = function (num) {\n         ensureWrite(num);\n         this.length += num;\n      };\n\n      /**\n       * Seek the read position ensuring that it does not\n       * go beyond the length.\n       *\n       * @param {Integer} pos - The position to seek to.\n       * @returns {Boolean} True if successful.\n       */\n      this.seekReadPosition = function (pos) {\n         if (pos >= 0 && pos < this.length) {\n            readPosition = pos;\n            return true;\n         }\n\n         return false;\n      };\n\n      /**\n       * Ensure that the buffer is large enough to write the number of bytes.\n       * The size is multiplied by 1.5 times.\n       *\n       * @param {Integer} size - Tbe number of bytes to ensure.\n       */\n      ensureWrite = function (size) {\n         if (size > 0) {\n            let buffer,\n               reqLength = self.length + size,\n               newLength = self.data.length;\n\n            while (newLength < reqLength) {\n               newLength = Math.floor(newLength * 1.5);\n            }\n\n            if (newLength > self.data.length) {\n               buffer = new Uint8Array(newLength);\n               buffer.set(self.data);\n               self.data = buffer;\n            }\n         }\n      };\n\n      /**\n       * Check if the number of bytes can be read from the current read\n       * position.\n       *\n       * @param {Integer} length - Tbe number of bytes to be read.\n       * @returns {Boolean} true if the buffer is large enough to read the length.\n       */\n      ensureRead = function (length) {\n         return !!self.data && (readPosition + length) <= self.data.length;\n      };\n\n      /**\n       * Append a Uint8Array with padding of 4 bytes according to XDR.\n       *\n       * @private\n       * @param {Uint8Array} value - The value to be set.\n       */\n      setUint8Array = function (value) {\n         ensureWrite(value.length);\n         if (value && value.length) {\n            self.data.set(value, self.length);\n         }\n\n         self.length += value.length;\n         seekToNextBlock(true);\n      };\n\n      /**\n       * Helper function used to seek to the end of the 4-byte block.\n       *\n       * @private\n       * @param {Boolean} seekWrite - true to seek write buffer,\n       *                              false to seek read buffer.\n       */\n      seekToNextBlock = function (seekWrite) {\n         if (seekWrite) {\n            self.length = (self.length + 3) & ~0x3;\n         } else {\n            readPosition = (readPosition + 3) & ~0x3;\n         }\n      };\n   },\n\n\n   /**\n    * A root VDPService.Service instance needs to be created to handle channel\n    * connections.\n    *\n    * @constructor\n    * @param {VVC} vvc - VVC instance.\n    * @param {VVCSession} vvcSession - VVCSession instance.\n    */\n\n   Service : function (vvc, vvcSession) {\n      let self = this,\n\n         /**\n          * The vvcListener object to listen to new channels\n          * opened by the server.\n          *\n          * @type {VVCListener}\n          * @private\n          */\n         vvcListener = null,\n\n         /**\n          * A list of VDPService channels indexed by VVC channel ID.\n          *\n          * @type {VDPService.Channel[]}\n          * @private\n          */\n         vdpChannels = [],\n\n         /**\n          * Forward defining the functions for JSLint.\n          * @private\n          */\n         onPeerChannelOpen = null,\n         onChannelCloseError = null,\n\n         /**\n          * A list of callbacks to be called when a channel is opened\n          * by a remote application.\n          */\n         onChannelCreatedListeners = [];\n\n      /**\n       * Initialize the VVC transport listening for channels opened\n       * by the server beginning with \"RP\" as done with the vdpService\n       * native client.\n       */\n      vvcListener = vvc.createListener(vvcSession, \"RP*\");\n      vvcListener.onpeeropen = function (session, channel) {\n         if (vvcSession !== session) {\n            JSCDKLogger.error(\"Unexpected session object.\");\n            return;\n         }\n         onPeerChannelOpen(channel);\n      };\n\n      /**\n       * Add a listener to be called when a channel is opened by\n       * the remote application.\n       *\n       * @param {Function} callback\n       *    This listener is called when the server creates a new channel and no\n       *    other listeners have yet to accept the channel.\n       *    Parameters:\n       *       channel   The VDPService.Channel object of the newly created channel.\n       *                 The plugin must call VDPService.Service.connectChannel to\n       *                 accept the channel, the channel will be automatically rejected\n       *                 if no listeners accept it, or manually rejected via\n       *                 VDPService.Service.rejectChannel\n       */\n      this.addChannelCreatedListener = function (callback) {\n         onChannelCreatedListeners.push(callback);\n      };\n\n      /**\n       * Connect and acknowledge the new channel opened by the server.\n       *\n       * vdpservice.js automatically acknowledges the first \"channel object\" that is\n       * created by the server if the channel object name if not specified through this\n       * method. If the \"channel object\" name is passed with this method, vdpservice.js\n       * then only acknowledges a channel object from the server with the desired name.\n\n       * @param {VDPService.Channel} channel - The VDPService.Channel object to\n       *                                       connect to.\n       * @param {[String[]]} desiredObjectNames - The list of object names to accept.\n       * @returns {Boolean} true if the channel was successfully acknowledged.\n       */\n      this.connectChannel = function (channel, desiredObjectNames) {\n         if (!(channel instanceof VDPService.Channel)) {\n            JSCDKLogger.error(\"Invalid argument.\");\n            return false;\n         }\n\n         /*\n          * The channel cannot be found in our list of existing\n          * VDPService.Channel references.\n          */\n         if (vdpChannels[channel.id] !== channel) {\n            JSCDKLogger.error(\"Channel with id \" + channel.id +\n                              \" cannot be found in the list of existing channels.\");\n            return false;\n         }\n\n         // The channel in the OPEN state to be connected.\n         if (channel.state !== VDPService.CHANNEL_STATE.OPEN) {\n            JSCDKLogger.error(\"Invalid channel state: \" + channel.state);\n            return false;\n         }\n\n         // Accept the channel.\n         if (!vvcSession.acceptChannel(vvcSession.getChannel(channel.id))) {\n            JSCDKLogger.error(\"vvcSession.acceptChannel failed for\" +\n                              \" channel with id: \" + channel.id);\n            delete vdpChannels[channel.id];\n            return false;\n         }\n\n         /*\n          * The channel has been accepted by the plugin and is now NOT_READY until\n          * one \"channel object\" is created by the server and acknowledged\n          * automatically by VDPService.Channel implementation.\n          */\n         channel.state = VDPService.CHANNEL_STATE.NOT_READY;\n         channel.desiredObjects = desiredObjectNames || [];\n\n         return true;\n      };\n\n      /**\n       * Reject the newly opened channel by the server.\n       *\n       * @param {VDPService.Channel} channel - The VDPService.Channel object to reject.\n       * @returns {boolean} true if the channel was rejected.\n       */\n      this.rejectChannel = function (channel) {\n         if (!(channel instanceof VDPService.Channel)) {\n            JSCDKLogger.error(\"Invalid argument.\");\n            return false;\n         }\n\n         /*\n          * The channel cannot be found in our list of existing\n          * VDPService.Channels.\n          */\n         if (vdpChannels[channel.id] !== channel) {\n            JSCDKLogger.error(\"Channel with id \" + channel.id +\n                              \" cannot be found in the list of existing channels.\");\n            return false;\n         }\n\n         /*\n          * The channel must be in the OPEN state.\n          * A OPEN state denotes that the channel is neither accepted\n          * or rejected by the plugin.\n          */\n         if (channel.state !== VDPService.CHANNEL_STATE.OPEN) {\n            JSCDKLogger.error(\"Invalid channel state: \" + channel.state);\n            return false;\n         }\n\n         // Reject the channel.\n         if (!vvcSession.rejectChannel(vvcSession.getChannel(channel.id))) {\n            JSCDKLogger.error(\"vvcSession.rejectChannel failed for\" +\n                              \" channel with id: \" + channel.id);\n            return false;\n         }\n\n         channel.state = VDPService.CHANNEL_STATE.CLOSED;\n         delete vdpChannels[channel.id];\n\n         return true;\n      };\n\n      /**\n       * Disconnect the channel.\n       *\n       * @param {VDPService.Channel} channel - The VDPService.Channel object to\n       *                                       disconnect.\n       * @returns {Boolean} Returns true if the channel close request was successfully\n       *                    sent to VVC and the state is set to CLOSING.\n       */\n      this.disconnectChannel = function (channel) {\n         if (!(channel instanceof VDPService.Channel)) {\n            JSCDKLogger.error(\"Invalid argument.\");\n            return false;\n         }\n\n         /*\n          * The channel cannot be found in our list of existing\n          * VDPService.Channels.\n          */\n         if (vdpChannels[channel.id] !== channel) {\n            JSCDKLogger.error(\"Channel with id \" + channel.id +\n                              \" cannot be found in the list of existing channels.\");\n            return false;\n         }\n\n         JSCDKLogger.debug(\"Disconnecting channel with id:\" + channel.id +\n            \" state:\" + channel.state);\n\n         // Call VVCChannel.close() if it has not been yet called.\n         if (!(channel.state === VDPService.CHANNEL_STATE.CLOSING ||\n            channel.state === VDPService.CHANNEL_STATE.CLOSED)) {\n            if (!vvcSession.getChannel(channel.id).close()) {\n               JSCDKLogger.error(\"vvcSession.disconnectChannel failed for channel with\" +\n                                 \" id: \" + channel.id);\n               return false;\n            }\n\n            channel.state = VDPService.CHANNEL_STATE.CLOSING;\n         }\n\n         return true;\n      };\n\n      /**\n       * Whether there is a VDPService.Channel object with the particular ID\n       * in the list of vdpChannels.\n       *\n       * @param {Integer} channelID - The channel id.\n       * @returns {Boolean} Whether the VDPSerice.Channel object with the particular\n       *                    ID is present in the list of existing channels.\n       */\n      this.isChannelPresent = function (channelID) {\n         return vdpChannels.hasOwnProperty(channelID);\n      };\n\n      /**\n       * Called when the peer opens a channel.\n       *\n       * @param {VVCChannel} vvcChannel - The VVCChannel object.\n       * @private\n       */\n      onPeerChannelOpen = function (channel) {\n         let vdpChannel,\n             i;\n\n         console.error(channel);\n\n         // An event listener to be called when the VVC channel closes.\n         channel.onclose = function () {\n            onChannelCloseError(channel);\n         };\n\n         // An event listener to called when there is a VVC channel error.\n         channel.onerror = function () {\n            onChannelCloseError(channel);\n         };\n\n         vdpChannel = new VDPService.Channel(channel);\n         vdpChannels[channel.id] = vdpChannel;\n\n         if (onChannelCreatedListeners.length) {\n            // Find a listener to accept our newly created channel\n            for (i = 0; i < onChannelCreatedListeners.length; ++i) {\n               onChannelCreatedListeners[i](vdpChannel);\n\n               if (vdpChannel.state !== VDPService.CHANNEL_STATE.OPEN) {\n                  break;\n               }\n            }\n\n            // If no one accepted or rejected the channel we need to reject it.\n            if (vdpChannel.state === VDPService.CHANNEL_STATE.OPEN) {\n               self.rejectChannel(vdpChannel);\n            }\n         } else {\n            JSCDKLogger.warning(\"No onChannelCreated listeners have been \" +\n                                \"set by the consumer.\");\n         }\n      };\n\n      /**\n       * Channel has been closed or there is a channel error.\n       *\n       * @param {VVCChannel} vvcChannel - The VVCChannel object.\n       * @private\n       */\n      onChannelCloseError = function (vvcChannel) {\n         let vdpChannel;\n\n         vdpChannel = vdpChannels[vvcChannel.id];\n\n         if (!vdpChannel) {\n            JSCDKLogger.error(\"Channel with id \" + vvcChannel.id +\n                              \" cannot be found in the list of existing channels.\");\n            return;\n         }\n\n         /*\n          * Invoke vdpChannel.onDisconnect if the channel is currently\n          * in READY state.\n          */\n         if (vdpChannel.state === VDPService.CHANNEL_STATE.READY) {\n            if (!!vdpChannel.onDisconnect) {\n               vdpChannel.onDisconnect();\n            } else {\n               JSCDKLogger.warning(\"onDisconnect listener has not been\" +\n                                   \" set by the consumer.\");\n            }\n         }\n\n         vdpChannel.state = VDPService.CHANNEL_STATE.CLOSED;\n         delete vdpChannels[vvcChannel.id];\n      };\n   },\n\n   /**\n    * VDPService.Channel is a RPC wrapper over VVCChannel. Its created when a channel is\n    * opened by the server. A channel is a communication path between the remote\n    * application and the local plugin. The consumers will use the VDPService.Channel\n    * object to communicate with the server using RPCs.\n    * @constructor\n    *\n    * @param (VVChannel) vvcChannel - The VVC channel object that will be using to send\n    *                                   and receive data.\n    *\n    * Listeners:\n    *    .onReady\n    *       Called for each new channel object connected to the VDPService.Channel.\n    *       The object is now ready to send and receive RPCs.\n    *\n    *   .onDisconnect\n    *       Called for each channel object which is disconnected from the channel.\n    *       The object is disconnected and can no longer send or receive RPCs.\n    *\n    *   .onInvoke\n    *       Called when the server on the other end of the channel called Invoke(),\n    *       that is, when there is a new RPC message received.\n    *          @param rpc          This parameter holds the data given by the server.\n    *                              This should be altered to hold the return values,\n    *                              and the RPC will be returned to the server when this\n    *                              method returns.\n    *                              The following properties must be processed:\n    *               .command       {Integer} or {String}. The command code represents the\n    *                              remote method that the object is meant to represent.\n    *               .type          Whether the RPC is a REQUEST or a POST RPC.\n    *               .params[]      {Integer} or {String} or {Uint8Array} The data given\n    *                              by the server.\n    */\n   Channel : function (vvcChannel) {\n      let self = this,\n\n         /**\n          * The next request ID for the RPC.\n          *\n          * @type {Integer}\n          * @private\n          */\n         requestID = VDPService.START_REQUEST_ID,\n\n         /**\n          * List of requests which are waiting for a return context\n          * from the server.\n          *\n          * @type {{onDone, onAbort}[]} Array of {onDone, onAbort} indexed by\n          *                              requestIDs.\n          * @private\n          */\n         pendingRequests = [],\n\n         /**\n          * List of functions forward defined for Jslint.\n          */\n         onVVCMessage = null,\n         encode = null,\n         decode = null,\n         handleCreateObject = null,\n         handleDestroyObject = null,\n         handleOnInvoke = null,\n         findOpenObjectByID = null,\n         findOpenObjectByName = null;\n\n      /**\n       * The id of the channel.\n       *\n       * @type {Integer}\n       */\n      this.id = vvcChannel.id;\n\n      /**\n       * The name of the channel.\n       *\n       * @type {String}\n       */\n      this.name = vvcChannel.name;\n\n      /**\n       * The initial state of the channel is PENDING, that is,\n       * the channel is open from the server side but it\n       * needs to be accepted by a plugin.\n       *\n       * @type {VDPService.CHANNEL_STATE}\n       */\n      this.state = VDPService.CHANNEL_STATE.OPEN;\n\n      /**\n       * The list of all open objects on the channel.\n       * @type {{id, name}[]}\n       */\n      this.openObjects = [];\n\n      /**\n       * The list of object names to accept from the server.\n       * @type {String[]}\n       */\n      this.desiredObjects = [];\n\n      /**\n       * Returns whether the requestID is pending.\n       *\n       * @param {Integer} requestID - The RPC requestID.\n       * @returns {Boolean} whether the request ID is pending\n       */\n      this.isRequestPending = function (requestID) {\n         return pendingRequests.hasOwnProperty(requestID);\n      };\n\n\n      // An event listener to be called when a RPC is received from the server.\n      vvcChannel.onmessage = function (event) {\n         onVVCMessage(new Uint8Array(event.data));\n      };\n\n      /**\n       * Callback invoked by VVC when a new message is received.\n       *\n       * @param data {Uint8Array} - The data received from VVC.\n       * @private\n       */\n      onVVCMessage = function (data) {\n         /*\n          * This channel data is received from the server. We decode the\n          * buffer into a plain object using XDR decoder.\n          */\n         console.warn(data);\n         let userRPC = decode(data),\n             objID;\n         console.info(userRPC);\n         if (!userRPC) {\n            JSCDKLogger.error(\"Failed to decode the message received from the server.\");\n            return;\n         }\n\n         /*\n          * The server channel object ID in the contexts array will be 0 when a\n          * channel command is received. Handle the channel commands sent from the\n          * server.\n          * TODO: Implement the channel command EXCHANGE_SECRET required\n          * for side channels.\n          */\n         objID = userRPC.contexts[0];\n\n         if (objID === 0) {\n            switch (userRPC.command) {\n               case VDPService.CHANNEL_COMMANDS.CREATE_OBJECT:\n                  handleCreateObject(userRPC);\n                  break;\n               case VDPService.CHANNEL_COMMANDS.DESTROY_OBJECT:\n                  handleDestroyObject(userRPC);\n                  break;\n               // below are only used for CDR\n               case VDPService.CHANNEL_COMMANDS.EXCHANGE_SECRET:\n                  console.error(\"we don't support exchange secret, please config Agent and try again\");\n                  break;\n               case VDPService.CHANNEL_COMMANDS.SEND_PCOIP_SIDECHANNAME:\n                  console.error(\"we don't support pcoip channel, please config Agent and try again\");\n                  break;\n               case VDPService.CHANNEL_COMMANDS.BEAT_REQUEST:\n                  console.error(\"we don't support beat request, please config Agent and try again\");\n                  break;\n               case VDPService.CHANNEL_COMMANDS.BEAT_REPLY:\n                  console.error(\"we don't support beat reply, please config Agent and try again\");\n                  break;\n               default:\n                  JSCDKLogger.error(\"Invalid channel command received \" +\n                                    \"from the server: \" + userRPC.command);\n            }\n         } else if (findOpenObjectByID(objID)) {\n            handleOnInvoke(userRPC);\n         } else {\n            JSCDKLogger.error(\"Invalid server object ID: \" + objID);\n         }\n      };\n\n      /*\n       * Initiates a RPC between the plugin and the server object on the other end of\n       * the channel.\n       *\n       * The object can be specified with any of userRPC.object, .objID or .objName.\n       * If no object is specified the first open object will be used.\n       *\n       * @param userRPC       {Object} An object of the following format:\n       *            .command  {Integer} or {String} The remote code that the rpc\n       *                      represents.\n       *            .type     {VDPService.RPC_TYPE}  Whether the RPC is a REQUEST or a\n       *                      POST RPC. Default is REQUEST.\n       *            .params[] {Integer} or {String} or {Uint8Array}[]  Data to be sent\n       *                      to the server.\n       *            .onDone   {Function} Called when the VDPService.Channel.invoke call\n       *                      has returned from the server.\n       *            .onAbort  {Function} Called when the Invoke call fails due to a\n       *                      VDPService error.\n       *            .object   {{id,name}?} Object that this RPC request is for.\n       *            .objID    {Integer?} Object ID that this RPC request is for.\n       *            .objName  {String?} Object Name that this RPC request is for.\n       *\n       * Description of the two callback functions.\n       *\n       *    onDone                 Called when the VDPService.Channel.invoke call has\n       *                           returned\n       *                           from the server. Takes parameter:\n       *        rpc                This will hold all of the return codes and values\n       *                           given by the peer.\n       *                           The following are the properties of the rpc object\n       *                           that may be processed:\n       *            .command       {Integer} or {String}. The command code represents\n       *                           the remote method that the context is meant to\n       *                           represent.\n       *            .returnCode    {Integer} The return code set by the server.\n       *            .returnParams  {Integer} or {String} or {Uint8Array}[] The return\n       *                           params appended by the server.\n       *\n       *    onAbort                Called when the Invoke call fails due to a VDPService\n       *                           error. Takes parameter:\n       *        rpc                The following are the properties may be processed:\n       *           .userCancelled  {Boolean} 0.\n       *           .abortCode      {Integer} The abort reason.\n       *\n       * @returns {Integer} A non-zero requestID if successful.\n       */\n      this.invoke = function (userRPC) {\n         let sendBuffer,\n             object = null,\n             rpc = {},\n             i;\n\n         // Check whether userRPC is an object literal.\n         if (!userRPC || userRPC.constructor !== Object) {\n            JSCDKLogger.error(\"Invalid argument.\");\n            return 0;\n         }\n\n         if (this.state !== VDPService.CHANNEL_STATE.READY) {\n            JSCDKLogger.error(\"The channel must be in READY(\" +\n                              VDPService.CHANNEL_STATE.READY + \") state. Current \" +\n                              \"state of the channel: \" + this.state);\n            return 0;\n         }\n\n         /*\n          * Check the validity of the command. VDPService accepts number or\n          * string commands.\n          */\n         if (!(typeof userRPC.command === 'number' ||\n               typeof userRPC.command === 'string')) {\n            JSCDKLogger.error(\"Invalid command type: \" + userRPC.command);\n            return 0;\n         }\n\n         /*\n          * We receive the RPC params[] from the user.\n          * TODO: need to verify whether RPCs with no parameters are allowed.\n          */\n         if ((!(userRPC.params instanceof Array))) {\n            JSCDKLogger.error(\"Invalid argument property rpc.params: \" + userRPC.params);\n            return 0;\n         }\n\n         /*\n          * Check if userRPC contains the right data types. If not, return\n          * failure.\n          */\n         for (i = 0; i < userRPC.params.length; i++) {\n            if (!(typeof userRPC.params[i] === 'number' ||\n                  typeof userRPC.params[i] === 'string' ||\n                  userRPC.params[i] instanceof Uint8Array)) {\n               JSCDKLogger.error(\"Invalid param: \" + userRPC.params[i] + \" at index: \" + i);\n               return 0;\n            }\n         }\n\n         // Set the command and the params to the internal RPC object.\n         rpc.command = userRPC.command;\n         rpc.params = userRPC.params;\n\n         // The default RPC type is REQUEST.\n         if (userRPC.type === VDPService.RPC_TYPE.POST) {\n            rpc.action = VDPService.RPC_ACTION.POST;\n         } else {\n            rpc.action = VDPService.RPC_ACTION.REQUEST;\n         }\n\n         /*\n          * Add tbe server channel object ID and the request ID to the list\n          * of contexts to be sent.\n          */\n         if (!!userRPC.object) {\n            // Ensure object exists by searching by id\n            object = findOpenObjectByID(userRPC.object.id);\n         } else if (!!userRPC.objID) {\n            object = findOpenObjectByID(userRPC.objID);\n         } else if (!!userRPC.objName) {\n            object = findOpenObjectByName(userRPC.objName);\n         } else if (self.openObjects.length > 0) {\n            // Just default to first open object\n            object = self.openObjects[0];\n         }\n\n         if (!object) {\n            JSCDKLogger.error(\"Could not find matching channel object to invoke on \" +\n                              \"id: \" + userRPC.objID + \", name: \" + userRPC.objName);\n            return 0;\n         }\n\n         rpc.contexts = [object.id, requestID];\n\n         // Encode the user RPC in XDR format.\n         sendBuffer = encode(rpc);\n\n         // Send the buffer over the virtual channel.\n         if (!vvcChannel.send(sendBuffer)) {\n            return 0;\n         }\n\n         // Save onDone and onAbort callbacks for REQUEST RPCs.\n         if (rpc.action !== VDPService.RPC_ACTION.POST) {\n            pendingRequests[requestID] = {\n               onDone: userRPC.onDone,\n               onAbort: userRPC.onAbort};\n         }\n\n         return requestID++;\n      };\n\n      /**\n       * Used by VDPService Tests. Retrieves the private encode function\n       * to simulate RPCs in the tests.\n       */\n      this.getEncodeFunction = function () {\n         return encode;\n      };\n\n      /**\n       * Used by VDPService Tests. Retrieves the private decode function\n       * to simulate RPCs in the tests.\n       */\n      this.getDecodeFunction = function () {\n         return decode;\n      };\n\n      /**\n       * Encodes the rpc object in XDR format. Uses XDRBuffer to do its operations.\n       *\n       * @private\n       * @param rpc                 {Object} The object holds all of the information\n       *                            of a remote call for the server. It has the\n       *                            following properties some of which are optional\n       *                            depending on the RPC action.\n       *            .command        {Integer} or {String} The remote code that the rpc\n       *                            represents.\n       *            .action         {VDPService.RPC_ACTION} The action to be performed on\n       *                            the RPC.\n       *            .contexts[]     {Number[]}The channel object ID and the request ID\n       *                            of the RPC.\n       *            .params[]       {Integer} or {String} or {Uint8Array}[] Array of\n       *                            heterogeneous types. Contains data to be sent to\n       *                            the peer.\n       *            .returnCode     {Integer} The return code to be sent to the server.\n       *            .returnParams[] {Integer} or {String} or {Uint8Array}[] Array of\n       *                            heterogeneous types.\n       *                            Contains data to be sent as return value of a RPC\n       *                            to the peer.\n       *            .abort          {Integer} Set to 1 if the RPC should be aborted.\n       *                            The peer will get an onAbort callback.\n       *            .userCancelled  {Integer} 0.\n       *            .abortCode      {Integer} The abort code of the RPC failure sent\n       *                            to the peer.\n       *\n       * @returns {Uint8Array} the encoded buffer.\n       */\n      encode = function (rpc) {\n         let i,\n            xdr = new VDPService.XDRBuffer();\n\n         // Initialize the encoder.\n         xdr.initEncoder();\n         xdr.skipWriteBytes(VDPService.RPC_HEADER_SIZE);\n\n         // Write the data format as DATA_FORMAT_RPC.\n         xdr.writeUint32(VDPService.RPC_DATA_FORMAT);\n\n         // Write the action required for the RPC by the peer.\n         xdr.writeUint8(rpc.action);\n\n         // Write the number of contexts of the RPC.\n         xdr.writeUint8(rpc.contexts.length);\n\n         /**\n          * Write the contexts of the RPC.\n          * contexts[0] - The server channel object ID where the RPC will be sent.\n          * contexts[1] - The request ID.\n          */\n         for (i = 0; i < rpc.contexts.length; i++) {\n            xdr.writeVariant(rpc.contexts[i]);\n         }\n\n         // Write the command of the RPC.\n         xdr.writeVariant(rpc.command);\n\n         // Write the number of params of the RPC.\n         xdr.writeUint8(rpc.params.length);\n\n         // Write the params of the RPC.\n         for (i = 0; i < rpc.params.length; i++) {\n            // This version does not support named params. Write an empty string.\n            xdr.writeVariant(\"\");\n\n            // Write the param.\n            xdr.writeVariant(rpc.params[i]);\n         }\n\n         /*\n          * The following needs to encoded only when the RPC\n          * is of type RESPONSE. RESPONSE RPCs send the\n          * plugin data to the server.\n          */\n         if (rpc.action === VDPService.RPC_ACTION.RESPONSE) {\n            // Write the return code.\n            xdr.writeUint32(rpc.returnCode);\n\n            // Write the number of return params of the RPC.\n            xdr.writeUint8(rpc.returnParams.length);\n\n            // Write the return params from the RPC.\n            for (i = 0; i < rpc.returnParams.length; i++) {\n               /**\n                * This version does not support named return params. Write an empty\n                * string.\n                */\n               xdr.writeVariant(\"\");\n\n               // Write the param.\n               xdr.writeVariant(rpc.returnParams[i]);\n            }\n\n            // Write the abort value of the RPC.\n            xdr.writeUint8(rpc.abort);\n\n            // Set the userCancelled value of the RPC.\n            xdr.writeUint8(rpc.userCancelled);\n\n            // Set the abortCode value from the RPC.\n            xdr.writeUint32(rpc.abortCode);\n         } else {\n            xdr.skipWriteBytes(VDPService.MINIMUM_RETURN_SECTION_LENGTH);\n         }\n\n         /*\n          * Append the 24-byte wireheader at the beginning of the buffer:\n          * | length | capability | unused | unused | unused | unused |\n          */\n         xdr.setInt32(0, xdr.getData().length);\n         xdr.setInt32(4, VDPService.CAPABILITY);\n\n         return xdr.getData();\n      };\n\n      /**\n       * Converts the encoded data received from the server into an rpc object with\n       * the below properties.\n       *\n       * @private\n       * @param {Uint8Array} data - The encoded data buffer.\n       *\n       * @returns {Object}  The object holds all of the information of a remote call\n       *                     for the plugin. It has the following properties:\n       *            .command        {Integer} or {String} The remote code that the rpc\n       *                            represents.\n       *            .action         {VDPService.RPC_ACTION} The action to be performed on\n       *                            the RPC.\n       *            .contexts[]     {Number[]}The channel object ID and the request ID\n       *                            of the RPC.\n       *            .params[]       {Integer} or {String} or {Uint8Array}[] Array of\n       *                            heterogeneous types. Contains data to be sent to the\n       *                            peer.\n       *            .returnCode     {Integer} The return code to be sent to the server.\n       *            .returnParams[] {Integer} or {String} or {Uint8Array}[] Array of\n       *                            heterogeneous types.\n       *                            Contains data to be sent as return value of a RPC to\n       *                            the peer.\n       *            .abort          {Integer} Set to 1 if the RPC should be aborted.\n       *                            The peer will get an onAbort callback.\n       *            .userCancelled  {Integer} 0.\n       *            .abortCode      {Integer} The abort code of the RPC failure sent to\n       *                            the peer.\n       */\n      decode = function (data) {\n         let rpc = {},\n            numOfContexts,\n            numOfParams,\n            numOfReturnParams,\n            i,\n            param,\n            xdr = new VDPService.XDRBuffer();\n\n         if (!xdr.initDecoder(data)) {\n            JSCDKLogger.error(\"Initializing the decoder with the given data failed.\");\n            return null;\n         }\n\n         // Check whether the length matches the data length.\n         if (xdr.readUint32() !== data.length) {\n            JSCDKLogger.error(\"The length of the buffer does not match the header.\");\n            return null;\n         }\n\n         // Move the position pointer ahead to the first data byte.\n         if (!xdr.seekReadPosition(VDPService.RPC_HEADER_SIZE)) {\n            JSCDKLogger.error(\"Cannot set the read position to the first data byte.\");\n            return null;\n         }\n\n         // Check the data format matches DATA_FORMAT_RPC.\n         if (xdr.readUint32() !== VDPService.RPC_DATA_FORMAT) {\n            return null;\n         }\n\n         // Read the RPC action field to allow the RPC to be processed accordingly.\n         rpc.action = xdr.readUint8();\n         if (rpc.action === null) {\n            JSCDKLogger.error(\"Failed to read the action property of rpc.\");\n            return null;\n         }\n\n         // Populate the rpc.type based on the RPC_ACTION.\n         if (rpc.action === VDPService.RPC_ACTION.POST) {\n            rpc.type = VDPService.RPC_TYPE.POST;\n         } else if (rpc.action === VDPService.RPC_ACTION.REQUEST) {\n            rpc.type = VDPService.RPC_TYPE.REQUEST;\n         } else if (rpc.action !== VDPService.RPC_ACTION.RESPONSE) {\n            JSCDKLogger.error(\"Invalid action property of rpc: \" + rpc.action);\n            return null;\n         }\n\n         // Read the number of contexts of the RPC.\n         numOfContexts = xdr.readUint8();\n         if (numOfContexts === null) {\n            JSCDKLogger.error(\"Failed to read the number of contexts field of rpc.\");\n            return null;\n         }\n\n         /**\n          * Reads the contexts of the RPC.\n          * contexts[0] - The server channel object ID.\n          * contexts[1] - The request ID.\n          */\n         rpc.contexts = [];\n         for (i = 0; i < numOfContexts; ++i) {\n            param = xdr.readVariant();\n            if (param === null) {\n               JSCDKLogger.error(\"Failed to read the context at index: \" + i);\n               return null;\n            }\n            rpc.contexts.push(param);\n         }\n\n         // Read the command.\n         rpc.command = xdr.readVariant();\n         if (!(typeof rpc.command === 'number' ||\n            typeof rpc.command === 'string')) {\n            JSCDKLogger.error(\"Invalid command type: \" + rpc.command);\n            return null;\n         }\n\n         // Read the number of parameters field.\n         numOfParams = xdr.readUint8();\n         if (numOfParams === null) {\n            JSCDKLogger.error(\"Failed to read the number of params field of rpc.\");\n            return null;\n         }\n\n         // Read the params field.\n         rpc.params = [];\n         for (i = 0; i < numOfParams; ++i) {\n            if (xdr.readVariant() === null) {\n               JSCDKLogger.error(\"Failed to read the named param at index: \" + i);\n               return null;\n            }\n\n            param = xdr.readVariant();\n            if (param === null) {\n               JSCDKLogger.error(\"Failed to read the param value at index: \" + i);\n               return null;\n            }\n            rpc.params.push(param);\n         }\n\n         // Read the return code.\n         rpc.returnCode = xdr.readUint32();\n         if (rpc.returnCode === null) {\n            JSCDKLogger.error(\"Failed to read the return code of rpc.\");\n            return null;\n         }\n\n         // Read the number of return parameters field.\n         numOfReturnParams = xdr.readUint8();\n         if (numOfReturnParams === null) {\n            JSCDKLogger.error(\"Failed to read the number of return params field\" +\n               \" of rpc.\");\n            return null;\n         }\n\n         // Read the return params.\n         rpc.returnParams = [];\n         for (i = 0; i < numOfReturnParams; ++i) {\n            if (xdr.readVariant() === null) {\n               JSCDKLogger.error(\"Failed to read the return named parameter\" +\n                  \" field at index: \" + i);\n               return null;\n            }\n\n            param = xdr.readVariant();\n            if (param === null) {\n               JSCDKLogger.error(\"Failed to read the return value at index: \" + i);\n               return null;\n            }\n            rpc.returnParams.push(param);\n         }\n\n         // Read whether the RPC has been aborted.\n         rpc.abort = xdr.readUint8();\n         if (rpc.abort === null) {\n            JSCDKLogger.error(\"Failed to read the abort value\");\n            return null;\n         }\n\n         // Read the userCancelled field.\n         rpc.userCancelled = xdr.readUint8();\n         if (rpc.userCancelled === null) {\n            JSCDKLogger.error(\"Failed to read the userCancelled value.\");\n            return null;\n         }\n\n         // Read the abortReason value from the buffer.\n         rpc.abortCode = xdr.readUint32();\n         if (rpc.abortCode === null) {\n            JSCDKLogger.error(\"Failed to read abortCode value.\");\n            return null;\n         }\n\n         return rpc;\n      };\n\n      /**\n       * Handles the RPC received from the server.\n       *\n       * @private\n       * @param rpc {Object} - The rpc object described in VDPService.Channel.decode.\n       */\n      handleOnInvoke = function (rpc) {\n         let buffer,\n            reqID,\n            request;\n\n         switch (rpc.action) {\n            case VDPService.RPC_ACTION.REQUEST:\n               /*\n                * Inform the plugin about a new incoming RPC from the server by calling\n                * onInvoke. The plugin reads the RPC data from the object passed with\n                * onInvoke and adds the return data to this same object which is sent\n                * back to the server.\n                */\n               if (!!self.onInvoke) {\n                  self.onInvoke(rpc);\n               } else {\n                  JSCDKLogger.error(\"onInvoke Listener has not been set\" +\n                                    \" by the plugin.\");\n               }\n\n               /*\n                * Send the return parameters appended to the rpc object to\n                * the server.\n                */\n               rpc.action = VDPService.RPC_ACTION.RESPONSE;\n\n               // Clear the server params in this RESPONSE message.\n               rpc.params = [];\n\n               buffer = encode(rpc);\n\n               // Send the buffer over the virtual channel.\n               if (!vvcChannel.send(buffer)) {\n                  JSCDKLogger.error(\"Unable to send the response buffer of the RPC with \" +\n                                    \"request ID = \" + rpc.contexts[1]);\n               }\n\n               break;\n\n            case VDPService.RPC_ACTION.POST:\n               /*\n                * Inform the plugin about a new incoming RPC from the server. We do no\n                * process any return parameters of the onInvoke call as no response needs\n                * to be sent to the server.\n                */\n               if (!!self.onInvoke) {\n                  self.onInvoke(rpc);\n               } else {\n                  JSCDKLogger.error(\"Unable to hand over the RPC to the \" +\n                                    \"consumer as VDPService.Channel.onInvoke listener \" +\n                                    \"has not been set.\");\n               }\n\n               break;\n\n            case VDPService.RPC_ACTION.RESPONSE:\n               // Map the request ID of the RPC with the existing pending requests.\n               reqID = rpc.contexts[1];\n               request = pendingRequests[reqID];\n\n               if (!request) {\n                  JSCDKLogger.error(\"Unable to find the request ID of \" +\n                                    \"this RESPONSE RPC in the list of pending requests.\");\n                  return;\n               }\n\n               // Invoke the return callbacks saved while sending the RPC.\n               if (rpc.abort) {\n                  if (!!request.onAbort) {\n                     request.onAbort(rpc);\n                  } else {\n                     JSCDKLogger.error(\"Unable to hand over the RPC to \" +\n                                       \"the consumer as \" +\n                                       \"onAbort listener has not been saved.\");\n                  }\n               } else {\n                  if (!!request.onDone) {\n                     request.onDone(rpc);\n                  } else {\n                     JSCDKLogger.error(\"Unable to hand over the RPC to the \" +\n                                       \"consumer as onDone listener has not been saved.\");\n                  }\n               }\n\n               delete pendingRequests[reqID];\n               break;\n         }\n      };\n\n      /**\n       * Handles the creation of a \"channel object\" by the server. A channel object is\n       * required by the server for communicating with RPCs. This method simply\n       * acknowledges the first \"channel object\" that is created by the server if the\n       * channel object name if not specified using VDPService.Service.connectChannel().\n       * If the \"channel object\" name is passed with connectChannel, vdpservice.js only\n       * only acknowledges the channel object with the desired name.\n       *\n       * Note that javascript version of vdpService for simplification does not give the\n       * ability to the plugins to create \"channel objects\".\n       *\n       * @private\n       * @param rpc {Object} - The rpc object described in VDPService.Channel.decode.\n       */\n      handleCreateObject = function (rpc) {\n         let name,\n            objID,\n            sendBuffer,\n            vdpRPC,\n            object;\n\n         /*\n          * The channel objects will have two parameters, server's channel object name\n          * and object ID.\n          */\n         if (rpc.params.length !== 2 || typeof rpc.params[0] !== \"string\" ||\n             typeof rpc.params[1] !== \"number\") {\n            JSCDKLogger.error(\"Invalid parameters: \" + rpc.params);\n            return;\n         }\n\n         name = rpc.params[0];\n         objID = rpc.params[1];\n         console.error(name, objID);\n\n         /*\n          * If desiredObjects has been specified, then we must ensure that this\n          * new channel object's name is in the desired object list.\n          */\n         if (self.desiredObjects && self.desiredObjects.length) {\n            if (self.desiredObjects.indexOf(name) === -1) {\n               JSCDKLogger.info(\"Ignoring channel object \" + name + \", because\" +\n                                \" it doesn't match desired channel objects \" +\n                                self.desiredObjects);\n               return null;\n            }\n         }\n\n         vdpRPC = { command: VDPService.CHANNEL_COMMANDS.CREATE_OBJECT,\n            action: VDPService.RPC_ACTION.POST,\n            params : [name, objID],\n            contexts: [0, 0] };\n\n         sendBuffer = encode(vdpRPC);\n\n         // Send the buffer over the virtual channel.\n         if (!vvcChannel.send(sendBuffer)) {\n            JSCDKLogger.error(\"Unable to send the CREATE_OBJECT acknowledgement.\");\n            return;\n         }\n\n         /*\n          * VDPService.Channel goes into a READY state when a \"Channel\n          * Object\" is created by the server. The channel is ready to send RPCs.\n          * Fire the onReady callback.\n          */\n         self.state = VDPService.CHANNEL_STATE.READY;\n\n         // Add the object to our open objects list\n         object = { id: objID, name: name };\n         self.openObjects.push(object);\n\n         JSCDKLogger.info(\"vdpService: Acknowledged object ID \" + objID + \", name \" +\n                          name + \", for channel \" + self.name);\n\n         // Fire the onReady callback to the listener.\n         if (!!self.onReady) {\n            self.onReady(object);\n         } else {\n            JSCDKLogger.error(\"onReady Listener has not been set by the plugin.\");\n         }\n      };\n\n      /**\n       * Handles the destruction of a \"channel object\".\n       *\n       * @private\n       * @param rpc {Object} - The rpc object described in VDPService.Channel.decode.\n       */\n      handleDestroyObject = function (rpc) {\n         let name,\n            objID,\n            sendBuffer,\n            vdpRPC,\n            index,\n            object;\n\n         /*\n          * The channel objects will have two parameters,\n          * channel object name and ID.\n          */\n         if (rpc.params.length !== 2  || typeof rpc.params[0] !== \"string\" ||\n             typeof rpc.params[1] !== \"number\") {\n            JSCDKLogger.error(\"Invalid params length:\" + rpc.params.length);\n            return;\n         }\n\n         name = rpc.params[0];\n         objID = rpc.params[1];\n\n         // Find and remove the object from the list of open objects\n         index = self.openObjects.indexOf(findOpenObjectByID(objID));\n\n         if (index === -1) {\n            JSCDKLogger.error(\"Could not find open object with id:\" + objID);\n            return null;\n         }\n\n         object = self.openObjects.splice(index, 1)[0];\n\n         /*\n         * If there is now no server channel object to communicate with, the\n         * channel goes into NOT_READY state.\n         */\n         if (self.openObjects.length === 0) {\n            self.state = VDPService.CHANNEL_STATE.NOT_READY;\n         }\n\n         /**\n          * Send the VDPService.CHANNEL_COMMANDS.DESTROY_OBJECT channel command\n          * to the server.\n          */\n         vdpRPC = { command: VDPService.CHANNEL_COMMANDS.DESTROY_OBJECT,\n            action: VDPService.RPC_ACTION.POST,\n            params : [name, objID],\n            contexts: [0, 0] };\n\n         sendBuffer = encode(vdpRPC);\n\n         /**\n          * Send the buffer over the virtual channel. We trigger the channel\n          * state change even when we fail to send the DESTROY_OBJECT packet to\n          * the server.\n          */\n         if (!vvcChannel.send(sendBuffer)) {\n            JSCDKLogger.error(\"Failed to send the DESTROY_OBJECT acknowledgement.\");\n         }\n\n         // Fire the onDisconnect callback to the listener.\n         if (!!self.onDisconnect) {\n            self.onDisconnect(object);\n         } else {\n            JSCDKLogger.warning(\"onDisconnect Listener has not been set \" +\n                                \"by the plugin.\");\n         }\n      };\n\n      /**\n       * Find an open channel object by id\n       *\n       * @private\n       * @param {Number} id\n       *    The object id to search for\n       * @return {{id, name}?}\n       *    The open object, or null when no object is found with id\n       */\n      findOpenObjectByID = function (id) {\n         let i;\n\n         for (i = 0; i < self.openObjects.length; ++i) {\n            if (self.openObjects[i].id === id) {\n               return self.openObjects[i];\n            }\n         }\n\n         return null;\n      };\n\n      /**\n       * Find an open channel object by name\n       *\n       * @private\n       * @param {String} name\n       *    The object name to search for\n       * @return {{id, name}?}\n       *    The open object, or null when no object is found with name\n       */\n      findOpenObjectByName = function (name) {\n         let i;\n\n         for (i = 0; i < self.openObjects.length; ++i) {\n            if (self.openObjects[i].name === name) {\n               return self.openObjects[i];\n            }\n         }\n\n         return null;\n      };\n   }\n});\n\n\nexport default VDPService;\n\n\n// WEBPACK FOOTER //\n// ./desktop/channels/vdpservice.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getTunnelConnectionHandler.js --\n *\n *      Implementation of the message handler to get tunnel connection.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler} from './messageHandler';\nimport Router from './router';\n\n\nexport default function GetTunnelConnectionHandler() {\n   let router;\n\n   // member variables\n   this.messageName = \"get-tunnel-connection\";\n   this.messageText = \"get-tunnel-connection\";\n   this.responseTag = \"tunnel-connection\";\n\n   this.subHandlerList = [];\n\n   // register dependencies here\n   router = util.getObject(globalArray, 'router');\n   if (!!router) {\n      this.registerHandler(router, 'receiver');\n      this.registerHandler(router, 'doLogout');\n      this.registerHandler(router, 'doCancelAuthentication');\n   }\n}\n\n// inherits MessageHandler prototype\nGetTunnelConnectionHandler.prototype = new MessageHandler();\nGetTunnelConnectionHandler.constructor = GetTunnelConnectionHandler;\n\n/**\n * Set the request XML for getTunnelConnection.\n *\n * @param bypassTunnel [in] bypass tunnel or not(true/false).\n */\n\nGetTunnelConnectionHandler.prototype.setRequestXML = function(bypassTunnel) {\n   if (bypassTunnel === false) {\n      // HTML Access should always bypass tunnel\n      throw 'HTML Access cannot use the tunnel connection!';\n      // this.requestXML = \"\";\n      // this.setSubHandler();\n   } else {\n      this.requestXML = util.createElement(\"bypass-tunnel\", \"true\");\n      if (util.brokerSupportApplication()) {\n         this.requestXML +=\n            util.createElement(\"multi-connection-aware\", \"true\");\n      }\n      this.clearSubHandlers();\n   }\n};\n/**\n * parse tunnel information from the response XML\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\n\nGetTunnelConnectionHandler.prototype.parseResult = function(responseXML) {\n   let brokerTag;\n   let responses;\n   let result;\n   let tunnelConnectionResponse = {};\n   let xmlDoc;\n\n   xmlDoc = $(responseXML);\n   brokerTag = $(xmlDoc.children()[0]);\n   responses = brokerTag.children(this.responseTag);\n   result = responses.children(\"result\").text();\n   if (result === \"ok\" || result === \"error\") {\n      /*\n       * Add the \"ok\" and \"error\" response to the response JSON struct,\n       * because for the \"ok\" and \"error\" result, the response XML structure\n       * are the same, the following code can work in both cases.\n       */\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         util.addItemForJson(tunnelConnectionResponse, nameText,\n            $(this).text());\n      });\n   }\n\n   return tunnelConnectionResponse;\n};\n\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\n\nGetTunnelConnectionHandler.prototype.onUpdated = function() {\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   // Push error to UI\n   Router.prototype.pushErrorToUser(this);\n};\n\n/**\n * Set its sub handler.\n * NOTE: this function is not used any more.\n */\n\n// GetTunnelConnectionHandler.prototype.setSubHandler = function ()\n// {\n//    var setupTunnelConnObject = globalArray[\"setup-tunnel-connection\"];\n//    if (!setupTunnelConnObject) {\n//       setupTunnelConnObject = new SetupTunnelConnectionHandler();\n//       globalArray[setupTunnelConnObject.messageName] = setupTunnelConnObject;\n//       globalArray[setupTunnelConnObject.responseTag] = setupTunnelConnObject;\n//    } else {\n//       setupTunnelConnObject.resetData();\n//    }\n//\n//    this.appendSubHandler(setupTunnelConnObject);\n// };\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/getTunnelConnectionHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * killSessionHandler.js --\n *\n *      Implementation of the message handler to kill session.\n *      current used type is only of Desktop And All Application\n *      sessions, the \"ApplicationSession\"(not recommanded) or\n *      \"Application\" is the preserved API for later function\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport Router from './router';\n\n\nexport default function KillSessionHandler() {\n   let router;\n\n   // member variables below\n   this.messageName = \"kill-session\";\n   this.messageText = \"kill-session\";\n   this.responseTag = \"kill-session\";\n   this.composedHandlerList = [];\n\n   this.itemId = '';\n   this.itemType = '';\n   this.callbackFunction = null;\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n   }\n}\n\n// inherits MessageHandler prototype\nKillSessionHandler.prototype = new MessageHandler();\n// constructor\nKillSessionHandler.constructor = KillSessionHandler;\n\n\nKillSessionHandler.prototype.setCallbackFunction = function(callbackFunction) {\n   this.callbackFunction = callbackFunction;\n};\n\n/**\n * parse information from the response XML of kill-session\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\nKillSessionHandler.prototype.parseResult = function(responseXML) {\n   let killSessionResponse = {},\n      xmlDoc = $(responseXML),\n      brokerTag,\n      responses,\n      result;\n\n   brokerTag = $(xmlDoc.children()[0]);\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of killSessionHandler error\");\n      return null;\n   }\n\n   responses = brokerTag.children(this.responseTag);\n   result = responses.children(\"result\").text();\n   if (result === \"ok\" || result === \"error\") {\n      /*\n       * Add the \"ok\" and \"error\" response to the response JSON struct,\n       * because for the \"ok\" and \"error\" result, the response XML structure\n       * are the same, the following code can work in both cases.\n       */\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         util.addItemForJson(killSessionResponse, nameText, $(this).text());\n      });\n   }\n\n   return killSessionResponse;\n};\n\n/**\n * Set the request XML for kill-session\n * @param sessionId[in] session id to kill-session\n *\n */\nKillSessionHandler.prototype.setRequestXML = function(sessionId) {\n   let sessionIdElem;\n   sessionIdElem = util.createElement(\"session-id\", sessionId);\n   this.requestXML = sessionIdElem;\n   this.sessionId = sessionId;\n};\n\n/**\n * callback when received notification from handlers in dependency list or\n * router\n *\n */\nKillSessionHandler.prototype.onUpdated = function() {\n   let killSessionAction,\n      callbackFunction = this.callbackFunction,\n      key = this.messageName;\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (typeof(callbackFunction) !== 'function') {\n      if (this.state === StateEnum.DONE) {\n         if (!!(this.content[\"parsedResult\"]) &&\n            this.content[\"parsedResult\"][\"result\"] === \"ok\") {\n            JSCDKLogger.debug('kill-session succeeds.');\n\n            // Kill session succeeds\n            killSessionAction = {\n               name: \"KillSession\",\n               result: \"ok\"\n            };\n            JSCDKSetUI(JSON.stringify(killSessionAction));\n         }\n      }\n\n      // push error if it exists\n      Router.prototype.pushErrorToUser(this);\n   } else {\n      if (this.state === StateEnum.DONE) {\n         if (!!(this.content[\"parsedResult\"]) &&\n            this.content[\"parsedResult\"][\"result\"] === \"ok\") {\n            JSCDKLogger.debug('kill-session succeeds.');\n\n            // Kill session succeeds\n            callbackFunction({\n               result: \"success\"\n            });\n         }\n      }\n      if (!!this.content[\"error\"]) {\n         callbackFunction({\n            result: \"fail\",\n            error: this.content[\"error\"][key],\n            sessionId: this.sessionId\n         });\n      }\n      callbackFunction = null;\n   }\n};\n\n/**\n * Triggered by the parent handler\n *\n */\nKillSessionHandler.prototype.triggerExecution = function() {\n   let getItemsObject,\n      desktops,\n      applications,\n      applicationSessions,\n      targetDesktop,\n      targetApplication,\n      targetApplicationSession,\n      sessionId,\n      handlerList,\n      itemId = this.itemInfo.id,\n      launchItemTypeIsDesktop = this.itemInfo.isDesktop,\n      router = globalArray['router'],\n      errorMessage,\n      errorObj = {};\n\n   MessageHandler.prototype.triggerExecution.apply(this);\n\n   // Get session ID of the desktop whose id equals itemId.\n   getItemsObject = this.parentHandler;\n   if (!getItemsObject) {\n      if (!util.brokerSupportApplication()) {\n         getItemsObject = globalArray['get-desktops' + itemId];\n      } else {\n         getItemsObject = globalArray['get-launch-items' + itemId];\n      }\n   }\n   if (!!getItemsObject && !!getItemsObject.content[\"parsedResult\"]) {\n      desktops = getItemsObject.content[\"parsedResult\"][\"desktops\"];\n      applications = getItemsObject.content[\"parsedResult\"][\"applications\"];\n      applicationSessions =\n         getItemsObject.content[\"parsedResult\"][\"application-sessions\"];\n   }\n   if (launchItemTypeIsDesktop && !!desktops) {\n      // using this function, for URI launching might use desktop name or its id\n      targetDesktop = getItemsObject.findDesktop(itemId, desktops);\n      if (!!targetDesktop) {\n         sessionId = targetDesktop[\"session-id\"];\n      }\n   }\n   if (!launchItemTypeIsDesktop && !!applications && !!applicationSessions) {\n      targetApplication =\n         util.findFirstItemWithPropertyInList('id', itemId, applications);\n      if (!!targetApplication) {\n         targetApplicationSession =\n            util.findFirstItemWithPropertyInList('origin-id',\n               targetApplication['origin-id'], applicationSessions);\n         if (!!targetApplicationSession) {\n            sessionId = targetApplicationSession.id;\n         }\n      }\n   }\n\n   // kill the session.\n   if (!!sessionId && (sessionId.trim() !== \"\")) {\n      this.setRequestXML(sessionId);\n      handlerList = this.composeHandlerList();\n      router.postMessage(handlerList);\n   } else {\n      errorObj.name = \"JSCDK_ERROR_LOGOFF_POOL_FAILED\";\n      if (launchItemTypeIsDesktop) {\n         errorMessage = util._(\n            \"This desktop cannot be logged off. Please contact your system administrator.\");\n      } else {\n         errorMessage = util._(\n            \"This application cannot be reset. Please contact your system administrator.\");\n      }\n      Router.prototype.pushSelfDefinedError(errorObj, errorMessage);\n   }\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/killSessionHandler.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * timer-util.js --\n *\n *      common functions for idle timeout.\n *\n */\n\n\nimport JSCDKLogger from '../jscdkLogger.js';\nimport {JSCDKSetUI, globalArray} from '../jscdkClient';\nimport util from '../util';\nimport GetTunnelConnectionHandler from '../controllers/getTunnelConnectionHandler';\nimport {StateEnum} from '../controllers/messageHandler';\n\n\n/**\n * The method the jscdk can get last user active time from detecting layer\n *\n * The last active time will be returned using async method in\n * timerCtrlCommand\n *\n */\nfunction requestLastActiveTime(ActionName) {\n   let requestLastUserActiveTimeAction = {};\n\n   if (!util.brokerSupportApplication()) {\n      return;\n   }\n   JSCDKLogger.debug(\"request last active time for:\" + ActionName);\n   requestLastUserActiveTimeAction.name = ActionName;\n   JSCDKSetUI(JSON.stringify(requestLastUserActiveTimeAction));\n}\n\n/**\n * The method the jscdk can get last user active time from Portal page,\n * i.e. the page before enter desktop page or applications page for both\n * Client.\n */\nexport function requestLastActiveTimeFromPortal() {\n   requestLastActiveTime(\"RequestLastUserActiveTime\");\n}\n\n/**\n * The method the jscdk can get last user active time from desktop page\n * or\n * applications page for WebClient\n *\n * currently is identical to requestLastActiveTimeFromUI, 'Cause the\n * redirection\n */\nexport function requestLastActiveTimeFromRemoteSession() {\n   requestLastActiveTime(\"RequestLastUserActiveTime\");\n}\n\nexport function prepareForAlreadyAuthenticated() {\n   let getDesktopsObject,\n      getLaunchItemsObject,\n      getTunnelConnObject;\n\n   if (!globalArray) {\n      return;\n   }\n   /*\n    * getDesktops or getLaunchItems depends on getTunnelConnection, but\n    * getTunnelConnection's state will be set to StateEnum.DONE in the\n    * successive code segment, thus getDesktops or getLaunchItems behaves\n    * wrongly to update UI to turn to desktop/items select page. We need to\n    * reset data for getDesktops or getLaunchItems to avoid such behavior.\n    */\n   JSCDKLogger.debug(\"prepare for already authenticated\");\n   getDesktopsObject = globalArray[\"get-desktops\"];\n   if (!!getDesktopsObject) {\n      getDesktopsObject.resetData();\n   }\n\n   getLaunchItemsObject = globalArray[\"get-launch-items\"];\n   if (!!getLaunchItemsObject) {\n      getLaunchItemsObject.resetData();\n   }\n\n   // Get GetTunnelConnectionHandler\n   getTunnelConnObject = globalArray[\"get-tunnel-connection\"];\n   if (!!getTunnelConnObject) {\n      // Update the state of GetTunnelConnectionHandler to DONE to fake\n      // sending success\n      getTunnelConnObject.setState(StateEnum.DONE);\n   } else {\n      // The existence of GetTunnelConnectionHandler\n      // is required when already authenticated.\n      getTunnelConnObject = new GetTunnelConnectionHandler();\n      globalArray[getTunnelConnObject.messageName] =\n         getTunnelConnObject;\n      globalArray[getTunnelConnObject.responseTag] =\n         getTunnelConnObject;\n      // Update the state of GetTunnelConnectionHandler to DONE to fake\n      // sending success\n      getTunnelConnObject.setState(StateEnum.DONE);\n   }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/timer/timer-util.js","var path = 'common/commondialog/dialog_service_confirm.html';\nvar html = \"<div class=\\\"dialog-title\\\">{{ngDialogData.title}}</div>\\n<div class=\\\"dialog-content\\\">\\n   <div class=\\\"session-ops-window-text\\\">{{ngDialogData.message}}</div>\\n   <div id=\\\"session-ops-warning-no-ft\\\" class=\\\"session-ops-window-text warning\\\" ng-show=\\\"ngDialogData.showWarning && !ngDialogData.isTransferringFile && !ngDialogData.isTransferringPrintFile\\\">{{'UNSAVED_WORK_M' | i18n}}</div>\\n   <div id=\\\"session-ops-warning-ft\\\" class=\\\"session-ops-window-text warning\\\" ng-show=\\\"ngDialogData.showWarning && ngDialogData.isTransferringFile && !ngDialogData.isTransferringPrintFile\\\">{{'UNSAVED_WORK_FT_M' | i18n}}</div>\\n   <div id=\\\"session-ops-warning-print\\\" class=\\\"session-ops-window-text warning\\\" ng-show=\\\"ngDialogData.showWarning && !ngDialogData.isTransferringFile && ngDialogData.isTransferringPrintFile\\\">{{'UNSAVED_WORK_PRINT_M' | i18n}}</div>\\n   <div id=\\\"session-ops-warning-print-ft\\\" class=\\\"session-ops-window-text warning\\\" ng-show=\\\"ngDialogData.showWarning && ngDialogData.isTransferringFile && ngDialogData.isTransferringPrintFile\\\">{{'UNSAVED_WORK_PRINT_FT_M' | i18n}}</div>\\n</div>\\n<div class=\\\"dialog-button-row\\\" dialog-tab-scope>\\n   <button class=\\\"modal-button-base modal-button-right modal-button-blue ok-button\\\" ng-click=\\\"confirm() || closeThisDialog()\\\" id=\\\"okDialogBtn\\\" dialog-tabindex=\\\"1\\\" dialog-prevent-key-up>\\n      {{(ngDialogData.buttonLabelConfirm) || ('OK' | i18n)}}\\n   </button>\\n   <button class=\\\"modal-button-base modal-button-right modal-button-grey\\\" ng-click=\\\"close() || closeThisDialog()\\\" id=\\\"cancelDialogBtn\\\" dialog-tabindex=\\\"2\\\" dialog-prevent-key-up>\\n      {{(ngDialogData.buttonLabelCancel) || ('CANCEL' | i18n)}}\\n   </button>\\n</div>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./common/commondialog/dialog_service_confirm.html\n// module id = 26\n// module chunks = 0","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * Common module which provides many useful services/models.\n */\n\nimport angular from 'angular';\nimport ngDialog from 'ng-dialog';\nimport usernameUtil from './service/username-util';\nimport userGlobalPref from './service/userglbpref';\nimport {localize, i18n, translate} from './service/localize-service';\nimport {timezone, timezoneListDirective} from './timezone/timezone';\nimport URIParamValidator from './service/uri-param-validator';\nimport toastService from './service/toast-service';\nimport storageService from './service/storage-service';\nimport safeStorageService from './service/safe-storage-service';\nimport prefData from './service/prefdata';\nimport multiSiteService from './service/multisite-service';\n// import jscdkUIAdapter from './service/jscdk-ui-adapter';\nimport dpiService from './service/dpi-service';\nimport credCleanService from './service/credentialclean-service';\nimport brokerSessionStorageService from './service/broker-session-storage-service';\nimport baseViewService from './service/base-view-service';\nimport viewClientModel from './model/viewclient-model';\nimport osModel from './model/os-model';\nimport connectionURIModel from './model/connection-uri-model';\nimport connectionServerModel from './model/connection-server-model';\nimport clientIdFactory from './model/clientid-model';\nimport blastSessionsModel from './model/blastsessions-model';\nimport BaseViewClientModel from './model/baseviewclient-model';\nimport fuzzyFree from './directive/scrollable-dialog-fuzzy-free';\nimport scrollableDialog from './directive/scrollable-dialog';\nimport ws1Service from './service/ws1-service';\nimport {\n   dialogTabindex,\n   dialogPreventKeyUp,\n   dialogTabScope\n} from './directive/dialog-accessibility';\nimport constants from './constant/app-constant';\nimport {ngDialogProvider, dialogService} from './commondialog/dialog-service';\nimport AboutDialogCtrl from './aboutdialog/about-dialog-controller';\n\n\nexport default angular.module('com.vmware.vdi.htmlaccess.common', [ngDialog])\n   .service('usernameUtil', usernameUtil)\n   .service('userGlobalPref',\n      ['$log', '$rootScope', '$window', 'prefData', userGlobalPref])\n   .factory('localize', ['$window', 'viewClientModel', '$rootScope', localize])\n   .filter('i18n', ['localize', i18n])\n   .factory('translate', ['localize', translate])\n   .factory('timezone', ['$window', '$log', 'prefData', timezone])\n   .service('URIParamValidator', ['usernameUtil', URIParamValidator])\n   .service('toastService', toastService)\n   .service('storageService', ['$window', storageService])\n   .service('safeStorageService', ['$window', safeStorageService])\n   .factory('prefData', prefData)\n   .service('multiSiteService', ['$window', multiSiteService])\n   // .service('jscdkUIAdapter', ['$rootScope', '$q', '$window',\n   // jscdkUIAdapter])\n   .factory('dpiService',\n      ['$window', 'constants', 'userGlobalPref', dpiService])\n   .service('credCleanService',\n      ['$window', 'userGlobalPref', 'viewClientModel', credCleanService])\n   .service('brokerSessionStorageService',\n      ['$window', 'storageService', brokerSessionStorageService])\n   .service('baseViewService',\n      ['$location', '$timeout', '$window', 'viewClientModel',\n         'credCleanService', baseViewService])\n   .factory('viewClientModel',\n      ['$window', 'BaseViewClientModel', 'osModel', 'clientID',\n         'storageService', viewClientModel])\n   .factory('osModel', osModel)\n   .service('connectionURIModel',\n      ['storageService', 'usernameUtil', 'viewClientModel', connectionURIModel])\n   .factory('connectionServerModel', ['$window', connectionServerModel])\n   .factory('clientID', ['$window', clientIdFactory])\n   .service('blastSessionsModel',\n      ['brokerSessionStorageService', blastSessionsModel])\n   .factory('BaseViewClientModel',\n      ['$rootScope', '$timeout', 'brokerSessionStorageService', 'constants',\n         BaseViewClientModel])\n   .directive('fuzzyFree', ['$rootScope', '$timeout', fuzzyFree])\n   .directive('scrollableDialog', ['$window', scrollableDialog])\n   .directive('dialogTabindex', dialogTabindex)\n   .directive('dialogPreventKeyUp', ['$rootScope', dialogPreventKeyUp])\n   .directive('dialogTabScope', ['$timeout', dialogTabScope])\n   .directive('timezoneList', timezoneListDirective)\n   .constant('constants', constants)\n   .config(['ngDialogProvider', ngDialogProvider])\n   .service('dialogService', ['ngDialog', dialogService])\n   .service('ws1Service', ['constants',\n      'brokerSessionStorageService', 'connectionURIModel', ws1Service])\n   .controller('AboutDialogCtrl',\n      ['$scope', 'viewClientModel', 'localize', AboutDialogCtrl]).name;\n\n\n\n// WEBPACK FOOTER //\n// ./common/module.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport angular from 'angular';\nimport {fullscreenSubService, fullscreenService} from './fullscreen-service';\nimport bitBuffer from './bitbuffer';\nimport renderCacheService from './render-cache-service';\nimport vncDecoder from './vnc-decoder';\nimport wmksBaseService from './wmks-base-service';\nimport normalizationService from './normalization-service';\n\n\nexport default angular.module('com.vmware.vdi.htmlaccess.desktop.sharedUtil', [])\n   .service('fullscreenSubService', ['$window', fullscreenSubService])\n   .service('bitBuffer', bitBuffer)\n   .service('renderCacheService', ['bitBuffer', renderCacheService])\n   .service('normalizationService', normalizationService)\n   .service('fullscreenService', ['$window', '$timeout', 'fullscreenSubService', fullscreenService])\n   .service('vncDecoder', ['normalizationService', 'renderCacheService', vncDecoder])\n   .service('wmksBaseService', ['$window', 'normalizationService', wmksBaseService])\n   .name;\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/common/module.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * string-utils.js\n *\n * Utility functions for converting between JavaScript strings and\n * uint8Arrray objects.\n **/\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\nlet StringUtils = (function() {\n   return {\n\n      /**\n       * uint8ArrayToString\n       *\n       * Helper function used to convert a Uint8Array containing UTF-8 data to a string.\n       *\n       * @param array   Array to convert.\n       * @return        Converted string.\n       */\n      uint8ArrayToString: function(array) {\n         let str = '',\n             CHUNK_SZ = 0x8000,\n             c = [],\n             i;\n         try {\n            /*\n             * The \"apply\" method can only handle arrays up to a certain size, so we\n             * split the array into large chunks and process them chunk by chunk.\n             * The subarray method will safely return the remainder of the array if the\n             * upper bound is higher than the array bound.\n             */\n            for (i = 0; i < array.length; i += CHUNK_SZ) {\n               c.push(String.fromCharCode.apply(null, array.subarray(i, i + CHUNK_SZ)));\n            }\n            str = decodeURIComponent(escape(c.join(\"\")));\n         } catch (e) {\n            JSCDKLogger.info('uint8ArrayToString failed to parse array with length ' +\n                             array.length + ': ' + e);\n         }\n         return str;\n      },\n\n      /**\n       * stringToUint8Array\n       *\n       * Helper function used to convert a string to a Uint8Array.  Note that it is not\n       * explicitly null-terminated, so consumers who are using this function to create\n       * data to send over the network may need to append '\\x00' if the server side is\n       * expecting null-terminated string.\n       *\n       * This will not work for unmatched surrogate halves, but it is good enough for\n       * us to use for now.\n       *\n       * @param string        String to convert.\n       * @param nullTerminate Whether to null-terminate the string (unspecified means false).\n       * @return              Converted array in UTF-8 form.\n       */\n      stringToUint8Array: function(string, nullTerminate) {\n         let i = 0,\n             utf8String,\n             array;\n\n         // Convert from UTF-16 to UTF-8.\n         try {\n            utf8String = unescape(encodeURIComponent(string));\n         } catch (e) {\n            JSCDKLogger.error('Failed to convert string to UTF-8 with error: ' + e);\n            return new Uint8Array(0);\n         }\n\n         // Copy the UTF-8 data to the Uint8Array.\n         array = new Uint8Array(utf8String.length + (nullTerminate ? 1 : 0));\n         for (i = 0; i < utf8String.length; i++) {\n            array[i] = utf8String.charCodeAt(i);\n         }\n\n         // null-terminate if necessary.\n         if (nullTerminate) {\n            array[array.length] = 0;\n         }\n\n         return array;\n      },\n\n      /**\n       * uint8ArrayIndexOf\n       *\n       * Helper function that does the equivalent of Array indexOf(), but for Uint8Array.\n       *\n       * @param array         Array to search\n       * @param element       Element to search for\n       * @param start         Optional start index to search (default is 0).\n       * @return              First index of element if found, -1 otherwise.\n       */\n      uint8ArrayIndexOf: function(array, element, start) {\n         let i;\n\n         if (!(array instanceof Uint8Array) || typeof element !== 'number' ||\n             element >= 256 || start === -1) {\n            return -1;\n         }\n\n         if (start === undefined) {\n            start = 0;\n         }\n\n         for (i = start; i < array.length; i++) {\n            if (array[i] === element) {\n               return i;\n            }\n         }\n\n         return -1;\n      },\n\n      /**\n       * uint8ArrayTokenize\n       *\n       * Helper function that retrieves the subarray of a Uint8Array that begins at the\n       * specified starting index and ends at first occurrence of the specified array\n       * element (exclusive of the index where the element occurs).  If the element isn't\n       * found, the rest of the array is returned.\n       *\n       * @param array         Array to search\n       * @param element       Element to search for\n       * @param start         Optional start index to search (default is 0).\n       * @return              Object containing:\n       *                       .index: First index of element if found, -1 otherwise.\n       *                       .result: Subarray as mentioned in function description.\n       */\n      uint8ArrayTokenize: function(array, element, start) {\n         let index,\n             resultArray;\n\n         start = start || 0;\n\n         index = StringUtils.uint8ArrayIndexOf(array, element, start);\n         resultArray = array.subarray(start, index);\n\n         return { 'index' : index, 'result' : resultArray };\n      }\n   };\n}());\n\nexport default StringUtils;\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/string-utils.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * bitbuffer.js -- bitBuffer\n *\n * Service to generate bitBuffer instance.\n */\n\nexport default function bitBuffer() {\n   let BitBuffer = function(buffer, size) {\n      this._buf = buffer;\n      this._size = size;\n      this._readCount = 0;\n      this._overflow = false;\n      this._thisByte = 0;\n      this._thisByteBits = 0;\n   };\n\n   BitBuffer.prototype.readBits0 = function(val, nr) {\n      let mask;\n\n      if (this._bits < nr) {\n         this._overflow = true;\n         return -1;\n      }\n\n      mask = ~(0xff >> nr); /* ones in the lower 'nr' bits */\n      val <<= nr; /* move output value up to make space */\n      val |= (this._thisByte & mask) >> (8 - nr);\n      this._thisByte <<= nr;\n      this._thisByte &= 0xff;\n      this._thisByteBits -= nr;\n\n      return val;\n   };\n\n   BitBuffer.prototype.readBits = function(nr) {\n      let origNr = nr;\n      let val = 0;\n\n      if (this._overflow) {\n         return 0;\n      }\n\n      while (nr > this._thisByteBits) {\n         nr -= this._thisByteBits;\n         val = this.readBits0(val, this._thisByteBits);\n\n         if (this._readCount < this._size) {\n            this._thisByte = this._buf[this._readCount++];\n            this._thisByteBits = 8;\n         } else {\n            this._thisByte = 0;\n            this._thisByteBits = 0;\n            if (nr > 0) {\n               this._overflow = true;\n               return 0;\n            }\n         }\n      }\n\n      val = this.readBits0(val, nr);\n      return val;\n   };\n\n   BitBuffer.prototype.readEliasGamma = function() {\n      let l = 0;\n      let value;\n      let bit;\n      let origidx = this._readCount;\n      let origbit = this._thisByteBits;\n\n      while (!this._overflow &&\n         (bit = this.readBits(1)) === 0) {\n         l++;\n      }\n\n      value = 1 << l;\n\n      if (l) {\n         value |= this.readBits(l);\n      }\n\n      return value;\n   };\n   return {\n      newInstance: function(buffer, size) {\n         return new BitBuffer(buffer, size);\n      }\n   };\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/common/bitbuffer.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * fullscreen-service.js -- fullscreenService\n *\n * \"sharedUtilModule\" will shared among modules.\n * functions like this and logger should also be added in this place\n * to share among all modules like for launcher, appblast, mulitmon,\n * rtav, etc...\n *\n * Service to control the fullscreen related logic, only support one\n * listener for event, and extenable to the many version.\n */\n\n\nexport function fullscreenSubService($window) {\n   this.isFullscreen = function() {\n      return !(($window.document.fullScreenElement !== undefined &&\n               $window.document.fullScreenElement === null) ||\n               ($window.document.msFullscreenElement !== undefined &&\n               $window.document.msFullscreenElement === null) ||\n               ($window.document.mozFullScreen !== undefined && !$window.document.mozFullScreen) ||\n               ($window.document.webkitIsFullScreen !== undefined &&\n               !$window.document.webkitIsFullScreen));\n   };\n\n   /**\n    * Will execute the callback when either waitTime reached or condition is\n    *    satisfied\n    * @param  {function} condition The condition function, which once return\n    *    true, will trigger the execution of callback\n    * @param  {function} callback The callback function will be processed\n    *    sooner\n    *    or later.\n    * @param  {number} waitMaxTime The max wait time in ms\n    */\n   this.waitCondition = function(condition, callback, waitMaxTime) {\n      let waitTime = waitMaxTime || 3000, //ms\n         checkInterval = 100, //ms\n         checkFunction,\n         waitTimer;\n\n      checkFunction = function() {\n         waitTime -= checkInterval;\n         if (condition() || waitTime <= 0) {\n            callback();\n            clearInterval(waitTimer);\n         }\n      };\n\n      if (condition()) {\n         callback();\n      } else {\n         waitTimer = setInterval(checkFunction, checkInterval);\n      }\n   };\n}\n\n/**\n * Control the full screen related logic, since chrome will take time to update\n * the property value on some version, add waitTime as 500ms to avoid using\n * corrupted properties.\n */\nexport function fullscreenService($window, $timeout, fullscreenSubService) {\n   let fullscreenHandler = {},\n      onFullscreenChanged,\n      isFullscreen = fullscreenSubService.isFullscreen,\n      waitCondition = fullscreenSubService.waitCondition,\n      waitTime = 500;\n\n   onFullscreenChanged = function(event) {\n      console.info(\"full screen changed\");\n      if (isFullscreen()) {\n         console.info(\"enter full screen\");\n         if (!fullscreenHandler ||\n            typeof fullscreenHandler.onEnterFullscreen !== \"function\") {\n            console.error(\"found no handler\");\n            return;\n         }\n         waitCondition(function() {\n            /**\n             * Use tolerent to avoid delay before entering fullscreen on some\n             * machines since chrome has bug on some machines to support screenX\n             * https://drafts.csswg.org/cssom-view/#dom-window-screenx\n             */\n            let tolerent = 10;\n            return screenX <= screen.availLeft + tolerent &&\n               screenY <= screen.availTop + tolerent;\n         }, function() {\n            $timeout(fullscreenHandler.onEnterFullscreen, waitTime);\n         });\n      } else {\n         console.info(\"exit full screen\");\n         if (!fullscreenHandler ||\n            typeof fullscreenHandler.onExitFullscreen !== \"function\") {\n            console.error(\"found no handler\");\n            return;\n         }\n         /**\n          * Specify the wait time here to avoid a chrome bug on \"screen\", which\n          * in corner cases violates the spec:\n          * https://developer.mozilla.org/en-US/docs/Web/API/Screen/availLeft\n          */\n         waitCondition(function() {\n            return screenX >= screen.availLeft && screenY >= screen.availTop;\n         }, fullscreenHandler.onExitFullscreen, waitTime);\n      }\n   };\n   return {\n      enterFullscreen: function(elem) {\n         if (isFullscreen()) {\n            return;\n         }\n         if (elem.requestFullScreen) {\n            elem.requestFullScreen();\n         } else if (elem.mozRequestFullScreen) {\n            elem.mozRequestFullScreen();\n         } else if (elem.webkitRequestFullscreen) {\n            elem.webkitRequestFullscreen(elem.ALLOW_KEYBOARD_INPUT);\n         } else if (elem.webkitRequestFullScreen) {\n            elem.webkitRequestFullScreen(elem.ALLOW_KEYBOARD_INPUT);\n         } else if (elem.msRequestFullscreen) {\n            elem.msRequestFullscreen();\n         } else {\n            console.error(\"fail to max the screen\");\n         }\n      },\n      exitFullscreen: function() {\n         if (isFullscreen()) {\n            if ($window.document.exitFullscreen) {\n               $window.document.exitFullscreen();\n            } else if ($window.document.msExitFullscreen) {\n               $window.document.msExitFullscreen();\n            } else if ($window.document.mozCancelFullScreen) {\n               $window.document.mozCancelFullScreen();\n            } else if ($window.document.webkitExitFullscreen) {\n               $window.document.webkitExitFullscreen();\n            } else {\n               console.error(\"fail to cancel maximizing the screen\");\n            }\n         }\n      },\n      onEnterFullscreen: function(callback) {\n         fullscreenHandler.onEnterFullscreen = callback;\n      },\n      onExitFullscreen: function(callback) {\n         fullscreenHandler.onExitFullscreen = callback;\n      },\n      bindFullScreen: function() {\n         $(document).on('webkitfullscreenchange mozfullscreenchange ' +\n            'fullscreenchange MSFullscreenChange', onFullscreenChanged);\n      },\n      unbindFullScreen: function() {\n         $(document).off('webkitfullscreenchange mozfullscreenchange ' +\n            'fullscreenchange MSFullscreenChange', onFullscreenChanged);\n      }\n   };\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/common/fullscreen-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * normalization-service.js -- normalizationService\n *\n * 3+ monitor support is not added in the 17Q2\n * And only support same DPI for now, checkpoint tracking has not been adapted yet.\n */\n\nexport default function normalizationService() {\n   this._perMonitorMode = false;\n\n   this.clear = function() {\n      this._rawSetting = {};\n      this._normalizationModel = null;\n      this._normalizedSettings = {};\n      this._defaultModel = {};\n      this._agentDPI = 1.0;\n      this._DPIEnabled = true;\n   };\n   this.clear();\n\n   this.setAgentDPI = function(dpi) {\n      this._agentDPI = dpi;\n   };\n\n   /**\n    * To fully enable this, the segment mouse map is needed, which is simple but\n    * will not be done in 17q2 since we adapt the per system to reduce the\n    * chance of meeting bug 1847196 when using multimon.\n    */\n   this.setPerMonitor = function(usePerMonitor) {\n      this._perMonitorMode = !!usePerMonitor;\n   };\n\n   this.isPerMonitorMode = function() {\n      return this._perMonitorMode;\n   };\n\n   /**\n    * Returns the scale factor, which is depending the defination of \"High\n    * Resolution\" option\n    * Now using agent DPI scale, since the final design is so, and logic for\n    * single monitor also get changed accordingly.\n    */\n   this.getFactor = function(id) {\n      let baseDPI = this._rawSetting['0'].devicePixelRatio,\n         monitorDPI = this._rawSetting[id].devicePixelRatio,\n         compensateFactor = this._perMonitorMode ? 1 : monitorDPI / baseDPI,\n         clientFactor = this._DPIEnabled ? compensateFactor : monitorDPI;\n\n      return clientFactor * this._agentDPI;\n   };\n\n   /**\n    * To indicate whether the DPI Sync is enabled or not, and DPI sync here is\n    * defined as \"using client DPI scale if enabled, use native pixel if not\".\n    * @param {boolean} enabled\n    */\n   this.setDPISync = function(enabled) {\n      this._DPIEnabled = enabled;\n   };\n\n   /**\n    * Returns the param to normalize target to refer\n    * @param  {object} target\n    * @param  {object} refer\n    * @param  {object} k\n    * @return {object}\n    */\n   this._getNormalizationParam = function(target, refer, k) {\n      let param = {\n         k: k,\n         tx: refer.x - k * target.x,\n         ty: refer.y - k * target.y\n      };\n      return param;\n   };\n\n   /**\n    * After 17Q2, if want to support different DPI, the segment model should be\n    * used.\n    * @param  {object} point The source point\n    * @param  {object} model The model\n    * @return {object} This returns the point in the model\n    */\n   this.normalize = function(point, model) {\n      if (!this._defaultModel) {\n         return point;\n      }\n      if (!model) {\n         model = this._defaultModel;\n      }\n      return {\n         x: Math.round(point.x * model.k + model.tx),\n         y: Math.round(point.y * model.k + model.ty)\n      };\n   };\n\n   /**\n    * revert the point back to normal using the identical model\n    * @param  {object} point\n    * @param  {object} model\n    * @return {object}\n    */\n   this.revert = function(point, model) {\n      if (!this._defaultModel) {\n         return point;\n      }\n      if (!model) {\n         model = this._defaultModel;\n      }\n      return {\n         x: Math.round((point.x - model.tx) / model.k),\n         y: Math.round((point.y - model.ty) / model.k)\n      };\n   };\n\n   /**\n    * Since we only support 2 monitors this function need no param, and will\n    * return the stable point compare with rawSetting[0]\n    *\n    * Using this way, we will have bug 1834512, but we will not fix it for 17Q2,\n    * Using the dragging detection before entering multimon can fix it, but need\n    *    new UI and workflow.\n    *\n    * Written in the readable way instead of with the simpliest logic.\n    *\n    * @return {object} The top or left point in the line segment of the sharing\n    *    Edge.\n    */\n   this._getStablePoint = function(id) {\n      let baseId = '0',\n         isLeft = this._rawSetting[id].x + this._rawSetting[id].width <=\n         this._rawSetting[baseId].x,\n         isRight = this._rawSetting[id].x >=\n         this._rawSetting[baseId].x + this._rawSetting[baseId].width,\n         isTop = this._rawSetting[id].y + this._rawSetting[id].height <=\n         this._rawSetting[baseId].y,\n         isDown = this._rawSetting[id].y >=\n         this._rawSetting[baseId].y + this._rawSetting[baseId].height;\n\n      if (isLeft) {\n         return {\n            x: this._rawSetting[baseId].x,\n            y: Math.max(this._rawSetting[baseId].y, this._rawSetting[id].y)\n         };\n      } else if (isTop) {\n         return {\n            x: Math.max(this._rawSetting[baseId].x, this._rawSetting[id].x),\n            y: this._rawSetting[baseId].y\n         };\n      } else if (isRight) {\n         return {\n            x: this._rawSetting[id].x,\n            y: Math.max(this._rawSetting[baseId].y, this._rawSetting[id].y)\n         };\n      } else {\n         return {\n            x: Math.max(this._rawSetting[baseId].x, this._rawSetting[id].x),\n            y: this._rawSetting[id].y\n         };\n      }\n   };\n\n   /**\n    * Generate the model\n    * In 17Q2 only enable 2 monitors, or a tree grow shall be used.\n    */\n   this._generateModel = function() {\n      let key;\n      this._normalizationModel = {};\n      this._normalizationModel['0'] = this._getNormalizationParam({\n         x: this._rawSetting['0'].x,\n         y: this._rawSetting['0'].y\n      }, {\n         x: 0,\n         y: 0\n      }, this.getFactor(0));\n\n      for (key in this._rawSetting) {\n         if (this._rawSetting.hasOwnProperty(key) && key !== \"0\") {\n            let stablePoint = this._getStablePoint(key);\n            this._normalizationModel[key] = this._getNormalizationParam(stablePoint,\n               this.normalize(stablePoint, this._normalizationModel['0']),\n               this.getFactor(Number(key)));\n         }\n      }\n   };\n\n   this._calculateNormalizedSetting = function() {\n      let key,\n         startPoint;\n\n      this._normalizedSettings = {};\n      for (key in this._rawSetting) {\n         if (this._rawSetting.hasOwnProperty(key) &&\n            this._normalizationModel.hasOwnProperty(key)) {\n            startPoint = this.normalize(this._rawSetting[key], this._normalizationModel[key]);\n            this._normalizedSettings[key] = {\n               x: startPoint.x,\n               y: startPoint.y,\n               width: Math.round(this._rawSetting[key].width * this.getFactor(key)),\n               height: Math.round(this._rawSetting[key].height * this.getFactor(key)),\n               isModified: this.getFactor(key) !== 1\n            };\n         }\n      }\n   };\n\n   /**\n    * Avoid bug 1860710, since width need to be even for RDSH.\n    */\n   this._clipSettings = function () {\n      let key;\n      for (key in this._normalizedSettings) {\n         if (this._normalizedSettings.hasOwnProperty(key)) {\n            if(this._normalizedSettings[key].x % 2 !== 0){\n               this._normalizedSettings[key].x --;\n               if(this._normalizedSettings[key].width % 2 !== 0){\n                  this._normalizedSettings[key].width ++;\n               }\n            } else {\n               if(this._normalizedSettings[key].width % 2 !== 0){\n                  this._normalizedSettings[key].width --;\n               }\n            }\n         }\n      }\n   };\n\n   this.setScreenModel = function(model) {\n      this._defaultModel = model;\n   };\n\n   /**\n    * Set the raw setting gathered from browser, currently only enable for chrome\n    * @param {number} id\n    * @param {object} setting\n    */\n   this.setRawSetting = function(id, setting) {\n      this._rawSetting[id] = setting;\n   };\n\n   /**\n    * Set the raw setting gathered from browser, currently only enable for chrome\n    * @param {number} id\n    * @param {object} setting\n    */\n   this.removeRawSetting = function(id) {\n      delete this._rawSetting[id];\n   };\n\n   /**\n    * Using the previous input data to calculate and derive the model and setting\n    */\n   this.calculate = function() {\n      this._generateModel();\n      this._calculateNormalizedSetting();\n      this._clipSettings();\n   };\n\n   /**\n    * Get the derived model\n    * @return {object}\n    */\n   this.getNormalizationModel = function() {\n      return this._normalizationModel;\n   };\n\n   /**\n    * Get the derived normalized settings\n    * @return {object}\n    */\n   this.getNormalizedSettings = function() {\n      return this._normalizedSettings;\n   };\n\n   this.getSizeFactor = function(id) {\n      return this._normalizationModel[id].k;\n   };\n\n   this.isScaleMismatched = function() {\n      if (!this._rawSetting['0'] ||\n         this._rawSetting['0'].devicePixelRatio === undefined) {\n         return false;\n      }\n\n      for (let key in this._rawSetting) {\n         if (key !== '0' && this._rawSetting.hasOwnProperty(key) &&\n            this._rawSetting['0'].devicePixelRatio !==\n            this._rawSetting[key].devicePixelRatio) {\n            return true;\n         }\n      }\n      return false;\n   };\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/common/normalization-service.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * render-cache-service.js -- renderCacheService\n *\n * Service to handle cache for rendering.\n */\n\nexport default function renderCacheService(bitBuffer) {\n   this.decodeToCacheEntry = -1;\n   this.updateCache = [];\n   this.updateCacheEntries = 0;\n   this.cacheOperationType = {\n      updateCacheOpInit: 0,\n      updateCacheOpBegin: 1,\n      updateCacheOpEnd: 2,\n      updateCacheOpReplay: 3\n   };\n\n   this.fail = function(message) {\n      console.error(message);\n      return false;\n   };\n\n   this.releaseImage = function(rect) {\n      if (!!rect.image) {\n         if (typeof rect.image.close === \"function\") {\n            rect.image.close();\n         }\n         delete rect.image;\n      }\n      if (!!rect.data) {\n         delete rect.data;\n      }\n   };\n   /*\n    *------------------------------------------------------------------------------\n    *\n    * _evictUpdateCacheEntry\n    *\n    *    Evict one entry from the update cache.  This is done in response\n    *    to the payload of the Begin opcode as well as the destination\n    *    slot of the Begin opcode.\n    *\n    * Results:\n    *    None.\n    *\n    *------------------------------------------------------------------------------\n    */\n\n   this._evictUpdateCacheEntry = function(slot) {\n\n      this.releaseImage(this.updateCache[slot]);\n\n      this.updateCache[slot] = {};\n      this.updateCache[slot].image = null;\n   };\n\n   /*\n    *----------------------------------------------------------------------------\n    *\n    * _executeUpdateCacheInit --\n    *\n    *      Handle the UPDATE_CACHE_OP_INIT subcommand.  This resets the\n    *      cache, evicting all entries and resets the cache sizes and\n    *      flags.  The sizes and flags must be a subset of those which\n    *      the client advertised in the capability packet.\n    *\n    * Results:\n    *      None.\n    *\n    * Side effects:\n    *      Resets update cache.\n    *\n    *----------------------------------------------------------------------------\n    */\n\n   this._executeUpdateCacheInit = function(rect) {\n      let i;\n\n      for (i = 0; i < this.updateCacheEntries; i++) {\n         this._evictUpdateCacheEntry(i);\n      }\n\n      this.updateCache = [];\n      this.updateCacheEntries = rect.updateCacheEntries;\n\n      for (i = 0; i < this.updateCacheEntries; i++) {\n         this.updateCache[i] = {};\n         this.updateCache[i].image = null;\n      }\n   };\n\n\n   /*\n    *----------------------------------------------------------------------------\n    *\n    * _updateCacheInsideBeginEnd --\n    *\n    *      Returns true if the decoder has received in the current\n    *      framebuffer update message a VNC_UPDATECACHE_OP_BEGIN message\n    *      but not yet received the corresponding OP_END.\n    *\n    * Side effects:\n    *      None.\n    *\n    *----------------------------------------------------------------------------\n    */\n\n   this._updateCacheInsideBeginEnd = function() {\n      return this.decodeToCacheEntry !== -1;\n   };\n\n\n   /*\n    *----------------------------------------------------------------------------\n    *\n    * _updateCacheInitialized --\n    *\n    *      Returns true if the decoder has been configured to have an\n    *      active UpdateCache and the cache size negotiation has\n    *      completed..\n    *\n    * Side effects:\n    *      None.\n    *\n    *----------------------------------------------------------------------------\n    */\n\n   this._updateCacheInitialized = function() {\n      return this.updateCacheEntries !== 0;\n   };\n\n\n   /*\n    *----------------------------------------------------------------------------\n    *\n    * _executeUpdateCacheBegin --\n    *\n    *      Handle the UPDATE_CACHE_OP_BEGIN subcommand.  Process the\n    *      message payload, which is a mask of cache entries to evict.\n    *      Evict any existing entry at the destination slot, and create a\n    *      new entry there.\n    *\n    * Results:\n    *      None.\n    *\n    * Side effects:\n    *      Evicts elements of the update cache.\n    *      Creates a new cache entry.\n    *\n    *----------------------------------------------------------------------------\n    */\n\n   this._executeUpdateCacheBegin = function(rect) {\n      let maskBitBuf,\n         maskState, maskCount,\n         i, j;\n\n      if (!this._updateCacheInitialized()) {\n         return false;\n      }\n\n      if (this._updateCacheInsideBeginEnd() ||\n         rect.slot >= this.updateCacheEntries) {\n         return this.fail(\"error: cache status wrong for cache begin\");\n      }\n\n      maskBitBuf = bitBuffer.newInstance(rect.data, rect.dataLength);\n      maskState = !maskBitBuf.readBits(1);\n      maskCount = 0;\n      j = 0;\n\n      do {\n         maskCount = maskBitBuf.readEliasGamma();\n         maskState = !maskState;\n\n         if (maskState) {\n            for (i = 0; i < maskCount && i < this.updateCacheEntries; i++) {\n               this._evictUpdateCacheEntry(i + j);\n            }\n         }\n\n         j += maskCount;\n      } while (j < this.updateCacheEntries && !maskBitBuf.overflow);\n\n\n      this.decodeToCacheEntry = rect.slot;\n      this._evictUpdateCacheEntry(rect.slot);\n\n      this.updateCache[this.decodeToCacheEntry].imageWidth = rect.width;\n      this.updateCache[this.decodeToCacheEntry].imageHeight = rect.height;\n      return true;\n   };\n\n\n   /*\n    *----------------------------------------------------------------------------\n    *\n    * _executeUpdateCacheEnd --\n    *\n    *      Handle the UPDATE_CACHE_OP_END subcommand.  Process the\n    *      message payload, which is a serialized bitmask of screen\n    *      regions to scatter the update image to.\n    *\n    * Results:\n    *      None.\n    *\n    * Side effects:\n    *      Draws to the canvas.\n    *\n    *----------------------------------------------------------------------------\n    */\n   this._executeUpdateCacheEnd = function(rect, offset) {\n      if (!this._updateCacheInitialized()) {\n         return false;\n      }\n      if (!this._updateCacheInsideBeginEnd()) {\n         return this.fail(\"error: cache status wrong for cache end\");\n      }\n      let update = this.updateCache[this.decodeToCacheEntry],\n         state, count,\n         dstx = 0,\n         dsty = 0,\n         dstw = Math.ceil(rect.width / 16),\n         dsth = Math.ceil(rect.height / 16),\n         srcx = 0,\n         srcy = 0,\n         srcw = update.imageWidth / 16,\n         srch = update.imageHeight / 16,\n         availwidth,\n         bitbuf,\n         targetPoint;\n\n      if (!this._updateCacheInitialized() ||\n         !this._updateCacheInsideBeginEnd() ||\n         rect.slot !== this.decodeToCacheEntry ||\n         rect.slot >= this.updateCacheEntries) {\n         return this.fail(\"error: requested cache slot invalid\");\n      }\n\n      update.encodedMaskRect = {\n         x: rect.x,\n         y: rect.y,\n         width: rect.width,\n         height: rect.height\n      };\n      update.mask = rect.data;\n      update.maskLength = rect.dataLength;\n\n      bitbuf = bitBuffer.newInstance(update.mask, update.maskLength);\n      state = !bitbuf.readBits(1);\n      count = 0;\n\n\n      do {\n         if (count === 0) {\n            count = bitbuf.readEliasGamma();\n            state = !state;\n         }\n\n         availwidth = Math.min(srcw - srcx, dstw - dstx);\n         availwidth = Math.min(availwidth, count);\n\n         if (state) {\n            targetPoint = this.vncDecoder._normalize({\n               x: rect.x + dstx * 16,\n               y: rect.y + dsty * 16\n            }, offset);\n            // Don't worry if we don't have a full 16-wide mcu at the\n            // screen edge.  The canvas will trim the drawImage\n            // coordinates for us.\n            //\n            this.vncDecoder._context.drawImage(update.image,\n               srcx * 16,\n               srcy * 16,\n               availwidth * 16, 16,\n               targetPoint.x,\n               targetPoint.y,\n               availwidth * 16, 16);\n\n            srcx += availwidth;\n            if (srcx === srcw) {\n               srcx = 0;\n               srcy++;\n            }\n         }\n\n         dstx += availwidth;\n         if (dstx === dstw) {\n            dstx = 0;\n            dsty++;\n         }\n\n         count -= availwidth;\n\n      } while (dsty < dsth && !bitbuf._overflow);\n\n      this.decodeToCacheEntry = -1;\n      return true;\n   };\n\n\n   /*\n    *----------------------------------------------------------------------------\n    *\n    * _executeUpdateCacheReplay --\n    *\n    *      Handle the UPDATE_CACHE_OP_REPLAY subcommand.  Process the\n    *      message payload, which is a serialized mask used to subset the\n    *      bitmask provided at the time the cache entry being replayed\n    *      was created.  Scatters the specified subset of the cached\n    *      image to the canvas.\n    *\n    * Results:\n    *      None.\n    *\n    * Side effects:\n    *      Draws to the canvas.\n    *\n    *----------------------------------------------------------------------------\n    */\n\n   this._executeUpdateCacheReplay = function(rect, offset) {\n      if (!this._updateCacheInitialized()) {\n         return false;\n      }\n\n      if (rect.slot >= this.updateCacheEntries) {\n         return this.fail(\"error: requested cache slot invalid\");\n      }\n\n      if (!this.updateCache[rect.slot] ||\n         !this.updateCache[rect.slot].encodedMaskRect) {\n         return this.fail(\"error: requested cache slot data invalid\");\n      }\n\n      let update = this.updateCache[rect.slot],\n         encodedMaskRect = this.updateCache[rect.slot].encodedMaskRect,\n         dstx = 0,\n         dsty = 0,\n         dstw = Math.ceil(encodedMaskRect.width / 16),\n         dsth = Math.ceil(encodedMaskRect.height / 16),\n         availwidth,\n         srcx = 0,\n         srcy = 0,\n         srcw = update.imageWidth / 16,\n         srch = update.imageHeight / 16,\n         targetPoint,\n         maskBitBuf = bitBuffer.newInstance(rect.data, rect.dataLength),\n         updateBitBuf = bitBuffer.newInstance(update.mask, update.maskLength),\n         updateState = !updateBitBuf.readBits(1),\n         updateCount = 0,\n         maskState = !maskBitBuf.readBits(1),\n         maskCount = 0;\n\n      if (!this._updateCacheInitialized() ||\n         this._updateCacheInsideBeginEnd() ||\n         rect.slot >= this.updateCacheEntries) {\n         return this.fail(\"\");\n      }\n\n      do {\n         if (updateCount === 0) {\n            updateCount = updateBitBuf.readEliasGamma();\n            updateState = !updateState;\n         }\n         if (maskCount === 0) {\n            maskCount = maskBitBuf.readEliasGamma();\n            maskState = !maskState;\n         }\n\n         availwidth = dstw - dstx;\n         availwidth = Math.min(availwidth, updateCount);\n\n         if (updateState) {\n            availwidth = Math.min(availwidth, srcw - srcx);\n            availwidth = Math.min(availwidth, maskCount);\n\n            if (maskState) {\n               targetPoint = this.vncDecoder._normalize({\n                  x: encodedMaskRect.x + dstx * 16,\n                  y: encodedMaskRect.y + dsty * 16\n               }, offset);\n               // Don't worry if the right/bottom blocks are not\n               // 16-pixel, the canvas will trim the drawImage dimesions\n               // for us.\n               if (true) {\n                  this.vncDecoder._context.drawImage(update.image,\n                     srcx * 16,\n                     srcy * 16,\n                     availwidth * 16, 16,\n                     targetPoint.x,\n                     targetPoint.y,\n                     availwidth * 16, 16);\n\n               }\n\n               if (false) {\n                  this._lighten(targetPoint.x,\n                     targetPoint.y,\n                     availwidth * 16, 16,\n                     \"red\");\n               }\n            }\n\n            srcx += availwidth;\n            if (srcx === srcw) {\n               srcx = 0;\n               srcy++;\n            }\n\n            maskCount -= availwidth;\n         }\n\n         dstx += availwidth;\n         if (dstx === dstw) {\n            dstx = 0;\n            dsty++;\n         }\n\n         updateCount -= availwidth;\n\n      } while (dsty < dsth &&\n      !maskBitBuf._overflow &&\n      !updateBitBuf._overflow);\n      return true;\n   };\n\n   this._lighten = function(x, y, w, h, color) {\n      this.vncDecoder._context.globalCompositeOperation = \"lighten\";\n      this.vncDecoder._context.fillStyle = color;\n      this.vncDecoder._context.fillRect(x, y, w, h);\n      this.vncDecoder._context.globalCompositeOperation = \"source-over\";\n   };\n\n   /*\n    *------------------------------------------------------------------------------\n    *\n    * _executeUpdateCacheReplay\n    *\n    *    Dispatch the updateCache commands according to their opcode.\n    *    data is in various length as maskLength\n    *\n    * Results:\n    *    None.\n    *\n    * Side Effects:\n    *    None.\n    *\n    *------------------------------------------------------------------------------\n    */\n\n   this.operateOnCache = function(rect, offset) {\n      switch (rect.opcode) {\n         case this.cacheOperationType.updateCacheOpInit:\n            this._executeUpdateCacheInit(rect);\n            break;\n         case this.cacheOperationType.updateCacheOpBegin:\n            this._executeUpdateCacheBegin(rect);\n            break;\n         case this.cacheOperationType.updateCacheOpEnd:\n            this._executeUpdateCacheEnd(rect, offset);\n            break;\n         case this.cacheOperationType.updateCacheOpReplay:\n            this._executeUpdateCacheReplay(rect, offset);\n            break;\n         default:\n            return this.fail(\"error: requested cache opcode invalid\");\n      }\n   };\n   this.setImage = function(rect) {\n      this.updateCache[this.decodeToCacheEntry].image = rect.image;\n   };\n   this.setVncDecoder = function(decoder) {\n      this.vncDecoder = decoder;\n   };\n   this.decodingCache = function() {\n      return this.decodeToCacheEntry !== -1;\n   };\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/common/render-cache-service.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * vnc-decoder.js -- vncDecoder\n *\n * Service to get a VNC decoder\n * This file is needed since we want to fix bug 1797231 and unblock the release\n * of multimon feature, so the changes that should be done in 17Q2 after\n * completing the split of the vnc decoder from the wmks is move in 17Q1, thus\n * this file is incompleted and reduandant with the one in the wmks.\n *\n * In another words, the one in wmks will work for single monitor as before,\n * while this one will work for multimon, and we plan to merger them later.\n *\n * And why this can fix the crash issue is for we pass the non-rendered VNC messages\n * around instead of the whole screen image, which save a lot of memory alloc\n * and free.\n */\n\nexport default function vncDecoder(normalizationService, renderCacheService) {\n   this._canvas = null;\n   this._context = null;\n   this.encodingTypes = {\n      encCopyRect: 0x01,\n      encTightPNG: -260,\n      encUpdateCache: 127 + 0x574d5600,\n      //sub encodings\n      subEncFill: 0x80\n   };\n\n   this._screenBase = {\n      x: 0,\n      y: 0\n   };\n\n   /**\n    * Chrome on some windows machine has bug, e.g. the screenX, screenY on the\n    * problem machine return 3844, 1924 after using fullscreen, while the true\n    * value on the system setting is 3840 and 1920\n    * use Math.min(screen.availLeft, screeX) to bypass come this bug according\n    * to spec:\n    * https://drafts.csswg.org/cssom-view/#dom-window-screenx\n    */\n   this.initScreen = function() {\n      if (screen.availLeft !== undefined && screen.availTop !== undefined) {\n         this._screenBase = normalizationService.normalize({\n            x: Math.min(screenX, screen.availLeft),\n            y: Math.min(screenY, screen.availTop)\n         });\n      } else {\n         this._screenBase = normalizationService.normalize({\n            x: screenX,\n            y: screenY\n         });\n      }\n   };\n\n   this._normalize = function(p, offset) {\n      return {\n         x: p.x - offset.x - this._screenBase.x,\n         y: p.y - offset.y - this._screenBase.y\n      };\n   };\n\n   this._copyRectBlit = function(srcX, srcY, width, height, dstX, dstY) {\n      this._backgroundContext.drawImage(this._canvas,\n         srcX, srcY,\n         width, height,\n         srcX, srcY,\n         width, height);\n      this._context.drawImage(this._backgroundCanvas,\n         srcX, srcY,\n         width, height,\n         dstX, dstY,\n         width, height);\n   };\n\n   this._fillRectWithColor = function(x, y, width, height, color) {\n      let newStyle,\n         canvas2dCtx = this._context;\n      newStyle = \"rgb(\" + color[0] + \",\" + color[1] + \",\" + color[2] + \")\";\n      canvas2dCtx.fillStyle = newStyle;\n      canvas2dCtx.fillRect(x, y, width, height);\n   };\n\n   this._renderImage = function(rect, offset) {\n      var p = this._normalize({\n         x: rect.x,\n         y: rect.y\n      }, offset);\n      try {\n         this._context.drawImage(rect.image,\n            p.x,\n            p.y);\n      } catch (e) {\n         console.error(e);\n      }\n   };\n\n   this.setCanvas = function(canvas) {\n      let size = {\n         width: canvas.width,\n         height: canvas.height\n      };\n      this._canvas = canvas;\n      this._context = this._canvas.getContext('2d');\n      if (!!this._backgroundCanvasObject) {\n         this._backgroundCanvasObject.remove();\n      }\n      this._backgroundCanvasObject = $('<canvas/>').css({\n         position: 'absolute'\n      });\n      this._backgroundCanvasObject.attr(size).css(size);\n      this._backgroundCanvas = this._backgroundCanvasObject[0];\n      this._backgroundContext = this._backgroundCanvas.getContext('2d');\n      renderCacheService.setVncDecoder(this);\n   };\n\n   this.onDPIChanged = function(canvas) {\n      var size = {\n         width: canvas.width,\n         height: canvas.height\n      };\n      this._backgroundCanvasObject.attr(size);\n   };\n\n   /**\n    * The function to render a rect, which include a special one as End of Frame\n    *    indicate the end of async rendering is done.\n    * @param  {object} rect The object including data\n    * @param  {object} offset The screen offset information\n    * @param  {function} onRenderDone The callback for finish rendering, accept no param\n    */\n   this.render = function(rect, offset, onRenderDone) {\n      var pSrc,\n         p;\n      switch (rect.encoding) {\n         case this.encodingTypes.encCopyRect:\n            pSrc = this._normalize({\n               x: rect.srcX,\n               y: rect.srcY\n            }, offset);\n            p = this._normalize({\n               x: rect.x,\n               y: rect.y\n            }, offset);\n            this._copyRectBlit(pSrc.x,\n               pSrc.y,\n               rect.width,\n               rect.height,\n               p.x,\n               p.y);\n            break;\n         case this.encodingTypes.encTightPNG:\n            if (rect.subEncoding === this.encodingTypes.subEncFill) {\n               p = this._normalize({\n                  x: rect.x,\n                  y: rect.y\n               }, offset);\n               this._fillRectWithColor(p.x,\n                  p.y,\n                  rect.width,\n                  rect.height,\n                  rect.color);\n            } else if (renderCacheService.decodingCache()) {\n               renderCacheService.setImage(rect, offset);\n            } else {\n               this._renderImage(rect, offset);\n               this.releaseRectData(rect);\n            }\n            break;\n         case this.encodingTypes.encUpdateCache:\n            renderCacheService.operateOnCache(rect, offset);\n            break;\n         default:\n            /**\n             * can't use Logger since the commen Logger service is still not\n             * completed after page merging\n             */\n            console.error(\"unsupported encoding type found for multimon\");\n            break;\n      }\n\n      /**\n       * similar timeout also exist in wmks to allow canvas to render, and\n       * here it's mainly for GC\n       */\n      setTimeout(onRenderDone, 1);\n   };\n\n   this.releaseRectData = renderCacheService.releaseImage;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/common/vnc-decoder.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * wmks-base-service.js -- wmksBaseService\n *\n * This hold the getEventPosition function, which currently not support retina,\n * later would add more logic and function in.\n */\n\nexport default function wmksBaseService($window, normalizationService) {\n   this.getEventPosition = function(event, offset) {\n      let docX, docY,\n         defaultPosition = {\n            x: 0,\n            y: 0\n         },\n         normalizedPosition;\n\n      if (!offset || !event) {\n         return defaultPosition;\n      }\n      if (event.pageX || event.pageY) {\n         docX = event.pageX;\n         docY = event.pageY;\n      } else if (event.clientX || event.clientY) {\n         docX = (event.clientX +\n            document.body.scrollLeft +\n            document.documentElement.scrollLeft);\n         docY = (event.clientY +\n            document.body.scrollTop +\n            document.documentElement.scrollTop);\n      } else {\n         return defaultPosition;\n      }\n      normalizedPosition = normalizationService.normalize({\n         x: docX + screenX,\n         y: docY + screenY\n      });\n      return {\n         x: normalizedPosition.x + offset.x,\n         y: normalizedPosition.y + offset.y\n      };\n   };\n   /**\n    * Add this workaround check to avoid a bug happens by chance of\n    * wrong screenX, where the offset is added with a extra number,\n    * and the availLeft is correct when this bug happens without the\n    * positive extra offset. so when screen.availLeft exist, use min\n    * of both should fix it.\n    *\n    * On the spec, the screenX should never be smaller than the\n    * screen.availLeft, please refer the definition in:\n    * https://drafts.csswg.org/cssom-view/#dom-window-screenx\n    * as \"The screenX attribute must return the x-coordinate of the position\n    * where the event occurred relative to the origin of the Web-exposed\n    * screen area.\"\n    * And after entering fullscreen, they should be equal to each other, if\n    * the browser don't count the windows/Mac OS bar in.\n    */\n   this.getScreenSetting = function() {\n      let offsetX,\n         offsetY;\n\n      if (!screen || screenX === undefined || screenY === undefined) {\n         return {\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0,\n            devicePixelRatio: window.devicePixelRatio || 1\n         };\n      }\n      if (screen.availLeft !== undefined) {\n         offsetX = Math.min(screenX, screen.availLeft);\n      } else {\n         offsetX = screenX;\n      }\n      if (screen.availTop !== undefined) {\n         offsetY = Math.min(screenY, screen.availTop);\n      } else {\n         offsetY = screenY;\n      }\n\n      return {\n         x: offsetX,\n         y: offsetY,\n         width: screen.width,\n         height: screen.height,\n         devicePixelRatio: window.devicePixelRatio || 1\n      };\n   };\n\n   /**\n    * whether should prevent default\n    * @param {object} event\n    */\n   this.shouldPreventDefault = function(event) {\n      if (!event) {\n         return false;\n      }\n      let specialKeys = [\"meta\", \"ctrl\", \"alt\", \"shift\"];\n      let hasSpecialKey = false;\n      specialKeys.forEach((keyName) => {\n         if (event[keyName + \"Key\"]) {\n            hasSpecialKey = true;\n         }\n      });\n      /**\n       * 65 is A, 90 is Z, add this condition for avoiding bug 1821196\n       */\n      return !(!!event.key && event.key.length === 1 &&\n            event.key.charCodeAt(0) >= 65 && event.key.charCodeAt(0) <= 90) ||\n          hasSpecialKey;\n   };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/common/wmks-base-service.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * doLogoutHandler.js --\n *\n *      Implementation of the message handler to do logout.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\n\n\nexport default function DoLogoutHandler() {\n   let router,\n      // the handler has been initialized in getItemsControler\n      setPrefHandler = globalArray[\"set-user-global-preferences\"];\n\n   // member variables below\n   this.messageName = \"do-logout\";\n   this.messageText = \"do-logout\";\n   this.responseTag = \"logout\";\n   this.needClearURIFlag = false;\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n   }\n   // the composedHandlerList needs to keep this order, which is to let set\n   // preference before log out.  Otherwise, it pops the un-authenticated\n   // error.\n   this.composedHandlerList = [setPrefHandler, this];\n}\n\n// inherits MessageHandler prototype\nDoLogoutHandler.prototype = new MessageHandler();\n// constructor\nDoLogoutHandler.constructor = DoLogoutHandler;\n\nDoLogoutHandler.prototype.setNeedClearURIFlag = function() {\n   this.needClearURIFlag = true;\n};\n/**\n * parse configuration information from the response XML of GetConfiguration\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return Object. key-value pairs parsed from response, if error then return\n *    null\n */\nDoLogoutHandler.prototype.parseResult = function(responseXML) {\n   let logoutResponse = {},\n      xmlDoc = $(responseXML),\n      brokerTag,\n      responses,\n      result;\n\n   brokerTag = $(xmlDoc.children()[0]);\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of doLogoutHandler error\");\n      return null;\n   }\n\n   responses = brokerTag.children(this.responseTag);\n   result = responses.children(\"result\").text();\n   util.addItemForJson(logoutResponse, \"result\", result);\n   return logoutResponse;\n};\n\nDoLogoutHandler.prototype.onUpdated = function() {\n   let logoutAction = {\n         name: \"Logout\"\n      },\n      router = util.getObject(globalArray, \"router\"),\n      urlHandler;\n\n   MessageHandler.prototype.onUpdated.apply(this);\n   /**\n    * For doLogout message, the possible error is NOT_AUTHENTICATED. But if\n    * user wants to logout from the broker, the NOT_AUTHENTICATED error can\n    * be treated as successful too. So set the state to DONE even there is an\n    * error occurs for doLogout message.\n    */\n   this.setState(StateEnum.DONE);\n   if (this.needClearURIFlag) {\n      //just for the first time after setting this flag.(user URI only take\n      // affect for once)\n      this.needClearURIFlag = false;\n      // delete urlHandler referece from globalArray.\n      urlHandler = util.getObject(globalArray, \"url-handler\");\n      if (!!urlHandler) {\n         globalArray[\"url-handler\"] = null;\n      }\n   }\n   JSCDKSetUI(JSON.stringify(logoutAction));\n   if (router) {\n      router.setDoLogout();\n      JSCDKLogger.info(\"Logout completed.\");\n   }\n   if (!!(this.content[\"parsedResult\"]) &&\n      this.content[\"parsedResult\"][\"result\"] === \"ok\") {\n      JSCDKLogger.debug(\"Logout result is OK.\");\n   } else {\n      JSCDKLogger.error(\"Logout failed.\");\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/doLogoutHandler.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getAuthenticationStatusHandler.js --\n *\n *      Implementation of the message handler to send getAuthenticationStatus.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport {prepareForAlreadyAuthenticated} from '../timer/timer-util';\n\n\nexport default function GetAuthenticationStatusHandler() {\n   // member variables below\n   this.messageName = \"get-authentication-status\";\n   this.messageText = \"get-authentication-status\";\n   this.responseTag = \"authentication-status\";\n\n   // register dependencies here\n   let router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n   this.needCallbackFlag = false;\n   this.workForSilentModeFlag = false;\n   this.requestXML = \"\";\n}\n\n// inherits MessageHandler prototype\nGetAuthenticationStatusHandler.prototype = new MessageHandler();\nGetAuthenticationStatusHandler.constructor = GetAuthenticationStatusHandler;\n\n\nGetAuthenticationStatusHandler.prototype.setWorkForSilentModeFlag = function() {\n   this.workForSilentModeFlag = true;\n};\n\nGetAuthenticationStatusHandler.prototype.setRequestXML =\n   function(needCallback) {\n      if (needCallback === true) {\n         this.needCallbackFlag = true;\n      } else if (needCallback === false) {\n         this.needCallbackFlag = false;\n      } else {\n         JSCDKLogger.debug(\"error: needCallback should be of bool type\");\n         this.needCallbackFlag = false;\n         return;\n      }\n   };\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nGetAuthenticationStatusHandler.prototype.onUpdated = function() {\n   let response = this.content[\"parsedResult\"],\n      userActiveTimeSyncCtrl,\n      router = util.getObject(globalArray, \"router\");\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (this.state === StateEnum.DONE) {\n      //deal with ok response according to callback type\n      JSCDKLogger.debug('get authentication status succeeds.');\n      if (!this.needCallbackFlag && !this.workForSilentModeFlag) {\n         JSCDKLogger.log(\n            \"deal with getAuthenticationStatus response with normal process\");\n         this.dealWithAuthenticationStatusXML(response);\n      } else if (this.needCallbackFlag) {\n         //use timer controller to deal with response\n         userActiveTimeSyncCtrl =\n            util.getObject(globalArray, \"get-broker-sso-time-ctrl\");\n         if (!!userActiveTimeSyncCtrl) {\n            userActiveTimeSyncCtrl.dealWithAuthenticationStatusXML(response);\n         } else {\n            JSCDKLogger.error(\n               \"find userActiveTimeSyncCtrl undefined when getAuthenticationStatus.needCallbackFlag is set\");\n         }\n      } else {// this.workForSilentModeFlag === true\n         this.workForSilentModeFlag = false;\n         JSCDKLogger.log(\n            \"deal with getAuthenticationStatus response before act in desktop-select page\");\n         this.returnAuthenticationStatus(response);\n      }\n   }\n\n   //push error to handle old version broker, and deal with not authed error\n   // case\n   router.pushErrorToUser(this);\n};\n\nGetAuthenticationStatusHandler.prototype.returnAuthenticationStatus =\n   function(response) {\n      let authStatusAction;\n\n      if (response.sso === \"unlocked\") {\n         authStatusAction = {name: \"AuthenticationStatusUnlocked\"};\n      } else {\n         // cann't reuse name: DoLock cause the dialog should not jump out in\n         // silent mode.\n         authStatusAction = {name: \"AuthenticationStatusLocked\"};\n      }\n      JSCDKSetUI(JSON.stringify(authStatusAction));\n   };\n\n/* normal deal with AuthenticationStatusXML\n *\n * should only be used when init page\n */\nGetAuthenticationStatusHandler.prototype.dealWithAuthenticationStatusXML =\n   function(response) {\n      let authStatusAction,\n         idleTimeoutTimerController = util.getObject(globalArray,\n            \"idle-timeout-timer\");\n\n      if (response.sso === \"unlocked\") {\n         //prepare for already authentication case\n         prepareForAlreadyAuthenticated();\n         //already authenticated, send to UI to read timer info back from\n         // cookie or session storage\n         authStatusAction = {name: \"SessionUnlocked\"};\n         JSCDKSetUI(JSON.stringify(authStatusAction));\n      } else {\n         authStatusAction = {name: \"LockedNewTab\"};\n         JSCDKSetUI(JSON.stringify(authStatusAction));\n      }\n   };\n/**\n * parse locale information from the response XML of GetAuthenticationStatus\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\nGetAuthenticationStatusHandler.prototype.parseResult = function(responseXML) {\n   let responseBody,\n      brokerTag,\n      brokerElem,\n      responses,\n      resultText,\n      authStatusResponse = {},\n      ssoNode,\n      ssoText,\n      timeToSsoLockNode;\n\n   if (!responseXML || (responseXML === \"\")) {\n      return null;\n   }\n   responseBody = $(responseXML);\n   //broker version in XML response is stored for later usage\n   brokerElem = responseBody.find(\"broker\");//TOPolish: need to delete repeat\n                                            // code with brokerTag\n   globalArray[\"brokerVersion\"] = brokerElem.attr(\"version\");\n\n   //parse data\n   brokerTag = $(responseBody.children()[0]);\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of getAuthenticationStatus error\");\n      return null;\n   }\n   responses = brokerTag.children(this.responseTag);\n   resultText = responses.children(\"result\").text();\n   if (!!resultText && (resultText.trim() !== \"\")) {\n      authStatusResponse[\"result\"] = resultText;\n   } else {\n      JSCDKLogger.error(\n         \"response of getAuthenticationStatus error, no valid result tag\");\n      return null;\n   }\n   if (resultText === \"ok\") {\n      ssoNode = responses.children(\"sso\");\n      if (!ssoNode) {\n         JSCDKLogger.error(\n            \"response of getAuthenticationStatus error, no sso tag with result set ok\");\n         return null;\n      }\n      ssoText = $(ssoNode).text();\n      util.addItemForJson(authStatusResponse, \"sso\", ssoText);\n\n      if (ssoText === \"unlocked\") {\n         timeToSsoLockNode = responses.children(\"time-to-sso-lock\");\n         if (!timeToSsoLockNode) {\n            JSCDKLogger.error(\n               \"response of getAuthenticationStatus error, no time-to-sso-lock tag with sso set unlocked\");\n            return null;\n         }\n         util.addItemForJson(authStatusResponse, \"time-to-sso-lock\",\n            $(timeToSsoLockNode).text());\n      }\n   } else if (resultText === \"error\") {\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         util.addItemForJson(authStatusResponse, nameText, $(this).text());\n      });\n   }\n   return authStatusResponse;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/getAuthenticationStatusHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * resetDesktopHandler.js --\n *\n *      Implementation of the message handler to reset desktop.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport Router from './router';\n\n\nexport default function ResetDesktopHandler() {\n   let router;\n\n   // member variables below\n   this.messageName = \"reset-desktop\";\n   this.messageText = \"reset-desktop\";\n   this.responseTag = \"reset-desktop\";\n   this.composedHandlerList = [];\n   // requestId will increase when a new instance is created\n   // use prototype requestId to share in all instances\n   ResetDesktopHandler.prototype.requestId += 1;\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n   }\n}\n\n// inherits MessageHandler prototype\nResetDesktopHandler.prototype = new MessageHandler();\n// constructor\nResetDesktopHandler.constructor = ResetDesktopHandler;\n\n/**\n * parse information from the response XML of reset-desktop\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\nResetDesktopHandler.prototype.parseResult = function(responseXML) {\n   let responseBody = responseXML;\n   let brokerTag;\n   let responses;\n   let result;\n   let tokenText;\n   let resetDesktopResponse = {};\n   let xmlDoc;\n\n   xmlDoc = $(responseXML);\n   brokerTag = $(xmlDoc.children()[0]);\n   responses = brokerTag.children(this.responseTag);\n   result = responses.children(\"result\").text();\n   if (result === \"ok\" || result === \"error\") {\n      /*\n       * Add the \"ok\" and \"error\" response to the response JSON struct,\n       * because for the \"ok\" and \"error\" result, the response XML structure\n       * are the same, the following code can work in both cases.\n       */\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         util.addItemForJson(resetDesktopResponse, nameText, $(this).text());\n      });\n   }\n   return resetDesktopResponse;\n};\n\n/**\n * Set the request XML for reset-desktop\n * @param desktopId[in] desktop id to reset\n *\n */\nResetDesktopHandler.prototype.setRequestXML = function(desktopId) {\n   let desktopIdElem;\n   desktopIdElem = util.createElement(\"desktop-id\", desktopId);\n   this.requestXML = desktopIdElem;\n};\n\n/**\n * callback when received notification from handlers in dependency list or\n * router\n *\n */\nResetDesktopHandler.prototype.onUpdated = function() {\n   let resetDesktopAction;\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (this.state === StateEnum.DONE) {\n      if (!!(this.content[\"parsedResult\"]) &&\n         this.content[\"parsedResult\"][\"result\"] === \"ok\") {\n         JSCDKLogger.debug('Reset desktop succeeds.');\n\n         // Kill session succeeds\n         resetDesktopAction = {name: \"ResetDesktop\", result: \"ok\"};\n         JSCDKSetUI(JSON.stringify(resetDesktopAction));\n      }\n   }\n\n   // push error if it exists\n   Router.prototype.pushErrorToUser(this);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/resetDesktopHandler.js","/*** IMPORTS FROM imports-loader ***/\n(function() {\n\n(function() {\n\nfunction stringFromArray (data) {\n   var length = data.length,\n      tmp = new Array(Math.ceil(length / 8)),\n      i, j;\n\n   for (i = 0, j = 0; i < length; i += 8, j++) {\n      tmp[j] = String.fromCharCode(data[i],\n                                     data[i + 1],\n                                     data[i + 2],\n                                     data[i + 3],\n                                     data[i + 4],\n                                     data[i + 5],\n                                     data[i + 6],\n                                     data[i + 7]);\n   }\n\n   return tmp.join('').substr(0, length);\n};\n\n\nfunction arrayFromString (str, useUint8Array) {\n   var length = str.length,\n      array = useUint8Array ? new Uint8Array(length) : new Array(length),\n      i;\n\n   for (i = 0; i+7 < length; i += 8) {\n      array[i] = str.charCodeAt(i);\n      array[i + 1] = str.charCodeAt(i + 1);\n      array[i + 2] = str.charCodeAt(i + 2);\n      array[i + 3] = str.charCodeAt(i + 3);\n      array[i + 4] = str.charCodeAt(i + 4);\n      array[i + 5] = str.charCodeAt(i + 5);\n      array[i + 6] = str.charCodeAt(i + 6);\n      array[i + 7] = str.charCodeAt(i + 7);\n   }\n\n   for (; i < length; i++) {\n      array[i] = str.charCodeAt(i);\n   }\n\n   return array;\n};\n\n\nvar Base64 = {\ndecodeToArray: function (data, useUint8Array) {\n      return arrayFromString(window.atob(data), useUint8Array);\n   },\n\ndecodeToString: function (data) {\n      return window.atob(data);\n   },\n\nencodeFromArray: function (data) {\n      return window.btoa(stringFromArray(data));\n   },\n\nencodeFromString: function (data) {\n      return window.btoa(data);\n   }\n};\n\n/*\n *------------------------------------------------------------------------------\n *\n * wmks\\core.js\n *\n *    This file initializes the WMKS root namespace and some of the generic\n *    functionality is defined accordingly.\n *\n *    This contains the following:\n *    1. Global constants (WMKS.CONST)\n *       Specific constants go a level deeper. (Ex: WMKS.CONST.TOUCH, etc.)\n *    2. Generic utility / helper functions.\n *       a. WMKS.LOGGER:   Logging with different log levels.\n *       b. AB.BROWSER:    Detects various browser types and features.\n *       c. WMKS.UTIL:     Utility helper functions.\n *\n *    NOTE: Namespace should be upper case.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS = {};\n\n/**\n *------------------------------------------------------------------------------\n *\n * WMKS.LOGGER\n *\n *    The logging namespace that defines a log utility. It has:\n *    1. Five logging levels\n *    2. Generic log function that accepts a log level (defaults to LOG_LEVEL).\n *    3. Log level specific logging.\n *    4. Log only when requested log level is above or equal to LOG_LEVEL value.\n *    5. Dynamically set logging levels.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.LOGGER = new function() {\n   'use strict';\n\n   this.LEVEL = {\n      TRACE: 0,\n      DEBUG: 1,\n      INFO:  2,\n      WARN:  3,\n      ERROR: 4\n   };\n\n   // The default log level is set to INFO.\n   var _logLevel = this.LEVEL.INFO,\n       _logLevelDesc = [' [Trace] ', ' [Debug] ', ' [Info ] ', ' [Warn ] ', ' [Error] '];\n\n   // Logging functions for different log levels.\n   this.trace = function(args) { this.log(args, this.LEVEL.TRACE); };\n   this.debug = function(args) { this.log(args, this.LEVEL.DEBUG); };\n   this.info =  function(args) { this.log(args, this.LEVEL.INFO);  };\n   this.warn =  function(args) { this.log(args, this.LEVEL.WARN);  };\n   this.error = function(args) { this.log(args, this.LEVEL.ERROR); };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * log\n    *\n    *    The common log function that uses the default logging level.\n    *    Use this when you want to see this log at all logging levels.\n    *\n    *    IE does not like if (!console), so check for undefined explicitly.\n    *    Bug: 917027\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.log =\n      (typeof console === 'undefined' || typeof console.log === 'undefined')?\n         $.noop :\n         function(logData, level) {\n            level = (level === undefined)? this.LEVEL.INFO : level;\n            if (level >= _logLevel && logData) {\n               // ISO format has ms precision, but lacks IE9 support.\n               // Hence use UTC format for IE9.\n               console.log((WMKS.BROWSER.isIE()?\n                              new Date().toUTCString() : new Date().toISOString())\n                           + _logLevelDesc[level] + logData);\n            }\n         };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * setLogLevel\n    *\n    *    This public function is used to set the logging level. If the input is\n    *    invalid, then the default logging level is used.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.setLogLevel = function(newLevel) {\n      if (typeof newLevel === 'number' && newLevel >= 0 && newLevel < _logLevelDesc.length) {\n         _logLevel = newLevel;\n      } else {\n         this.log('Invalid input logLevel: ' + newLevel);\n      }\n   };\n};\n\n\n/**\n *------------------------------------------------------------------------------\n *\n * WMKS.BROWSER\n *\n *    This namespace object contains helper function to identify browser\n *    specific details such as isTouchDevice, isIOS, isAndroid, etc.\n *\n *    Browser version detection is available through the object \"version\" like\n *    so:\n  *    * WMKS.BROWSER.version.full (String)\n *      - Full version string of the browser.\n *        e.g For Chrome 35.6.1234 this would be \"35.6.1234\"\n *    * WMKS.BROWSER.version.major (Integer)\n *      - Major version of the browser.\n *        e.g For Chrome 35.6.1234 this would be 35\n *    * WMKS.BROWSER.version.minor (Integer)\n *      - Minor version of the browser.\n *        e.g For Chrome 35.6.1234 this would be 6\n *    * WMKS.BROWSER.version.float (Float)\n *      - Major and minor version of the browser as a float.\n *        e.g For Chrome 35.6.1234 this would be 35.6\n *------------------------------------------------------------------------------\n */\n\nWMKS.BROWSER = new function() {\n   var ua = navigator.userAgent.toLowerCase(),\n       vs = navigator.appVersion.toString(),\n       trueFunc = function() { return true; },\n       falseFunc = function() { return false; };\n\n   // In the wake of $.browser being deprecated, use the following:\n   this.isIE = (ua.indexOf('msie') !== -1 || ua.indexOf('trident') !== -1 || ua.indexOf('edge') !== -1)?\n                  trueFunc : falseFunc;\n\n   // Since Opera 30, Opera's UA is changed to \"OPR\".\n   this.isOpera = (ua.indexOf('opera/') !== -1 || ua.indexOf('opr/') !== -1)? trueFunc : falseFunc;\n   this.isWebkit = this.isChrome = this.isSafari = this.isBB = falseFunc;\n\n   // Check for webkit engine.\n   if (!this.isIE() && !this.isOpera() && ua.indexOf('applewebkit') !== -1) {\n      this.isWebkit = trueFunc;\n      // Webkit engine is used by chrome, safari and blackberry browsers.\n      if (ua.indexOf('chrome') !== -1) {\n         this.isChrome = trueFunc;\n      } else if (ua.indexOf('bb') !== -1) {\n         // Detect if its a BlackBerry browser or higher on OS BB10+\n         this.isBB = trueFunc;\n      } else if (ua.indexOf('safari') !== -1) {\n         this.isSafari = trueFunc;\n      }\n   }\n\n   // See: https://developer.mozilla.org/en/Gecko_user_agent_string_reference\n   // Also, Webkit/IE11 say they're 'like Gecko', so we get a false positive here.\n   this.isGecko = (!this.isWebkit() && !this.isIE() && ua.indexOf('gecko') !== -1)\n      ? trueFunc : falseFunc;\n\n   this.isFirefox = (ua.indexOf('firefox') !== -1 || ua.indexOf('iceweasel') !== -1)?\n                     trueFunc : falseFunc;\n\n   // Flag indicating low bandwidth, not screen size.\n   this.isLowBandwidth = (ua.indexOf('mobile') !== -1)? trueFunc : falseFunc;\n\n   // Detect specific mobile devices. These are *not* guaranteed to also set\n   // isLowBandwidth. Some however do when presenting over WiFi, etc.\n   this.isIOS = ((ua.indexOf('iphone') !== -1) || (ua.indexOf('ipod') !== -1) ||\n                 (ua.indexOf('ipad') !== -1))? trueFunc : falseFunc;\n\n   /* typically also sets isLinux */\n   this.isAndroid = (ua.indexOf('android') !== -1)? trueFunc : falseFunc;\n\n   // Detect IE mobile versions.\n   this.isIEMobile = (ua.indexOf('IEMobile') !== -1)? trueFunc : falseFunc;\n\n   // Flag indicating that touch feature exists. (Ex: includes Win8 touch laptops)\n   this.hasTouchInput = ('ontouchstart' in window\n                        || navigator.maxTouchPoints\n                        || navigator.msMaxTouchPoints)? trueFunc : falseFunc;\n\n   // TODO: Include windows/BB phone as touchDevice.\n   this.isTouchDevice = (this.isIOS() || this.isAndroid() || this.isBB())?\n                        trueFunc : falseFunc;\n\n   // PC OS detection.\n   this.isChromeOS = (ua.indexOf('cros') !== -1)? trueFunc : falseFunc;\n   this.isWindows = (ua.indexOf('windows') !== -1)? trueFunc : falseFunc;\n   this.isLinux = (ua.indexOf('linux') !== -1)? trueFunc : falseFunc;\n   this.isMacOS = (ua.indexOf('macos') !== -1 || ua.indexOf('macintosh') > -1)?\n                  trueFunc : falseFunc;\n\n   var getValue = function(regex, index) {\n      var match = ua.match(regex);\n      return (match && match.length > index && match[index]) || '';\n   };\n   this.version = { full : \"\" };\n   if(this.isSafari()){\n      this.version.full = getValue(/Version[ \\/]([0-9\\.]+)/i, 1);\n   } else if(this.isChrome()){\n      this.version.full = getValue(/Chrome\\/([0-9\\.]+)/i, 1);\n   } else if(this.isFirefox()){\n      this.version.full = getValue(/(?:Firefox|Iceweasel)[ \\/]([0-9\\.]+)/i, 1);\n   } else if(this.isOpera()){\n      this.version.full = getValue(/Version[ \\/]([0-9\\.]+)/i, 1) || getValue(/(?:opera|opr)[\\s\\/]([0-9\\.]+)/i, 1);\n   } else if(this.isIE()){\n      this.version.full = getValue(/(?:\\b(MS)?IE\\s+|\\bTrident\\/7\\.0;.*\\s+rv:|\\bEdge\\/)([0-9\\.]+)/i, 2);\n   }\n   var versionParts = this.version.full.split('.');\n\n   this.version.major = parseInt(versionParts.length > 0 ? versionParts[0] : 0, 10);\n   this.version.minor = parseInt(versionParts.length > 1 ? versionParts[1] : 0, 10);\n   this.version.float = parseFloat(this.version.full);\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * isCanvasSupported\n    *\n    *    Tests if the browser supports the use of <canvas> elements properly\n    *    with the ability to retrieve its draw context.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.isCanvasSupported = function() {\n      try {\n         var canvas = document.createElement('canvas');\n         var result = !!canvas.getContext; // convert to Boolean, invert again.\n         canvas = null; // was never added to DOM, don't need to remove\n         return result;\n      } catch(e) {\n         return false;\n      }\n   };\n\n};\n\n\n/**\n *------------------------------------------------------------------------------\n *\n * WMKS.CONST\n *\n *    Constant values under CONST namespace that's used across WMKS.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.CONST = {\n   // Touch events can use the following keycodes to mimic mouse events.\n   CLICK: {\n      left:       0x1,\n      middle:     0x2,\n      right:      0x4\n   },\n\n   FORCE_RAW_KEY_CODE: {\n      8:          true,    // backspace\n      9:          true,    // tab\n      13:         true     // newline\n   }\n};\n\n\n/**\n *------------------------------------------------------------------------------\n *\n * WMKS.UTIL\n *\n *    This namespace object contains common helper function.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.UTIL = {\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * createCanvas\n    *\n    *    This function creates a canvas element and adds the absolute\n    *    position css to it if the input flag is set.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   createCanvas: function(addAbsolutePosition) {\n      var css = {};\n      if (addAbsolutePosition) {\n         css.position = 'absolute';\n      }\n      return $('<canvas/>').css(css);\n   },\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * createVideo\n    *\n    *    This function creates a video element and adds the absolute\n    *    position css to it if the input flag is set.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   createVideo: function(addAbsolutePosition) {\n      var css = {};\n      if (addAbsolutePosition) {\n         css.position = 'absolute';\n      }\n      return $('<video/>').css(css);\n   },\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * getLineLength\n    *\n    *    Gets the length of the line that starts at (0, 0) and ends at\n    *    (dx, dy) and returns the floating point number.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   getLineLength: function(dx, dy) {\n      return Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));\n   },\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * isHighResolutionSupported\n    *\n    *    Indicates if high-resolution mode is available for this browser. Checks\n    *    for a higher devicePixelRatio on the browser.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   isHighResolutionSupported: function() {\n      return window.devicePixelRatio && window.devicePixelRatio > 1;\n   },\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * isFullscreenNow\n    *\n    *    Utility function to inform if the browser is in full-screen mode.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   isFullscreenNow: function() {\n      return document.fullscreenElement ||\n             document.mozFullScreenElement ||\n             document.msFullscreenElement ||\n             document.webkitFullscreenElement\n             ? true : false;\n   },\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * isFullscreenEnabled\n    *\n    *    Utility function that indicates if fullscreen feature is enabled on\n    *    this browser.\n    *\n    *    Fullscreen mode is disabled on Safari as it does not support keyboard\n    *    input in fullscreen for \"security reasons\". See bug 1296505.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   isFullscreenEnabled: function() {\n      return !WMKS.BROWSER.isSafari() &&\n             (document.fullscreenEnabled ||\n             document.mozFullScreenEnabled ||\n             document.msFullscreenEnabled ||\n             document.webkitFullscreenEnabled)\n             ? true : false;\n   },\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * toggleFullScreen\n    *\n    *    This function toggles the fullscreen mode for this browser if it is\n    *    supported. If not, it just ignores the request.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   toggleFullScreen: function(showFullscreen, element) {\n      var currentState = WMKS.UTIL.isFullscreenNow(),\n          ele = element || document.documentElement;\n\n      if (!WMKS.UTIL.isFullscreenEnabled()) {\n         WMKS.LOGGER.warn('This browser does not support fullScreen mode.');\n         return;\n      }\n      if (currentState === showFullscreen) {\n         // already in the desired state.\n         return;\n      }\n\n      // If currently in Fullscreen mode, turn it off.\n      if (currentState) {\n         if (document.exitFullscreen) {\n            document.exitFullscreen();\n         } else if (document.mozCancelFullScreen) {\n            document.mozCancelFullScreen();\n         } else if (document.webkitCancelFullScreen) {\n            document.webkitCancelFullScreen();\n         } else if(document.msExitFullscreen) {\n            document.msExitFullscreen();\n         }\n      } else {\n         // Flip to full-screen now.\n         if (ele.requestFullscreen) {\n            ele.requestFullscreen();\n         } else if (ele.mozRequestFullScreen) {\n            ele.mozRequestFullScreen();\n         } else if (ele.webkitRequestFullscreen) {\n            ele.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n         } else if (ele.msRequestFullscreen) {\n            ele.msRequestFullscreen();\n         }\n      }\n   }\n\n};\n\n/*\n *-----------------------------------------------------------------------------\n * wmks/bitbuf.js\n *\n *    This class implements decoding of variable-length-encoded\n *    integers from an array of bytes.\n *\n *-----------------------------------------------------------------------------\n */\n\n\n/*\n *----------------------------------------------------------------------------\n *\n * BitBuf --\n *\n *      Given a buffer of bytes and its size, initialize a BitBuf\n *      object for reading from or writing to that buffer.\n *\n * Results:\n *      The initialized bit buffer.\n *\n * Side effects:\n *      None.\n *\n *----------------------------------------------------------------------------\n */\n\nWMKS.BitBuf = function(buffer, size) {\n   \"use strict\";\n   this._buf = buffer;\n   this._size = size;\n   this._readCount = 0;\n   this._overflow = false;\n   this._thisByte = 0;\n   this._thisByteBits = 0;\n\n   return this;\n};\n\n\n/*\n *----------------------------------------------------------------------------\n *\n * BitBuf.readBits0 --\n *\n *      Helper for readBits() which reads a number of bits from the\n *      current active byte and returns them to the caller.\n *\n * Results:\n *      The bits requested.\n *\n * Side effects:\n *      Advances the buffer read offset by the specified number of bits.\n *\n *----------------------------------------------------------------------------\n */\n\nWMKS.BitBuf.prototype.readBits0 = function (val, nr) {\n   \"use strict\";\n   var mask;\n\n   if (this._bits < nr) {\n      this._overflow = true;\n      return -1;\n   }\n\n   mask = ~(0xff >> nr);        /* ones in the lower 'nr' bits */\n   val <<= nr;                  /* move output value up to make space */\n   val |= (this._thisByte & mask) >> (8-nr);\n   this._thisByte <<= nr;\n   this._thisByte &= 0xff;\n   this._thisByteBits -= nr;\n\n   return val;\n};\n\n\n/*\n *----------------------------------------------------------------------------\n *\n * BitBuf.readBits --\n *\n *      Read and return the specified number of bits from the BitBuf.\n *\n * Results:\n *      The value from the buffer.\n *\n * Side effects:\n *      Advances the buffer read offset by the specified number of bits.\n *\n *----------------------------------------------------------------------------\n */\n\nWMKS.BitBuf.prototype.readBits = function (nr) {\n   \"use strict\";\n   var origNr = nr;\n   var val = 0;\n\n   if (this._overflow) {\n      return 0;\n   }\n\n   while (nr > this._thisByteBits) {\n      nr -= this._thisByteBits;\n      val = this.readBits0(val, this._thisByteBits);\n\n      if (this._readCount < this._size) {\n         this._thisByte = this._buf[this._readCount++];\n         this._thisByteBits = 8;\n      } else {\n         this._thisByte = 0;\n         this._thisByteBits = 0;\n         if (nr > 0) {\n            this._overflow = true;\n            return 0;\n         }\n      }\n   }\n\n   val = this.readBits0(val, nr);\n   return val;\n};\n\n\n/*\n *----------------------------------------------------------------------------\n *\n * BitBuf.readEliasGamma --\n *\n *      Read an elias-gamma-encoded integer from the buffer.  The\n *      result will be greater than or equal to one, and is\n *      constrained to fit in a 32-bit integer.\n *\n * Results:\n *      None.\n *\n * Side effects:\n *      Advances the buffer read offset by the necessary number of bits.\n *\n *----------------------------------------------------------------------------\n */\n\nWMKS.BitBuf.prototype.readEliasGamma = function() {\n   \"use strict\";\n   var l = 0;\n   var value;\n   var bit;\n   var origidx = this._readCount;\n   var origbit = this._thisByteBits;\n\n   while (!this._overflow &&\n          (bit = this.readBits(1)) == 0) {\n      l++;\n   }\n\n   value = 1 << l;\n\n   if (l) {\n      value |= this.readBits(l);\n   }\n\n   return value;\n}\n\n/*\n * wmks/websocketInit.js\n *\n *   Contains a helper function to instantiate WebSocket object.\n *\n */\n\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * WMKSWebSocket\n *\n *    Create an alternate class that consumes WebSocket and provides a\n *    non-native code constructor we can use to stub out in Jasmine (a\n *    testing framework).\n *\n * Results:\n *    Newly constructed WebSocket.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.WebSocket = function(url, protocol) {\n   return new window.WebSocket(url, protocol);\n};\n\n/*\n * wmks/arrayPush.js\n *\n *   Convenience functions for building an array of bytes\n *   (for sending messages to servers or handling image formats).\n *\n */\n\n\nArray.prototype.push8 = function (aByte) {\n   this.push(aByte & 0xFF);\n};\n\n\nArray.prototype.push16 = function (aWord) {\n   this.push((aWord >> 8) & 0xFF,\n             (aWord     ) & 0xFF);\n};\n\n\nArray.prototype.push32 = function (aLongWord) {\n   this.push((aLongWord >> 24) & 0xFF,\n             (aLongWord >> 16) & 0xFF,\n             (aLongWord >>  8) & 0xFF,\n             (aLongWord      ) & 0xFF);\n};\n\n\nArray.prototype.push16le = function(aWord) {\n   this.push((aWord     ) & 0xff,\n             (aWord >> 8) & 0xff);\n};\n\n\nArray.prototype.push32le = function(aLongWord) {\n   this.push((aLongWord     ) & 0xff,\n             (aLongWord >> 8) & 0xff,\n             (aLongWord >> 16) & 0xff,\n             (aLongWord >> 24) & 0xff);\n};\n\n/*\n *------------------------------------------------------------------------------\n * wmks/ImageManagerWMKS.js\n *\n *    This class abstracts Image caching solution in an optimal way. It takes\n *    care of returning the image in a clean, and memory leak proof manner.\n *    It exposes 2 functions  to get and release images. The get function\n *    returns an Image object either from an unused cache or by creating a new one.\n *    The return function, depending on the max allowed cache size decides to\n *    either add the image to the cache or get rid of it completely.\n *\n *------------------------------------------------------------------------------\n */\n\nfunction ImageManagerWMKS(imageCacheSize) {\n  'use strict';\n   var _cacheSize = imageCacheSize;  // Max number of images cached.\n   var _cacheArray = [];             // Cache to hold images.\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _getImage\n    *\n    *    Pushes the current image to the cache if it is not full,\n    *    and then deletes the image.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   var _getImageFromCache = function() {\n      if (_cacheArray.length > 0) {\n         return _cacheArray.shift();\n      } else {\n         return new Image();\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _deleteImage\n    *\n    *    This private function takes an array containing a single image and\n    *    deletes the image. The reason for using an array containing the image\n    *    instead of 'delete image' call is to comply with javascript strict mode.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   var _deleteImage = function(imgArray) {\n      delete imgArray[0];\n      imgArray[0] = null;\n      imgArray = null;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _cacheImageOrDelete\n    *\n    *    Private function that resets event handlers if any. Sets src to an\n    *    empty image. Pushes the current image to the cache if it is not full,\n    *    else deletes the image.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   var _cacheImageOrDelete = function(image) {\n      // Reset onload and onerror event handlers if any.\n      image.onload = image.onerror = null;\n\n      /*\n       * Issues with webkit image caching:\n       * 1. Setting image.src to null is insufficient to turn off image caching\n       *    in chrome (webkit).\n       * 2. An empty string alone is not sufficient since browsers may treat\n       *    that as meaning the src is the current page (HTML!) which will\n       *    lead to a warning on the browsers javascript console.\n       * 3. If we set it to an actual string with an empty data URL, this helps\n       *    the first time, however when we try to decode the same image again\n       *    and again later on, the onload will not be called and we have a\n       *    problem.\n       * 4. If we set it to a data:image with invalid data some browsers\n       *    (such as IE11 or Edge) will spam the log with error messages.\n       * 5. So finally, we use the smallest valid 1x1 black gif and append a\n       *    timestamp to the data URL so that the browser treats it as a new\n       *    image every time. This keeps image cache consistent.\n       */\n      var tinyGif = [ 0x47, 0x49, 0x46, 0x38, 0x39, 0x61, 0x01, 0x00,\n                      0x01, 0x00, 0x00, 0xFF, 0x00, 0x2C, 0x00, 0x00,\n                      0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x02,\n                      0x00, 0x3B ];\n      tinyGif.push32($.now());\n      image.src = \"data:image/gif;base64,\" + Base64.encodeFromArray(tinyGif);\n\n      if (_cacheArray.length <= _cacheSize) {\n         _cacheArray.push(image);\n      } else {\n         // Image deleting in strict mode causes error. Hence the roundabout way.\n         _deleteImage([image]);\n      }\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * getImage\n    *\n    *    Public function that invokes a private function _getImageFromCache()\n    *    to get an image.\n    *\n    *---------------------------------------------------------------------------\n    */\n   this.getImage = function() {\n      return _getImageFromCache();\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * releaseImage\n    *\n    *    Public function that invokes a private function _cacheImageOrDelete()\n    *    to add the image to a cache when the cache is not full or delete the\n    *    image.\n    *\n    *---------------------------------------------------------------------------\n    */\n   this.releaseImage = function(image) {\n      if (!image) {\n         return;\n      }\n      _cacheImageOrDelete(image);\n   };\n};\n/*********************************************************\n * Copyright (C) 2015 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/*\n * wmks/mp4Decoder.js\n *\n *   WebMKS MP4 decoder prototype.\n *\n */\n\nfunction MP4Decoder() {\n   this._mediaSource = null;\n   this._sourceBuffer = null;\n   this._tempQueue = [];\n   this._mediaPlayer = null;\n   this._isError = false;\n   this._isErrorDoneCalled = false;\n   this._sendRequest= 0;\n   this._doneRequest= 0;\n   this._decodeDoneCb = null;\n   this._decodeErrorCb = null;\n   MP4Decoder.instanceNumber++;\n   this._name = \"MP4Decoder\" + MP4Decoder.instanceNumber;\n};\n\nMP4Decoder.instanceNumber = 0;\nMP4Decoder.byteStreamFormat = 'video/mp4; codecs=\"avc1.640030\"';\n\nMP4Decoder.prototype.toString = function() {\n   return this._name;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _init\n *\n *    Generate a Media Source object and associate it with video DOM element.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nMP4Decoder.prototype.init = function(mediaPlayer, urlObject, mediaSourceObject,\n                                     decodeDoneCb, decodeErrorCb) {\n   var self = this,\n       URL = urlObject || window.URL || window.webkitURL,\n       MediaSource = mediaSourceObject || window.MediaSource || window.WebKitMediaSource;\n\n   this.reset();\n\n   this._decodeDoneCb = decodeDoneCb;\n   this._decodeErrorCb = decodeErrorCb;\n   this._mediaPlayer = mediaPlayer;\n   this._mediaSource = new MediaSource();\n   // Attach a media source object to HTMLMediaElement.\n   this._mediaPlayer.src = URL.createObjectURL(this._mediaSource);\n   this._mediaSource.addEventListener('sourceopen',\n   function(e) {\n      return self._onMediaSourceOpen(e);\n   }, false);\n   this._mediaSource.addEventListener('webkitsourceopen',\n   function(e) {\n      return self._onMediaSourceOpen(e);\n   }, false);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _onMediaSourceOpen\n *\n *       After media source is open, create a source buffer with MP4 decoder and\n *    attach it to media source object. If there is any MP4 data in the buffer,\n *    add it to source buffer so that media source can play it.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nMP4Decoder.prototype._onMediaSourceOpen = function (e) {\n   var self = this;\n\n   WMKS.LOGGER.log(this + \" media source status is changed to open.\");\n\n   if (this._mediaSource.readyState !== \"open\") {\n      WMKS.LOGGER.log(this + \" media source is not open yet.\");\n      return;\n   }\n\n   this._sourceBuffer = this._mediaSource.addSourceBuffer(\n      MP4Decoder.byteStreamFormat);\n\n   /*\n    * Listen to update event. It will fire after current buffer data is\n    * handled by media source object.\n    */\n   this._sourceBuffer.addEventListener('updateend', function () {\n      if (self._tempQueue.length === 0) {\n         return;\n      }\n\n      if (self._tempQueue[0].method === \"add\" && self._decodeDoneCb) {\n         self._doneRequest++;\n         WMKS.LOGGER.debug(self + \" request track: send \" + self._sendRequest +\n                           \" done \" + self._doneRequest);\n         self._decodeDoneCb();\n      }\n\n      self._tempQueue.shift();\n      self._flushPayloads();\n   });\n\n   this._sourceBuffer.addEventListener('error', function(e) {\n      WMKS.LOGGER.error(self + \" error code is \" + e);\n   });\n   // If we receive any MP4 during MediaSource initialization process, decode it now.\n   this._flushPayloads();\n   return;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _flushPayloads\n *\n *    Append all the data in our temp buffer to sourceBuffer object.\n *\n * Side Effects:\n *    Display MP4 video.\n *\n *------------------------------------------------------------------------------\n */\n\nMP4Decoder.prototype._flushPayloads = function () {\n   var bufferStart = 0,\n       bufferEnd = 0,\n       removeEnd = 0;\n   if (!this._sourceBuffer) {\n      WMKS.LOGGER.log(this + \"source buffer is not ready yet.\");\n      return;\n   }\n\n   if (this._tempQueue.length === 0) {\n      return;\n   }\n\n   if (this._mediaSource.readyState === \"open\" &&\n       !this._sourceBuffer.updating) {\n      try {\n         if (this._tempQueue[0].method === \"add\") {\n            this._sourceBuffer.appendBuffer(this._tempQueue[0].payload);\n         } else if (this._tempQueue[0].method === \"remove\") {\n            bufferStart = this._sourceBuffer.buffered.start(0);\n            bufferEnd = this._sourceBuffer.buffered.end(0);\n            removeEnd = this._mediaPlayer.currentTime - 0.5;\n            WMKS.LOGGER.log(this + \" status:  start \" + bufferStart +\n                            \" end \" + bufferEnd + \" with current time \" +\n                            this._mediaPlayer.currentTime);\n            if (removeEnd > bufferStart) {\n               WMKS.LOGGER.log(this + \" start to remove from \" +\n                               bufferStart + \" to \" + removeEnd);\n               this._sourceBuffer.remove(bufferStart, removeEnd);\n            } else {\n               WMKS.LOGGER.log(this + \" it is too close to clear buffer.\");\n               this._tempQueue.shift();\n               throw \"close buffer\";\n            }\n         }\n      } catch (e) {\n         if (e.name === \"QuotaExceededError\") {\n            var self = this;\n            WMKS.LOGGER.log(this + \" browser is full.\");\n            setTimeout(function(){\n               self._tempQueue.unshift({method: \"remove\"});\n               self._flushPayloads();\n            }, 0);\n         } else {\n            WMKS.LOGGER.error(this + \" encounters a unrecoverable error. \" + e);\n            this._isError = true;\n\n            if (this._decodeDoneCb) {\n               this._decodeDoneCb();\n            }\n\n            if (this._decodeErrorCb && !this._isErrorDoneCalled) {\n               this._isErrorDoneCalled = true;\n               this._decodeErrorCb();\n            }\n         }\n      }\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * reset\n *\n *    Reset all the resources used by MP4 Decoder object.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nMP4Decoder.prototype.reset = function() {\n   WMKS.LOGGER.log(this + \" is reset.\");\n   if (this._mediaSource) {\n      if (this._sourceBuffer) {\n         this._mediaSource.removeSourceBuffer(this._sourceBuffer);\n         this._sourceBuffer = null;\n      }\n\n      /*\n       * Only end the stream if media source is open. Otherwise\n       * Chrome browser will throw exception.\n       */\n      if (this._mediaSource.readyState === \"open\") {\n         this._mediaSource.endOfStream();\n      }\n      this._mediaSource = null;\n   }\n\n   if (this._mediaPlayer) {\n      this._mediaPlayer.src = \"\";\n      this._mediaPlayer = null;\n   }\n\n   this._sendRequest= 0;\n   this._doneRequest= 0;\n   this._decodeDoneCb = null;\n   this._decodeErrorCb = null;\n   this._isError = false;\n   this._isErrorDoneCalled = false;\n   this._tempQueue = [];\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * appendData\n *\n *    Append MP4 data to media source object. If media source is not ready, put\n *    it into temporary buffer.\n *\n * Side Effects:\n *    Display MP4 video.\n *\n *------------------------------------------------------------------------------\n */\n\nMP4Decoder.prototype.appendData = function(payload) {\n   if (this._isError) {\n      WMKS.LOGGER.log(this + \" is in error state.\");\n      if (this._decodeDoneCb) {\n         this._decodeDoneCb();\n      }\n      return;\n   }\n\n   this._sendRequest++;\n\n   this._tempQueue.push({method: \"add\", payload: payload});\n   this._flushPayloads();\n\n   if (this._mediaPlayer && this._mediaPlayer.paused) {\n      this._mediaPlayer.play();\n   }\n};/*\n * Some code adapted from:\n * https://github.com/brandonaaron/jquery-mousewheel\n */\n\n/* ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2013, Brandon Aaron (http://brandon.aaron.sh)\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n *\n * ***** END LICENSE BLOCK ***** */\n\n /*\n * wmks/mousewheel.js\n *\n *    Event registration for mouse wheel support.\n *\n * jQuery doesn't provide events for mouse wheel movement. This script\n * registers some events we can hook into to detect mouse wheel events\n * in a somewhat cross-browser way.\n *\n * The only information we really need in WebMKS is the direction it scrolled,\n * and not the deltas. This is good, because there is no standard at all\n * for mouse wheel events across browsers when it comes to variables and\n * values, and it's nearly impossible to normalize.\n */\n\n(function() {\n\n\nvar WHEEL_EVENTS = ( 'onwheel' in document || document.documentMode >= 9 ) ?\n                   ['wheel'] : ['mousewheel', 'DomMouseScroll', 'MozMousePixelScroll'];\nvar toFix  = ['wheel', 'mousewheel', 'DOMMouseScroll', 'MozMousePixelScroll'];\n\nif ( $.event.fixHooks ) {\n   for ( var i = toFix.length; i; ) {\n      $.event.fixHooks[ toFix[--i] ] = $.event.mouseHooks;\n   }\n}\n\n/*\n *------------------------------------------------------------------------------\n *\n * onMouseWheelEvent\n *\n *    Handles a mouse wheel event. The resulting event will have wheelDeltaX\n *    and wheelDeltaY values.\n *\n * Results:\n *    The returned value from the handler(s).\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nfunction onMouseWheelEvent(event) {\n   var deltaX   = 0,\n       deltaY   = 0,\n       dispatch = $.event.dispatch || $.event.handle;\n\n   // Old school scrollwheel delta\n   if ( 'detail'      in event ) { deltaY = event.detail * -1;      }\n   if ( 'wheelDelta'  in event ) { deltaY = event.wheelDelta;       }\n   if ( 'wheelDeltaY' in event ) { deltaY = event.wheelDeltaY;      }\n   if ( 'wheelDeltaX' in event ) { deltaX = event.wheelDeltaX * -1; }\n\n   // Firefox < 17 horizontal scrolling related to DOMMouseScroll event\n   if ( 'axis' in event && event.axis === event.HORIZONTAL_AXIS ) {\n      deltaX = deltaY * -1;\n      deltaY = 0;\n   }\n\n   // New school wheel delta (wheel event)\n   if ( 'deltaY' in event ) { deltaY = event.deltaY * -1; }\n   if ( 'deltaX' in event ) { deltaX = event.deltaX;      }\n\n   // No change actually happened, no reason to go any further\n   if ( deltaY === 0 && deltaX === 0 ) { return; }\n\n   event = $.event.fix(event);\n   event.type = 'mousewheel';\n   delete event.wheelDelta;\n   event.wheelDeltaX = deltaX;\n   event.wheelDeltaY = deltaY;\n\n   return dispatch.call(this, event);\n}\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * $.event.special.mousewheel\n *\n *    Provides a \"mousewheel\" event in jQuery that can be binded to a callback.\n *    This handles the different browser events for wheel movements.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\n$.event.special.mousewheel = {\n   setup: function() {\n      if (this.addEventListener) {\n         var i;\n\n         for (i = 0; i < WHEEL_EVENTS.length; i++) {\n            this.addEventListener(WHEEL_EVENTS[i], onMouseWheelEvent, false);\n         }\n      } else {\n         this.onmousewheel = onMouseWheelEvent;\n      }\n   },\n\n   tearDown: function() {\n      if (this.removeEventListener) {\n         var i;\n\n         for (i = 0; i < WHEEL_EVENTS.length; i++) {\n            this.removeEventListener(WHEEL_EVENTS[i], onMouseWheelEvent, false);\n         }\n      } else {\n         this.onmousewheel = onMouseWheelEvent;\n      }\n   }\n};\n\n\n})();\n/*\n * wmks/vncProtocol.js\n *\n *   WebMKS VNC decoder prototype.\n *\n */\n\nWMKS.VNCDecoder = function(opts) {\n   var i;\n   this.options = $.extend({}, this.options, opts);\n\n   $.extend(this, {\n      useVMWRequestResolution: false,\n      useVMWRequestStreamState: false,\n      useVMWRequestMultiMon: false,\n      useVMWKeyEvent: false,                 // VMware VScanCode key inputs are handled.\n      allowVMWKeyEvent2UnicodeAndRaw: false, // unicode + JS keyCodes are handled by server.\n      useVMWAck: false,\n      useVMWAudioAck: false,\n      useVMWSessionClose: false,             // Session close msg are sent and handled by server.\n      serverSupportsMKSVChanClipboard: false,\n      vvc: null,\n      vvcSession: null,\n      _websocket: null,\n      _encrypted: false,\n      _receivedFirstUpdate: false,\n      _serverInitialized: false,\n      _canvas: [],\n      _currentCursorURI: 'default',\n      _cursorVisible: true,\n      _imageCache: [],\n\n      _copyRectBlit: null,\n      _copyRectOffscreenBlit: null,\n\n      _state: this.DISCONNECTED,\n\n      _FBWidth: 0,\n      _FBHeight: 0,\n      _FBName: '',\n      _FBBytesPerPixel: 0,\n      _FBDepth: 3,\n\n      /*\n       * Mouse state.\n       * The current button state(s) are sent with each pointer event.\n       */\n      _mouseButtonMask: 0,\n      _mouseX: 0,\n      _mouseY: 0,\n      onDecodeComplete: {},\n\n      /*\n       * Frame buffer update state.\n       */\n      rects: 0,\n      rectsRead: 0,\n      rectsDecoded: 0,\n\n      /*\n       * Width/height requested through self.onRequestResolution()\n       */\n      requestedWidth: 0,\n      requestedHeight: 0,\n\n      decodeToCacheEntry: -1,\n      updateCache: [],\n      updateCacheEntries: 0,\n      cacheFlags: 0,\n\n      /*\n       * Rate-limit resolution requests to the server.  These are slow\n       * & we get a better experience if we don't send too many of\n       * them.\n       */\n      resolutionTimeout: {},\n      resolutionTimer: null,\n      resolutionRequestActive: false,\n\n      /*\n       * We maintain an incrementing ID for each update request.\n       * This assists in tracking updates/acks with the host.\n       */\n      updateReqId: 0,\n\n      /*\n       * Typematic details for faking keyboard auto-repeat in\n       * the client.\n       */\n      typematicState: 1,             // on\n      typematicPeriod: 33333,        // microseconds\n      typematicDelay: 500000,        // microseconds\n\n      /*\n       * Bitmask of Remote keyboard LED state\n       *\n       * Bit 0 - Scroll Lock\n       * Bit 1 - Num Lock\n       * Bit 2 - Caps Lock\n       */\n      _keyboardLEDs: 0,\n\n      /*\n       * Bitmask of currently requested stream state.\n       *\n       * Bit 0 - Disable Audio (value 1 = disabled, 0 = enabled).\n       * Bit 1 - Disable Video (value 1 = disabled, 0 = enabled).\n       */\n      _streamState: 0,\n\n      /*\n       * Timestamp frame's timestamp value --\n       * This is stored as the low and high 32 bits as\n       * Javascript integers can only give 53 bits of precision.\n       */\n      _frameTimestampLo: 0,\n      _frameTimestampHi: 0,\n\n      rect: [],\n      _msgTimer: null,\n      _mouseTimer: null,\n      _mouseActive: false,\n      msgTimeout: {},\n      mouseTimeout: {},\n\n      _retryConnectionTimer: null,\n\n      _url: \"\",\n      _receiveQueue: [],\n      _receiveQueueIndex: 0,\n      _receiveQueueLength: 0,\n\n      /*\n       * API to pass VNC data to UI layer for displaying in the multimon mode,\n       *    passed in when enable multimon, should be null if not in the the\n       *    multimon mode.\n       * @type {object}\n       */\n      _multimonRenderer: null,\n      _isInMultimonMode: false\n   });\n\n   this.setRenderCanvas(this.options.canvas);\n\n   /*\n    * Did we get a backbuffer canvas?\n    */\n   if (this.options.backCanvas) {\n      this._canvas = this._canvas.concat([this.options.backCanvas]);\n      this._canvas[1].ctx = this.options.backCanvas.getContext('2d');\n   }\n\n   if (this.options.blitTempCanvas) {\n      this._canvas = this._canvas.concat([this.options.blitTempCanvas]);\n      this._canvas[2].ctx = this.options.blitTempCanvas.getContext('2d');\n   }\n\n   if (this.options.mediaPlayer) {\n      this._mp4Decoder = new MP4Decoder();\n   }\n\n   /*\n    * multimonRenderer will be activited when using the multiple monitor mode,\n    * and the properties used to render in the single monitor mode like _canvas,\n    * _mediaPlayer and _mp4Decoder will be disabled during that time.\n    */\n   if (this.options.multimonRenderer) {\n      this._multimonRenderer = this.options.multimonRenderer;\n   }\n\n   /*\n    * If the browser supports createImageBitmap we should use that and we will\n    * not need our image manager.\n    */\n   if (typeof createImageBitmap !== 'undefined') {\n      this._useImageBitmaps = true;\n      this._imageManager = null;\n   } else {\n      this._imageManager = new ImageManagerWMKS(256);\n   }\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _releaseImage\n    *\n    *    Pushes the current image to the cache if it is not full.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._releaseImage = function (image) {\n      if (this._imageManager) {\n         this._imageManager.releaseImage(image);\n      } else if(typeof image.close === 'function') {\n         /**\n          * to fix bug 1820682\n          * Add this close to trigger memory releasing, the spec can be found at\n          * https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap/close\n          * Note that \"This is an experimental technology\" in the spec\n          */\n         image.close();\n      }\n   };\n\n   return this;\n};\n\n\n$.extend(WMKS.VNCDecoder.prototype, {\n   options: {\n      canvas: null,\n      backCanvas: null,\n      blitTempCanvas: null,\n      VCDProxyHandshakeVmxPath: null,\n      useUnicodeKeyboardInput: false,\n      enableVorbisAudioClips: false,\n      enableOpusAudioClips: false,\n      enableAacAudioClips: false,\n      enableVVC: true,\n      enableUint8Utf8: false,\n      enableVMWSessionClose: false,\n      enableSubRectangleCache: true,\n      retryConnectionInterval: -1,\n      sendRelativeMouseEvent: false,\n      onConnecting: function() {},\n      onConnected: function() {},\n      onBeforeDisconnected: function() {},\n      onDisconnected: function() {},\n      onAuthenticationFailed: function() {},\n      onError: function(err) {},\n      onProtocolError: function() {},\n      onNewDesktopSize: function(width, height) {},\n      onKeyboardLEDsChanged: function(leds) {},\n      onCursorStateChanged: function(visibility) {},\n      onHeartbeat: function(interval) {},\n      onUpdateCopyPasteUI: function(disableCopy, disablePaste) {},\n      onMultimonCapacityUpdated: function(enabled) {},\n      onCopy: function(txt) {},\n      onSetReconnectToken: function(token) {},\n      onAudio: function(audioInfo) {},\n      onAudioMixer: function(audioMixerInfo) {},\n      onEncodingChanged: function(currentEncoding) {},\n      cacheSizeKB: 102400,\n      cacheSizeEntries: 1024\n   },\n\n   DISCONNECTED: 0,\n   VNC_ACTIVE_STATE: 1,\n   FBU_DECODING_STATE: 2,\n   FBU_RESTING_STATE: 3,\n\n   /*\n    * Server->Client message IDs.\n    */\n   msgFramebufferUpdate: 0,\n   msgSetColorMapEntries: 1,\n   msgRingBell: 2,\n   msgServerCutText: 3,\n   msgVMWSrvMessage: 127,\n\n   /*\n    * VMWSrvMessage sub-IDs we handle.\n    */\n   msgVMWSrvMessage_ServerCaps: 0,\n   msgVMWSrvMessage_Audio: 3,\n   msgVMWSrvMessage_Heartbeat: 4,\n   msgVMWSrvMessage_SetReconnectToken: 6,\n   msgVMWSrvMessage_SessionClose: 7,\n   msgVMWSrvMessage_AudioMixer: 8,\n\n   /*\n    * Client->Server message IDs: VNCClientMessageID\n    */\n   msgClientEncodings: 2,\n   msgFBUpdateRequest: 3,\n   msgKeyEvent: 4,\n   msgPointerEvent: 5,\n   msgVMWClientMessage: 127,\n\n   /*\n    * VMware Client extension sub-IDs: VNCVMWClientMessageID\n    */\n   msgVMWKeyEvent: 0,\n   msgVMWPointerEvent2: 2,\n   msgVMWKeyEvent2: 6,\n   msgVMWAudioAck: 7,\n   msgVMWSessionClose: 12,\n   msgVMWRequestStreamState: 15,\n\n   /*\n    * Encodings for rectangles within FBUpdates.\n    */\n   encRaw:               0x00,\n   encCopyRect:          0x01,\n   encTightPNG:          -260,\n   encDesktopSize:       -223,\n   encH264RectEnc:        20 + 0x574d5600,\n   encTightDiffComp:      22 + 0x574d5600,\n   encH264MP4:            24 + 0x574d5600,\n   encVMWDefineCursor:   100 + 0x574d5600,\n   encVMWCursorState:    101 + 0x574d5600,\n   encVMWCursorPosition: 102 + 0x574d5600,\n   encVMWTypematicInfo:  103 + 0x574d5600,\n   encVMWLEDState:       104 + 0x574d5600,\n   encVMWServerPush2:    123 + 0x574d5600,\n   encVMWServerCaps:     122 + 0x574d5600,\n   encVMWFrameStamp:     124 + 0x574d5600,\n   encOffscreenCopyRect: 126 + 0x574d5600,\n   encUpdateCache:       127 + 0x574d5600,\n   encTopologyChangeEnc: 128 + 0x574d5600,\n   encH264MultimonEnc:   129 + 0x574d5600,\n   encTightJpegQuality10: -23,\n\n   diffCompCopyFromPrev: 0x1,\n   diffCompAppend: 0x2,\n   diffCompAppendRemaining:  0x3,\n\n   updateCacheOpInit:        0,\n   updateCacheOpBegin:       1,\n   updateCacheOpEnd:         2,\n   updateCacheOpReplay:      3,\n\n   updateCacheCapDisableOffscreenSurface: 0x2,\n   updateCacheCapReplay: 0x4,\n   /**\n    * @const\n    * Signifies that the decoder will use the rectangle header as the region to\n    * apply the scatter mask, rather than the entire virtual framebuffer. This\n    * is required for the encoder to do per-head multimon encoding where each\n    * head may have an origin not on a 16-pixel boundary in the virtual\n    * framebuffer.\n    * Clients advertising this cap are compatible with older servers as those\n    * servers always used the VBB bounds as the rectangle header, so only the\n    * server needs to check and handle both cases.\n    */\n   updateCacheCapSubRectangle: 0x100,\n\n   /*\n    * Capability bits from VMWServerCaps which we can make use of.\n    */\n   serverCapKeyEvent:             0x002,\n   serverCapClientCaps:           0x008,\n   serverCapUpdateAck:            0x020,\n   serverCapRequestResolution:    0x080,\n   serverCapKeyEvent2Unicode:     0x100,\n   serverCapKeyEvent2JSKeyCode:   0x200,\n   serverCapAudioAck:             0x400,\n   serverCapMultiMon:             0x1000,\n   serverCapUpdateCacheInfo:      0x2000,\n   serverCapDisablingCopyUI:      0x4000,\n   serverCapDisablingPasteUI:     0x8000,\n   serverCapSessionClose:         0x20000,\n   serverCapHasMKSVChanClipboard: 0x40000,\n   serverCapRequestStreamState:   0x400000,\n\n   /*\n    * Capability bits from VMClientCaps which we make use of.\n    */\n   clientCapHeartbeat:            0x100,\n   clientCapVorbisAudioClips:     0x200,\n   clientCapAacAudioClips:        0x800,\n   clientCapAudioAck:             0x1000,\n   clientCapSetReconnectToken:    0x4000,\n   clientCapSessionClose:         0x8000,\n   clientCapUseMKSVChanClipboard: 0x10000,\n   clientCapUseAudioMixer:        0x20000,\n   clientCapOpusAudioClips:       0x100000,\n\n   /*\n    * Flags in the requestStreamState packet\n    */\n   streamStateDisableAudio: 0x1,\n   streamStateDisableVideo: 0x2,\n\n   /*\n    * Flags in the VNCAudioData packet\n    */\n   audioflagRequestAck:       0x1,\n   audioflagFmtMask:          0x3f << 24,\n   audioflagFmtShift:         24,\n   audioFlagFmtClipsVorbis:   4,\n   audioFlagFmtClipsOpus:     5,\n   audioFlagFmtClipsAac:      6,\n\n   /*\n    * Sub-encodings for the tightPNG encoding.\n    */\n   subEncFill: 0x80,\n   subEncJPEG: 0x90,\n   subEncPNG:  0xA0,\n   subEncDiffJpeg:  0xB0,\n   subEncMask: 0xF0,\n\n   mouseTimeResolution: 16,  // milliseconds\n   resolutionDelay: 300     // milliseconds\n});\n\n\n\n\n\n/** @private */\n\n/*\n *------------------------------------------------------------------------------\n *\n * fail\n *\n *    Prints an error message and disconnects from the server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Prints an error message and disconnects from the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.fail = function (msg) {\n   WMKS.LOGGER.log(msg);\n   this.disconnect();\n   return null;\n};\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _assumeServerIsVMware\n *\n *    Enables features available only on VMware servers.\n *\n *    This is called when we have reason to believe that we are connecting\n *    to a VMware server. Old servers do not advertise their extensions,\n *    so we have to rely on fingerprinting for those.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Enables VMware-only features, which may crash connections\n *    to non-VMware servers.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._assumeServerIsVMware = function () {\n   /*\n    * Only when we skip VNC authentication we also assume that the server\n    * is a VMware one. This is an additional protection in case someone\n    * implements a server that emits CursorState updates.\n    */\n   if (!this.usedVNCHandshake) {\n      return;\n   }\n\n   /*\n    * The server seems to be a VMware server. Enable proprietary extensions.\n    */\n   this.useVMWKeyEvent = true;\n};\n\n\n\n\n\n\n/*\n *\n * RX/TX queue management\n *\n */\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _receiveQueueBytesUnread\n *\n *    Calculates the number of bytes received but not yet parsed.\n *\n * Results:\n *    The number of bytes locally available to parse.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._receiveQueueBytesUnread = function () {\n   \"use strict\";\n\n   return this._receiveQueueLength - this._receiveQueueIndex;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _receiveQueueConsumeBytes\n *\n *    Advances the read pointer the specified number of bytes into the\n *    current websocket message.  Note that a complete VNC message may\n *    be split into more than one websocket message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._receiveQueueConsumeBytes = function (nr) {\n   this._receiveQueueIndex += nr;\n\n   while (this._receiveQueueIndex > 0 &&\n          this._receiveQueue[0].data.byteLength <= this._receiveQueueIndex) {\n      this._receiveQueueLength -= this._receiveQueue[0].data.byteLength;\n      this._receiveQueueIndex -= this._receiveQueue[0].data.byteLength;\n      this._receiveQueue.shift();\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _receiveQueueReset\n *\n *    Resets the receive queue, eg after websocket disconnect.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._receiveQueueReset = function () {\n   this._receiveQueue = [];\n   this._receiveQueueLength = 0;\n   this._receiveQueueIndex = 0;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readBytes\n *\n *    Pops the first 'length' bytes from the front of the receive buffer.\n *\n * Results:\n *    Array of 'length' bytes.\n *\n * Side Effects:\n *    Advances receive buffer.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readBytes = function (length) {\n   \"use strict\";\n\n   if (this._receiveQueueIndex + length <=\n       this._receiveQueue[0].data.byteLength) {\n\n      var result = new Uint8Array(this._receiveQueue[0].data,\n                                  this._receiveQueueIndex,\n                                  length);\n\n      this._receiveQueueConsumeBytes(length);\n\n      return result;\n   } else {\n      var result = new Uint8Array(length);\n      var offset = 0;\n\n      while (length > 0) {\n         var thisAmt = Math.min(length,\n                                this._receiveQueue[0].data.byteLength -\n                                this._receiveQueueIndex);\n\n         var tmp = new Uint8Array(this._receiveQueue[0].data,\n                                  this._receiveQueueIndex,\n                                  thisAmt);\n         result.set(tmp, offset);\n         offset += thisAmt;\n         length -= thisAmt;\n         this._receiveQueueConsumeBytes(thisAmt);\n      }\n\n      return result;\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readByte\n *\n *    Pops the first byte from the front of the receive buffer.\n *\n * Results:\n *    First byte of the receive buffer.\n *\n * Side Effects:\n *    Advances receive buffer.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readByte = function () {\n   \"use strict\";\n\n   var bytes = this._readBytes(1);\n   return bytes[0];\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _skipBytes\n *\n *    Drops 'nr' bytes from the front of the receive buffer.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Advances receive buffer.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._skipBytes = function (nr) {\n   \"use strict\";\n   this._receiveQueueConsumeBytes(nr);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readString\n *\n *    Pops the first 'stringLength' bytes from the front of the read buffer.\n *\n * Results:\n *    An array of 'stringLength' bytes.\n *\n * Side Effects:\n *    Advances receive buffer.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readString = function (stringLength) {\n   \"use strict\";\n\n   var bytes = this._readBytes(stringLength);\n\n   return stringFromArray(bytes);\n};\n\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readStringUTF8\n *\n *    Pops the first 'stringLength' bytes from the front of the read buffer\n *    and parses the string for unicode. If it finds unicode, it converts them\n *    to unicode and returns the unicode string.\n *\n * Results:\n *    A unicode string thats as long as 'stringLength' in case of non-unicodes\n *    or shorter.\n *\n * Side Effects:\n *    Advances receive buffer.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readStringUTF8 = function (stringLength) {\n   \"use strict\";\n\n   var c, c1, c2, c3, valArray = [], i = 0;\n   var bytes = this._readBytes(stringLength);\n\n   while (i < stringLength) {\n      c = bytes[i];\n      if (c < 128) {\n          // Handle non-unicode string here.\n          valArray.push(c);\n          i++;\n      } else if (c < 224) {\n         c1 = bytes[i+1] & 63;\n         valArray.push(((c & 31) << 6) | c1);\n         i += 2;\n      } else if (c < 240) {\n         c1 = bytes[i+1] & 63;\n         c2 = bytes[i+2] & 63;\n         valArray.push(((c & 15) << 12) | (c1 << 6) | c2);\n         i += 3;\n      } else {\n         c1 = bytes[i+1] & 63;\n         c2 = bytes[i+2] & 63;\n         c3 = bytes[i+3] & 63;\n         valArray.push(((c & 7) << 18) | (c1 << 12) | (c2 << 6) | c3);\n         i += 4;\n      }\n   }\n\n   // Apply all at once is faster:\n   // http://jsperf.com/string-fromcharcode-apply-vs-for-loop\n   //\n   return String.fromCharCode.apply(String, valArray);\n};\n\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readInt16\n *\n *    Pops the first two bytes from the front of the receive buffer.\n *\n * Results:\n *    First two bytes of the receive buffer.\n *\n * Side Effects:\n *    Advances receive buffer.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readInt16 = function () {\n   \"use strict\";\n\n   var bytes = this._readBytes(2);\n\n   return ((bytes[0] << 8) +\n           (bytes[1]));\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readInt32\n *\n *    Pops the first four bytes from the front of the receive buffer.\n *\n * Results:\n *    First four bytes of the receive buffer.\n *\n * Side Effects:\n *    Advances receive buffer.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readInt32 = function () {\n   \"use strict\";\n\n   var bytes = this._readBytes(4);\n\n   return ((bytes[0] << 24) +\n           (bytes[1] << 16) +\n           (bytes[2] <<  8) +\n           (bytes[3]));\n};\n\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendString\n *\n *    Sends a string to the server, using the appropriate encoding.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendString = function (stringValue) {\n   \"use strict\";\n   this._sendBytes(arrayFromString(stringValue));\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendBytes\n *\n *    Sends the array 'bytes' of data bytes to the server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendBytes = function (bytes) {\n   \"use strict\";\n   if (!this._websocket) {\n      return;\n   }\n\n   var msg = new ArrayBuffer(bytes.length);\n   var uint8View = new Uint8Array(msg);\n   var i;\n   for (i = 0; i < bytes.length; i++) {\n      uint8View[i] = bytes[i];\n   }\n   this._websocket.send(msg);\n};\n\n\n\n\n\n/*\n *\n * Parser / queue bridge helpers\n *\n */\n\nWMKS.VNCDecoder.prototype._setReadCB = function(bytes, nextFn, nextArg) {\n   this.nextBytes = bytes;\n   this.nextFn = nextFn;\n   this.nextArg = nextArg;\n};\n\n\n/*\n *\n * Client message sending\n *\n */\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendMouseEvent\n *\n *    Sends the current absolute mouse state to the server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n * When isAbsolute is TRUE, the x and y fields represent the current\n * mouse location in server pixels (ie, in the virtual bounding box,\n * translated so that the upper left corner is (0,0) ).  The x and y\n * values increase as you move right and down.\n *\n * When isAbsolute is FALSE, the x and y fields represent unaccelerated\n * relative mouse moves (in client pixels).  The x and y values increase\n * as you move right and down.\n *\n * uint8 isAbsolute;\n * int32 x;\n * int32 y;\n\n *\n * Button order goes from least to most significant bit as\n * HID_MOUSE_BUTTONX.  The button is currently pressed iff the bit is set.\n *\n * 0x01 HID_MOUSE_BUTTON_LEFT\n * 0x02 HID_MOUSE_BUTTON_RIGHT\n * 0x04 HID_MOUSE_BUTTON_MIDDLE\n * 0x08 HID_MOUSE_BUTTON4\n * 0x10 HID_MOUSE_BUTTON5 etc.\n *\n uint32 buttons;\n\n * HID_MOUSE_WHEEL: (vertical scroll)\n * -1: Scroll down\n *  0: Do not scroll\n *\n int8 wheel;\n\n * HID_MOUSE_HSCROLL: (horizontal scroll)\n * -1: Scroll left\n *  0: Do not scroll\n *  1: Scroll right\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendMouseEvent = function () {\n   if (this.options.sendRelativeMouseEvent) {\n      //send relative mouse event\n      var arr = [];\n      arr.push8(this.msgVMWClientMessage);\n      arr.push8(this.msgVMWPointerEvent2);   // Pointer event 2 message sub-type\n      arr.push16(19);  // Length\n      arr.push8(0);    // isAbsolute\n      arr.push32(this._mouseX); //dx\n      arr.push32(this._mouseY); //dy\n      arr.push32(this._mouseButtonMask); //buttons\n      arr.push8(0);  //wheel\n      arr.push8(0); //hscroll\n      this._sendBytes(arr);\n      this._mouseActive = false;\n   } else {\n      //send absolute mouse event\n      var arr = [];\n      arr.push8(this.msgPointerEvent);\n      arr.push8(this._mouseButtonMask);\n      arr.push16(this._mouseX);\n      arr.push16(this._mouseY);\n      this._sendBytes(arr);\n      this._mouseActive = false;\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendResolutionRequest\n *\n *    Sends the most recently requested resolution to the server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendResolutionRequest = function () {\n   var arr = [];\n   arr.push8(this.msgVMWClientMessage);\n   arr.push8(5);       // Resolution request 2 message sub-type\n   arr.push16(8);      // Length\n   arr.push16(this.requestedWidth);\n   arr.push16(this.requestedHeight);\n   this._sendBytes(arr);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendTopologyRequest\n *\n *    Sends the requested topology to the server.\n *    This is mainly a javascript version of VNCDecode_SendResolutionRequest()\n *    at bora/lib/vnc/vncDecodeBackend.c\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendTopologyRequest = function (multiMonRects) {\n   var arr = [],\n       i = 0;\n   arr.push8(this.msgVMWClientMessage);\n   // VNCVMWClientMessageID::VNCVMWRequestMultimonID @ bora/public/vnc.h\n   arr.push8(10);\n   /*\n    * 6 bytes : 2 of push8s, 2 of push16s.\n    * 20 bytes: size of each monitor rectangle.\n    */\n   arr.push16(6 + 20 * multiMonRects.length);\n   arr.push16(multiMonRects.length);\n   for (i = 0; i < multiMonRects.length; i++) {\n      // Each rectangle is 20 bytes in size, 5 items of 4 bytes each.\n      arr.push32(multiMonRects[i].left);\n      arr.push32(multiMonRects[i].top);\n      arr.push32(multiMonRects[i].requestedWidth);\n      arr.push32(multiMonRects[i].requestedHeight);\n      arr.push32(0);\n   }\n   this._sendBytes(arr);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _customRendererEnabled\n *\n *    Return whether should redirect control and data into the  customized\n *    multimonRenderer than use them locally, which should only be true\n *    after entering the multimon with a valid multimonRenderer existing.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._customRendererEnabled = function () {\n   return this._isInMultimonMode && !!this._multimonRenderer;\n};\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendClientEncodingsMsg\n *\n *    Sends the server a list of supported image encodings.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendClientEncodingsMsg = function () {\n   var i;\n   var encodings = [this.encTightDiffComp,\n                    this.encTightPNG,\n                    this.encDesktopSize,\n                    this.encVMWDefineCursor,\n                    this.encVMWCursorState,\n                    this.encVMWCursorPosition,\n                    this.encVMWTypematicInfo,\n                    this.encVMWLEDState,\n                    this.encVMWServerPush2,\n                    this.encVMWServerCaps,\n                    this.encTightJpegQuality10,\n                    this.encVMWFrameStamp,\n                    this.encUpdateCache];\n\n   if (this.options.mediaPlayer) {\n      encodings.unshift(this.encH264MP4);\n   }\n   if (this.options.enableRawH264) {\n      encodings.unshift(this.encH264RectEnc);\n   }\n   if (this.options.enableTopologyChange) {\n      encodings.unshift(this.encToppologyChangeEnc);\n   }\n   if (this.options.enableH264Multimon) {\n      encodings.unshift(this.encH264MultimonEnc);\n   }\n\n   if (this._canvas[1]) {\n      encodings = [this.encOffscreenCopyRect].concat(encodings);\n   }\n\n   /*\n    * Blits seem to work well on most browsers now.\n    */\n   encodings = [this.encCopyRect].concat(encodings);\n\n   var message = [];\n   message.push8(this.msgClientEncodings);\n   message.push8(0);\n   message.push16(encodings.length);\n   for (i = 0; i < encodings.length; i += 1) {\n      message.push32(encodings[i]);\n   }\n   this._sendBytes(message);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendFBUpdateRequestMsg\n *\n *    Sends the server a request for a new image, and whether\n *    the update is to be incremental.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendFBUpdateRequestMsg = function (incremental) {\n   var message = [];\n   message.push8(this.msgFBUpdateRequest);\n   message.push8(incremental);\n   message.push16(0);\n   message.push16(0);\n   message.push16(this._FBWidth);\n   message.push16(this._FBHeight);\n   this._sendBytes(message);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendAck\n *\n *    Sends the server an acknowledgement of rendering the frame.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendAck = function(renderMilliseconds, updateReqId) {\n   var msg;\n   if (this.useVMWAck) {\n      /*\n       * Add one millisecond to account for the enforced sleep\n       * between frames, and another as a bit of a swag.\n       */\n      var time = (renderMilliseconds + 2) * 10;\n      var arr = [];\n      arr.push8(this.msgVMWClientMessage);\n      arr.push8(4);           // ACK message sub-type\n      arr.push16(8);          // Length\n      arr.push8(updateReqId); // update id\n      arr.push8(0);           // padding\n      arr.push16(time);       // render time in tenths of millis\n      this._sendBytes(arr);\n   } else {\n      this._sendFBUpdateRequestMsg(updateReqId);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendAudioAck\n *\n *    Sends the server an acknowledgement of an audio packet.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendAudioAck = function(timestampLo, timestampHi) {\n   var arr = [];\n   arr.push8(this.msgVMWClientMessage);\n   arr.push8(this.msgVMWAudioAck);\n   arr.push16(12); // length\n   arr.push32(timestampLo);\n   arr.push32(timestampHi);\n   this._sendBytes(arr);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendRequestStreamState\n *\n *    Sends the server a requestStreamState packet.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *    Can lead to the server disabling / enabling sending of video and audio.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendRequestStreamState = function(state) {\n   if (this._serverInitialized && this.useVMWRequestStreamState) {\n      var arr = [];\n      arr.push8(this.msgVMWClientMessage);\n      arr.push8(this.msgVMWRequestStreamState);\n      arr.push16(8); // Length\n      arr.push32(state);\n      this._sendBytes(arr);\n   }\n};\n\n\n/*\n *\n * Cursor updates\n *\n */\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _changeCursor\n *\n *    Generates an array containing a Windows .cur file and loads it\n *    as the browser cursor to be used when hovering above the canvas.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Changes the cursor in the browser.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._changeCursor = function(pixels, mask, hotx, hoty, w, h) {\n   var cursorData = [];\n\n   var RGBImageDataSize = w * h * 4;   // 32 bits per pixel image data\n   var maskSize = Math.ceil((w * h) / 8.0);  // 1 bit per pixel of mask data.\n\n   var cursorDataSize = (RGBImageDataSize + 40 + /* Bitmap Info Header Size */\n                         maskSize * 2);          /* 2 masks XOR & AND */\n\n   var x, y;\n   /*\n    * We need to build an array of bytes that looks like a Windows .cur:\n    *   -> http://en.wikipedia.org/wiki/ICO_(file_format)\n    *   -> http://en.wikipedia.org/wiki/BMP_file_format\n    */\n   cursorData.push16le(0);\n   cursorData.push16le(2);     // .cur type\n   cursorData.push16le(1);     // One image\n\n   cursorData.push8(w);\n   cursorData.push8(h);\n   cursorData.push8(0);        // True Color cursor\n   cursorData.push8(0);\n   cursorData.push16le(hotx);  // Hotspot X location\n   cursorData.push16le(hoty);  // Hostpot Y location\n\n   // Total size of all image data including their headers (but\n   // excluding this header).\n   cursorData.push32le(cursorDataSize);\n\n   // Offset (immediately past this header) to the BMP data\n   cursorData.push32le(cursorData.length+4);\n\n   // Bitmap Info Header\n   cursorData.push32le(40);    // Bitmap Info Header size\n   cursorData.push32le(w);\n   cursorData.push32le(h*2);\n   cursorData.push16le(1);\n   cursorData.push16le(32);\n   cursorData.push32le(0);     // Uncompressed Pixel Data\n   cursorData.push32le(RGBImageDataSize  + (2 * maskSize));\n   cursorData.push32le(0);\n   cursorData.push32le(0);\n   cursorData.push32le(0);\n   cursorData.push32le(0);\n\n   /*\n    * Store the image data.\n    * Note that the data is specified UPSIDE DOWN, like in a .bmp file.\n    */\n   for (y = h-1; y >= 0; y -= 1) {\n      for (x = 0; x < w; x += 1) {\n         /*\n          * The mask is an array where each bit position indicates whether or\n          * not the pixel is transparent. We need to convert that to an alpha\n          * value for the pixel (clear or solid).\n          */\n         var arrayPos = y * Math.ceil(w/8) + Math.floor(x/8);\n         var alpha = 0;\n         if (mask.length > 0) {\n            alpha = (mask[arrayPos] << (x % 8)) & 0x80 ? 0xff : 0;\n         }\n\n         arrayPos = ((w * y) + x) * 4;\n         cursorData.push8(pixels[arrayPos]);\n         cursorData.push8(pixels[arrayPos+1]);\n         cursorData.push8(pixels[arrayPos+2]);\n         if (mask.length > 0) {\n            cursorData.push8(alpha);\n         } else {\n            cursorData.push8(pixels[arrayPos+3]);\n         }\n      }\n   }\n\n   /*\n    * The XOR and AND masks need to be specified - but the data is unused\n    * since the alpha channel of the cursor image is sufficient. So just\n    * fill in a blank area for each.\n    */\n   for (y = 0; y < h; y += 1) {\n      // The masks are single bit per pixel too\n      for (x = 0; x < Math.ceil(w/8); x +=1) {\n         cursorData.push8(0);\n      }\n   }\n\n   for (y = 0; y < h; y += 1) {\n      // The masks are single bit per pixel too\n      for (x = 0; x < Math.ceil(w/8); x +=1) {\n         cursorData.push8(0);\n      }\n   }\n\n   var url = 'data:image/x-icon;base64,' + Base64.encodeFromArray(cursorData),\n      self = this;\n\n   function updateCursor(url, hx, hy) {\n      if (!!hx) {\n         hotx = hx\n      }\n      if (!!hy) {\n         hoty = hy\n      }\n      self._currentCursorURI =\n         'url(' + url + ') ' + hotx + ' ' + hoty + ', default';\n      self._updateCanvasCursor();\n   }\n\n   /**\n    * Cursor handler is added for bug 1792047\n    * When DPI is more than 100%, client needs to scale cursor to draw it right\n    */\n   if (!!this.options.cursorHandler) {\n      this.options.cursorHandler(url, w, h, updateCursor, hotx, hoty);\n   } else {\n      updateCursor(url);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readOffscreenCopyRect\n *\n *    Parses payload of an offscreen copy rectangle packet.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readOffscreenCopyRect = function (rect) {\n   rect.srcBuffer = this._readByte();\n   rect.dstBuffer = this._readByte();\n   rect.srcX = this._readInt16();\n   rect.srcY = this._readInt16();\n   this._nextRect();\n};\n\n\n/*\n *-----------------------------------------------------------------------------\n *\n * _readUpdateCacheData\n *\n *    Parses payload of an updateCache rectangle packet.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *-----------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readUpdateCacheData = function (rect) {\n   \"use strict\";\n\n   rect.data = this._readBytes(rect.dataLength);\n   this._nextRect();\n};\n\nWMKS.VNCDecoder.prototype._readUpdateCacheInitData = function (rect) {\n   \"use strict\";\n\n   this._skipBytes(4);                         // VNCVMWMessageHeader\n   rect.flags = this._readInt32();\n   rect.updateCacheEntries = this._readInt16();\n   this._skipBytes(4);                         // size in kb, not really used\n   this._nextRect();\n};\n\n\n/*\n *-----------------------------------------------------------------------------\n *\n * _readUpdateCacheRect\n *\n *    Reads the cached update opcode and dispatches to the correct handler.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *-----------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readUpdateCacheRect = function (rect) {\n   \"use strict\";\n\n   rect.opcode = this._readByte();\n   rect.slot = this._readInt16();\n   rect.dataLength = this._readInt16();\n\n   if (rect.opcode != this.updateCacheOpInit) {\n      this._setReadCB(rect.dataLength, this._readUpdateCacheData, rect);\n   } else {\n      this._setReadCB(rect.dataLength, this._readUpdateCacheInitData, rect);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readVMWDefineCursorData\n *\n *    Parses a VMware cursor definition payload.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Changes the cursor in the browser.\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readVMWDefineCursorData = function (rect) {\n   var y, x,\n       andData = [], pixels = [], mask = [],\n       hexMask, pixelIdx, maskIdx, channels;\n\n   // If this is a color cursor\n   if (rect.cursorType === 0) {\n       if (rect.masklength > 0) {\n          andData = this._readBytes(rect.masklength);\n       }\n\n       if (rect.pixelslength > 0) {\n          pixels = this._readBytes(rect.pixelslength);\n       }\n\n      for (y = 0; y < rect.height; y++) {\n         for (x = 0; x < rect.width; x++) {\n            pixelIdx = x + y * rect.width;\n            maskIdx = y * Math.ceil(rect.width / 8) + Math.floor(x / 8);\n            // The mask is actually ordered 'backwards'\n            hexMask = 1 << (7 - x % 8);\n\n            // If the and mask is fully transparent\n            if ((andData[pixelIdx * 4] === 255) &&\n                (andData[pixelIdx * 4 + 1] === 255) &&\n                (andData[pixelIdx * 4 + 2] === 255) &&\n                (andData[pixelIdx * 4 + 3] === 255)) {\n                // If the pixels at this point should be inverted then\n                // make the image actually a simple black color.\n                for (var channel = 0; channel < 4; channel++) {\n                   if (pixels[pixelIdx * 4 + channel] !== 0) {\n                     pixels[pixelIdx * 4 + channel] = 0;\n                     mask[maskIdx] |= hexMask;\n                   }\n                }\n                // Otherwise leave the mask alone\n            } else {\n                mask[maskIdx] |= hexMask;\n            }\n         }\n      }\n   } else if (rect.cursorType === 1) {      // An Alpha Cursor\n       if (rect.pixelslength > 0) {\n          pixels = this._readBytes(rect.pixelslength);\n\n          // Recognise and correct a special case cursor - 1x1 fully\n          // transparent cursor, which the server sends when the\n          // cursor is invisible.  Some browsers render fully\n          // transparent cursors as fully opaque, so add a tiny bit of\n          // alpha.  This cursor should never be seen as the\n          // cursorVisible state should kick in to hide it, but add\n          // this as an additional guard against the \"extra black dot\"\n          // cursor of various bug reports.\n          //\n          if (rect.pixelslength == 4 && pixels[3] == 0) {\n             pixels[3] = 1;\n          }\n       }\n   }\n\n   this._changeCursor(pixels, mask,\n                      rect.x,\n                      rect.y,\n                      rect.width,\n                      rect.height);\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readVMWDefineCursor\n *\n *    Parses a VMware cursor definition header.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readVMWDefineCursor = function (rect) {\n   /*\n    * Start with 2 bytes of type (and padding).\n    */\n   rect.cursorType = this._readByte();\n   this._skipBytes(1);\n\n   rect.pixelslength = 4 * rect.width * rect.height;\n\n   if (rect.cursorType === 0) {\n      rect.masklength = rect.pixelslength;\n   } else {\n      rect.masklength = 0;\n   }\n\n   this._setReadCB(rect.pixelslength + rect.masklength,\n                   this._readVMWDefineCursorData, rect);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _updateCanvasCursor\n *\n *    Look at all cursor and browser state and decide what the canvas\n *    cursor style should be.\n *\n *    Note the following caveats:\n *       - MSIE does not support data-uri based cursors, only default or none.\n *       - Firefox on OSX must use \"none, !important\", not \"none\", with a\n *            bad bug otherwise (...)\n *       - Chrome and Safari should use \"none\", and get an extra black dot\n *            for \"none, !important\"\n *\n *    Apply the new style only if something has changed.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Changes the cursor in the browser.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._updateCanvasCursor = function() {\n   var str;\n   var currentElement;\n   if (this._cursorVisible) {\n      if (WMKS.BROWSER.isIE()) {\n         // IE is not compatible with dataURI cursors\n         str = \"default\";\n      } else {\n         str = this._currentCursorURI;\n      }\n   } else {\n      if (WMKS.BROWSER.isFirefox() && WMKS.BROWSER.isMacOS()) {\n         str = \"none, !important\";\n      } else {\n         // IE is not compatible with \"none, !important\"\n         // Firefox on linux ignores \"none, !important\"\n         str = \"none\";\n      }\n   }\n\n   currentElement = this._mediaPlayer || this._canvas[0];\n   // At times, we get the same cursor image that's already used, ignore it.\n   if (currentElement.style.cursor !== str) {\n      currentElement.style.cursor = str;\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readVMWCursorState\n *\n *    Parses a VMware cursor state update (cursor visibility, etc.).\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Changes the cursor in the browser.\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readVMWCursorState = function(rect) {\n   var cursorState = this._readInt16();\n   this._cursorVisible = !!(cursorState & 0x01);\n   this._updateCanvasCursor();\n   this.options.onCursorStateChanged(this._cursorVisible);\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readVMWCursorPosition\n *\n *    Parses a VMware cursor position update.\n *    Ignores the payload as the client cursor cannot be moved in a browser.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readVMWCursorPosition = function (rect) {\n   /*\n    * We cannot warp or move the host/browser cursor\n    */\n   WMKS.VNCDecoder.cursorPosition = rect;\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readTypematicInfo\n *\n *    Parses a typematic info update.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readTypematicInfo = function(rect) {\n   this.typematicState = this._readInt16(),\n   this.typematicPeriod = this._readInt32(),\n   this.typematicDelay = this._readInt32();\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readLEDState\n *\n *    Parses an LED State update.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readLEDState = function(rect) {\n   this._keyboardLEDs = this._readInt32();\n\n   this.options.onKeyboardLEDsChanged(this._keyboardLEDs);\n\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readFrameStamp\n *\n *    Parses a timestamp frame update.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readFrameStamp = function(rect) {\n   this._frameTimestampLo = this._readInt32();\n   this._frameTimestampHi = this._readInt32();\n   this._nextRect();\n};\n\n\n/*\n *\n * Framebuffer updates\n *\n */\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _fillRectWithColor\n *\n *    Fills a rectangular area in the canvas with a solid colour.\n  *\n * Results:\n *    None.\n *\n * Side Effects:\n *    A coloured canvas.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._fillRectWithColor = function(canvas2dCtx, x, y,\n                                                        width, height, color) {\n   var newStyle;\n   newStyle = \"rgb(\" + color[0] + \",\" + color[1] + \",\" + color[2] + \")\";\n   canvas2dCtx.fillStyle = newStyle;\n   canvas2dCtx.fillRect(x, y, width, height);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _blitImageString\n *\n *    Blits a serialised image (as a string) onto the canvas.\n *    Ignores the Alpha channel information and blits it opaquely.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    A coloured canvas.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._blitImageString = function(canvas2dCtx, x, y,\n                                                      width, height, str) {\n   var img, i, data;\n   img = canvas2dCtx.createImageData(width, height);\n   data = img.data;\n   for (i=0; i < (width * height * 4); i=i+4) {\n      data[i    ] = str.charCodeAt(i + 2);\n      data[i + 1] = str.charCodeAt(i + 1);\n      data[i + 2] = str.charCodeAt(i + 0);\n      data[i + 3] = 255; // Set Alpha\n   }\n   canvas2dCtx.putImageData(img, x, y);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _copyRectGetPut\n * _copyRectDrawImage\n * _copyRectDrawImageTemp\n *\n *    Copy a rectangle from one canvas/context to another.  The\n *    canvas/contexts are indicated by an index into this._canvas[]\n *    array.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._copyRectGetPut = function (srcIndex,\n                                                      srcX, srcY,\n                                                      width, height,\n                                                      dstIndex,\n                                                      dstX, dstY) {\n   var img;\n   img = this._canvas[srcIndex].ctx.getImageData(srcX, srcY,\n                                                 width, height);\n\n   this._canvas[dstIndex].ctx.putImageData(img, dstX, dstY);\n   delete img;\n};\n\n\nWMKS.VNCDecoder.prototype._copyRectDrawImage = function (srcIndex,\n                                                         srcX, srcY,\n                                                         width, height,\n                                                         dstIndex,\n                                                         dstX, dstY) {\n   this._canvas[dstIndex].ctx.drawImage(this._canvas[srcIndex],\n                                        srcX, srcY,\n                                        width, height,\n                                        dstX, dstY,\n                                        width, height);\n};\n\n\nWMKS.VNCDecoder.prototype._copyRectDrawImageTemp = function (srcIndex,\n                                                             srcX, srcY,\n                                                             width, height,\n                                                             dstIndex,\n                                                             dstX, dstY) {\n   this._copyRectDrawImage(srcIndex,\n                           srcX, srcY,\n                           width, height,\n                           2,\n                           srcX, srcY);\n\n   this._copyRectDrawImage(2,\n                           srcX, srcY,\n                           width, height,\n                           dstIndex,\n                           dstX, dstY);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _lighten\n *\n *    Blend a coloured rectangle onto the frontbuffer canvas.  Useful\n *    for tracking how different parts of the screen are drawn and\n *    debugging protocol operations.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._lighten = function(x, y, w, h, color) {\n   \"use strict\";\n\n   this._canvas[0].ctx.globalCompositeOperation = \"lighten\";\n   this._canvas[0].ctx.fillStyle = color;\n   this._canvas[0].ctx.fillRect(x, y, w, h);\n   this._canvas[0].ctx.globalCompositeOperation = \"source-over\";\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _decodeDiffComp\n *\n *    Decodes a diff-compressed jpeg string from the encoder.  This\n *    permits us to reuse portions of the previous jpeg image - in\n *    particular to copy the quantization and huffman tables which are\n *    frequently identical between successive images.\n *\n *    For more information about diff-compressed jpeg, see the\n *    description of this extension in bora/public/vnc.h.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._decodeDiffComp = function (data, oldData) {\n   \"use strict\";\n\n   var l = 0;\n   var i = 0;\n   var out = new Uint8Array(1024);\n   var data2;\n\n   // Construct a full jpeg rectangle from the first 1024 bytes of the\n   // previous rectangle, plus the diff-compressed incoming data.\n   //\n   while (i < data.length && l <= out.length) {\n      switch (data[i++]) {\n      case this.diffCompCopyFromPrev:\n         // Copy up to 255 bytes from the previous decompressed\n         // rectangle.\n         var nr = data[i++];\n         out.set(oldData.subarray(l, l+nr), l);\n         l += nr;\n         break;\n      case this.diffCompAppend:\n         // Append up to 255 bytes from the incoming (compressed)\n         // rectangle.\n         var nr = data[i++];\n         out.set(data.subarray(i, i+nr), l);\n         i += nr;\n         l += nr;\n         break;\n      case this.diffCompAppendRemaining:\n         // Append the remainder of the incoming rectangle.  This is\n         // the final opcode.\n         data2 = new Uint8Array(l + data.length - i);\n         data2.set(out.subarray(0, l), 0);\n\n         // It is possible that i == data.length at this point, IE10 does not\n         // like doing .subarray at the end of an array, so we must avoid it.\n         if (i < data.length) {\n            data2.set(data.subarray(i), l);\n         }\n\n         return data2;\n      }\n   }\n\n   // This exit point can occur only for small rectangles less than\n   // 1024 bytes in length which happen not to finish with an\n   // AppendRemaining opcode.  This is legal but rare.\n   //\n   return out.subarray(0, l);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readTightData\n *\n *    Parses a compressed FB update payload.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readTightData = function (rect) {\n   /*\n    * Skip the preamble and read the actual JPEG data.\n    */\n   var data = this._readBytes(this.nextBytes),\n       URL  = window.URL || window.webkitURL,\n       self = this,\n       type;\n\n   if (rect.subEncoding === this.subEncDiffJpeg) {\n      data = this._decodeDiffComp(data, this._lastJpegData);\n   }\n\n   if (rect.subEncoding !== this.subEncPNG) {\n      this._lastJpegData = data;\n      type = 'image/jpeg';\n   } else {\n      type = 'image/png';\n   }\n\n   if (this._useImageBitmaps) {\n      /*\n       * Unfortunately we cannot move the callback function(){} here out to\n       * be static because createImageBitmap returns a future with imageBitmap\n       * as the argument, and we need to associate that imageBitmap with the\n       * correct rect, and this can only done by creating a new clousure.\n       */\n      createImageBitmap(new Blob([data], {type: type}))\n         .then(function (imageBitmap) {\n            rect.image = imageBitmap;\n            self.onDecodeComplete();\n         });\n   } else {\n      /*\n       * Construct an Image and keep a reference to it in the\n       * rectangle object. Since Images are loaded asynchronously\n       * we can't draw it until the image has finished loading so\n       * we don't call onDecodeComplete() until this has happened.\n       */\n      rect.image = this._imageManager.getImage();\n      rect.image.width = rect.width;\n      rect.image.height = rect.height;\n\n      if (URL) {\n         rect.image.onload = this.onDecodeObjectURLComplete;\n         rect.image.src = URL.createObjectURL(new Blob([data], {type: type}));\n      } else {\n         // Ensure data is in base64 string format\n         data = Base64.encodeFromArray(data);\n         rect.image.onload = this.onDecodeComplete;\n         rect.image.src = 'data:' + type + ';base64,' + data;\n      }\n   }\n\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readTightPNG\n *\n *    Parses the head of a compressed FB update payload.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readTightPNG = function (rect) {\n\n   rect.subEncoding = this._readByte();\n   rect.subEncoding &= this.subEncMask;\n\n   /*\n    * if _mediaPlayer is set, widgetProto is prepared to use a MP4 encoding and we\n    * need to notify it to activate canvas element.\n    * But we shall only active canvas element while not in the multimon mode,\n    * since that the working canvases in the multimon mode is controlled by the\n    * UI layer.\n    */\n   if (this._mediaPlayer && !this._customRendererEnabled()) {\n      this.options.onEncodingChanged(\"TightPNG\");\n   }\n\n   if (rect.subEncoding === this.subEncFill) {\n      rect.color = [];\n      rect.color[0] = this._readByte();\n      rect.color[1] = this._readByte();\n      rect.color[2] = this._readByte();\n      rect.color[3] = 0xff;\n      this.rectsDecoded++;\n      this._nextRect();\n   } else {\n      var lengthSize = 1;\n      var dataSize = this._readByte();\n      if (dataSize & 0x80) {\n         lengthSize = 2;\n         dataSize &= ~0x80;\n         dataSize += this._readByte() << 7;\n         if (dataSize & 0x4000) {\n            lengthSize = 3;\n            dataSize &= ~0x4000;\n            dataSize += this._readByte() << 14;\n         }\n      }\n\n      this._setReadCB(dataSize, this._readTightData, rect);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readH264MP4Rect\n *\n *    Parses the head of a MP4 FB update payload. If this is the first frame of\n *    MP4 stream, we will reset the media source object.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readH264MP4Rect = function(rect) {\n   var opcode = this._readInt16();\n   var streamId = this._readInt16();\n   var dataSize = this._readInt32();\n\n   if (this._customRendererEnabled()) {\n      // Stream is reset on the server. We need to reset media source object.\n      if (opcode === 1) {\n         WMKS.LOGGER.log(\"MP4 encoding is selected and stream is reset in the\" +\n            \" multimon mode with id \" + streamId);\n         this._multimonRenderer.onInit(\"mp4\", {streamId: streamId},\n            this.onDecodeComplete, this.onDecodeMP4Error);\n      }\n\n      this._setReadCB(dataSize, this._readMultimonH264MP4Data, streamId);\n   } else {\n      // Stream is reset on the server. We need to reset media source object.\n      if (opcode === 1) {\n         WMKS.LOGGER.log(\"MP4 encoding is selected and stream is reset.\");\n         this.options.onEncodingChanged(\"MP4\");\n         this._mp4Decoder.init(this._mediaPlayer, undefined, undefined,\n            this.onDecodeComplete, this.onDecodeMP4Error);\n      }\n\n      this._setReadCB(dataSize, this._readH264MP4Data, rect);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readH264MP4Data\n *\n *    Parses a MP4 FB update payload and play the video if Media source object\n *    is ready. Otherwise, put the data to the cache.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readH264MP4Data = function(rect) {\n   this._mp4Decoder.appendData(this._readBytes(this.nextBytes));\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readMultimonH264MP4Data\n *\n *    Pass the mp4 data into the multimon renderer for displaying, which is also\n *    able to cache the package if not able to display right away.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readMultimonH264MP4Data = function(streamId) {\n   this._multimonRenderer.onData(\"mp4\", {\n         streamId: streamId,\n         data: this._readBytes(this.nextBytes)\n      },\n      this.onDecodeComplete, this.onDecodeMP4Error\n   );\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readH264Rect\n *\n *    Parses the head of a raw H.264 FB update payload. If this is the first\n *    frame of raw stream, we will reset the media source object.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readH264Rect = function(rect) {\n   var opcode = this._readInt16();\n   var streamId = this._readInt16();\n   var dataSize = this._readInt32();\n\n   // Stream is reset on the sever. We need to reset media source object.\n   if (opcode === 1) {\n      /*\n       * Raw H264 is not handled by browser natively. So, do nothing when we\n       * receive this data.\n       */\n      WMKS.LOGGER.log(\"Raw H264 encoding is selected and stream is reset.\");\n      if (!this._customRendererEnabled()) {\n         /*\n          * Skip the onEncodingChanged call in multimon mode, since it will be\n          * handled in the UI layer for each monitors.\n          * p.s. actually, we haven't support this mode yet.\n          */\n         this.options.onEncodingChanged(\"RawH264\");\n      }\n   }\n\n   this._setReadCB(dataSize, this._readH264Data, rect);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readH264Data\n *\n *       Parses a RAW FB update payload and do nothing (drop it).\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readH264Data = function(rect) {\n   // do nothing\n   this._readBytes(this.nextBytes);\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readCopyRect\n *\n *    Parses a CopyRect (blit) FB update.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readCopyRect = function (rect) {\n   rect.srcX = this._readInt16();\n   rect.srcY = this._readInt16();\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readRaw\n *\n *    Reads a raw rectangle payload.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readRaw = function (rect) {\n   rect.imageString = this._readString(this.nextBytes);\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readDesktopSize\n *\n *    Parses a screen size update.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Calls the outer widget's onNewDesktopSize callback.\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readDesktopSize = function (rect) {\n   this._FBWidth = rect.width;\n   this._FBHeight = rect.height;\n\n   /*\n    * Resize the canvas to the new framebuffer dimensions.\n    */\n   this.options.onNewDesktopSize(this._FBWidth, this._FBHeight);\n   this._nextRect();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _readRect\n *\n *    Parses an FB update rectangle.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._readRect = function() {\n   var i = this.rectsRead;\n\n   this.rect[i] = {};\n   this.rect[i].x        = this._readInt16();\n   this.rect[i].y        = this._readInt16();\n   this.rect[i].width    = this._readInt16();\n   this.rect[i].height   = this._readInt16();\n   this.rect[i].encoding = this._readInt32();\n\n   if (this.rect[i].encoding !== this.encTightPNG &&\n       this.rect[i].encoding !== this.encH264MP4) {\n      this.rectsDecoded++;\n   }\n\n   switch (this.rect[i].encoding) {\n   case this.encRaw:\n      this._setReadCB(this.rect[i].width *\n                      this.rect[i].height *\n                      this._FBBytesPerPixel,\n                      this._readRaw, this.rect[i]);\n      break;\n   case this.encCopyRect:\n      this._setReadCB(4, this._readCopyRect, this.rect[i]);\n      break;\n   case this.encOffscreenCopyRect:\n      this._setReadCB(6, this._readOffscreenCopyRect, this.rect[i]);\n      break;\n   case this.encUpdateCache:\n      this._setReadCB(5, this._readUpdateCacheRect, this.rect[i]);\n      break;\n   case this.encH264RectEnc:\n      // VNCDecodeReadUpdateRectangle @ bora/lib/vnc/vncDecode.c\n      this._setReadCB(8, this._readH264Rect, this.rect[i]);\n      break;\n   case this.encTightPNG:\n      this._setReadCB(4, this._readTightPNG, this.rect[i]);\n      break;\n   case this.encH264MP4:\n      this._setReadCB(8, this._readH264MP4Rect);\n      break;\n   case this.encDesktopSize:\n      this._readDesktopSize(this.rect[i]);\n      break;\n   case this.encVMWDefineCursor:\n      this._setReadCB(2, this._readVMWDefineCursor, this.rect[i]);\n      break;\n   case this.encVMWCursorState:\n      this._assumeServerIsVMware();\n      this._setReadCB(2, this._readVMWCursorState, this.rect[i]);\n      break;\n   case this.encVMWCursorPosition:\n      this._readVMWCursorPosition(this.rect[i]);\n      break;\n   case this.encVMWTypematicInfo:\n      this._setReadCB(10, this._readTypematicInfo, this.rect[i]);\n      break;\n   case this.encVMWLEDState:\n      this._setReadCB(4, this._readLEDState, this.rect[i]);\n      break;\n   case this.encVMWFrameStamp:\n      this._setReadCB(8, this._readFrameStamp, this.rect[i]);\n      break;\n   default:\n      return this.fail(\"Disconnected: unsupported encoding \" +\n                       this.rect[i].encoding);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _evictUpdateCacheEntry\n *\n *    Evict one entry from the update cache.  This is done in response\n *    to the payload of the Begin opcode as well as the destination\n *    slot of the Begin opcode.\n *\n * Results:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._evictUpdateCacheEntry = function(slot) {\n   \"use strict\";\n\n   if (this.updateCache[slot].image !== null) {\n      this._releaseImage(this.updateCache[slot].image);\n   }\n\n   this.updateCache[slot] = {};\n   this.updateCache[slot].image = null;\n};\n\n\n/*\n *----------------------------------------------------------------------------\n *\n * _executeUpdateCacheInit --\n *\n *      Handle the UPDATE_CACHE_OP_INIT subcommand.  This resets the\n *      cache, evicting all entries and resets the cache sizes and\n *      flags.  The sizes and flags must be a subset of those which\n *      the client advertised in the capability packet.\n *\n * Results:\n *      None.\n *\n * Side effects:\n *      Resets update cache.\n *\n *----------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._executeUpdateCacheInit = function(rect) {\n   \"use strict\";\n\n   var i;\n\n   for (i = 0; i < this.updateCacheEntries; i++) {\n      this._evictUpdateCacheEntry(i);\n   }\n\n   this.updateCache = [];\n   this.updateCacheEntries = rect.updateCacheEntries;\n   this.cacheFlags = rect.flags;\n\n   if (this.updateCacheEntries > this.options.cacheSizeEntries) {\n      return this.fail(\"Disconnected: requested cache too large\");\n   }\n\n   for (i = 0; i < this.updateCacheEntries; i++) {\n      this.updateCache[i] = {};\n      this.updateCache[i].image = null;\n   }\n};\n\n\n/*\n *----------------------------------------------------------------------------\n *\n * _updateCacheInsideBeginEnd --\n *\n *      Returns true if the decoder has received in the current\n *      framebuffer update message a VNC_UPDATECACHE_OP_BEGIN message\n *      but not yet received the corresponding OP_END.\n *\n * Side effects:\n *      None.\n *\n *----------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._updateCacheInsideBeginEnd = function () {\n   return this.decodeToCacheEntry !== -1;\n};\n\n\n/*\n *----------------------------------------------------------------------------\n *\n * _updateCacheInitialized --\n *\n *      Returns true if the decoder has been configured to have an\n *      active UpdateCache and the cache size negotiation has\n *      completed.\n *\n * Side effects:\n *      None.\n *\n *----------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._updateCacheInitialized = function () {\n   return this.updateCacheEntries !== 0;\n};\n\n\n/*\n *----------------------------------------------------------------------------\n *\n * _subRectangleCacheEnabled --\n *\n *      Although backward compatible of updateCacheCapSubRectangle should exist\n *      on the Server side, here still adding the extra check in case webmks is\n *      used to connect between the server and client both without this capacity.\n *\n *      Returns true if the decoder has been configured to have an\n *      active UpdateCache and the subrectangle cache type is used after the\n *      negotiation.\n *\n * Side effects:\n *      None.\n *\n *----------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._subRectangleCacheEnabled = function () {\n   return this.options.enableSubRectangleCache &&\n      this._updateCacheInitialized() &&\n      (this.cacheFlags & this.updateCacheCapSubRectangle);\n};\n\n\n/*\n *----------------------------------------------------------------------------\n *\n * _executeUpdateCacheBegin --\n *\n *      Handle the UPDATE_CACHE_OP_BEGIN subcommand.  Process the\n *      message payload, which is a mask of cache entries to evict.\n *      Evict any existing entry at the destination slot, and create a\n *      new entry there.\n *\n * Results:\n *      None.\n *\n * Side effects:\n *      Evicts elements of the update cache.\n *      Creates a new cache entry.\n *\n *----------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._executeUpdateCacheBegin = function(rect) {\n   \"use strict\";\n\n   var maskBitBuf;\n   var maskState, maskCount;\n   var i, j;\n\n   if (!this._updateCacheInitialized() ||\n       this._updateCacheInsideBeginEnd() ||\n       rect.slot >= this.updateCacheEntries) {\n      return this.fail(\"Disconnected: requested cache slot too large\");\n   }\n\n   maskBitBuf = new WMKS.BitBuf(rect.data, rect.dataLength);\n   maskState = !maskBitBuf.readBits(1);\n   maskCount = 0;\n   j = 0;\n\n   do {\n      maskCount = maskBitBuf.readEliasGamma();\n      maskState = !maskState;\n\n      if (maskState) {\n         for (i = 0; i < maskCount && i < this.updateCacheEntries; i++) {\n            this._evictUpdateCacheEntry(i + j);\n         }\n      }\n\n      j += maskCount;\n   } while (j < this.updateCacheEntries && !maskBitBuf.overflow);\n\n\n   this.decodeToCacheEntry = rect.slot;\n   this._evictUpdateCacheEntry(rect.slot);\n\n   this.updateCache[this.decodeToCacheEntry].imageWidth = rect.width;\n   this.updateCache[this.decodeToCacheEntry].imageHeight = rect.height;\n};\n\n\n/*\n *----------------------------------------------------------------------------\n *\n * _executeUpdateCacheEnd --\n *\n *      Handle the UPDATE_CACHE_OP_END subcommand.  Process the\n *      message payload, which is a serialized bitmask of screen\n *      regions to scatter the update image to.\n *\n * Results:\n *      None.\n *\n * Side effects:\n *      Draws to the canvas.\n *\n *----------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._executeUpdateCacheEnd = function(rect) {\n   \"use strict\";\n   var encodedMaskRect = null;\n   var update = this.updateCache[this.decodeToCacheEntry];\n   var state, count;\n   var dstx = 0;\n   var dsty = 0;\n   var dstw;\n   var dsth;\n   var srcx = 0;\n   var srcy = 0;\n   var srcw = update.imageWidth / 16;\n   var srch = update.imageHeight / 16;\n   var availwidth;\n   var bitbuf;\n\n   if (!this._updateCacheInitialized() ||\n       !this._updateCacheInsideBeginEnd() ||\n       rect.slot != this.decodeToCacheEntry ||\n       rect.slot >= this.updateCacheEntries) {\n      return this.fail(\"Disconnected: requested cache slot invalid\");\n   }\n\n   if (this._subRectangleCacheEnabled()) {\n      encodedMaskRect = {\n         x: rect.x,\n         y: rect.y,\n         width: rect.width,\n         height: rect.height\n      };\n   } else {\n      encodedMaskRect = {\n         x: 0,\n         y: 0,\n         width: this._FBWidth,\n         height: this._FBHeight\n      };\n   }\n\n   dstw = Math.ceil(encodedMaskRect.width / 16);\n   dsth = Math.ceil(encodedMaskRect.height / 16);\n\n   update.encodedMaskRect = encodedMaskRect;\n   update.mask = rect.data;\n   update.maskLength = rect.dataLength;\n\n   bitbuf = new WMKS.BitBuf(update.mask, update.maskLength);\n   state = !bitbuf.readBits(1);\n   count = 0;\n\n   do {\n      if (count == 0) {\n         count = bitbuf.readEliasGamma();\n         state = !state;\n      }\n\n      availwidth = Math.min(srcw - srcx, dstw - dstx);\n      availwidth = Math.min(availwidth, count);\n\n      if (state) {\n         // Don't worry if we don't have a full 16-wide mcu at the\n         // screen edge.  The canvas will trim the drawImage\n         // coordinates for us.\n         //\n         this._canvas[0].ctx.drawImage(update.image,\n                                       srcx * 16,\n                                       srcy * 16,\n                                       availwidth * 16, 16,\n                                       encodedMaskRect.x + dstx * 16,\n                                       encodedMaskRect.y + dsty * 16,\n                                       availwidth * 16, 16);\n\n         srcx += availwidth;\n         if (srcx == srcw) {\n            srcx = 0;\n            srcy++;\n         }\n      }\n\n      dstx += availwidth;\n      if (dstx == dstw) {\n         dstx = 0;\n         dsty++;\n      }\n\n      count -= availwidth;\n\n   } while (dsty < dsth && !bitbuf._overflow);\n\n   this.decodeToCacheEntry = -1;\n};\n\n\n/*\n *----------------------------------------------------------------------------\n *\n * _executeUpdateCacheReplay --\n *\n *      Handle the UPDATE_CACHE_OP_REPLAY subcommand.  Process the\n *      message payload, which is a serialized mask used to subset the\n *      bitmask provided at the time the cache entry being replayed\n *      was created.  Scatters the specified subset of the cached\n *      image to the canvas.\n *\n * Results:\n *      None.\n *\n * Side effects:\n *      Draws to the canvas.\n *\n *----------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._executeUpdateCacheReplay = function(rect) {\n   \"use strict\";\n\n   if (rect.slot >= this.updateCacheEntries) {\n      return this.fail(\"Disconnected: requested cache slot invalid\");\n   }\n\n   /*\n    * Ignore the cache relay when mask is missing, in case the rect message for\n    * the multimon is buffered on network right after switched to single monitor\n    * mode.\n    */\n   if (!this.updateCache[rect.slot].encodedMaskRect) {\n      return;\n   }\n\n   var update = this.updateCache[rect.slot];\n   var encodedMaskRect = update.encodedMaskRect;\n   var dstx = 0;\n   var dsty = 0;\n   var dstw = Math.ceil(encodedMaskRect.width / 16);\n   var dsth = Math.ceil(encodedMaskRect.height / 16);\n   var availwidth;\n   var srcx = 0;\n   var srcy = 0;\n   var srcw = update.imageWidth / 16;\n   var srch = update.imageHeight / 16;\n\n   var maskBitBuf = new WMKS.BitBuf(rect.data, rect.dataLength);\n   var updateBitBuf = new WMKS.BitBuf(update.mask, update.maskLength);\n\n   var updateState = !updateBitBuf.readBits(1);\n   var updateCount = 0;\n\n   var maskState = !maskBitBuf.readBits(1);\n   var maskCount = 0;\n\n   if (!this._updateCacheInitialized() ||\n       this._updateCacheInsideBeginEnd() ||\n       rect.slot >= this.updateCacheEntries) {\n      return this.fail(\"\");\n   }\n\n   do {\n      if (updateCount == 0) {\n         updateCount = updateBitBuf.readEliasGamma();\n         updateState = !updateState;\n      }\n      if (maskCount == 0) {\n         maskCount = maskBitBuf.readEliasGamma();\n         maskState = !maskState;\n      }\n\n      availwidth = dstw - dstx;\n      availwidth = Math.min(availwidth, updateCount);\n\n      if (updateState) {\n         availwidth = Math.min(availwidth, srcw - srcx);\n         availwidth = Math.min(availwidth, maskCount);\n\n         if (maskState) {\n            // Don't worry if the right/bottom blocks are not\n            // 16-pixel, the canvas will trim the drawImage dimesions\n            // for us.\n            this._canvas[0].ctx.drawImage(update.image,\n                                         srcx * 16,\n                                         srcy * 16,\n                                         availwidth * 16, 16,\n                                         encodedMaskRect.x + dstx * 16,\n                                         encodedMaskRect.y + dsty * 16,\n                                         availwidth * 16, 16);\n\n            if (false) {\n               this._lighten(encodedMaskRect.x + dstx * 16,\n                             encodedMaskRect.y + dsty * 16,\n                             availwidth * 16, 16,\n                             \"red\");\n            }\n         }\n\n         srcx += availwidth;\n         if (srcx == srcw) {\n            srcx = 0;\n            srcy++;\n         }\n\n         maskCount -= availwidth;\n      }\n\n      dstx += availwidth;\n      if (dstx == dstw) {\n         dstx = 0;\n         dsty++;\n      }\n\n      updateCount -= availwidth;\n\n   } while (dsty < dsth &&\n            !maskBitBuf._overflow &&\n            !updateBitBuf._overflow);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n+ * _handleRequestConnectVmxMsg\n+ *\n+ *    Callback to handle console proxy VMX info request message.\n+ *\n+ * Results:\n+ *    None.\n+ *\n+ * Side Effects:\n+ *    Sends the VMX string passed to the initial connect call.\n+ *    Sets next parser callback.\n+ *\n+ *------------------------------------------------------------------------------\n+ */\nWMKS.VNCDecoder.prototype._handleVCDProxyVmxPathMessage = function () {\n   var requestString = this._readString(17);\n   if (requestString !== \"connect info vmx\\n\") {\n      return this.fail(\"Invalid connection vmx request: \" + requestString);\n   }\n\n   this._sendString(this.options.VCDProxyHandshakeVmxPath);\n   this._setReadCB(12, this._peekFirstMessage);\n};\n\n/*\n *------------------------------------------------------------------------------\n *\n * _executeUpdateCacheReplay\n *\n *    Dispatch the updateCache commands according to their opcode.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._executeUpdateCache = function(rect) {\n   \"use strict\";\n\n   switch (rect.opcode) {\n   case this.updateCacheOpInit:\n      this._executeUpdateCacheInit(rect);\n      break;\n   case this.updateCacheOpBegin:\n      this._executeUpdateCacheBegin(rect);\n      break;\n   case this.updateCacheOpEnd:\n      this._executeUpdateCacheEnd(rect);\n      break;\n   case this.updateCacheOpReplay:\n      this._executeUpdateCacheReplay(rect);\n      break;\n   default:\n      return this.fail(\"Disconnected: requested cache opcode invalid\");\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _executeRectSingleForMultimon\n *\n *    Execute the update command specified in a single rect for multimon mode.\n *    The ack will not be sent before the real rendering among monitors, and we\n *    will improve the preformence after 17Q1 to sending the undecoded binary\n *    instead of the decoded image, and for 17Q1, the cache is disabled from\n *    agent side, and encRaw and encOffscreenCopyRect are tested as not used, so\n *    disable them all to reduce the change size.\n *\n *    Currently only support encCopyRect, encUpdateCache, encTightPNG.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._executeRectSingleForMultimon = function (rect,\n                                                                    frameId,\n                                                                    onDone,\n                                                                    onError) {\n   switch (rect.encoding) {\n      case this.encCopyRect:\n      case this.encTightPNG:\n         this._multimonRenderer.onData(\"rect\", {\n            data: rect,\n            frameId: frameId\n         }, onDone, onError);\n         break;\n      case this.encUpdateCache:\n         if (this.options.enableSubRectangleCache) {\n            this._multimonRenderer.onData(\"rect\", {\n               data: rect,\n               frameId: frameId\n            }, onDone, onError);\n         } else {\n            onDone();\n         }\n         break;\n      case this.encRaw:\n         WMKS.LOGGER.warn(\"unsupported encoding for multimon: encRaw\");\n         rect.imageString = \"\";\n         onDone();\n         break;\n      case this.encDesktopSize:\n      case this.encVMWDefineCursor:\n      case this.encVMWCursorState:\n      case this.encVMWCursorPosition:\n      case this.encH264MP4:\n         onDone();\n         break;\n      default:\n         onError();\n         break;\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _executeRectSingle\n *\n *    Execute the update command specified in a single rect.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Updates the canvas contents.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._executeRectSingle = function (rect) {\n   var ctx = this._canvas[0].ctx;\n\n   switch (rect.encoding) {\n      case this.encRaw:\n         this._blitImageString(ctx,\n                               rect.x,\n                               rect.y,\n                               rect.width,\n                               rect.height,\n                               rect.imageString);\n         rect.imageString = \"\";\n         break;\n      case this.encCopyRect:\n         this._copyRectBlit(0,      // source index\n                            rect.srcX,\n                            rect.srcY,\n                            rect.width,\n                            rect.height,\n                            0,      // dest index\n                            rect.x,\n                            rect.y);\n         break;\n      case this.encOffscreenCopyRect:\n         this._copyRectOffscreenBlit(rect.srcBuffer,\n                                     rect.srcX,\n                                     rect.srcY,\n                                     rect.width,\n                                     rect.height,\n                                     rect.dstBuffer,\n                                     rect.x,\n                                     rect.y);\n         break;\n      case this.encTightPNG:\n         if (rect.subEncoding === this.subEncFill) {\n            this._fillRectWithColor(ctx,\n                                    rect.x,\n                                    rect.y,\n                                    rect.width,\n                                    rect.height,\n                                    rect.color);\n         } else if (this.decodeToCacheEntry === -1) {\n            ctx.drawImage(rect.image,\n                          rect.x,\n                          rect.y);\n\n            this._releaseImage(rect.image);\n            rect.image = null;\n         } else {\n            this.updateCache[this.decodeToCacheEntry].image = rect.image;\n            rect.image = null;\n         }\n         break;\n      case this.encDesktopSize:\n      case this.encVMWDefineCursor:\n      case this.encVMWCursorState:\n      case this.encVMWCursorPosition:\n      case this.encH264MP4:\n         break;\n      case this.encUpdateCache:\n         this._executeUpdateCache(rect);\n         break;\n      default:\n         break;\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * sendACK\n *\n *    send ACK for rendering.\n *    The the decodeStart and updateReqId will uses the this.decodeStart, and\n *    this.updateReqId respectively for single monitor mode, while use the param\n *    maintained by the multimon renderer for multimon mode.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.sendACK = function (decodeStart, updateReqId) {\n    var now = (new Date()).getTime(),\n       decodeStartTime = decodeStart || this.decodeStart,\n       updateRequestId = (updateReqId !== undefined) ? updateReqId : this.updateReqId;\n    this._sendAck(now - decodeStartTime, updateRequestId);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _executeRects\n *\n *    When this is called, all data for all rectangles is available\n *    and all JPEG images have been loaded. We can noe perform all\n *    drawing in a single step, in the correct order.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Updates the canvas contents.\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._executeRects = function () {\n   /*\n    * When this is called, all data for all rectangles is\n    * available and all JPEG images have been loaded.  We can\n    * now perform all drawing in a single step, in the correct order.\n    */\n   var i,\n      decodeStart,\n      updateReqId,\n      rectLength,\n      processedRectNum,\n      onError,\n      onDone,\n      frameId;\n\n   if (this._state !== this.FBU_DECODING_STATE) {\n      return this.fail(\"wrong state: \" + this._state);\n   }\n\n   if (this.rectsDecoded !== this.rects ||\n      this.rectsRead !== this.rects) {\n      return this.fail(\"messed up state\");\n   }\n\n   if (this._customRendererEnabled()) {\n      // cache properties by local variables since the call could be async\n      decodeStart = this.decodeStart;\n      updateReqId = this.updateReqId;\n      rectLength = this.rects;\n      processedRectNum = 0;\n      onDone = onError = function() {\n         processedRectNum++;\n         if (processedRectNum === rectLength) {\n            this.sendACK(decodeStart, updateReqId);\n         }\n      }.bind(this);\n      /*\n       * frameId is used to ensure rect updates are renderred by frame which\n       * can avoid diplaying out renderring result when only part of rect\n       * updating in a frame are done.\n       *\n       * Use time since if 2 frames are handled within 1ms, displaying the final\n       * result is reasonable.\n       * @type {number}\n       */\n      frameId = Date.now();\n      for (i = 0; i < this.rects; i++) {\n         this._executeRectSingleForMultimon(this.rect[i], frameId, onDone,\n            onError);\n         delete this.rect[i];\n      }\n   } else {\n      for (i = 0; i < this.rects; i++) {\n         this._executeRectSingle(this.rect[i]);\n         delete this.rect[i];\n      }\n      this.sendACK();\n   }\n\n   this.rects = 0;\n   this.rectsRead = 0;\n   this.rectsDecoded = 0;\n   this.updateReqId = 0;\n\n   if (this._receivedFirstUpdate === false) {\n    this.options.onConnected();\n    this._receivedFirstUpdate = true;\n   }\n\n\n   var self = this;\n   this._state = this.FBU_RESTING_STATE;\n   this._getNextServerMessage();\n\n\n   /*\n    * Resting like this is a slight drain on performance,\n    * especially at higher framerates.\n    *\n    * If the client could just hit 50fps without resting (20\n    * ms/frame), it will now manage only 47.6fps (21 ms/frame).\n    *\n    * At lower framerates the difference is proportionately\n    * less, eg 20fps->19.6fps.\n    *\n    * It is however necessary to do something like this to\n    * trigger the screen update, as the canvas double buffering\n    * seems to use idleness as a trigger for swapbuffers.\n    */\n\n   this._msgTimer = setTimeout(this.msgTimeout, 1 /* milliseconds */);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _nextRect\n *\n *    Configures parser to process next FB update rectangle,\n *    or progresses to rendering.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._nextRect = function() {\n   this.rectsRead++;\n   if (this.rectsRead < this.rects) {\n      this._setReadCB(12, this._readRect);\n   } else {\n      this._state = this.FBU_DECODING_STATE;\n      if (this.rectsDecoded === this.rects) {\n         this._executeRects();\n      }\n   }\n};\n\n\n\n\n\n/*\n *\n * Server message handling\n *\n */\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _gobble\n *\n *    Throws away a sequence of bytes and calls next().\n *    Like _skipBytes(), but usable with _setReadCB().\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Skips a message chunk.\n *    Calls a dynamic callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._gobble = function (next) {\n   this._skipBytes(this.nextBytes);\n   next();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _getNextServerMessage\n *\n *    Sets up parser to expect the head of a new message from the server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._getNextServerMessage = function () {\n   this._setReadCB(1, this._handleServerMsg);\n};\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _framebufferUpdate\n *\n *    Parses header of new image being received.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Resets FB update parser.\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._framebufferUpdate = function () {\n   this.updateReqId = this._readByte();\n   this.rects = this._readInt16();\n   this.rectsRead = 0;\n   this.rectsDecoded = 0;\n   this.decodeStart = (new Date()).getTime();\n   this._setReadCB(12, this._readRect);\n};\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleServerInitializedMsg\n *\n *    Callback to handle VNC server init'd message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets various instance-wide config vars that describe the connection.\n *    Processes the message.\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleServerInitializedMsg = function () {\n   var self = this;\n\n   /*\n    * Screen size\n    */\n   this._FBWidth  = this._readInt16();\n   this._FBHeight = this._readInt16();\n\n   /*\n    * PIXEL_FORMAT\n    * We really only need the depth/bpp and endian flag.\n    */\n   var bpp           = this._readByte();\n   var depth         = this._readByte();\n   var bigEndian     = this._readByte();\n   var trueColor     = this._readByte();\n\n   WMKS.LOGGER.log('Screen: ' + this._FBWidth + ' x ' + this._FBHeight +\n                   ', bits-per-pixel: ' + bpp + ', depth: ' + depth +\n                   ', big-endian-flag: ' + bigEndian +\n                   ', true-color-flag: ' + trueColor);\n\n   /*\n    * Skip the 'color'-max values.\n    */\n   this._skipBytes(6);\n\n   var redShift = this._readByte();\n   var greenShift = this._readByte();\n   var blueShift = this._readByte();\n\n   WMKS.LOGGER.debug('red shift: ' + redShift +\n                     ', green shift: ' + greenShift +\n                     ', blue shift: ' + blueShift);\n\n   /*\n    * Skip the 3 bytes of padding\n    */\n   this._skipBytes(3);\n\n   /*\n    * Read the connection name.\n    */\n   var nameLength   = this._readInt32();\n\n   this.options.onNewDesktopSize(this._FBWidth, this._FBHeight);\n\n   /*\n    * After measuring on many browsers, these appear to be universal\n    * best choices for blits and offscreen blits respectively.\n    */\n   this._copyRectBlit = this._copyRectDrawImageTemp;\n   this._copyRectOffscreenBlit = this._copyRectDrawImage;\n\n   // keyboard.grab();\n\n   if (trueColor) {\n      this._FBBytesPerPixel = 4;\n      this._FBDepth        = 3;\n   } else {\n      return this.fail('no colormap support');\n   }\n\n   var getFBName = function () {\n      self._FBName = self._readString(nameLength);\n\n      self._sendClientEncodingsMsg();\n      self._sendFBUpdateRequestMsg(0);\n\n      WMKS.LOGGER.log('Connected ' +\n                      (self._encrypted? '(encrypted)' : '(unencrypted)') +\n                      ' to: ' + self._FBName);\n\n      self._serverInitialized = true;\n      self._getNextServerMessage();\n   };\n\n   this._setReadCB(nameLength, getFBName);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _peekFirstMessage\n *\n *    We have built and deployed two sorts of VNC servers, those that\n *    expect an RFB 003.008 and VNC authentication handshake, and\n *    those which jump straight into the VNC protocol at the\n *    serverInitialized message.  Previously we had to switch the\n *    client between these two modes, but it is possible to build a\n *    single client which can talk to both types of server simply by\n *    examining the size of the first message we receive.\n *\n *    Note that this is a very robust detection method - the server is\n *    required in each case to send a message of a specific size on\n *    connection establishment.  We are lucky that the two messages\n *    are of different sizes.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._peekFirstMessage = function () {\n   this.usedVNCHandshake = (this._receiveQueue[0].data.byteLength == 12);\n   if (this.usedVNCHandshake) {\n      this._setReadCB(12, this._handleProtocolVersionMsg);\n   } else {\n      this._setReadCB(24, this._handleServerInitializedMsg);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleSecurityResultMsg\n *\n *    Callback to handle VNC security result message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Processes the message.\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleSecurityResultMsg = function () {\n   var self = this;\n   var reasonLength;\n   var handleReason = function() {\n      var reason = self._readString(reasonLength);\n      self.options.onAuthenticationFailed();\n      return self.fail(reason);\n   };\n\n   var handleReasonLength = function() {\n      reasonLength = self._readInt32();\n      self._setReadCB(reasonLength, handleReason);\n   };\n\n\n   switch (this._readInt32()) {\n      case 0:  // OK\n         /*\n          * Send '1' to indicate the the host should try to\n          * share the desktop with others.  This is currently\n          * ignored by our server.\n          */\n         this._sendBytes([1]);\n         this._setReadCB(24, this._handleServerInitializedMsg);\n         return;\n      case 1:  // failed\n         this._setReadCB(4, handleReasonLength);\n         return;\n      case 2:  // too-many\n         this.options.onAuthenticationFailed();\n         return this.fail(\"Too many auth attempts\");\n      default:\n         return this.fail(\"Bogus security result\");\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleSecurityMsg\n *\n *    Callback to handle VNC security message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Processes the message.\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleSecurityMsg = function () {\n   var authenticationScheme = 0;\n   var numTypes;\n   var reasonLength;\n   var self = this;\n\n   var handleReason = function() {\n      var reason = this._readString(reasonLength);\n      self.options.onAuthenticationFailed();\n      return self.fail(reason);\n   };\n\n   var handleReasonLength = function() {\n      reasonLength = self._readInt32();\n      self._setReadCB(reasonLength, handleReason);\n   };\n\n   var handleSecurityTypes = function() {\n      var securityTypes = self._readBytes(numTypes);\n      WMKS.LOGGER.log(\"Server security types: \" + securityTypes);\n      for (var i=0; i < securityTypes.length; i+=1) {\n         if (securityTypes && (securityTypes[i] < 3)) {\n            authenticationScheme = securityTypes[i];\n         }\n      }\n      if (authenticationScheme === 0) {\n         return self.fail(\"Unsupported security types: \" + securityTypes);\n      }\n      self._sendBytes([authenticationScheme]);\n      WMKS.LOGGER.log('Using authentication scheme: ' + authenticationScheme);\n      if (authenticationScheme === 1) {\n         // No authentication required - just handle the result state.\n         self._setReadCB(4, self._handleSecurityResultMsg);\n      } else {\n         return self.fail(\"vnc authentication not implemented\");\n      }\n   };\n\n   numTypes = this._readByte();\n   if (numTypes === 0) {\n      this._setReadCB(4, handleReasonLength);\n   } else {\n      this._setReadCB(numTypes, handleSecurityTypes);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleProtocolVersionMsg\n *\n *    Callback to handle VNC handshake message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends own ID string back.\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleProtocolVersionMsg = function () {\n   var serverVersionPacket = this._readString(12);\n   if (serverVersionPacket !== \"RFB 003.008\\n\") {\n      return this.fail(\"Invalid Version packet: \" + serverVersionPacket);\n   }\n   this._sendString(\"RFB 003.008\\n\");\n   this._setReadCB(1, this._handleSecurityMsg);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendClientCaps\n *\n *    Send our VNCVMW client caps to the server.\n *    Right now the only one we send is VNCVMW_CLIENTCAP_HEARTBEAT (0x100).\n *\n * Results:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendClientCaps = function() {\n   if (this._serverInitialized) {\n      var arr = [];\n      var caps = (this.clientCapHeartbeat |\n                  this.clientCapAudioAck |\n                  this.clientCapSetReconnectToken);\n      if (this.options.enableVorbisAudioClips) {\n        caps |= this.clientCapVorbisAudioClips;\n      }\n\n      if (this.options.enableOpusAudioClips) {\n        caps |= this.clientCapOpusAudioClips;\n      }\n\n      if (this.options.enableAacAudioClips) {\n        caps |= this.clientCapAacAudioClips;\n      }\n\n      if (this.options.enableVMWSessionClose) {\n        caps |= this.clientCapSessionClose;\n      }\n\n      if (this.options.enableVMWAudioMixer) {\n         caps |= this.clientCapUseAudioMixer;\n      }\n\n      if (this.serverSupportsMKSVChanClipboard && this.vvcSession) {\n        caps |= this.clientCapUseMKSVChanClipboard;\n      }\n      arr.push8(this.msgVMWClientMessage);\n      arr.push8(3);                        // Client caps message sub-type\n      arr.push16(8);                       // Length\n      arr.push32(caps);                    // Capability mask\n      this._sendBytes(arr);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendSessionClose\n *\n *    Send our VNCVMW session close request to the server.\n *\n * Results:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendSessionClose = function(closeReason) {\n   if (this._serverInitialized &&\n       this.useVMWSessionClose &&\n       this.options.enableVMWSessionClose) {\n      WMKS.LOGGER.log(\"Send session close to server.\");\n      var arr = [];\n      arr.push8(this.msgVMWClientMessage);\n      arr.push8(this.msgVMWSessionClose);\n      arr.push16(8);\n      arr.push32(closeReason);\n      this._sendBytes(arr);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _sendUpdateCacheInfo\n *\n *    Send our VMWUpdateCache cache sizes and capabilities to the server.\n *\n * Results:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._sendUpdateCacheInfo = function() {\n   \"use strict\";\n\n   var arr = [];\n   var flags = (this.updateCacheCapReplay |\n                this.updateCacheCapDisableOffscreenSurface);\n   if (this.options.enableSubRectangleCache) {\n       flags |= this.updateCacheCapSubRectangle;\n   }\n   var cacheSizeEntries = this.options.cacheSizeEntries;\n   var cacheSizeKB = this.options.cacheSizeKB;\n   WMKS.LOGGER.trace('sendUpdateCacheInfo');\n   arr.push8(this.msgVMWClientMessage);\n   arr.push8(11);                        // VNCVMWUpdateCacheInfoID\n   arr.push16(14);                       // Length\n   arr.push32(flags);\n   arr.push16(cacheSizeEntries);\n   arr.push32(cacheSizeKB);\n   this._sendBytes(arr);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleServerCapsMsg\n *\n *    Parses a VNC VMW server caps message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Might request a change to the client resolution.\n *    Will trigger the sending of our client capabilities.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleServerCapsMsg = function () {\n   var caps = this._readInt32();\n   this.useVMWKeyEvent = !!(caps & this.serverCapKeyEvent);\n   /*\n    * serverCapKeyEvent2Unicode, serverCapKeyEvent2JSKeyCode indicates that\n    * unicode and raw JS keyCode inputs are handled by the server and\n    * options.useUnicodeKeyboardInput indicates that the client\n    * should use unicode if possible. The flag allowVMWKeyEventUnicode is set\n    * when the above 3 value are true.\n    */\n   this.allowVMWKeyEvent2UnicodeAndRaw =\n      this.options.useUnicodeKeyboardInput &&\n      !!(caps & this.serverCapKeyEvent2Unicode) &&\n      !!(caps & this.serverCapKeyEvent2JSKeyCode);\n\n   this.useVMWAck      = !!(caps & this.serverCapUpdateAck);\n   this.useVMWRequestResolution = !!(caps & this.serverCapRequestResolution);\n   this.useVMWRequestStreamState = !!(caps & this.serverCapRequestStreamState);\n   this.useVMWRequestMultiMon = !!(caps & this.serverCapMultiMon);\n   this.useVMWAudioAck = !!(caps & this.serverCapAudioAck);\n   this.useVMWSessionClose = !!(caps & this.serverCapSessionClose);\n   this.serverSupportsMKSVChanClipboard = !!(caps & this.serverCapHasMKSVChanClipboard);\n\n   /*\n    * If we have already been asked to send a resolution request\n    * to the server, this is the point at which it becomes legal\n    * to do so.\n    */\n   if (this.useVMWRequestResolution &&\n      this.requestedWidth > 0 &&\n      this.requestedHeight > 0) {\n      this.onRequestResolution(this.requestedWidth,\n                               this.requestedHeight);\n   }\n\n   this.options.onMultimonCapacityUpdated(this.useVMWRequestMultiMon);\n\n   if (caps & this.serverCapClientCaps) {\n      this._sendClientCaps();\n   }\n\n   if (caps & this.serverCapUpdateCacheInfo) {\n      this._sendUpdateCacheInfo();\n   }\n\n   if ((caps & this.serverCapDisablingCopyUI) ||\n       (caps & this.serverCapDisablingPasteUI)) {\n      var noCopyUI = 0;\n      var noPasteUI = 0;\n      if (caps & this.serverCapDisablingCopyUI) {\n         noCopyUI = 1;\n      }\n      if (caps & this.serverCapDisablingPasteUI) {\n         noPasteUI = 1;\n      }\n      this.options.onUpdateCopyPasteUI(noCopyUI, noPasteUI);\n   }\n\n   this._getNextServerMessage();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleServerHeartbeatMsg\n *\n *    Parses a VNC VMW server heartbeat message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Calls the user-provided callback for heartbeat events.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleServerHeartbeatMsg = function () {\n   var interval = this._readInt16();\n   this.options.onHeartbeat(interval);\n   this._getNextServerMessage();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleSessionCloseMsg\n *\n *    Parses a VNC VMW server session close message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Calls the user-provided callback for session close events.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleSessionCloseMsg = function () {\n   var closeReason = this._readInt32();\n   this.options.onBeforeDisconnected(closeReason);\n   this._getNextServerMessage();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleAudioMixer\n *\n *    Parses a VNC VMW server audio mixer message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Calls the user-provided callback for audio mixer events.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleAudioMixer = function () {\n   var channelId = this._readInt32();\n   var msgType = this._readInt32();\n   var data = this._readInt32();\n   var flags = this._readInt32();\n\n   /*\n    * We don't support more than 2 channels at this time. i.e. stereo or mono.\n    * msgType 0: volume mute 1: volume change\n    */\n   if (channelId < 2 && (msgType === 0 || msgType === 1)) {\n      this.options.onAudioMixer({channelId: channelId,\n                                   msgType: msgType,\n                                      data: data,\n                                     flags: flags});\n   } else {\n      WMKS.LOGGER.warn(\"Ignoring audio mixer message for an unsupported \" +\n                       \" channelId = \" + channelId +\n                       \" msgType = \" + msgType +\n                       \" data = \" + data +\n                       \" flags = \" + flags);\n   }\n\n   this._getNextServerMessage();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleServerSetReconnectToken\n *\n *    Parses a VNC VMW server setReconnectToken message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Calls the user-provided callback for setReconnectToken events.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleServerSetReconnectTokenMsg = function (len) {\n   var token = this._readString(len);\n   this.options.onSetReconnectToken(token);\n   console.error(\"token: \" + token);\n   this._getNextServerMessage();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleServerAudioMsg\n *\n *    Parses a VNC VMW server audio message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Reads the audio data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleServerAudioMsg = function () {\n   var length = this._readInt32();\n   var sampleRate = this._readInt32();\n   var numChannels = this._readInt32();\n   var sampleSize = this._readInt32();\n   var containerSize = this._readInt32();\n   var timestampL = this._readInt32();\n   var timestampH = this._readInt32();\n   var flags = this._readInt32();\n\n   var audioInfo = {sampleRate: sampleRate,\n                    numChannels: numChannels,\n                    containerSize: containerSize,\n                    sampleSize: sampleSize,\n                    length: length,\n                    audioTimestampLo: timestampL,\n                    audioTimestampHi: timestampH,\n                    frameTimestampLo: this._frameTimestampLo,\n                    frameTimestampHi: this._frameTimestampHi,\n                    flags: flags,\n                    data: null};\n\n   this._setReadCB(length, this._handleServerAudioMsgData, audioInfo);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleServerAudioMsgData\n *\n *    Reads VNC VMW audio data.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Calls the user-provided callback for audio events.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleServerAudioMsgData = function (audioInfo) {\n   if (audioInfo.length > 0) {\n      audioInfo.data = this._readBytes(audioInfo.length);\n      /*\n       * Web client and native client should have the same behavior on\n       * audio ack (native client: VNCDecodeReadAudio). Old servers and\n       * new servers behave differently though because new servers check\n       * the client audioack capability flag. Here is the detail:\n       *\n       * Old servers:\n       *\n       * ServerCap (useVMWAudioAck) can be true of false. The audioInfo.flags\n       * is always set to zero. Hence audioflagRequestAck flag is neglected for\n       * old servers. We send audio acks purely depending on whether the server\n       * supports audioack or not.\n       *\n       * New servers:\n       *\n       * ServerCap (useVMWAudioAck) is always set to true. The audioInfo.flags\n       * contains the audiotype in the most significant 8 bits. So this flag\n       * is supposed to be non-zero. If the audioflagRequestAck bit is set,\n       * we send audio ack. Otherwise we don't send audio ack.\n       *\n       * A special case for new server is client does not specify audiotype, In\n       * this rare case, we always send audio ack.\n       */\n      if (this.useVMWAudioAck &&\n          (audioInfo.flags == 0 ||\n          (audioInfo.flags & this.audioflagRequestAck))) {\n         this._sendAudioAck(audioInfo.audioTimestampLo,\n                            audioInfo.audioTimestampHi);\n      }\n      this.options.onAudio(audioInfo);\n   } else {\n      WMKS.LOGGER.info(\"Audio data length is 0.\");\n   }\n   this._getNextServerMessage();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleServerCutText\n *\n *    Parses a server cut text message.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Calls the user-provided callback for cut text (copy) events.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleServerCutText = function (length) {\n   var txt = this._readStringUTF8(length);\n   this.options.onCopy(txt);\n   this._getNextServerMessage();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _handleServerMsg\n *\n *    Parses a VNC message header and dispatches it to the correct callback.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Parses first byte of a message (type ID).\n *    Sets next parser callback.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._handleServerMsg = function () {\n   var length, c, red, green, blue;\n   var self = this;\n   var msgType = this._readByte();\n\n   switch (msgType) {\n   case this.msgFramebufferUpdate:\n      this._setReadCB(3, this._framebufferUpdate);\n      break;\n   case this.msgSetColorMapEntries:\n      var getNumColors = function () {\n         self._skipBytes(3);\n         var numColors = self._readInt16();\n         // XXX: just ignoring incoming colors\n         self._setReadCB(6 * numColors, self._gobble, self._getNextServerMessage);\n      };\n      this._setReadCB(5, getNumColors);\n      break;\n   case this.msgRingBell:\n      this._getNextServerMessage();\n      break;\n   case this.msgServerCutText:\n      var getServerCutTextHead = function () {\n         self._readBytes(3);  // Padding\n         length = self._readInt32();\n         if (length > 0) {\n            self._setReadCB(length, self._handleServerCutText, length);\n         } else {\n            self._getNextServerMessage();\n         }\n      };\n\n      this._setReadCB(8, getServerCutTextHead);\n      break;\n   case this.msgVMWSrvMessage:\n      var getVMWSrvMsgHead = function () {\n         var id = self._readByte();\n         var len = self._readInt16();\n\n         // VMWServerCaps\n         if (id === this.msgVMWSrvMessage_ServerCaps) {\n            if (len !== 8) {\n               self.options.onProtocolError();\n               return self.fail('invalid length message for id: ' + id + ', len: ' + len);\n            }\n            self._setReadCB(len - 4, self._handleServerCapsMsg);\n\n         // VMWHeartbeat\n         } else if (id === this.msgVMWSrvMessage_Heartbeat) {\n            if (len !== 6) {\n               self.options.onProtocolError();\n               return self.fail('invalid length message for id: ' + id + ', len: ' + len);\n            }\n            self._setReadCB(len - 4, self._handleServerHeartbeatMsg);\n\n         // VMWSetReconnectToken\n         } else if (id === this.msgVMWSrvMessage_SetReconnectToken) {\n            console.error(\"get setReconnectToken message\");\n            self._setReadCB(len - 4, self._handleServerSetReconnectTokenMsg,\n                            len - 4);\n\n         // VMWAudio\n         } else if (id === this.msgVMWSrvMessage_Audio) {\n            if (len !== 36) {\n               self.options.onProtocolError();\n               return self.fail('invalid length message for id: ' + id + ', len: ' + len);\n            }\n            self._setReadCB(len - 4, self._handleServerAudioMsg);\n\n         // VMWSessionClose\n         } else if (id === this.msgVMWSrvMessage_SessionClose) {\n            if (len !== 8) {\n               self.options.onProtocolError();\n               return self.fail('invalid length message for id: ' + id + ', len: ' + len);\n            }\n            self._setReadCB(len - 4, self._handleSessionCloseMsg);\n\n            // VMWAudioMixer\n         } else if (id === this.msgVMWSrvMessage_AudioMixer) {\n            if (len !== 20) {\n               self.options.onProtocolError();\n               return self.fail('invalid length message for id: ' + id + ', len: ' + len);\n            }\n            self._setReadCB(len - 4, self._handleAudioMixer);\n\n         // Unhandled message type -- just gobble it and move on.\n         } else {\n            var bytesLeft = len - 4;\n            if (bytesLeft === 0) {\n               self._getNextServerMessage();\n            } else {\n               self._setReadCB(bytesLeft, self._gobble, self._getNextServerMessage);\n            }\n         }\n      };\n\n      this._setReadCB(3, getVMWSrvMsgHead);\n      break;\n\n   default:\n      this.options.onProtocolError();\n      return this.fail('Disconnected: illegal server message type ' + msgType);\n   }\n\n};\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _processMessages\n *\n *    VNC message loop.\n *    Dispatches data to the specified callback(s) until nothing is left.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Calls dynamically specified callbacks.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype._processMessages = function () {\n   while (this._state === this.VNC_ACTIVE_STATE &&\n         this._receiveQueueBytesUnread() >= this.nextBytes) {\n      var nrBytes = this.nextBytes;\n      var before = this._receiveQueueBytesUnread();\n      this.nextFn(this.nextArg);\n      var after = this._receiveQueueBytesUnread();\n      if (nrBytes < before - after) {\n         return this.fail(\"decode overrun \" + nrBytes + \" vs \" +\n                          (before - after));\n      }\n   }\n};\n\n\n\n\n\n/** @public */\n\n/*\n *\n * Event handlers called from the UI\n *\n */\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * onMouseMove\n *\n *    Updates absolute mouse state internally and on the server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.onMouseMove = function (x, y) {\n   this._mouseX = x;\n   this._mouseY = y;\n\n   if (this._serverInitialized) {\n      this._mouseActive = true;\n      if (this._mouseTimer === null) {\n         this._sendMouseEvent();\n         this._mouseTimer = setTimeout(this.mouseTimeout,\n                                       this.mouseTimeResolution);\n      }\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * onMouseButton\n *\n *    Updates absolute mouse state internally and on the server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.onMouseButton = function (x, y, down, bmask) {\n   this._mouseX = x;\n   this._mouseY = y;\n   if (down) {\n      this._mouseButtonMask |= bmask;\n   } else {\n      this._mouseButtonMask &= ~bmask;\n   }\n   if (this._serverInitialized) {\n      this._mouseActive = true;\n      this._sendMouseEvent();\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * onKeyVScan\n *\n *    Sends a VMware VScancode key event to the server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.onKeyVScan = function (keysym, down) {\n   if (this._serverInitialized) {\n      var arr = [];\n      arr.push8(this.msgVMWClientMessage);\n      arr.push8(this.msgVMWKeyEvent);   // Key message sub-type\n      arr.push16(8);  // Length\n      arr.push16(keysym);\n      arr.push8(down);\n      arr.push8(0);   /// padding\n      this._sendBytes(arr);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * onVMWKeyUnicode\n *\n *    Sends the keycode to the server as is from the browser.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.onVMWKeyUnicode = function (key, down, raw) {\n   if (this._serverInitialized) {\n      var arr = [];\n      arr.push8(this.msgVMWClientMessage);\n      arr.push8(this.msgVMWKeyEvent2);    // VMW unicode key message sub-type\n      arr.push16(10);   // length\n      arr.push32(key);\n      arr.push8(down);\n      arr.push8(raw);\n      this._sendBytes(arr);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * onMouseWheel\n *\n *    Sends a VMware mouse wheel event to the server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.onMouseWheel = function(x, y, dx, dy) {\n   if (this._serverInitialized) {\n      var arr = [];\n      arr.push8(this.msgVMWClientMessage);\n      arr.push8(this.msgVMWPointerEvent2);    // Pointer event 2 message sub-type\n      arr.push16(19);  // Length\n      arr.push8(1);    // isAbsolute\n      arr.push32(x);\n      arr.push32(y);\n      arr.push32(0);\n      arr.push8(dy);\n      arr.push8(dx);\n      this._sendBytes(arr);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * onRequestResolution\n *\n *    Schedules a rate-limited VMware resolution request from client\n *    to server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.onRequestResolution = function(width, height) {\n   if (this._serverInitialized &&\n       this.useVMWRequestResolution &&\n       (width !== this.requestedWidth || height !== this.requestedHeight)) {\n\n      this.resolutionRequestActive = true;\n\n      /*\n       * Cancel any previous timeout and start the clock ticking\n       * again.  This means that opaque window resizes will not\n       * generate intermediate client->server messages, rather we will\n       * wait until the user has stopped twiddling for half a second\n       * or so & send a message then.\n       */\n      clearTimeout(this.resolutionTimer);\n      this.resolutionTimer = setTimeout(this.resolutionTimeout,\n                                        this.resolutionDelay);\n      this.requestedWidth = width;\n      this.requestedHeight = height;\n      this._isInMultimonMode = false;\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * onRequestTopology\n *\n *    Send topology request from client\n *    to server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.onRequestTopology = function(multiMonRects) {\n   // reset status since switch to multimon\n   this.requestedWidth = 0;\n   this.requestedHeight = 0;\n\n   if (this._serverInitialized && this.useVMWRequestMultiMon) {\n      WMKS.LOGGER.log(\"Calling _sendTopologyRequest with arg:\" +\n         JSON.stringify(multiMonRects));\n      this._sendTopologyRequest(multiMonRects);\n      this._isInMultimonMode = true;\n   }\n};\n\n\n/*\n *\n * Connection handling\n *\n */\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * disconnect\n *\n *    Tears down the WebSocket and discards internal state.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    See above.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.disconnect = function () {\n   \"use strict\";\n\n   if (this._state !== this.DISCONNECTED) {\n      this._state = this.DISCONNECTED;\n      if (this._mp4Decoder) {\n         this._mp4Decoder.reset();\n         this._mp4Decoder = null;\n      }\n      if (this._isInMultimonMode) {\n         if (this._customRendererEnabled()) {\n            this._multimonRenderer.reset();\n         }\n         this._isInMultimonMode = false;\n      }\n      this._multimonRenderer = null;\n      this._receiveQueueReset();\n      this.rects = 0;\n      this._receivedFirstUpdate = false;\n\n      if (this._websocket) {\n         // User initialized closed.\n         this._sendSessionClose(23);\n         this._websocket.onopen    = null;\n         this._websocket.onclose   = null;\n         this._websocket.onmessage = null;\n         this._websocket.onerror   = null;\n         this._websocket.close();\n         delete this._websocket;\n      }\n      this._serverInitialized = false;\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * connect\n *\n *    Initialises the client and connects to the server.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Resets state and connects to the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.connect = function (destinationUrl) {\n   var self = this;\n\n   this.setRenderCanvas(this.options.canvas);\n   this._mediaPlayer = this.options.mediaPlayer;\n\n   /*\n    * This closure is run whenever the handler indicates it's\n    * completed its decoding pass. We use it to indicate to the\n    * server that we've decoded this request if this is the last\n    * rect in the update.\n    */\n   this.onDecodeComplete = function () {\n      self.rectsDecoded++;\n      if (self.rectsDecoded === self.rects && self.rectsRead === self.rects) {\n         self._state = self.FBU_DECODING_STATE;\n         self._executeRects();\n      }\n   };\n\n   this.onDecodeObjectURLComplete = function() {\n      URL.revokeObjectURL(this.src);\n      self.onDecodeComplete();\n   };\n\n   this.onDecodeMP4Error = function() {\n      /*\n       * If server receives the client encoding request, it is going to\n       * invalidate current encoding region and client will receive a full\n       * frame update.\n       */\n      var mediaPlayer = self.options.mediaPlayer;\n      WMKS.LOGGER.log(\"Resetting stream request is sent.\");\n\n      // Disable H.264 cap.\n      self.options.mediaPlayer = null;\n      self._sendClientEncodingsMsg();\n      // Enable H.264 cap.\n      self.options.mediaPlayer = mediaPlayer;\n      self._sendClientEncodingsMsg();\n   };\n\n   this.msgTimeout = function() {\n      self._state = self.VNC_ACTIVE_STATE;\n      self._processMessages();\n   };\n\n   this.mouseTimeout = function() {\n      self._mouseTimer = null;\n      if (self._mouseActive) {\n         self._sendMouseEvent();\n         self._mouseTimer = setTimeout(self.mouseTimeout, self.mouseTimeResolution);\n      }\n   };\n\n   /*\n    * Timer callback to limit the rate we send resolution-request\n    * packets to the server.  No more than once a second is plenty.\n    */\n   this.resolutionTimeout = function() {\n      if (self.resolutionRequestActive) {\n         self._sendResolutionRequest();\n         self.resolutionRequestActive = false;\n      }\n   };\n\n   if (this.options.VCDProxyHandshakeVmxPath) {\n      this._setReadCB(17, this._handleVCDProxyVmxPathMessage);\n   } else {\n      this._setReadCB(12, this._peekFirstMessage);\n   }\n\n   this._url = destinationUrl;\n   this._receiveQueueReset();\n\n   this.wsOpen = function (evt) {\n      self._state = self.VNC_ACTIVE_STATE;\n      if (this.protocol !== \"binary\" &&\n          this.protocol !== \"vmware-vvc\") {\n         return this.fail(\"no agreement on protocol\");\n      }\n\n      if (this.protocol === \"vmware-vvc\") {\n         self._setupVVC();\n         WMKS.LOGGER.log('WebSocket is using VMware Virtual Channels');\n         this.protocol = \"binary\";\n      }\n\n      if (this.protocol === \"binary\") {\n         this.binaryType = \"arraybuffer\";\n         WMKS.LOGGER.log('WebSocket HAS binary support');\n      }\n\n      // Note: this is after _setupVVC() in case the UI wants to add vvc listeners.\n      self.options.onConnecting(self.vvc, self.vvcSession);\n\n      WMKS.LOGGER.log('WebSocket created protocol: ' + this.protocol);\n   };\n\n   this.wsClose = function (evt) {\n      self.options.onDisconnected(evt.reason, evt.code);\n   };\n\n   this.wsMessage = function (evt) {\n      if (typeof evt.data !== \"string\") {\n         // This should always be the case, as the protocol is now\n         // always binary.\n         self._receiveQueue.push(evt);\n         self._receiveQueueLength += evt.data.byteLength;\n      } else {\n         return self.fail(\"non-binary message\");\n      }\n      self._processMessages();\n   };\n\n   this.wsError = function (evt) {\n      self.options.onError(evt);\n   };\n\n   this.protocolList = [\"binary\"];\n\n   if (this.options.enableVVC) {\n      this.protocolList.push(\"vmware-vvc\");\n   }\n\n   this._setupConnection = function () {\n      self._websocket = WMKS.WebSocket(self._url, self.protocolList);\n      self._websocket.onopen = self.wsOpen;\n      self._websocket.onclose = self.wsClose;\n      self._websocket.onmessage = self.wsMessage;\n      self._websocket.onerror = self.wsError;\n   };\n\n   this._setupVVC = function() {\n      self.vvc = new VVC();\n      self.vvcSession = self.vvc.openSession(self._websocket);\n\n      self.vvcSession.onerror = function(status) {\n         self.vvcSession.close();\n      };\n\n      self.vvcSession.ontransportclose = function(evt) {\n         self.wsClose(evt);\n      };\n\n      self.vvcSession.ontransporterror = function(evt) {\n         self.wsError(evt);\n      };\n\n      var listener = self.vvc.createListener(self.vvcSession, \"blast-*\");\n\n      listener.onpeeropen = function(session, channel) {\n         if (channel.name === \"blast-mks\") {\n            channel.onclose = function(evt) {\n               session.close();\n               self._websocket = null;\n               self.disconnect();\n            };\n\n            channel.onerror = function(evt) {\n               session.close();\n               self._websocket = null;\n               self.disconnect();\n            };\n\n            self._websocket   = channel;\n            channel.onmessage = self.wsMessage;\n            session.acceptChannel(channel);\n         } else if (channel.name === \"blast-audio\") {\n            channel.onclose = function(evt) {\n               session.close();\n            };\n\n            channel.onerror = function(evt) {\n               session.close();\n            };\n\n            channel.onmessage = self.wsMessage;\n            session.acceptChannel(channel);\n         }\n      };\n   }\n\n   this._retryConnectionTimeout = function() {\n      if (self._state === self.DISCONNECTED) {\n         WMKS.LOGGER.log(\"Connection timeout. Retrying now.\");\n         if (self._websocket) {\n            self._websocket.onclose = function() {};\n            self._websocket.close();\n            self._websocket = null;\n         }\n         self._setupConnection();\n      }\n      self._retryConnectionTimer = null;\n   };\n\n   if (this.options.enableUint8Utf8) {\n      addUint8Utf8(this);\n   }\n\n   this._setupConnection();\n\n   if (this.options.retryConnectionInterval > 0) {\n      // only retry once here.\n      WMKS.LOGGER.log(\"Check connection status after \" +\n                       this.options.retryConnectionInterval + \"ms.\");\n      this._retryConnectionTimer =\n         setTimeout(this._retryConnectionTimeout,\n                    this.options.retryConnectionInterval);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * setRenderCanvas\n *\n *    Set the canvas that is used to render the image data. Used by the\n *    analyzer to redirect pixel data to a backbuffer.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    This canvas is also used as the source for blits, so it should be set\n *    early on and not modified externally afterwards.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.setRenderCanvas = function (rc) {\n   this._canvas[0] = rc;\n   this._canvas[0].ctx = rc.getContext('2d');\n\n   if (!this._canvas[0].ctx.createImageData) {\n      throw(\"no canvas imagedata support\");\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * setAudioStreamEnabled\n *\n *    Send a message to the server to enable or disable sending of audio data.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *    Can affect whether we receive audio data from the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.setAudioStreamEnabled = function(enable) {\n   if (enable) {\n      this._streamState &= ~this.streamStateDisableAudio;\n   } else {\n      this._streamState |= this.streamStateDisableAudio;\n   }\n\n   this._sendRequestStreamState(this._streamState);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * setVideoStreamEnabled\n *\n *    Send a message to the server to enable or disable sending of video data.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *    Can affect whether we receive video data from the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.VNCDecoder.prototype.setVideoStreamEnabled = function(enable) {\n   if (enable) {\n      this._streamState &= ~this.streamStateDisableVideo;\n   } else {\n      this._streamState |= this.streamStateDisableVideo;\n   }\n\n   this._sendRequestStreamState(this._streamState);\n};\n// Use the following for js-lint.\n/*global WMKS:false, Base64:false, stringFromArray:false, arrayFromString:false*/\n/*jshint bitwise:false*/\n\n/*\n * wmks/vncProtocolUint8Utf8.js\n *\n *   Calling addUint8Utf8 with an WMKS.VNCDecoder instance will restore\n *   the legacy uint8utf8 support.\n *\n *   Most functions are only monkey patched if the protocol is uint8utf8,\n *   leaving the normal functionality unchanged. This is a temporary fix\n *   until uint8utf8 support can be updated to convert to ArrayBuffers\n *   instead of the older string based receiveQueue.\n */\nfunction addUint8Utf8(vncDecoder) {\n   'use strict';\n\n   WMKS.LOGGER.debug('adding uint8utf8 support');\n   var self = vncDecoder;\n\n   if (!self.hasOwnProperty('_legacyReceiveQueue')) {\n      self._legacyReceiveQueue = '';\n      self._legacyReceiveQueueIndex = '';\n   }\n\n   self.useLegacy = false;\n\n\n   var legacyFunctions = {};\n\n   /*\n    *\n    * RX/TX queue management\n    *\n    */\n   legacyFunctions._receiveQueueBytesUnread = function () {\n      return this._legacyReceiveQueue.length - this._legacyReceiveQueueIndex;\n   };\n\n   legacyFunctions._receiveQueueConsumeBytes = function (nr) {\n      this._legacyReceiveQueueIndex += nr;\n   };\n\n   legacyFunctions._receiveQueueReset = function () {\n      this._legacyReceiveQueue = '';\n      this._legacyReceiveQueueIndex = 0;\n   };\n\n   legacyFunctions._readString = function (stringLength) {\n      var string = this._legacyReceiveQueue.slice(this._legacyReceiveQueueIndex,\n                                                  this._legacyReceiveQueueIndex + stringLength);\n      this._legacyReceiveQueueIndex += stringLength;\n      return string;\n   };\n\n\n\n\n   /*\n    *------------------------------------------------------------------------------\n    *\n    * _readStringUTF8\n    *\n    *    Pops the first 'stringLength' bytes from the front of the read buffer\n    *    and parses the string for unicode. If it finds unicode, it converts them\n    *    to unicode and returns the unicode string.\n    *\n    * Results:\n    *    A unicode string thats as long as 'stringLength' in case of non-unicodes\n    *    or shorter.\n    *\n    * Side Effects:\n    *    Advances receive buffer.\n    *\n    *------------------------------------------------------------------------------\n    */\n\n   legacyFunctions._readStringUTF8 = function (stringLength) {\n      var c, c1, c2, c3, valArray = [],\n          i = this._legacyReceiveQueueIndex;\n      while (i < this._legacyReceiveQueueIndex + stringLength) {\n         c = this._legacyReceiveQueue.charCodeAt(i);\n         if (c < 128) {\n            // Handle non-unicode string here.\n            valArray.push(c);\n            i++;\n         } else if (c < 224) {\n            c1 = this._legacyReceiveQueue.charCodeAt(i+1) & 63;\n            valArray.push(((c & 31) << 6) | c1);\n            i += 2;\n         } else if (c < 240) {\n            c1 = this._legacyReceiveQueue.charCodeAt(i+1) & 63;\n            c2 = this._legacyReceiveQueue.charCodeAt(i+2) & 63;\n            valArray.push(((c & 15) << 12) | (c1 << 6) | c2);\n            i += 3;\n         } else {\n            c1 = this._legacyReceiveQueue.charCodeAt(i+1) & 63;\n            c2 = this._legacyReceiveQueue.charCodeAt(i+2) & 63;\n            c3 = this._legacyReceiveQueue.charCodeAt(i+3) & 63;\n            valArray.push(((c & 7) << 18) | (c1 << 12) | (c2 << 6) | c3);\n            i += 4;\n         }\n      }\n\n      this._legacyReceiveQueueIndex += stringLength;\n      // WMKS.LOGGER.warn(valArray + ' :arr, str: ' + String.fromCharCode.apply(String, valArray));\n      // Apply all at once is faster: http://jsperf.com/string-fromcharcode-apply-vs-for-loop\n      return String.fromCharCode.apply(String, valArray);\n   };\n\n\n   /*\n    *------------------------------------------------------------------------------\n    *\n    * _readByte\n    *\n    *    Pops the first byte from the front of the receive buffer.\n    *\n    * Results:\n    *    First byte of the receive buffer.\n    *\n    * Side Effects:\n    *    Advances receive buffer.\n    *\n    *------------------------------------------------------------------------------\n    */\n\n   legacyFunctions._readByte = function () {\n      var aByte = this._legacyReceiveQueue.charCodeAt(this._legacyReceiveQueueIndex);\n      this._legacyReceiveQueueIndex += 1;\n      return aByte;\n   };\n\n\n   /*\n    *------------------------------------------------------------------------------\n    *\n    * _readBytes\n    *\n    *    Pops the first 'length' bytes from the front of the receive buffer.\n    *\n    * Results:\n    *    Array of 'length' bytes.\n    *\n    * Side Effects:\n    *    Advances receive buffer.\n    *\n    *------------------------------------------------------------------------------\n    */\n\n   legacyFunctions._readBytes = function (length) {\n      var result, i;\n\n      result = new Array(length);\n\n      for (i = 0; i < length; i++) {\n         result[i] = this._legacyReceiveQueue.charCodeAt(i + this._legacyReceiveQueueIndex);\n      }\n\n      this._legacyReceiveQueueIndex += length;\n      return result;\n   };\n\n\n   /*\n    *------------------------------------------------------------------------------\n    *\n    * _sendString\n    *\n    *    Sends a string to the server, using the appropriate encoding.\n    *\n    * Results:\n    *    None.\n    *\n    * Side Effects:\n    *    Sends data.\n    *\n    *------------------------------------------------------------------------------\n    */\n\n   legacyFunctions._sendString = function (stringValue) {\n      if (!this._websocket) {\n         return;\n      }\n\n      this._websocket.send(stringValue);\n   };\n\n\n   /*\n    *------------------------------------------------------------------------------\n    *\n    * _sendBytes\n    *\n    *    Sends the array 'bytes' of data bytes to the server.\n    *\n    * Results:\n    *    None.\n    *\n    * Side Effects:\n    *    Sends data.\n    *\n    *------------------------------------------------------------------------------\n    */\n\n   legacyFunctions._sendBytes = function (bytes) {\n      this._sendString(stringFromArray(bytes));\n   };\n\n\n\n\n   /*\n    *\n    * Client message sending\n    *\n    */\n\n\n\n   /*\n    *------------------------------------------------------------------------------\n    *\n    * _sendClientEncodingsMsg\n    *\n    *    Sends the server a list of supported image encodings.\n    *    This is a temporary override to disabled encTightDiffComp\n    *    until it can be better tested and potentially updated.\n    *\n    * Results:\n    *    None.\n    *\n    * Side Effects:\n    *    Sends data.\n    *\n    *------------------------------------------------------------------------------\n    */\n\n   legacyFunctions._sendClientEncodingsMsg = function () {\n      var i;\n      var encodings = [/* this.encTightDiffComp, */\n         this.encTightPNG,\n         this.encDesktopSize,\n         this.encVMWDefineCursor,\n         this.encVMWCursorState,\n         this.encVMWCursorPosition,\n         this.encVMWTypematicInfo,\n         this.encVMWLEDState,\n         this.encVMWServerPush2,\n         this.encVMWServerCaps,\n         this.encTightJpegQuality10,\n         this.encVMWFrameStamp,\n         this.encUpdateCache];\n\n\n      if (this.options.mediaPlayer) {\n         encodings.unshift(this.encH264MP4);\n      }\n\n      if (this._canvas[1]) {\n         encodings = [this.encOffscreenCopyRect].concat(encodings);\n      }\n\n      /*\n       * Blits seem to work well on most browsers now.\n       */\n      encodings = [this.encCopyRect].concat(encodings);\n\n      var message = [];\n      message.push8(this.msgClientEncodings);\n      message.push8(0);\n      message.push16(encodings.length);\n      for (i = 0; i < encodings.length; i += 1) {\n         message.push32(encodings[i]);\n      }\n      this._sendBytes(message);\n   };\n\n   /*\n    *\n    * Framebuffer updates\n    *\n    */\n\n\n   /*\n    *------------------------------------------------------------------------------\n    *\n    * _readTightData\n    *\n    *    Parses a compressed FB update payload.\n    *\n    * Results:\n    *    None.\n    *\n    * Side Effects:\n    *    Sets next parser callback.\n    *\n    *------------------------------------------------------------------------------\n    */\n\n   legacyFunctions._readTightData = function (rect) {\n      /*\n       * Skip the preamble and read the actual JPEG data.\n       */\n      var type = (rect.subEncoding === this.subEncPNG) ? 'image/png' : 'image/jpeg',\n          data = this._readString(this.nextBytes),\n          URL  = window.URL || window.webkitURL,\n          self = this;\n\n      if (this._useImageBitmaps) {\n         data = arrayFromString(data, true);\n         createImageBitmap(new Blob([data], {type: type}))\n            .then(function (imageBitmap) {\n               rect.image = imageBitmap;\n               self.onDecodeComplete();\n            });\n      } else {\n         /*\n          * Construct an Image and keep a reference to it in the\n          * rectangle object. Since Images are loaded asynchronously\n          * we can't draw it until the image has finished loading so\n          * we don't call onDecodeComplete() until this has happened.\n          */\n         rect.image = this._imageManager.getImage();\n         rect.image.width = rect.width;\n         rect.image.height = rect.height;\n         rect.image.destX = rect.x;\n         rect.image.destY = rect.y;\n\n         if (URL) {\n            data = arrayFromString(data, true);\n            rect.image.onload = this.onDecodeObjectURLComplete;\n            rect.image.src = URL.createObjectURL(new Blob([data], {type: type}));\n         } else {\n            data = Base64.encodeFromString(data);\n            rect.image.onload = this.onDecodeComplete;\n            rect.image.src = 'data:' + type + ';base64,' + data;\n         }\n      }\n\n      this._nextRect();\n   };\n\n\n   /*\n    *------------------------------------------------------------------------------\n    *\n    * _peekFirstMessage\n    *\n    *    We have built and deployed two sorts of VNC servers, those that\n    *    expect an RFB 003.008 and VNC authentication handshake, and\n    *    those which jump straight into the VNC protocol at the\n    *    serverInitialized message.  Previously we had to switch the\n    *    client between these two modes, but it is possible to build a\n    *    single client which can talk to both types of server simply by\n    *    examining the size of the first message we receive.\n    *\n    *    Note that this is a very robust detection method - the server is\n    *    required in each case to send a message of a specific size on\n    *    connection establishment.  We are lucky that the two messages\n    *    are of different sizes.\n    *\n    * Results:\n    *    None.\n    *\n    * Side Effects:\n    *    Sets next parser callback.\n    *\n    *------------------------------------------------------------------------------\n    */\n\n   legacyFunctions._peekFirstMessage = function () {\n      this.usedVNCHandshake = (this._receiveQueueBytesUnread() == 12);\n      if (this.usedVNCHandshake) {\n         this._setReadCB(12, this._handleProtocolVersionMsg);\n      } else {\n         this._setReadCB(24, this._handleServerInitializedMsg);\n      }\n   };\n\n\n\n   function replaceFunctions(vncDecoder) {\n      WMKS.LOGGER.trace('uint8utf8: replacing functions');\n      vncDecoder._originalFunctions = vncDecoder._originalFunctions || {};\n\n      for (var functionName in legacyFunctions) {\n         if(legacyFunctions.hasOwnProperty(functionName)){\n            if (!vncDecoder._originalFunctions[functionName]) {\n               //Save reference to original\n               vncDecoder._originalFunctions[functionName] = vncDecoder[functionName];\n            }\n            vncDecoder[functionName] = legacyFunctions[functionName];\n         }\n      }\n   }\n\n   function restoreFunctions(vncDecoder) {\n      WMKS.LOGGER.trace('restoreFunctions');\n      if (!vncDecoder._originalFunctions) {\n         return;\n      }  //never replaced\n\n      for (var functionName in vncDecoder._originalFunctions) {\n         if(vncDecoder._originalFunctions.hasOwnProperty(functionName)){\n            vncDecoder[functionName] = vncDecoder._originalFunctions[functionName];\n         }\n      }\n   }\n\n   self.wsOpen = function (evt) {\n\n      self._state = self.VNC_ACTIVE_STATE;\n      if (this.protocol !== 'uint8utf8' &&\n          this.protocol !== 'binary' &&\n          this.protocol !== 'vmware-vvc') {\n         return self.fail('no agreement on protocol');\n      }\n\n      if (this.protocol === 'vmware-vvc') {\n         self._setupVVC();\n         WMKS.LOGGER.log('WebSocket is using VMware Virtual Channels');\n         this.protocol = 'binary';\n      }\n\n      if (this.protocol === 'binary') {\n         this.binaryType = 'arraybuffer';\n         WMKS.LOGGER.log('WebSocket HAS binary support');\n      }\n\n      self.useLegacy = (this.protocol === 'uint8utf8');\n\n      if (self.useLegacy) {\n         replaceFunctions(self);\n      } else{\n         restoreFunctions(self);\n      }\n\n      // Note: this is after _setupVVC() in case the UI wants to add vvc listeners.\n      self.options.onConnecting(self.vvc, self.vvcSession);\n\n      WMKS.LOGGER.log('WebSocket created protocol: ' + this.protocol);\n   };\n\n\n   var wsMessageOriginal = self.wsMessage;\n   self.wsMessage = function (evt) {\n      if (!self.useLegacy) { return wsMessageOriginal.apply(this, arguments); }\n\n      if (self._legacyReceiveQueueIndex > self._legacyReceiveQueue.length) {\n         return self.fail('overflow receiveQueue');\n      } else if (self._legacyReceiveQueueIndex === self._legacyReceiveQueue.length) {\n         self._legacyReceiveQueue = '';\n         self._legacyReceiveQueueIndex = 0;\n      }\n\n      if (typeof evt.data !== 'string') {\n         var data = new Uint8Array(evt.data);\n         self._legacyReceiveQueue = self._legacyReceiveQueue.concat(stringFromArray(data));\n      } else {\n         self._legacyReceiveQueue = self._legacyReceiveQueue.concat(evt.data);\n      }\n      self._processMessages();\n   };\n\n\n   if (self.protocolList.indexOf('uint8utf8') === -1) {\n      self.protocolList.push('uint8utf8');\n   }\n   legacyFunctions._receiveQueueReset.call(self);\n}\n// Use the following for js-lint.\n/*global WMKS:false, $:false */\n\n/*\n *------------------------------------------------------------------------------\n *\n * wmks/keyboardManager.js\n *\n *   WebMKS related keyboard management is handled here.\n *   There are 2 types of inputs that can be sent.\n *\n *   1. VMware VScanCodes that are handled by the hypervisor.\n *   2. KeyCodes + unicode based messages for Blast+NGP.\n *\n *   The message type to be sent is determined by flags in vncDecoder:\n *      useVMWKeyEvent            // VMware VScanCode key inputs are handled.\n *      useVMWKeyEventUnicode     // unicode key inputs are handled.\n *\n *   Input handling is quite different for desktop browsers with physical\n *   keyboard vs soft keyboards on touch devices. To deal with these we use\n *   separate event handlers for keyboard inputs.\n *\n *------------------------------------------------------------------------------\n */\n\n/*\n * List of keyboard constants.\n */\nWMKS.CONST.KB = {\n\n   ControlKeys: [\n   /*\n    * backspace, tab, enter, shift, ctrl, alt, pause, caps lock, escape,\n    * pgup, pgdown, end, home, left, up, right, down, insert, delete,\n    * win-left(or meta on mac), win-right, menu-select(or meta-right), f1 - f12,\n    * num-lock, scroll-lock\n    */\n      8, 9, 13, 16, 17, 18, 19, 20, 27,\n      33, 34, 35, 36, 37, 38, 39, 40, 45, 46,\n      91, 92, 93, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123,\n      144, 145, 240\n   ],\n\n   /*\n    * If you change this, change 'vals' in syncModifiers.\n    * shift, ctrl, alt, win-left, win-right, cmd-left/cmd-right on Firefox\n    */\n   Modifiers:        [16, 17, 18, 91, 92],\n\n   WestEuroLanguage: ['de-DE','it-IT','es-ES','pt-BR', 'pt-PT', 'fr-FR', 'fr-CH', 'de-CH'],\n   /*\n    * List of characters to discard on an onKeyDown on Windows with Firefox\n    * 192 = VK_OEM_3\n    */\n   Diacritics:       [192],\n\n   KEY_CODE: {\n      Shift:         16,\n      Ctrl:          17,\n      Alt:           18,\n      Meta:          91,               // Mac left CMD key.\n      Enter:         13,\n      CapsLock:      20\n   },\n\n   SoftKBRawKeyCodes:      [8, 9, 13], // backspace, tab, newline\n   keyInputDefaultValue:   ' ',        // Default value for the input textbox.\n\n\n   ANSIShiftSymbols:    \"~!@#$%^&*()_+{}|:\\\"<>?\",  // ANSI US layout keys that require shift\n   ANSINoShiftSymbols:  \"`-=[]\\\\;',./1234567890\",  // ANSI US layout keys that do not require shift\n\n   WindowsKeys: {\n      left:  91,  // win-left(or meta on Mac, search on ChromeOS)\n      right: 92   // win-right\n   },\n\n   VScanMap: {}\n};\n\n// on windows system 224 is a normal key value\n\nif (WMKS.BROWSER.isMacOS()) {\n   WMKS.CONST.KB.Modifiers = [16, 17, 18, 91, 92, 224];\n}\n\n// Map of all ANSI special symbols\nWMKS.CONST.KB.ANSISpecialSymbols = WMKS.CONST.KB.ANSIShiftSymbols + WMKS.CONST.KB.ANSINoShiftSymbols;\n\nWMKS.KeyboardManager = function(options) {\n   'use strict';\n   if (!options || !options.vncDecoder) {\n      return null;\n   }\n\n   this._vncDecoder = options.vncDecoder;\n   // Any raw key that needs to be ignored.\n   this.ignoredRawKeyCodes = options.ignoredRawKeyCodes;\n   this.fixANSIEquivalentKeys = options.fixANSIEquivalentKeys;\n   this.mapMetaToCtrlForKeys = options.mapMetaToCtrlForKeys;\n\n   this.keyDownKeyTimer = null;\n   this.keyDownIdentifier = null;\n   this.pendingKey = null;\n   this.addCtrlKey = false;\n   this.activeModifiers = [];\n   this.keyToUnicodeMap = {};\n   this.keyToRawMap = {};\n   this.keyboardLayoutId = options.keyboardLayoutId;\n   // Use different map with mappings for all unicode --> vScanCode.\n   this.UnicodeToVScanMap = WMKS.CONST.KB.VScanMap[this.keyboardLayoutId];\n\n   this._windowsKeyManager = {\n      // Windows key simulation is enabled or not.\n      enabled: options.enableWindowsKey,\n      // Windows key is simulated when Ctrl + Windows are pressed.\n      windowsOn: false,\n      // left Windows key is down or not.\n      leftWindowsDown: false,\n      // right Windows key is down or not.\n      rightWindowsDown: false,\n      // modified keyCode map.\n      modifiedKeyMap: {\n         Pause : 19 // The keyCode of Pause key should be 19\n      },\n      modifiedKey: null,\n\n      /*\n       * reset\n       *\n       * It's important to do reset when the browser loses focus.\n       * Otherwise, some key release events are not captured when\n       * the browser loses focuse. In consequence, the states are incorrect.\n       */\n      reset: function() {\n        this.windowsOn = false;\n        this.leftWindowsDown = false;\n        this.rightWindowsDown = false;\n        this.modifiedKey = null;\n      },\n\n      /*\n       * keyboardHandler\n       *\n       * Handles Windows keydown and keyup event.\n       */\n      keyboardHandler: function(e) {\n         /*\n          * Fix bug 1492888 - Ctrl-Command doesn't work on Firefox\n          * On Firefox at Mac OS, left Command key and right Command key\n          * have the same value: 224. It differs from Webkit browsers.\n          * On Webkit browsers at Mac OS, left Command key is of value 91,\n          * while right Command key is of value 93. Since we can't differentiate\n          * left Command key from right Command key on Firefox of Mac OS,\n          * we generally assume a left Windows key is down.\n          */\n         if (e.keyCode === WMKS.CONST.KB.WindowsKeys.left || e.keyCode === 224) {\n            // Left Windows key is down or up.\n            this.leftWindowsDown = e.type === 'keydown';\n            if (!this.leftWindowsDown) {\n               // Left Windows key is released.\n               this.windowsOn = false;\n            }\n         } else if (e.keyCode === WMKS.CONST.KB.WindowsKeys.right) {\n            // Right Windows key is down or up.\n            this.rightWindowsDown = e.type === 'keydown';\n            if (!this.rightWindowsDown) {\n               // Right Windows key is released.\n               this.windowsOn = false;\n            }\n         }\n      },\n\n      /*\n       * modifyKey\n       *\n       * Invoked by _extractKeyCodeFromEvent. Modify some keyCode value\n       * when Windows key is held.\n       */\n      modifyKey: function(keyCode) {\n         /*\n          * Fix bug 1436247 - Windows+Pause doesn't work\n          * The keyCode of Pause key should be 19. However, when Ctrl key is pressed,\n          * Pause's keyCode is modified to 3. To fix this issue, at detecting keyCode\n          * 3 while Ctrl and Windows are pressed, convert it to 19 directly.\n          */\n         if (keyCode === 3) {\n            // Pause key with Ctrl emits 3.\n            if (this.windowsOn) {\n               // When Windows key is pressed, restore Pause key to 19.\n               keyCode = this.modifiedKeyMap['Pause'];\n               this.modifiedKey = 3;\n            } else if (this.modifiedKey === 3) {\n               // Pause key is released.\n               keyCode = this.modifiedKeyMap['Pause'];\n               this.modifiedKey = null;\n            }\n         }\n\n         return keyCode;\n      }\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _extractKeyCodeFromEvent\n    *\n    *    Attempts to extract the keycode from a given key{down,up} event.  The\n    *    value extracted may be a unicode value instead of a normal vk keycode.\n    *    If this is the case then the 'isUnicode' property will be set to true.\n    *    Additionally, in the unicode case, the caller should not expect a\n    *    corresponding keyPress event.\n    *\n    * Results:\n    *    If extraction succeeds, returns an object with 'keyCode' and\n    *    'isUnicode' properties, null otherwise.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._extractKeyCodeFromEvent = function(e) {\n      var keyCode = 0, isUnicode = false;\n\n      if (e.keyCode) {\n         keyCode = e.keyCode;\n         /*\n          * For pt-pt, when press  key on windows chrome, keycode is the same with\n          *   keypress keycode. Remap it.\n          */\n         if (this.keyboardLayoutId == \"pt-PT\" && WMKS.BROWSER.isChrome() &&\n            (e.keyCode === 186 || e.keyCode === 191) && WMKS.BROWSER.isWindows()) {\n            if(e.keyCode === 186) {\n               keyCode = 180;\n            } else {\n               keyCode = 126;\n            }\n         }\n         // After Firefox's update, the dead key has a keycode value on firefox.\n         if (this.keyboardLayoutId == \"de-DE\" &&e.keyCode == 192 && WMKS.BROWSER.isFirefox()) {\n            //keycodes are different on Chrome and Firefox on Mac\n            keyCode = 187;\n         }\n         if ((this.keyboardLayoutId === \"fr-CH\" || this.keyboardLayoutId === \"de-CH\")\n            && WMKS.BROWSER.isWindows() ) {\n            if (e.keyCode === 221 ) {\n               keyCode = 94;\n            }\n         }\n      } else if (e.which) {\n         keyCode = e.which;\n      } else if (e.keyIdentifier && e.keyIdentifier.substring(0, 2) === 'U+') {\n         /*\n          * Safari doesn't give us a keycode nor a which value for some\n          * keypresses. The only useful piece of a data is a Unicode codepoint\n          * string (something of the form U+0000) found in the keyIdentifier\n          * property. So fall back to parsing this string and sending the\n          * converted integer to the agent as a unicode value.\n          * See bugs 959274 and 959279.\n          */\n         keyCode = parseInt('0x' + e.keyIdentifier.slice(2), 16);\n         if (keyCode) {\n            isUnicode = true;\n         } else {\n            WMKS.LOGGER.log('assert: Unicode identifier=' + e.keyIdentifier\n                          + ' int conversion failed, keyCode=' + keyCode);\n            return null;\n         }\n      } else if (e.keyCode === 0 && WMKS.BROWSER.isFirefox() && e.key &&\n         this._vncDecoder.allowVMWKeyEvent2UnicodeAndRaw) {\n         /*\n          * On Firefox, for some special key such as   , the keyCode of\n          * onKeyUp and keyDown is 0, but there is a value in key property.\n          * See bug 1166133.\n           */\n         keyCode = 0;\n      } else {\n         if (!this._vncDecoder.allowVMWKeyEvent2UnicodeAndRaw) {\n            keyCode = this.handleInternationalKeyboard(e,keyCode);\n         }\n         if (this.keyboardLayoutId == \"ja-JP_106/109\" && !WMKS.BROWSER.isFirefox() &&\n            e.keyCode === 0) {\n            /*\n             * On browser except firefox in Japanese, for the special key\n             * left to 1 key, the keyCode of onKeyUp and keyDown\n             * is 0, and there is no value in key property.\n             */\n            keyCode = 165;\n         }\n         if (!keyCode) {\n            WMKS.LOGGER.trace('assert: could not read keycode from event, '\n                       + 'keyIdentifier=' + e.keyIdentifier);\n            return null;\n         }\n      }\n\n      if (!isUnicode && this._windowsKeyManager.enabled) {\n         keyCode = this._windowsKeyManager.modifyKey(keyCode);\n      }\n\n      return {\n         keyCode: keyCode,\n         isUnicode: isUnicode\n      };\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * onKeyDown\n    *\n    *    The first step in our input strategy. Capture a raw key. If it is a\n    *    control key, send a keydown command immediately. If it is not, memorize\n    *    it and return without doing anything. We pick it up in onKeyPress\n    *    instead and bind the raw keycode to the Unicode result. Then, in\n    *    onKeyUp, resolve the binding and send the keyup for the Unicode key\n    *    when the scancode is received.\n    *\n    * Results:\n    *    true if the key is non-raw (let the event through, to allow keypress\n    *    to be dispatched.) false otherwise.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.onKeyDown = function(e) {\n      var keyCodeRes,\n          keyCode = 0,\n          isUnicode = false,\n          self = this;\n\n      keyCodeRes = this._extractKeyCodeFromEvent(e);\n\n      if (!keyCodeRes) {\n         WMKS.LOGGER.log('Extraction of keyCode from keyUp event failed.');\n         return false; // don't send a malformed command.\n      }\n      keyCode = keyCodeRes.keyCode;\n      isUnicode = keyCodeRes.isUnicode;\n\n      //WMKS.LOGGER.log(\"onKeyDown: keyCode=\" + keyCode);\n\n      // Sync modifiers because we don't always get correct events.\n      this._syncModifiers(e);\n\n      if (keyCode === 0) {\n         WMKS.LOGGER.log(\"onKeyDown: Do not send 0 to server.\");\n         return true;\n      }\n\n      /*\n       * Most control characters are 'dangerous' if forwarded to the underlying\n       * input mechanism, so send the keys immediately without waiting for\n       * keypress.\n       */\n      if ($.inArray(keyCode, WMKS.CONST.KB.Modifiers) !== -1) {\n         // Handled above via syncModifiers\n         e.returnValue = false;\n         return false;\n      }\n\n      if (WMKS.CONST.KB.ControlKeys.indexOf(keyCode) !== -1) {\n         e.returnValue = false;\n         return this._handleControlKeys(keyCode);\n      }\n\n\n      /*\n       * Send the keydown event right now if we were given a unicode codepoint\n       * in the keyIdentifier field of the event.  There won't be a\n       * corresponding key press event so we can confidently send it right now.\n       */\n      if (isUnicode) {\n         WMKS.LOGGER.log('Send unicode down from keyIdentifier: ' + keyCode);\n         self.sendKey(keyCode, false, true);\n         e.returnValue = false;\n         return false;\n      }\n\n      /*\n       * Expect a keypress before control is returned to the main JavaScript.\n       * The setTimeout(..., 0) is a failsafe that will activate only if the\n       * main JavaScript loop is reached. When the failsafe activates, send\n       * the raw key and hope it works.\n       */\n      if (this.keyDownKeyTimer !== null) {\n         WMKS.LOGGER.log('assert: nuking an existing keyDownKeyTimer');\n         clearTimeout(this.keyDownKeyTimer);\n      }\n\n      /*\n       * Sometimes, on Mac Firefox, sending vscancode, control +alt +key, will\n       * cause the timer start to work, and in press event, the timer will be null.\n       * It causes sending twice keydown event. So set the time to 1 will reduce\n       * this bugs' happen.\n       */\n      var time = 0;\n      if (WMKS.BROWSER.isFirefox() && WMKS.BROWSER.isMacOS() && e.altKey === true &&\n         e.ctrlKey === true && !this.allowVMWKeyEvent2UnicodeAndRaw) {\n         time = 1;\n      } else {\n         time = 0;\n      }\n\n      this.keyDownKeyTimer = setTimeout(function() {\n         // WMKS.LOGGER.log('timeout, sending raw keyCode=' + keyCode);\n         self.sendKey(keyCode, false, false);\n         self.keyDownKeyTimer = null;\n         self.pendingKey = null;\n      }, time);\n      this.pendingKey = keyCode;\n\n      // Safari has the keyIdentifier on the keydown calls (chrome is on keypress)\n      // Save for reference in onKeyPress\n      if (e.originalEvent && e.originalEvent.keyIdentifier) {\n         this.keyDownIdentifier = e.originalEvent.keyIdentifier;\n      }\n\n      /*\n       * If Alt or Ctrl or Win (by themselves) are held, inhibit the keypress by\n       * returning false.\n       * This prevents the browser from handling the keyboard shortcut\n       */\n      e.returnValue = !(this.activeModifiers.length === 1 &&\n         (this.activeModifiers[0] === WMKS.CONST.KB.KEY_CODE.Alt ||\n         this.activeModifiers[0] === WMKS.CONST.KB.KEY_CODE.Ctrl ||\n         this.activeModifiers[0] === WMKS.CONST.KB.WindowsKeys.left ||\n         this.activeModifiers[0] === WMKS.CONST.KB.WindowsKeys.right));\n      return e.returnValue;\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _handleControlKeys\n    *\n    *    This function takes care of the control keys and handling these.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._handleControlKeys = function(keyCode) {\n      // var isCapsOn = this._vncDecoder._keyboardLEDs & 4;\n      // WMKS.LOGGER.log('Led: ' + led + ', Caps: ' + isCapsOn);\n\n      /*\n       * Caps lock is an unusual key and generates a 'down' when the\n       * caps lock light is going from off -> on, and then an 'up'\n       * when the caps lock light is going from on -> off. The problem\n       * is compounded by a lack of information between the guest & VMX\n       * as to the state of caps lock light. So the best we can do right\n       * now is to always send a 'down' for the Caps Lock key to try and\n       * toggle the caps lock state in the guest.\n       */\n      if (this.isAddCapsLockEvent(keyCode)) {\n         // TODO: Confirm if this works.\n         this.sendKey(keyCode, false, false);\n         this.sendKey(keyCode, true, false);\n         return;\n      }\n      this.sendKey(keyCode, false, false);\n      return false;\n   };\n\n   this.isAddCapsLockEvent = function(keyCode) {\n      // On Windows 8.1 Caps lock's keycode is 240. No character's keycode is 240 now.\n      return (keyCode === WMKS.CONST.KB.KEY_CODE.CapsLock && WMKS.BROWSER.isMacOS())\n         || (keyCode === 240 && WMKS.BROWSER.isWindows());\n   };\n\n   this._handleCapsLockKey = function(keyCode) {\n      /*\n       * When press caps lock, there's only a up event. Add a down one, so it will work.\n       * Add this in vscancode, unicode need to be Confirm if this works.\n       * More introduction please check _handleControlKeys.\n       */\n      if (this.isAddCapsLockEvent(keyCode) && !this._vncDecoder.allowVMWKeyEvent2UnicodeAndRaw) {\n         this.sendKey(keyCode, false, false);\n         this.sendKey(keyCode, true, false);\n         return false;\n      }\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _syncModifiers\n    *\n    *    Parse the altKey, shiftKey, metaKey and ctrlKey attributes of an event\n    *     to synthesize event keystrokes. The keydown and keyup events are not\n    *    reliably sent by all browsers but these attributes are always set,\n    *    so key off of these to send keydown and keyup events for those keys.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._syncModifiers = function(e) {\n      var thisMod, thisVal, i, idx;\n      // This must be in the order of WMKS.CONST.KB.Modifiers\n      var vals = [e.shiftKey, e.ctrlKey, e.altKey, e.metaKey, false, false];\n      // var names = ['shift', 'ctrl', 'alt', 'meta']; // used with logging.\n\n      // Do check for AltGr and set ctrl and alt if set\n      if (e.altGraphKey === true) {\n         vals[1] = vals[2] = true;\n      }\n\n      /*\n       * on windows firefox, altgr keys,e.ctrlKey and e.altKey are false.\n       * Reset them to true. Or it will cause multi control + alt events.\n       */\n      vals = this.resetEventValue(e,vals);\n      /*\n       * On OSX if the meta key (aka CMD) key is pressed along with one of\n       * either A, C, V, or X we map the CMD key to CTRL, allowing\n       * the Mac user to use CMD-V for CTRL-V etc.\n       */\n      if (e.metaKey === true && this.mapMetaToCtrlForKeys.indexOf(e.keyCode) !== -1) {\n         vals[1] = true;  // turn on CTRL\n         vals[3] = false; // turn off CMD\n      }\n\n      /*\n       * When Windows key simulation is enabled, pressing Ctrl+Win\n       * on Windows or Ctrl+CMD on OSX simulates a Windows key.\n       */\n      if (this._windowsKeyManager.enabled) {\n         this._windowsKeyManager.keyboardHandler(e);\n\n         if (e.ctrlKey === true) {\n            // Ctrl key is down.\n            if (this._windowsKeyManager.leftWindowsDown  ||\n               this.activeModifiers.indexOf(WMKS.CONST.KB.WindowsKeys.left) !== -1) {\n               // Left Windows key is down.\n               vals[1] = false;  // turn off Ctrl\n               vals[3] = true;   // turn on left Windows\n               // Ctrl + Windows are pressed.\n               this._windowsKeyManager.windowsOn = true;\n            } else if (this._windowsKeyManager.rightWindowsDown ||\n               this.activeModifiers.indexOf(WMKS.CONST.KB.WindowsKeys.right) !== -1) {\n               // Right Windows key is down.\n               vals[1] = false;  // turn off Ctrl\n               vals[4] = true;   // turn on right Windows\n               // Ctrl + Windows are pressed.\n               this._windowsKeyManager.windowsOn = true;\n            }\n         }\n      }\n\n      for (i = 0; i < WMKS.CONST.KB.Modifiers.length; i++) {\n         thisMod = WMKS.CONST.KB.Modifiers[i];\n         thisVal = vals[i];\n\n         idx = this.activeModifiers.indexOf(thisMod);\n         if (thisVal && idx === -1) {\n            // WMKS.LOGGER.log(names[i] + ' down');\n            this.activeModifiers.push(thisMod);\n            this.sendKey(thisMod, false, false);\n         } else if (!thisVal && idx !== -1) {\n            // WMKS.LOGGER.log(names[i] + ' up');\n            this.activeModifiers.splice(idx, 1);\n            this.sendKey(thisMod, true, false);\n         }\n      }\n   };\n\n   /*\n    * On Windows Firefox, altgr keys,e.ctrlKey and e.altKey are false.\n    * Reset them to true.\n    */\n   this.resetEventValue = function(e,vals) {\n      var keyCode = e.charCode || e.which;\n      var table = WMKS.keyboardUtils._WindowsFirefoxAltGr[this.keyboardLayoutId];\n      if (!!table && table.indexOf(keyCode)!== -1 && WMKS.BROWSER.isWindows() &&\n         WMKS.BROWSER.isFirefox()) {\n         vals[1] = vals[2] = true;\n      }\n      return vals;\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * cancelModifiers\n    *\n    *    Clear all modifiers currently in a 'keydown' state. Used as a cleanup\n    *    for onBlur or to clear the modifier state upon close of the\n    *    extendedKeypad widget.\n    *\n    *    applyToSoftKB - When set and is a touch device, perform this action.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.cancelModifiers = function(applyToSoftKB) {\n      var i;\n      /*\n       * On blur events invoke cancelModifiers for desktop browsers. This is not\n       * desired in case of softKB (touch devices, as we constantly change focus\n       * from canvas to the hidden textbox (inputProxy) - PR 1084858.\n       */\n      if (WMKS.BROWSER.isTouchDevice() && !applyToSoftKB) {\n         return;\n      }\n      for (i = 0; i < this.activeModifiers.length; i++) {\n         this.sendKey(this.activeModifiers[i], true, false);\n      }\n      this.activeModifiers.length = 0;\n\n      if (this._windowsKeyManager.enabled) {\n         // Reset Windows key status.\n         this._windowsKeyManager.reset();\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * updateModifiers\n    *\n    *    This function update the state of the modifiers based on the input.\n    *    If the modifier key is down, we add it to the modifier list else remove\n    *    it from the list and send the appropriate key info to the protocol.\n    *\n    *    NOTE: Currently used by extendedKeypad widget.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.updateModifiers = function(modKey, isUp) {\n      this.sendKey(modKey, isUp, false);\n      if (isUp) {\n         this.activeModifiers.splice(this.activeModifiers.indexOf(modKey), 1);\n      } else {\n         this.activeModifiers.push(modKey);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * onKeyPress\n    *\n    *    Desktop style onKeyPress handler. See onKeyDown for how our keyboard\n    *    input mechanism works.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.onKeyPress = function(e) {\n      var keyCode,\n          isRaw = false,\n          shiftMismatch = false,\n          noShiftMismatch = false,\n          keyCodeMismatch = false,\n          isSpecialSymbol = false,\n          key = \"\", // String version of the key pressed\n          isWestEuroLanguage =  WMKS.CONST.KB.WestEuroLanguage.indexOf(this.keyboardLayoutId) !== -1;\n\n      /*\n       * If on a Mac, and ONLY Alt is held, prefer the raw key code.\n       * This is because Alt-* on a US Mac keyboard produces many international\n       * characters, which I would prefer to ignore for the sake of letting\n       * keyboard shortcuts work naturally.\n       */\n      if (WMKS.BROWSER.isMacOS() && this.activeModifiers.length === 1 &&\n          this.activeModifiers[0] === WMKS.CONST.KB.KEY_CODE.Alt) {\n         WMKS.LOGGER.log('Preferring raw keycode with Alt held (Mac)');\n         return false;\n      } else if (e.charCode && e.charCode >= 0x20) {\n         /*\n          * Low order characters are control codes, which we need to send raw.\n          * 0x20 is SPACE, which is the first printable character in Unicode.\n          */\n         keyCode = e.charCode;\n         isRaw = false;\n      } else if (e.keyCode) {\n         keyCode = e.keyCode;\n         keyCode = this.remapUncontrolKey(e, keyCode, isRaw).keyCode;\n         isRaw = this.remapUncontrolKey(e, keyCode, isRaw).isRaw;\n      } else {\n         WMKS.LOGGER.log('assert: could not read keypress event');\n         return false;\n      }\n\n      if (this.keyDownKeyTimer !== null) {\n         clearTimeout(this.keyDownKeyTimer);\n         this.keyDownKeyTimer = null;\n      }\n      //WMKS.LOGGER.log(\"onKeyPress: keyCode=\" + keyCode);\n\n      if (isRaw && WMKS.CONST.KB.ControlKeys.indexOf(keyCode) !== -1) {\n         // keypress for a keydown that was sent as a control key. Ignore.\n         return false;\n      }\n\n      if (this.handleUnusefulKeys(e)) {\n         return false;\n      }\n      /* Top left key on windows firefox, the key value is the same with altgr+4,5,\n       * it will cause the key won's display. So remap it to the different key value.\n       */\n      e = this.fixDeFrChSpecialKeys(e,this.pendingKey,keyCode);\n      /*\n       * Update the modifier state before we send a character which may conflict\n       * with a stale modifier state\n       */\n      this._syncModifiers(e);\n\n      if (this.pendingKey !== null) {\n         if (isRaw) {\n            this.keyToRawMap[this.pendingKey] = keyCode;\n         } else {\n            this.keyToUnicodeMap[this.pendingKey] = keyCode;\n         }\n      }\n\n      if (this.fixANSIEquivalentKeys && e.originalEvent) {\n         if (e.originalEvent.key) {\n            key = e.originalEvent.key;\n         } else if (!WMKS.BROWSER.isWindows() || !WMKS.BROWSER.isChrome()) {\n            if (e.originalEvent.keyIdentifier === \"\" && this.keyDownIdentifier) {\n               // Parse Unicode as hex\n               key = String.fromCharCode(parseInt(this.keyDownIdentifier.replace(\"U+\", \"\"), 16));\n            } else if(e.originalEvent.keyIdentifier) {\n               // Parse Unicode as hex\n               key = String.fromCharCode(parseInt(e.originalEvent.keyIdentifier.replace(\"U+\", \"\"), 16));\n            }\n         }\n         if (key) {\n            keyCodeMismatch = (key.charCodeAt(0) !== keyCode);\n            shiftMismatch = (WMKS.CONST.KB.ANSIShiftSymbols.indexOf(key) !== -1 &&\n               this.activeModifiers.indexOf(WMKS.CONST.KB.KEY_CODE.Shift) === -1);\n            noShiftMismatch = (WMKS.CONST.KB.ANSINoShiftSymbols.indexOf(key) !== -1 &&\n               this.activeModifiers.indexOf(WMKS.CONST.KB.KEY_CODE.Shift) !== -1);\n            isSpecialSymbol = (WMKS.CONST.KB.ANSISpecialSymbols.indexOf(key) !== -1);\n         }\n      }\n\n      this.keyDownIdentifier = null;\n\n\n      if (this.fixANSIEquivalentKeys && key && isSpecialSymbol &&\n          (keyCodeMismatch || shiftMismatch || noShiftMismatch)) {\n         if (noShiftMismatch) {\n            // Should not have shift depressed for this key code, turn it off\n            this.sendKey(WMKS.CONST.KB.KEY_CODE.Shift, true, false);\n         }\n         this.handleSoftKb(key.charCodeAt(0), true);\n         if (noShiftMismatch) {\n            // Turn shift back on after sending keycode.\n            this.sendKey(WMKS.CONST.KB.KEY_CODE.Shift, false, false);\n         }\n      } else {\n         if (!this._vncDecoder.allowVMWKeyEvent2UnicodeAndRaw) {\n            keyCode = this.handleInternationalKeyboard(e,keyCode,this.pendingKey);\n         }\n         if (this.pendingKey !== null) {\n            if (isRaw) {\n               this.keyToRawMap[this.pendingKey] = keyCode;\n            } else {\n               this.keyToUnicodeMap[this.pendingKey] = keyCode;\n            }\n         }\n         this.sendAndfixWrongKeys(e, keyCode, isRaw, this.pendingKey);\n      }\n\n      /*\n       * Keycodes 50 and 55 are deadkeys when AltGr is pressed. Pressing them a\n       * second time produces two keys (either ~ or `). Send an additional up\n       * keystroke so that the second keypress has both a down and up event.\n       * PR 969092\n       */\n      if (((this.pendingKey === 50 && keyCode === 126) ||\n           (this.pendingKey === 55 && keyCode === 96)) &&\n          !isRaw) {\n         WMKS.LOGGER.debug(\"Sending extra up for Unicode \" + keyCode\n            + \" so one isn't missed.\");\n         this.sendKey(keyCode, true, !isRaw);\n      }\n\n      this.pendingKey = null;\n      return false;\n   };\n\n   /* Top left key on windows firefox, the key value is the same with altgr+4,5,\n    * it will cause the key won's display. So remap it to the different key value.\n    */\n   this.fixDeFrChSpecialKeys = function(e,pendingKey,keyCode) {\n      if ((this.keyboardLayoutId ==='de-CH' || this.keyboardLayoutId ==='fr-CH') &&\n            WMKS.BROWSER.isWindows() && WMKS.BROWSER.isFirefox()) {\n         if(e.charCode === 176 && pendingKey === 176 ){\n            e.keyCode =  1176;\n            e.charCode = 1176;\n         } else if (e.charCode === 167 && pendingKey === 167 ) {\n            e.keyCode =  1167;\n            e.charCode = 1167;\n         }\n      }\n      return e;\n   };\n\n   /*\n    * In some languages the keys on Mac keyboard can't be found directly\n    * on Windows keyboard. Some characters can't be displayed.\n    * eg.: \"\" on Mac Fr keyboard, need to be transformed to press \"!\" + shift .\n    *      \"@\" on Mac Fr keyboard, need to be transformed to press \"0\" + altgr .\n    *      \"_\" + shift on Mac Fr keyboard, need to be transformed to press \"0\" ,\n    *      release a shift key.\n    */\n   this.sendAndfixWrongKeys = function (e, keyCode, isRaw, pendingKey) {\n      var isSmallKeyboardKey = this.isSmallKeyboardKey(e, keyCode, pendingKey),\n          isAddShiftKey  = this.isAddShiftKey(e, keyCode),\n          isAddAltGr = this.isAddAltGr(e, keyCode),\n          isDeleteShiftKey = this.isDeleteShiftKey(e, keyCode);\n\n      if (!this._vncDecoder.allowVMWKeyEvent2UnicodeAndRaw &&\n          (isSmallKeyboardKey || isAddShiftKey || isDeleteShiftKey || isAddAltGr) ){\n         if (isSmallKeyboardKey || isAddShiftKey) {\n            this.sendKey(16, false, false);\n            this.sendKey(keyCode, false, !isRaw);\n            this.sendKey(16, true, false);\n         }\n         if (isDeleteShiftKey) {\n            this.sendKey(16, true, false);\n            this.sendKey(keyCode, false, !isRaw);\n            this.sendKey(16, false, false);\n         }\n         if (isAddAltGr) {\n            this.sendKey(17, false, false);\n            this.sendKey(18, false, false);\n            this.sendKey(keyCode, false, !isRaw);\n            this.sendKey(17, true, false);\n            this.sendKey(18, true, false);\n         }\n      } else {\n         this.sendKey(keyCode, false, !isRaw);\n      }\n   };\n\n   /*\n    * in some languages right number keyboard, some characters can't be handle.\n    * when meet this situation, also send a shift key =/*\n    */\n   this.isSmallKeyboardKey = function (e, keyCode, pendingKey) {\n      var isSmallKeyboardKey = false,\n          table = WMKS.keyboardUtils._SmallKeyboardKey[this.keyboardLayoutId];\n      if (e.shiftKey === false && e.altKey === false && e.ctrlKey === false &&\n         this.isFitSmallKeyboardPendingKey(keyCode,pendingKey)) {\n         if (!!table && table.indexOf(keyCode)!== -1) {\n            isSmallKeyboardKey = true;\n         }\n      }\n\n      return isSmallKeyboardKey;\n   };\n\n   /*\n    * On Windows, for number keys, can't add a shift. It's not on small keyboard.\n    * Need to detect the pending value.\n    */\n   this.isFitSmallKeyboardPendingKey = function(keyCode, pendingKey) {\n      var isFitSmallKeyboardPendingKey = true,\n          table = WMKS.keyboardUtils._smallKeyboardPendingKey[this.keyboardLayoutId];\n      if (table && table[keyCode]  && WMKS.BROWSER.isWindows()) {\n         if ( table[keyCode] === pendingKey || typeof table[keyCode] === 'object' &&\n            table[keyCode].indexOf(pendingKey) !== -1 ) {\n            isFitSmallKeyboardPendingKey = false;\n         }\n      }\n      return isFitSmallKeyboardPendingKey;\n   };\n\n   this.isMacChromeVscancodeFr = function () {\n      return WMKS.BROWSER.isMacOS() && !this._vncDecoder.allowVMWKeyEvent2UnicodeAndRaw\n         && this.keyboardLayoutId == 'fr-FR';\n   };\n\n   /*\n    * In some languages mac keyboard key are not in windows keyboard, some\n    * characters can't be handle. Add a shift key.\n    */\n   this.isAddShiftKey = function (e,keyCode) {\n      var code = e.keyCode || e.charCode;\n\n      return code == 167 && this.isMacChromeVscancodeFr();\n   };\n\n   /*\n    * In some languages mac keyboard key are not in windows keyboard,\n    * some characters can't be handle.\n    * if delete a shift key could solve this issue, send it.\n    */\n   this.isDeleteShiftKey = function (e,keyCode) {\n      var code = e.keyCode || e.charCode;\n\n      return (code == 95 || code == 42 || code == 35) && this.isMacChromeVscancodeFr() && e.shiftKey;\n   };\n\n   /*\n    * In some languages mac keyboard key are not in windows keyboard,\n    * some characters can't be handle.\n    * if send another altgr key could solve this issue, send it.\n    */\n   this.isAddAltGr = function (e,keyCode) {\n      var code = e.keyCode || e.charCode;\n\n      return (code == 64 || code == 35) && this.isMacChromeVscancodeFr();\n   };\n\n   /*\n    * On Windows IE browser, when press ^ and another key, it will\n    * call keypress twice, one is ^ key , one\n    * is the other key event. There will one more ^ key. PR 1580113\n    */\n   this.handleUnusefulKeys = function (e) {\n      var isUnusefulKey  = false,\n          table;\n      // only fix IE 11 now.\n      if (WMKS.BROWSER.isIE() && WMKS.BROWSER.version.major > 10) {\n         table = WMKS.keyboardUtils._keypressUnusefulKeys[this.keyboardLayoutId];\n         if (!!table && table.indexOf(e.keyCode)!== -1) {\n            isUnusefulKey = true;\n         }\n      }\n      return isUnusefulKey;\n   };\n\n   /*\n    * Some keys with alt gr on Chrome, the key code is the same with\n    * control keys. Remap them to the right keycode.\n    */\n   this.remapUncontrolKey = function (e, keyCode, isRaw) {\n      var altgrOnChrome =  WMKS.BROWSER.isChrome() && e.altKey && e.ctrlKey,\n         isRaw = true,\n         newCode,\n         remap = WMKS.keyboardUtils._remapUncontrolKeys[this.keyboardLayoutId];\n\n      if (altgrOnChrome) {\n         if (remap !== undefined) {\n            newCode = remap[e.keyCode];\n         }\n         if (newCode !== undefined) {\n            isRaw = false;\n            keyCode = newCode;\n         }\n      }\n      return {\n         keyCode: keyCode,\n         isRaw: isRaw\n      };\n   };\n\n   this.handleInternationalKeyboard = function (e, keyCode, pendingKey) {\n      var altgrOnChrome =  WMKS.BROWSER.isChrome() && e.altKey && e.ctrlKey,\n          altgrOnFirefox = WMKS.BROWSER.isFirefox() && e.altKey && e.ctrlKey,\n          specialKeyOnFirefox = (e.keyCode === 0 )&& WMKS.BROWSER.isFirefox() &&\n            e.key && (e.charCode === 0),\n          isWestEuroLanguage =  WMKS.CONST.KB.WestEuroLanguage.indexOf(this.keyboardLayoutId) !== -1;\n\n      if (!isWestEuroLanguage && e.keyCode === 0 && WMKS.BROWSER.isFirefox() &&\n         e.key && !keyCode) {\n         /*\n          * On Firefox, for some special key such as   , the keyCode of\n          * onKeyUp and keyDown is 0, but there is a value in key property.\n          * See bug 1166133.\n           */\n         keyCode = 0;\n      }\n      switch (this.keyboardLayoutId) {\n         case 'ja-JP_106/109':\n            keyCode = this.getRemapPendingKey(keyCode, pendingKey);\n            break;\n         case 'de-DE':\n            if ((keyCode == 123 || keyCode == 124 || keyCode == 125 ) &&\n               (altgrOnChrome || WMKS.BROWSER.isFirefox) && WMKS.BROWSER.isWindows()) {\n               /*\n                * Keycodes are different on Mac and Windows in Chrome,\n                * remap the altgr keys to the same one.\n                */\n               if (keyCode == 123) {\n                  keyCode = 124;\n               } else if(keyCode == 124 ) {\n                  keyCode = 8804;\n               } else if(keyCode == 125) {\n                  keyCode = 8800;\n               }\n            }\n            if (keyCode == 192 && WMKS.BROWSER.isFirefox() && WMKS.BROWSER.isMacOS()) {\n               //keycodes are different on Chrome and Firefox on Mac\n               keyCode = 187;\n            }\n            keyCode = this.getRemapPendingKey(keyCode, pendingKey);\n            break;\n         case 'it-IT':\n            if ( e.keyCode === 37 && altgrOnChrome) {\n               keyCode = e.keyCode + 1000;\n            }\n            // There's no data when press # key\n            if ( specialKeyOnFirefox && e.key=='#' && WMKS.BROWSER.isWindows()) {\n               keyCode = 35;\n            }\n            break;\n         case \"es-ES\":\n            // There's no data when press  key\n            if ( e.keyCode === 0 && WMKS.BROWSER.isFirefox() && (e.key ==' ' ||\n               e.key == 'Dead') && e.charCode ==0 && e.which == 0) {\n               keyCode = 222;\n            }\n            if ( specialKeyOnFirefox && e.key=='\\\\' && WMKS.BROWSER.isWindows()) {\n               keyCode = 186;\n            }\n            if ( (e.keyCode === 48 || e.keyCode === 34) && altgrOnChrome) {\n               keyCode = e.keyCode + 1000;\n            }\n            keyCode = this.getRemapPendingKey(keyCode, pendingKey);\n            break;\n         case 'pt-PT':\n            if ((keyCode == 123 || keyCode == 167 ) && (altgrOnChrome ||\n               WMKS.BROWSER.isFirefox) && WMKS.BROWSER.isWindows()) {\n               //keycodes are different on Mac and Windows in Chrome, remap the altgr keys to the same one.\n               if (keyCode == 123) {\n                  keyCode = 55; //7\n               } else if(keyCode == 167 ) {\n                  keyCode = 52; //4\n               }\n            }\n            if (WMKS.BROWSER.isFirefox && WMKS.BROWSER.isWindows()) {\n               //keycodes are different on Mac and Windows in Chrome, remap the altgr keys to the same one.\n               if(e.key == ''){\n                  keyCode = 187;\n               }\n               if(e.key == '' ) {\n                  keyCode = 333;\n               }\n            }\n            if (e.keyCode == 192 &&  WMKS.BROWSER.isChrome && WMKS.BROWSER.isWindows()) {\n               //keycodes are different on Mac and Windows in Chrome, remap the altgr keys to the same one.\n               keyCode = 333;\n            }\n            break;\n         case \"fr-FR\":\n            // There's no data when press 6 key\n            if ( e.keyCode === 29 && WMKS.BROWSER.isChrome() && e.key !=\"\" &&\n               WMKS.BROWSER.isMacOS()) {\n               keyCode = 124;\n            }\n            keyCode = this.getRemapPendingKey(keyCode, pendingKey);\n            break;\n         case \"fr-CH\":\n         case \"de-CH\":\n            if ( e.ctrlKey === true && e.altKey === true ) {\n               var code = e.keyCode || e.which;\n               if ( WMKS.BROWSER.isMacOS()) {\n                  if (code === 61) {\n                     //~\n                     keyCode = 187;\n                  }\n                  if (e.keyCode === 34 && WMKS.BROWSER.isChrome()) {\n                     //{ on chrome is map to @\n                     keyCode = 224\n                  }\n               }\n            }\n            if ( (e.keyCode || e.which) === 96 && (WMKS.BROWSER.isChrome() ||\n               WMKS.BROWSER.isFirefox() ) && WMKS.BROWSER.isWindows() &&\n               e.key === '`') {\n               keyCode = 94\n            }\n            if (specialKeyOnFirefox || (WMKS.BROWSER.isMacOS() && altgrOnFirefox)) {\n               keyCode = this.getKeyCodeFromKey(e,keyCode) || keyCode;\n            }\n            if (WMKS.BROWSER.isWindows() && altgrOnFirefox) {\n               keyCode = this.getRemapFrChAltgrKey(keyCode);\n            }\n            if (e.key === \"\" && altgrOnFirefox && WMKS.BROWSER.isMacOS()) {\n                keyCode = 232;  //should not show character when click altgr and \n            }\n            if (e.key === \"\" && (e.keyCode || e.which) === 192 &&\n               this.keyboardLayoutId === 'de-CH' && pendingKey !== 65) {\n               if ( WMKS.BROWSER.isMacOS() || (WMKS.BROWSER.isFirefox() &&\n                  WMKS.BROWSER.isWindows()) ) {\n                  keyCode = 1224;\n               }\n            }\n            keyCode = this.getRemapPendingKey(keyCode, pendingKey);\n            break;\n      };\n      if (isWestEuroLanguage && (specialKeyOnFirefox || altgrOnFirefox) &&\n         this.keyboardLayoutId !== 'fr-CH' && this.keyboardLayoutId !== 'de-CH') {\n         if (e.charCode === 176 && WMKS.BROWSER.isMacOS() && altgrOnFirefox) {\n            keyCode = 0;\n            //should not show character when click altgr and \n         } else {\n            keyCode = this.getKeyCodeFromKey(e,keyCode) || keyCode;\n         }\n      }\n      /*\n       * in some languages right number keyboard, some characters can't be handle.\n       * when meet this situation, also send a shift key\n       */\n      return keyCode;\n   };\n\n   /*\n    *  windows ff these six keys' charcode and key value are different,\n    *  it will cause a bug.Remap them.\n    */\n   this.getRemapFrChAltgrKey = function(keyCode) {\n      var table = WMKS.keyboardUtils._remapFrChAltgrKey;\n      if (table && table[keyCode]) {\n         keyCode = table[keyCode];\n      }\n      return keyCode;\n   };\n\n   /*\n    * On Windows, press accent key + a or e, will create a 224 key press event,\n    * this is the same with key  directly, so it will display `,\n    * When meet this situation, map 224 to a normal a 65.\n    */\n   this.getRemapPendingKey = function(keyCode, pendingKey) {\n      var table = WMKS.keyboardUtils._remapPending[this.keyboardLayoutId];\n      if (table && table[keyCode] && table[keyCode] === pendingKey &&\n         WMKS.BROWSER.isWindows()) {\n         keyCode = pendingKey;\n      }\n      return keyCode;\n   };\n\n   /*\n    * On Firefox, for some special key such as   , the keyCode of\n    * onKeyUp and keyDown is 0, but there is a value in key property.\n    */\n   this.getKeyCodeFromKey = function(e,keyCode) {\n      var table = WMKS.keyboardUtils._charToKeycode[this.keyboardLayoutId];\n      if (table) {\n         keyCode = table[e.key];\n      }\n      return keyCode;\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * onKeyUp\n    *\n    *    Called to handle the keyboard \"key up\" event and send the appropriate\n    *    key stroke to the server.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.onKeyUp = function(e) {\n      var keyCode, keyCodeRes, unicode, raw, isUnicode = false;\n\n      if (e.preventDefault) {\n         e.preventDefault();\n      } else {\n         e.returnValue = false;\n      }\n\n      this.keyDownIdentifier = null;\n\n      keyCodeRes = this._extractKeyCodeFromEvent(e);\n      if (!keyCodeRes) {\n         WMKS.LOGGER.debug('Extraction of keyCode from keyUp event failed.');\n         return false; // don't send a malformed command.\n      }\n      keyCode = keyCodeRes.keyCode;\n      isUnicode = keyCodeRes.isUnicode;\n\n      //WMKS.LOGGER.log(\"onKeyUp: keyCode=\" + keyCode);\n\n      /*\n       * Sync modifiers for we don't always get correct event.\n       */\n      this._syncModifiers(e);\n\n      if (keyCode === 0) {\n         WMKS.LOGGER.log(\"onKeyUp: Do not send 0 to server.\");\n         return true;\n      }\n\n      if ($.inArray(keyCode, WMKS.CONST.KB.Modifiers) !== -1) {\n         // Handled above via syncModifiers\n         return false;\n      }\n\n      this._handleCapsLockKey(keyCode);\n\n      /*\n       * Only process keyup operations at once for certain keys.\n       * Inhibit default because these will never result in a keypress event.\n       */\n      if (isUnicode) {\n         WMKS.LOGGER.log('Sending unicode key up from keyIdentifier: ' + keyCode);\n         this.sendKey(keyCode, true, true);\n      } else if (this.keyToUnicodeMap.hasOwnProperty(keyCode)) {\n         unicode = this.keyToUnicodeMap[keyCode];\n         this.sendKey(unicode, true, true);\n         // the user may change keymaps next time, don't persist this mapping\n         delete this.keyToUnicodeMap[keyCode];\n      } else if (this.keyToRawMap.hasOwnProperty(keyCode)) {\n         raw = this.keyToRawMap[keyCode];\n         this.sendKey(raw, true, false);\n         delete this.keyToRawMap[keyCode];\n      } else {\n         this.sendKey(keyCode, true, false);\n      }\n\n      return false;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * onKeyUpSoftKb\n    *\n    *    Event handler for soft keyboards. We do not have much going on here.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.onKeyUpSoftKb = function(e) {\n      // for all browsers on soft keyboard.\n      e.stopPropagation();\n      e.preventDefault();\n      return false;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * onKeyDownSoftKb\n    *\n    *    Special IOS onkeydown handler which only pays attention to certain keys\n    *    and sends them directly. Returns false to prevent the default action,\n    *    true otherwise.\n    *\n    *---------------------------------------------------------------------------\n    */\n   this.onKeyDownSoftKb = function(e) {\n      var keyCode = e.keyCode || e.which;\n\n      if (keyCode && WMKS.CONST.KB.SoftKBRawKeyCodes.indexOf(keyCode) !== -1) {\n         // Non-Unicode but apply modifiers.\n         this.handleSoftKb(keyCode, false);\n         return false;\n      }\n\n      /*\n       * Return value is true due to the following:\n       * 1. For single-use-caps / Caps-Lock to work, we need to return true\n       *    for all keys.\n       * 2. Certain unicode characters are visible with keypress event\n       *    alone. (keyCode value is 0)\n       */\n      return true;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * onKeyPressSoftKb\n    *\n    *    Returns latin1 & Unicode keycodes.\n    *    Works for all basic input that you can do with a soft keyboard.\n    *\n    *    NOTE: Chrome on Android behaves differently. Hence we rely on\n    *    onInputTextSoftKb() to handle the input event.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.onKeyPressSoftKb = function(e) {\n      var keyCode = e.keyCode || e.which;\n      if (WMKS.BROWSER.isAndroid() && WMKS.BROWSER.isChrome()) {\n         // Android on Chrome, special case, ignore it.\n         return true;\n      }\n      // Reset the text field first.\n      $(e.target).val(WMKS.CONST.KB.keyInputDefaultValue);\n\n      // Send both keydown and key up events.\n      this.handleSoftKb(keyCode, true);\n\n      /* If we use preventDefault() or return false, the single-use-caps does\n       * not toggle back to its original state. Hence rely on the fact that\n       * text-2-speech contains more than 1 character input */\n      return true;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * onInputTextSoftKb\n    *\n    *    Event handler for input event on the input-proxy. This intercepts\n    *    microphone text input as well as keyPress events. We have to make sure\n    *    only the microphone inputs are processed.\n    *\n    *    The following logic is used to differentiate.\n    *    1. If input value is the same as defaultValue, no input, ignore it.\n    *    2. If input value has only a single char, then its mostly preceded by\n    *       onKeyPressSoftKb(), so ignore it.\n    *    3. There is more than 1 character, must be from speech-2-text. Process\n    *       this one further.\n    *\n    * NOTE: Android chrome does not emit useful keyCodes, hence we use the value\n    *       that's entered into the textbox and decode it to send as a message.\n    *       http://code.google.com/p/chromium/issues/detail?id=118639\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.onInputTextSoftKb = function(e) {\n      // We have received speech-to-text input or something.\n      var input = $(e.target),\n          val = input.val(),\n          defaultInputSize = WMKS.CONST.KB.keyInputDefaultValue.length;\n\n      /*\n       * TODO: It causes speech-to-text doesn't work on iOS.\n       * Ignore input event due to bug 1080567. Keypress triggers\n       * both keypress event as well as input event. It sends\n       * duplicate texts to the remote desktop.\n       */\n      if (WMKS.BROWSER.isIOS()) {\n         // In any case, clean-up this data, so we do not repeat it.\n         input.val(WMKS.CONST.KB.keyInputDefaultValue);\n         return false;\n      }\n\n      // Remove the default value from the input string.\n      if (defaultInputSize > 0) {\n         val = val.substring(defaultInputSize);\n      }\n      // WMKS.LOGGER.debug('input val: ' + val);\n\n      /*\n       * 1. We have to verify if speech-to-text exists, we allow that.\n       * 2. In case of Android, keyPress does not provide valid data, hence\n       *    all input is handled here.\n       * 3. For all other cases, do not process, its handled in onKeyPress.\n       */\n      if (val.length > 1) {\n         /*\n          * There are 2+ chars, hence speech-to-text or special symbols on\n          * android keyboard, let it in as is. If its speech-to-text, first\n          * char is generally uppercase, hence flip that.\n          */\n         val = val.charAt(0).toLowerCase() + val.slice(1);\n         this.processInputString(val);\n      } else if (WMKS.BROWSER.isAndroid() && WMKS.BROWSER.isChrome()) {\n         // We could get uppercase and lower-case values, use them as is.\n         this.processInputString(val);\n      }\n\n      // In any case, clean-up this data, so we do not repeat it.\n      input.val(WMKS.CONST.KB.keyInputDefaultValue);\n      return true;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * processInputString\n    *\n    *    This function accepts a string of input characters and processes them.\n    *    It decodes each character to its keyCode, and then sends each one of\n    *    that in the order it was passed.\n    *\n    *    Returns the last key that was decoded from the input value.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.processInputString = function(str, processNewline) {\n      var i, key = false;\n      for (i = 0; i < str.length; i++) {\n         if (processNewline && str.charAt(i) === '\\n') {\n            // Found a newline, handle this differently by sending the enter key.\n            this.sendKey(WMKS.CONST.KB.KEY_CODE.Enter, false, false);\n            this.sendKey(WMKS.CONST.KB.KEY_CODE.Enter, true, false);\n            continue;\n         }\n         key = str.charCodeAt(i);\n         if (!isNaN(key)) {\n            // Send each key in if its a valid keycode.\n            this.handleSoftKb(key, true);\n         }\n      }\n      // Return the last keyCode from this input. When a single character is\n      // passed, the last is essentially the keycode for that input character.\n      return key;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * handleSoftKb\n    *\n    *    Process keyCode inputs from Soft keyboards. In case of unicode input\n    *    we need to to check if the key provided needs to send an additional\n    *    shift as well. VScanCodes assume Shift is sent.\n    *\n    *    Ex: keyCode 65, 97 are both mapped to 0x1e and hence for soft\n    *        keyboards, we need to compute the extra shift key.\n    *\n    *    activeModifiers are used differently by Soft Keyboard compared to the\n    *    desktop browser keyboards. The state of the activeModifiers are not\n    *    managed by sending the keystrokes, but are explicitly turned on / off\n    *    from the touch inputs.\n    *\n    *    The needsShift is specifically used for sending VScanCodes. This one\n    *    sends an extra Shift key. However, if the activeModifier is already\n    *    has the shiftKey down, we need to flip it, to revert this. Hence the\n    *    needShift and activeModifiers shift work hand in hand.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.handleSoftKb = function(key, isUnicode) {\n      var implicitShift, shiftSentAlready;\n\n      /*\n       * In case of unicode, determine if the shift key is implicit.\n       * Ex: keyCode 97(char 'A') = 65(char 'a') + Shift (implicit)\n       * We need this for sending VScanCode, as VScanCodes do not handle unicode\n       * and we have to wrap the input key with a shift.\n       */\n      implicitShift = (isUnicode && WMKS.CONST.KB.UnicodeWithShift[key]);\n\n      if (implicitShift) {\n         // Determine if shift was already sent via extendedKeypad.\n         shiftSentAlready =\n            ($.inArray(WMKS.CONST.KB.KEY_CODE.Shift, this.activeModifiers) !== -1);\n\n         if (!shiftSentAlready && !this._isUnicodeInputSupported()) {\n            // Send shift down before sending the keys.\n            this.sendKey(WMKS.CONST.KB.KEY_CODE.Shift, false, false);\n         }\n         // Send the key-down and up.\n         this.sendKey(key, false, isUnicode);\n         this.sendKey(key, true, isUnicode);\n\n         // Determine if we need to send a shift down / up.\n         if (!shiftSentAlready && !this._isUnicodeInputSupported()) {\n            this.sendKey(WMKS.CONST.KB.KEY_CODE.Shift, true, false);\n         } else if (shiftSentAlready && this._isUnicodeInputSupported()) {\n            // WMKS.LOGGER.debug('Send extra shift down to keep the modifier state');\n            this.sendKey(WMKS.CONST.KB.KEY_CODE.Shift, false, false);\n         }\n      } else {\n         // Send the key-down and up.\n         this.sendKey(key, false, isUnicode);\n         this.sendKey(key, true, isUnicode);\n      }\n   };\n\n\n   /**\n    *---------------------------------------------------------------------------\n    *\n    * isBrowserCapsLockOn\n    *\n    * Utility function used to detect if CAPs lock is on. Based on the\n    * Javascript inputs we attempt to detect if the browser CapsLock is on.\n    * We can only detect this on desktop browsers that sends shift key\n    * separately. We can for sure say if its CapsLock enabled. But we cannot\n    * say if the capsLock is not enabled, as non-unicode does not pass that\n    * info.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.isBrowserCapsLockOn = function(keyCode, isUnicode, shiftKeyDown) {\n      return !WMKS.BROWSER.isTouchDevice()\n         && isUnicode\n         && ((WMKS.CONST.KB.UnicodeOnly[keyCode] && shiftKeyDown)\n         || (WMKS.CONST.KB.UnicodeWithShift[keyCode] && !shiftKeyDown));\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * sendKey\n    *\n    *    Single point of action for sending keystrokes to the protocol.\n    *    Needs to know whether it's a down or up operation, and whether\n    *    keyCode is a Unicode character index (keypress) or a raw one (keydown).\n    *\n    *    Depending on what type key message is sent, the appropriate lookups are\n    *    made and sent.\n    *\n    *    This function is also the final frontier for limiting processing of\n    *    key inputs.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.sendKey = function(key, isUp, isUnicode) {\n      // Check if VMW key event can be used to send key inputs.\n      if (!this._vncDecoder.useVMWKeyEvent) {\n         return;\n      }\n\n      // Final frontier for banning keystrokes.\n      if (!isUnicode && this.ignoredRawKeyCodes.indexOf(key) !== -1) {\n         return;\n      }\n\n      // WMKS.LOGGER.log((isUnicode? '+U' : '') + key + (isUp? '-up' : '-d'));\n      if (this._vncDecoder.allowVMWKeyEvent2UnicodeAndRaw) {\n         // Blast uses the unicode mode where we send unicode / raw keyCode.\n         this._vncDecoder.onVMWKeyUnicode(key, !isUp, !isUnicode);\n      } else {\n         // Send VMware VScanCodes.\n         this._sendVScanCode(key, isUp, isUnicode);\n      }\n   };\n\n   /**\n    *---------------------------------------------------------------------------\n    *\n    * _sendVScanCode\n    *\n    *    This function handles the complexity of sending VScanCodes to the\n    *    server. This function looks up 2 different tables to convert unicode\n    *    to VScanCodes.\n    *       1. Unicode to VScanCode\n    *       2. Raw JS KeyCodes to VScanCodes.\n    *\n    *    TODO: Cleanup keyboardMapper and keyboardUtils once key repeats\n    *          and CAPs lock are handled as expected.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._sendVScanCode = function(key, isUp, isUnicode) {\n      var vScanCode = null;\n      if (isUnicode || key === 13) {\n         vScanCode = this.UnicodeToVScanMap[key];\n      }\n      if (!vScanCode) {\n         var table = WMKS.keyboardUtils._jsToVScanTables[this.keyboardLayoutId];\n         if (!!table) {\n            vScanCode = table[key];\n         }\n         if (!vScanCode) {\n            // Since vScanCode is not valid, reset the flag.\n            vScanCode = WMKS.keyboardUtils._jsToVScanTable[key];\n         }\n         /**\n          * Support Ctrl+C/V in WSX and vSphere NGC.\n          * Both in WSX and vSphere NGC, send vScanCode to the server.\n          * However, _jsToVScanTable lacks mapping for the characters\n          * a-z, hence, when pressing Ctrl+C, c is not mapped and sent.\n          * In this scenario, map c using the UnicodeToVScanMap and\n          * send the code to the server.\n          */\n         if (!vScanCode) {\n            // Mapping to VScanCode using the unicode mapping table.\n            vScanCode = this.UnicodeToVScanMap[key];\n         }\n      }\n      if (!!vScanCode) {\n         // WMKS.LOGGER.debug('key: ' + key + ' onKeyVScan: ' + vScanCode\n         //   + (isUp? '-up' : '-d'));\n         // performMapping keyCode to VMware VScanCode and send it.\n         this._vncDecoder.onKeyVScan(vScanCode, !isUp);\n      } else {\n         WMKS.LOGGER.debug('unknown key: ' + key + (isUp? '-up' : '-d'));\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * clearState\n    *\n    *    Single point of action for sending keystrokes to the protocol. Nice for\n    *    debugging. Needs to know whether it's a down or up operation, and\n    *    whether the keyCode is a unicode character index (keypress) or a\n    *    raw one (keydown).\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.clearState = function() {\n      // Clear any keyboard specific state that's held.\n\n      // Clear modifiers.\n      this.activeModifiers.length = 0;\n\n      // clear all modifier keys on start\n      this.sendKey(WMKS.CONST.KB.KEY_CODE.Alt, true, false);\n      this.sendKey(WMKS.CONST.KB.KEY_CODE.Ctrl, true, false);\n      this.sendKey(WMKS.CONST.KB.KEY_CODE.Shift, true, false);\n      // Send meta only if its Mac OS.\n      if (WMKS.BROWSER.isMacOS()) {\n         this.sendKey(WMKS.CONST.KB.KEY_CODE.Meta, true, false);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * enableWindowsKey\n    *\n    *    Enable/disable the simulation of Windows key.\n    *    Press Ctrl+Win on Windows or Ctrl+CMD on Mac to simulate Windows key.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.enableWindowsKey = function(value) {\n      this._windowsKeyManager.enabled = value;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * setIgnoredRawKeyCodes\n    *\n    *    Set ignore raw keyCodes set.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.setIgnoredRawKeyCodes = function(value) {\n      this.ignoredRawKeyCodes = value;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _isUnicodeInputSupported\n    *\n    *    This is a wrapper function that determines if the unicode input is\n    *    handled by the server.\n    *\n    *    NOTE: true for Blast, false for WSX, NGC, etc.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._isUnicodeInputSupported = function() {\n      return this._vncDecoder.allowVMWKeyEvent2UnicodeAndRaw;\n   };\n};\n\n\n/**\n * WMKS.CONST.KB.UnicodeOnly\n * WMKS.CONST.KB.UnicodeWithShift\n * WMKS.CONST.KB.UnicodeToVScanMap\n *\n * The following are 2 sets of mapping that contain a key-value pair of unicode\n * to VScanCode map. Its split the mapping into two maps to enable detection\n * of whether the unicode is just a VScanCode or a combo of VScanCode with the\n * shift key down. This distinction is necessary in case of soft keyboards.\n *\n * These 2 maps are then merged into 1 final map UnicodeToVScanMap, that will\n * be used in the lookup code to send vScanCodes.\n */\nWMKS.CONST.KB.UnicodeOnly = {\n\n   // Space, enter, backspace\n   32 : 0x39,\n   13 : 0x1c,\n   //8 : 0x0e,\n\n   // Keys a-z\n   97  : 0x1e,\n   98  : 0x30,\n   99  : 0x2e,\n   100 : 0x20,\n   101 : 0x12,\n   102 : 0x21,\n   103 : 0x22,\n   104 : 0x23,\n   105 : 0x17,\n   106 : 0x24,\n   107 : 0x25,\n   108 : 0x26,\n   109 : 0x32,\n   110 : 0x31,\n   111 : 0x18,\n   112 : 0x19,\n   113 : 0x10,\n   114 : 0x13,\n   115 : 0x1f,\n   116 : 0x14,\n   117 : 0x16,\n   118 : 0x2f,\n   119 : 0x11,\n   120 : 0x2d,\n   121 : 0x15,\n   122 : 0x2c,\n\n   // keyboard number keys (across the top) 1,2,3... -> 0\n   49 : 0x02,\n   50 : 0x03,\n   51 : 0x04,\n   52 : 0x05,\n   53 : 0x06,\n   54 : 0x07,\n   55 : 0x08,\n   56 : 0x09,\n   57 : 0x0a,\n   48 : 0x0b,\n\n   // Symbol keys ; = , - . / ` [ \\ ] '\n   59 : 0x27, // ;\n   61 : 0x0d, // =\n   44 : 0x33, // ,\n   45 : 0x0c, // -\n   46 : 0x34, // .\n   47 : 0x35, // /\n   96 : 0x29, // `\n   91 : 0x1a, // [\n   92 : 0x2b, // \\\n   93 : 0x1b, // ]\n   39 : 0x28  // '\n\n};\n\nWMKS.CONST.KB.UnicodeWithShift = {\n   // Keys A-Z\n   65 : 0x001e,\n   66 : 0x0030,\n   67 : 0x002e,\n   68 : 0x0020,\n   69 : 0x0012,\n   70 : 0x0021,\n   71 : 0x0022,\n   72 : 0x0023,\n   73 : 0x0017,\n   74 : 0x0024,\n   75 : 0x0025,\n   76 : 0x0026,\n   77 : 0x0032,\n   78 : 0x0031,\n   79 : 0x0018,\n   80 : 0x0019,\n   81 : 0x0010,\n   82 : 0x0013,\n   83 : 0x001f,\n   84 : 0x0014,\n   85 : 0x0016,\n   86 : 0x002f,\n   87 : 0x0011,\n   88 : 0x002d,\n   89 : 0x0015,\n   90 : 0x002c,\n\n   // Represents number 1, 2, ... 0 with Shift.\n   33 : 0x0002, // !\n   64 : 0x0003, // @\n   35 : 0x0004, // #\n   36 : 0x0005, // $\n   37 : 0x0006, // %\n   94 : 0x0007, // ^\n   38 : 0x0008, // &\n   42 : 0x0009, // *\n   40 : 0x000a, // (\n   41 : 0x000b, // )\n\n   // Symbol keys with shift ----->  ; = , - . / ` [ \\ ] '\n   58  : 0x0027, // :\n   43  : 0x000d, // +\n   60  : 0x0033, // <\n   95  : 0x000c, // _\n   62  : 0x0034, // >\n   63  : 0x0035, // ?\n   126 : 0x0029, // ~\n   123 : 0x001a, // {\n   124 : 0x002b, // |\n   125 : 0x001b, // }\n   34  : 0x0028  // \"\n};\n\nWMKS.CONST.KB.VScanMap['en-US'] = $.extend({},\n                                           WMKS.CONST.KB.UnicodeOnly,\n                                           WMKS.CONST.KB.UnicodeWithShift);\n\n/*\n * wmks/keyboardUtils.js\n *\n *   WebMKS keyboard event decoder and key remapper.\n *\n */\n\nWMKS.keyboardUtils = {};\n\n\n\nWMKS.keyboardUtils._keyInfoTemplate = {\n   jsScanCode: 0,\n   vScanCode: 0,\n};\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * keyDownUpInfo\n *\n *    Parses a keydown/keyup event.\n *\n * Results:\n *    { jsScanCode,  The JavaScript-reposted scancode, if any. Arbitrary.\n *      vScanCode }  The VMX VScancode for the key on a US keyboard, if any.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.keyboardUtils.keyDownUpInfo = function(event) {\n   var evt = event || window.event;\n   var ki = this._keyInfoTemplate;\n\n   if (evt.type === 'keydown' || evt.type === 'keyup') {\n      /*\n       * Convert JS scancode to VMware VScancode\n       */\n      ki.jsScanCode = evt.keyCode;\n      ki.vScanCode = this._jsToVScanTable[ki.jsScanCode];\n\n      /*\n       * Workaround ie9/ie10 enter key behaviour.  We receive\n       * keydown/keyup events but no keypress events for the enter\n       * key.  On the other hand Firefox and Chrome give us\n       * keydown/keyup *plus* keypress events for this key.  Short of\n       * using a timer, don't see a way to catch both cases without\n       * introducing a browser dependency here.\n       */\n      if (WMKS.BROWSER.isIE() && WMKS.BROWSER.version.major <= 10 && ki.jsScanCode == 13) {\n         ki.vScanCode = 28;\n      }\n   }\n\n   return ki;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * keyPressInfo\n *\n *    Parses a keypress event.\n *\n * Results:\n *    The Unicode character generated during the event, or 0 if none.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.keyboardUtils.keyPressInfo = function(event) {\n   var evt = event || window.event;\n   var uChar = 0;\n\n   if (evt.type === 'keypress') {\n      uChar = evt.which;\n\n      /*\n       * Handle Backspace, Tab, ESC via keyDown instead.\n       */\n      if (uChar == 8 || uChar == 9 || uChar == 27) {\n         uChar = 0;\n      }\n   }\n\n   return uChar;\n};\n\n\n\n\n\n/*\n * JS scancode to VMware VScancode conversion table\n */\nWMKS.keyboardUtils._jsToVScanTable = {\n   // Space, enter, tab, escape, backspace\n   //32 : 0x039,\n   //13 : 0x01c,\n   9 : 0x00f,\n   27 : 0x001,\n   8 : 0x00e,\n\n   // shift, control, alt, Caps Lock, Num Lock\n   16 : 0x02a,     // left shift\n   17 : 0x01d,     // left control\n   18 : 0x038,     // left alt\n   20 : 0x03a,\n   240 : 0x03a,    // windows 8.1 caps lock\n   144 : 0x045,\n\n   // Arrow keys (left, up, right, down)\n   37 : 0x14b,\n   38 : 0x148,\n   39 : 0x14d,\n   40 : 0x150,\n\n   // Special keys (Insert, delete, home, end, page up, page down, F1 - F12)\n   45 : 0x152,\n   46 : 0x153,\n   36 : 0x147,\n   35 : 0x14f,\n   33 : 0x149,\n   34 : 0x151,\n   112 : 0x03b,\n   113 : 0x03c,\n   114 : 0x03d,\n   115 : 0x03e,\n   116 : 0x03f,\n   117 : 0x040,\n   118 : 0x041,\n   119 : 0x042,\n   120 : 0x043,\n   121 : 0x044,\n   122 : 0x057,\n   123 : 0x058,\n\n   // Special Keys (Left Apple/Command, Right Apple/Command, Left Windows, Right Windows, Menu)\n   224 : 0x038,\n   // ? : 0x138,\n   91 : 0x15b,\n   92 : 0x15c,\n   93 : 0, //?\n\n   42 : 0x054,  // PrintScreen / SysRq\n   19 : 0x100  // Pause / Break\n\n   /*\n    * Commented out since these are locking modifiers that easily get\n    * out of sync between server and client and thus cause unexpected\n    * behaviour.\n    */\n   //144 : 0x045,  // NumLock\n   //20 : 0x03a,  // CapsLock\n   //145 : 0x046,  // Scroll Lock\n\n};\nWMKS.keyboardUtils._jsToVScanTables = {\n   'de-DE' : {\n      //German dead keys\n      220: 0x029, //^\n      221: 0x00d,  //\n      192: 13,\n      192: 41, // ^ mac chrome\n      187: 13, //  mac chrome\n      96: 13 //  windows firefox\n   },\n   'es-ES' : {\n      //Spanish dead keys\n      94: 26,  //^\n      96: 26, //`\n      180: 40, //\n      168: 40, //\n      192: 26,\n      219: 26,\n      222: 40,\n      186: 26,\n      242: 26\n   },\n   'it-IT' : {\n      5: 18, //\n      30: 26,\n      29: 27,\n      64: 39, //\n      35: 40, //  bug 1710907\n      91: 26, // bug\n      93: 27, //+ bug\n      171: 27,\n      109: 39,\n      186: 39,\n      123: 26, // bug\n      125: 27, //*\n      8364: 18, //E\n   }\n};\nWMKS.keyboardUtils._charToKeycode = {\n   'de-DE' : {\n      '': 252,\n      '': 252,\n      '': 246,\n      '': 246,\n      '': 228,\n      '': 228\n   },\n   'es-ES' : {\n      '[': 192,\n      ']': 43,\n      '{': 222,\n      '}': 231,\n      '0': 186,\n      '\"': 1034,\n      '': 186,\n      '': 186,\n      '': 231,\n      '': 231,\n      '': 209,\n      '': 209,\n      '': 261,\n      '': 161\n   },\n   'it-IT' : {\n      '[': 30,\n      '{': 30,\n      ']': 29,\n      '}': 29,\n      '@': 1109,\n      '%': 1037,\n      '': 1224,\n      '': 1224,\n      '': 232,\n      '': 232,\n      '': 94,\n      '^': 94,\n      '': 242,\n      '': 242,\n      '': 249,\n      '': 249\n   },\n   'pt-BR' : {\n      '': 231,\n      '': 231\n      // '': 167,\n      // '': 186,\n      // '': 186\n   },\n   'pt-PT' : {\n      '': 231,\n      '': 231,\n      '': 186,\n      '': 186,\n      '': 43,\n      '': 187,\n      '': 187,\n      '': 333\n   },\n   'fr-FR' : {\n      '': 178\n   },\n   'fr-CH' : {\n      '': 167,\n      '': 176,\n      '': 232,\n      '': 252,\n      '': 233,\n      '': 246,\n      '': 1224,\n      '': 228,\n      '[': 232,\n      '{': 224,\n      '\"': 1224\n   },\n   'de-CH' : {\n      '': 167,\n      '': 176,\n      '': 232,\n      '': 252,\n      '': 233,\n      '': 246,\n      '': 1224,\n      '': 228,\n      '[': 232,\n      '{': 224,\n      '\"': 1224,\n      '': 228,\n      '': 246,\n      '': 252,\n      '': 1224,\n      '': 232,\n      '': 233\n   }\n};\nWMKS.keyboardUtils._remapUncontrolKeys = {\n   'de-DE' : {\n      17: 81,\n      13: 77\n   },\n   'es-ES' : {\n      27: 219\n   },\n   'it-IT' : {\n      13: 186\n   },\n   'pt-PT' : {\n      27: 168\n   },\n   'fr-FR' : {\n      27: 93\n   },\n   'fr-CH' : {\n      27: 232\n   },\n  'de-CH' : {\n      27: 232\n   }\n\n};\nWMKS.keyboardUtils._keypressUnusefulKeys = {\n   'de-DE' : [180,94,96],\n   'es-ES' : [180,96]\n};\n\nWMKS.keyboardUtils._SmallKeyboardKey = {\n   'de-DE' : [47,42,61],\n   'it-IT' : [47,42,61],\n   'es-ES' : [47,42,61],\n   'ja-JP_106/109': [42,43],\n   'en-US': [42,43],\n   'pt-BR': [42],\n   'pt-PT': [42,47],\n   'fr-FR': [43,46,47,48,49,50,51,52,53,54,55,56,57],\n   'fr-CH': [42,43,47],\n   'de-CH': [42,43,47]\n};\nWMKS.keyboardUtils._smallKeyboardPendingKey = {\n   'de-DE' : {\n      47: 55,\n      61: 48\n   },\n   'fr-FR': {\n      43: [187, 61], // windows chrome, win ff +\n      46: [190, 59], // windows chrome .\n      47: [191, 58], // windows chrome /\n      48: 48,\n      49: 49,\n      50: 50,\n      51: 51,\n      52: 52,\n      53: 53,\n      54: 54,\n      55: 55,\n      56: 56,\n      57: 57\n   }\n};\n\n/*\n * it-IT :# @ [ ] { } \n * fr-fr :# @ [ \\ ] ^ ` { | } ~  \n * fr-CH :    #   @   [   \\   ]   {   |     }    ~                `    \n */\n\nWMKS.keyboardUtils._WindowsFirefoxAltGr = {\n   'pt-PT': [64, 91, 93, 123, 125, 163, 167, 168, 178, 8364],\n   'de-DE': [64, 91, 92, 93, 123, 124, 125, 126, 172, 178, 179, 181, 8364],\n   'it-IT': [35, 64, 91, 93, 123, 125, 8364],\n   'es-ES': [35, 64, 91, 92, 93, 123, 124, 125, 126, 172, 178, 179, 181, 8364],\n   'fr-FR': [35, 64, 91, 92, 93, 94, 96, 123, 124, 125, 126, 164, 8364],\n   'fr-CH': [35, 64, 91, 92, 93, 123, 124, 125, 126, 162, 166, 172, 167, 176, 219, 8364],\n   'de-CH': [35, 64, 91, 92, 93, 123, 124, 125, 126, 162, 166, 172, 167, 176, 8364]\n};\n\nWMKS.keyboardUtils._remapPending = {\n   'fr-CH' : {\n      224: 65, // \n      232: 69, // \n      233: 69, // \n      228: 65, // \n      246: 79, // \n      252: 85, // \n      192: 65, // \n      219: 85, // \n      241: 78, // N\n      209: 78, // n\n      176: 52, // \n      167: 53 // \n   },\n   'fr-FR' : {\n      224: 65, // \n      232: 69, // \n      236: 73, // \n      242: 79, // \n      249: 85, // \n      241: 78 // ~n\n   },\n   'de-CH' : {\n      //German dead keys\n      224: 65, // \n      232: 69, // \n      233: 69, // \n      228: 65, // \n      246: 79, // \n      252: 85, // \n      192: 65, // \n      241: 78, // N\n      209: 78, // n\n      176: 52, // \n      167: 53, // \n      196: 65, // \n      214: 79, // \n      220: 85, // \n      200: 69, // \n      192: 65, // \n      201: 69, // \n      219: 85  // \n   },\n   'de-DE' : {\n      193: 65, // \n      201: 69, // \n      205: 73, // \n      211: 79, // \n      218: 85, // \n      194: 65, // \n      202: 69, // \n      206: 73, // \n      212: 79, // \n      219: 85  // \n   },\n   'ja-JP_106/109' : {\n      92: 226 // \\ windows firefox \\ and top right key value are the same\n   },\n   'es-ES' : {\n      193: 65, // \n      201: 69, // \n      205: 73, // \n      211: 79, // \n      218: 85, // \n      192: 65, // \n      200: 69, // \n      204: 73, // \n      210: 79, // \n      217: 85, // \n      241: 78 // ~n\n   }\n};\nWMKS.keyboardUtils._remapFrChAltgrKey = {\n   91:180, //up accent\n   93:94, //~\n   59:91, // [\n   94:93,  //]\n   92:123, //{\n   0:125 //}\n};/*globals WMKS */\n\nWMKS.keyboardMapper = function(options) {\n   if (!options.vncDecoder) {\n      return null;\n   }\n\n   this._vncDecoder = options.vncDecoder;\n\n   this._keysDownVScan = [];\n   this._keysDownUnicode = [];\n\n   this.VSCAN_CAPS_LOCK_KEY = 58;\n   this.VSCAN_CMD_KEY = 347;\n\n   // The current repeating typematic key\n   this._typematicKeyVScan = 0;\n   this._typematicDelayTimer = null;\n\n   return this;\n};\n\n\nWMKS.keyboardMapper.prototype.doKeyVScan = function(vscan, down) {\n   if (!this._vncDecoder.useVMWKeyEvent) {\n      return;\n   }\n\n   /*\n    * Caps lock is an unusual key and generates a 'down' when the\n    * caps lock light is going from off -> on, and then an 'up'\n    * when the caps lock light is going from on -> off. The problem\n    * is compounded by a lack of information between the guest & VMX\n    * as to the state of caps lock light. So the best we can do right\n    * now is to always send a 'down' for the Caps Lock key to try and\n    * toggle the caps lock state in the guest.\n    */\n   if (vscan === this.VSCAN_CAPS_LOCK_KEY && (navigator.platform.indexOf('Mac') !== -1)) {\n       this._vncDecoder.onKeyVScan(vscan, 1);\n       this._vncDecoder.onKeyVScan(vscan, 0);\n       return;\n   }\n\n   /*\n    * Manage an array of VScancodes currently held down.\n    */\n   if (down) {\n      if (this._keysDownVScan.indexOf(vscan) <= -1) {\n         this._keysDownVScan.push(vscan);\n      }\n      this.beginTypematic(vscan);\n   } else {\n      this.cancelTypematic(vscan);\n      /*\n       * If the key is in the array of keys currently down, remove it.\n       */\n      var index = this._keysDownVScan.indexOf(vscan);\n      if (index >= 0) {\n         this._keysDownVScan.splice(index, 1);\n      }\n   }\n\n   /*\n    * Send the event.\n    */\n   this._vncDecoder.onKeyVScan(vscan, down);\n};\n\n\nWMKS.keyboardMapper.prototype.doKeyUnicode = function(uChar, down) {\n   if (!this._vncDecoder.useVMWKeyEvent) {\n      return;\n   }\n\n   /*\n    * Manage an array of Unicode chars currently \"held down\".\n    */\n   if (down) {\n      this._keysDownUnicode.push(uChar);\n   } else {\n      /*\n       * If the key is in the array of keys currently down, remove it.\n       */\n      var index = this._keysDownUnicode.indexOf(uChar);\n      if (index >= 0) {\n         this._keysDownUnicode.splice(index, 1);\n      }\n   }\n\n\n   var modvscan = this._tableUnicodeToVScan[uChar];\n\n   /*\n    * Press the final key itself.\n    */\n   if (modvscan) {\n      if (down) {\n         this.beginTypematic(modvscan & 0x1ff);\n      } else {\n         this.cancelTypematic(modvscan & 0x1ff);\n      }\n      this._vncDecoder.onKeyVScan(modvscan & 0x1ff, down);\n   }\n};\n\n\nWMKS.keyboardMapper.prototype.doReleaseAll = function() {\n   var i;\n\n   for (i = 0; i < this._keysDownUnicode.length; i++) {\n      this.doKeyUnicode(this._keysDownUnicode[i], 0);\n   }\n   if (this._keysDownUnicode.length > 0) {\n      console.log(\"Warning: Could not release all Unicode keys.\");\n   }\n\n   for (i = 0; i < this._keysDownVScan.length; i++) {\n      this.cancelTypematic(this._keysDownVScan[i]);\n      this._vncDecoder.onKeyVScan(this._keysDownVScan[i], 0);\n   }\n   this._keysDownVScan = [];\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * beginTypematic\n *\n *    Begin the typematic process for a new key going down. Cancel any pending\n *    timers, record the new key going down and start a delay timer.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.keyboardMapper.prototype.beginTypematic = function (vscan) {\n   /*\n    * Don't begin typematic if the cmd key is down, we don't get\n    * a key up for the alpha key if it was down whilst the cmd key\n    * was also down. So there's no cancel of typematic.\n    */\n   if (this._keysDownVScan.indexOf(this.VSCAN_CMD_KEY) >= 0) {\n      return;\n   }\n\n   // Cancel any typematic delay timer that may have been previously started\n   this.cancelTypematicDelay();\n   // And cancel any typematic periodic timer that may have been started\n   this.cancelTypematicPeriod();\n   if (this._vncDecoder.typematicState === 1) {\n      // Begin the delay timer, when this fires we'll\n      // start auto-generating down events for this key.\n      this.startTypematicDelay(vscan);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * cancelTypematic\n *\n *    Cancel the typematic process for a key going up. If the key going up is our\n *    current typematic key then cancel both delay and periodic timers (if they exist).\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.keyboardMapper.prototype.cancelTypematic = function (vscan) {\n    if (this._typematicKeyVScan === vscan) {\n       this.cancelTypematicDelay();\n       this.cancelTypematicPeriod();\n    }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * cancelTypematicDelay\n *\n *    Cancel a typematic delay (before auto-repeat) .\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.keyboardMapper.prototype.cancelTypematicDelay = function() {\n   if (this._typematicDelayTimer !== null) {\n      clearTimeout(this._typematicDelayTimer);\n   }\n   this._typematicDelayTimer = null;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * cancelTypematicPeriod\n *\n *    Cancel a typematic periodic timer (the auto-repeat timer) .\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.keyboardMapper.prototype.cancelTypematicPeriod = function() {\n    if (this._typematicPeriodTimer !== null) {\n        clearInterval(this._typematicPeriodTimer);\n    }\n    this._typematicPeriodTimer = null;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * startTypematicDelay\n *\n *    Start the typematic delay timer, when this timer fires, the specified\n *    auto-repeat will begin and send the recorded typematic key vscan code.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.keyboardMapper.prototype.startTypematicDelay = function(vscan) {\n   var self = this;\n   this._typematicKeyVScan = vscan;\n   this._typematicDelayTimer = setTimeout(function () {\n     self._typematicPeriodTimer = setInterval(function() {\n        self._vncDecoder.onKeyVScan(self._typematicKeyVScan, 1);\n     }, self._vncDecoder.typematicPeriod / 1000);\n   }, this._vncDecoder.typematicDelay / 1000);\n};\n\n\n/*\n * Unicode to VMware VScancode conversion tables\n */\n\n//WMKS.keyboardMapper.prototype._modShift = 0x1000;\n//WMKS.keyboardMapper.prototype._modCtrl  = 0x2000;\n//WMKS.keyboardMapper.prototype._modAlt   = 0x4000;\n//WMKS.keyboardMapper.prototype._modWin   = 0x8000;\n\nWMKS.keyboardMapper.prototype._tableUnicodeToVScan = {\n   // Space, enter, backspace\n   32 : 0x39,\n   13 : 0x1c,\n   //8 : 0x0e,\n\n   // Keys a-z\n   97  : 0x1e,\n   98  : 0x30,\n   99  : 0x2e,\n   100 : 0x20,\n   101 : 0x12,\n   102 : 0x21,\n   103 : 0x22,\n   104 : 0x23,\n   105 : 0x17,\n   106 : 0x24,\n   107 : 0x25,\n   108 : 0x26,\n   109 : 0x32,\n   110 : 0x31,\n   111 : 0x18,\n   112 : 0x19,\n   113 : 0x10,\n   114 : 0x13,\n   115 : 0x1f,\n   116 : 0x14,\n   117 : 0x16,\n   118 : 0x2f,\n   119 : 0x11,\n   120 : 0x2d,\n   121 : 0x15,\n   122 : 0x2c,\n\n   // keyboard number keys (across the top) 1,2,3... -> 0\n   49 : 0x02,\n   50 : 0x03,\n   51 : 0x04,\n   52 : 0x05,\n   53 : 0x06,\n   54 : 0x07,\n   55 : 0x08,\n   56 : 0x09,\n   57 : 0x0a,\n   48 : 0x0b,\n\n   // Symbol keys ; = , - . / ` [ \\ ] '\n   59 : 0x27, // ;\n   61 : 0x0d, // =\n   44 : 0x33, // ,\n   45 : 0x0c, // -\n   46 : 0x34, // .\n   47 : 0x35, // /\n   96 : 0x29, // `\n   91 : 0x1a, // [\n   92 : 0x2b, // \\\n   93 : 0x1b, // ]\n   39 : 0x28,  // '\n\n\n   // Keys A-Z\n   65 : 0x001e,\n   66 : 0x0030,\n   67 : 0x002e,\n   68 : 0x0020,\n   69 : 0x0012,\n   70 : 0x0021,\n   71 : 0x0022,\n   72 : 0x0023,\n   73 : 0x0017,\n   74 : 0x0024,\n   75 : 0x0025,\n   76 : 0x0026,\n   77 : 0x0032,\n   78 : 0x0031,\n   79 : 0x0018,\n   80 : 0x0019,\n   81 : 0x0010,\n   82 : 0x0013,\n   83 : 0x001f,\n   84 : 0x0014,\n   85 : 0x0016,\n   86 : 0x002f,\n   87 : 0x0011,\n   88 : 0x002d,\n   89 : 0x0015,\n   90 : 0x002c,\n\n   33 : 0x0002, // !\n   64 : 0x0003, // @\n   35 : 0x0004, // #\n   36 : 0x0005, // $\n   37 : 0x0006, // %\n   94 : 0x0007, // ^\n   38 : 0x0008, // &\n   42 : 0x0009, // *\n   40 : 0x000a, // (\n   41 : 0x000b, // )\n\n   58  : 0x0027, // :\n   43  : 0x000d, // +\n   60  : 0x0033, // <\n   95  : 0x000c, // _\n   62  : 0x0034, // >\n   63  : 0x0035, // ?\n   126 : 0x0029, // ~\n   123 : 0x001a, // {\n   124 : 0x002b, // |\n   125 : 0x001b, // }\n   34  : 0x0028, // \"\n};\n/* global $:false, WMKS:false */\n\n/*\n *------------------------------------------------------------------------------\n * wmks/touchHandler.js\n *\n *    This class abstracts touch input management and decouples this\n *    functionality from the widgetProto.\n *\n *    All variables are defined as private variables. Functions that do not\n *    need to be exposed should be private too.\n *\n *------------------------------------------------------------------------------\n */\n\n/*\n *------------------------------------------------------------------------------\n *\n * WMKS.CONST.TOUCH\n *\n *    Enums and constants for touchHandlers. These comprise of constants for\n *    various gestures and types of gestures, etc.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.CONST.TOUCH = {\n   FEATURE: {                             // List of optional touch features.\n      SoftKeyboard:     0,\n      ExtendedKeypad:   1,\n      Trackpad:         2\n   },\n   // Tolerances for touch control\n   tapMoveCorrectionDistancePx: 10,\n   additionalTouchIgnoreGapMs: 1200,\n   touchMoveSampleMinCount:   2,\n   minKeyboardToggleTime:     50,         // Minimum time between keyboard toggles.\n   leftDragDelayMs:           300,\n   OP: {                                  // Touch event/gesture types.\n      none:                   'none',\n      scroll:                 'scroll',\n      drag:                   'drag',\n      move:                   'move',\n      tap_twice:              'double-click',\n      tap_1finger:            'click',\n      tap_3finger:            'tap-3f'\n   },\n   SCROLL: {\n      minDeltaDistancePx:     20          // Min distance to scroll before sending a scroll message.\n   },\n   DOUBLE_TAP: {                          // Constants for tolerance between double taps.\n      tapGapInTime:           250,        // Allowed ms delay b/w the 2 taps.\n      tapGapBonusTime:        200,        // Allowed extra ms delay based on tapGapBonus4TimeRatio value wrt tap proximity.\n      tapGapBonus4TimeRatio:  0.4,        // Allowed ratio of tap proximity b/w taps vs tapGapInTime to activate tapGapBonusTime.\n      tapGapInDistance:       40          // Allowed px distance b/w the 2 taps.\n   }\n};\n\n\nWMKS.TouchHandler = function(options) {\n   'use strict';\n   if (!options || !options.canvas ||\n       !options.widgetProto || !options.keyboardManager) {\n      WMKS.LOGGER.warn('Invalid params set for TouchHandler.');\n      return null;\n   }\n\n   var _widget = options.widgetProto,\n       _keyboardManager = options.keyboardManager,\n       _KEYBOARD = {\n         visible: false,             // Internal flag to identify keyboard state.\n         lastToggleTime: 0           // Last keyboard toggle timestamp used to detect spurious requests.\n       },\n       _repositionElements = [],     // Elements needing reposition upon rotation.\n       _canvas = options.canvas,     // Canvas where all the action happens.\n       _onToggle = options.onToggle; // Toggle callback function.\n\n   // Timers\n   var _dragTimer = null,\n       _TAP_STATE = {               // Touch state machine.\n         currentTouchFingers: -1,   // Indicates number of touch fingers\n         firstTouch: null,\n         currentTouch: null,\n         touchArray: [],\n         tapStartTime: null,        // Used to detect double tap\n         touchMoveCount: 0,\n         skipScrollCount: 0,\n         scrollCount: 0,\n         zoomCount: 0,\n         opType: WMKS.CONST.TOUCH.OP.none\n       };\n\n      // List of jQuery objects that are used frequently.\n   var _ELEMENTS = {\n         inputProxy        : null,\n         cursorIcon        : null,\n         clickFeedback     : null,\n         dragFeedback      : null,\n         pulseFeedback     : null,\n         scrollFeedback    : null,\n         keypad            : null,\n         trackpad          : null\n       };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _verifyQuickTouches\n    *\n    *    We noticed that the touch events get fired extremely quickly when there\n    *    is touchstart, touchstart, touchmove, and the browser itself does not\n    *    detect the second touchstart before the touchmove, instead it shows 1\n    *    touchstartand the first touchmove indicates 1 finger with a move of\n    *    over 50px. We decode the touchmoved location to the second touchstart\n    *    location.\n    *\n    *    Ex: Following log indicates this scenario:\n    *    3:41:54.566Z [Debug] touchstart#: 1 (e.targetTouches.length)\n    *    3:41:54.568Z [Debug] touchstart#: 1 (e.targetTouches.length)\n    *    3:41:54.584Z [Debug] single tap drag dist: 147.8715658942, scale: 0.90927...\n    *    3:41:54.586Z [Info ] touchmove count: 1 touch#: 1 (e.targetTouches.length)\n    *    3:41:54.600Z [Debug] onGestureEnd: 0.9092.. <-- gestureEnd happens only\n    *                         if there were 2 touchstarts in the first place.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._verifyQuickTouches = function(e, dist, touchMoveCount) {\n      // Only make use of this state if the opType is not defined, there\n      // is a change in scale, this is the first touchmove and the distance b/w\n      // firsttouch and the touchmove's event location is really huge.\n      if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.none\n            && dist > 50 && touchMoveCount === 1) {\n         WMKS.LOGGER.debug('Special case - touchmove#: ' + touchMoveCount\n            + ', targetTouches#: ' + e.targetTouches.length\n            + ', dist: ' + dist + ', scale: ' + e.scale);\n         return true;\n      }\n      return false;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _initDragEventAndSendFeedback\n    *\n    *    This is the initialization event that happens when we detect a gesture\n    *    as a drag. It does the following:\n    *    1. Sends a mouse down where the touch initially happened.\n    *    2. Shows drag ready feedback.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._initDragEventAndSendFeedback = function(firstTouch) {\n      if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.drag) {\n         // Send the left mousedown at the touch location & send drag feedback\n         var pos = this._applyZoomCorrectionToTouchXY(firstTouch);\n         _widget.sendMouseButtonMessage(pos, true, WMKS.CONST.CLICK.left);\n         // Show drag icon above implying the drag is ready to use.\n         this._showFeedback(_ELEMENTS.dragFeedback, firstTouch);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _initTwoFingerTouch\n    *\n    *    This is the initialization event that happens when we detect a gesture\n    *    as a drag. It does the following:\n    *    1. Sends a mouse down where the touch initially happened.\n    *    2. Shows drag ready feedback.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._initTwoFingerTouch = function(firstTouch, secondTouch) {\n      /* WMKS.LOGGER.debug('Touch1: ' + firstTouch.screenX + ','\n         + firstTouch.screenY + ' touch 2: ' + secondTouch.screenX + ','\n         + secondTouch.screenY + ' opType: ' + _TAP_STATE.opType); */\n      if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.none) {\n         _TAP_STATE.currentTouchFingers = 2;\n         /*\n          * Now, 2 finger tap just happened. This could be one of the following:\n          *    1. Scroll - (To detect use angle b/w lines upon touchmove).\n          *    2. Zoom/pinch - Handled by the default handler (detect as above).\n          *    3. right-click (When its neither of the above).\n          *\n          * Store the original 2 finger location and the leftmost location.\n          * NB: Use location of the leftmost finger to position right click.\n          * TODO: lefty mode\n          */\n         _TAP_STATE.touchArray.push(firstTouch);\n         _TAP_STATE.touchArray.push(secondTouch);\n         _TAP_STATE.firstTouch = WMKS.UTIL.TOUCH.copyTouch(\n            WMKS.UTIL.TOUCH.leftmostOf(firstTouch, secondTouch));\n         _TAP_STATE.currentTouch = WMKS.UTIL.TOUCH.copyTouch(_TAP_STATE.firstTouch);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _sendScrollEventMessage\n    *\n    *    This function handles the computation of the vertical scroll distance.\n    *    If the distance is more than the threshold, then sends the appropriate\n    *    message to the server.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._sendScrollEventMessage = function(touch) {\n      var dx = 0, dy = 0, deltaX, deltaY, wheelDeltas, firstPos;\n      if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.scroll) {\n         deltaX = touch.clientX - _TAP_STATE.currentTouch.clientX;\n         deltaY = touch.clientY - _TAP_STATE.currentTouch.clientY;\n\n         wheelDeltas = this._calculateMouseWheelDeltas(deltaX, deltaY);\n         dx = wheelDeltas.wheelDeltaX;\n         dy = wheelDeltas.wheelDeltaY;\n\n         // Only send if at least one of the deltas has a value.\n         if (dx !== 0 || dy !== 0) {\n            firstPos = this._applyZoomCorrectionToTouchXY(_TAP_STATE.touchArray[0]);\n            _widget.sendScrollMessage(firstPos, dx, dy);\n\n            // Update clientX, clientY values as we only need them.\n            if (dx !== 0) {\n               _TAP_STATE.currentTouch.clientX = touch.clientX;\n            }\n\n            if (dy !== 0) {\n               _TAP_STATE.currentTouch.clientY = touch.clientY;\n            }\n         }\n      }\n      // TODO: Improve scroll by using residual scroll data when delta < minDeltaDistancePx.\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _calculateMouseWheelDeltas\n    *\n    *    This function calculates the wheelDeltaX and wheelDeltaY values\n    *    according to the scroll delta distance.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._calculateMouseWheelDeltas = function(deltaX, deltaY) {\n      var dx = 0,\n          dy = 0,\n          absDeltaX = Math.abs(deltaX),\n          absDeltaY = Math.abs(deltaY),\n          scrollX = absDeltaX > WMKS.CONST.TOUCH.SCROLL.minDeltaDistancePx,\n          scrollY = absDeltaY > WMKS.CONST.TOUCH.SCROLL.minDeltaDistancePx,\n          angle;\n\n      /*\n       * We don't want to send movements for every pixel we move.\n       * So instead, we pick a threshold, and only scroll that amount.\n       * This won't be perfect for all applications.\n       */\n      if (scrollX && scrollY) {\n         /*\n          * If the scroll angle is smaller than 45 degree,\n          * do horizontal scroll; otherwise, do vertical scroll.\n          */\n         if (absDeltaY < absDeltaX) {\n            // Horizontal scroll only.\n            scrollY = false;\n         } else {\n            // Vertical scroll only.\n            scrollX = false;\n         }\n      }\n\n      if (scrollX) {\n         dx = deltaX > 0 ? 1 : -1;\n      }\n\n      if (scrollY) {\n         dy = deltaY > 0 ? -1 : 1;\n      }\n\n      if (_widget.options.reverseScrollY) {\n         dy = dy * -1;\n      }\n\n      return {wheelDeltaX : dx, wheelDeltaY : dy};\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _updatePreScrollState\n    *\n    *    This function verifies if there was a residual scroll event, and if so.\n    *    sends that after computing the directing of the scroll.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._updatePreScrollState = function(touch) {\n      var deltaY = touch.clientY - _TAP_STATE.currentTouch.clientY;\n      _TAP_STATE.scrollCount++;\n      if (deltaY < 0) {\n         _TAP_STATE.skipScrollCount--;\n      } else {\n         _TAP_STATE.skipScrollCount++;\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _sendResidualScrollEventMessage\n    *\n    *    This function verifies if there was a residual scroll event, and if so.\n    *    sends that after computing the directing of the scroll.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._sendResidualScrollEventMessage = function() {\n      // Detech if there is a leftover scroll event to be sent.\n      if (_TAP_STATE.skipScrollCount !== 0 && _TAP_STATE.currentTouch) {\n         var pos, sendScroll;\n\n         // Server pays attention only to the sign of the scroll direction.\n         sendScroll = (_TAP_STATE.skipScrollCount < 0) ? -1 : 1;\n\n         WMKS.LOGGER.debug('Sending a residual scroll message.');\n         WMKS.LOGGER.debug('Cur touch: ' + _TAP_STATE.currentTouch.pageX\n            + ' , ' + _TAP_STATE.currentTouch.pageY);\n\n         _TAP_STATE.skipScrollCount = 0;\n         pos = this._applyZoomCorrectionToTouchXY(_TAP_STATE.currentTouch);\n         // TODO KEERTHI: Fix this for horizontal scrolling as well.\n         // dx for horizontal, dy for vertical.\n         _widget.sendScrollMessage(pos, sendScroll, 0);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _isDoubleTap\n    *\n    *    Function to check if the tap is part of a double tap. The logic to\n    *    determine is:\n    *    1. There is always another tap earlier to this one.\n    *    2. The time and proximity b/w 2 taps happen within the threshold values\n    *    set in the constants: C.DOUBLE_TAP\n    *    3. Based on heuristics we found that some double taps took longer than\n    *    the threshold value but more accurate. Hence extend the time b/w double\n    *    taps if the proximity of these 2 taps are under the\n    *    tapGapBonus4TimeRatio(0.4) of the acceptable limit (tapGapInDistance).\n    *    4. Make sure the double tap is always different from the two finger\n    *    tap and the thresholds are within acceptable limits.\n    *---------------------------------------------------------------------------\n    */\n\n   this._isDoubleTap = function(event, now) {\n      var dist, duration;\n      // Check if this is the second tap and there is a time delay from the first.\n      if (_TAP_STATE.currentTouch === null || _TAP_STATE.tapStartTime === null\n         || _TAP_STATE.opType !== WMKS.CONST.TOUCH.OP.none) {\n         return false;\n      }\n      // Compute time difference and click position distance b/w taps.\n      dist = WMKS.UTIL.TOUCH.touchDistance(_TAP_STATE.currentTouch, event.targetTouches[0]);\n      duration = (now - _TAP_STATE.tapStartTime);\n      // WMKS.LOGGER.debug('is tap_two (ms): ' + duration + ' & offset (px): ' + dist);\n\n      // Check if the second tap occurred within the same vicinity as the first.\n      if (dist < WMKS.CONST.TOUCH.DOUBLE_TAP.tapGapInDistance) {\n         // If duration b/w taps is within acceptable limit\n         if (duration < WMKS.CONST.TOUCH.DOUBLE_TAP.tapGapInTime) {\n            // WMKS.LOGGER.debug('double tap correction activated.');\n            return true;\n         }\n         // If the taps were extremely accurate < 40% tap gap, add the extra bonus tap gap time\n         if ((dist / WMKS.CONST.TOUCH.DOUBLE_TAP.tapGapInDistance) < WMKS.CONST.TOUCH.DOUBLE_TAP.tapGapBonus4TimeRatio\n                 && duration < (WMKS.CONST.TOUCH.DOUBLE_TAP.tapGapInTime + WMKS.CONST.TOUCH.DOUBLE_TAP.tapGapBonusTime)) {\n            // WMKS.LOGGER.trace('Duration eligible for bonus with tapGapBonus4TimeRatio: '\n            //      + (dist / WMKS.CONST.TOUCH.DOUBLE_TAP.tapGapInDistance));\n            // WMKS.LOGGER.debug('double tap bonus correction activated.');\n            return true;\n         }\n      }\n      return false;\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _onTouchStart\n    *\n    *    Called when a touch operation begins.\n    *    A state machine is initiated which knows the number of fingers used for\n    *    this touch operation in the case where it uses one finger.\n    *\n    *    For every touchstart, we perform the following logic:\n    *    1. If the touch fingers = 1:\n    *       a) Check if this touchstart is part of a double-click. If so, set\n    *       the state machine info accordingly.\n    *       b) If not, then update the state machine accordingly.\n    *       c) for both case above, initialize a drag timer function with a\n    *           delay threshold and upon triggering, initialize and set\n    *           operation as a drag.\n    *    2. If touch fingers = 2:\n    *       a) Detect if we had earlier detected a 1 finger touchstart. In this\n    *          case if the second touch happens quite late (After a set\n    *          threshold) then we just ignore it. If not, then transform into\n    *          a 2 finger touchstart.\n    *          NOTE: This clears out the old 1 finger touchstart state.\n    *       b) Initialize the 2 finger touch start as this could be a zoom /\n    *          scroll/ right-click.\n    *    3. The 3 finger touch start is detected, and if no operation is\n    *       previously detected, then flag that state and toggle the keyboard.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._onTouchStart = function(e) {\n      var pos, timeGap, self = this, now = $.now();\n\n      // WMKS.LOGGER.debug('Start#: ' + e.targetTouches.length);\n      // Unless two fingers are involved (native scrolling) prevent default\n      if (e.targetTouches.length === 1) {\n         /*\n          * If it involves one finger, it may be:\n          * - left click (touchstart and touchend without changing position)\n          * - left drag (touchstart, activation timeout, touchmove, touchend)\n          * - right click with staggered fingers (touchstart, touchstart, touchend)\n          * - pan and scan (default behavior)\n          * Allow the default behavior, but record the touch just in case it\n          * becomes a click or drag.\n          *\n          * Also, check for a double click. See isDoubleTap() for details.\n          */\n\n         if (this._isDoubleTap(e, now)) {\n            _TAP_STATE.firstTouch =\n               WMKS.UTIL.TOUCH.copyTouch(_TAP_STATE.currentTouch);\n            _TAP_STATE.opType = WMKS.CONST.TOUCH.OP.tap_twice;\n         } else {\n            _TAP_STATE.firstTouch =\n               WMKS.UTIL.TOUCH.copyTouch(e.targetTouches[0]);\n            _TAP_STATE.currentTouch =\n               WMKS.UTIL.TOUCH.copyTouch(e.targetTouches[0]);\n         }\n\n         _TAP_STATE.currentTouchFingers = 1;\n         _TAP_STATE.tapStartTime = now;\n\n         // ontouchmove destroys this timer. The finger must stay put.\n         if (_dragTimer !== null) {\n            clearTimeout(_dragTimer);\n         }\n\n         _dragTimer = setTimeout(function() {\n            _dragTimer = null;\n\n            // Update opType and init the drag event.\n            _TAP_STATE.opType = WMKS.CONST.TOUCH.OP.drag;\n            self._initDragEventAndSendFeedback(_TAP_STATE.firstTouch);\n         }, WMKS.CONST.TOUCH.leftDragDelayMs);\n\n         // Must return true, else pinch to zoom and pan and scan will not work\n         return true;\n      } else if (e.targetTouches.length === 2) {\n         // If touchstart happen a while after one another, wrap up the original op.\n         if (_TAP_STATE.currentTouchFingers === 1) {\n            // Now the second tap happens after a while. Check if its valid\n            timeGap = now - _TAP_STATE.tapStartTime;\n            if (timeGap > WMKS.CONST.TOUCH.additionalTouchIgnoreGapMs) {\n               if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.drag) {\n                  // Drag was in progress and we see a new touch.\n                  // Hence end this and start a new one.\n                  pos = this._applyZoomCorrectionToTouchXY(e.targetTouches[0]);\n                  _widget.sendMouseButtonMessage(pos, true, WMKS.CONST.CLICK.left);\n                  this._resetTouchState();\n               }\n            }\n         }\n\n         // Setup for 2 finger gestures.\n         this._initTwoFingerTouch(WMKS.UTIL.TOUCH.copyTouch(e.targetTouches[0]),\n            WMKS.UTIL.TOUCH.copyTouch(e.targetTouches[1]));\n         // Always allow default behavior, this allows the user to pinch to zoom\n         return true;\n      } else if (e.targetTouches.length === 3) {\n         // Three fingers, toggle keyboard only if no gesture is detected.\n         if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.none) {\n            _TAP_STATE.opType = WMKS.CONST.TOUCH.OP.tap_3finger;\n            this.toggleKeyboard();\n            // Set touch fingers value, so touchend knows to clear state.\n            _TAP_STATE.currentTouchFingers = 3;\n         }\n         return false;\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _onTouchMove\n    *\n    *    This function handler is invoked when touchmove is detected. Here we do\n    *    the following:\n    *    1. Keep a track of how many touchmove events happen.\n    *    2. Clear out if any dragTimer as we see a touchmove.\n    *    3. If we have already detected an opType, then we just apply the\n    *       touchmove to that operation. Even if touch fingers changes midflight,\n    *       ignore them, as the use has already started using the operation\n    *       and hence should continue with that.\n    *    4. If no operation is detected and the touch fingers changes midflight,\n    *       then it could be the following:\n    *       a) Downgrade (2 --> 1 finger): If there is no scale value(distance\n    *          b/w touches didn't change), then its a right-click.\n    *       b) Upgrade (1 --> 2 finger): This is technically the same as a\n    *          2-finger touchstart at this point. NOTE: If there is a downgrade,\n    *          there wont be an upgrade.( It never goes from 2 --> 1 and then\n    *          1 --> 2 later).\n    *       c) If neither of the above, then its something we don't handle, must\n    *          be a zoom/pinch. Hence let the default behavior kick in.\n    *    5. When the touch fingers is 1, then it could be one of the following:\n    *       a) Wobbly fingers that we need to ignore move distance < threshold (10px).\n    *       b) Quick fingers, that's described in the function that detects it.\n    *          This can happen with a very specific set of data, and if so, detect\n    *          this as an initialization to 2 finger touchstart event.\n    *       c) If neither of the above, then panning is assumed, and leave this\n    *          to the browser to handle.\n    *    6. If the touch fingers = 2, then attempt to detect a scroll / zoom.\n    *       This is done based on computing the angle b/w the lines created from\n    *       the touch fingers starting point to their touchmoved destination.\n    *       Based on the angle, we determine if its a scroll or not. Sample\n    *       multiple times before making the decision.\n    *\n    *    During the computation, we use various touch state entities to manage\n    *    the overall state and assists in detecting the opType.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._onTouchMove = function(e) {\n      var dist, pos;\n\n      // Reset the drag timer if there is one.\n      if (_dragTimer !== null) {\n         clearTimeout(_dragTimer);\n         _dragTimer = null;\n      }\n\n      // Increment touchMove counter to keep track of move event count.\n      _TAP_STATE.touchMoveCount++;\n\n      /* if (_TAP_STATE.touchMoveCount < 10) {\n         WMKS.LOGGER.debug('move#: ' + _TAP_STATE.touchMoveCount\n            + ' touch#: ' + e.targetTouches.length);\n      } */\n\n      /*\n       * 1. Current touchFingers can be -1, allow default browser behavior.\n       * 2. If the opType is defined, allow those gestures to complete.\n       * 3. Now see if we can determine any gestures.\n       */\n      if (_TAP_STATE.currentTouchFingers === -1) {\n         return true;\n      } else if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.scroll) {\n         // Scroll is detected, stick to it irrespective of the change in touch\n         // fingers, etc.\n         // WMKS.LOGGER.trace('continue scroll.. fingers change midflight.');\n         this._sendScrollEventMessage(e.targetTouches[0]);\n         return false;\n      } else if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.drag) {\n         // Drag is now moved. Send mousemove.\n         _TAP_STATE.currentTouch = WMKS.UTIL.TOUCH.copyTouch(e.targetTouches[0]);\n         this.moveCursor(e.targetTouches[0].pageX, e.targetTouches[0].pageY);\n         pos = this._applyZoomCorrectionToTouchXY(e.targetTouches[0]);\n\n         _widget.sendMouseMoveMessage(pos);\n         // Inhibit the default so pan does not occur\n         return false;\n      } else if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.tap_3finger) {\n         /*\n          * keyboard is already toggled but we retain the state as is here\n          * to avoid touch fingers changing midflight causing a state change\n          * to something else.\n          */\n         return false;\n      } else if (_TAP_STATE.currentTouchFingers !== e.targetTouches.length) {\n         // WMKS.LOGGER.debug('# of fingers changed midflight ('\n         //   + _TAP_STATE.currentTouchFingers + '->' + e.targetTouches.length\n         //   + '), scale: ' + e.scale + ', type: ' + _TAP_STATE.opType);\n         if (_TAP_STATE.currentTouchFingers === 2 && e.targetTouches.length === 1) {\n            if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.none && e.scale === 1) {\n               // Touch ended early, is not a pinch/zoom(scale = 1).\n               // Flag as a right click & clear state.\n               WMKS.LOGGER.debug('touch: 2 -> 1 & !scroll, hence right-click.');\n               this._sendTwoTouchEvent(_TAP_STATE.firstTouch,\n                                       _TAP_STATE.firstTouch,\n                                       WMKS.CONST.CLICK.right, e);\n               this._resetTouchState();\n               return false;\n            }\n         } else if (_TAP_STATE.currentTouchFingers === 1 && e.targetTouches.length === 2) {\n            // No touchstart before this, so handle it as a 2 finger init here.\n            WMKS.LOGGER.debug('touch: 1 -> 2, init 2fingertap if no opType: ' + _TAP_STATE.opType);\n            this._initTwoFingerTouch(WMKS.UTIL.TOUCH.copyTouch(e.targetTouches[0]),\n               WMKS.UTIL.TOUCH.copyTouch(e.targetTouches[1]));\n            // Since we do not know if this is a zoom/scroll/right-click, return true for now.\n            return true;\n         } else {\n            WMKS.LOGGER.debug('touch: 2 -> 1: infer as PINCH/ZOOM.');\n            this._resetTouchState();\n            return true;\n         }\n      } else if (_TAP_STATE.currentTouchFingers === 1) {\n         // e.targetTouches.length = 1 based on above condition check.\n         dist = WMKS.UTIL.TOUCH.touchDistance(e.targetTouches[0], _TAP_STATE.currentTouch);\n         // If we have quick fingers convert into 2 finger touch gesture.\n         if(this._verifyQuickTouches(e, dist, _TAP_STATE.touchMoveCount)) {\n            // Initialize setup for 2 finger gestures.\n            this._initTwoFingerTouch(WMKS.UTIL.TOUCH.copyTouch(_TAP_STATE.firstTouch),\n               WMKS.UTIL.TOUCH.copyTouch(e.targetTouches[0]));\n\n            // This occurred in touchmove, so not a right click, hence a scroll.\n            _TAP_STATE.opType = WMKS.CONST.TOUCH.OP.scroll;\n            return false;\n         }\n         else if (dist < WMKS.CONST.TOUCH.tapMoveCorrectionDistancePx){\n            // If move is within a threshold, its may be a click by wobbly fingers.\n            // Left click should not becomes a pan if within the threshold.\n            return true;\n         } else {\n            /**\n             * TODO: It would be nice to avoid the trackpad completely by\n             * replacing trackpad functionality with a trackpad/relative mode.\n             * This differs from the original/absolute touch mode by is relative\n             * nature of the cursor location and the touch location. The\n             * relative mode acts as a huge trackpad.\n             */\n           this._resetTouchState();\n           return true;\n         }\n      } else if (_TAP_STATE.currentTouchFingers === 2) {\n         // Determine type of operation if its not set, or the state is not cleaned up.\n         if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.none) {\n            if (_TAP_STATE.touchArray.length === 0 || _TAP_STATE.touchArray.length !== 2) {\n               // If the the original touches were not captured, classify this as zoom/pinch.\n               this._resetTouchState();\n               return true;\n            }\n\n            // Initially scale = 1 is common, ignore event as this does not add any value.\n            if (e.scale === 1 && _TAP_STATE.touchMoveCount < 5) {\n               // No move detected so far, hence skip this touchmove, return true.\n               return true;\n            }\n\n            /*\n             * Compute the angle b/w the 2 lines. Each line is computed off of 2\n             * touch points (_TAP_STATE.touchArray & e.TargetTouches). The angle\n             * for each line (in radians) ranges from -Phi to +Phi (3.1416).\n             * The difference in angle can tell us if the 2 finger swipes\n             * are closer (scroll) to each other or farther away(zoom/pinch).\n             */\n            var angle = WMKS.UTIL.TOUCH.touchAngleBwLines(\n                  _TAP_STATE.touchArray[0], e.targetTouches[0],\n                  _TAP_STATE.touchArray[1], e.targetTouches[1]);\n            angle = Math.abs(angle);\n            // WMKS.LOGGER.debug(_TAP_STATE.touchMoveCount + ', scale:'\n            //    + e.scale + ', angle: ' + angle);\n            if (angle === 0) {\n               // One of the touch fingers did not move, missing angle, do nothing.\n               return true;\n            } else if (angle < 1 || angle > 5.2) {\n               // This is a scroll. Coz the smaller angle is under 1 radian.\n\n               // Update scrollCount & scrollSkipCount before we finalize as a scroll.\n               this._updatePreScrollState(e.targetTouches[0]);\n\n               // If the minimum sampling count isn't met, sample again to be accurate.\n               if (_TAP_STATE.scrollCount >= WMKS.CONST.TOUCH.touchMoveSampleMinCount) {\n                  // Now we are sure this is a scroll with 2 data samples.\n                  this._showFeedback(_ELEMENTS.scrollFeedback, _TAP_STATE.firstTouch,\n                     { 'position': 'left', 'offsetLeft': -50, 'offsetTop': -25 });\n                  _TAP_STATE.opType = WMKS.CONST.TOUCH.OP.scroll;\n                  _TAP_STATE.currentTouch = WMKS.UTIL.TOUCH.copyTouch(e.targetTouches[0]);\n                  // WMKS.LOGGER.debug('This is a scroll.');\n                  return false;\n               }\n            } else {\n               // The smaller angle b/w the 2 lines are > about 1 radian, hence a pinch/zoom.\n               _TAP_STATE.zoomCount++;\n\n               // If the minimum sampling count isn't met, sample again to be accurate.\n               if (_TAP_STATE.zoomCount >= WMKS.CONST.TOUCH.touchMoveSampleMinCount) {\n                  // Now we are sure this is a zoom/pinch.\n                  // WMKS.LOGGER.debug('This is a zoom / pinch');\n                  this._resetTouchState();\n                  return true;\n               }\n            }\n            return true;\n         }\n      }\n      // For cases we don't deal with let default handle kick in.\n      return true;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _onTouchEnd\n    *\n    *    Called when a touch operation ends. The following happens here:\n    *    1. If the touch state does not exist we do nothing & allow the default\n    *       handling to kick in.\n    *    2. If an opType has been detected, we terminate its state and\n    *       send appropriate termination signals if any.\n    *    3. If no opType is detected, then it could be a a single finger\n    *       left click or a 2 finger right click. In each case, send the\n    *       appropriate signal and in case of left click, store the time when\n    *       the click was initiated, so that double click could be detected.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._onTouchEnd = function(e) {\n      var pos, touches;\n\n      // Reset the drag timer if there is one.\n      if (_dragTimer !== null) {\n         clearTimeout(_dragTimer);\n         _dragTimer = null;\n      }\n      if (_TAP_STATE.currentTouchFingers === -1) {\n         return true;\n      } else if (e.targetTouches.length === 0) {\n\n         // Check if it is almost a scroll but user stopped scrolling after we detected.\n         if (_TAP_STATE.skipScrollCount !== 0) {\n            // WMKS.LOGGER.debug('Flag as scroll as there is a residual scroll data.');\n            // Sometimes its already a scroll, won't hurt.\n            _TAP_STATE.opType = WMKS.CONST.TOUCH.OP.scroll;\n         }\n\n         // Check against the known opTypes and at the last the unknown ones.\n         switch(_TAP_STATE.opType) {\n            case WMKS.CONST.TOUCH.OP.scroll:\n               // WMKS.LOGGER.debug('scroll complete, send residual scroll & clear state.');\n               this._sendResidualScrollEventMessage(e);\n               this._resetTouchState();\n               return false;\n            case WMKS.CONST.TOUCH.OP.tap_twice:\n               // WMKS.LOGGER.debug('Send tap twice with feedback: ' + _TAP_STATE.opType);\n               this._sendTwoTouchEvent(_TAP_STATE.firstTouch, _TAP_STATE.currentTouch,\n                                      WMKS.CONST.CLICK.left, e);\n               this._resetTouchState();\n               return false;\n            case WMKS.CONST.TOUCH.OP.tap_3finger:\n               // WMKS.LOGGER.debug('kb already handled, clear state.');\n               this._resetTouchState();\n               return false;\n            case WMKS.CONST.TOUCH.OP.drag:\n               // NOTE: Caret position is getting updated via the wts event.\n               // for drag, send the mouse up at the end position\n               touches = e.changedTouches;\n\n               // There should only be one touch for dragging\n               if (touches.length === 1) {\n                  pos = this._applyZoomCorrectionToTouchXY(touches[0]);\n                  _widget.sendMouseButtonMessage(pos, false, WMKS.CONST.CLICK.left);\n               } else {\n                  WMKS.LOGGER.warn('Unexpected touch# ' + touches.length\n                     + ' changed in a drag operation!');\n               }\n               this._resetTouchState();\n               return false;\n            default:\n               if (_TAP_STATE.currentTouchFingers === 1) {\n                  // End a single tap - left click, send mousedown, mouseup together.\n                  this._sendTwoTouchEvent(_TAP_STATE.firstTouch,\n                                          _TAP_STATE.currentTouch,\n                                          WMKS.CONST.CLICK.left, e);\n                  this._resetTouchState(true);\n                  return false;\n               } else if (_TAP_STATE.currentTouchFingers === 2) {\n                  // End a 2-finger tap, and if no opType is set this is a right-click.\n                  // Send mousedown, mouseup together.\n                  this._sendTwoTouchEvent(_TAP_STATE.firstTouch,\n                                          _TAP_STATE.firstTouch,\n                                          WMKS.CONST.CLICK.right, e);\n                  this._resetTouchState();\n                  return false;\n               }\n         }\n\n         // Reset touch state as we are done with the gesture/tap, return false.\n         this._resetTouchState();\n         return false;\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _resetTouchState\n    *\n    *    Resets the touch state machine.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._resetTouchState = function(keepLastTouchState) {\n      if (!keepLastTouchState) {\n         _TAP_STATE.tapStartTime = null;\n         _TAP_STATE.currentTouch = null;\n      }\n      _TAP_STATE.currentTouchFingers = -1;\n      _TAP_STATE.opType = WMKS.CONST.TOUCH.OP.none;\n      _TAP_STATE.firstTouch = null;\n      _TAP_STATE.touchArray.length = 0;\n\n      // Also reset the tap state clearing prev data.\n      _TAP_STATE.touchMoveCount = 0;\n      _TAP_STATE.skipScrollCount = 0;\n      _TAP_STATE.scrollCount = 0;\n      _TAP_STATE.zoomCount = 0;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    * _sendTwoTouchEvent\n    *\n    *    This function sends the mousedown on first event and a mouseup on the\n    *    second. This could be a brand new click or part of a two finger tap\n    *---------------------------------------------------------------------------\n    */\n\n   this._sendTwoTouchEvent = function(firstTouch, secondTouch, button) {\n      // Send modifier keys as well if any to support inputs like 'ctrl click'\n      var pos = this._applyZoomCorrectionToTouchXY(firstTouch);\n      _widget.sendMouseButtonMessage(pos, true, button);\n\n      /*\n      WMKS.LOGGER.warn('Zoom: ' +\n         ' screenXY: ' + firstTouch.screenX + ',' + firstTouch.screenY +\n         ' clientXY: ' + firstTouch.clientX + ',' + firstTouch.clientY +\n         ' pageXY: '   + firstTouch.pageX   + ',' + firstTouch.pageY);\n      */\n      if (_TAP_STATE.opType === WMKS.CONST.TOUCH.OP.tap_twice) {\n         _widget.sendMouseButtonMessage(pos, false, button);\n\n         // Send the double click feedback with a throbbing effect (use showTwice).\n         this._showFeedback(_ELEMENTS.clickFeedback, firstTouch, {showTwice: true});\n      } else {\n         pos = this._applyZoomCorrectionToTouchXY(secondTouch);\n         _widget.sendMouseButtonMessage(pos, false, button);\n         this._showFeedback(_ELEMENTS.clickFeedback, firstTouch);\n      }\n      return true;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * addToRepositionQueue\n    *\n    *    This function adds the element to the reposition queue and upon\n    *    rotation, the private function _repositionFloatingElementsOnRotation()\n    *    ensures these elements are positioned within the canvas region.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.addToRepositionQueue = function(element) {\n      if (element) {\n         _repositionElements.push(element);\n      }\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    * widgetRepositionOnRotation\n    *\n    *    Widgets need to be repositioned on orientation change. This change is one\n    *    of two forms and needs correction only when they are shown.\n    *    1. Landscape -> portrait: Widget may be to the right of the visible area.\n    *    2. Portrait -> Landscape: Widget may be to the bottom of the visible area.\n    *\n    *    The logic used to reposition the widget, is if the widget is beyond the\n    *    visible area, ensure that the widget is pulled back within the screen.\n    *    The widget is pulled back enough so the right/bottom is at least 5px away.\n    *\n    *    TODO:\n    *    1. Yet to handle when keyboard is popped out (use window.pageYOffset)\n    *    2. Also watch out for a case when the screen is zoomed in. This is tricky\n    *       as the zoom out kicks in during landscape to portrait mode.\n    *    3. window.pageXOffset is not reliable due coz upon rotation the white patch\n    *       on the right appears and causes some additional window.pageXOffset\n    *       value. Best bet is to store this value before rotation and apply after\n    *       orientation change kicks in.\n    *\n    *    Returns true if the widget was repositioned, false if nothing changed.\n    *---------------------------------------------------------------------------\n    */\n\n   this.widgetRepositionOnRotation = function(widget) {\n      var w, h, size, screenW, screenH, hasPositionChanged = false;\n\n      if (!WMKS.BROWSER.isTouchDevice()) {\n         WMKS.LOGGER.warn('Widget reposition ignored, this is not a touch device.');\n         return false;\n      }\n\n      if (!widget || widget.is(':hidden')) {\n         return false;\n      }\n\n      w = widget.width();\n      h = widget.height();\n      // Get the current screen size.\n      screenW = window.innerWidth;\n      screenH = window.innerHeight;\n\n      if (WMKS.UTIL.TOUCH.isPortraitOrientation()) {\n         if ((widget.offset().left + w) > screenW) {\n            widget.offset({ left: String(screenW - w - 5) });\n            hasPositionChanged = true;\n         }\n      } else {\n         if ((widget.offset().top + h) > screenH) {\n            widget.offset({ top: String(screenH - h - 5) });\n            hasPositionChanged = true;\n         }\n      }\n\n      return hasPositionChanged;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _repositionFloatingElementsOnRotation\n    *\n    *    Called after the default orientation changes are applied. These are\n    *    specific for the feedback icons, input textbox, the cursor icon and\n    *    any element that was requested by addToRepositionQueue().\n    *\n    *    Cursor icon is visible and so is the input textbox and they need to be\n    *    moved inside the canvas to avoid the viewport from growing larger than\n    *    the canvas size.\n    *\n    *    TODO: If cursor position changed due to orientation changes, send the\n    *    new location. This is only a few pixels away, so not worrying about it\n    *    for now.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._repositionFloatingElementsOnRotation = function(e) {\n      var self = this,\n          canvasOffset = _canvas.offset();\n      // Move them inside the canvas region if they are outside.\n      this.widgetRepositionOnRotation(_ELEMENTS.inputProxy);\n      this.widgetRepositionOnRotation(_ELEMENTS.cursorIcon);\n\n      // Position these hidden elements within the canvas.\n      // NOTE: Problem is on iOS-6.1.2, but not on iOS-6.0.2, see bug: 996595#15\n      // WMKS.LOGGER.trace(JSON.stringify(canvasOffset));\n      _ELEMENTS.clickFeedback.offset(canvasOffset);\n      _ELEMENTS.dragFeedback.offset(canvasOffset);\n      _ELEMENTS.pulseFeedback.offset(canvasOffset);\n      _ELEMENTS.scrollFeedback.offset(canvasOffset);\n\n      // Now handle the list of elements added via addToRepositionQueue()\n      $.each(_repositionElements, function(i, element) {\n         // Just to be safe, we try this out here.\n         try {\n            // WMKS.LOGGER.info('reposition req: ' + element.attr('id')\n            //    + element.attr('class'));\n            self.widgetRepositionOnRotation(element);\n         } catch (err) {\n            WMKS.LOGGER.warn('Custom element reposition failed: ' + err);\n         }\n      });\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _onOrientationChange\n    *\n    *    Called when the device's orientation changes.\n    *\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._onOrientationChange = function(e) {\n      var self = this;\n\n      if (this._isInputInFocus()) {\n         // Listen to resize event.\n         $(window).one('resize', function(e) {\n            /*\n             * Trigger orientationchange event to adjust the screen size.\n             * When the keyboard is opened, resize happens after orientationchange.\n             */\n            setTimeout(function() {\n               $(window).trigger('orientationchange');\n               // Reposition widgets and icons.\n               self._repositionFloatingElementsOnRotation();\n            }, 500);\n         });\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _applyZoomCorrectionToTouchXY\n    *\n    *    Compute the position of a touch event relative to the canvas and apply\n    *    the zoom value correction to get the right location on the canvas.\n    *\n    *    TODO: Apply native zoom correction for touch location.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._applyZoomCorrectionToTouchXY = function(touch) {\n      if (touch === null) {\n         WMKS.LOGGER.warn('Unexpected: touch is null.');\n         return null;\n      }\n      // Compute the x,y based on scroll / browser zoom values as well.\n      return _widget.getEventPosition(touch);\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _showFeedback\n    *\n    *    This function displays the feedback object passed to it for a brief\n    *    moment. The feedback indicator is not positioned directly over the\n    *    click location, but centered around it. The feedback jQuery object\n    *    is cached to avoid repeated lookups.\n    *\n    *    The animation mimics the View Client: show indicator at the location\n    *    and hide after some time. jQuery animations suffered from 2 animation\n    *    queue overload and gets corrupted easily. Hence we rely on CSS3\n    *    animations which are also crisp as its executed in the browser space.\n    *\n    *    No matter what you do, the caret container is also made visible and is\n    *    moved to the location of the click, where it stays.\n    *\n    *    feedback  - the jQuery object to animate\n    *    touch     - touch object from which to derive coords\n    *    inputArgs - input args that change position, offsetLeft, offsetTop.\n    *---------------------------------------------------------------------------\n    */\n\n   this._showFeedback = function(feedback,touch, inputArgs) {\n      var multiplier, padLeft, padTop, args = inputArgs || {};\n      if (!touch || !feedback) {\n         WMKS.LOGGER.trace('No touch value / feedback object, skip feedback.');\n         return;\n      }\n      // Calculate if there is any input padding offsets to be applied.\n      padLeft = args.offsetLeft || 0;\n      padTop = args.offsetTop || 0;\n      // Get multiplier width & height to position feedback element accordingly.\n      multiplier = WMKS.UTIL.TOUCH.getRelativePositionMultiplier(args.position);\n      feedback.css({\n         'left': touch.pageX + padLeft + feedback.outerWidth() * multiplier.width,\n         'top': touch.pageY + padTop + feedback.outerHeight() * multiplier.height\n      });\n\n      //  Just move the icon to the right place.\n      this.moveCursor(touch.pageX, touch.pageY);\n      /*\n       * Since the same feedback indicator is used for both double tap and single tap,\n       * we have to remove all animation classes there were applied.\n       * This may change once we have unique elements for each of the feedback indicators.\n       */\n      feedback.removeClass('animate-feedback-indicator animate-double-feedback-indicator');\n      if (args.showTwice) {\n         setTimeout(function() {\n            feedback.addClass('animate-double-feedback-indicator');\n         }, 0);\n      } else {\n         setTimeout(function() {\n            feedback.addClass('animate-feedback-indicator');\n         }, 0);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * moveCursor\n    *\n    *    Repositions the fake caret to match the given touch's location. Since\n    *    the 'tip' of the caret represents the click location, no centering is\n    *    desired.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.moveCursor = function(pageX, pageY) {\n      if (_ELEMENTS.cursorIcon) {\n         _ELEMENTS.cursorIcon.css({'left': pageX, 'top': pageY});\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * setCursorVisibility\n    *\n    *    Hide or show the fake caret.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.setCursorVisibility = function(visible) {\n      if (_ELEMENTS.cursorIcon) {\n         if (visible) {\n            _ELEMENTS.cursorIcon.show();\n         } else {\n            _ELEMENTS.cursorIcon.hide();\n         }\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _sendKeyInput\n    *\n    *    Sends a key plus the manual modifiers entered on the extended keyboard.\n    *    Simulates the keydowns and keyups which would happen if this were entered\n    *    on a physical keyboard.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._sendKeyInput = function(key) {\n      _widget.sendKeyInput(key);\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * onCaretPositionChanged\n    *\n    *    Handler for when the caret position changes.\n    *\n    *    We use this to dynamically position our invisible input proxy\n    *    such that focus events for it don't cause us to move away from\n    *    the screen offset from where we are typing.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.onCaretPositionChanged = function(pos) {\n      var offsetX, offsetY;\n\n      if (_ELEMENTS.inputProxy) {\n         offsetX = pos.x;\n         offsetY = pos.y;\n\n         // Ensure the position is bound in the visible area.\n         if (offsetX < window.pageXOffset) {\n            offsetX = window.pageXOffset;\n         }\n         if (offsetY < window.pageYOffset) {\n            offsetY = window.pageYOffset;\n         }\n\n         _ELEMENTS.inputProxy.offset({left: offsetX, top: offsetY});\n         // WMKS.LOGGER.warn('left: ' + _ELEMENTS.inputProxy.offset().left\n         //   + ', top: ' + _ELEMENTS.inputProxy.offset().left);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _keyboardDisplay\n    *\n    *    The event triggered when user wants to explicitly show or hide the\n    *    keyboard.\n    *    show - true shows keyboard, false flips it.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._keyboardDisplay = function(show) {\n      // WMKS.LOGGER.debug('kb show: ' + (show? 'true' : 'false'));\n\n      if (show) {\n         _canvas.focus();\n         _ELEMENTS.inputProxy.focus().select();\n      } else {\n         if (WMKS.BROWSER.isAndroid()) {\n            // If its set to readonly & disabled keyboard focus goes away.\n            _ELEMENTS.inputProxy.attr('readonly', true)\n                                .attr('disabled', true);\n            // Reset the readonly and disabled property values after some time.\n            setTimeout(function() {\n               //If destory function is run before this, there will an error.\n               if (_ELEMENTS) {\n                  _ELEMENTS.inputProxy.attr('readonly', false)\n                                      .attr('disabled', false);\n                  _canvas.focus();\n               }\n            }, 100);\n         }\n         /*\n          * The only method that seems to work on iOS to close the keyboard.\n          *\n          * http://uihacker.blogspot.com/2011/10/javascript-hide-ios-soft-keyboard.html\n          */\n         document.activeElement.blur();\n         _KEYBOARD.visible = false;\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _isInputInFocus\n    *\n    *    Returns the state if the input-proxy is in focus. When it does, the\n    *    keyboard should be showing as well.\n    *\n    *    TODO: Verify if this function is needed?\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._isInputInFocus = function() {\n      return (document.activeElement.id === 'input-proxy');\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _onInputFocus\n    *\n    *    Event handler for focus event on the input-proxy. Sync the keyboard\n    *    highlight state here.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._onInputFocus = function(e) {\n      this._sendUpdatedKeyboardState(true);\n      // Hide this while we're typing otherwise we'll see a blinking caret.\n      e.stopPropagation();\n      return true;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _onInputBlur\n    *\n    *    Event handler for blur event on the input-proxy. Sync the keyboard\n    *    highlight state here. Also save the timestamp for the blur event.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._onInputBlur = function(e) {\n      this._sendUpdatedKeyboardState(false);\n      e.stopPropagation();\n      return true;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * _sendUpdatedKeyboardState\n    *\n    *    Helper function to set the keyboard launcher button highlight state\n    *    based on the keyboard visibility.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this._sendUpdatedKeyboardState = function(kbState) {\n      _KEYBOARD.visible = kbState;\n      _KEYBOARD.lastToggleTime = $.now();\n      // Trigger keyboard toggle callback function.\n      if ($.isFunction(_onToggle)) {\n         _onToggle.call(this, ['KEYBOARD', _KEYBOARD.visible]);\n      }\n   };\n\n\n   /****************************************************************************\n    * Public Functions\n    ***************************************************************************/\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * toggleKeyboard\n    *\n    *    Called when the user wants to toggle on-screen keyboard visibility.\n    *    show - flag to explicitly request keyboard show or hide.\n    *    (When not toggling)\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.toggleKeyboard = function(options) {\n      if (!WMKS.BROWSER.isTouchDevice()) {\n         WMKS.LOGGER.warn('Mobile keyboard not supported, this is not a touch device.');\n         return;\n      }\n\n      if (!_ELEMENTS.inputProxy) {\n         // Mobile keyboard toggler is not initialized. Ignore this request.\n         return;\n      }\n      if (!!options && options.show === _KEYBOARD.visible) {\n         // WMKS.LOGGER.debug('Keyboard is in the desired state.');\n         return;\n      }\n\n      // Check in case the keyboard toggler request is not handled properly.\n      if ($.now() - _KEYBOARD.lastToggleTime < WMKS.CONST.TOUCH.minKeyboardToggleTime) {\n         /*\n          * Seems like a spurious keyboard event as its occurring soon after the\n          * previous toggle request. This can happen when the keyboard launcher\n          * event handler is not implemented properly.\n          *\n          * Expected: The callback handler should prevent the default handler\n          *           and return false.\n          */\n         WMKS.LOGGER.warn('Ignore kb toggle - Got request soon after focus/blur.');\n         return;\n      }\n\n      // Show / hide keyboard based on new kBVisible value.\n      this._keyboardDisplay(!_KEYBOARD.visible);\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * toggleTrackpad\n    *\n    *    Called when the user wants to toggle trackpad visibility.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.toggleTrackpad = function(options) {\n      if (!WMKS.BROWSER.isTouchDevice()) {\n         WMKS.LOGGER.warn('Trackpad not supported. Not a touch device.');\n         return;\n      }\n\n      if (_ELEMENTS.trackpad) {\n         // Set toggle callback function.\n         options = $.extend({}, options, {\n            toggleCallback: _onToggle\n         });\n         // Show / hide trackpad.\n         _ELEMENTS.trackpad.toggle(options);\n      }\n   };\n\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * toggleExtendedKeypad\n    *\n    *    Called when the user wants to toggle ExtendedKeypad visibility.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.toggleExtendedKeypad = function(options) {\n      if (!WMKS.BROWSER.isTouchDevice()) {\n         WMKS.LOGGER.warn('Extended keypad not supported. Not a touch device.');\n         return;\n      }\n\n      if (_ELEMENTS.keypad) {\n         // Set toggle callback function.\n         options = $.extend({}, options, {\n            toggleCallback: _onToggle\n         });\n         // Show / hide keypad.\n         _ELEMENTS.keypad.toggle(options);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * installTouchHandlers\n    *\n    *    Install event handlers for touch devices.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.installTouchHandlers = function() {\n      var self = this,\n          container = _canvas.parent();\n\n      if (!WMKS.BROWSER.isTouchDevice()) {\n         WMKS.LOGGER.log('Not a touch device, and hence skip touch handler');\n         return;\n      }\n\n      // Set css values to disable unwanted default browser behavior.\n      _canvas.css({\n         '-webkit-user-select':     'none',  /* disable cut-copy-paste */\n         '-webkit-touch-callout':   'none'   /* disable callout, image save panel */\n      });\n\n      _canvas\n         .bind('touchmove.wmks', function(e) {\n            return self._onTouchMove(e.originalEvent);\n         })\n         .bind('touchstart.wmks', function(e) {\n            return self._onTouchStart(e.originalEvent);\n         })\n         .bind('touchend.wmks', function(e) {\n            return self._onTouchEnd(e.originalEvent);\n         })\n         .bind('orientationchange.wmks', function(event) {\n            return self._onOrientationChange(event);\n         })\n         .bind('orientationchange.wmks.elements', function(e) {\n            // Handler for repositioning cursor, feedback icons, input textbox\n            // and elements added externally.\n            self._repositionFloatingElementsOnRotation(e);\n         });\n\n      // Create touch feedbacks.\n      _ELEMENTS.cursorIcon = $('<div/>')\n         .addClass('feedback-container cursor-icon')\n         .appendTo(container);\n      _ELEMENTS.clickFeedback = $('<div/>')\n         .addClass('feedback-container tap-icon')\n         .appendTo(container);\n      _ELEMENTS.dragFeedback = $('<div/>')\n         .addClass('feedback-container drag-icon')\n         .appendTo(container);\n      _ELEMENTS.pulseFeedback = $('<div/>')\n         .addClass('feedback-container pulse-icon')\n         .appendTo(container);\n      _ELEMENTS.scrollFeedback = $('<div/>')\n         .addClass('feedback-container scroll-icon')\n         .appendTo(container);\n\n      /*\n       * Double tapping or tapping on the feedback icons will inevitably involve\n       * the user tapping the feedback container while it's showing. In such\n       * cases capture and process touch events from these as well.\n       */\n      container\n         .find('.feedback-container')\n            .bind('touchmove.wmks', function(e) {\n               return self._onTouchMove(e.originalEvent);\n            })\n            .bind('touchstart.wmks', function(e) {\n               return self._onTouchStart(e.originalEvent);\n            })\n            .bind('touchend.wmks', function(e) {\n               return self._onTouchEnd(e.originalEvent);\n            });\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * disconnectEvents\n    *\n    *    Remove touch event handlers.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.disconnectEvents = function() {\n      if (!_canvas) {\n         return;\n      }\n      _canvas\n         .unbind('orientationchange.wmks.icons')\n         .unbind('orientationchange.wmks')\n         .unbind('touchmove.wmks')\n         .unbind('touchstart.wmks')\n         .unbind('touchend.wmks');\n\n      _canvas.find('.feedback-container')\n         .unbind('touchmove.wmks')\n         .unbind('touchstart.wmks')\n         .unbind('touchend.wmks');\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * initializeMobileFeature\n    *\n    *    This function initializes the touch feature that's requested.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.initializeMobileFeature = function(type) {\n      if (!WMKS.BROWSER.isTouchDevice()) {\n         // Not a touch device, and hence will not initialize keyboard.\n         return;\n      }\n\n      switch (type) {\n         case WMKS.CONST.TOUCH.FEATURE.Trackpad:\n            _ELEMENTS.trackpad = new WMKS.trackpadManager(_widget, _canvas);\n            _ELEMENTS.trackpad.initialize();\n            break;\n\n         case WMKS.CONST.TOUCH.FEATURE.ExtendedKeypad:\n            _ELEMENTS.keypad = new WMKS.extendedKeypad({\n                                  widget : _widget,\n                                  parentElement: _canvas.parent(),\n                                  keyboardManager: _keyboardManager\n                               });\n            _ELEMENTS.keypad.initialize();\n            break;\n\n         case WMKS.CONST.TOUCH.FEATURE.SoftKeyboard:\n            _ELEMENTS.inputProxy = this.initSoftKeyboard();\n            break;\n         default:\n            WMKS.LOGGER.error('Invalid mobile feature type: ' + type);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * initSoftKeyboard\n    *\n    *    This function installs an input element and installs event handlers\n    *    that will be used for reading device keyboard inputs and translating\n    *    into the corresponding server messages.\n    *\n    *    NOTE: Chrome on android returns in-valid keyCodes for keyDown/keyPress.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.initSoftKeyboard = function() {\n      var self = this,\n          kbHandler = _keyboardManager;\n\n      /*\n       * Add a textbox that which on gaining focus launches the keyboard.\n       * Listen for key events on the textbox. Append the textbox to the canvas\n       * parent so that to make listening for input events easier.\n       *\n       * Adding this to the canvas parent is better than to the document.body\n       * as we can eliminate the need to detect the parent's offset from\n       * the screen while positioning the inputbox.\n       *\n       * To make the textbox functional and still hidden from the user by using\n       * transparent background, really small size (1x1 px) textbox without\n       * borders. To hide the caret, we use 0px font-size and disable any of\n       * the default selectable behavior for copy-paste, etc.\n       */\n       var inputDiv = $('<input type=\"text\"/>')\n         .val(WMKS.CONST.KB.keyInputDefaultValue)\n         .attr({\n            'id':                   'input-proxy',\n            'autocorrect':          'off',    /* disable auto correct */\n            'autocapitalize':       'off' })  /* disable capitalizing 1st char in a word */\n         .css({\n            'font-size':            '1px',    /* make the caret really small */\n            'width':                '1px',    /* Non-zero facilitates keyboard launch */\n            'height':               '1px',\n            'background-color':     'transparent',    /* removes textbox background */\n            'color':                'transparent',    /* removes caret color */\n            'box-shadow':           0,        /* remove box shadow */\n            'outline':              'none',   /* remove orange outline - android chrome */\n            'border':               0,        /* remove border */\n            'padding':              0,        /* remove padding */\n            'left':                 -1,       /* start outside the visible region */\n            'top':                  -1,\n            'overflow':             'hidden',\n            'position':             'absolute' })\n         .bind('blur',     function(e) { return self._onInputBlur(e); })\n         .bind('focus',    function(e) { return self._onInputFocus(e); })\n         .bind('input',    function(e) { return kbHandler.onInputTextSoftKb(e); })\n         .bind('keydown',  function(e) { return kbHandler.onKeyDownSoftKb(e); })\n         .bind('keyup',    function(e) { return kbHandler.onKeyUpSoftKb(e); })\n         .bind('keypress', function(e) { return kbHandler.onKeyPressSoftKb(e); })\n         .insertBefore(_canvas.parent());\n\n      if (WMKS.BROWSER.isIOS()) {\n         // css to disable user select feature on iOS. Breaks android kb launch.\n         inputDiv.css({\n            '-webkit-touch-callout': 'none'    /* disable callout, image save panel */\n         });\n      }\n      return inputDiv;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * removeMobileFeature\n    *\n    *    Based on the feature type, see if its initialized, if so, destroy and\n    *    remove its references.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.removeMobileFeature = function(type) {\n      switch (type) {\n         case WMKS.CONST.TOUCH.FEATURE.Trackpad:\n            if (_ELEMENTS.trackpad) {\n               _ELEMENTS.trackpad.destroy();\n               _ELEMENTS.trackpad = null;\n            }\n            break;\n\n         case WMKS.CONST.TOUCH.FEATURE.ExtendedKeypad:\n            if (_ELEMENTS.keypad) {\n               _ELEMENTS.keypad.destroy();\n               _ELEMENTS.keypad = null;\n            }\n            break;\n\n         case WMKS.CONST.TOUCH.FEATURE.SoftKeyboard:\n            if (_ELEMENTS.inputProxy) {\n               if (_KEYBOARD.visible) {\n                  // Input is in focus, and keyboard is up.\n                  this.toggleKeyboard(false);\n               }\n               _ELEMENTS.inputProxy.remove();\n               _ELEMENTS.inputProxy = null;\n            }\n            break;\n         default:\n            WMKS.LOGGER.error('Invalid mobile feature type: ' + type);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * destroy\n    *\n    *    Destroys the TouchHandler.\n    *\n    *    This will disconnect all (if active) and remove\n    *    the widget from the associated element.\n    *\n    *    Consumers should call this before removing the element from the DOM.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.destroy = function() {\n      this.disconnectEvents();\n      this.removeMobileFeature(WMKS.CONST.TOUCH.FEATURE.SoftKeyboard);\n      this.removeMobileFeature(WMKS.CONST.TOUCH.FEATURE.ExtendedKeypad);\n      this.removeMobileFeature(WMKS.CONST.TOUCH.FEATURE.Trackpad);\n\n      // Cleanup private variables.\n      _widget = null;\n      _canvas = null;\n      _keyboardManager = null;\n      _TAP_STATE = null;\n      _ELEMENTS = null;\n      _repositionElements.length = 0;\n      _repositionElements = null;\n   };\n\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * WMKS.UTIL.TOUCH\n *\n *    These util functions are very specific to this touch library and hence are\n *    created separately under this file. Anything that's more generic goes\n *    into WMKS.UTIL itself.\n *\n *    NOTE: Some of these functions use touch specific target data.\n *------------------------------------------------------------------------------\n */\n\nWMKS.UTIL.TOUCH = {\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * isLandscapeOrientation\n    *\n    *    Returns true if the device is in landscape orientation.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   isLandscapeOrientation: function() {\n      return (window.orientation === 90 || window.orientation === -90);\n   },\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * isPortraitOrientation\n    *\n    *    Returns true if the device is in landscape orientation.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   isPortraitOrientation: function() {\n      return (window.orientation === 0 || window.orientation === 180);\n   },\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * getRelativePositionMultiplier\n    *\n    *    This helper function provides the width and height multipliers for an\n    *    element which multiplied to its width and height and added to the\n    *    current location offset, will give the desired location as defined by\n    *    the position string.\n    *\n    *    position - Possible values are: top/bottom + left/right or null.\n    *               (Default center)\n    *    Ex: position = 'top' --> returns {width: 0.5, height: -1}\n    *\n    *---------------------------------------------------------------------------\n    */\n   getRelativePositionMultiplier: function(position) {\n      var wMultiply = -0.5, hMultiply = -0.5;\n      if (!!position) {\n         // Check for left or right positioning.\n         if (position.indexOf('left') !== -1) {\n            wMultiply = -1;\n         } else if (position.indexOf('right') !== -1) {\n            wMultiply = 1;\n         }\n         // Check for top or bottom positioning.\n         if (position.indexOf('top') !== -1) {\n            hMultiply = -1;\n         } else if (position.indexOf('bottom') !== -1) {\n            hMultiply = 1;\n         }\n      }\n      // Return json response containing width and height multipliers.\n      return {'width': wMultiply, 'height': hMultiply};\n   },\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * touchEqual\n    *\n    *    Convenience function to compare two touches and see if they correspond\n    *    to precisely the same point.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   touchEqual: function(thisTouch, thatTouch) {\n      return (thisTouch.screenX === thatTouch.screenX &&\n              thisTouch.screenY === thatTouch.screenY);\n   },\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * touchDistance\n    *\n    *    Convenience function to get the pixel distance between two touches,\n    *    in screen pixels.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   touchDistance: function(thisTouch, thatTouch) {\n      return WMKS.UTIL.getLineLength((thatTouch.screenX - thisTouch.screenX),\n                                     (thatTouch.screenY - thisTouch.screenY));\n   },\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * touchAngleBwLines\n    *\n    *    Convenience function to compute the angle created b/w 2 lines. Each of\n    *    the two lines are defined by two touch points.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   touchAngleBwLines: function(l1p1, l1p2, l2p1, l2p2) {\n      var a1 = Math.atan2(l1p1.screenY - l1p2.screenY,\n                          l1p1.screenX - l1p2.screenX);\n      var a2 = Math.atan2(l2p1.screenY - l2p2.screenY,\n                          l2p1.screenX - l2p2.screenX);\n      return a1 - a2;\n   },\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * copyTouch\n    *\n    *    Since touches are Objects, they need to be deep-copied. Note that we\n    *    only copy the elements that we use for our own purposes, there are\n    *    probably more.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   copyTouch: function(aTouch) {\n      var newTouch = {\n         'screenX': aTouch.screenX,\n         'screenY': aTouch.screenY,\n         'clientX': aTouch.clientX,\n         'clientY': aTouch.clientY,\n         'pageX'  : aTouch.pageX,\n         'pageY'  : aTouch.pageY\n      };\n      return newTouch;\n   },\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * leftmostOf\n    *\n    *    Returns the touch event that contains the leftmost screen coords.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   leftmostOf: function(thisTouch, thatTouch) {\n      return (thisTouch.screenX < thatTouch.screenX)? thisTouch : thatTouch;\n   }\n};\n/*\n * wmks/widgetProto.js\n *\n *   WebMKS widget prototype for use with jQuery-UI.\n *\n *\n * A widget for displaying a remote MKS or VNC stream over a WebSocket.\n *\n * This widget can be dropped into any page that needs to display the screen\n * of a VM. It communicates over a WebSocket connection using VMware's\n * enhanced VNC protocol, which is compatible either with a VM's configured\n * VNC WebSocket port or with a proxied Remote MKS connection.\n *\n * A few options are provided to customize the behavior of the WebMKS:\n *\n *    * fitToParent (default: true)\n *      - Scales the guest screen size to fit within the WebMKS's\n *        allocated size. It's important to note that this does\n *        not resize the guest resolution.\n *\n *    * fitGuest (default: false)\n *      - Requests that the guest change its resolution to fit within\n *        the WebMKS's allocated size.  Compared with fitToParent, this\n *        does resize the guest resolution.\n *\n *    * useNativePixels (default: false)\n *      - Enables the use of native pixel sizes on the device. On iPhone 4+ or\n *        iPad 3+, turning this on will enable \"Retina mode,\" which provides\n *        more screen space for the guest, making everything much smaller.\n *\n *    * allowMobileKeyboardInput (default: true)\n *      - Enables the use of a native on-screen keyboard for mobile devices.\n *        When enabled, the showKeyboard() and hideKeyboard() functions\n *        will pop up a keyboard that can be used to interact with the VM.\n *\n *    * allowMobileTrackpad (default: true)\n *      - Enables the use of trackpad on mobile devices for better accuracy\n *        compared to touch inputs. The trackpad dialog will not show-up when\n *        enabled, but will allow it to toggle (hide/show) by invoking the\n *        toggleTrackpad() function.\n *\n *    * allowMobileExtendedKeypad (default: true)\n *      - Enables the use of extended keypad on mobile devices to provision\n *        special keys: function keys, arrow keys, modifier keys, page\n *        navigation keys, etc. The keypad dialog will not show-up when\n *        enabled, but will allow it to toggle (hide/show) by invoking the\n *        toggleExtendedKeypad() function.\n *\n *    * useVNCHandshake (default: true)\n *      - Enables a standard VNC handshake. This should be used when the\n *        endpoint is using standard VNC authentication. Set to false if\n *        connecting to a proxy that authenticates through authd and does\n *        not perform a VNC handshake.\n *\n *    * fixANSIEquivalentKeys (default: false)\n *      - Enables fixing of any non-ANSI US layouts keyCodes to match ANSI US layout\n *        keyCodes equivalents. It attempts to fix any keys pressed where\n *        the client's international keyboard layout has a key that is also present\n *        on the ANSI US keyboard, but is in a different location or doesn't match\n *        the SHIFT or NO SHIFT status of an ANSI US keyboard. This is useful in the\n *        case where a user needs to login to the guest OS before they can change\n *        the keyboard layout to match the client layout.\n *        Example: On some french keyboard layouts, \"!\" is where the \"8\" key is on the\n *        ANSI US layout. When enabled, the guest OS would receive SHIFT + \"1\" instead\n *        of \"8\" and display the correct \"!\" character.\n *\n *    * enableVorbisAudioClips (default: false)\n *      - Enables the use of the OGG-encapsulated Vorbis audio codec for providing\n *        audio data in the form of short clips suitable for browser consumption.\n *\n *    * enableOpusAudioClips (default: false)\n *      - Enables the use of the OGG-encapsulated Opus audio codec for providing\n *        audio data in the form of short clips suitable for browser consumption.\n *\n *    * enableAacAudioClips (default: false)\n *      - Enables the use of the AAC/MP4 audio codec for providing audio data in\n *        the form of short clips suitable for browser consumption.\n *\n *    * enableVVC (default: true)\n *      - Enables the use of the vmware-vvc protocol for communication over\n *        the websocket.\n *\n *    * enableMP4 (default: false)\n *      - Enables the use of the MP4 encoding for frame buffer and MP4 decoding on\n *       the browser.\n *\n *    * enableRawH264 (default: false) - only for testing mode.\n *      - This maps to: VNCH264RectEnc @ bora/public/vnc.h\n *        Enables the use of the raw H264 (instead of MP4) encoding for frame buffer\n *        and raw H264 decoding on the browser.\n *        Actually, browser can't support raw H264 decoding - so, browser will just\n *        drop the packet.\n *\n *    * enableTopologyChange (default: false) - only for testing mode.\n *      - This maps to: VNCTopologyChangeEnc @ bora/public/vnc.h\n *        Enable the use of topology change request to server.\n *\n *    * enableH264Multimon (default: false) - only for testing mode.\n *      - This maps to: VNCH264MultimonEnc @ bora/public/vnc.h\n *        Enable the use of multimon in H264 mode.\n *\n *    * multimonRenderer (default: null) - only for testing mode.\n *      - The object who has have below API to provide customized render behavior\n *        after entering multimon:\n *        - onFrameEnd(decodeStart, updateReqId), which is used to help calculate\n *            the real rendering time and also make the rendering process async.\n *            unlike the onSuccess/onError, it should be called right after each\n *            monitor get the data, other than when finish the rendering.\n *        - onInit(type, param, onSuccess, onError), where type is either \"mp4\" or\n *            \"rect\", should only be called for \"mp4\" type for now.\n *        - onData(type, param, onSuccess, onError), where type is either \"mp4\" or\n *            \"rect\", and param will contains the rendering data as \"param.data\".\n *        - reset which will be called when the session disconnected to release\n *            resources.\n *\n *    * enableSubRectangleCache (default: true)\n *      - This controls whether supporting the encoding of\n *        VNC_UPDATECACHE_CAP_END_SUB_RECTANGLE @ bora/public/vnc.h\n *\n *    * enableUint8Utf8 (default: false)\n *      - Enables the use of the legacy uint8utf8 protocol for communication over\n *        the websocket.\n *\n *    * retryConnectionInterval (default: -1)\n *      - The interval(millisecond) for retrying connection when the first\n *        attempt to set up a connection between web client and server fails.\n *        if value is less or equal than 0, it won't perform retry.\n *\n *    * VCDProxyHandshakeVmxPath (default: null)\n *      - VMX path (string) for use during the VNC connection process to a VCD console\n *        proxy.\n *\n *    * mapMetaToCtrlForKeys (default: [])\n *      - Enables the mapping of CMD to CTRL when the command key is presses along side\n *        one of the keys specified in this array. Keys must be specified using their\n *        integer keycode value (ie 65 for A). Useful on OSX for mapping CMD-V CMD-C to\n *        Control-V Control-C respectively.\n *\n *    * enableWindowsKey (default: false)\n *      - Enables the simulation of Windows key. A Windows key is sent when Ctrl+Win\n *        on Windows or Ctrl+CMD on Mac are pressed.\n *\n *    * enableVMWSessionClose (default: false)\n *      - Enables the communication of session close msg between client and server. When\n *        each side is about to close the websocket intentionally, a session close msg is\n *        sent to the other side.\n *\n *    * enableVMWAudioMixer (default: false)\n *      - Enables the communication of audio volume information(e.g. volume,\n *        bass and treble...) from server to client. When the audio volume is\n *        changed on the server, an audio volume update is sent to client.\n *\n * Handlers can also be registered to be triggered under certain circumstances:\n *\n *    * connecting\n *      - called when the websocket to the server is opened.\n *\n *    * connected\n *      - called when the websocket connection to the server has completed, the protocol\n *        has been negotiated and the first update from the server has been received, but\n *        not yet parsed, decoded or displayed.\n *\n *    * beforedisconnected\n *     - called when websocket is about to be closed by server intentionally.\n *\n *    * disconnected\n *      - called when the websocket connection to the server has been lost, either\n *        due to a normal shutdown, a dropped connection, or a failure to negotiate\n *        a websocket upgrade with a server. This handler is passed a map of information\n *        including a text reason string (if available) and a disconnection code from\n *        RFC6455.\n *\n *    * authenticationfailed\n *      - called when the VNC authentication procedure has failed. NOTE: this is only\n *        applicable if VNC style auth is used, other authentication mechanisms outside\n *        of VNC (such as authd tickets) will NOT trigger this handler if a failure\n *        occurs.\n *\n *    * error\n *      - called when an error occurs on the websocket. It is passed the DOM Event\n *        associated with the error.\n *\n *    * protocolerror\n *      - called when an error occurs during the parsing or a received VNC message, for\n *        example if the server sends an unsupported message type or an incorrectly\n *        formatted message.\n *\n *    * resolutionchanged\n *      - called when the resolution of the server's desktop has changed. It's passed\n *        the width and height of the new resolution.\n *\n *  Handlers should be registered using jQuery bind and the 'wmks' prefix:\n *\n *     .bind(\"wmksdisconnected\", function(evt, info) {\n *           // Your handler code\n *      });\n */\n\nWMKS.widgetProto = {};\n\nWMKS.widgetProto.options = {\n   fitToParent: false,\n   fitGuest: false,\n   useNativePixels: false,\n   allowMobileKeyboardInput: true,\n   useUnicodeKeyboardInput: false,\n   useVNCHandshake: true,\n   VCDProxyHandshakeVmxPath: null,\n   reverseScrollY: false,\n   allowMobileExtendedKeypad: true,\n   allowMobileTrackpad: true,\n   enableVorbisAudioClips: false,\n   enableOpusAudioClips: false,\n   enableAacAudioClips: false,\n   enableVMWAudioMixer: false,\n   enableVVC: true,\n   enableMP4: false,\n   enableRawH264: false,\n   enableTopologyChange: false,\n   enableH264Multimon: false,\n   multimonRenderer: null,\n   enableSubRectangleCache: true,\n   enableUint8Utf8: false,\n   retryConnectionInterval: -1,\n   ignoredRawKeyCodes: [],\n   fixANSIEquivalentKeys : false,\n   mapMetaToCtrlForKeys: [],\n   enableWindowsKey: false,\n   keyboardLayoutId: 'en-US',\n   sendRelativeMouseEvent: false\n};\n\n\n/************************************************************************\n * Private Functions\n ************************************************************************/\n\n/*\n *------------------------------------------------------------------------------\n *\n * _updatePixelRatio\n *\n *    Recalculates the pixel ratio used for displaying the canvas.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Stores new pixel ratio in this._pixelRatio.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto._updatePixelRatio = function() {\n   if (this.options.useNativePixels) {\n      this._pixelRatio = window.devicePixelRatio || 1.0;\n   } else {\n      this._pixelRatio = 1.0;\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _updateMobileFeature\n *\n *    This function is a wrapper function that requests touch features to be\n *    enabled / disabled depending on the allow flag that's sent.\n *\n *    If allow flag is true, enable feature defined in type, else disable it.\n *\n *    List of supported features are:\n *\n *    MobileKeyboardInput:\n *       This function initializes the touch keyboard inputs based on the option\n *       setting. Shows/hides an offscreen <input> field to force the virtual\n *       keyboard to show up on tablet devices.\n *\n *    MobileExtendedKeypad\n *       This function initializes the Extended keypad which provides the user\n *       with special keys that are not supported on the MobileKeyboardInput.\n *\n *    MobileTrackpad:\n *       This function initializes the trackpad. The trackpad allows users to\n *       perform more precise mouse operations that are not possible with touch\n *       inputs.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Modifies DOM.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto._updateMobileFeature = function(allow, type) {\n   if (allow) {\n      this._touchHandler.initializeMobileFeature(type);\n   } else {\n      this._touchHandler.removeMobileFeature(type);\n   }\n};\n\n/**\n *------------------------------------------------------------------------------\n *\n * _updateDisplayScale\n *\n *    Set the display scale value\n *    Display scale is supposed to work in the case guest DPI is different\n *    than the remove VM.  For example, when guest DPI is 200%, and remote\n *    VM DPI is 100%.  Set display scale to be 0.5 to decrease the VM\n *    resolution so that things get bigger.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Stores new display scale value in this._displayScaleRatio\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto._updateDisplayScale = function(value) {\n   this._displayScaleRatio = value;\n   WMKS.LOGGER.debug(\"Display scale updated to \" + this._displayScaleRatio);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _setOption\n *\n *    Changes a WMKS option.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Updates the given option in this.options.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto._setOption = function(key, value) {\n   $.Widget.prototype._setOption.apply(this, arguments);\n\n   switch (key) {\n      case 'fitToParent':\n         this.rescaleOrResize(false);\n         break;\n\n      case 'fitGuest':\n         this.rescaleOrResize(true);\n         break;\n\n      case 'displayScale':\n         this._updateDisplayScale(value);\n         break;\n\n      case 'useNativePixels':\n         // Return if useNativePixels is true and browser indicates no-support.\n         if (value && !WMKS.UTIL.isHighResolutionSupported()) {\n            WMKS.LOGGER.warn('Browser/device does not support this feature.');\n            return;\n         }\n         this._updatePixelRatio();\n         if (this.options.fitGuest) {\n            // Apply the resize for fitGuest mode.\n            this.updateFitGuestSize(true);\n         } else {\n            this.rescaleOrResize(false);\n         }\n         break;\n\n      case 'allowMobileKeyboardInput':\n         this._updateMobileFeature(value, WMKS.CONST.TOUCH.FEATURE.SoftKeyboard);\n         break;\n\n      case 'allowMobileTrackpad':\n         this._updateMobileFeature(value, WMKS.CONST.TOUCH.FEATURE.Trackpad);\n         break;\n\n      case 'allowMobileExtendedKeypad':\n         this._updateMobileFeature(value, WMKS.CONST.TOUCH.FEATURE.ExtendedKeypad);\n         break;\n\n      case 'reverseScrollY':\n         this.options.reverseScrollY = value;\n         break;\n\n      case 'fixANSIEquivalentKeys':\n         this._keyboardManager.fixANSIEquivalentKeys = value;\n         break;\n\n      case 'VCDProxyHandshakeVmxPath':\n         this.setVCDProxyHandshakeVmxPath(value);\n         break;\n\n      case 'mapMetaToCtrlForKeys':\n         this._keyboardManager.mapMetaToCtrlForKeys = value;\n\n      case 'enableWindowsKey':\n         this._keyboardManager.enableWindowsKey(value);\n         break;\n\n      case 'keyboardLayoutId':\n\n         this._keyboardManager.keyboardLayoutId = value;\n         this._keyboardManager.UnicodeToVScanMap = WMKS.CONST.KB.VScanMap[value];\n         break;\n\n      case 'ignoredRawKeyCodes':\n         this._keyboardManager.setIgnoredRawKeyCodes(value);\n         break;\n      case 'sendRelativeMouseEvent':\n         this._vncDecoder.options.sendRelativeMouseEvent = value;\n         break;\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * getCanvasPosition\n *\n *    Tracks the cursor throughout the document.\n *\n * Results:\n *    The current mouse position in the form { x, y }.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.getCanvasPosition = function (docX, docY) {\n   var offset, scalePxRatio, maxX, maxY;\n\n   if (isNaN(docX) || isNaN(docY)) {\n      return { x: 0, y: 0 };\n   }\n\n   offset = this._canvas.offset();\n   scalePxRatio = this._pixelRatio * this._displayScaleRatio / this._scale;\n\n   var x = Math.ceil((docX - offset.left) * scalePxRatio);\n   var y = Math.ceil((docY - offset.top) * scalePxRatio);\n\n   /*\n    * Clamp bottom and right border.\n    */\n   maxX = Math.ceil(this._canvas.width() * scalePxRatio) - 1;\n   maxY = Math.ceil(this._canvas.height() * scalePxRatio) - 1;\n   x = Math.min(x, maxX);\n   y = Math.min(y, maxY);\n\n   /*\n    * Clamp left and top border.\n    */\n   x = Math.max(x, 0);\n   y = Math.max(y, 0);\n\n   return { x: x, y: y };\n};\n\n/*\n *------------------------------------------------------------------------------\n *\n * getRelativeMouseCanvasPosition\n *\n *    Tracks the cursor throughout the document.\n *\n * Results:\n *    The current mouse position in the form { x, y }.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.getRelativeMouseCanvasPosition = function (pos) {\n   var offset, offsetParent, scalePxRatio;\n   var docX = pos.x,\n       docY = pos.y;\n\n   if (isNaN(docX) || isNaN(docY)) {\n      return { x: 0, y: 0 };\n   }\n\n   offset = this._canvas.offset();\n   offsetParent = this._canvas.parent().offset();\n\n   scalePxRatio = this._scale / this._pixelRatio;\n\n   var x = Math.ceil(docX * scalePxRatio + offset.left);\n   var y = Math.ceil(docY * scalePxRatio + offset.top);\n\n   return { x: x, y: y };\n};\n\n/*\n *------------------------------------------------------------------------------\n *\n * getEventPosition\n *\n *    Gets the mouse event position within the canvas.\n *    Tracks the cursor throughout the document.\n *\n * Results:\n *    The current mouse position in the form { x, y }.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.getEventPosition = function (evt) {\n\n   var docX, docY;\n\n   if (evt.pageX || evt.pageY) {\n      docX = evt.pageX;\n      docY = evt.pageY;\n   } else if (evt.clientX || evt.clientY) {\n      docX = (evt.clientX +\n              document.body.scrollLeft +\n              document.documentElement.scrollLeft);\n      docY = (evt.clientY +\n              document.body.scrollTop +\n              document.documentElement.scrollTop);\n   } else {\n      // ??\n   }\n\n   return this.getCanvasPosition(docX, docY);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _isCanvasMouseEvent\n *\n *    Checks if a mouse event should be consumed as if it was targeted at the\n *    canvas.\n *\n *    This is useful in the case that a user holds their mouse down and\n *    drags it outside of the canvas, either on to other elements or even\n *    outside the browser window. It will allow us to process the mouse up event\n *    and ensure we do not end up in the state where the remote thinks we are\n *    still holding the mouse button down but locally we are not.\n *\n * Results:\n *    Returns true if mouse event should be considered to be targeted at canvas\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto._isCanvasMouseEvent = function(event) {\n   var evt = event || window.event;\n   var elm = evt.target || evt.srcElement;\n\n   // If the mouse was pressed down on the canvas then continue to consume\n   // all mouse events until mouse release.\n   if (this._mouseDownBMask !== 0) {\n       return true;\n   } else {\n      // Else, only consume mouse events for the canvas or video\n      return (elm === this._canvas[0]) ||\n             (this._video && (elm === this._video[0])) || (elm === $('#relativePadSurface')) ;\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _onMouseButton\n *\n *    Mouse event handler for 'mousedown' and 'mouseup' events.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends a VMWPointerEvent message to the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto._onMouseButton = function(event, down) {\n   if (this._vncDecoder && this._isCanvasMouseEvent(event)) {\n      var evt = event || window.event;\n      var pos = this.getEventPosition(evt);\n      var bmask;\n\n      /* evt.which is valid for all browsers except IE */\n      if (evt.which) {\n         /*\n          * Firefox on Mac causes Ctrl + click to be a right click.  This kills\n          * this ability to multi-select while clicking. Remap to left click in\n          * this case. PR 878794 / 1085523.\n          */\n         if (WMKS.BROWSER.isMacOS() && WMKS.BROWSER.isGecko()\n               && evt.ctrlKey && evt.button === 2) {\n            WMKS.LOGGER.trace ('FF on OSX: Rewrite Ctrl+Right-click as Ctrl+Left-click.');\n            bmask = 1 << 0;   // Left click.\n         } else {\n            bmask = 1 << evt.button;\n         }\n      } else {\n         /* IE including 9 */\n         bmask = (((evt.button & 0x1) << 0) |\n                  ((evt.button & 0x2) << 1) |\n                  ((evt.button & 0x4) >> 1));\n      }\n      return this.sendMouseButtonMessage(pos, down, bmask);\n   }\n};\n\n/*\n *------------------------------------------------------------------------------\n *\n * sendMouseButtonMessage\n *\n *    Sends the mouse message for 'mousedown' / 'mouseup' at a given position.\n *\n *    Sends a VMWPointerEvent message to the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.sendMouseButtonMessage = function(pos, down, bmask) {\n   if (this._vncDecoder) {\n      if (down) {\n         this._mouseDownBMask |= bmask;\n      } else {\n         this._mouseDownBMask &= ~bmask;\n      }\n      /*\n       * Send MouseMove event first, to ensure the pointer is at the\n       * coordinates where the click should happen. This fixes the\n       * erratic mouse behaviour when using touch devices to control\n       * a Windows machine.\n       */\n      if (this._mousePosGuest.x !== pos.x || this._mousePosGuest.y !== pos.y) {\n         // Send the mousemove message and update state.\n         this.sendMouseMoveMessage(pos);\n      }\n\n      // WMKS.LOGGER.warn(pos.x + ',' + pos.y + ', down: ' + down + ', mask: ' + bmask);\n      this._vncDecoder.onMouseButton(pos.x, pos.y, down, bmask);\n   }\n   return true;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _onMouseWheel\n *\n *    Mouse wheel handler. Normalizes the deltas from the event and\n *    sends it to the guest.\n *\n * Results:\n *    true, always.\n *\n * Side Effects:\n *    Sends data.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto._onMouseWheel = function(event) {\n   if (this._vncDecoder && this._isCanvasMouseEvent(event)) {\n      var evt = event || window.event;\n      var pos = this.getEventPosition(evt);\n      var dx = Math.max(Math.min(event.wheelDeltaX, 1), -1);\n      var dy = Math.max(Math.min(event.wheelDeltaY, 1), -1);\n\n      if (this.options.reverseScrollY) {\n         dy = dy * -1;\n      }\n      // Abstract the sending message part and updating state for reuse by\n      // touchHandler.\n      this.sendScrollMessage(pos, dx, dy);\n\n      // Suppress default actions\n      event.stopPropagation();\n      event.preventDefault();\n      return false;\n   }\n\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * sendScrollMessage\n *\n *    Mouse wheel handler. Normalizes the deltas from the event and\n *    sends it to the guest.\n *\n *    Sends a VMWPointerEvent message to the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.sendScrollMessage = function(pos, dx, dy) {\n   if (this._vncDecoder) {\n      /*\n       * Send MouseMove event first, to ensure the pointer is at the\n       * coordinates where the click should happen. This fixes the\n       * erratic mouse behaviour when using touch devices to control\n       * a Windows machine.\n       */\n      //\n      // TODO: This is commented out for now as it seems to break browser scrolling.\n      //       We may need to revisit this for iPad scrolling.\n      //\n      // if (this._mousePosGuest.x !== pos.x || this._mousePosGuest.y !== pos.y) {\n      //   // Send the mousemove message and update state.\n      //   this.sendMouseMoveMessage(pos);\n      // }\n      // WMKS.LOGGER.debug('scroll: ' + pos.x + ',' + pos.y + ', dx, dy: ' + dx + ',' + dy);\n      this._vncDecoder.onMouseWheel(pos.x, pos.y, dx, dy);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _onMouseMove\n *\n *    Mouse event handler for 'mousemove' event.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends a VMWPointerEvent message to the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto._onMouseMove = function(event) {\n   if (this._vncDecoder && this._isCanvasMouseEvent(event)) {\n      var evt = event || window.event;\n      var pos = this.getEventPosition(evt);\n\n      this.sendMouseMoveMessage(pos);\n   }\n   return true;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * sendMouseMoveMessage\n *\n *    The mouse move message is sent to server and the state change is noted.\n *\n *    Sends a VMWPointerEvent message to the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.sendMouseMoveMessage = function(pos) {\n   if (this._vncDecoder) {\n      this._vncDecoder.onMouseMove(pos.x, pos.y);\n      this._mousePosGuest = pos;\n\n      // Inform the input text field regarding the caret position change.\n      if (this._touchHandler) {\n      this._touchHandler.onCaretPositionChanged(pos);\n   }\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * sendKeyMessage\n *\n *    The key message is sent to server and the state change is noted.\n *\n *    VScanCodes or Unicode will be sent to the server depending on the config.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.sendKeyMessage = function(message) {\n   var messageType = message.type,\n      event = message.event;\n   if (messageType == \"KeyDown\") {\n      this.updateUserActivity();\n      return this._keyboardManager.onKeyDown(event);\n   } else if (messageType == \"KeyPress\") {\n      this.updateUserActivity();\n      return this._keyboardManager.onKeyPress(event);\n   } else if (messageType == \"KeyUp\") {\n      this.updateUserActivity();\n      return this._keyboardManager.onKeyUp(event);\n   };\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * onBlur\n *\n *    Expose _onBlur to avoid tricky codes in the UI layer for supporting\n *    multimon in 17Q1.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Releases all keys (calling cancelModifiers) and mouse buttons by checking\n *    and clearing their tracking variables (this._mouseDownBMask) and\n *    sending the appropriate VMWKeyEvent and VMWPointerEvent messages.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.onBlur = function(event) {\n   this._onBlur(event);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * onBlur\n *\n *    Expose _onBlur to avoid tricky codes in the UI layer for supporting\n *    multimon in 17Q1.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Releases all keys (calling cancelModifiers) and mouse buttons by checking\n *    and clearing their tracking variables (this._mouseDownBMask) and\n *    sending the appropriate VMWKeyEvent and VMWPointerEvent messages.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.onBlur = function(event) {\n   this._onBlur(event);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _onBlur\n *\n *    Event handler for 'blur' event.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Releases all keys (calling cancelModifiers) and mouse buttons by checking\n *    and clearing their tracking variables (this._mouseDownBMask) and\n *    sending the appropriate VMWKeyEvent and VMWPointerEvent messages.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto._onBlur = function(event) {\n   if (this.connected) {\n      /*\n       * The user switched to a different element or window,\n       * so release all keys.\n       */\n\n      // Cancel all modifiers that are held.\n      this._keyboardManager.cancelModifiers();\n\n      this._vncDecoder.onMouseButton(this._mousePosGuest.x,\n                                     this._mousePosGuest.y,\n                                     0,\n                                     this._mouseDownBMask);\n      this._mouseDownBMask = 0;\n   }\n\n   return true;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * _onPaste\n *\n *    Clipboard paste handler.\n *\n * Results:\n *    true, always.\n *\n * Side Effects:\n *    Calls any user-defined callback with pasted text.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto._onPaste = function(event) {\n   var e = event.originalEvent;\n   var self = this;\n   if (e && e.clipboardData) {\n      var items = e.clipboardData.items;\n      if (items) {\n         for (var i = 0; i < items.length; i++) {\n            if (items[i].kind === 'string' && items[i].type === 'text/plain') {\n               items[i].getAsString(function(txt) {\n                  self._keyboardManager.processInputString(txt);\n               });\n            }\n         }\n      }\n   }\n   return true;\n};\n\n\n/************************************************************************\n * Public API\n ************************************************************************/\n\n/*\n *------------------------------------------------------------------------------\n *\n * disconnectEvents\n *\n *    Disconnects the events from the owner document.\n *\n *    This can be called by consumers of WebMKS to disconnect all the events\n *    used to interact with the guest.\n *\n *    The consumer may need to carefully manage the events (for example, if\n *    there are multiple WebMKS's in play, some hidden and some not), and can\n *    do this with connectEvents and disconnectEvents.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Disconnects the event handlers from the events in the WMKS container.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.disconnectEvents = function() {\n   /*\n    * Remove our own handler for the 'keypress' event and the context menu.\n    */\n   this.element\n      .unbind('contextmenu.wmks')\n      .unbind('keydown.wmks')\n      .unbind('keypress.wmks')\n      .unbind('keyup.wmks')\n      .unbind('mousedown.wmks')\n      .unbind('mousewheel.wmks');\n\n   this.element\n      .unbind('mousemove.wmks')\n      .unbind('mouseup.wmks')\n      .unbind('blur.wmks');\n\n   $(window)\n      .unbind('blur.wmks' + this._wmksId);\n   $(window)\n      .unbind('mousemove.wmks' + this._wmksId);\n   $(window)\n      .unbind('mousewheel.wmks' + this._wmksId);\n   $(window)\n      .unbind('mouseup.wmks' + this._wmksId);\n   $(window)\n      .unbind('mousedown.wmks' + this._wmksId);\n\n   // Disconnect event handlers from the touch handler.\n   if (this._touchHandler) {\n      this._touchHandler.disconnectEvents();\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * connectEvents\n *\n *    Connects the events to the owner document.\n *\n *    This can be called by consumers of WebMKS to connect all the\n *    events used to interact with the guest.\n *\n *    The consumer may need to carefully manage the events (for example,\n *    if there are multiple WebMKS's in play, some hidden and some not),\n *    and can do this with connectEvents and disconnectEvents.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Connects the event handlers to the events in the WMKS container.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.connectEvents = function() {\n   var self = this;\n\n   /*\n    * Paste event only works on the document (When using Browser's Edit->Paste)\n    * This feature also has drawbacks.\n    * 1. It only works on Chrome browser.\n    * 2. Performing paste on any other element on this document causes the\n    *    event to get triggered by bubbling up. Technically the bubbling up\n    *    should be enabled only if the element can handle paste in the first\n    *    place (i.e., only if its textbox / textarea or an element with\n    *    contenteditable set to true.)\n    *\n    * Due to above limitations, this is disabled. PR: 1091032\n    */\n   //$(this.element[0].ownerDocument)\n   //   .bind('paste.wmks', function(e) { return self._onPaste(e); });\n\n   this.element\n      .bind('blur.wmks', function(e) { return self._onBlur(e); });\n\n   /*\n    * We have to register a handler for the 'keypress' event as it is the\n    * only one reliably reporting the key pressed. It gives character\n    * codes and not scancodes however.\n    */\n   this.element\n      .bind('contextmenu.wmks', function(e) { return false; })\n      .bind('keydown.wmks', function(e) {\n         self.updateUserActivity();\n         return self._keyboardManager.onKeyDown(e);\n      })\n      .bind('keypress.wmks', function(e) {\n         return self._keyboardManager.onKeyPress(e);\n      })\n      .bind('keyup.wmks', function(e) {\n         self.updateUserActivity();\n         return self._keyboardManager.onKeyUp(e);\n      });\n\n   $(window)\n      .bind('blur.wmks' + this._wmksId, function(e) {\n         return self._onBlur(e);\n      })\n      .bind('mousemove.wmks' + this._wmksId, function(e) {\n         self.updateUserActivity();\n         if(self.options.sendRelativeMouseEvent) {\n            return;\n         } else {\n            return self._onMouseMove(e);\n         }\n      })\n      .bind('mousewheel.wmks' + this._wmksId, function(e) {\n         self.updateUserActivity();\n         if(self.options.sendRelativeMouseEvent) {\n            return;\n         } else {\n            return self._onMouseWheel(e);\n         }\n      })\n      .bind('mouseup.wmks' + this._wmksId, function(e) {\n         self.updateUserActivity();\n         if(self.options.sendRelativeMouseEvent) {\n            return;\n         } else {\n            return self._onMouseButton(e, 0);\n         }\n      })\n      .bind('mousedown.wmks' + this._wmksId, function(e) {\n         self.updateUserActivity();\n         if(self.options.sendRelativeMouseEvent) {\n            return;\n         } else {\n            return self._onMouseButton(e, 1);\n         }\n      });\n\n   // Initialize touch input handlers if applicable.\n   if (this._touchHandler) {\n      this._touchHandler.installTouchHandlers();\n   }\n\n   if (this._relativeMouseHandler) {\n      this._relativeMouseHandler.installMouseHandlers();\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * maxFitWidth\n *\n *    This calculates the maximum screen size that could fit, given the\n *    currently allocated scroll width. Consumers can use this with\n *    maxFitHeight() to request a resolution change in the guest.\n *\n *    This value takes into account the pixel ratio on the device, if\n *    useNativePixels is on.\n *\n * Results:\n *    The maximum screen width given the current width of the WebMKS.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.maxFitWidth = function() {\n   return this.element[0].scrollWidth * this._pixelRatio;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * maxFitHeight\n *\n *    This calculates the maximum screen size that could fit, given the\n *    currently allocated scroll height. Consumers can use this with\n *    maxFitWidth() to request a resolution change in the guest.\n *\n *    This value takes into account the pixel ratio on the device, if\n *    useNativePixels is on.\n *\n * Results:\n *    The maximum screen height given the current height of the WebMKS.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.maxFitHeight = function() {\n   return this.element[0].scrollHeight * this._pixelRatio;\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * hideKeyboard\n *\n *    Hides the keyboard on a mobile device.\n *\n *    If allowMobileKeyboardInput is on, this command will hide the\n *    mobile keyboard if it's currently shown.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Moves browser focus away from input widget and updates state.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.hideKeyboard = function(args) {\n   args = args || {};\n   args.show = false;\n\n   this.toggleKeyboard(args);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * showKeyboard\n *\n *    Shows the keyboard on a mobile device.\n *\n *    If allowMobileKeyboardInput is on, this command will display the\n *    mobile keyboard.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Moves browser focus to input widget and updates state.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.showKeyboard = function(args) {\n   args = args || {};\n   args.show = true;\n\n   this.toggleKeyboard(args);\n};\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * toggleKeyboard\n *\n *    toggles the keyboard visible state on a mobile device.\n *\n *    If allowMobileKeyboardInput is on, this command will toggle the\n *    mobile keyboard from show to hide or vice versa.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Moves browser focus to input widget and updates state.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.toggleKeyboard = function(args) {\n   if (this.options.allowMobileKeyboardInput && this._touchHandler) {\n      this._touchHandler.toggleKeyboard(args);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * toggleTrackpad\n *\n *    Show/Hide the trackpad dialog on a mobile device.\n *\n *    If allowMobileTrackpad is on, this command will toggle the\n *    trackpad dialog.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.toggleTrackpad = function(options) {\n   if (this.options.allowMobileTrackpad && this._touchHandler) {\n      this._touchHandler.toggleTrackpad(options);\n   }\n};\n\n/*\n *------------------------------------------------------------------------------\n *\n * toggleTrackpad\n *\n *    Show/Hide the trackpad dialog on a mobile device.\n *\n *    If allowMobileTrackpad is on, this command will toggle the\n *    trackpad dialog.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.toggleRelativePad = function(options) {\n   if ( this._relativeMouseHandler) {\n      this._relativeMouseHandler.toggleRelativePad(options);\n   }\n};\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * toggleExtendedKeypad\n *\n *    Show/Hide the extended keypad dialog on a mobile device when the flag:\n *    allowMobileExtendedKeypad is set, this command will toggle the dialog.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.toggleExtendedKeypad = function(options) {\n   if (this.options.allowMobileExtendedKeypad && this._touchHandler) {\n      this._touchHandler.toggleExtendedKeypad(options);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * sendInputString\n *\n *    Sends a unicode string as keyboard input to the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.sendInputString = function(str) {\n   /*\n    * Explicitly process newline as we are sending it as a string.\n    * onPaste on the other hand only does not need to set this flag.\n    */\n   this._keyboardManager.processInputString(str, true);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * sendKeyCodes\n *\n *    Sends a series of special key codes to the VM.\n *\n *    This takes an array of special key codes and sends keydowns for\n *    each in the order listed. It then sends keyups for each in\n *    reverse order.\n *\n *    Keys usually handled via keyPress are also supported: If a keycode\n *    is negative, it is interpreted as a Unicode value and sent to\n *    keyPress. However, these need to be the final key in a combination,\n *    as they will be released immediately after being pressed. Only\n *    letters not requiring modifiers of any sorts should be used for\n *    the latter case, as the keyboardMapper may break the sequence\n *    otherwise. Mixing keyDown and keyPress handlers is semantically\n *    incorrect in JavaScript, so this separation is unavoidable.\n *\n *    This can be used to send key combinations such as\n *    Control-Alt-Delete, as well as Ctrl-V to the guest, e.g.:\n *    [17, 18, 46]      Control-Alt-Del\n *    [17, 18, 45]      Control-Alt-Ins\n *    [17, -118]        Control-v (note the lowercase 'v')\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends keyboard data to the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.sendKeyCodes = function(keyCodes) {\n   var i, keyups = [];\n\n   for (i = 0; i < keyCodes.length; i++) {\n      var keyCode = keyCodes[i];\n\n      if (keyCode > 0) {\n         this._keyboardManager.sendKey(keyCode, false, false);\n         /*\n          * Keycode 20 is 'special' - it's the Javascript keycode for the Caps Lock\n          * key. In regular usage on Mac OS the browser sends a down when the caps\n          * lock light goes on and an up when it goes off. The key handling code\n          * special cases this, so if we fake both a down and up here we'll just\n          * flip the caps lock state right back to where we started (if this is\n          * a Mac OS browser platform).\n          */\n         if (!(keyCode === 20) || WMKS.BROWSER.isMacOS()) {\n            keyups.push(keyCode);\n         }\n      } else if (keyCode < 0) {\n         this._keyboardManager.sendKey(0 - keyCode, true, true);\n      }\n   }\n\n   for (i = keyups.length - 1; i >= 0; i--) {\n      this._keyboardManager.sendKey(keyups[i], true, false);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * rescale\n *\n *    Rescales the WebMKS to match the currently allocated size.\n *\n *    This will update the placement and size of the canvas to match\n *    the current options and allocated size (such as the pixel\n *    ratio).  This is an external interface called by consumers to\n *    force an update on size changes, internal users call\n *    rescaleOrResize(), below.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Updates this._scale and modifies the canvas size and position.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.rescale = function() {\n   this.rescaleOrResize(true);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * updateFitGuestSize\n *\n *    This is a special function that should be used only with fitGuest mode.\n *    This function is used the first time a user initiates a connection.\n *    The fitGuest will not work until the server sends back a CAPS message\n *    indicating that it can handle resolution change requests.\n *\n *    This is used with toggling useNativePixels options in fitGuest mode\n  *    and also display scale mode.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.updateFitGuestSize = function(compareAgainstGuestSize) {\n   var newParentW = this.element.width() * this._pixelRatio *\n         this._displayScaleRatio,\n       newParentH = this.element.height() * this._pixelRatio *\n          this._displayScaleRatio;\n\n   // Return if its not fitGuest or when the old & new width/height are same\n   // when the input param compareAgainstGuestSize is set.\n   if (!this.options.fitGuest\n         || (compareAgainstGuestSize\n            && this._guestWidth === newParentW\n            && this._guestWidth === newParentH)) {\n      return;\n   }\n\n   if(!!this._resolutionHandler) {\n      var resolution = this._resolutionHandler(newParentW, newParentH);\n      newParentW = resolution[0];\n      newParentH = resolution[1];\n   }\n\n   // New resolution based on pixelRatio in case of fitGuest.\n   this._vncDecoder.onRequestResolution(newParentW, newParentH);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * updateTopology\n *\n *    This function is used to send topology request to server.\n *\n *    The \"useRawSetting\" is an optimal boolean param which should be set as\n *    true if want to directly pass monitors settings in multiMonRects into\n *    agent without apply the _pixelRatio.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    None.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.updateTopology = function(multiMonRects, useRawSetting) {\n   var i;\n\n   /*\n    * Return if its not fitGuest.\n    * This does not check whether the current topology is the same or not. It\n    * will always just send the request.\n    */\n   if (!this.options.fitGuest) {\n      return;\n   }\n\n   if (!useRawSetting) {\n      for (i = 0; i < multiMonRects.length; i++) {\n         multiMonRects[i].left = multiMonRects[i].left * this._pixelRatio;\n         multiMonRects[i].top = multiMonRects[i].top * this._pixelRatio;\n         multiMonRects[i].requestedWidth =\n            multiMonRects[i].requestedWidth * this._pixelRatio;\n         multiMonRects[i].requestedHeight =\n            multiMonRects[i].requestedHeight * this._pixelRatio;\n      }\n   }\n\n   // New resolution based on pixelRatio in case of fitGuest.\n   this._vncDecoder.onRequestTopology(multiMonRects);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * setAudioStreamEnabled\n *\n *    Send a message to the server to enable or disable sending of audio data.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *    Can affect whether we receive audio data from the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.setAudioStreamEnabled = function(enabled) {\n   if (this._vncDecoder) {\n      this._vncDecoder.setAudioStreamEnabled(enabled);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * setVideoStreamEnabled\n *\n *    Send a message to the server to enable or disable sending of video data.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sends data.\n *    Can affect whether we receive video data from the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.setVideoStreamEnabled = function(enabled) {\n   if (this._vncDecoder) {\n      this._vncDecoder.setVideoStreamEnabled(enabled);\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * rescaleOrResize\n *\n *    Rescales the WebMKS to match the currently allocated size, or\n *    alternately fits the guest to match the current canvas size.\n *\n *    This will either:\n *         update the placement and size of the canvas to match the\n *         current options and allocated size (such as the pixel\n *         ratio).  This is normally called internally as the result\n *         of option changes, but can be called by consumers to force\n *         an update on size changes\n *    Or:\n *         issue a resolutionRequest command to the server to resize\n *         the guest to match the current WebMKS canvas size.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Updates this._scale and modifies the canvas size and position.\n *    Possibly triggers a resolutionRequest message to the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.rescaleOrResize = function(tryFitGuest) {\n   var newScale = 1.0, x = 0, y = 0;\n   var parentWidth = this.element.width(),\n       parentHeight = this.element.height();\n\n   this._canvas.css({\n      width: this._guestWidth / (this._pixelRatio * this._displayScaleRatio),\n      height: this._guestHeight / (this._pixelRatio * this._displayScaleRatio)\n   });\n\n   if (this._video) {\n      this._video.css({\n         width: this._guestWidth / (this._pixelRatio * this._displayScaleRatio),\n         height: this._guestHeight / (this._pixelRatio * this._displayScaleRatio)\n      });\n   }\n\n   // Use offsetWidth and offsetHeight to get original canvas size before scaling.\n   // Otherwise, it may end up scaling many times base on the same canvas size.\n   var width = this._canvas[0].offsetWidth;\n   var height = this._canvas[0].offsetHeight;\n\n   if (this.transform !== null &&\n       !this.options.fitToParent &&\n       !this.options.fitGuest) {\n\n      // scale = 1.0, x = 0, y = 0;\n\n   } else if (this.transform !== null &&\n              this.options.fitToParent) {\n      var horizScale = parentWidth / width,\n      vertScale = parentHeight / height;\n\n      x = (parentWidth - width) / 2;\n      y = (parentHeight - height) / 2;\n      newScale = Math.max(0.1, Math.min(horizScale, vertScale));\n\n   } else if (this.options.fitGuest && tryFitGuest) {\n      // fitGuest does not rely on this.transform. It relies on the size\n      // provided by the wmks consumer. However, it does have to update the\n      // screen size when using high resolution mode.\n      this.updateFitGuestSize(true);\n   } else if (this.transform === null) {\n      WMKS.LOGGER.warn(\"No scaling support\");\n   }\n\n   if (this.transform !== null) {\n      if (newScale !== this._scale) {\n         this._scale = newScale;\n         this._canvas.css(this.transform, \"scale(\" + this._scale + \")\");\n      }\n\n      if (x !== this._x || y !== this._y) {\n         this._x = x;\n         this._y = y;\n         this._canvas.css({top: y, left: x});\n      }\n   }\n};\n\n/*\n *------------------------------------------------------------------------------\n *\n * setVCDProxyHandshakeVmxPath\n *\n *    Set the VMX path for use during the VNC connection process to a VCD console\n *    proxy.\n *    This option adds a VMX header to VNC handshake.\n *\n *    Note: Setting VMX path after connecting has no effect.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Sets the VCDProxyHandshakeVmxPath option on the vncDecoder.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.setVCDProxyHandshakeVmxPath = function (value) {\n   this.options.VCDProxyHandshakeVmxPath = value;\n\n   if (this._vncDecoder && this._vncDecoder.options) {\n      this._vncDecoder.options.VCDProxyHandshakeVmxPath = value;\n   }\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * disconnect\n *\n *    Disconnects the WebMKS.\n *\n *    Consumers should call this when they are done with the WebMKS\n *    component. Destroying the WebMKS will also result in a disconnect.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Disconnects from the server and tears down the WMKS UI.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.disconnect = function() {\n   this._vncDecoder.disconnect();\n   this.disconnectEvents();\n\n   // Cancel any modifiers that were inflight.\n   this._keyboardManager.cancelModifiers();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * connect\n *\n *    Connects the WebMKS to a WebSocket URL.\n *\n *    Consumers should call this when they've placed the WebMKS and\n *    are ready to start displaying a stream from the guest.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Connects to the server and sets up the WMKS UI.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.connect = function(url) {\n   this.disconnect();\n   this._vncDecoder.connect(url);\n   this.connectEvents();\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * destroy\n *\n *    Destroys the WebMKS.\n *\n *    This will disconnect the WebMKS connection (if active) and remove\n *    the widget from the associated element.\n *\n *    Consumers should call this before removing the element from the DOM.\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Disconnects from the server and removes the WMKS class and canvas\n *    from the HTML code.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.destroy = function() {\n   this.disconnect();\n   this.element.removeClass(\"wmks\");\n\n   // Remove all event handlers and destroy the touchHandler.\n   this._touchHandler.destroy();\n   this._touchHandler = null;\n\n   this._relativeMouseHandler.destroy();\n   this._relativeMouseHandler = null;\n\n   this._canvas.remove();\n   if (this._video) {\n      this._video.remove();\n   }\n   if (this._backCanvas) {\n      this._backCanvas.remove();\n   }\n   if (this._blitTempCanvas) {\n      this._blitTempCanvas.remove();\n   }\n\n   $.Widget.prototype.destroy.call(this);\n};\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * requestElementReposition\n *\n *    Reposition html element so that it fits within the canvas region. This\n *    is used to reposition upon orientation change for touch devices. This\n *    function can be used once to perform the reposition immediately or can\n *    push the element to a queue that takes care of automatically performing\n *    the necessary repositioning upon orientation.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.requestElementReposition = function(element, addToQueue) {\n   if(this._touchHandler){\n   if (addToQueue) {\n      // Add the element to a queue. Queue elements will be repositioned upon\n      // orientation change.\n      this._touchHandler.addToRepositionQueue(element);\n      return;\n   }\n   // Just perform repositioning once.\n   this._touchHandler.widgetRepositionOnRotation(element);\n   }\n};\n\n\n\n/*\n *------------------------------------------------------------------------------\n *\n * updateUserActivity\n *\n *    Trigger an user activity event\n *\n *\n * Side Effects:\n *    Calls any user-defined callback with current time.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.updateUserActivity = function()\n{\n   this._trigger(\"useractivity\", 0, $.now());\n}\n\n\n/************************************************************************\n * jQuery instantiation\n ************************************************************************/\n\n/*\n *------------------------------------------------------------------------------\n *\n * _create\n *\n *    jQuery-UI initialisation function, called by $.widget()\n *\n * Results:\n *    None.\n *\n * Side Effects:\n *    Injects the WMKS canvas into the WMKS container HTML, sets it up\n *    and connects to the server.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.widgetProto.id = 1;\nWMKS.widgetProto._create = function() {\n   var self = this;\n\n   // Initialize our state.\n   this._mouseDownBMask = 0;\n   this._mousePosGuest = { x: 0, y: 0 };\n   this._scale = 1.0;\n   this._pixelRatio = 1.0;\n   this.connected = false;\n   this.isCanvasActive = false;\n\n   this._displayScaleRatio = 1;\n   this._wmksId = WMKS.widgetProto.id++;\n   this._canvas = WMKS.UTIL.createCanvas(true)\n      .prop({\n         id:         'mainCanvas',\n         tabindex:   1\n      });\n   this._backCanvas = WMKS.UTIL.createCanvas(true);\n   this._blitTempCanvas = WMKS.UTIL.createCanvas(true);\n\n   this.element\n      .addClass(\"wmks\")\n      .append(this._canvas);\n\n   if (this.options.enableMP4) {\n      this._video = WMKS.UTIL.createVideo(true);\n      this.element.append(this._video);\n   }\n\n   var checkProperty = function (prop) {\n      return typeof self._canvas[0].style[prop] !== 'undefined' ? prop : null;\n   };\n\n   this.transform = (checkProperty('transform') ||\n                     checkProperty('WebkitTransform') ||\n                     checkProperty('MozTransform') ||\n                     checkProperty('msTransform') ||\n                     checkProperty('OTransform'));\n\n   this._vncDecoder = new WMKS.VNCDecoder({\n      useVNCHandshake: this.options.useVNCHandshake,\n      VCDProxyHandshakeVmxPath: this.options.VCDProxyHandshakeVmxPath,\n      useUnicodeKeyboardInput: this.options.useUnicodeKeyboardInput,\n      enableVorbisAudioClips: this.options.enableVorbisAudioClips,\n      enableOpusAudioClips: this.options.enableOpusAudioClips,\n      enableAacAudioClips: this.options.enableAacAudioClips,\n      enableVVC: this.options.enableVVC,\n      enableUint8Utf8: this.options.enableUint8Utf8,\n      enableVMWSessionClose: this.options.enableVMWSessionClose,\n      enableVMWAudioMixer: this.options.enableVMWAudioMixer,\n      retryConnectionInterval: this.options.retryConnectionInterval,\n      sendRelativeMouseEvent: this.options.sendRelativeMouseEvent,\n      canvas: this._canvas[0],\n      backCanvas: this._backCanvas[0],\n      blitTempCanvas: this._blitTempCanvas[0],\n      mediaPlayer: (this.options.enableMP4 ? this._video[0] : null),\n      enableRawH264: this.options.enableRawH264,\n      enableTopologyChange: this.options.enableTopologyChange,\n      multimonRenderer: this.options.multimonRenderer,\n      enableH264Multimon: this.options.enableH264Multimon,\n      enableSubRectangleCache: this.options.enableSubRectangleCache,\n      cursorHandler: this.options.cursorHandler,\n      onConnecting: function(vvc, vvcSession) {\n         self._trigger(\"connecting\", 0, { 'vvc': vvc, 'vvcSession': vvcSession });\n      },\n      onConnected: function() {\n         self.connected = true;\n         self._trigger(\"connected\");\n\n         // Clear any keyboard specific state that was held earlier.\n         self._keyboardManager.clearState();\n         self.rescaleOrResize(true);\n      },\n      onBeforeDisconnected: function(closeReason) {\n         self._trigger(\"beforedisconnected\", 0, closeReason);\n      },\n      onDisconnected: function(reason, code) {\n         self.connected = false;\n         self._trigger(\"disconnected\", 0, {'reason': reason, 'code': code});\n      },\n      onAuthenticationFailed: function() {\n         self._trigger(\"authenticationFailed\");\n      },\n      onError: function(err) {\n         self._trigger(\"error\", 0, err);\n      },\n      onProtocolError: function() {\n         self._trigger(\"protocolError\");\n      },\n      onNewDesktopSize: function(width, height) {\n         self._guestWidth = width;\n         self._guestHeight = height;\n         var attrJson = {\n            width: width,\n            height: height\n         };\n         var cssJson = {\n            width: width / self._pixelRatio,\n            height: height / self._pixelRatio\n         };\n         self._canvas\n            .attr(attrJson)\n            .css(cssJson);\n\n         attrJson.y = height;\n         self._backCanvas\n            .attr(attrJson)\n            .css(cssJson);\n\n         self._blitTempCanvas\n            .attr(attrJson)\n            .css(cssJson);\n\n         if (self._video) {\n            self._video\n               .attr(attrJson)\n               .css(cssJson);\n         }\n         self._trigger(\"resolutionchanged\", null, attrJson);\n         self.rescaleOrResize(false);\n      },\n      onEncodingChanged: function(currentEncoding) {\n         if (currentEncoding === \"TightPNG\" && !self.isCanvasActive) {\n            WMKS.LOGGER.info(\"Activate canvas element \" +\n                             \"since we use TightPNG encoding.\");\n            self.isCanvasActive = true;\n            if (self._video) {\n               self._video.hide();\n            }\n            self._canvas.show();\n         } else if (currentEncoding === \"MP4\" && self.isCanvasActive) {\n            WMKS.LOGGER.info(\"Activate video element \" +\n                             \"since we use MP4 encoding.\");\n            if (self._video) {\n               self.isCanvasActive = false;\n               self._canvas.hide();\n               self._video.show();\n            } else {\n               WMKS.LOGGER.error(\"Video element doesn't exist.\");\n            }\n         } else if (currentEncoding === \"RawH264\" && self.isCanvasActive) {\n            /*\n             * This is only happen in a test situation, where the webMKS is\n             * simulating a client that can handle raw H264.\n             * Since browser don't handle raw H264 natively, we are just\n             * dropping the package.\n             */\n            WMKS.LOGGER.info(\"Activate video element \" +\n                             \"since we use raw H264 encoding.\");\n         }\n      },\n      onKeyboardLEDsChanged: function(leds) {\n         self._trigger(\"keyboardLEDsChanged\", 0, leds);\n      },\n      onCursorStateChanged: function(visibility) {\n         if(self._touchHandler){\n            self._touchHandler.setCursorVisibility(visibility);\n         }\n      },\n      onHeartbeat: function(interval) {\n         self._trigger(\"heartbeat\", 0, interval);\n      },\n      onUpdateCopyPasteUI: function (noCopyUI, noPasteUI) {\n         var serverSendClipboardCaps = {\n            noCopyUI: noCopyUI,\n            noPasteUI: noPasteUI\n         }\n         self._trigger(\"updateCopyPasteUI\", 0, serverSendClipboardCaps);\n      },\n      onMultimonCapacityUpdated: function (enabled) {\n         self._trigger(\"updateMultimonCapacityUI\", 0, enabled);\n      },\n      onCopy: function(data) {\n         if (typeof data !== 'string') {\n            WMKS.LOGGER.debug('data format is not string, ignore.');\n            return false;\n         }\n         self._trigger(\"copy\", 0, data);\n         return true;\n      },\n      onSetReconnectToken: function(token) {\n         self._trigger(\"reconnecttoken\", 0, token);\n      },\n      onAudio: function(audioInfo) {\n         self._trigger(\"audio\", 0, [audioInfo]);\n      },\n      onAudioMixer: function(audioMixerInfo) {\n         self._trigger(\"audiomixer\", 0, audioMixerInfo);\n      }\n   });\n\n   // Initialize the keyboard input handler.\n   this._keyboardManager = new WMKS.KeyboardManager({\n      vncDecoder: this._vncDecoder,\n      ignoredRawKeyCodes: this.options.ignoredRawKeyCodes,\n      fixANSIEquivalentKeys: this.options.fixANSIEquivalentKeys,\n      mapMetaToCtrlForKeys: this.options.mapMetaToCtrlForKeys,\n      enableWindowsKey: this.options.enableWindowsKey,\n      keyboardLayoutId: this.options.keyboardLayoutId\n   });\n\n   // Initialize the touch handler\n   this._touchHandler = new WMKS.TouchHandler({\n      widgetProto: this,\n      canvas: this._canvas,\n      keyboardManager: this._keyboardManager,\n      onToggle: function(data) {\n         self._trigger(\"toggle\", 0, data);\n      }\n   });\n\n   // Initialize the touch handler\n   this._relativeMouseHandler = new WMKS.RelativeMouseHandler({\n      widgetProto: this,\n      canvas: this._canvas,\n      keyboardManager: this._keyboardManager,\n      onToggle: function(data) {\n         self._trigger(\"toggle\", 0, data);\n         self._setOption('sendRelativeMouseEvent',data[1]);\n         self._relativeMouseHandler.setCursorVisibility(data[1]);\n      }\n   });\n\n   // The resolution handler for application to adjust the resolution\n   this._resolutionHandler = this.options.resolutionHandler;\n\n   this._updatePixelRatio();\n   /*\n    * Send in a request to set the new resolution size in case of fitGuest mode.\n    * This avoids the need to invoke the resize after successful connection.\n    */\n   this.updateFitGuestSize();\n\n   // Initialize touch features if they are enabled.\n   this._relativeMouseHandler.initializeRelativeMouseFeature();\n   this._updateMobileFeature(this.options.allowMobileKeyboardInput,\n                             WMKS.CONST.TOUCH.FEATURE.SoftKeyboard);\n   this._updateMobileFeature(this.options.allowMobileTrackpad,\n                             WMKS.CONST.TOUCH.FEATURE.Trackpad);\n   this._updateMobileFeature(this.options.allowMobileExtendedKeypad,\n                             WMKS.CONST.TOUCH.FEATURE.ExtendedKeypad);\n};/*\n *------------------------------------------------------------------------------\n *\n * wmks/dialogManager.js\n *\n *   The base controller of popup dialog.\n *\n *------------------------------------------------------------------------------\n */\n\n(function() {\n   'use strict';\n\n   WMKS.dialogManager = function() {\n      this.dialog = null;\n      this.visible = false;\n      this.lastToggleTime = 0;\n      this.options = {\n         name: 'DIALOG_MGR',     // Should be inherited.\n         toggleCallback: function(name, toggleState) {},\n        /*\n         * The minimum wait time before toggle can repeat. This is useful to\n         * ensure we do not toggle twice due to our usage of the close event.\n         */\n        minToggleTime: 50\n      };\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * setOption\n    *\n    *    Set value of the specified option.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.setOption = function(key, value) {\n      this.options[key] = value;\n\n      return this;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * setOptions\n    *\n    *    Set values of a set of options.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.setOptions = function(options) {\n      var key;\n\n      for (key in options) {\n         this.setOption(key, options[key]);\n      }\n\n      return this;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * initialize\n    *\n    *    Create the dialog and initialize it.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.initialize = function(options) {\n      this.options = $.extend({},\n         this.options,\n         options);\n\n      this.dialog = this.create();\n      this.init();\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * destroy\n    *\n    *    Remove the dialog functionality completely.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.destroy = function() {\n      if (!!this.dialog) {\n         this.disconnect();\n         this.remove();\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * create\n    *\n    *    Construct the dialog.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.create = function() {\n      // For subclass to override.\n      return null;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * init\n    *\n    *    Initialize the dialog, e.g. register event handlers.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.init = function() {\n      // For subclass to override.\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * disconnect\n    *\n    *    Cleanup data and events.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.disconnect = function() {\n      // For subclass to override.\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * remove\n    *\n    *    Destroy the dialog.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.remove = function() {\n      var dialog = this.dialog;\n\n      if (!!dialog) {\n         // Destroy the dialog and remove it from DOM.\n         dialog\n            .dialog('destroy')\n            .remove();\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * toggle\n    *\n    *    Show / hide the dialog. If the options comes with a launcher element\n    *    then upon open / close, send an event to the launcher element.\n    *\n    *    Ex: For Blast trackpad:\n    *          options = {toggleCallback: function(name, toggleState) {}}\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.toggle = function(options) {\n      var dialog = this.dialog,\n          show = !this.visible,\n          isOpen;\n\n      if (!dialog) {\n         return;\n      }\n\n      if (!!options) {\n         this.setOptions(options);\n      }\n\n      isOpen = dialog.dialog('isOpen');\n      if (show === isOpen) {\n         return;\n      }\n\n      if ($.now() - this.lastToggleTime < this.options.minToggleTime) {\n         // WMKS.LOGGER.debug('Ignore toggle time.');\n         return;\n      }\n\n      if (isOpen) {\n         // Hide dialog.\n         this.close();\n      } else {\n         // Show dialog.\n         this.open();\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * sendUpdatedState\n    *\n    *    Helper function to maintain the state of the widget and last toggle\n    *    time. If the toggleCallback option is set, we invoke a callback for the\n    *    state change (dialog state: open / close)\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.sendUpdatedState = function(state) {\n      this.visible = state;\n      this.lastToggleTime = $.now();\n\n      // Triggers the callback event to toggle the selection.\n      if ($.isFunction(this.options.toggleCallback)) {\n         this.options.toggleCallback.call(this, [this.options.name, state]);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * open\n    *\n    *    Show the dialog. Send update state.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.open = function() {\n      if (!!this.dialog) {\n         this.visible = !this.visible;\n         this.dialog.dialog('open');\n         this.sendUpdatedState(true);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * close\n    *\n    *    Hide the dialog. Send update state.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.close = function() {\n      if (!!this.dialog) {\n         this.visible = !this.visible;\n         this.dialog.dialog('close');\n         this.sendUpdatedState(false);\n      }\n   };\n\n}());\n/*\n *------------------------------------------------------------------------------\n *\n * wmks/extendedKeypad.js\n *\n *    The controller of extended keypad widget. This widget provides special\n *    keys that are generally not found on soft keyboards on touch devices.\n *\n *    Some of these keys include: Ctrl, Shift, Alt, Arrow keys, Page navigation\n *    Win, function keys, etc.\n *\n *    TODO:\n *    This version of the extended keypad will have fixed number of keys that it\n *    supports, and it will be nice to extend the functionality to make these\n *    keys configurable.\n *\n *------------------------------------------------------------------------------\n */\n\n(function() {\n   'use strict';\n\n   // Constructor of this class.\n   WMKS.extendedKeypad = function(params) {\n      if (!params || !params.widget || !params.keyboardManager) {\n         return null;\n      }\n\n      // Call constructor so dialogManager's params are included here.\n      WMKS.dialogManager.call(this);\n\n      this._widget = params.widget;\n      this._kbManager = params.keyboardManager;\n      this._parentElement = params.parentElement;\n\n      // Store down modifier keys.\n      this.manualModifiers = [];\n\n      $.extend(this.options,\n               {\n                  name: 'EXTENDED_KEYPAD'\n               });\n      WMKS.LOGGER.warn('Key pad : ' + this.options.name);\n   };\n\n   // Inherit from dialogManager.\n   WMKS.extendedKeypad.prototype = new WMKS.dialogManager();\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * create\n    *\n    *    This function creates the control pane dialog with the modifier\n    *    and extended keys.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.extendedKeypad.prototype.create = function() {\n      var self = this,\n          ctrlPaneHolder = $('<div id=\"ctrlPanePopup\"></div>');\n      // Load the control pane popup with control icons and their key events.\n      ctrlPaneHolder.append(this.getControlPaneHtml());\n\n      // Initialize the popup for opening later.\n      /*\n       * Adding the show or hide effect makes the dialog not draggable on iOS 5.1\n       * device. This could be a bug in Mobile Safari itself? For now we get rid\n       * of the effects. TODO: Do a check of the iOS type and add the effects\n       * back based on the version.\n       */\n      ctrlPaneHolder.dialog({\n         autoOpen: false,\n         closeOnEscape: true,\n         resizable: false,\n         position: {my: 'center', at: 'center', of: this._parentElement},\n         zIndex: 1000,\n         dialogClass: 'ctrl-pane-wrapper',\n         close: function(e) {\n            /*\n             * Clear all modifiers and the UI state so keys don't\n             * stay 'down' when the ctrl pane is dismissed. PR: 983693\n             * NOTE: Need to pass param as true to apply for softKB case.\n             */\n            self._kbManager.cancelModifiers(true);\n            ctrlPaneHolder.find('.ab-modifier-key.ab-modifier-key-down')\n               .removeClass('ab-modifier-key-down');\n\n            // Hide the keypad.\n            self.toggleFunctionKeys(false);\n            self.sendUpdatedState(false);\n            return true;\n         },\n         dragStop: function(e) {\n            self.positionFunctionKeys();\n         }\n      });\n\n      return ctrlPaneHolder;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * init\n    *\n    *    This function initializes the control pane dialog with the necessary\n    *    event listeners.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.extendedKeypad.prototype.init = function() {\n      var self = this,\n          ctrlPaneHolder = this.dialog,\n          keyInputHandler = function(e) {\n            var key = parseInt($(this).attr('abkeycode'), 10);\n            self._kbManager.handleSoftKb(key, false);\n            return false;\n         };\n\n\n      // Initialize modifier key functionality.\n      ctrlPaneHolder.find('.ab-modifier-key').on('touchstart', function(e) {\n         // compute if key is pressed now.\n         var isDown = $(this).hasClass('ab-modifier-key-down');\n         var key = parseInt($(this).attr('abkeycode'), 10);\n         if (isNaN(key)) {\n            WMKS.LOGGER.debug('Got NaN as modifier key. Skipping it.');\n            return false;\n         }\n\n         // Toggle highlight class for modifiers keys.\n         $(this).toggleClass('ab-modifier-key-down');\n\n         // Currently in down state, send isUp = true.\n         self._kbManager.updateModifiers(key, isDown);\n         return false;\n      });\n\n      // Toggle function keys also toggles the key highlighting.\n      ctrlPaneHolder.find('#fnMasterKey').off('touchstart').on('touchstart', function(e) {\n         self.toggleFunctionKeys();\n         return false;\n      });\n\n      // Initialize extended key functionality.\n      ctrlPaneHolder.find('.ab-extended-key').off('touchstart')\n         .on('touchstart', keyInputHandler);\n\n      // Provide a flip effect to the ctrl pane to show more keys.\n      ctrlPaneHolder.find('.ab-flip').off('touchstart').on('touchstart', function() {\n         $(this).parents('.flip-container').toggleClass('perform-flip');\n         // Hide the keypad if its open.\n         self.toggleFunctionKeys(false);\n         return false;\n      });\n\n      // Add an id to the holder widget\n      ctrlPaneHolder.parent().prop('id', 'ctrlPaneWidget');\n\n      // Attach the function key pad to the canvas parent.\n      ctrlPaneHolder.parent().parent().append(this.getFunctionKeyHtml());\n\n      // Set up the function key events\n      $('#fnKeyPad').find('.ab-extended-key').off('touchstart')\n         .on('touchstart', keyInputHandler);\n\n      // Handle orientation changes for ctrl pane & fnKeys.\n      ctrlPaneHolder.parent().off('orientationchange.ctrlpane')\n         .on('orientationchange.ctrlpane', function() {\n            self._widget.requestElementReposition($(this));\n            self.positionFunctionKeys();\n         });\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * disconnect\n    *\n    *    Cleanup data and events for control pane dialog.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.dialogManager.prototype.disconnect = function() {\n      var ctrlPaneHolder = this.dialog;\n\n      // Turn off all events.\n      ctrlPaneHolder.find('#fnMasterKey').off('touchstart');\n      ctrlPaneHolder.find('.ab-extended-key').off('touchstart');\n      ctrlPaneHolder.find('.ab-flip').off('touchstart');\n\n      ctrlPaneHolder.parent().off('orientationchange.ctrlpane');\n\n      $('#fnKeyPad').find('.ab-extended-key').off('touchstart');\n\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    * getControlPaneHtml\n    *\n    *    Function to get the extended control keys layout.\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.extendedKeypad.prototype.getControlPaneHtml = function() {\n      var str =\n         '<div class=\"ctrl-pane flip-container\">\\\n            <div class=\"flipper\">\\\n               <div class=\"back\">\\\n                  <div class=\"ctrl-key-top-row ab-extended-key baseKey\" abkeycode=\"36\"><div>'\n                     + 'Home' + '</div></div>\\\n                  <div class=\"ctrl-key-top-row ab-extended-key baseKey\" abkeycode=\"38\">\\\n                     <img class=\"touch-sprite up-arrow\"/></div>\\\n                  <div class=\"ctrl-key-top-row ab-extended-key baseKey\" abkeycode=\"35\"><div>'\n                     + 'End' + '</div></div>\\\n                  <div class=\"ctrl-key-top-row ab-extended-key baseKey\" abkeycode=\"27\"><div>'\n                     + 'Esc' + '</div></div>\\\n                  <div class=\"ctrl-key-bottom-row ab-extended-key baseKey\" abkeycode=\"37\">\\\n                     <img class=\"touch-sprite left-arrow\"/></div>\\\n                  <div class=\"ctrl-key-bottom-row ab-extended-key baseKey\" abkeycode=\"40\">\\\n                     <img class=\"touch-sprite down-arrow\"/></div>\\\n                  <div class=\"ctrl-key-bottom-row ab-extended-key baseKey\" abkeycode=\"39\">\\\n                     <img class=\"touch-sprite right-arrow\"/></div>\\\n                  <div class=\"ctrl-key-bottom-row ab-flip baseKey\">\\\n                     <img class=\"touch-sprite more-keys\"/></div>\\\n               </div>\\\n               <div class=\"front\">\\\n                  <div class=\"ctrl-key-top-row ab-modifier-key baseKey\" abkeycode=\"16\"><div>'\n                     + 'Shift' + '</div></div>\\\n                  <div class=\"ctrl-key-top-row ab-extended-key baseKey\" abkeycode=\"46\"><div>'\n                     + 'Del' + '</div></div>\\\n                  <div class=\"ctrl-key-top-row ab-extended-key baseKey\" abkeycode=\"33\"><div>'\n                     + 'PgUp' + '</div></div>\\\n                  <div id=\"fnMasterKey\" class=\"ctrl-key-top-row baseKey\">\\\n                     <div style=\"letter-spacing: -1px\">'\n                     + 'F1-12' + '</div></div>\\\n                  <div class=\"ctrl-key-bottom-row ab-modifier-key baseKey\" abkeycode=\"17\"><div>'\n                     + 'Ctrl' + '</div></div>\\\n                  <div class=\"ctrl-key-bottom-row ab-modifier-key baseKey\" abkeycode=\"18\"><div>'\n                     + 'Alt' + '</div></div>\\\n                  <div class=\"ctrl-key-bottom-row ab-extended-key baseKey\" abkeycode=\"34\"><div>'\n                     + 'PgDn' + '</div></div>\\\n                  <div class=\"ctrl-key-bottom-row ab-flip baseKey\">\\\n                     <img class=\"touch-sprite more-keys\"/></div>\\\n               </div>\\\n            </div>\\\n         </div>';\n      return str;\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    * getFunctionKeyHtml\n    *\n    *    Function to get the extended functional keys layout.\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.extendedKeypad.prototype.getFunctionKeyHtml = function() {\n      var str =\n         '<div class=\"fnKey-pane-wrapper hide\" id=\"fnKeyPad\">\\\n             <div class=\"ctrl-pane\">\\\n                <div class=\"key-group up-position\">\\\n                  <div class=\"border-key-top-left\">\\\n                     <div class=\"fn-key-top-row ab-extended-key baseKey\" abkeycode=\"112\"><div>F1</div></div>\\\n                  </div>\\\n                  <div class=\"fn-key-top-row ab-extended-key baseKey\" abkeycode=\"113\"><div>F2</div></div>\\\n                  <div class=\"fn-key-top-row ab-extended-key baseKey\" abkeycode=\"114\"><div>F3</div></div>\\\n                  <div class=\"fn-key-top-row ab-extended-key baseKey\" abkeycode=\"115\"><div>F4</div></div>\\\n                  <div class=\"fn-key-top-row ab-extended-key baseKey\" abkeycode=\"116\"><div>F5</div></div>\\\n                  <div class=\"border-key-top-right\">\\\n                     <div class=\"fn-key-top-row ab-extended-key baseKey\" abkeycode=\"117\"><div>F6</div></div>\\\n                  </div>\\\n                  <div class=\"border-key-bottom-left\">\\\n                     <div class=\"fn-key-bottom-row ab-extended-key baseKey\" abkeycode=\"118\"><div>F7</div></div>\\\n                  </div>\\\n                  <div class=\"fn-key-bottom-row ab-extended-key baseKey\" abkeycode=\"119\"><div>F8</div></div>\\\n                  <div class=\"fn-key-bottom-row ab-extended-key baseKey\" abkeycode=\"120\"><div>F9</div></div>\\\n                  <div class=\"fn-key-bottom-row ab-extended-key baseKey\" abkeycode=\"121\"><div>F10</div></div>\\\n                  <div class=\"fn-key-bottom-row ab-extended-key baseKey\" abkeycode=\"122\"><div>F11</div></div>\\\n                  <div class=\"border-key-bottom-right\">\\\n                     <div class=\"fn-key-bottom-row ab-extended-key baseKey\" abkeycode=\"123\"><div>F12</div></div>\\\n                  </div>\\\n               </div>\\\n            </div>\\\n            <div class=\"fnKey-inner-border-helper\" id=\"fnKeyInnerBorder\"></div>\\\n         </div>';\n      return str;\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * toggleCtrlPane\n    *\n    *    Must be called after onDocumentReady. We go through all the objects in\n    *    the DOM with the keyboard icon classes, and bind them to listeners which\n    *    process them.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.extendedKeypad.prototype.toggleCtrlPane = function() {\n      var ctrlPane = this.dialog;\n      // Toggle ctrlPage widget.\n      if (ctrlPane.dialog('isOpen')) {\n         ctrlPane.dialog('close');\n      } else {\n         ctrlPane.dialog('open');\n      }\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * toggleFunctionKeys\n    *\n    *    Toggle the function key pad between show / hide. Upon show, position the\n    *    function keys to align with the ctrlPane. It also manages the\n    *    highlighting state for the function key master.\n    *    show - true indicates display function keys, false indicates otherwise.\n    *\n    *---------------------------------------------------------------------------\n    */\n   WMKS.extendedKeypad.prototype.toggleFunctionKeys = function(show) {\n      var fnKeyPad = $('#fnKeyPad');\n      var showFunctionKeys = (show || (typeof show === 'undefined' && !fnKeyPad.is(':visible')));\n\n      // Toggle the function key pad.\n      fnKeyPad.toggle(showFunctionKeys);\n\n      // Show / Hide the masterKey highlighting\n      $('#fnMasterKey').toggleClass('ab-modifier-key-down', showFunctionKeys);\n\n      // Position only if it should be shown.\n      this.positionFunctionKeys();\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * positionFunctionKeys\n    *\n    *    Position the function keys div relative to the ctrl pane. This function\n    *    is invoked upon orientation change or when the widget is shows.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.extendedKeypad.prototype.positionFunctionKeys = function() {\n      var fnKeys = $('#fnKeyPad'), crtlPaneWidget = $('#ctrlPaneWidget');\n      // Place the function key if it's now visible\n      if (fnKeys.is(':visible')) {\n         /*\n          * Align the bottom left corner of the function key pad\n          * with the top left corner of the control pane widget.\n          * If not enough room, flip to the other side.\n          */\n         fnKeys.position({\n            my:        'right bottom',\n            at:        'right top',\n            of:        crtlPaneWidget,\n            collision: 'flip'\n         });\n\n         // Adjust the inner border div size so it won't overlap with the outer border\n         $('#fnKeyInnerBorder').height(fnKeys.height()-2).width(fnKeys.width()-2);\n\n         // Check if the function key has been flipped. If so, use the down-style\n         var fnKeyBottom = fnKeys.offset().top + fnKeys.height();\n         var isAbove = (fnKeyBottom <= crtlPaneWidget.offset().top + crtlPaneWidget.height());\n         this.adjustFunctionKeyStyle(isAbove);\n\n         // Move the function key above the ctrl key pane when shown below, and under if shown above\n         var targetZOrder;\n         if (isAbove) {\n            targetZOrder =  parseInt(crtlPaneWidget.css('z-index'), 10) - 1;\n            // Use different color for the inner border depending on the position\n            $('#fnKeyInnerBorder').css('border-color', '#d5d5d5');\n         } else {\n            targetZOrder =  parseInt($('#ctrlPaneWidget').css('z-index'), 10) + 1;\n            $('#fnKeyInnerBorder').css('border-color', '#aaa');\n         }\n\n         fnKeys.css('z-index', targetZOrder.toString());\n      }\n      return true;\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * adjustFunctionKeyStyle\n    *\n    *    Helper function to adjust the functional key pad CSS based on the position\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.extendedKeypad.prototype.adjustFunctionKeyStyle = function (isAbove) {\n      var fnKeys = $('#fnKeyPad');\n      var keyGroup = fnKeys.find('.key-group');\n      if (isAbove) {\n         // Check if the \"down\" classes are being used. If so switch to \"up\" classes.\n         if (keyGroup.hasClass('down-position')) {\n            keyGroup.removeClass('down-position');\n            keyGroup.addClass('up-position');\n\n            fnKeys.removeClass('fnKey-pane-wrapper-down');\n            fnKeys.addClass('fnKey-pane-wrapper');\n         }\n      } else {\n         // Check if the \"up\" classes are being used. If so switch to \"down\" classes.\n         if (keyGroup.hasClass('up-position')) {\n            keyGroup.removeClass('up-position');\n            keyGroup.addClass('down-position');\n\n            fnKeys.removeClass('fnKey-pane-wrapper');\n            fnKeys.addClass('fnKey-pane-wrapper-down');\n         }\n      }\n   };\n\n}());/*\n *------------------------------------------------------------------------------\n *\n * wmks/trackpadManager.js\n *\n *   The controller of trackpad widget.\n *\n *------------------------------------------------------------------------------\n */\n\n(function() {\n   'use strict';\n\n   // Trackpad related constants.\n   WMKS.CONST.TRACKPAD = {\n      STATE: {\n         idle:         0,\n         tap:          1,\n         tap_2finger:  2,\n         drag:         3,\n         scroll:       4\n      }\n   };\n\n   WMKS.trackpadManager = function(widget, canvas) {\n\n      // Call constructor so dialogManager's params are included here.\n      WMKS.dialogManager.call(this);\n\n      this._widget = widget;\n      this._canvas = canvas;\n\n      // Initialize cursor state.\n      this._cursorPosGuest = {x : 0, y : 0};\n      // Timer\n      this._dragTimer = null;\n      // Dragging is started by long tap or not.\n      this._dragStartedByLongTap = false;\n      // Trackpad state machine.\n      this.state = WMKS.CONST.TRACKPAD.STATE.idle,\n      this.history = [];\n      // Override default options with options here.\n      $.extend(this.options,\n               {\n                  name: 'TRACKPAD',\n                  speedControlMinMovePx: 5,\n                  // Speed control for trackpad and two finger scroll\n                  accelerator:           10,\n                  minSpeed:              1,\n                  maxSpeed:              10\n               });\n      WMKS.LOGGER.warn('trackpad : ' + this.options.name);\n   };\n\n   WMKS.trackpadManager.prototype =  new WMKS.dialogManager();\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * getTrackpadHtml\n    *\n    *    Function to get the trackpad html layout.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.getTrackpadHtml = function() {\n      var str = '<div id=\"trackpad\" class=\"trackpad-container\">\\\n                   <div class=\"left-border\"></div>\\\n                   <div id=\"trackpadSurface\" class=\"touch-area\"></div>\\\n                   <div class=\"right-border\"></div>\\\n                   <div class=\"bottom-border\">\\\n                      <div class=\"button-container\">\\\n                         <div id=\"trackpadLeft\" class=\"button-left\"></div>\\\n                         <div id=\"trackpadRight\" class=\"button-right\"></div>\\\n                      </div>\\\n                   </div>\\\n               </div>';\n\n      return str;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * create\n    *\n    *    This function initializes the trackpad dialog, toggle highlighting on close\n    *    handler.\n    *\n    * HACK\n    *    There is no easy way to determine close by menu click vs clicking close\n    *    icon. Hence using the event.target to determine it was from clicking\n    *    close icon. It will not work well when closeOnEscape is true. We don't\n    *    need this on ipad, so its good.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.create = function() {\n      var dialog,\n          self = this;\n\n      if (!this._widget ||\n          !this._canvas) {\n         WMKS.LOGGER.debug('Trackpad dialog creation has been aborted. Widget or Canvas is not ready.');\n         return null;\n      }\n\n      dialog = $(this.getTrackpadHtml());\n      dialog.dialog({\n         autoOpen: false,\n         closeOnEscape: true,\n         resizable: false,\n         position: {my: 'center', at: 'center', of: this._canvas},\n         zIndex: 1000,\n         draggable: true,\n         dialogClass: 'trackpad-wrapper',\n         close: function(e) {\n            self.sendUpdatedState(false);\n         },\n         create: function(e) {\n            self.layout($(this).parent());\n         }\n      });\n\n      return dialog;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * init\n    *\n    *    This function initializes the event handlers for the trackpad.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.init = function() {\n      var dialog = this.dialog,\n          self = this,\n          trackpad,\n          left,\n          right;\n\n      if (!dialog) {\n         WMKS.LOGGER.debug('Trackpad init aborted. Dialog is not created successfully.');\n         return;\n      }\n\n      // Request reposition of trackpad dialog upon orientation changes.\n      this._widget.requestElementReposition(dialog.parent(), true);\n\n      // Initialize event handlers for the trackpad.\n      trackpad = dialog\n         .find('#trackpadSurface')\n         .on('touchstart', function(e) {\n            return self.trackpadTouchStart(e.originalEvent);\n         })\n         .on('touchmove', function(e) {\n            return self.trackpadTouchMove(e.originalEvent);\n         })\n         .on('touchend', function(e) {\n            return self.trackpadTouchEnd(e.originalEvent);\n         });\n\n      left = dialog\n         .find('#trackpadLeft')\n         .on('touchstart', function(e) {\n            return self.trackpadClickStart(e, WMKS.CONST.CLICK.left);\n         })\n         .on('touchend', function(e) {\n            return self.trackpadClickEnd(e, WMKS.CONST.CLICK.left);\n         });\n\n      right = dialog\n         .find('#trackpadRight')\n         .on('touchstart', function(e) {\n            return self.trackpadClickStart(e, WMKS.CONST.CLICK.right);\n         })\n         .on('touchend', function(e) {\n            return self.trackpadClickEnd(e, WMKS.CONST.CLICK.right);\n         });\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * disconnect\n    *\n    *    This function unbinds the event handlers for the trackpad.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.disconnect = function() {\n      var dialog = this.dialog,\n          trackpad,\n          left,\n          right;\n\n      if (!dialog) {\n         return;\n      }\n\n      // Unregister event handlers for the trackpad.\n      trackpad = dialog\n         .find('#trackpadSurface')\n         .off('touchmove')\n         .off('touchstart')\n         .off('touchend');\n\n      left = dialog\n         .find('#trackpadLeft')\n         .off('touchstart')\n         .off('touchend');\n\n      right = dialog\n         .find('#trackpadRight')\n         .off('touchstart')\n         .off('touchend');\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * layout\n    *\n    *    Reposition the dialog in order to center it to the canvas.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.layout = function(dialog) {\n      var canvas = this._canvas,\n          dialogParent,\n          canvasParent;\n\n      if (!dialog ||\n          !canvas) {\n         return;\n      }\n\n      dialogParent = dialog.parent();\n      canvasParent = canvas.parent();\n\n      if (dialogParent !== canvasParent) {\n         // Append the dialog to the parent of the canvas,\n         // so that it's able to center the dialog to the canvas.\n         canvasParent.append(dialog);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * trackpadClickStart\n    *\n    *    Fires when either one of the virtual trackpad's buttons are clicked. Sends\n    *    a mousedown operation and adds the button highlight.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.trackpadClickStart = function(e, buttonClick) {\n      if (buttonClick !== WMKS.CONST.CLICK.left &&\n          buttonClick !== WMKS.CONST.CLICK.right) {\n         WMKS.LOGGER.debug('assert: unknown button ' + buttonClick);\n         return false;\n      }\n\n      // Highlight click button.\n      $(e.target).addClass('button-highlight');\n\n      // Sends a mousedown message.\n      this._widget.sendMouseButtonMessage(this.getMousePosition(), true, buttonClick);\n      return false;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * trackpadClickEnd\n    *\n    *    Fires when either one of the virtual trackpad's buttons are released.\n    *    Sends a mouseup operation and removes the highlight on the button.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.trackpadClickEnd = function(e, buttonClick) {\n      if (buttonClick !== WMKS.CONST.CLICK.left &&\n          buttonClick !== WMKS.CONST.CLICK.right) {\n         WMKS.LOGGER.debug('assert: unknown button ' + buttonClick);\n         return false;\n      }\n\n      // Remove highlight.\n      $(e.target).removeClass('button-highlight');\n\n      // Sends a mouseup message.\n      this._widget.sendMouseButtonMessage(this.getMousePosition(), false, buttonClick);\n      return false;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * computeMovingDistance\n    *\n    *    Based on a current point and point history, gets the amount of distance\n    *    the mouse should move based on this data.\n    *\n    * Results:\n    *    A 2-tuple of (dx, dy)\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.computeMovingDistance = function(x, y) {\n      var dx, dy, dist, speed;\n\n      dx = this.getTrackpadSpeed(x,\n         this.history[0].x,\n         this.history[1].x,\n         this.history[2].x);\n      dy = this.getTrackpadSpeed(y,\n         this.history[0].y,\n         this.history[1].y,\n         this.history[2].y);\n\n      dist = WMKS.UTIL.getLineLength(dx, dy);\n\n      speed = dist * this.options.accelerator;\n      if (speed > this.options.maxSpeed) {\n         speed = this.options.maxSpeed;\n      } else if (speed < this.options.minSpeed) {\n         speed = this.options.minSpeed;\n      }\n\n      return [dx * speed, dy * speed];\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * getTrackpadSpeed\n    *\n    *    Performs a linear least squares operation to get the slope of the line\n    *    that best fits all four points. This slope is the current speed of the\n    *    trackpad, assuming equal time between samples.\n    *\n    *    Returns the speed as a floating point number.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.getTrackpadSpeed = function(x0, x1, x2, x3) {\n      return x0 * 0.3 + x1 * 0.1 - x2 * 0.1 - x3 * 0.3;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * trackpadTouchStart\n    *\n    *    Fires when a finger lands on the trackpad's touch area. Depending on the\n    *    number of touch fingers, assign the initial tap state. Subsequently\n    *    ontouchmove event we promote tap --> drag, tap_2finger --> scroll.\n    *    If the state was tap / tap_2finger, then its the default click event.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.trackpadTouchStart = function(e) {\n      var self = this;\n\n      if (e.targetTouches.length > 2) {\n         // Dis-allow a third finger touchstart to reset scroll state.\n         if (this.state === WMKS.CONST.TRACKPAD.STATE.scroll) {\n            WMKS.LOGGER.debug('Ignore new touchstart, currently scrolling, touch#: '\n               + e.targetTouches.length);\n         } else {\n            WMKS.LOGGER.debug('Aborting touch, too many fingers #: ' + e.targetTouches.length);\n            this.resetTrackpadState();\n         }\n      } else if (e.targetTouches.length === 2) {\n         // Could be a scroll. Store first finger location.\n         this.state = WMKS.CONST.TRACKPAD.STATE.tap_2finger;\n      } else {\n         this.state = WMKS.CONST.TRACKPAD.STATE.tap;\n\n         // ontouchmove destroys this timer. The finger must stay put.\n         if (this._dragTimer !== null) {\n            clearTimeout(this._dragTimer);\n            this._dragTimer = null;\n         }\n\n         this._dragTimer = setTimeout(function() {\n            self._dragTimer = null;\n\n            // Send the left mousedown at the location.\n            self._widget.sendMouseButtonMessage(self.getMousePosition(), true, WMKS.CONST.CLICK.left);\n            self._dragStartedByLongTap = true;\n         }, WMKS.CONST.TOUCH.leftDragDelayMs);\n      }\n      return false;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * trackpadTouchMove\n    *\n    *    Fires when a finger moves within the trackpad's touch area. If the touch\n    *    action is currently marked as a tap, promotes it into a drag or\n    *    if it was a tap_2finger, promote to a scroll. If it is already one or\n    *    the other, stick to that type.\n    *\n    *    However, if the touch moves outside the area while dragging, then set the\n    *    state back to the tap and clear up history in case user comes back into\n    *    the hot region.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.trackpadTouchMove = function(e) {\n      var pX, pY, newLocation,\n          self = $(e.target),\n          widget = this._widget;\n\n      // Reset the drag timer if there is one.\n      if (this._dragTimer !== null) {\n         clearTimeout(this._dragTimer);\n         this._dragTimer = null;\n      }\n\n      if (this.state === WMKS.CONST.TRACKPAD.STATE.idle) {\n         return false;\n      }\n\n      pX = e.targetTouches[0].pageX;\n      pY = e.targetTouches[0].pageY;\n      // Verify if the touchmove is outside business (hot) region of trackpad.\n      if (pY < self.offset().top || pY > (self.offset().top + self.height()) ||\n            pX < self.offset().left || pX > (self.offset().left + self.width())) {\n         // Reset to tap start state, as the user went outside the business region.\n         if (this.state === WMKS.CONST.TRACKPAD.STATE.drag) {\n            // Send mouse up event if drag is started by long tap.\n            if (this._dragStartedByLongTap) {\n               widget.sendMouseButtonMessage(this.getMousePosition(), false, WMKS.CONST.CLICK.left);\n            }\n            this.state = WMKS.CONST.TRACKPAD.STATE.tap;\n            this.history.length = 0;\n         }\n         return false;\n      }\n\n      if (this.state === WMKS.CONST.TRACKPAD.STATE.drag) {\n         newLocation = this.computeNewCursorLocation(pX, pY);\n\n         // Perform the actual move update by sending the corresponding message.\n         if (!!widget._touchHandler) {\n            widget._touchHandler.moveCursor(newLocation.x, newLocation.y);\n         }\n         widget.sendMouseMoveMessage(newLocation);\n         // WMKS.LOGGER.debug('new loc: ' + newLocation.x + ',' + newLocation.y);\n\n         // Make room for a new history entry\n         this.history.shift();\n\n         // Push a new history entry\n         this.history.push({x: pX, y: pY });\n      } else if (this.state === WMKS.CONST.TRACKPAD.STATE.scroll) {\n         // Sends the mouse scroll message.\n         this.sendScrollMessageFromTrackpad(e.targetTouches[0]);\n      }\n\n      // Detect if this is a drag or a scroll. If so, add a history entry.\n      if (this.state === WMKS.CONST.TRACKPAD.STATE.tap) {\n         this.state = WMKS.CONST.TRACKPAD.STATE.drag;\n         // Make up history based on the current point if there isn't any yet.\n         this.history.push({x: pX, y: pY}, {x: pX, y: pY}, {x: pX, y: pY});\n      } else if (this.state === WMKS.CONST.TRACKPAD.STATE.tap_2finger\n            && e.targetTouches.length === 2) {\n         this.state = WMKS.CONST.TRACKPAD.STATE.scroll;\n         // Create a history entry based on the current point if there isn't any yet.\n         this.history[0] = {x: pX, y: pY};\n      }\n      return false;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * computeNewCursorLocation\n    *\n    *    This function takes the new location and computes the destination mouse\n    *    cursor location. The computation is based on the acceleration to be used,\n    *    making sure the new location is within the screen area.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.computeNewCursorLocation = function(pX, pY) {\n      var dist,\n          point = this.getMousePosition();\n\n      // First compute the distance from the last location.\n      dist = WMKS.UTIL.getLineLength(\n         (pX - this.history[2].x), (pY - this.history[2].y));\n      if (isNaN(dist) || dist === 0) {\n         // There is no change, return the old location.\n         return point;\n      } else if (dist < this.options.speedControlMinMovePx) {\n         // The cursor has only moved a few pixels, apply the delta directly.\n         point.x += (pX - this.history[2].x);\n         point.y += (pY - this.history[2].y);\n      } else {\n         // From now on, though, use device pixels (later, compensate for hi-DPI)\n         dist = this.computeMovingDistance(pX, pY);\n         point.x += Math.floor(dist[0]);\n         point.y += Math.floor(dist[1]);\n      }\n\n      return this._widget.getCanvasPosition(point.x, point.y);\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * trackpadTouchEnd\n    *\n    *    Fires when a finger lifts off the trackpad's touch area. If the touch\n    *    action is currently marked as a tap, sends off the mousedown and mouseup\n    *    operations. Otherwise, simply resets the touch state machine.\n    *\n    * Results:\n    *    Always false (preventing default behavior.)\n    *\n    * Side Effects:\n    *    None.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.trackpadTouchEnd = function(e) {\n      var pos;\n\n      // Reset the drag timer if there is one.\n      if (this._dragTimer !== null) {\n         clearTimeout(this._dragTimer);\n         this._dragTimer = null;\n      }\n\n      if (e.targetTouches.length !== 0 ||\n            this.state === WMKS.CONST.TRACKPAD.STATE.idle) {\n         return false;\n      }\n\n      pos = this.getMousePosition();\n      if (this.state === WMKS.CONST.TRACKPAD.STATE.tap) {\n         // Send mousedown & mouseup together\n         this._widget.sendMouseButtonMessage(pos, true, WMKS.CONST.CLICK.left);\n         this._widget.sendMouseButtonMessage(pos, false, WMKS.CONST.CLICK.left);\n      } else if (this.state === WMKS.CONST.TRACKPAD.STATE.tap_2finger) {\n         // Send right-click's mousedown & mouseup together.\n         this._widget.sendMouseButtonMessage(pos, true, WMKS.CONST.CLICK.right);\n         this._widget.sendMouseButtonMessage(pos, false, WMKS.CONST.CLICK.right);\n      } else if (this.state === WMKS.CONST.TRACKPAD.STATE.drag && this._dragStartedByLongTap) {\n         this._widget.sendMouseButtonMessage(pos, false, WMKS.CONST.CLICK.left);\n      }\n\n      this.resetTrackpadState();\n      return false;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * resetTrackpadState\n    *\n    *    Resets the virtual trackpad's state machine.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.resetTrackpadState = function() {\n      this.state = WMKS.CONST.TRACKPAD.STATE.idle;\n      this.history.length = 0;\n      this._dragStartedByLongTap = false\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * sendScrollMessageFromTrackpad\n    *\n    *    This function is similar to the sendScrollEventMessage() used for scrolling\n    *    outside the trackpad. The state machine is managed differently and hence\n    *    the separate function.\n    *\n    *    Check if the scroll distance is above the minimum threshold, if so, send\n    *    the scroll. And upon sending it, update the history with the last scroll\n    *    sent location.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.sendScrollMessageFromTrackpad = function(curLocation) {\n      // This is a two finger scroll, are we going up or down?\n      var dx = 0,\n          dy = 0,\n          deltaX,\n          deltaY,\n          wheelDeltas,\n          firstPos;\n\n      deltaX = curLocation.pageX - this.history[0].x;\n      deltaY = curLocation.pageY - this.history[0].y;\n\n      if (!!this._widget._touchHandler) {\n         wheelDeltas = this._widget._touchHandler._calculateMouseWheelDeltas(deltaX, deltaY);\n         dx = wheelDeltas.wheelDeltaX;\n         dy = wheelDeltas.wheelDeltaY;\n      }\n\n      // Only send if at least one of the deltas has a value.\n      if (dx !== 0 || dy !== 0) {\n         this._widget.sendScrollMessage(this.getMousePosition(), dx, dy);\n\n         if (dx !== 0) {\n            this.history[0].x = curLocation.pageX;\n         }\n\n         if (dy !== 0) {\n            this.history[0].y = curLocation.pageY;\n         }\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * getMousePosition\n    *\n    *    Get the current position of the mouse cursor.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.trackpadManager.prototype.getMousePosition = function() {\n      var pos = this._widget._mousePosGuest;\n\n      if (pos.x === 0 && pos.y === 0) {\n         // If mouse position is not specified, the current cursor position is used.\n         if (this._cursorPosGuest.x !== pos.x || this._cursorPosGuest.y !== pos.y) {\n            // Send mousemove message and update state.\n            pos = this._cursorPosGuest;\n            this._widget.sendMouseMoveMessage(pos);\n         }\n      } else {\n         // Mark current cursor position.\n         this._cursorPosGuest = pos;\n      }\n\n      return pos;\n   };\n\n}());\n'use strict';\n\n/*\n * wmks/packet.js\n *\n *   A useful class for reading and writing binary data to and from a Uint8Array\n *\n */\n\n/**\n * Use {@link Packet#createNewPacket} or {@link Packet#createFromBuffer}.\n * to create a new Packet.\n *\n * @classdesc A packet is a Uint8Array of binary data!\n *\n * @constructor\n * @private\n * @param {Uint8Array} buffer The buffer.\n * @param {Number}     length The length of data in the buffer.\n * @param {WMKS.Packet.BYTE_ORDER} [byteOrder] Byte order of words in buffer.\n  */\nWMKS.Packet = function(buffer, length, byteOrder) {\n   /**\n    * The length of the packet.\n    * @type {Number}\n    */\n   this.length = length;\n\n   /**\n    * The internal buffer.\n    * @private\n    * @type {Uint8Array}\n    */\n   this._buffer = buffer;\n\n   /**\n    * The current read position of the buffer.\n    * @private\n    * @type {Number}\n    */\n   this._readPosition = 0;\n\n   /**\n    * The byte order of words in the buffer.\n    * @private\n    * @type {Number}\n    */\n   this._byteOrder = byteOrder || WMKS.Packet.BYTE_ORDER.NETWORK_ORDER;\n\n   if (this._byteOrder == WMKS.Packet.BYTE_ORDER.LITTLE_ENDIAN) {\n      this.setInt16 = this.setInt16le;\n      this.setInt32 = this.setInt32le;\n      this.setUint16 = this.setUint16le;\n      this.setUint32 = this.setUint32le;\n      this.getInt16 = this.getInt16le;\n      this.getInt32 = this.getInt32le;\n      this.getUint16 = this.getUint16le;\n      this.getUint32 = this.getUint32le;\n   } else if (this._byteOrder == WMKS.Packet.BYTE_ORDER.BIG_ENDIAN) {\n      this.setInt16 = this.setInt16be;\n      this.setInt32 = this.setInt32be;\n      this.setUint16 = this.setUint16be;\n      this.setUint32 = this.setUint32be;\n      this.getInt16 = this.getInt16be;\n      this.getInt32 = this.getInt32be;\n      this.getUint16 = this.getUint16be;\n      this.getUint32 = this.getUint32be;\n   }\n};\n\n\n/**\n * Byte order of words in a packet.\n * @enum {Number}\n * @readonly\n */\nWMKS.Packet.BYTE_ORDER = {\n   LITTLE_ENDIAN: 1,\n   BIG_ENDIAN: 2,\n   NETWORK_ORDER: 2\n};\n\n\n/**\n * Create a new packet and allocates a fixed size buffer.\n *\n * @param {Number} [size=512] Size of the buffer\n * @param {WMKS.Packet.BYTE_ORDER} [byteOrder] Byte order of words in buffer.\n */\nWMKS.Packet.createNewPacket = function(size, byteOrder)\n{\n   size = size || 512;\n   return new WMKS.Packet(new Uint8Array(size), 0, byteOrder);\n};\n\n\n/**\n * Create a new packet with the provided buffer.\n * Intended to be used for reading data out of a Uint8Array.\n *\n * @param {Uint8Array|ArrayBuffer} buffer Buffer to use.\n * @param {WMKS.Packet.BYTE_ORDER} [byteOrder] Byte order of words in buffer.\n */\nWMKS.Packet.createFromBuffer = function(buffer, byteOrder)\n{\n   if (buffer instanceof ArrayBuffer) {\n      buffer = new Uint8Array(buffer);\n   } else if (!(buffer instanceof Uint8Array)) {\n      return null;\n   }\n\n   return new WMKS.Packet(buffer, buffer.length, byteOrder);\n};\n\n\n/**\n * Create a new big endian packet and allocates a fixed size buffer.\n *\n * @param {Number} [size=512] Size of the buffer\n */\nWMKS.Packet.createNewPacketBE = function(size)\n{\n   return WMKS.Packet.createNewPacket(size, WMKS.Packet.BYTE_ORDER.BIG_ENDIAN);\n};\n\n\n/**\n * Create a new little endian packet and allocates a fixed size buffer.\n *\n * @param {Number} [size=512] Size of the buffer\n */\nWMKS.Packet.createNewPacketLE = function(size)\n{\n   return WMKS.Packet.createNewPacket(size, WMKS.Packet.BYTE_ORDER.LITTLE_ENDIAN);\n};\n\n\n/**\n * Create a new big endian packet with the provided buffer.\n * Intended to be used for reading data out of a Uint8Array.\n *\n * @param {Uint8Array|ArrayBuffer} buffer Buffer to use.\n */\nWMKS.Packet.createFromBufferBE = function(buffer)\n{\n   return WMKS.Packet.createFromBuffer(buffer, WMKS.Packet.BYTE_ORDER.BIG_ENDIAN);\n};\n\n\n/**\n * Create a new little endian packet with the provided buffer.\n * Intended to be used for reading data out of a Uint8Array.\n *\n * @param {Uint8Array|ArrayBuffer} buffer Buffer to use.\n */\nWMKS.Packet.createFromBufferLE = function(buffer)\n{\n   return WMKS.Packet.createFromBuffer(buffer, WMKS.Packet.BYTE_ORDER.LITTLE_ENDIAN);\n};\n\n\n/**\n * Resets the packet write length and read position.\n * Does not reallocate the buffer.\n */\nWMKS.Packet.prototype.reset = function()\n{\n   this.length = 0;\n   this._readPosition = 0;\n};\n\n\n/**\n * Get an Uint8Array representing the whole packets content, returns only the\n * written data and not the whole buffer.\n *\n * @return {Uint8Array} The packet's data\n */\n\nWMKS.Packet.prototype.getData = function()\n{\n   return this._buffer.subarray(0, this.length);\n};\n\n\n/**\n * Returns the amount of bytes left available for reading.\n *\n * @return {Number} The number of bytes left to read.\n */\nWMKS.Packet.prototype.bytesRemaining = function()\n{\n   return this.length - this._readPosition;\n}\n\n/**\n * Get an ArrayBuffer representing the whole packets content, returns only the\n * written data and not the whole buffer.\n *\n * @return {ArrayBuffer} The packet's data\n */\n\nWMKS.Packet.prototype.getDataAsArrayBuffer = function()\n{\n   return this._buffer.buffer.slice(this._buffer.byteOffset,\n                                    this._buffer.byteOffset + this.length);\n};\n\n\n/**\n * Writes an 8 bit unsigned integer value to the end of the packet.\n *\n * @param {Number} value Value\n */\nWMKS.Packet.prototype.writeUint8 = function(value)\n{\n   this._ensureWriteableBytes(1);\n   this.setUint8(this.length, value);\n   this.length += 1;\n};\n\n\n/**\n * Writes a 16 bit unsigned integer value to the end of the packet.\n *\n * @param {Number} value Value\n */\nWMKS.Packet.prototype.writeUint16 = function(value)\n{\n   this._ensureWriteableBytes(2);\n   this.setUint16(this.length, value);\n   this.length += 2;\n};\n\n\n/**\n * Writes a 32 bit unsigned integer value to the end of the packet.\n *\n * @param {Number} value Value\n */\nWMKS.Packet.prototype.writeUint32 = function(value)\n{\n   this._ensureWriteableBytes(4);\n   this.setUint32(this.length, value);\n   this.length += 4;\n};\n\n\n/**\n * Writes a 8 bit signed integer value to the end of the packet.\n *\n * @param {Number} value Value\n */\nWMKS.Packet.prototype.writeInt8 = function(value)\n{\n   this._ensureWriteableBytes(1);\n   this.setInt8(this.length, value);\n   this.length += 1;\n};\n\n\n/**\n * Writes a 16 bit signed integer value to the end of the packet.\n *\n * @param {Number} value Value\n */\nWMKS.Packet.prototype.writeInt16 = function(value)\n{\n   this._ensureWriteableBytes(2);\n   this.setInt16(this.length, value);\n   this.length += 2;\n};\n\n\n/**\n * Writes a 32 bit signed integer value to the end of the packet.\n *\n * @param {Number} value Value\n */\nWMKS.Packet.prototype.writeInt32 = function(value)\n{\n   this._ensureWriteableBytes(4);\n   this.setInt32(this.length, value);\n   this.length += 4;\n};\n\n\n/**\n * Writes a string to the end of the packet in ASCII format.\n *\n * @param {String} value Value\n */\nWMKS.Packet.prototype.writeStringASCII = function(value)\n{\n   var i;\n   this._ensureWriteableBytes(value.length);\n\n   for (i = 0; i < value.length; ++i) {\n      this.setUint8(this.length++, value.charCodeAt(i));\n   }\n};\n\n\n/**\n * Writes a byte array to the end of the packet.\n *\n * @param {Uint8Array} value Value\n */\nWMKS.Packet.prototype.writeArray = function(value)\n{\n   if (value && value.length) {\n      this._ensureWriteableBytes(value.length);\n      this._buffer.set(value, this.length);\n      this.length += value.length;\n   }\n};\n\n\n/**\n * Reads a 8 bit value from the current read position.\n * Increases the read position by 1 byte.\n *\n * @return {Number} Value\n */\nWMKS.Packet.prototype.readUint8 = function()\n{\n   var value;\n\n   if (this._checkReadableBytes(1)) {\n      value = this.getUint8(this._readPosition);\n      this._readPosition += 1;\n   }\n\n   return value;\n};\n\n\n/**\n * Reads a 16 bit value from the current read position.\n * Increases the read position by 2 bytes.\n *\n * @return {Number} Value\n */\nWMKS.Packet.prototype.readUint16 = function()\n{\n   var value;\n\n   if (this._checkReadableBytes(2)) {\n      value = this.getUint16(this._readPosition);\n      this._readPosition += 2;\n   }\n\n   return value;\n};\n\n\n/**\n * Reads a 32 bit value from the current read position.\n * Increases the read position by 4 bytes.\n *\n * @return {Number} Value\n */\nWMKS.Packet.prototype.readUint32 = function()\n{\n   var value;\n\n   if (this._checkReadableBytes(4)) {\n      value = this.getUint32(this._readPosition);\n      this._readPosition += 4;\n   }\n\n   return value;\n};\n\n\n/**\n * Reads a 8 bit signed value from the current read position.\n * Increases the read position by 1 byte.\n *\n * @return {Number} Value\n */\nWMKS.Packet.prototype.readInt8 = function()\n{\n   var value;\n\n   if (this._checkReadableBytes(1)) {\n      value = this.getInt8(this._readPosition);\n      this._readPosition += 1;\n   }\n\n   return value;\n};\n\n\n/**\n * Reads a 16 bit signed value from the current read position.\n * Increases the read position by 2 bytes.\n *\n * @return {Number} Value\n */\nWMKS.Packet.prototype.readInt16 = function()\n{\n   var value;\n\n   if (this._checkReadableBytes(2)) {\n      value = this.getInt16(this._readPosition);\n      this._readPosition += 2;\n   }\n\n   return value;\n};\n\n\n/**\n * Reads a 32 bit signed value from the current read position.\n * Increases the read position by 4 bytes.\n *\n * @return {Number} Value\n */\nWMKS.Packet.prototype.readInt32 = function()\n{\n   var value;\n\n   if (this._checkReadableBytes(4)) {\n      value = this.getInt32(this._readPosition);\n      this._readPosition += 4;\n   }\n\n   return value;\n};\n\n\n/**\n * Reads a byte array from the current read position.\n * Increases the read position by length.\n *\n * @param  {Number}      length Length of the array to read in bytes.\n * @return {Uint8Array?}        Array\n */\nWMKS.Packet.prototype.readArray = function(length)\n{\n   var value;\n\n   if (this._checkReadableBytes(length)) {\n      if (length === 0) {\n         value = null;\n      } else {\n         value = this.getArray(this._readPosition, length);\n         this._readPosition += length;\n      }\n   }\n\n   return value;\n};\n\n\n/**\n * Reads an ASCII string from the current read position.\n * Increases the read position by length.\n *\n * @param  {Number} length Length of the string to read in bytes.\n * @return {String}        String\n */\nWMKS.Packet.prototype.readStringASCII = function(length)\n{\n   var value = this.readArray(length);\n\n   if (value) {\n      value = String.fromCharCode.apply(String, value);\n   }\n\n   return value;\n};\n\n\n/**\n * Sets a 8 bit unsigned integer value at a specified position.\n *\n * @param {Number} position Position in bytes\n * @param {Number} value    Value\n */\nWMKS.Packet.prototype.setUint8 = function(position, value)\n{\n   this._buffer[position] = value & 0xff;\n};\n\n\n/**\n * Sets a 16 bit big endian unsigned integer value at a specified position.\n *\n * @param {Number} position Position in bytes\n * @param {Number} value    Value\n */\nWMKS.Packet.prototype.setUint16be = function(position, value)\n{\n   this._buffer[position + 1] = value & 0xff;\n   this._buffer[position + 0] = (value >> 8) & 0xff;\n};\n\n\n/**\n * Sets a 32 bit big endian unsigned integer value at a specified position.\n *\n * @param {Number} position Position in bytes\n * @param {Number} value    Value\n */\nWMKS.Packet.prototype.setUint32be = function(position, value)\n{\n   this._buffer[position + 3] = value & 0xff;\n   this._buffer[position + 2] = (value >> 8) & 0xff;\n   this._buffer[position + 1] = (value >> 16) & 0xff;\n   this._buffer[position + 0] = (value >> 24) & 0xff;\n};\n\n\n/**\n * Sets a 16 bit little endian unsigned integer value at a specified position.\n *\n * @param {Number} position Position in bytes\n * @param {Number} value    Value\n */\nWMKS.Packet.prototype.setUint16le = function(position, value)\n{\n   this._buffer[position + 0] = value & 0xff;\n   this._buffer[position + 1] = (value >> 8) & 0xff;\n};\n\n\n/**\n * Sets a 32 bit little endian unsigned integer value at a specified position.\n *\n * @param {Number} position Position in bytes\n * @param {Number} value    Value\n */\nWMKS.Packet.prototype.setUint32le = function(position, value)\n{\n   this._buffer[position + 0] = value & 0xff;\n   this._buffer[position + 1] = (value >> 8) & 0xff;\n   this._buffer[position + 2] = (value >> 16) & 0xff;\n   this._buffer[position + 3] = (value >> 24) & 0xff;\n};\n\n\n/*\n * Due to how the javascript bitwise operators convert Numbers for writing\n * values we can use the same operation for signed and unsigned integers.\n */\n\n/**\n * Sets a 8 bit signed integer value at a specified position.\n *\n * @param {Number} position Position in bytes\n * @param {Number} value    Value\n */\nWMKS.Packet.prototype.setInt8 = function(position, value)\n{\n   return this.setUint8(position, value);\n};\n\n\n/**\n * Sets a 16 bit big endian signed integer value at a specified position.\n *\n * @param {Number} position Position in bytes\n * @param {Number} value    Value\n */\nWMKS.Packet.prototype.setInt16be = function(position, value)\n{\n   return this.setUint16be(position, value);\n};\n\n\n/**\n * Sets a 32 bit big endian signed integer value at a specified position.\n *\n * @param {Number} position Position in bytes\n * @param {Number} value    Value\n */\nWMKS.Packet.prototype.setInt32be = function(position, value)\n{\n   return this.setUint32be(position, value);\n};\n\n\n/**\n * Sets a 16 bit little endian signed integer value at a specified position.\n *\n * @param {Number} position Position in bytes\n * @param {Number} value    Value\n */\nWMKS.Packet.prototype.setInt16le = function(position, value)\n{\n   return this.setUint16le(position, value);\n};\n\n\n/**\n * Sets a 32 bit little endian signed integer value at a specified position.\n *\n * @param {Number} position Position in bytes\n * @param {Number} value    Value\n */\nWMKS.Packet.prototype.setInt32le = function(position, value)\n{\n   return this.setUint32le(position, value);\n};\n\n\n/**\n * Gets a subarray view from the buffer.\n *\n * @param  {Number}     start  Position in bytes\n * @param  {Number}     length Length in bytes\n * @return {Uint8Array}        The subarray\n */\nWMKS.Packet.prototype.getArray = function(start, length)\n{\n   return this._buffer.subarray(start, start + length);\n};\n\n\n/**\n * Gets a 8 bit unsigned integer value from a position.\n *\n * @param  {Number} position Position in bytes\n * @return {Number}          Value\n */\nWMKS.Packet.prototype.getInt8 = function(position)\n{\n   var value = this._buffer[position];\n\n   if (value & 0x80) {\n      value = value - 0xff - 1;\n   }\n\n   return value;\n};\n\n\n/**\n * Gets a 16 bit big endian signed integer value from a position.\n *\n * @param  {Number} position Position in bytes\n * @return {Number}          Value\n */\nWMKS.Packet.prototype.getInt16be = function(position)\n{\n   var value;\n   value  = this._buffer[position + 1];\n   value |= this._buffer[position + 0] << 8;\n\n   if (value & 0x8000) {\n      value = value - 0xffff - 1;\n   }\n\n   return value;\n};\n\n\n/**\n * Gets a 32 bit big endian signed integer value from a position.\n *\n * @param  {Number} position Position in bytes\n * @return {Number}          Value\n */\nWMKS.Packet.prototype.getInt32be = function(position)\n{\n   var value;\n   value  = this._buffer[position + 3];\n   value |= this._buffer[position + 2] << 8;\n   value |= this._buffer[position + 1] << 16;\n   value |= this._buffer[position + 0] << 24;\n   return value;\n};\n\n\n/**\n * Gets a 16 bit little endian signed integer value from a position.\n *\n * @param  {Number} position Position in bytes\n * @return {Number}          Value\n */\nWMKS.Packet.prototype.getInt16le = function(position)\n{\n   var value;\n   value  = this._buffer[position + 0];\n   value |= this._buffer[position + 1] << 8;\n\n   if (value & 0x8000) {\n      value = value - 0xffff - 1;\n   }\n\n   return value;\n};\n\n\n/**\n * Gets a 32 bit little endian signed integer value from a position.\n *\n * @param  {Number} position Position in bytes\n * @return {Number}          Value\n */\nWMKS.Packet.prototype.getInt32le = function(position)\n{\n   var value;\n   value  = this._buffer[position + 0];\n   value |= this._buffer[position + 1] << 8;\n   value |= this._buffer[position + 2] << 16;\n   value |= this._buffer[position + 3] << 24;\n   return value;\n};\n\n\n/**\n * Gets a 8 bit unsigned integer value from a position.\n *\n * @param  {Number} position Position in bytes\n * @return {Number}          Value\n */\nWMKS.Packet.prototype.getUint8 = function(position)\n{\n   var value = this._buffer[position];\n   return value;\n};\n\n\n/**\n * Gets a 16 bit big endian unsigned integer value from a position.\n *\n * @param  {Number} position Position in bytes\n * @return {Number}          Value\n */\nWMKS.Packet.prototype.getUint16be = function(position)\n{\n   var value;\n   value  = this._buffer[position + 1];\n   value |= this._buffer[position + 0] << 8;\n   return value;\n};\n\n\n/**\n * Gets a 32 bit big endian unsigned integer value from a position.\n *\n * @param  {Number} position Position in bytes\n * @return {Number}          Value\n */\nWMKS.Packet.prototype.getUint32be = function(position)\n{\n   var value;\n   value  = this._buffer[position + 3];\n   value |= this._buffer[position + 2] << 8;\n   value |= this._buffer[position + 1] << 16;\n   value |= this._buffer[position + 0] << 24;\n\n   if (value < 0) {\n      value = 0xffffffff + value + 1;\n   }\n\n   return value;\n};\n\n\n/**\n * Gets a 16 bit little endian unsigned integer value from a position.\n *\n * @param  {Number} position Position in bytes\n * @return {Number}          Value\n */\nWMKS.Packet.prototype.getUint16le = function(position)\n{\n   var value;\n   value  = this._buffer[position + 0];\n   value |= this._buffer[position + 1] << 8;\n   return value;\n};\n\n\n/**\n * Gets a 32 bit little endian unsigned integer value from a position.\n *\n * @param  {Number} position Position in bytes\n * @return {Number}          Value\n */\nWMKS.Packet.prototype.getUint32le = function(position)\n{\n   var value;\n   value  = this._buffer[position + 0];\n   value |= this._buffer[position + 1] << 8;\n   value |= this._buffer[position + 2] << 16;\n   value |= this._buffer[position + 3] << 24;\n\n   if (value < 0) {\n      value = 0xffffffff + value + 1;\n   }\n\n   return value;\n};\n\n\n/**\n * Changes the buffer size without modifying contents.\n *\n * @private\n * @param {Number} size New size of the buffer\n */\nWMKS.Packet.prototype._resizeBuffer = function(size)\n{\n   if (size > 0) {\n      var buffer = new Uint8Array(size);\n      buffer.set(this._buffer);\n      this._buffer = buffer;\n   }\n};\n\n\n/**\n * Increases the buffer size to ensure there is enough size to write length\n * bytes in to the buffer. Grows the buffer size by factors of 1.5.\n *\n * @private\n * @param {Number} length The amount of bytes to ensure we fit in the buffer.\n */\nWMKS.Packet.prototype._ensureWriteableBytes = function(length)\n{\n   if (length > 0) {\n      var reqLength = this.length + length;\n      var newLength = this._buffer.length;\n\n      while (newLength < reqLength) {\n         newLength = Math.floor(newLength * 1.5);\n      }\n\n      if (newLength > this._buffer.length) {\n         this._resizeBuffer(newLength);\n      }\n   }\n};\n\n\n/**\n * Checks if we have enough bytes available to read from the buffer.\n *\n * @private\n * @param  {Number} length The number of bytes left.\n * @return {Boolean} [description]\n */\nWMKS.Packet.prototype._checkReadableBytes = function(length)\n{\n   return this._readPosition + length <= this.length;\n};\n'use strict';\n\n/**\n * Creates a new VVC instance.\n *\n * @classdesc The root VVC instance which owns listeners and sessions.\n * @constructor\n * @protected\n * @return {VVC}\n */\nvar VVC = function()\n{\n   /**\n    * Array of open sessions.\n    * @type {VVCSession[]}\n    */\n   this._sessions = [];\n\n   /**\n    * Array of active listeners.\n    * @type {VVCListener[]}\n    */\n   this._listeners = [];\n\n   /**\n    * The last error to occur within this VVC instance and all objects it owns.\n    * @type {VVCError}\n    */\n   this._lastError = null;\n\n   return this;\n};\n\n\n/**\n * Enable probe channel.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.ENABLE_PROBE_CHANNEL = 1;\n\n\n/**\n * Major version number.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.MAJOR_VER = 3;\n\n\n/**\n * Minor version number.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.MINOR_VER = 0;\n\n\n/**\n * Array of supported versions in objects of { MAJOR, MINOR }.\n *\n * @type {Array}\n * @readonly\n * @default\n */\nVVC.SUPPORTED_VER = [\n  { MAJOR: 2, MINOR: 0, FLAGS: 0 },\n  { MAJOR: 1, MINOR: 0, FLAGS: 0 },\n];\n\n\n/**\n * Version 1 caps part 1.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.CAPS_V10_1 = 0;\n\n\n/**\n * Version 1 caps part 2.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.CAPS_V10_2 = 0;\n\n\n/**\n * Used for createListener to listen on all sessions.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.ALL_SESSIONS = -1;\n\n\n/**\n * The maximum number of round trip times to remember.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.RTT_HISTORY_SIZE = 30;\n\n\n/**\n * Minimum length of a channel name.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.MIN_CHANNEL_NAME_LEN = 1;\n\n\n/**\n * Maximum length of a channel name.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.MAX_CHANNEL_NAME_LEN = 255;\n\n\n/**\n * Maximum length of 'initialData'.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.MAX_INITIAL_DATA_LEN = 4096;\n\n\n/**\n * VVC status codes.\n * @enum {Number}\n * @readonly\n */\nVVC.STATUS = {\n   SUCCESS:         0,\n   ERROR:           1,\n   OUT_OF_MEMORY:   2,\n   INVALID_ARGS:    3,\n   INVALID_STATE:   4,\n   CLOSED:          5,\n   PROTOCOL_ERROR:  6,\n   TRANSPORT_ERROR: 7,\n   OPEN_REJECTED:   8,\n   OPEN_TIMEOUT:    9\n};\n\n\n/**\n * Creates a session object and wraps it around a WebSocket.\n *\n * @param  {WebSocket}   socket A valid connected WebSocket.\n * @return {?VVCSession}        The new VVCSession object.\n */\nVVC.prototype.openSession = function(socket)\n{\n   var session;\n   session = new VVCSession(this);\n   session.attachToWebSocket(socket);\n   this._sessions.push(session);\n   return session;\n};\n\n\n/**\n * Closes a session.\n *\n * @param  {VVCSession} session A valid open VVCSession.\n * @return {Boolean}            Returns true on success.\n */\nVVC.prototype.closeSession = function(session)\n{\n   var index;\n\n   if (!(session instanceof VVCSession)) {\n      this.setLastError(VVC.STATUS.INVALID_ARGS,\n                         'VVC.closeSession',\n                         'Invalid session, not instanceof VVCSession');\n      return false;\n   }\n\n   if (session.state === VVC.SESSION_STATE.CLOSING) {\n      return true;\n   }\n\n   index = this._sessions.indexOf(session);\n\n   if (index === -1) {\n      this.setLastError(VVC.STATUS.INVALID_ARGS,\n                         'VVC.closeSession',\n                         'Invalid session, '\n                         + 'session is not registered with this vvc instance');\n      return false;\n   }\n\n   session.onSessionClose();\n   this._sessions = this._sessions.splice(index, 1);\n   return true;\n};\n\n\n/**\n * Creates a listener object.\n *\n * @param  {VVCSession|VVC.ALL_SESSIONS} session A valid open VVCSession.\n * @param  {String}                      name    Name of the new listener.\n * @return {?VVCListener}                        The new VVCListener object.\n */\nVVC.prototype.createListener = function(session, name)\n{\n   var listener, sessionListeners, i;\n\n   if (!(session instanceof VVCSession)) {\n      this.setLastError(VVC.STATUS.INVALID_ARGS,\n                         'VVC.createListener',\n                         'Invalid session: not an instanceof VVCSession');\n      return null;\n   }\n\n   if (name.length < VVC.MIN_CHANNEL_NAME_LEN ||\n       name.length > VVC.MAX_CHANNEL_NAME_LEN) {\n      this.setLastError(VVC.STATUS.INVALID_ARGS,\n                         'VVC.createListener',\n                         'Invalid name \"' + name + '\",'\n                         + ' length must be between ' + VVC.MIN_CHANNEL_NAME_LEN\n                         + ' and ' + VVC.MAX_CHANNEL_NAME_LEN\n                         + ' characters.');\n      return null;\n   }\n\n   sessionListeners = this._findSessionListeners(session);\n\n   for (i = 0; i < sessionListeners.length; ++i) {\n      if (sessionListeners[i].name === name) {\n         this.setLastError(VVC.STATUS.INVALID_ARGS,\n                            'VVC.createListener',\n                            'Invalid name \"' + name + '\",'\n                            + ' a listener on this session'\n                            + ' with this name already exists.');\n         return null;\n      }\n   }\n\n   listener = new VVCListener(this, session, name);\n   this._listeners.push(listener);\n   return listener;\n};\n\n\n/**\n * Closes a VVC listener.\n *\n * @param  {VVCListener} listener A valid connected VVCListener.\n * @return {Boolean}              Returns true on success.\n */\nVVC.prototype.closeListener = function(listener)\n{\n   var index = this._listeners.indexOf(listener);\n\n   if (!(listener instanceof VVCListener)) {\n      this.setLastError(VVC.STATUS.INVALID_ARGS,\n                         'VVC.closeListener',\n                         'Invalid listener, not instanceof VVCListener');\n      return false;\n   }\n\n   if (listener.state === VVC.LISTENER_STATE.CLOSING) {\n      return true;\n   }\n\n   if (index === -1) {\n      this.setLastError(VVC.STATUS.INVALID_ARGS,\n                         'VVC.closeListener',\n                         'Invalid listener, '\n                         + 'listener is not registered with this vvc instance');\n      return false;\n   }\n\n   if (listener.onclose) {\n      listener.onclose();\n   }\n\n   this._listeners = this._listeners.splice(index, 1);\n   return true;\n};\n\n\n/**\n * Finds a registered listener with a specific name.\n *\n * @protected\n * @param  {String}       name\n * @return {?VVCListener} listener\n */\nVVC.prototype._findListenerByName = function(name)\n{\n   var listener, i;\n\n   for (i = 0; i < this._listeners.length; ++i) {\n      listener = this._listeners[i];\n\n      if (listener.name === name) {\n         return listener;\n      }\n   }\n\n   return null;\n};\n\n\n/**\n * Finds all listeners for a session.\n *\n * @protected\n * @param  {VVCSession}    session\n * @return {VVCListener[]} listeners\n */\nVVC.prototype._findSessionListeners = function(session)\n{\n   var listener, i, sessionListeners = [];\n\n   for (i = 0; i < this._listeners.length; ++i) {\n      listener = this._listeners[i];\n\n      if (listener.session === VVC.ALL_SESSIONS ||\n          listener.session === session) {\n         sessionListeners.push(listener);\n      }\n   }\n\n   return sessionListeners;\n};\n\n\n/**\n * Creates a new VVC Error object.\n *\n * @classdesc A container for a VVC error status.\n *\n * @constructor\n * @private\n * @param {VVC.STATUS} status The VVC status code.\n * @param {String} where      What function the error occurred in.\n * @param {String} msg        A description of the error.\n * @return {VVCError}\n */\nvar VVCError = function(status, where, msg)\n{\n   /**\n    * The VVC status code.\n    * @type {VVC.STATUS}\n    */\n   this.status = status;\n\n   /**\n    * What function the error occurred in.\n    * @type {String}\n    */\n   this.where = where;\n\n   /**\n    * A description of what caused the error.\n    * @type {String}\n    */\n   this.msg = msg;\n\n   return this;\n};\n\n\n/**\n * Returns the last error to occur within this VVC instance and all objects\n * that it owns.\n *\n * @return {VVCError?} error\n */\nVVC.prototype.getLastError = function()\n{\n   return this._lastError;\n};\n\n\n/**\n * Sets the last error.\n * Also will output the error to console.\n *\n * @protected\n * @param {VVC.STATUS} status The VVC status code.\n * @param {String} where      What function the error occurred in.\n * @param {String} msg        A full description of the error.\n */\nVVC.prototype.setLastError = function(status, where, msg)\n{\n   this._lastError = new VVCError(status, where, msg);\n\n   if (status !== VVC.STATUS.SUCCESS) {\n      console.error(where + ': ' + msg);\n   }\n};\n'use strict';\n\n/**\n * Use {@link VVCSession#openChannel} to create a channel.\n *\n * @classdesc  Represents a VVC channel which exposes a websocket-like API.\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/WebSocket}\n *\n * @constructor\n * @protected\n * @param {VVCSession} session  Session this channel belongs to.\n * @param {String}     name     Channel name.\n * @param {Number}     priority Channel priority.\n * @param {Number}     flags    Channel flags.\n * @param {Number}     timeout  Channel connect timeout.\n * @return {VVCChannel}\n */\nvar VVCChannel = function(session, id, name, priority, flags, timeout)\n{\n   /**\n    * Channel id.\n    * @type {Number}\n    */\n   this.id = id;\n\n   /**\n    * Channel name.\n    * @type {String}\n    */\n   this.name = name;\n\n   /**\n    * Channel priority.\n    * @type {Number}\n    */\n   this.priority = priority || 0;\n\n   /**\n    * Channel flags.\n    * @type {Number}\n    */\n   this.flags = flags || 0;\n\n   /**\n    * Channel timeout.\n    * @type {Number}\n    */\n   this.timeout = timeout || 0;\n\n   /**\n    * The protocol used by the channel, currently fixed to binary.\n    * @type {String}\n    */\n   this.protocol = 'binary';\n\n   /**\n    * The current state of the channel.\n    * @type {VVC.CHANNEL_STATE}\n    */\n   this.state = VVC.CHANNEL_STATE.INIT;\n\n   /**\n    * Callback for when the channel opens.\n    * @type {VVCChannel~onopen?}\n    */\n   this.onopen = this.onopen || null;\n\n   /**\n    * Callback for when the channel closes.\n    * @type {VVCChannel~onclose?}\n    */\n   this.onclose = this.onclose || null;\n\n   /**\n    * Callback for when there is an error on the channel.\n    * @type {VVCChannel~onerror?}\n    */\n   this.onerror = this.onerror || null;\n\n   /**\n    * Callback for when a message is received on the channel.\n    * @type {VVCChannel~onmessage?}\n    */\n   this.onmessage = this.onmessage || null;\n\n   /**\n    * The session this channel belongs to.\n    * @protected\n    * @type {VVCSession}\n    */\n   this._session     = session;\n\n   /**\n    * The VVC instance this channel belongs to.\n    * @protected\n    * @type {VVC}\n    */\n   this._vvcInstance = session.vvcInstance;\n\n   return this;\n};\n\n\n/**\n * VVCChannel state\n * @enum {Number}\n * @readonly\n */\nVVC.CHANNEL_STATE = {\n   INIT:         0,\n   OPEN_FAILED:  1,\n   OPEN:         2,\n   CLOSING:      3,\n   PEER_CLOSING: 4,\n   PEER_CLOSED:  5,\n   CLOSED:       6\n};\n\n\n/**\n * Sends data over a channel\n *\n * @param  {Uint8Array|ArrayBuffer} data    Data to send\n * @return {Boolean}                success True on success\n */\nVVCChannel.prototype.send = function(data)\n{\n   return this._session.send(this, data);\n};\n\n\n/**\n * Closes this channel\n *\n * @return {Boolean} success True on success\n */\nVVCChannel.prototype.close = function()\n{\n   return this._session.closeChannel(this);\n};\n\n\n/**\n * Called when the channel opens\n *\n * @callback VVCChannel~onopen\n * @param {Event} event\n */\n\n\n/**\n * Called when the channel closes\n *\n * @callback VVCChannel~onclose\n * @param {CloseEvent} event\n */\n\n\n/**\n * Called when there is an error with the channel\n *\n * @callback VVCChannel~onerror\n * @param {Event} event\n */\n\n\n/**\n * Called when a message is received from the channel\n *\n * @callback VVCChannel~onmessage\n * @param {MessageEvent} event\n */\n'use strict';\n\n/**\n * This is only to be created by a VVCSession.\n *\n * @classdesc The control channel created and owned by a VVCSession.\n *\n * @constructor\n * @protected\n * @extends {VVCChannel}\n * @param {VVCSession} session The session this control channel belongs to\n * @return {VVCControlChannel}\n */\nvar VVCControlChannel = function(session)\n{\n   VVCChannel.call(this, session,\n                   VVC.CONTROL_CHANNEL_ID,\n                   VVC.CONTROL_CHANNEL_NAME,\n                   0, 0, 0);\n\n   this.state = VVC.CHANNEL_STATE.OPEN;\n\n   /**\n    * The negotiated major version.\n    * @type {Number}\n    */\n   this.versionMajor = 0;\n\n\n   /**\n    * The negotiated minor version.\n    * @type {Number}\n    */\n   this.versionMinor = 0;\n\n\n   /**\n    * The current rtt ping send time.\n    * @type {Number}\n    */\n   this._rttSendTimeMS = 0;\n};\n\n\nVVCControlChannel.prototype = Object.create(VVCChannel.prototype);\n\n\n/**\n * Size of CTRL header.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.CTRL_HEADER_SIZE = 4;\n\n\n/**\n * Control channel id.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.CONTROL_CHANNEL_ID = 0;\n\n\n/**\n * Control channel name.\n *\n * @type {String}\n * @readonly\n * @default\n */\nVVC.CONTROL_CHANNEL_NAME = 'vvcctrl';\n\n\n/**\n * Control channel message opcodes.\n * @enum {Number}\n * @readonly\n */\nVVC.CTRL_OP = {\n   /** Receive acknowledgement, used for bandwidth estimation */\n   RECV_ACK:            0x01,\n\n   /** Initiate VVC, first op sent from client to server */\n   INIT:                0x02,\n\n   /** Initiate VVC acknowledgement */\n   INIT_ACK:            0x03,\n\n   /** Open channel */\n   OPEN_CHAN:           0x04,\n\n   /** Open channel acknowledgement */\n   OPEN_CHAN_ACK:       0x05,\n\n   /** Open channel cancel */\n   OPEN_CHAN_CANCEL:    0x06,\n\n   /** Close channel */\n   CLOSE_CHAN:          0x07,\n\n   /** Close channel acknowledgement */\n   CLOSE_CHAN_ACK:      0x08,\n\n   /** Round trip time ping */\n   RTT:                 0x09,\n\n   /** Round trip time pong */\n   RTT_ACK:             0x0A,\n};\n\n\n/**\n * Control channel message header flags.\n * @enum {Number}\n * @readonly\n */\nVVC.CTRL_FLAG = {\n   /** The control packet has data */\n   ODAT:                0x80,\n};\n\n\n/**\n * Init extension header flags.\n * @enum {Number}\n * @readonly\n */\nVVC.INIT_EXT_FLAG = {\n   /** The extension has data */\n   EDAT:                0x8000,\n};\n\n\n/**\n * Init extension types.\n * @enum {Number}\n * @readonly\n */\nVVC.INIT_EXT_TYPE = {\n   /** Additional supported version. */\n   VERSION: 0x01,\n\n   /** Probe channel support. */\n   PROBE: 0x02,\n};\n\n\n/**\n * Init extension probe flags.\n * @enum {Number}\n * @readonly\n */\nVVC.INIT_EXT_PROBE_FLAG = {\n   /** Probe channel is supported */\n   SUPPORTED:           0x01,\n};\n\n\n/**\n * Open channel acknowledgement status\n * @enum {Number}\n * @readonly\n */\nVVC.OPEN_CHAN_STATUS = {\n   SUCCESS: 0,\n   REJECT:  1,\n   TIMEOUT: 2,\n};\n\n\n/**\n * Close channel reason\n * @enum {Number}\n * @readonly\n */\nVVC.CLOSE_CHAN_REASON = {\n   NORMAL: 0,\n   ERROR:  1,\n};\n\n\n/**\n * Close channel acknowledgement status\n * @enum {Number}\n * @readonly\n */\nVVC.CLOSE_CHAN_STATUS = {\n   SUCCESS: 0,\n   ERROR:   1,\n};\n\n\n/**\n * Expected size of data for each control message\n * @type {Number[]}\n * @readonly\n */\nVVC.CTRL_OP.SIZE = [];\nVVC.CTRL_OP.SIZE[VVC.CTRL_OP.RECV_ACK]         = 0;\nVVC.CTRL_OP.SIZE[VVC.CTRL_OP.INIT]             = 12;\nVVC.CTRL_OP.SIZE[VVC.CTRL_OP.INIT_ACK]         = 12;\nVVC.CTRL_OP.SIZE[VVC.CTRL_OP.OPEN_CHAN]        = 20;\nVVC.CTRL_OP.SIZE[VVC.CTRL_OP.OPEN_CHAN_ACK]    = 12;\nVVC.CTRL_OP.SIZE[VVC.CTRL_OP.OPEN_CHAN_CANCEL] = 0;\nVVC.CTRL_OP.SIZE[VVC.CTRL_OP.CLOSE_CHAN]       = 8;\nVVC.CTRL_OP.SIZE[VVC.CTRL_OP.CLOSE_CHAN_ACK]   = 8;\nVVC.CTRL_OP.SIZE[VVC.CTRL_OP.RTT]              = 0;\nVVC.CTRL_OP.SIZE[VVC.CTRL_OP.RTT_ACK]          = 0;\n\n\n/**\n * Text name of each CTRL_OP for debugging and error messages\n * @type {String[]}\n * @readonly\n */\nVVC.CTRL_OP.NAME = [];\nVVC.CTRL_OP.NAME[VVC.CTRL_OP.RECV_ACK]         = 'VVC.CTRL_OP.RECV_ACK';\nVVC.CTRL_OP.NAME[VVC.CTRL_OP.INIT]             = 'VVC.CTRL_OP.INIT';\nVVC.CTRL_OP.NAME[VVC.CTRL_OP.INIT_ACK]         = 'VVC.CTRL_OP.INIT_ACK';\nVVC.CTRL_OP.NAME[VVC.CTRL_OP.OPEN_CHAN]        = 'VVC.CTRL_OP.OPEN_CHAN';\nVVC.CTRL_OP.NAME[VVC.CTRL_OP.OPEN_CHAN_ACK]    = 'VVC.CTRL_OP.OPEN_CHAN_ACK';\nVVC.CTRL_OP.NAME[VVC.CTRL_OP.OPEN_CHAN_CANCEL] = 'VVC.CTRL_OP.OPEN_CHAN_CANCEL';\nVVC.CTRL_OP.NAME[VVC.CTRL_OP.CLOSE_CHAN]       = 'VVC.CTRL_OP.CLOSE_CHAN';\nVVC.CTRL_OP.NAME[VVC.CTRL_OP.CLOSE_CHAN_ACK]   = 'VVC.CTRL_OP.CLOSE_CHAN_ACK';\nVVC.CTRL_OP.NAME[VVC.CTRL_OP.RTT]              = 'VVC.CTRL_OP.RTT';\nVVC.CTRL_OP.NAME[VVC.CTRL_OP.RTT_ACK]          = 'VVC.CTRL_OP.RTT_ACK';\n\n\n/**\n * Sends a VVC.CTRL_OP.INIT message.\n * Requests to initiate the connection.\n *\n * @protected\n * @param  {VVC.CTRL_OP} [code] The CTRL_OP code to use so we can reuse this\n *                              function as both the INIT and INIT_ACK messages\n *                              have identical data.\n * @return {Boolean}            Returns true on successful send\n */\nVVCControlChannel.prototype.sendInit = function(code)\n{\n   var extensionLen, i, packet;\n\n   if (code === undefined) {\n      code = VVC.CTRL_OP.INIT;\n   }\n\n   if (code !== VVC.CTRL_OP.INIT && code !== VVC.CTRL_OP.INIT_ACK) {\n      this._vvcInstance.setLastError(VVC.STATUS.INVALID_ARGS,\n                                      'VVCControlChannel.sendInit',\n                                      'Invalid code, '\n                                      + ' expected INIT or INIT_ACK');\n      return false;\n   }\n\n   packet = this._createControlPacket(code);\n   packet.writeUint16(VVC.MAJOR_VER);\n   packet.writeUint16(VVC.MINOR_VER);\n   packet.writeUint32(VVC.CAPS_V10_1);\n   packet.writeUint32(VVC.CAPS_V10_2);\n\n   if (VVC.MAJOR_VER >= 2) {\n      extensionLen = 16 * VVC.SUPPORTED_VER.length;\n\n      if (VVC.ENABLE_PROBE_CHANNEL) {\n         extensionLen += 8;\n      }\n\n      packet.writeUint32(extensionLen);\n\n      // Add all supported versions\n      for (i = 0; i < VVC.SUPPORTED_VER.length; ++i) {\n         // Extension header\n         packet.writeUint16(VVC.INIT_EXT_TYPE.VERSION);\n         packet.writeUint16(VVC.INIT_EXT_FLAG.EDAT);\n         packet.writeUint32(8);\n\n         // Extension data\n         packet.writeUint16(VVC.SUPPORTED_VER[i].MAJOR);\n         packet.writeUint16(VVC.SUPPORTED_VER[i].MINOR);\n         packet.writeUint32(VVC.SUPPORTED_VER[i].FLAGS);\n      }\n\n      // Probe channel support\n      if (VVC.ENABLE_PROBE_CHANNEL) {\n         packet.writeUint16(VVC.INIT_EXT_TYPE.PROBE);\n         packet.writeUint16(0);\n         packet.writeUint32(VVC.INIT_EXT_PROBE_FLAG.SUPPORTED);\n      }\n   }\n\n   return this._sendControlPacket(packet);\n};\n\n\n/**\n * Sends a VVC.CTRL_OP.RTT message.\n * Used as a ping/pong system for measuring round trip times.\n *\n * @protected\n * @return {Boolean} Returns true on successful send\n */\nVVCControlChannel.prototype.sendRtt = function()\n{\n   this._rttSendTimeMS = Date.now();\n   return this._sendControlPacket(this._createControlPacket(VVC.CTRL_OP.RTT));\n};\n\n\n/**\n * Sends a VVC.CTRL_OP.RECV_ACK message.\n * Acknowledges receiving of chunk data.\n * Will send multiple messages if bytes is above 0xffff.\n *\n * @protected\n * @param  {Number}  bytes The number of bytes to acknowledge\n * @return {Boolean}       Returns true on successful send\n */\nVVCControlChannel.prototype.sendRecvAck = function(bytes)\n{\n   var packet;\n\n   while (bytes > 0xffff) {\n      packet = this._createControlPacket(VVC.CTRL_OP.RECV_ACK, 0, 0xffff - 1);\n      this._sendControlPacket(packet);\n      bytes -= 0xffff;\n   }\n\n   if (bytes > 0) {\n      packet = this._createControlPacket(VVC.CTRL_OP.RECV_ACK, 0, bytes - 1);\n      this._sendControlPacket(packet);\n   }\n\n   return true;\n};\n\n\n/**\n * Sends a VVC.CTRL_OP.OPEN_CHAN message.\n *\n * Requests to open a new channel.\n *\n * @protected\n * @param  {VVCChannel} channel       The channel to open\n * @param  {Uint8Array} [initialData] Initial data to send with the open request\n * @return {Boolean}                  Returns true on successful send\n */\nVVCControlChannel.prototype.sendOpenChannel = function(channel, initialData)\n{\n   var packet, initialDataLen = 0;\n\n   if (!(channel instanceof VVCChannel)) {\n      this._vvcInstance.setLastError(VVC.STATUS.INVALID_ARGS,\n                                      'VVCControlChannel.sendOpenChannel',\n                                      'Invalid channel, '\n                                      + ' expected instanceof VVCChannel');\n      return false;\n   }\n\n   initialDataLen = 0;\n\n   if (!!initialData) {\n      initialDataLen = initialData.length;\n   }\n\n   packet = this._createControlPacket(VVC.CTRL_OP.OPEN_CHAN);\n   packet.writeUint32(channel.id);\n   packet.writeUint32(channel.priority);\n   packet.writeUint32(channel.flags);\n   packet.writeUint32(channel.timeout);\n   packet.writeUint16(0);  // Reserved\n   packet.writeUint8(0);   // Reserved2\n   packet.writeUint8(channel.name.length);\n   packet.writeUint32(initialDataLen);\n   packet.writeStringASCII(channel.name);\n\n   if (initialDataLen) {\n      packet.writeArray(initialData);\n   }\n\n   return this._sendControlPacket(packet);\n};\n\n\n/**\n * Sends a VVC.CTRL_OP.OPEN_CHAN_ACK message.\n *\n * Responds to requests to open a new channel.\n *\n * @protected\n * @param  {VVCChannel}           channel       The channel to open\n * @param  {VVC.OPEN_CHAN_STATUS} status        The acknowledgement status\n * @param  {Uint8Array}           [initialData] Initial data to send with ack\n * @return {Boolean}                            Returns true on successful send\n */\nVVCControlChannel.prototype.sendOpenChannelAck = function(channel,\n                                                          status,\n                                                          initialData)\n{\n   var packet = this._createControlPacket(VVC.CTRL_OP.OPEN_CHAN_ACK);\n   packet.writeUint32(channel.id);\n   packet.writeUint32(status);\n\n   if (!!initialData) {\n      packet.writeUint32(initialData.length);\n      packet.writeArray(initialData);\n   } else {\n      packet.writeUint32(0);\n   }\n\n   return this._sendControlPacket(packet);\n};\n\n\n/**\n * Sends a VVC.CTRL_OP.CLOSE_CHAN message.\n *\n * Requests to close a channel.\n *\n * @protected\n * @param  {VVCChannel}            channel The channel to close\n * @param  {VVC.CLOSE_CHAN_REASON} reason  The reason for closing\n * @return {Boolean}                       Returns true on successful send\n */\nVVCControlChannel.prototype.sendCloseChannel = function(channel, reason)\n{\n   var packet = this._createControlPacket(VVC.CTRL_OP.CLOSE_CHAN);\n   packet.writeUint32(channel.id);\n   packet.writeUint32(reason);\n   return this._sendControlPacket(packet);\n};\n\n\n/**\n * Sends a VVC.CTRL_OP.CLOSE_CHAN message.\n *\n * Responds to a close channel request.\n *\n * @protected\n * @param  {VVCChannel}            channel The channel to close\n * @param  {VVC.CLOSE_CHAN_STATUS} status  The close acknowledgement status\n * @return {Boolean}                       Returns true on successful send\n */\nVVCControlChannel.prototype.sendCloseChannelAck = function(channel, status)\n{\n   var packet = this._createControlPacket(VVC.CTRL_OP.CLOSE_CHAN_ACK);\n   packet.writeUint32(channel.id);\n   packet.writeUint32(status);\n   return this._sendControlPacket(packet);\n};\n\n\n/**\n * Called when the control channel receives a message.\n * Reads the message header and forwards it to the correct handler function.\n * Implements VVCChannel~onmessage.\n *\n * @protected\n * @param {MessageEvent} evt\n */\nVVCControlChannel.prototype.onmessage = function(evt)\n{\n   var packet = WMKS.Packet.createFromBuffer(evt.data);\n   var opcode = packet.readUint8();\n   var flags  = packet.readUint8();\n   var param  = packet.readUint16();\n\n   switch (opcode) {\n      case VVC.CTRL_OP.INIT:\n      case VVC.CTRL_OP.INIT_ACK:\n         this._onInit(packet, opcode);\n         break;\n      case VVC.CTRL_OP.RTT:\n         this._onRtt(packet);\n         break;\n      case VVC.CTRL_OP.RTT_ACK:\n         this._onRttAck(packet);\n         break;\n      case VVC.CTRL_OP.OPEN_CHAN:\n         this._onOpenChannel(packet);\n         break;\n      case VVC.CTRL_OP.OPEN_CHAN_ACK:\n         this._onOpenChannelAck(packet);\n         break;\n      case VVC.CTRL_OP.CLOSE_CHAN:\n         this._onCloseChannel(packet);\n         break;\n      case VVC.CTRL_OP.CLOSE_CHAN_ACK:\n         this._onCloseChannelAck(packet);\n         break;\n      case VVC.CTRL_OP.RECV_ACK:\n         this._onRecvAck(packet, param);\n         break;\n      default:\n         this._session.onSessionError(VVC.STATUS.PROTOCOL_ERROR,\n                                       'VVCControlChannel.onmessage',\n                                       'Unknown control opcode: ' + opcode);\n         return false;\n   }\n\n   return true;\n};\n\n\n/**\n * Called when we receive a VVC.CTRL_OP.RTT message.\n * Immediately replies with a VVC.CTRL_OP.RTT_ACK.\n *\n * @private\n * @param  {Packet}  packet  Incoming message packet\n * @return {Boolean} success Returns true on success\n */\nVVCControlChannel.prototype._onRtt = function(packet)\n{\n   var ack;\n\n   if (!this._checkErrorMinimumSize(VVC.CTRL_OP.RTT, packet)) {\n      return false;\n   }\n\n   ack = this._createControlPacket(VVC.CTRL_OP.RTT_ACK);\n   return this._sendControlPacket(ack);\n};\n\n\n/**\n * Called when we receive a VVC.CTRL_OP.RTT_ACK message.\n * Records the time taken for the RTT_ACK to arrive since we sent the request.\n *\n * @private\n * @param  {Packet}  packet  Incoming message packet\n * @return {Boolean} success Returns true on success\n */\nVVCControlChannel.prototype._onRttAck = function(packet)\n{\n   if (!this._checkErrorMinimumSize(VVC.CTRL_OP.RTT_ACK, packet)) {\n      return false;\n   }\n\n   this._session.addRttTime(Date.now() - this._rttSendTimeMS);\n   return true;\n};\n\n\n/**\n * Called when we receive a VVC.CTRL_OP.RECV_ACK message.\n * Does nothing.\n *\n * @private\n * @param  {Packet}  packet  Incoming message packet\n * @return {Boolean} success Returns true on success\n */\nVVCControlChannel.prototype._onRecvAck = function(packet, bytesReceived)\n{\n   if (!this._checkErrorMinimumSize(VVC.CTRL_OP.RECV_ACK, packet)) {\n      return false;\n   }\n\n   return true;\n};\n\n\n/**\n * Check if a major+minor version is supported.\n *\n * @private\n * @param  {Number}  major   Major version\n * @param  {Number}  minor   Minor version\n * @return {Boolean} success Returns true if version is supported.\n */\nVVCControlChannel.prototype._isVersionSupported = function(major, minor)\n{\n   if (VVC.MAJOR_VER == major && VVC.MINOR_VER == minor) {\n      return true;\n   }\n\n   for (var i = 0; i < VVC.SUPPORTED_VER.length; ++i) {\n      if (VVC.SUPPORTED_VER[i].MAJOR == major\n       && VVC.SUPPORTED_VER[i].MINOR == minor) {\n         return true;\n      }\n   }\n\n   return false;\n};\n\n\n/**\n * Called when we receive a VVC.CTRL_OP.INIT or VVC.CTRL_OP.INIT_ACK message.\n * If receiving an INIT then responds with an INIT_ACK message.\n * Will trigger the listener.onconnect callback.\n *\n * @private\n * @param {VVC.CTRL_OP} opcode  The opcode, expected to be INIT or INIT_ACK\n * @param {Packet}      packet  The INIT / INIT_ACK packet\n * @return {Boolean}    success Returns true on success\n */\nVVCControlChannel.prototype._onInit = function(packet, opcode)\n{\n   var major, minor, caps1, caps2;\n   var extVersions = [];\n\n   if (!this._checkErrorMinimumSize(opcode, packet)) {\n      return false;\n   }\n\n   if (!this._checkErrorSessionState(opcode, VVC.SESSION_STATE.INIT)) {\n      return false;\n   }\n\n   major = packet.readUint16();\n   minor = packet.readUint16();\n   caps1 = packet.readUint32();\n   caps2 = packet.readUint32();\n\n   if (major >= 2) {\n      var extLen;\n\n      if (!this._checkErrorRemainingSize(opcode, packet, 4)) {\n         return false;\n      }\n\n      extLen = packet.readUint32();\n\n      if (!this._checkErrorRemainingSize(opcode, packet, extLen)) {\n         return false;\n      }\n\n      // Read extension data\n      while (packet.bytesRemaining() >= 8) {\n         var extType, extFlags, extParam, extDataLen,\n             extVerMajor, extVerMinor, extVerFlags,\n             extReadPos, extReadBytes;\n\n         // Read extension header\n         extType = packet.readUint16();\n         extFlags = packet.readUint16();\n         extParam = packet.readUint32();\n\n         if (extFlags & VVC.INIT_EXT_FLAG.EDAT) {\n            extDataLen = extParam;\n         } else {\n            extDataLen = 0;\n         }\n\n         if (!this._checkErrorRemainingSize(opcode, packet, extDataLen)) {\n            return false;\n         }\n\n         // Save current bytes remaining so we can skip past unread extData\n         extReadPos = packet.bytesRemaining();\n\n         switch (extType) {\n         case VVC.INIT_EXT_TYPE.VERSION:\n            if (!this._checkErrorRemainingSize(opcode, packet, 8)) {\n               return false;\n            }\n\n            extVerMajor = packet.readUint16();\n            extVerMinor = packet.readUint16();\n            extVerFlags = packet.readUint32();\n            extVersions.push({ major: extVerMajor, minor: extVerMinor });\n            break;\n         case VVC.INIT_EXT_TYPE.PROBE:\n            if (extParam & VVC.INIT_EXT_PROBE_FLAG.SUPPORTED) {\n               this._session.createProbeChannel();\n            }\n            break;\n         }\n\n         // Ensure we have fully read the extension data\n         extReadBytes = extReadPos - packet.bytesRemaining();\n\n         if (extReadBytes < extDataLen) {\n            packet.readArray(extDataLen - extReadBytes);\n         }\n      }\n   }\n\n   // Try to find a compatible version\n   this.versionMajor = 0;\n   this.versionMinor = 0;\n\n   if (this._isVersionSupported(major, minor)) {\n      this.versionMajor = major;\n      this.versionMinor = minor;\n   } else {\n      for (var i = 0; i < extVersions.length; i++) {\n         extVerMajor = extVersions[i].major;\n         extVerMinor = extVersions[i].minor;\n\n         if (this._isVersionSupported(extVerMajor, extVerMinor)) {\n            if (extVerMajor >= this.versionMajor\n             && extVerMinor >= this.versionMinor) {\n               this.versionMajor = extVerMajor;\n               this.versionMinor = extVerMinor;\n            }\n         }\n      }\n   }\n\n   if (this.versionMajor == 0 && this.versionMinor == 0) {\n      this._vvcInstance.setLastError(VVC.STATUS.PROTOCOL_ERROR,\n                                     'VVCControlChannel._onInit',\n                                     'Failed to negotiate compatible protocol '\n                                     + ' version.');\n\n      return false;\n   }\n\n   if (opcode === VVC.CTRL_OP.INIT) {\n      this.sendInit(VVC.CTRL_OP.INIT_ACK);\n   }\n\n   this._session.onConnect();\n   return true;\n};\n\n\n/**\n * Called when we receive a VVC.CTRL_OP.OPEN_CHAN message.\n * Will trigger the listener.onpeeropen callback.\n *\n * @private\n * @param  {Packet}  packet  Incoming message packet\n * @return {Boolean} success Returns true on success\n */\nVVCControlChannel.prototype._onOpenChannel = function(packet)\n{\n   if (!this._checkErrorMinimumSize(VVC.CTRL_OP.OPEN_CHAN, packet)) {\n      return false;\n   }\n\n   var name, initialData, channel,\n       id             = packet.readUint32(),\n       priority       = packet.readUint32(),\n       flags          = packet.readUint32(),\n       timeout        = packet.readUint32(),\n       reserved       = packet.readUint16(),\n       reserved2      = packet.readUint8(),\n       nameLen        = packet.readUint8(),\n       initialDataLen = packet.readUint32();\n\n   if (!this._checkErrorMinimumSize(VVC.CTRL_OP.OPEN_CHAN, packet,\n                                    nameLen + initialDataLen)) {\n      return false;\n   }\n\n   name         = packet.readStringASCII(nameLen);\n   initialData  = packet.readArray(initialDataLen);\n\n   channel      = this._session.createChannel(id,\n                                              name,\n                                              priority,\n                                              flags,\n                                              timeout);\n   channel.initialData = initialData;\n   this._session.onPeerOpen(channel);\n   return true;\n};\n\n\n/**\n * Called when we receive a VVC.CTRL_OP.OPEN_CHAN_ACK message.\n * Will trigger the channel.onopen callback.\n *\n * @private\n * @param  {Packet}  packet  Incoming message packet\n * @return {Boolean} success Returns true on success\n */\nVVCControlChannel.prototype._onOpenChannelAck = function(packet)\n{\n   var id, status, initialDataLen, initialData;\n\n   if (!this._checkErrorMinimumSize(VVC.CTRL_OP.OPEN_CHAN_ACK, packet)) {\n      return false;\n   }\n\n   id             = packet.readUint32();\n   status         = packet.readUint32();\n   initialDataLen = packet.readUint32();\n\n   if (!this._checkErrorMinimumSize(VVC.CTRL_OP.OPEN_CHAN_ACK, packet,\n                                    initialDataLen)) {\n      return false;\n   }\n\n   initialData = packet.readArray(initialDataLen);\n\n   if (!this._checkErrorValidChannel(VVC.CTRL_OP.OPEN_CHAN_ACK, id,\n                                     VVC.CHANNEL_STATE.INIT)) {\n      return false;\n   }\n\n   this._session.onChannelOpen(this._session.getChannel(id),\n                               status,\n                               initialData);\n   return true;\n};\n\n\n/**\n * Called when we receive a VVC.CTRL_OP.CLOSE_CHAN message.\n * Will trigger the channel.onclose callback.\n *\n * @private\n * @param  {Packet}  packet  Incoming message packet\n * @return {Boolean} success Returns true on success\n */\nVVCControlChannel.prototype._onCloseChannel = function(packet)\n{\n   var id, reason;\n\n   if (!this._checkErrorMinimumSize(VVC.CTRL_OP.CLOSE_CHAN, packet)) {\n      return false;\n   }\n\n   id     = packet.readUint32();\n   reason = packet.readUint32();\n\n   if (!this._checkErrorValidChannel(VVC.CTRL_OP.CLOSE_CHAN, id)) {\n      return false;\n   }\n\n   this._session.onChannelClose(this._session.getChannel(id), reason);\n   return true;\n};\n\n\n/**\n * Called when we receive a VVC.CTRL_OP.CLOSE_CHAN_ACK message.\n * Will trigger the channel.onclose callback.\n *\n * @private\n * @param  {Packet}  packet  Incoming message packet\n * @return {Boolean} success Returns true on success\n */\nVVCControlChannel.prototype._onCloseChannelAck = function(packet)\n{\n   var id, status;\n\n   if (!this._checkErrorMinimumSize(VVC.CTRL_OP.CLOSE_CHAN_ACK, packet)) {\n      return false;\n   }\n\n   id     = packet.readUint32();\n   status = packet.readUint32();\n\n   if (!this._checkErrorValidChannel(VVC.CTRL_OP.CLOSE_CHAN_ACK, id,\n                                     VVC.CHANNEL_STATE.CLOSING)) {\n      return false;\n   }\n\n   this._session.onChannelClose(this._session.getChannel(id),\n                                status);\n\n   return true;\n};\n\n\n/**\n * Checks that the size of the incoming packet is correct.\n * Triggers a session error if the size is unexpected.\n *\n * @private\n * @param  {VVC.CTRL_OP} opcode      The message opcode\n * @param  {Packet}      packet      The packet to check\n * @param  {Number}      [extraSize] Extra size needed\n * @return {Boolean}     success     Returns true on correct size\n */\nVVCControlChannel.prototype._checkErrorMinimumSize = function(opcode,\n                                                              packet,\n                                                              extraSize)\n{\n   var packetSize = packet.length - 4;\n   var expectSize = VVC.CTRL_OP.SIZE[opcode];\n   extraSize      = extraSize || 0;\n\n   if (packetSize < expectSize + extraSize) {\n      var name = VVC.CTRL_OP.NAME[opcode];\n\n      this._session.onSessionError(VVC.STATUS.PROTOCOL_ERROR,\n                                    'VVCControlChannel._checkErrorMinimumSize',\n                                    'Received invalid ' + name + ' message, '\n                                     + 'message too small, received '\n                                     + packetSize + ' bytes, expected '\n                                     + expectSize + ' + ' + extraSize);\n      return false;\n   }\n\n   return true;\n};\n\n\n/**\n * Checks that the remaining size of a packet is large enough.\n * Triggers a session error if the size is unexpected.\n *\n * @private\n * @param  {VVC.CTRL_OP} opcode      The message opcode\n * @param  {Packet}      packet      The packet to check\n * @param  {Number}      size        Size needed\n * @return {Boolean}     success     Returns true on valid size\n */\nVVCControlChannel.prototype._checkErrorRemainingSize = function(opcode,\n                                                                packet,\n                                                                size)\n{\n   var remaining = packet.bytesRemaining();\n\n   if (remaining < size) {\n      var name = VVC.CTRL_OP.NAME[opcode];\n\n      this._session.onSessionError(VVC.STATUS.PROTOCOL_ERROR,\n                                    'VVCControlChannel._checkErrorRemainingSize',\n                                    'Received invalid ' + name + ' message, '\n                                     + 'message too small, expected '\n                                     + (size - remaining) + ' more bytes.');\n      return false;\n   }\n\n   return true;\n};\n\n\n/**\n * Checks the session state.\n * Triggers a session error if the state is invalid.\n *\n * @private\n * @param  {VVC.CTRL_OP}        opcode  The message opcode\n * @param  {VVC.SESSSION_STATE} state   The state to check\n * @return {Boolean}            success Returns true on valid session state\n */\nVVCControlChannel.prototype._checkErrorSessionState = function(opcode,\n                                                               state)\n{\n   var opname = VVC.CTRL_OP.NAME[opcode];\n\n   if (this._session.state !== state) {\n      this._session.onSessionError(VVC.STATUS.PROTOCOL_ERROR,\n                                    'VVCControlChannel._checkErrorSessionState',\n                                    'Received invalid ' + opname + ' message, '\n                                     + 'invaild session state, '\n                                     + 'found ' + this._session.state\n                                     + ' expected ' + state);\n      return false;\n   }\n\n   return true;\n};\n\n\n/**\n * Checks if the channel id is valid.\n * Ensures it is not the control channel.\n * Ensures channel exists.\n * Optionally checks the channel state;\n *\n * @private\n * @param  {VVC.CTRL_OP}       opcode  The message opcode\n * @param  {Number}            id      The channel id to check\n * @param  {VVC.CHANNEL_STATE} [state] The state the channel must be in\n * @return {Boolean}           success Returns true on valid channel id.\n */\nVVCControlChannel.prototype._checkErrorValidChannel = function(opcode,\n                                                               id,\n                                                               state)\n{\n   var opname  = VVC.CTRL_OP.NAME[opcode];\n   var channel = this._session.getChannel(id);\n\n   if (id === VVC.CONTROL_CHANNEL_ID) {\n      this._session.onSessionError(VVC.STATUS.PROTOCOL_ERROR,\n                                    'VVCControlChannel._checkErrorValidChannel',\n                                    'Received invalid ' + opname + ' message, '\n                                     + 'unexpected use of control channel id');\n      return false;\n   }\n\n   if (!channel) {\n      this._session.onSessionError(VVC.STATUS.PROTOCOL_ERROR,\n                                    'VVCControlChannel._checkErrorValidChannel',\n                                    'Received invalid ' + opname + ' message, '\n                                     + 'unknown channel ' + id);\n      return false;\n   }\n\n   if (state !== undefined && channel.state !== state) {\n      this._session.onSessionError(VVC.STATUS.PROTOCOL_ERROR,\n                                    'VVCControlChannel._checkErrorValidChannel',\n                                    'Received invalid ' + opname + ' message, '\n                                     + 'unexpected channel state, '\n                                     + 'found ' + channel.state + ' '\n                                     + ' expected ' + state);\n      return false;\n   }\n\n   return true;\n};\n\n\n/**\n * Creates a control packet.\n * Returns a new instance of Packet and inserts the control message header.\n *\n * @private\n * @param  {VVC.CTRL_OP} code\n * @param  {Number}      [flags]\n * @param  {Number}      [param]\n * @return {Packet}\n */\nVVCControlChannel.prototype._createControlPacket = function(code, flags, param)\n{\n   var packet = WMKS.Packet.createNewPacket();\n\n   param = param || 0;\n   flags = flags || 0;\n\n   packet.control = {\n      code:  code,\n      flags: flags,\n      param: param\n   };\n\n   packet.writeUint8(code);\n   packet.writeUint8(flags);\n   packet.writeUint16(param);\n\n   return packet;\n};\n\n\n/**\n * Send a control packet.\n * Automatically updates the length and data flag if required and then sends the\n * control packet using the normal VVCChannel.send.\n *\n * @private\n * @param  {Packet}  packet The packet to send\n * @return {Boolean}        Returns true on successful send\n */\nVVCControlChannel.prototype._sendControlPacket = function(packet)\n{\n   if (packet.length > VVC.CTRL_HEADER_SIZE) {\n      packet.control.flags |= VVC.CTRL_FLAG.ODAT;\n      packet.control.param = packet.length - VVC.CTRL_HEADER_SIZE;\n   }\n\n   packet.setUint8(1, packet.control.flags);\n   packet.setUint16(2, packet.control.param);\n\n   return this.send(packet.getData());\n};\n'use strict';\n\n/**\n * Use {@link VVC#createListener} to create a listener.\n *\n * @classdesc A VVC listener provides callbacks to notifiy the user about events\n *            on one or more VVC sessions.\n *\n * @constructor\n * @protected\n * @param  {VVC}                         vvcInstance The owner VVC instance\n * @param  {VVCSession|VVC.ALL_SESSIONS} session     Session to listen to\n * @param  {String}                      name        Name of the new listener\n * @return {VVCListener}\n */\n\nvar VVCListener = function(vvcInstance, session, name)\n{\n   /**\n    * Listener name.\n    * @type {String}\n    */\n   this.name    = name;\n\n   /**\n    * Session to listen to.\n    * @type {VVCSession|VVC.ALL_SESSIONS}\n    */\n   this.session = session;\n\n   /**\n    * Listener state.\n    * @type {VVC.LISTENER_STATE}\n    */\n   this.state   = VVC.LISTENER_STATE.ACTIVE;\n\n   /**\n    * Called when the VVC connection has been established on a session that is\n    * being listened to.\n    * @type {VVCListener~onconnect?}\n    */\n   this.onconnect = null;\n\n   /**\n    * Called when the remote peer opens a channel on a session that is being\n    * listened to.\n    * @type {VVCListener~onpeeropen?}\n    */\n   this.onpeeropen = null;\n\n   /**\n    * Called when the listener closes.\n    * @type {VVCListener~onclose?}\n    */\n   this.onclose = null;\n\n   /**\n    * The VVC instance this listener belongs to.\n    * @type {VVC}\n    */\n   this._vvcInstance = vvcInstance;\n\n   return this;\n};\n\n\n/**\n * VVCListener state.\n * @enum {Number}\n * @readonly\n */\nVVC.LISTENER_STATE = {\n   INIT:    0,\n   ACTIVE:  1,\n   CLOSING: 2\n};\n\n\n/**\n * Closes the listener.\n *\n * @return {Boolean} Success\n */\nVVCListener.prototype.close = function()\n{\n   return this._vvcInstance.closeListener(this);\n};\n\n\n/**\n * Matches the listeners name to the given name.\n * Listener name can have wildcards.\n *\n * @param  {String}  name    The given name to match against.\n * @return {Boolean} matches Returns true if the name matches.\n */\nVVCListener.prototype.matchName = function(name)\n{\n   var wildcard = this.name.indexOf('*');\n\n   if (wildcard !== -1) {\n      return this.name.substr(0, wildcard) === name.substring(0, wildcard);\n   }\n\n   return this.name === name;\n};\n\n\n/**\n * Called when the VVC connection has been established on a session\n *\n * @callback VVCListener~onconnect\n * @param {VVCSession} session The session which has connected\n */\n\n\n/**\n * Called when the remote peer opens a channel on a session\n *\n * @callback VVCListener~onpeeropen\n * @param {VVCSession} session The session on which the channel was created\n * @param {VVCChannel} channel The new channel which is being created\n */\n\n\n/**\n * Called when the listener is closed\n *\n * @callback VVCListener~onclose\n */\n'use strict';\n\n/**\n * This is only to be created by a VVCSession.\n *\n * @classdesc The probe channel created and owned by a VVCSession.\n *\n * @constructor\n * @protected\n * @extends {VVCChannel}\n * @param {VVCSession} session The session this probe channel belongs to\n * @return {VVCProbeChannel}\n */\nvar VVCProbeChannel = function(session)\n{\n   VVCChannel.call(this, session,\n                   VVC.PROBE_CHANNEL_ID,\n                   VVC.PROBE_CHANNEL_NAME,\n                   0, 0, 0);\n\n   this.state = VVC.CHANNEL_STATE.OPEN;\n};\n\n\nVVCProbeChannel.prototype = Object.create(VVCChannel.prototype);\n\n/**\n * Probe channel id.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.PROBE_CHANNEL_ID = 1;\n\n\n/**\n * Probe channel name.\n *\n * @type {String}\n * @readonly\n * @default\n */\nVVC.PROBE_CHANNEL_NAME = 'vvcprobe';\n'use strict';\n\n/**\n * Use {@link VVC#openSession} to create a session.\n *\n * @classdesc A VVC session represents a physical connection to a remote server\n *\n * @constructor\n * @protected\n * @param {VVC}    vvcInstance The owner VVC instance\n * @param {Object} options     Optional settings\n * @return {VVCSession}\n */\nvar VVCSession = function(vvcInstance, options)\n{\n   var server = false;\n\n   if (options) {\n      if ('server' in options) {\n         server = options.server;\n      }\n   }\n\n   /**\n    * The current state of the session.\n    * @type {VVC.SESSION_STATE}\n    */\n   this.state = VVC.SESSION_STATE.INIT;\n\n   /**\n    * Callback for when an error occurs on the session.\n    * @type {VVCSession~onerror?}\n    */\n   this.onerror = null;\n\n   /**\n    * Callback for when the transport closes.\n    * @type {VVCSession~ontransportclose?}\n    */\n   this.ontransportclose = null;\n\n   /**\n    * Callback for when there is an error on the transport.\n    * @type {VVCSession~ontransporterror?}\n    */\n   this.ontransporterror = null;\n\n   /**\n    * The VVC instance this session belongs to.\n    * @private\n    * @type {VVC}\n    */\n   this._vvcInstance     = vvcInstance;\n\n   /**\n    * Is this session a server or client.\n    * @private\n    * @type {Boolean}\n    */\n   this._server          = server;\n\n   /**\n    * The channels opened on this session.\n    * @private\n    * @type {VVCChannel[]}\n    */\n   this._channels        = [];\n\n   /**\n    * Used for unique channel id generation, always an odd or even number\n    * depending on whether we are server or client respectively.\n    * @private\n    * @type {Number}\n    */\n   this._channelIdCtrl   = this._server ? 3 : 2;\n\n   /**\n    * Bytes read of current chunk.\n    * @private\n    * @type {Number}\n    */\n   this._bytesRead       = 0;\n\n   /**\n    * Bytes requested of current chunk.\n    * @private\n    * @type {Number}\n    */\n   this._bytesRequested  = VVC.CHUNK_COMMON_HEADER_SIZE;\n\n   /**\n    * History of round trip times, limited to VVC.RTT_HISTORY_SIZE.\n    * @private\n    * @type {Number[]}\n    */\n   this._rttHistory      = [];\n\n   /**\n    * Current index used for the circular buffer of VVCSession._rttHistory.\n    * @private\n    * @type {Number[]}\n    */\n   this._rttHistoryIndex = 0;\n\n   /**\n    * Current read chunk.\n    * @private\n    * @type {Object}\n    */\n   this._chunk = {};\n   this._chunk.channel = 0;\n   this._chunk.flags   = 0;\n   this._chunk.length  = 0;\n   this._chunk.ext = {};\n   this._chunk.ext.code   = 0;\n   this._chunk.ext.flags  = 0;\n   this._chunk.ext.param  = 0;\n   this._chunk.ext.length = 0;\n\n   /**\n    * Reusable buffers for reading and writing.\n    * @private\n    * @type {Object}\n    */\n   this._buffers = {};\n   this._buffers.ext = null;\n   this._buffers.data = [];\n   this._buffers.send = WMKS.Packet.createNewPacket(32);\n   this._buffers.header = WMKS.Packet.createNewPacket(VVC.CHUNK_COMMON_HEADER_SIZE +\n                                                      VVC.CHUNK_LARGE_HEADER_SIZE +\n                                                      VVC.CHUNK_EXTENSION_HEADER_SIZE);\n\n   /**\n    * The current receive state.\n    * @private\n    * @type {VVC.SESSION_RECEIVE_STATE}\n    */\n   this._receiveState = VVC.SESSION_RECEIVE_STATE.COMMON_HEADER;\n   this._setReceiveState(VVC.SESSION_RECEIVE_STATE.COMMON_HEADER);\n\n   return this;\n};\n\n\n/**\n * Size of the COMMON chunk header.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.CHUNK_COMMON_HEADER_SIZE = 4;\n\n\n/**\n * Size of the LARGE chunk header.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.CHUNK_LARGE_HEADER_SIZE = 4;\n\n\n/**\n * Size of the EXTENSION chunk header.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.CHUNK_EXTENSION_HEADER_SIZE = 4;\n\n\n/**\n * Maximum COMMON chunk data length.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.CHUNK_MAX_LEN = 0x00010000;\n\n\n/**\n * Maximum LARGE chunk data length.\n *\n * @type {Number}\n * @readonly\n * @default\n */\nVVC.CHUNK_LARGE_MAX_LEN = 0xfffffc00;\n\n\n/**\n * VVCSession state\n * @enum {Number}\n * @readonly\n */\nVVC.SESSION_STATE = {\n   INIT:        0,\n   ESTABLISHED: 1,\n   ERROR:       2,\n   CLOSING:     3\n};\n\n\n/**\n * VVCSession receive state\n * @enum {Number}\n * @readonly\n */\nVVC.SESSION_RECEIVE_STATE = {\n   COMMON_HEADER:    0,\n   LARGE_HEADER:     1,\n   EXTENSION_HEADER: 2,\n   EXTENSION_DATA:   3,\n   DATA:             4\n};\n\n\n/**\n * Chunk header flags\n * @enum {Number}\n * @readonly\n */\nVVC.CHUNK_FLAG = {\n   /** Chunk and extension data are padded to a multiple of 4 */\n   PAD: 0x10,\n\n   /** Extension header is present */\n   EXT: 0x20,\n\n   /** Large chunk data length is present */\n   LC:  0x40,\n\n   /** Indicates last chunk in a message */\n   FIN: 0x80,\n};\n\n\n/**\n * Chunk extension header flags\n * @enum {Number}\n * @readonly\n */\nVVC.CHUNK_EXT_FLAG = {\n   /** This is the last chunk extension header */\n   ELST: 0x40,\n\n   /** Extension data is present */\n   EDAT: 0x80,\n};\n\n\n/**\n * Chunk extension codes\n * @enum {Number}\n * @readonly\n */\nVVC.CHUNK_EXT_CODE = {\n   /** Use a large 32 bit channel id */\n   LARGE_CHANNEL_ID: 0x01,\n};\n\n\n/**\n * Closes the session\n *\n * @return {Boolean} Returns true on success\n */\nVVCSession.prototype.close = function()\n{\n   return this._vvcInstance.closeSession(this);\n};\n\n\n/**\n * Opens a channel on this session\n *\n * @param  {String}      name          Name of the channel to open\n * @param  {Number}      [priority]    Priority of the channel\n * @param  {Number}      [flags]       Channel flags\n * @param  {Number}      [timeout]     Channel timeout\n * @param  {Uint8Array}  [initialData] Data to send with the open request\n * @return {?VVCChannel}               A VVCChannel object, or null on error.\n */\nVVCSession.prototype.openChannel = function(name,\n                                            priority,\n                                            flags,\n                                            timeout,\n                                            initialData)\n{\n   var channel;\n\n   priority    = priority || 0;\n   flags       = flags || 0;\n   timeout     = timeout || 0;\n   initialData = initialData || null;\n\n   if (!this._checkErrorNameLength('openChannel', name)) {\n      return null;\n   }\n\n   if (!this._checkErrorSessionState('openChannel',\n                                     VVC.SESSION_STATE.ESTABLISHED)) {\n      return null;\n   }\n\n   if (!this._checkErrorInitialData('openChannel', initialData)) {\n      return null;\n   }\n\n   channel = this.createChannel(this._nextChannelId(),\n                                name,\n                                priority,\n                                flags,\n                                timeout);\n\n   this.controlChannel.sendOpenChannel(channel, initialData);\n   return channel;\n};\n\n\n/**\n * Accepts a channel on this session\n *\n * @param  {VVCChannel}  channel       The channel provided by onpeeropen\n * @param  {Number}      [flags]       Accept channel flags\n * @param  {Uint8Array}  [initialData] Data to send with the accept message\n * @return {?VVCChannel}               A VVCChannel object, or null on error.\n */\nVVCSession.prototype.acceptChannel = function(channel,\n                                              flags,\n                                              initialData)\n{\n   flags       = flags || 0;\n   initialData = initialData || null;\n\n   if (!this._checkErrorSessionState('acceptChannel',\n                                     VVC.SESSION_STATE.ESTABLISHED)) {\n      return null;\n   }\n\n   if (!this._checkErrorInitialData('acceptChannel', initialData)) {\n      return null;\n   }\n\n   if (!this._checkErrorIsChannel('acceptChannel', channel)) {\n      return null;\n   }\n\n   this.controlChannel.sendOpenChannelAck(channel,\n                                          VVC.OPEN_CHAN_STATUS.SUCCESS,\n                                          initialData);\n\n   this.onChannelOpen(channel,\n                      VVC.OPEN_CHAN_STATUS.SUCCESS,\n                      channel.initialData);\n\n   delete channel.initialData;\n   return channel;\n};\n\n\n/**\n * Rejects a channel open request\n *\n * @param  {VVCChannel} channel       The channel to reject opening\n * @param  {Uint8Array} [initialData] Data to send with the reject channel op\n * @return {Boolean}                  Returns true on succes\n */\nVVCSession.prototype.rejectChannel = function(channel, initialData)\n{\n   initialData = initialData || null;\n\n   if (!this._checkErrorSessionState('rejectChannel',\n                                     VVC.SESSION_STATE.ESTABLISHED)) {\n      return false;\n   }\n\n   if (!this._checkErrorInitialData('rejectChannel', initialData)) {\n      return false;\n   }\n\n   if (!this._checkErrorIsChannel('rejectChannel', channel)) {\n      return false;\n   }\n\n   this.controlChannel.sendOpenChannelAck(channel,\n                                          VVC.OPEN_CHAN_STATUS.REJECT,\n                                          initialData);\n\n   channel.state = VVC.CHANNEL_STATE.CLOSED;\n   this._releaseChannel(channel);\n   return true;\n};\n\n\n/**\n * Closes a channel\n *\n * @param  {VVCChannel} channel A valid VVCChannel to close\n * @return {Boolean}            Returns true on success\n */\nVVCSession.prototype.closeChannel = function(channel)\n{\n   if (!this._checkErrorSessionState('closeChannel',\n                                     VVC.SESSION_STATE.ESTABLISHED)) {\n      return false;\n   }\n\n   if (!this._checkErrorIsChannel('closeChannel', channel)) {\n      return false;\n   }\n\n   if (!this._checkErrorChannelState('closeChannel', channel,\n                                     VVC.CHANNEL_STATE.OPEN)) {\n      return false;\n   }\n\n   channel.state = VVC.CHANNEL_STATE.CLOSING;\n   this.controlChannel.sendCloseChannel(channel, VVC.CLOSE_CHAN_REASON.NORMAL);\n   return true;\n};\n\n\n/**\n * Add a RTT time to our circular buffer history.\n *\n * @protected\n * @param {Number} rttMS\n */\nVVCSession.prototype.addRttTime = function(rttMS)\n{\n   this._rttHistory[this._rttHistoryIndex] = rttMS;\n   this._rttHistoryIndex++;\n\n   if (this._rttHistoryIndex >= VVC.RTT_HISTORY_SIZE) {\n      this._rttHistoryIndex = 0;\n   }\n};\n\n\n/**\n * Attaches the session to a websocket.\n * Modifies the websocket's callbacks to point to our internal functions.\n * Sets the websocket's binary type to ArrayBuffer.\n *\n * @protected\n * @param  {WebSocket} socket   A websocket to attach to.\n * @return {Boolean}            Returns true on success.\n */\nVVCSession.prototype.attachToWebSocket = function(socket)\n{\n   var self = this;\n   this.socket = socket;\n\n   socket.onopen = function(evt) {\n      this.binaryType = 'arraybuffer';\n      self._onTransportOpen();\n   };\n\n   socket.onclose = function(evt) {\n      self._onTransportClose(evt);\n   };\n\n   socket.onerror = function(evt) {\n      self._onTransportError(evt);\n   };\n\n   socket.onmessage = function(evt) {\n      if (!(evt.data instanceof ArrayBuffer)) {\n         throw 'Expected ArrayBuffer from websocket';\n      }\n\n      self._onTransportRecv(new Uint8Array(evt.data));\n   };\n\n   // If socket is already open lets fake call onopen to start our session\n   if (socket.readyState) {\n      socket.onopen({});\n   }\n\n   return true;\n};\n\n\n/**\n * Generates an id value for a new channel.\n *\n * @private\n * @return {Number} New channel id\n */\nVVCSession.prototype._nextChannelId = function()\n{\n   var id = this._channelIdCtrl;\n   this._channelIdCtrl += 2;\n   return id;\n};\n\n\n/**\n * Creates a VVCChannel object and adds it to the channel list.\n *\n * @protected\n * @param  {Number}     id\n * @param  {String}     name\n * @param  {Number}     [priority]\n * @param  {Number}     [flags]\n * @param  {Number}     [timeout]\n * @return {VVCChannel}\n */\nVVCSession.prototype.createChannel = function(id,\n                                              name,\n                                              priority,\n                                              flags,\n                                              timeout)\n{\n   var channel;\n\n   priority = priority || 0;\n   timeout  = timeout || 0;\n   flags    = flags || 0;\n\n   channel = new VVCChannel(this, id, name, priority, flags, timeout);\n   this._channels[id] = channel;\n   this._buffers.data[id] = [];\n   return channel;\n};\n\n\n/**\n * Removes a channel from this session\n *\n * @private\n * @param  {VVCChannel} channel\n */\nVVCSession.prototype._releaseChannel = function(channel)\n{\n   if (channel.state === VVC.CHANNEL_STATE.OPEN) {\n      this._vvcInstance.setLastError(VVC.STATUS.PROTOCOL_ERROR,\n                                     'VVCSession._releaseChannel',\n                                     'Releasing an open channel!');\n   }\n\n   delete this._channels[channel.id];\n   delete this._buffers.data[channel.id];\n};\n\n\n/**\n * Gets a channel by id\n *\n * @protected\n * @param  {Number}      id      Channel ID\n * @return {?VVCChannel} channel\n */\nVVCSession.prototype.getChannel = function(id)\n{\n   if (!!this._channels[id]) {\n      return this._channels[id];\n   }\n\n   return null;\n};\n\n\n/**\n * Called when there is a error within the session.\n * Triggers the session.onerror callback.\n *\n * @protected\n * @param {VVC.STATUS} status  Error status code\n * @param {String}     where   Where the error occurred\n * @param {String}     message A hopefully useful description of error\n */\nVVCSession.prototype.onSessionError = function(status, where, message)\n{\n   this.state = VVC.SESSION_STATE.ERROR;\n   this._vvcInstance.setLastError(status, where, message);\n\n   if (this.onerror) {\n      this.onerror(status);\n   }\n};\n\n\n/**\n * Called when the session is closed.\n * Closes all open channels and calls either channel.onerror or channel.onclose\n *\n * @protected\n */\nVVCSession.prototype.onSessionClose = function()\n{\n   var channel, closeChanReason, i;\n\n   if (this.state === VVC.SESSION_STATE.ERROR) {\n      closeChanReason = VVC.CLOSE_CHAN_REASON.ERROR;\n   } else {\n      closeChanReason = VVC.CLOSE_CHAN_REASON.NORMAL;\n   }\n\n   this.state = VVC.SESSION_STATE.CLOSING;\n\n   try {\n      this.socket.close();\n   } catch (exc) {\n      this._onTransportException(exc);\n   }\n\n   for (i = 0; i < this._channels.length; ++i) {\n      channel = this._channels[i];\n\n      if (channel) {\n         if (channel.state === VVC.CHANNEL_STATE.INIT) {\n            this.onChannelOpen(channel, VVC.STATUS.ERROR);\n         } else if (channel.state === VVC.CHANNEL_STATE.OPEN\n                 || channel.state === VVC.CHANNEL_STATE.CLOSING) {\n            channel.state = VVC.CHANNEL_STATE.CLOSING;\n            this.onChannelClose(channel, closeChanReason);\n         }\n      }\n   }\n};\n\n\n/**\n * Called when the control channel receives an INIT or INIT_ACK message.\n * Triggers the listener.onconnect callback.\n *\n * @protected\n */\nVVCSession.prototype.onConnect = function()\n{\n   var i, listener, listeners;\n\n   listeners = this._vvcInstance._findSessionListeners(this);\n   this.state = VVC.SESSION_STATE.ESTABLISHED;\n\n   for (i = 0; i < listeners.length; ++i) {\n      listener = listeners[i];\n\n      if (listener.onconnect) {\n         listener.onconnect(this);\n      }\n   }\n};\n\n\n/**\n * Called when the control channel receives an OPEN_CHAN message.\n * Triggers the listener.onpeeropen callback.\n *\n * @protected\n * @param {VVCChannel} channel The new channel being opened\n */\nVVCSession.prototype.onPeerOpen = function(channel)\n{\n   var i, listener, listeners;\n\n   listeners = this._vvcInstance._findSessionListeners(this);\n\n   for (i = 0; i < listeners.length; ++i) {\n      listener = listeners[i];\n\n      if (listener.matchName(channel.name)) {\n         if (listener.onpeeropen) {\n            listener.onpeeropen(this, channel);\n         }\n      }\n   }\n};\n\n\n/**\n * Called when the control channel receives an OPEN_CHAN_ACK message.\n * Triggers the channel.onopen callback.\n *\n * @protected\n * @param {VVCChannel}           channel     The new channel being opened\n * @param {VVC.OPEN_CHAN_STATUS} status      The status of the open\n * @param {Uint8Array?}          initialData Data that came with the open msg\n */\nVVCSession.prototype.onChannelOpen = function(channel, status, initialData)\n{\n   if (status === VVC.OPEN_CHAN_STATUS.SUCCESS) {\n      channel.state = VVC.CHANNEL_STATE.OPEN;\n      if (channel.onopen) {\n         channel.onopen(this._createEvent('open', { data: initialData }));\n      }\n   } else {\n      channel.state = VVC.CHANNEL_STATE.OPEN_FAILED;\n      this._releaseChannel(channel);\n      this.onChannelError(channel);\n   }\n};\n\n\n/**\n * Called when an error occurs on a channel.\n * Triggers the channel.onerror callback.\n *\n * @protected\n * @param {VVCChannel} channel The channel which had the error\n */\nVVCSession.prototype.onChannelError = function(channel)\n{\n   if (channel.onerror) {\n      channel.onerror(this._createEvent('error'));\n   }\n};\n\n\n/**\n * Called when a channel receives a message.\n * Triggers the channel.onmessage callback.\n *\n * @protected\n * @param {VVCChannel} channel The channel receiving the message\n * @param {ArrayBuffer} data   The message data\n */\nVVCSession.prototype.onChannelMessage = function(channel, data)\n{\n   if (!channel) {\n      // Ignore any unknown channel messages if the socket is closing or closed.\n      if (this.socket.readyState === WebSocket.OPEN) {\n         this.onSessionError(VVC.STATUS.PROTOCOL_ERROR,\n                             'VVCSession.onChannelMessage',\n                             'Unknown channel in chunk');\n      }\n\n      return;\n   }\n\n   if (channel.onmessage) {\n      channel.onmessage(this._createEvent('message', { data: data }));\n   }\n};\n\n\n/**\n * Called when the control channel receives an CLOSE_CHAN or CLOSE_CHAN_ACK.\n * Triggers the channel.onclose callback.\n * Removes the channel from the session's channel list.\n *\n * @protected\n * @param {VVCChannel}            channel The channel being close\n * @param {VVC.CLOSE_CHAN_REASON} reason  The reason for closing\n */\nVVCSession.prototype.onChannelClose = function(channel, reason)\n{\n   var code;\n\n   if (reason === VVC.CLOSE_CHAN_REASON.NORMAL) {\n      code = 1000; // WebSocket 'normal close'\n\n      if (channel.state === VVC.CHANNEL_STATE.CLOSING) {\n         channel.state = VVC.CHANNEL_STATE.PEER_CLOSED;\n      } else {\n         channel.state = VVC.CHANNEL_STATE.PEER_CLOSING;\n         this.controlChannel.sendCloseChannelAck(channel, VVC.CLOSE_CHAN_STATUS.SUCCESS);\n      }\n   } else {\n      code = 1002; // WebSocket 'protocol error'\n   }\n\n   if (channel.onclose) {\n      channel.onclose(this._createEvent('close', {\n         wasClean: (reason === VVC.CLOSE_CHAN_REASON.NORMAL),\n         reason: reason,\n         code: code\n      }));\n   }\n\n   channel.state = VVC.CHANNEL_STATE.CLOSED;\n   this._releaseChannel(channel);\n};\n\n\n/**\n * Creates the probe channel.\n * @protected\n */\nVVCSession.prototype.createProbeChannel = function()\n{\n   // Create probe channel and add it to channel list\n   this.probeChannel = new VVCProbeChannel(this);\n   this._channels[this.probeChannel.id] = this.probeChannel;\n   this._buffers.data[this.probeChannel.id] = [];\n};\n\n\n/**\n * Creates the control channel.\n * @private\n */\nVVCSession.prototype._createControlChannel = function()\n{\n   // Create control channel and add it to channel list\n   this.controlChannel = new VVCControlChannel(this);\n   this._channels[this.controlChannel.id] = this.controlChannel;\n   this._buffers.data[this.controlChannel.id] = [];\n};\n\n\n/**\n * Called when the transport opens.\n * @private\n */\nVVCSession.prototype._onTransportOpen = function()\n{\n   this._createControlChannel();\n\n   // It is the clients responsibility to send the first control init message\n   if (!this._server) {\n      this.controlChannel.sendInit(VVC.CTRL_OP.INIT);\n   }\n};\n\n\n/**\n * Called when the transport closes.\n * @private\n */\nVVCSession.prototype._onTransportClose = function(evt)\n{\n   if (this.state === VVC.SESSION_STATE.ESTABLISHED) {\n      this.onSessionError(VVC.TRANSPORT_ERROR,\n                          'VVCSession._onTransportClose',\n                          'The WebSocket closed whilst the session was open.');\n   }\n\n   if (this.ontransportclose) {\n      this.ontransportclose(evt);\n   }\n};\n\n\n/**\n * Called when the transport errors.\n * @private\n */\nVVCSession.prototype._onTransportError = function(evt)\n{\n   this.onSessionError(VVC.TRANSPORT_ERROR,\n                       'VVCSession._onTransportError',\n                       'An error occurred in the WebSocket.');\n\n   if (this.ontransporterror) {\n      this.ontransporterror(evt);\n   }\n};\n\n\n/**\n * Called when the transport throws exceptions.\n * @private\n */\nVVCSession.prototype._onTransportException = function(exc)\n{\n   this.onSessionError(VVC.TRANSPORT_ERROR,\n                       'VVCSession._onTransportException',\n                       'An exception occurred in the WebSocket: ' + exc.message);\n\n   if (this.ontransporterror) {\n      this.ontransporterror(this._createEvent('error'));\n   }\n};\n\n\n/**\n * Combines multiple Uint8Array into a single ArrayBuffer.\n *\n * @private\n * @param  {Uint8Array[]} buffers  The split multiple Uint8Array buffers.\n * @return {ArrayBuffer}  combined The combined single ArrayBuffer\n */\nVVCSession.prototype._combineBuffers = function(buffers)\n{\n   var array, buffer, i, size;\n\n   if (buffers.length === 0) {\n      return null;\n   }\n\n   size = 0;\n\n   for (i = 0; i < buffers.length; ++i) {\n      size += buffers[i].length;\n   }\n\n   buffer = new ArrayBuffer(size);\n   array  = new Uint8Array(buffer);\n   size   = 0;\n\n   for (i = 0; i < buffers.length; ++i) {\n      array.set(buffers[i], size);\n      size += buffers[i].length;\n   }\n\n   return buffer;\n};\n\n\n/**\n * Sets the next receive state.\n * Asks for the appropriate amount of bytes to be read from transport.\n *\n * @private\n * @param  {VVC.SESSION_RECEIVE_STATE} state The next receive state\n */\nVVCSession.prototype._setReceiveState = function(state)\n{\n   this._receiveState = state;\n\n   switch(state) {\n      case VVC.SESSION_RECEIVE_STATE.COMMON_HEADER:\n         this._bytesRequested = VVC.CHUNK_COMMON_HEADER_SIZE;\n         this._bytesRead = 0;\n         this._buffers.header.reset();\n         break;\n      case VVC.SESSION_RECEIVE_STATE.LARGE_HEADER:\n         this._bytesRequested += VVC.CHUNK_LARGE_HEADER_SIZE;\n         break;\n      case VVC.SESSION_RECEIVE_STATE.EXTENSION_HEADER:\n         this._bytesRequested += VVC.CHUNK_EXTENSION_HEADER_SIZE;\n         break;\n      case VVC.SESSION_RECEIVE_STATE.EXTENSION_DATA:\n         this._bytesRequested += this._chunk.ext.length;\n         break;\n      case VVC.SESSION_RECEIVE_STATE.DATA:\n         this._bytesRequested += this._chunk.length;\n         break;\n   }\n};\n\n\n/**\n * Called when the underlying transport receives data.\n * Reads the chunk headers and forwards messages to the correct channel.\n *\n * @private\n * @param  {Uint8Array} data The raw binary data from the transport.\n */\nVVCSession.prototype._onTransportRecv = function(data)\n{\n   var buffer, bytesNeeded, bytesRead, dataRead;\n\n   bytesNeeded = this._bytesRequested - this._bytesRead;\n   bytesRead   = Math.min(data.length, bytesNeeded);\n   dataRead    = data.subarray(0, bytesRead);\n   buffer      = null;\n\n   switch(this._receiveState) {\n   case VVC.SESSION_RECEIVE_STATE.COMMON_HEADER:\n   case VVC.SESSION_RECEIVE_STATE.LARGE_HEADER:\n   case VVC.SESSION_RECEIVE_STATE.EXTENSION_HEADER:\n      buffer = this._buffers.header;\n      break;\n   case VVC.SESSION_RECEIVE_STATE.EXTENSION_DATA:\n      buffer = this._buffers.ext;\n      break;\n   case VVC.SESSION_RECEIVE_STATE.DATA:\n      this._buffers.data[this._chunk.channel].push(dataRead);\n\n      if (this._chunk.channel !== VVC.CONTROL_CHANNEL_ID && bytesRead) {\n         this.controlChannel.sendRecvAck(bytesRead);\n      }\n      break;\n   }\n\n   if (buffer) {\n      buffer.writeArray(dataRead);\n   }\n\n   this._bytesRead += bytesRead;\n\n   if (data.length < bytesNeeded) {\n      return;\n   }\n\n   switch (this._receiveState) {\n   case VVC.SESSION_RECEIVE_STATE.COMMON_HEADER:\n      this._chunk.channel = buffer.readUint8();\n      this._chunk.flags   = buffer.readUint8();\n      this._chunk.length  = buffer.readUint16() + 1;\n\n      if (this._chunk.flags & VVC.CHUNK_FLAG.LC) {\n         this._setReceiveState(VVC.SESSION_RECEIVE_STATE.LARGE_HEADER);\n      } else if (this._chunk.flags & VVC.CHUNK_FLAG.EXT) {\n         this._setReceiveState(VVC.SESSION_RECEIVE_STATE.EXTENSION_HEADER);\n      } else {\n         this._setReceiveState(VVC.SESSION_RECEIVE_STATE.DATA);\n      }\n      break;\n   case VVC.SESSION_RECEIVE_STATE.LARGE_HEADER:\n      this._chunk.length = buffer.readUint32() + 1;\n\n      if (this._chunk.flags & VVC.CHUNK_FLAG.EXT) {\n         this._setReceiveState(VVC.SESSION_RECEIVE_STATE.EXTENSION_HEADER);\n      } else {\n         this._setReceiveState(VVC.SESSION_RECEIVE_STATE.DATA);\n      }\n      break;\n   case VVC.SESSION_RECEIVE_STATE.EXTENSION_HEADER:\n      this._chunk.ext.code  = buffer.readUint8();\n      this._chunk.ext.flags = buffer.readUint8();\n      this._chunk.ext.param = buffer.readUint16();\n\n      if (this._chunk.ext.flags & VVC.CHUNK_EXT_FLAG.EDAT) {\n         this._chunk.ext.length = this._chunk.ext.param + 1;\n         this._buffers.ext = new WMKS.Packet.createNewPacket(this._chunk.ext.length);\n         this._setReceiveState(VVC.SESSION_RECEIVE_STATE.EXTENSION_DATA);\n      } else {\n         this._chunk.ext.length = 0;\n\n         if (this._chunk.ext.flags & VVC.CHUNK_EXT_FLAG.ELST) {\n            this._setReceiveState(VVC.SESSION_RECEIVE_STATE.DATA);\n         } else {\n            this._setReceiveState(VVC.SESSION_RECEIVE_STATE.EXTENSION_HEADER);\n         }\n      }\n      break;\n   case VVC.SESSION_RECEIVE_STATE.EXTENSION_DATA:\n      if (this._chunk.ext.code == VVC.CHUNK_EXT_CODE.LARGE_CHANNEL_ID) {\n         if (buffer.bytesRemaining() >= 4) {\n            this._chunk.channel = buffer.readUint32();\n         }\n      }\n\n      this._buffers.ext = null;\n\n      if (this._chunk.ext.flags & VVC.CHUNK_EXT_FLAG.ELST) {\n         this._setReceiveState(VVC.SESSION_RECEIVE_STATE.DATA);\n      } else {\n         this._setReceiveState(VVC.SESSION_RECEIVE_STATE.EXTENSION_HEADER);\n      }\n      break;\n   case VVC.SESSION_RECEIVE_STATE.DATA:\n      if (this._chunk.flags & VVC.CHUNK_FLAG.FIN) {\n         buffer = this._combineBuffers(this._buffers.data[this._chunk.channel]);\n         this.onChannelMessage(this._channels[this._chunk.channel], buffer);\n         this._buffers.data[this._chunk.channel] = [];\n      }\n\n      this._setReceiveState(VVC.SESSION_RECEIVE_STATE.COMMON_HEADER);\n      break;\n   }\n\n   if (data.length > bytesRead) {\n      this._onTransportRecv(data.subarray(bytesRead));\n   }\n};\n\n\n/**\n * Send data on a channel.\n * Constructs the appropriate chunk header.\n *\n * @protected\n * @param  {VVCChannel}             channel The channel to send data on\n * @param  {Uint8Array|ArrayBuffer} data    The data to send\n * @return {Boolean}                        Returns true on succesful send.\n */\nVVCSession.prototype.send = function(channel, data)\n{\n   var header, flags, length;\n\n   if (!this._checkErrorIsChannel('send', channel)) {\n      return false;\n   }\n\n   if (!this._checkErrorChannelState('send', channel,\n                                     VVC.CHANNEL_STATE.OPEN)) {\n      return false;\n   }\n\n   if (!(data instanceof Uint8Array) && !(data instanceof ArrayBuffer)) {\n      this._vvcInstance.setLastError(VVC.STATUS.INVALID_ARGS,\n                                     'VVCSession.send',\n                                     'Invalid data, must be Uint8Array'\n                                     + ' or ArrayBuffer');\n      return false;\n   }\n\n   header = this._buffers.send;\n   header.reset();\n   header.writeUint8(channel.id);\n\n   length = data.byteLength;\n   flags  = VVC.CHUNK_FLAG.FIN;\n\n   if (length > VVC.CHUNK_MAX_LEN) {\n      header.writeUint8(VVC.CHUNK_FLAG.LC | flags);\n      header.writeUint16(0);\n      header.writeUint32(length - 1);\n   } else {\n      header.writeUint8(flags);\n      header.writeUint16(length - 1);\n   }\n\n   try {\n      this.socket.send(header.getData());\n      this.socket.send(data);\n   } catch (exc) {\n      this._onTransportException(exc);\n   }\n\n   return true;\n};\n\n\n/**\n * Creates an Event object.\n *\n * Needed because Internet Explorer does not allow new Event();\n *\n * @private\n * @param {String} name       The event name\n * @param {Object} properties Properties to copy to the event\n * @return {Event}            Returns newly constructed event\n */\nVVCSession.prototype._createEvent = function(name, properties)\n{\n   var evt = document.createEvent('Event');\n   evt.initEvent(name, false, false);\n\n   for (var key in properties) {\n      evt[key] = properties[key];\n   }\n\n   return evt;\n};\n\n\n/**\n * Returns false and sets an error if the provided object is not a channel.\n * object must be instanceof VVCChannel\n *\n * @private\n * @param  {String}  func   Function name for error logging\n * @param  {Object}  object Object to check type of\n * @return {Boolean}        Returns true if object is a VNCChannel\n */\nVVCSession.prototype._checkErrorIsChannel = function(func, object)\n{\n   if (!(object instanceof VVCChannel)) {\n      this._vvcInstance.setLastError(VVC.STATUS.INVALID_ARGS,\n                                     'VVCSession.' + func,\n                                     'Invalid channel,'\n                                      + ' must be instanceof VVCChannel');\n      return false;\n   }\n\n   return true;\n};\n\n\n/**\n * Returns false and sets an error if the session state is not a value.\n *\n * @private\n * @param  {String}            func  Function name for error logging\n * @param  {VVC.SESSION_STATE} state State the session must be in\n * @return {Boolean}                 Returns true if state is correct\n */\nVVCSession.prototype._checkErrorSessionState = function(func, state)\n{\n   if (this.state !== state) {\n      this._vvcInstance.setLastError(VVC.STATUS.INVALID_STATE,\n                                     'VVCSession.' + func,\n                                     'Invalid state ' + this.state\n                                     + ' expected ' + state);\n      return false;\n   }\n\n   return true;\n};\n\n\n/**\n * Returns false and sets an error if the channel state is not a value.\n *\n * @private\n * @param  {String}            func    Function name for error logging\n * @param  {VVCChannel}        channel The channel for which state to check\n * @param  {VVC.SESSION_STATE} state   State the session must be in\n * @return {Boolean}                   Returns true if state is correct\n */\nVVCSession.prototype._checkErrorChannelState = function(func, channel, state)\n{\n   if (channel.state !== state) {\n      this._vvcInstance.setLastError(VVC.STATUS.INVALID_STATE,\n                                     'VVCSession.' + func,\n                                     'Invalid state ' + channel.state\n                                     + ' expected ' + state);\n      return false;\n   }\n\n   return true;\n};\n\n\n/**\n * Returns false and sets an error if the length of name is invalid.\n * name must be between VVC.MIN_CHANNEL_NAME_LEN and VVC.MAX_CHANNEL_NAME_LEN.\n *\n * @private\n * @param  {String}  func Function name for error logging\n * @param  {String}  name Name to check\n * @return {Boolean}      Returns true if name length is valid\n */\nVVCSession.prototype._checkErrorNameLength = function(func, name)\n{\n   if (name.length < VVC.MIN_CHANNEL_NAME_LEN ||\n       name.length > VVC.MAX_CHANNEL_NAME_LEN) {\n      this._vvcInstance.setLastError(VVC.STATUS.INVALID_ARGS,\n                                     'VVCSession.' + func,\n                                     'Invalid name ' + name\n                                     + ' length must be between '\n                                     + VVC.MIN_CHANNEL_NAME_LEN + ' and '\n                                     + VVC.MAX_CHANNEL_NAME_LEN + ' bytes');\n      return false;\n   }\n\n   return true;\n};\n\n\n/**\n * Returns false and sets an error if the initialData is invalid.\n * initialData must be a Uint8Array smaller than VVC.MAX_INITIAL_DATA_LEN.\n *\n * @private\n * @param  {String}     func        Function name for error logging\n * @param  {Uint8Array} initialData Data to check\n * @return {Boolean}                Returns true if initialData is valid\n */\nVVCSession.prototype._checkErrorInitialData = function(func, initialData)\n{\n   if (initialData && !(initialData instanceof Uint8Array)) {\n      this._vvcInstance.setLastError(VVC.STATUS.INVALID_ARGS,\n                                     'VVCSession.' + func,\n                                     'Invalid initial data,'\n                                      + ' must be instanceof Uint8Array');\n      return false;\n   }\n\n   if (initialData && initialData.length > VVC.MAX_INITIAL_DATA_LEN) {\n      this._vvcInstance.setLastError(VVC.STATUS.INVALID_ARGS,\n                                     'VVCSession.' + func,\n                                     'Invalid initial data,'\n                                      + ' must be smaller than '\n                                      + VVC.MAX_INITIAL_DATA_LEN + ' bytes');\n      return false;\n   }\n\n   return true;\n};\n\n\n/**\n * Called when there is an error with the channel.\n * @callback VVCSession~onerror\n */\n\n\n/**\n * Called when the transport closes.\n * @callback VVCSession~ontransportclose\n * @param {Event} event\n */\n\n\n/**\n * Called when there is an error on the transport.\n * @callback VVCSession~ontransporterror\n * @param {Event} event\n */\n/* global $:false, WMKS:false */\n\n/*\n *------------------------------------------------------------------------------\n * wmks/relativeMouseHandler.js\n *\n *    This class abstracts relative mouse management and decouples this\n *    functionality from the widgetProto.\n *\n *    All variables are defined as private variables. Functions that do not\n *    need to be exposed should be private too.\n *\n *------------------------------------------------------------------------------\n */\n\nWMKS.RelativeMouseHandler = function(options) {\n   'use strict';\n   if (!options || !options.canvas ||\n       !options.widgetProto) {\n      WMKS.LOGGER.warn('Invalid params set for RelativeMouseHandler.');\n      return null;\n   }\n\n   var _widget = options.widgetProto,\n       _canvas = options.canvas,     // Canvas where all the action happens.\n       _onToggle = options.onToggle; // Toggle callback function.\n\n   // List of jQuery objects that are used frequently.\n   var _ELEMENTS = {\n         inputProxy        : null,\n         cursorIcon        : null,\n         clickFeedback     : null,\n         dragFeedback      : null,\n         pulseFeedback     : null,\n         scrollFeedback    : null,\n         keypad            : null,\n         relativePad       : null\n       };\n\n   /****************************************************************************\n    * Public Functions\n    ***************************************************************************/\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * toggleTrackpad\n    *\n    *    Called when the user wants to toggle trackpad visibility.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.toggleRelativePad = function(options) {\n      if (_ELEMENTS.relativePad) {\n         // Set toggle callback function.\n         options = $.extend({}, options, {\n            toggleCallback: _onToggle\n         });\n         // Show / hide trackpad.\n         _ELEMENTS.relativePad.toggle(options);\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * installTouchHandlers\n    *\n    *    Install event handlers for touch devices.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.installMouseHandlers = function() {\n      var self = this,\n          container = _canvas.parent();\n\n      // Set css values to disable unwanted default browser behavior.\n      _canvas.css({\n         '-webkit-user-select':     'none',  /* disable cut-copy-paste */\n         '-webkit-touch-callout':   'none'   /* disable callout, image save panel */\n      });\n\n      // Create touch feedbacks.\n      _ELEMENTS.cursorIcon = $('<div/>')\n         .addClass('feedback-container cursor-icon')\n         .appendTo(container);\n      _ELEMENTS.clickFeedback = $('<div/>')\n         .addClass('feedback-container tap-icon')\n         .appendTo(container);\n      _ELEMENTS.dragFeedback = $('<div/>')\n         .addClass('feedback-container drag-icon')\n         .appendTo(container);\n      _ELEMENTS.pulseFeedback = $('<div/>')\n         .addClass('feedback-container pulse-icon')\n         .appendTo(container);\n      _ELEMENTS.scrollFeedback = $('<div/>')\n         .addClass('feedback-container scroll-icon')\n         .appendTo(container);\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * initializeRelativeMouseFeature\n    *\n    *    This function initializes the touch feature that's requested.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.initializeRelativeMouseFeature = function() {\n      _ELEMENTS.relativePad = new WMKS.relativePadManager(_widget, _canvas);\n      _ELEMENTS.relativePad.initialize();\n   };\n\n      /*\n    *---------------------------------------------------------------------------\n    *\n    * moveCursor\n    *\n    *    Repositions the fake caret to match the given touch's location. Since\n    *    the 'tip' of the caret represents the click location, no centering is\n    *    desired.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.moveCursor = function(pageX, pageY) {\n      if (_ELEMENTS.cursorIcon) {\n         _ELEMENTS.cursorIcon.css({'left': pageX, 'top': pageY});\n      }\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * setCursorVisibility\n    *\n    *    Hide or show the fake caret.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.setCursorVisibility = function(visible) {\n      if (_ELEMENTS.cursorIcon) {\n         if (visible) {\n            _ELEMENTS.cursorIcon.show();\n         } else {\n            _ELEMENTS.cursorIcon.hide();\n         }\n      }\n   };\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * destroy\n    *\n    *    Destroys the TouchHandler.\n    *\n    *    This will disconnect all (if active) and remove\n    *    the widget from the associated element.\n    *\n    *    Consumers should call this before removing the element from the DOM.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   this.destroy = function() {\n      // Cleanup private variables.\n      _widget = null;\n      _canvas = null;\n      _ELEMENTS = null;\n   };\n\n};/*\n *------------------------------------------------------------------------------\n *\n * wmks/relativePadManager.js\n *\n *   The controller of relativepad widget.\n *\n *------------------------------------------------------------------------------\n */\n(function() {\n   'use strict';\n\n   // Trackpad related constants.\n   WMKS.CONST.RELATIVEPAD = {\n      STATE: {\n         idle:         0,\n         click:        1,\n         move:         3,\n         scroll:       4\n      }\n   };\n\n   WMKS.relativePadManager = function(widget, canvas) {\n      // Call constructor so dialogManager's params are included here.\n      WMKS.dialogManager.call(this);\n      this._widget = widget;\n      this._canvas = canvas;\n      // Trackpad state machine.\n      this.state = WMKS.CONST.RELATIVEPAD.STATE.idle;\n      this.history = [];\n      // Override default options with options here.\n      $.extend(this.options,\n               {\n                  name: 'RELATIVEPAD',\n                  speedControlMinMovePx: 5,\n                  // Speed control for relative trackpad\n                  accelerator:           10,\n                  minSpeed:              1,\n                  maxSpeed:              10\n               });\n      WMKS.LOGGER.warn('relativepad : ' + this.options.name);\n   };\n\n   WMKS.relativePadManager.prototype =  new WMKS.dialogManager();\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * getRelativepadHtml\n    *\n    *    Function to get the relativepad html layout.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.relativePadManager.prototype.getTrackpadHtml = function() {\n      var str = '<div id=\"relativePad\" class=\"relativepad-container\">\\\n                   <div class=\"left-border\"></div>\\\n                   <div id=\"relativePadSurface\" style=\"height:200px; border:1px solid black;\"></div>\\\n                   <div class=\"right-border\"></div>\\\n                   <div class=\"bottom-border\">\\\n                      <div class=\"button-container\">\\\n                         <div id=\"relativepadLeft\" class=\"button-left\"></div>\\\n                         <div id=\"relativepadRight\" class=\"button-right\"></div>\\\n                      </div>\\\n                   </div>\\\n               </div>';\n\n      return str;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * create\n    *\n    *    This function initializes the relativepad dialog, toggle highlighting on close\n    *    handler.\n    *\n    * HACK\n    *    There is no easy way to determine close by menu click vs clicking close\n    *    icon. Hence using the event.target to determine it was from clicking\n    *    close icon. It will not work well when closeOnEscape is true. We don't\n    *    need this on ipad, so its good.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.relativePadManager.prototype.create = function() {\n      var dialog,\n          self = this;\n\n      if (!this._widget ||\n          !this._canvas) {\n         WMKS.LOGGER.debug('Trackpad dialog creation has been aborted. Widget or Canvas is not ready.');\n         return null;\n      }\n\n      dialog = $(this.getTrackpadHtml());\n      dialog.dialog({\n         autoOpen: false,\n         closeOnEscape: true,\n         resizable: false,\n         position: {my: 'center', at: 'center', of: this._canvas},\n         zIndex: 1000,\n         draggable: true,\n         dialogClass: 'relativepad-wrapper',\n         close: function(e) {\n            self.sendUpdatedState(false);\n         },\n         create: function(e) {\n            self.layout($(this).parent());\n         }\n      });\n\n      return dialog;\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * init\n    *\n    *    This function initializes the event handlers for the relativepad.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.relativePadManager.prototype.init = function() {\n      var dialog = this.dialog,\n          self = this,\n          relativepad,\n          left,\n          right;\n      if (!dialog) {\n         WMKS.LOGGER.debug('Relativepad init aborted. Dialog is not created successfully.');\n         return;\n      }\n\n      // Request reposition of relativepad dialog upon orientation changes.\n      this._widget.requestElementReposition(dialog.parent(), true);\n\n      // Initialize event handlers for the relativepad.\n      relativepad = dialog\n         .find('#relativePadSurface')\n         .on('mousemove', function(e) {\n            return self.relativepadMouseMove(e.originalEvent);\n         }).on('mouseup', function(e) {\n            return self.relativepadMouseClick(e,0);\n         }).on('mousedown', function(e) {\n            return self.relativepadMouseClick(e,1);\n         }).on('contextmenu',function(){\n            return false;\n         });\n   };\n\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * disconnect\n    *\n    *    This function unbinds the event handlers for the relativepad.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.relativePadManager.prototype.disconnect = function() {\n      var dialog = this.dialog,\n          relativepad;\n\n      if (!dialog) {\n         return;\n      }\n\n      // Unregister event handlers for the relativepad.\n      relativepad = dialog\n         .find('#relativepadSurface')\n         .off('mousemove')\n         .off('mouseup')\n         .off('mousedown');\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * layout\n    *\n    *    Reposition the dialog in order to center it to the canvas.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.relativePadManager.prototype.layout = function(dialog) {\n      var canvas = this._canvas,\n          dialogParent,\n          canvasParent;\n\n      if (!dialog ||\n          !canvas) {\n         return;\n      }\n\n      dialogParent = dialog.parent();\n      canvasParent = canvas.parent();\n\n      if (dialogParent !== canvasParent) {\n         // Append the dialog to the parent of the canvas,\n         // so that it's able to center the dialog to the canvas.\n         canvasParent.append(dialog);\n      }\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * relativepadMouseMove\n    *\n    *    Fires when a mouse moves within the relative trackpad's  area. If the\n    *    action is currently marked as a click, promotes it into a move. If it\n    *    is already one or the other, stick to that type.\n    *\n    *    However, if the mouse moves outside the area while moving, then set the\n    *    state back to the click and clear up history in case user comes back into\n    *    the hot region.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.relativePadManager.prototype.relativepadMouseMove = function(e) {\n      var pX, pY, newLocation, diffLocation,\n          self = $(e.target),\n          widget = this._widget;\n      if (this.state === WMKS.CONST.RELATIVEPAD.STATE.idle) {\n         return false;\n      }\n\n      pX = e.pageX;\n      pY = e.pageY;\n\n      // Verify if the touchmove is outside business (hot) region of trackpad.\n      if (pY < self.offset().top || pY > (self.offset().top + self.height()) ||\n            pX < self.offset().left || pX > (self.offset().left + self.width())) {\n         // Reset to tap start state, as the user went outside the business region.\n         if (this.state === WMKS.CONST.RELATIVEPAD.STATE.move) {\n            this.state = WMKS.CONST.RELATIVEPAD.STATE.idle;\n            this.history.length = 0;\n         }\n         return false;\n      }\n\n      if (this.state === WMKS.CONST.RELATIVEPAD.STATE.move) {\n         newLocation = this.computeNewCursorLocation(pX, pY);\n         if (WMKS.VNCDecoder.cursorPosition) {\n            diffLocation = this._widget.getRelativeMouseCanvasPosition(WMKS.VNCDecoder.cursorPosition);\n            widget._relativeMouseHandler.moveCursor(diffLocation.x, diffLocation.y);\n         }\n         widget.sendMouseMoveMessage(newLocation);\n         // Make room for a new history entry\n         this.history.shift();\n\n         // Push a new history entry\n         this.history.push({x: pX, y: pY });\n      }\n\n      // Detect if this is a drag or a scroll. If so, add a history entry.\n      if (this.state === WMKS.CONST.RELATIVEPAD.STATE.click) {\n         this.state = WMKS.CONST.RELATIVEPAD.STATE.move;\n         // Make up history based on the current point if there isn't any yet.\n         this.history.push({x: pX, y: pY}, {x: pX, y: pY}, {x: pX, y: pY});\n      }\n      return false;\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * computeNewCursorLocation\n    *\n    *    This function takes the new location and computes the destination mouse\n    *    cursor location. The computation is based on the acceleration to be used,\n    *    making sure the new location is within the screen area.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.relativePadManager.prototype.computeNewCursorLocation = function(pX, pY) {\n      var dist,\n          point = { x:0,y:0 };\n      // First compute the distance from the last location.\n      dist = WMKS.UTIL.getLineLength(\n         (pX - this.history[2].x), (pY - this.history[2].y));\n      if (isNaN(dist) || dist === 0) {\n         // There is no change, return the old location.\n         return point;\n      } else if (dist < this.options.speedControlMinMovePx) {\n         // The cursor has only moved a few pixels, apply the delta directly.\n         point.x = pX - this.history[2].x;\n         point.y = pY - this.history[2].y;\n      } else {\n         // From now on, though, use device pixels (later, compensate for hi-DPI)\n         dist = this.computeMovingDistance(pX, pY);\n         point.x = Math.floor(dist[0]);\n         point.y = Math.floor(dist[1]);\n      }\n      return point;\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * computeMovingDistance\n    *\n    *    Based on a current point and point history, gets the amount of distance\n    *    the mouse should move based on this data.\n    *\n    * Results:\n    *    A 2-tuple of (dx, dy)\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.relativePadManager.prototype.computeMovingDistance = function(x, y) {\n      var dx, dy, dist, speed;\n\n      dx = this.getTrackpadSpeed(x,\n         this.history[0].x,\n         this.history[1].x,\n         this.history[2].x);\n      dy = this.getTrackpadSpeed(y,\n         this.history[0].y,\n         this.history[1].y,\n         this.history[2].y);\n\n      dist = WMKS.UTIL.getLineLength(dx, dy);\n\n      speed = dist * this.options.accelerator;\n      if (speed > this.options.maxSpeed) {\n         speed = this.options.maxSpeed;\n      } else if (speed < this.options.minSpeed) {\n         speed = this.options.minSpeed;\n      }\n\n      return [dx * speed, dy * speed];\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * getTrackpadSpeed\n    *\n    *    Performs a linear least squares operation to get the slope of the line\n    *    that best fits all four points. This slope is the current speed of the\n    *    trackpad, assuming equal time between samples.\n    *\n    *    Returns the speed as a floating point number.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.relativePadManager.prototype.getTrackpadSpeed = function(x0, x1, x2, x3) {\n      return x0 * 0.3 + x1 * 0.1 - x2 * 0.1 - x3 * 0.3;\n   };\n   /*\n    *---------------------------------------------------------------------------\n    *\n    * relativepadMouseClick\n    *\n    *    Fires when either one of the virtual trackpad's buttons are clicked. Sends\n    *    a mousedown operation and adds the button highlight.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.relativePadManager.prototype.relativepadMouseClick = function(event, down) {\n      if (this.state == WMKS.CONST.RELATIVEPAD.STATE.idle) {\n         this.state = WMKS.CONST.RELATIVEPAD.STATE.click;\n         return false;\n      } else {\n         this.state = WMKS.CONST.RELATIVEPAD.STATE.click;\n         var evt = event || window.event;\n         var pos = { x:0, y:0 };\n         var bmask;\n\n         /* evt.which is valid for all browsers except IE */\n         if (evt.which) {\n            if (evt.which == 1) {\n               bmask = 0x01; //left button\n            } else if (evt.which == 2) {\n               bmask = 0x04; //middle button\n            } else if (evt.which == 3) {\n               bmask = 0x02; //right button\n            }\n         } else {\n            /* IE including 9 */\n            if (evt.button == 0) {\n               bmask = 0x01; //left button\n            } else if (evt.button == 1) {\n               bmask = 0x04; //middle button\n            } else if (evt.button == 2) {\n               bmask = 0x02; //right button\n            }\n         }\n         // Sends a mousedown message.\n         this._widget.sendMouseButtonMessage(pos, down, bmask);\n         this.resetRelativepadState();\n         return false;\n      }\n\n   };\n\n   /*\n    *---------------------------------------------------------------------------\n    *\n    *    resetRelativepadState\n    *\n    *    Resets the virtual relative trackpad's state machine.\n    *\n    *---------------------------------------------------------------------------\n    */\n\n   WMKS.relativePadManager.prototype.resetRelativepadState = function() {\n      this.history.length = 0;\n   };\n\n}());\n$.widget(\"wmks.wmks\", WMKS.widgetProto);\n})();\n\n\n/*** EXPORTS FROM exports-loader ***/\nmodule.exports = window.WMKS;\n}.call(window));\n\n\n//////////////////\n// WEBPACK FOOTER\n// /Users/yuez/gitvmware/htmlaccess1/ui/bower_components/webmks/build/static/wmks/wmks.js\n// module id = 43\n// module chunks = 0","/******************************************************************************\n * Copyright 2014-2017 VMware, Inc.  All rights reserved.\n *****************************************************************************/\n\n/**\n * appblast-log.js\n *\n *    Implement logging in a way that takes advantage of modern\n *    browser debugging features but gracefully degrades on older\n *    browsers.\n *\n */\n\n\nvar log = (function() {\n   var nullFunc = function() {\n      },\n      ret = {},\n      levels = [\"trace\", \"debug\", \"info\", \"warn\", \"error\"];\n\n\n   ret.LEVEL_TRACE = 0;\n   ret.LEVEL_DEBUG = 1;\n   ret.LEVEL_INFO = 2;\n   ret.LEVEL_WARN = 3;\n   ret.LEVEL_ERROR = 4;\n\n\n   /**\n    * getMethod\n    *\n    *    Bind to the named console method, or provide a fallback\n    *    implementation. If console or console.log are not defined, we\n    *    return dummy implementation which does nothing.\n    *\n    *    If the named method exists on the console, then we return a\n    *    binding of that method. If it does not exist, we return\n    *    console.log with the log level curried in.\n    *\n    *    If Function.prototype.bind does not exist, we raise an error.\n    */\n\n   function getMethod(name) {\n      if (nullFunc.bind === undefined) {\n         throw new Error(\"log requires Function.prototype.bind\");\n      }\n\n      if ((console === undefined) || (console.log === undefined)) {\n         return nullFunc;\n      } else if (console[name] !== undefined) {\n         return console[name].bind(console);\n      } else {\n         return console.log.bind(console, name);\n      }\n   }\n\n   /**\n    * setLevel\n    *\n    *    sets the current log level.\n    */\n\n   ret.setLevel = function(level) {\n      var i;\n\n      if ((typeof level !== \"number\") ||\n         (level < 0) ||\n         level > (levels.length - 1)) {\n         throw new Error(\"Invalid log level: \" + level);\n      }\n\n      for (i = 0; i < level; i++) {\n         ret[levels[i]] = nullFunc;\n      }\n\n      for (i = level; i < levels.length; i++) {\n         // log level trace is implemented as debug.\n         // see: log.stackTrace() below.\n         if (levels[i] === \"trace\") {\n            ret.trace = getMethod(\"debug\");\n         } else {\n            ret[levels[i]] = getMethod(levels[i]);\n         }\n      }\n\n      ret.logLevel = level;\n   };\n\n   /**\n    * log\n    *\n    *    binding of console.log or a dummy implementation.\n    */\n\n   ret.log = getMethod(\"log\");\n\n   /**\n    * log\n    *\n    *    In modern browsers, console.trace() is not trace level\n    *    logging, but actually a means to produce a stacktrace on the\n    *    console. Our code defines LEVEL_TRACE as the loweset level of\n    *    logging, so we expose console.trace here as log.stackTrace().\n    */\n\n   ret.stackTrace = getMethod(\"trace\");\n\n\n   /**\n    * setLevel\n    *\n    *    Change the current log level. Log level must be an integer\n    *    from LEVEL_TRACE to LEVEL_ERROR. Changing the log level to\n    *    suppress a logging prevents the browser's console methods\n    *    from ever being called, so they will never apear in the\n    *    console regardless of the console filter settings used.\n    */\n\n   ret.setLevel(ret.LEVEL_DEBUG);\n\n   return ret;\n}());\n\n/**\n *  NOTE: this is the workaround for RTAV workers.\n *  We don't use webpack for these workers as there are many complex function\n *  in them. As a result, we have to use this ugly way to expose 'log' to other\n *  webpack module, but not for worker context.\n */\nif (typeof module !== \"undefined\" && module.exports) {\n   module.exports = log;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/appblast-log.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * unity.js --\n *\n * Interface used to send and receive Unity RPCs and updates.\n * The full Unity documentation can be found in bora/public/unityCommon.h and the\n * RPC constants referenced in the code are described there.\n *\n * Consumers of this interface should set the following optional listeners in the object\n * after it is instantiated:\n *\n *    .onAdd           Called when Unity window is added.  Takes parameters:\n *       windowId         ID of window to add.\n *       windowPath       String tying the window ID to an executable.\n *       execPath         String uniquely identifying just the executable.\n *    .onRemove        Called when Unity window is removed.  Takes parameters:\n *       windowId         ID of window to remove.\n *    .onTitleChanged  Called when Unity window title changes.  Takes parameters:\n *       windowId         ID of window to update.\n *       windowTitle      New window title.\n *    .onAttrChanged   Called when Unity window attribute changes.  Takes parameters:\n *       windowId         ID of window to update.\n *       type             Attribute type.\n *       value            Attribute value (boolean).\n *    .onTypeChanged   Called when Unity window type changes.  Takes parameters:\n *       windowId         ID of window whose type changed.\n *       type             New window type.\n *    .onIconChanged   Called when Unity window icon changes.  Takes parameters:\n *       windowId         ID of window whose icon changed.\n *    .onReadyChanged  Called when the remote desktop signals a change in whether\n *                     or not it is ready for Unity.  Takes parameters:\n *       ready            true if ready, false if not ready.\n *    .onActiveChanged Called when the remote desktops signals a change in whether\n *                     Unity is on or off.  Takes parameters:\n *       active           true if Unity is on, false if it is off.\n *    .onCapsChanged   Called when the remote desktop signals their capabilities.\n *                     Takes parameters:\n *       caps             Array containing capabilities that the server advertised.\n *    .onUpdateComplete Called after a Unity update (RPC_PUSH_UPDATE_CMD) has been\n *                      completely parsed and one or more listeners called.\n */\n\n\nimport StringUtils from '../common/string-utils';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport VDPService from '../channels/vdpservice';\n\nlet Unity = {\n   /**\n    * These constants represent the various capabilities that we could receive\n    * from the server.  Note: they are *not* bitmasks.\n    *\n    * Refer to bora/public/remoteUnity.h for more info.\n    */\n   CAP_UNITY: 1,\n   CAP_STATUS: 2,\n   CAP_WORK_AREA: 3,\n   CAP_MULTIMON: 4,\n   CAP_TASKBAR: 5,\n   CAP_WINDOW_CONTENTS: 6,\n   CAP_SHELL_ACTION_RUN: 7,\n   CAP_SET_FOCUSED_WINDOW: 8,\n   CAP_MOUSE_BUTTON_SWAPPING: 9,\n   CAP_SET_APP_ENTITLEMENT_MAP: 10,\n   CAP_TRAY_ICONS: 11,\n\n   /**\n    * These constants represent the features bitmask which can be provided\n    * to Unity.Mgr.On().\n    *\n    * Refer to bora/public/unityCommon.h for more info.\n    */\n   ADD_HIDDEN_WINDOWS_TO_TRACKER: 1,\n   INTERLOCK_MINIMIZE_OPERATION: 2,\n   SEND_WINDOW_CONTENTS: 4,\n   DISABLE_COMPOSITING_IN_GUEST: 8,\n   DISABLE_MOUSE_BUTTON_SWAPPING: 16,\n   SHOW_FLOATING_LANGUAGE_BAR: 32,\n\n   /**\n    * These constants represent possible window types for Unity windows.\n    * Some may be deprecated, so refer to bora/public/unityCommon.h for more\n    * info.\n    */\n   WINDOW_TYPE_NONE: -1,\n   WINDOW_TYPE_NORMAL: 0,\n   WINDOW_TYPE_PANEL: 1,\n   WINDOW_TYPE_DIALOG: 2,\n   WINDOW_TYPE_MENU: 3,\n   WINDOW_TYPE_TOOLTIP: 4,\n   WINDOW_TYPE_SPLASH: 5,\n   WINDOW_TYPE_TOOLBAR: 6,\n   WINDOW_TYPE_DOCK: 7,\n   WINDOW_TYPE_DESKTOP: 8,\n   WINDOW_TYPE_COMBOBOX: 9,\n   WINDOW_TYPE_WIDGET: 10,\n   WINDOW_TYPE_METRO_OBSOLETE: 11,\n   WINDOW_TYPE_START_SCREEN: 12,\n   WINDOW_TYPE_SLIDE_IN_PANEL: 13,\n   WINDOW_TYPE_TASKBAR: 14,\n   WINDOW_TYPE_METRO_FULLSCREEN_APP: 15,\n   WINDOW_TYPE_METRO_DOCKED_APP: 16,\n   MAX_WINDOW_TYPES: 17, // Final, sentinel attribute entry.\n\n   /**\n    * These constants represent possible window attributes for Unity windows.\n    * Some may be deprecated, so refer to bora/public/unityCommon.h for more\n    * info.\n    */\n   WINDOW_ATTR_BORDERLESS: 0,\n   WINDOW_ATTR_MINIMIZABLE: 1,\n   WINDOW_ATTR_MAXIMIZABLE: 2,\n   WINDOW_ATTR_MAXIMIZED: 3,\n   WINDOW_ATTR_CLOSABLE: 5,\n   WINDOW_ATTR_HAS_TITLEBAR: 6,\n   WINDOW_ATTR_VISIBLE: 7,\n   WINDOW_ATTR_CHILD_WINDOW: 8,\n   WINDOW_ATTR_HAS_TASKBAR_BTN: 9,\n   WINDOW_ATTR_MOVABLE: 10,\n   WINDOW_ATTR_RESIZABLE: 11,\n   WINDOW_ATTR_ALWAYS_ABOVE: 12,\n   WINDOW_ATTR_ALWAYS_BELOW: 13,\n   WINDOW_ATTR_DISABLED: 14,\n   WINDOW_ATTR_NOACTIVATE: 15,\n   WINDOW_ATTR_SYSMENU: 16,\n   WINDOW_ATTR_TOOLWINDOW: 17,\n   WINDOW_ATTR_APPWINDOW: 18,\n   WINDOW_ATTR_FULLSCREENABLE: 19,\n   WINDOW_ATTR_FULLSCREENED: 20,\n   WINDOW_ATTR_ATTN_WANTED: 21,\n   WINDOW_ATTR_SHADEABLE: 22,\n   WINDOW_ATTR_SHADED: 23,\n   WINDOW_ATTR_STICKABLE: 24,\n   WINDOW_ATTR_STICKY: 25,\n   WINDOW_ATTR_MODAL: 26,\n   WINDOW_ATTR_MINIMIZED: 27,\n   WINDOW_ATTR_FOCUSED: 28,\n   WINDOW_ATTR_TRANSPARENT: 29,\n   MAX_ATTRIBUTES: 30, // Final, sentinel attribute entry.\n\n   /**\n    * Various constants defining the RPCs that we currently use.\n    *\n    * Some may be deprecated, so refer to bora/public/unityCommon.h for more\n    * info.\n    */\n   RPC_ENTER: 'unity.enter',\n   RPC_GET_BINARY_INFO: 'unity.get.binary.info',\n   RPC_WINDOW_SETTOP: 'unity.window.settop',\n   RPC_WINDOW_CLOSE: 'unity.window.close',\n   RPC_GET_ICON_DATA: 'unity.get.icon.data',\n   RPC_EXIT: 'unity.exit',\n   RPC_GET_UPDATE_FULL: 'unity.get.update.full',\n   RPC_GET_UPDATE_INCREMENTAL: 'unity.get.update.incremental',\n   RPC_WINDOW_UNMINIMIZE: 'unity.window.restore',\n   RPC_SET_OPTIONS: 'unity.set.options',\n   RPC_GET_EXEC_INFO_HASH: 'ghi.guest.getExecInfoHash',\n\n   // Guest-to-Host RPCs that we may receive.\n   RPC_PUSH_UPDATE_CMD: 'tools.unity.push.update',\n   RPC_ACTIVE: 'unity.active',\n   RPC_NOTIFY_CLIENT: 'unity.notify.client',\n\n   // VDPService command IDs.\n   SERVER_UNITY_INFO_MSG: 0,\n   SERVER_UNITY_PLUGIN_MSG: 1,\n   CLIENT_UNITY_PLUGIN_MSG: 2,\n\n   // Version enums used when XDR-encoding some Unity message parameters.\n   OPTIONS_V1: 1,\n   EXEC_INFO_HASH_V1: 1,\n   ACTIVE_V1: 1,\n\n   // Constants used by getIconData().\n   ICON_TYPE_MAIN: 0,\n   DEFAULT_ICON_CHUNK_SIZE: 32 * 1024,  // 32KB\n\n   /**\n    * Unity.Mgr\n    *\n    * Constructor used to create a new instance of the Unity.Mgr object.\n    *\n    * @param vdpService   vdpService object that has been opened by the webmks.\n    */\n\n   Mgr: function(vdpService, mainChannel) {\n      let self = this,\n\n         /*\n          * VDPService provides no built-in functionality to correlated RPC\n          * responses previous requests.  As a result, we track in-flight requests with a\n          * sequence number that the server treats as a cookie and returns back with the\n          * response.  seqNo is a sequentially increasing number used as the cookie and\n          * requests is the map of a cookie to optional callback functions.\n          */\n         requests = {},\n         seqNo = 1,\n         pendingIconRequests = {},\n\n         // The various channel names and object names we use.\n         unitySvcObject = 'UnitySvcObject',\n\n         /*\n          * Private functions that will be defined later in the file.\n          * These are forward-defined here to avoid jslint errors from hoisting.\n          */\n         getIconDataChunk = null,\n         sendRPC = null,\n         serializeRPCParameter = null,\n         parseUnityMessage = null,\n         parseUnityCapabilities = null,\n         parseUnityUpdate = null,\n         splitStringComponents = null,\n         removeWindow = null,\n         handleGetBinaryInfoMessage = null,\n         handleGetIconDataMessage = null,\n         handleGetExecInfoHashMessage = null,\n         handleUnityUpdateMessage = null,\n         handleUnityActiveMessage = null,\n         handleNotifyReadyMessage = null,\n         vdpServiceMainChannel = mainChannel;\n\n      if (mainChannel) {\n         mainChannel.addMessageHandler(this);\n      }\n\n      /*\n       * The Unity.Mgr owner can retrieve information about windows directly using the\n       * .windows object by using the windowId as the key.  A window object has the\n       * following attributes:\n       *    .attributes: Object with attribute name as the key and a boolean as the value.\n       *    .title: Title of the window.\n       *    .type: Window type.\n       *    .windowId: Window ID.\n       *    .windowPath: Window path in remote desktop.\n       *    .execPath: Executable path in remote desktop.\n       */\n      this.windows = {};\n      this.windowCount = 0;\n      this.isOn = false;\n      this.paused = false;\n\n      /**\n       * Unity.Mgr.on\n       *\n       * Requests that the remote desktop enters Unity mode with the specified\n       * feature mask.\n       *\n       * @param features  Bitmask of features.\n       */\n      this.on = function(features) {\n         features = features || 0;\n\n         /*\n          * Sends RPC_SET_OPTIONS, then RPC_ENTER, then RPC_GET_UPDATE_FULL.\n          * Doesn't wait for each RPC to complete before sending the next.\n          */\n         if (sendRPC(true, null, null, Unity.RPC_SET_OPTIONS,\n               Unity.OPTIONS_V1, 1, features) &&\n            sendRPC(false, null, null, Unity.RPC_ENTER)) {\n            self.requestUpdate(true);\n\n            /*\n             * Note: cui::UnityMgr has a much more complicated state process including an\n             * \"on pending\" state that times out after 20 seconds.  I don't believe that it\n             * is necessary for View and often times does more harm than good for us.\n             */\n            self.isOn = true;\n            self.paused = false;\n         }\n      };\n\n      /**\n       * Unity.Mgr.off\n       *\n       * Requests that the remote desktop exits Unity mode.\n       */\n      this.off = function() {\n         let windowId,\n            removedWindow = false;\n\n         // Clear this data even if sending the RPC failed.\n         self.paused = false;\n         self.isOn = false;\n         for (windowId in self.windows) {\n            if (self.windows.hasOwnProperty(windowId)) {\n               if (removeWindow(windowId)) {\n                  removedWindow = true;\n               }\n            }\n         }\n\n         // We faked window remove updates so we need to fake\n         // onUpdateComplete() as well.\n         if (removedWindow && !!self.onUpdateComplete) {\n            self.onUpdateComplete();\n         }\n\n         // Send RPC_EXIT.\n         sendRPC(false, null, null, Unity.RPC_EXIT);\n      };\n\n      /**\n       * Unity.Mgr.requestUpdate\n       *\n       * Requests either a full or incremental Unity update.\n       *\n       * @param fullUpdate Set to true if the update should be full, false\n       *    otherwise.\n       */\n      this.requestUpdate = function(fullUpdate) {\n         if (!!fullUpdate) {\n            sendRPC(false, null, null, Unity.RPC_GET_UPDATE_FULL);\n         } else {\n            sendRPC(false, null, null, Unity.RPC_GET_UPDATE_INCREMENTAL);\n         }\n      };\n\n      /**\n       * Unity.Mgr.getBinaryInfo\n       *\n       * Requests the binary information for the specified Unity window path.\n       *\n       * @param windowPath The window path to retrieve the binary information\n       *    for.\n       * @param onDone   A callback function triggered upon RPC success.  Takes\n       *    parameters: name       Name of the application. icons      Array of\n       *    icon objects.  Each icon has:\n       *                            .width  Width of the icon\n       *                            .height Height of the icon\n       *                            .bgra   Array with icon BGRA information\n       * @param onAbort  A callback function triggered upon RPC failure.  Takes\n       *    parameters: error      Error string sent by the remote desktop.\n       */\n      this.getBinaryInfo = function(windowPath, onDone, onAbort) {\n         // Send Unity.RPC_GET_BINARY_INFO.\n         if (!!windowPath && !!onDone) {\n            sendRPC(false, onDone, onAbort, Unity.RPC_GET_BINARY_INFO,\n               windowPath);\n         }\n      };\n\n      /**\n       * Unity.Mgr.setTopWindows\n       *\n       * Requests that the remote desktop raise a group of Unity windows to the\n       * top of the window stacking order.\n       *\n       * @param windowIds An array of Unity window IDs.\n       */\n      this.setTopWindows = function(windowIds) {\n         // Send Unity.RPC_WINDOW_SETTOP.\n         if (windowIds instanceof Array && windowIds.length > 0) {\n            sendRPC(false, null, null, Unity.RPC_WINDOW_SETTOP, windowIds);\n         }\n      };\n\n      /**\n       * Unity.Mgr.closeWindow\n       *\n       * Requests that the remote desktop close the specified window.\n       *\n       * @param windowId ID of window to close.\n       */\n      this.closeWindow = function(windowId) {\n         // Send Unity.RPC_WINDOW_CLOSE.\n         if (!!windowId) {\n            sendRPC(false, null, null, Unity.RPC_WINDOW_CLOSE, windowId);\n         }\n      };\n\n      /**\n       * Unity.Mgr.getIconData\n       *\n       * Requests an icon for the specified window.\n       *\n       * @param windowId ID of window to request icon data for.\n       * @param size     Size of icon (e.g. 16, 32, 48).\n       * @param onDone   A callback function triggered upon RPC success.  Takes\n       *    parameters: bgra        Array with icon BGRA information.\n       * @param onAbort  A callback function triggered upon RPC failure.  Takes\n       *    parameters: error      Error string sent by the remote desktop.\n       * @param chunkSize Optional chunk size that the caller can pass in.\n       *    Defaults to Unity.DEFAULT_ICON_CHUNK_SIZE.\n       */\n      this.getIconData =\n         function(windowId, size, onDone, onAbort, iconChunkSize) {\n            iconChunkSize = iconChunkSize || Unity.DEFAULT_ICON_CHUNK_SIZE;\n\n            // Send Unity.RPC_GET_ICON_DATA.\n            if (!!windowId && size > 0 && !!onDone && iconChunkSize > 0) {\n               getIconDataChunk(windowId, size, onDone, onAbort, iconChunkSize);\n            }\n         };\n\n      /**\n       * Unity.Mgr.unminimize\n       *\n       * Requests that the specified window be unminimized.\n       *\n       * @param windowId ID of window to unminimize.\n       */\n      this.unminimize = function(windowId) {\n         // Send RPC_WINDOW_UNMINIMIZE.\n         if (!!windowId) {\n            sendRPC(false, null, null, Unity.RPC_WINDOW_UNMINIMIZE, windowId);\n         }\n      };\n\n      /**\n       * Unity.Mgr.getExecInfoHash\n       *\n       * Requests a hash of the executable info used to save binary information\n       * to an internal hash.\n       *\n       * @param execPath     Executable path received by onAdd listener.\n       * @param onDone   A callback function triggered upon RPC success.  Takes\n       *    parameters: execInfoHash Executable info hash.\n       * @param onAbort  A callback function triggered upon RPC failure.  Takes\n       *    parameters: error      Error string sent by the remote desktop.\n       */\n      this.getExecInfoHash = function(execPath, onDone, onAbort) {\n         // Send Unity.RPC_GET_EXEC_INFO_HASH.\n         if (!!execPath && !!onDone) {\n            sendRPC(true, onDone, onAbort, Unity.RPC_GET_EXEC_INFO_HASH,\n               Unity.EXEC_INFO_HASH_V1, 1, execPath);\n         }\n      };\n\n      /**\n       * Unity.Mgr.pause\n       *\n       * Requests that Unity be paused.  Usually called by the UI as a result\n       * of receiving the Unity \"not ready\" signal.\n       *\n       * This function doesn't send any RPCs, but does clear any internal Unity\n       * window state the object maintains and sets a variable to prevent\n       * dispatching most Unity updates.\n       */\n      this.pause = function() {\n         let windowId,\n            removedWindow = false;\n\n         self.paused = true;\n\n         for (windowId in self.windows) {\n            if (self.windows.hasOwnProperty(windowId)) {\n               if (removeWindow(windowId)) {\n                  removedWindow = true;\n               }\n            }\n         }\n\n         // We faked window remove updates so we need to fake\n         // onUpdateComplete() as well.\n         if (removedWindow && !!self.onUpdateComplete) {\n            self.onUpdateComplete();\n         }\n      };\n\n      /**\n       * Unity.Mgr.unpause\n       *\n       * Requests that Unity be unpaused.  Usually called by the UI as a result\n       * of receiving the Unity \"ready\" signal after we were previously paused.\n       *\n       * This function resumes all Unity updates and requests a full Unity\n       * update.\n       */\n      this.unpause = function() {\n         /*\n          * Set a variable to start dispatching Unity updates.\n          * Also call self.requestUpdate(true).\n          */\n         self.paused = false;\n         self.requestUpdate(true);\n      };\n\n      /**\n       * Unity.Mgr.getPendingIconRequestCount\n       *\n       * Returns the number of in-flight icon requests.  Used by the unit tests\n       * to confirm that the map was cleaned up properly.\n       *\n       * @return     Total icon request count.\n       */\n      this.getPendingIconRequestCount = function() {\n         let request,\n            count = 0;\n\n         for (request in pendingIconRequests) {\n            if (pendingIconRequests.hasOwnProperty(request)) {\n               count++;\n            }\n         }\n\n         return count;\n      };\n\n      /**\n       * Unity.Mgr.getPendingRPCCount\n       *\n       * Returns the number of in-flight RPCs.\n       *\n       * @return     Total RPC count.\n       */\n      this.getPendingRPCCount = function() {\n         let rpc,\n            count = 0;\n\n         for (rpc in requests) {\n            if (requests.hasOwnProperty(rpc)) {\n               count++;\n            }\n         }\n\n         return count;\n      };\n\n      /**\n       * getIconDataChunk\n       *\n       * Helper function to request an icon for the specified window at a\n       * specified offset.\n       *\n       * @param windowId ID of window to request icon data for.\n       * @param size     Size of icon (e.g. 16, 32, 48).\n       * @param onDone   A callback function triggered upon RPC success.  Takes\n       *    parameters: bgra        Array with icon BGRA information.\n       * @param onAbort  A callback function triggered upon RPC failure.  Takes\n       *    parameters: error      Error string sent by the remote desktop.\n       * @param chunkSize        Icon chunk size.\n       * @param iconPosition     Optional index to start at.  Defaults to 0.\n       * @param previousCookie   Optional previous cookie used in a different\n       *    RPC request for the same icon.  Should be sent if iconPosition > 0.\n       */\n      getIconDataChunk =\n         function(windowId, size, onDone, onAbort, iconChunkSize,\n                  iconPosition, previousCookie) {\n            let newCookie,\n               pendingRequest = null;\n\n            iconPosition = iconPosition || 0;\n            newCookie = seqNo.toString();\n\n            if (!!newCookie) {\n               if (!!previousCookie) {\n                  pendingRequest = pendingIconRequests[previousCookie];\n                  delete pendingIconRequests[previousCookie];\n               }\n               if (!pendingRequest) {\n                  pendingRequest = {};\n                  pendingRequest.iconData = null;\n               }\n\n               pendingRequest.cookie = newCookie;\n               pendingRequest.iconChunkSize = iconChunkSize;\n               pendingRequest.windowId = windowId;\n               pendingRequest.size = size;\n               pendingRequest.onDone = onDone;\n               pendingRequest.onAbort = onAbort;\n               pendingRequest.iconPosition = iconPosition;\n               pendingIconRequests[newCookie] = pendingRequest;\n            }\n\n            sendRPC(false, onDone, onAbort, Unity.RPC_GET_ICON_DATA, windowId,\n               Unity.ICON_TYPE_MAIN, size, iconPosition, iconChunkSize);\n         };\n\n      /**\n       * sendRPC\n       *\n       * Function that owns the process of sending an RPC.\n       *\n       * @param xdrEncodeArgs  true if the arguments after the RPC string\n       *    should be xdr-encoded if using vdpService.\n       * @param onDone     Optional callback function triggered upon RPC\n       *    success. Parameters depend on the RPC specifics.\n       * @param onAbort    Optional callback function triggered upon RPC\n       *    failure. Takes parameters: error      Error string sent by the\n       *    remote desktop.\n       * @param name       Name of the RPC\n       * @param <params>   Optional extra parameters to be appended to string.\n       * @return           true if successfully sent the RPC, false otherwise.\n       */\n      sendRPC = function(xdrEncodeArgs, onDone, onAbort, name) {\n         let rpcString = name,\n            i = 0,\n            cookie = seqNo.toString(),\n            xdrBuffer;\n\n         if (!mainChannel) {\n            JSCDKLogger.error(\n               'Failed to send Unity RPC. vdpService channel is closed.');\n            return false;\n         }\n\n         if (xdrEncodeArgs) {\n            xdrBuffer = new VDPService.XDRBuffer();\n            xdrBuffer.initEncoder();\n\n            for (i = sendRPC.length; i < arguments.length; i++) {\n               xdrBuffer.write(arguments[i]);\n            }\n\n            if (xdrBuffer.length > 0) {\n               rpcString +=\n                  ' ' + StringUtils.uint8ArrayToString(xdrBuffer.getData());\n            }\n         } else {\n            // Add all extra parameters to the RPC string.\n            for (i = sendRPC.length; i < arguments.length; i++) {\n               rpcString += serializeRPCParameter(arguments[i]);\n            }\n         }\n\n         /*\n          * If neither onDone and onAbort are provided, that means that this request will\n          * not result in a response being sent by the server.  For those RPCs, we should\n          * not create an entry in requests, because it would never be cleaned up.\n          */\n         if (!!onDone && !!onAbort) {\n            requests[cookie] = {onDone: onDone, onAbort: onAbort};\n         }\n\n         /*\n          * Note: The RdeServer expects the message string to be null-terminated,\n          * which StringUtils.stringToUint8Array does here.\n          */\n         if (0 === vdpServiceMainChannel.invoke({\n               command: Unity.CLIENT_UNITY_PLUGIN_MSG,\n               type: VDPService.RPC_TYPE.POST,\n               params: [0, 0, StringUtils.stringToUint8Array(rpcString, true),\n                  cookie, 0],\n               objName: unitySvcObject\n            })) {\n            JSCDKLogger.error('Failed to send Unity RPC.');\n            delete requests[cookie];             // For if onDone callback was\n                                                 // provided.\n            delete pendingIconRequests[cookie];  // For if it's an icon request.\n            return false;\n         }\n\n         seqNo++;\n         return true;\n      };\n\n      /**\n       * serializeRPCParameter\n       *\n       * Helper function used to recursively add parameters to an RPC string.\n       * Expands any arrays that it encounters.\n       *\n       * @param parameter    Parameter to add.\n       * @return             Serialized RPC params string with leading space if\n       *    > 0 params.\n       */\n      serializeRPCParameter = function(parameter) {\n         let serializedString = '',\n            i = 0;\n\n         if (parameter instanceof Array) {\n            for (i = 0; i < parameter.length; i++) {\n               serializedString += serializeRPCParameter(parameter[i]);\n            }\n         } else {\n            serializedString += ' ' + parameter;\n         }\n\n         return serializedString;\n      };\n\n      /**\n       * handleRPCFromServer\n       *\n       * Helper function used to parse the RPC data that we receive from a\n       * server.\n       *\n       * @param rpc      RPC object that was posted by VDPService.\n       */\n      this.handleRPCFromServer = function(rpc) {\n         let rpcName,\n            cookie,\n            messageContents,\n            status,\n            capabilities,\n            capsCount,\n            timestamp,\n            invalidRPCCommand = false,\n            lastTokenIndex,\n            tokenIndex,\n            spaceCharCode = 32;\n\n         switch (rpc.command) {\n            case Unity.SERVER_UNITY_INFO_MSG:\n               if (rpc.type === VDPService.RPC_TYPE.REQUEST &&\n                  rpc.params.length >= 6) {\n                  JSCDKLogger.trace(\n                     'Received Unity server info: ' + rpc.params);\n\n                  capsCount = rpc.params[3];\n                  capabilities = rpc.params[4];\n\n                  if (!!capabilities) {\n                     parseUnityCapabilities(capsCount, capabilities);\n                  }\n               } else {\n                  invalidRPCCommand = true;\n               }\n               break;\n            case Unity.SERVER_UNITY_PLUGIN_MSG:\n\n               /*\n                * The parameters sent by the server are in the format:\n                *    rpc.params[0]: ?\n                *    rpc.params[1]: ?\n                *    rpc.params[2]: Uint8Array with string data of the format\n                *                   <RPC name> <optional_RPC_parameters>\n                *    rpc.params[3]: String containing cookie ('' means no cookie).\n                *    rpc.params[4]: Integer containing status (0 means success).\n                *    rpc.params[5]: ?\n                */\n               if (rpc.type === VDPService.RPC_TYPE.POST &&\n                  rpc.params.length === 6 &&\n                  rpc.params[2] instanceof Uint8Array) {\n                  /*\n                   * Note: some messages (e.g. RPC_GET_BINARY_INFO) contain binary\n                   * data that causes StringUtils.uint8ArrayToString to fail.\n                   */\n                  tokenIndex = StringUtils.uint8ArrayIndexOf(rpc.params[2],\n                     spaceCharCode);\n                  if (tokenIndex === -1) {\n                     JSCDKLogger.error(\n                        'unity.js: Failed to find first string in response.');\n                     return;\n                  }\n\n                  rpcName = StringUtils.uint8ArrayToString(\n                     rpc.params[2].subarray(0, tokenIndex));\n                  if (rpcName.indexOf('time:') === 0) {\n                     // This first string is a timestamp and the next string is\n                     // the RPC name.\n                     timestamp = Date.parse(rpcName.slice(5));\n\n                     lastTokenIndex =\n                        StringUtils.uint8ArrayIndexOf(rpc.params[2],\n                           spaceCharCode,\n                           tokenIndex + 1);\n                     if (lastTokenIndex === -1) {\n                        JSCDKLogger.error(\n                           'unity.js: Failed to find second string in response.');\n                        return;\n                     }\n\n                     rpcName = StringUtils.uint8ArrayToString(\n                        rpc.params[2].subarray(tokenIndex + 1, lastTokenIndex)\n                     );\n\n                     if (!!timestamp) {\n                        JSCDKLogger.trace('Receiving Unity message ' + rpcName +\n                           ' took ' + (Date.now() - timestamp) + 'ms.');\n                     }\n                  } else {\n                     lastTokenIndex = tokenIndex;\n                  }\n\n                  if (rpcName.length === 0) {\n                     JSCDKLogger.error(\n                        'unity.js: Failed to parse RPC name from server.');\n                     return;\n                  }\n\n                  messageContents = rpc.params[2].subarray(lastTokenIndex + 1);\n\n                  cookie = rpc.params[3];\n                  status = rpc.params[4];\n\n                  parseUnityMessage(cookie, status, rpcName, messageContents);\n               } else {\n                  invalidRPCCommand = true;\n               }\n               break;\n            default:\n               return 1;\n         }\n\n         if (invalidRPCCommand) {\n            JSCDKLogger.error('Unity message ' + rpc.command + ' with type ' +\n               rpc.type + ' was in an unexpected format: ' +\n               rpc.params);\n         }\n         return 0;\n      };\n\n      /**\n       * parseUnityMessage\n       *\n       * Helper function used to parse a Unity message that is received by\n       * vdpService.\n       *\n       * @param cookie        String containing the request cookie.\n       * @param status        Status integer (literal) sent by server.  0 means\n       *    success.\n       * @param messageName   Name of the message sent.  Usually corresponds to\n       *    an RPC.\n       * @param messageContents  The message-specific contents in a Uint8Array.\n       */\n      parseUnityMessage =\n         function(cookie, status, messageName, messageContents) {\n            let success = !status,\n               rpcContentsInvalid = false,\n               callbacks,\n               onDone,\n               onAbort;\n\n            if (!!cookie && cookie.length > 0) {\n               callbacks = requests[cookie];\n               if (!!callbacks) {\n                  onDone = callbacks.onDone;\n                  onAbort = callbacks.onAbort;\n                  delete requests[cookie];\n               }\n            }\n\n            if (!success) {\n               if (messageName === Unity.RPC_GET_ICON_DATA) {\n                  // Icon request failed, so delete the request.\n                  delete pendingIconRequests[cookie];\n               }\n\n               /*\n                * Note: Don't log messageContents because it may contain null characters,\n                * which causes the unit test framework to fail.\n                */\n               JSCDKLogger.error(\n                  'Unity RPC ' + messageName + ' failed (status=' +\n                  status + ').');\n               if (!!onAbort) {\n                  onAbort(StringUtils.uint8ArrayToString(messageContents));\n               }\n               return;\n            }\n\n            switch (messageName) {\n               case Unity.RPC_GET_BINARY_INFO:\n                  rpcContentsInvalid =\n                     !handleGetBinaryInfoMessage(messageContents, onDone);\n                  break;\n               case Unity.RPC_GET_ICON_DATA:\n                  rpcContentsInvalid =\n                     !handleGetIconDataMessage(messageContents, onDone, cookie);\n                  /**\n                   * In web client, RPC_GET_BINARY_INFO: unity.get.binary.info\n                   * is the latest time to show application. But when network\n                   * disconnect and reconnect, we dont get this message again.\n                   * This will cause application not display.\n                   * So we choose to use RPC_GET_ICON_DATA: unity.get.icon.data.\n                   * Which is a little earlier than binary info.\n                   * On windows client, they dont even go into get binary info functions.\n                   * The latest messageName is OnGetWindowIconDone,\n                   * so we use the same messageName to check application display time.\n                   * 60ms will make user experience better. As it's an average time between\n                   * get icon and RPC_GET_BINARY_INFO.\n                   * No timer could also fix the bug 1869835.\n                   */\n                  setTimeout(function () {\n                     if(!!self.onVisibilityChanged) {\n                        self.onVisibilityChanged(true);\n                     }\n                  },60);\n                  break;\n               case Unity.RPC_GET_EXEC_INFO_HASH:\n                  rpcContentsInvalid =\n                     !handleGetExecInfoHashMessage(messageContents, onDone);\n                  break;\n               case Unity.RPC_PUSH_UPDATE_CMD:\n                  rpcContentsInvalid =\n                     !handleUnityUpdateMessage(messageContents);\n                  break;\n               case Unity.RPC_ACTIVE:\n                  rpcContentsInvalid =\n                     !handleUnityActiveMessage(messageContents);\n                  break;\n               case Unity.RPC_NOTIFY_CLIENT:\n                  rpcContentsInvalid =\n                     !handleNotifyReadyMessage(messageContents);\n                  break;\n            }\n\n            if (rpcContentsInvalid) {\n               if (messageName === Unity.RPC_GET_ICON_DATA) {\n                  // Icon request received an invalid response, so delete the\n                  // request.\n                  delete pendingIconRequests[cookie];\n               }\n\n               JSCDKLogger.error(\n                  'Unexpectedly unable to dispatch response for RPC ' +\n                  messageName);\n\n               if (!!onAbort) {\n                  onAbort('Unexpected failure');\n               }\n            }\n         };\n\n      /**\n       * parseUnityCapabilities\n       *\n       * Helper function used to parse a capabilities string sent by the server.\n       * If successful, also triggers the .onCapsChanged listener.\n       *\n       * @param count        Number of capabilities sent.\n       * @param capabilities String of form \"1=1;2=1;4=1;5=1;\".\n       */\n      parseUnityCapabilities = function(count, capabilities) {\n         let capsArray = capabilities.split(';'),\n            capArray,\n            serverCaps = [],\n            i = 0;\n\n         if (capsArray instanceof Array && capsArray.length > 0) {\n            /*\n             * The last entry may be empty due to a trailing semicolon.\n             * Remove it so we can accurately check the count.\n             */\n            if (capsArray[capsArray.length - 1].length === 0) {\n               capsArray.pop();\n            }\n\n            if (count > capsArray.length) {\n               /*\n                * This isn't a fatal error but may be indicative of a\n                * parsing failure.\n                */\n               JSCDKLogger.error('Unity capabilities count ' + count +\n                  ' is unexpectedly larger than actual count ' +\n                  capsArray.length + '. Caps: ' + capabilities);\n               return;\n            }\n\n            for (i = 0; i < count; i++) {\n               // Each individual capability is of the form 'type=1'.\n               capArray = capsArray[i].split('=');\n               if (!!capArray && capArray instanceof Array &&\n                  capArray.length === 2) {\n                  if (capArray[1] === '1') {\n                     serverCaps.push(parseInt(capArray[0], 10));\n                  }\n               } else {\n                  JSCDKLogger.error('Unable to parse Unity capability entry ' +\n                     i + ' with contents: ' + capabilities[i]);\n                  return;\n               }\n            }\n\n            JSCDKLogger.trace('Received Unity capabilities: ' + serverCaps);\n\n            if (!!self.onCapsChanged) {\n               self.onCapsChanged(serverCaps);\n            }\n         }\n      };\n\n      /**\n       * parseUnityUpdate\n       *\n       * Helper function used to parse a single Unity update.\n       *\n       * @param update        Unity update string.\n       * @return              true if a listener was triggered, false otherwise.\n       */\n      parseUnityUpdate = function(update) {\n         let updateComponents,\n            type,\n            windowId,\n            shouldCheckExists,\n            shouldExist,\n            window,\n            exists,\n            updateContentsInvalid = false,\n            i,\n            temp1,\n            temp2;\n\n         if (update.trim().indexOf('title') === 0) {\n            /*\n             * The window title may have spaces so we must separate it into exactly\n             * three components: the update name, the window ID, and the title.\n             */\n            updateComponents = splitStringComponents(update, 3);\n         } else {\n            updateComponents = update.split(' ');\n         }\n\n         if (!(updateComponents instanceof Array) ||\n            updateComponents.length < 2) {\n            JSCDKLogger.error(\n               'Received invalid Unity update: \"' + update + '\"');\n            return false;\n         }\n\n         type = updateComponents[0];\n         windowId = updateComponents[1];\n         shouldExist = type !== 'add';\n         window = self.windows[windowId];\n         exists = !!window;\n\n         // A few update types don't have the Unity window ID first, so don't\n         // check.\n         shouldCheckExists = (type !== 'rect' && type !== 'zorder' &&\n         type !== 'activedesktop');\n\n         if (shouldCheckExists && shouldExist !== exists) {\n            JSCDKLogger.trace('Received Unity update \"' + type + '\" for ' +\n               (exists ? 'existing windowId ' : 'nonexistent windowId ') +\n               windowId);\n            return false;\n         }\n\n         JSCDKLogger.trace(\n            'Received Unity update \"' + type + '\" for windowId: ' +\n            windowId);\n\n         switch (type) {\n            case 'add':\n               if (updateComponents.length >= 4) {\n                  /*\n                   * Initialize the window object.  We may eventually move this code\n                   * into its own constructor.\n                   */\n                  window = {\n                     attributes: {}, title: '', type: Unity.WINDOW_TYPE_NONE,\n                     windowId: windowId\n                  };\n\n                  // Initialize all attributes.\n                  for (i = Unity.WINDOW_ATTR_BORDERLESS;\n                       i < Unity.MAX_ATTRIBUTES; i++) {\n                     window.attributes[i] = false;\n                  }\n\n                  // The rest of the components, including windowPath and\n                  // execPath.\n                  for (i = 2; i < updateComponents.length; i++) {\n                     temp1 = updateComponents[i].indexOf('=');\n                     temp2 = updateComponents[i].substr(0, temp1);\n\n                     if (temp2.length > 0) {\n                        window[temp2] = updateComponents[i].substr(temp1 + 1);\n                     }\n                  }\n\n                  if (!window.windowPath || window.windowPath.length === 0) {\n                     JSCDKLogger.error(\n                        'Window id ' + windowId + ' did not have a ' +\n                        'window path.');\n                     updateContentsInvalid = true;\n                  } else {\n                     if (!window.execPath || window.execPath.length === 0) {\n                        JSCDKLogger.trace(\n                           'Window id ' + windowId + ' did not have an ' +\n                           'exec path. Using window path instead.');\n                        window.execPath = window.windowPath;\n                     }\n\n                     self.windows[windowId] = window;\n                     self.windowCount++;\n\n                     if (!!self.onAdd) {\n                        self.onAdd(windowId, window.windowPath,\n                           window.execPath);\n                        return true;\n                     }\n                  }\n               } else {\n                  JSCDKLogger.error(\n                     'Expected at least 4 components for Unity add ' +\n                     'update, but received ' + updateComponents.length);\n                  updateContentsInvalid = true;\n               }\n               break;\n            case 'remove':\n               if (removeWindow(windowId)) {\n                  return true;\n               }\n               break;\n            case 'move':\n               // We are not currently respecting this update type.\n               break;\n            case 'title':\n               if (updateComponents.length >= 3) {\n                  window.title = updateComponents[2];\n\n                  if (!!self.onTitleChanged) {\n                     self.onTitleChanged(windowId, window.title);\n                     return true;\n                  }\n               } else {\n                  updateContentsInvalid = true;\n               }\n               break;\n            case 'zorder':\n               // We are not currently respecting this update type.\n               break;\n            case 'region':\n               // We are not currently respecting this update type.\n               break;\n            case 'state':\n               // State is deprecated so we don't use it.\n               break;\n            case 'attr':\n               if (updateComponents.length >= 4) {\n                  temp1 = parseInt(updateComponents[2], 10);\n                  temp2 = updateComponents[3] === '1';\n\n                  if (temp1 >= Unity.WINDOW_ATTR_BORDERLESS &&\n                     temp1 < Unity.MAX_ATTRIBUTES) {\n                     window.attributes[temp1] = temp2;\n\n                     if (!!self.onAttrChanged) {\n                        self.onAttrChanged(windowId, temp1, temp2);\n                        return true;\n                     }\n                  }\n               } else {\n                  updateContentsInvalid = true;\n               }\n               break;\n            case 'type':\n               if (updateComponents.length >= 3) {\n                  temp1 = parseInt(updateComponents[2], 10);\n\n                  if (temp1 >= Unity.WINDOW_TYPE_NORMAL &&\n                     temp1 < Unity.MAX_WINDOW_TYPES) {\n                     window.type = temp1;\n\n                     if (!!self.onTypeChanged) {\n                        self.onTypeChanged(windowId, window.type);\n                        return true;\n                     }\n                  } else {\n                     updateContentsInvalid = true;\n                  }\n               }\n               break;\n            case 'icon':\n               // Note: The icon type is in updateComponents[2] but we don't\n               // need it.\n               if (!!self.onIconChanged) {\n                  self.onIconChanged(windowId);\n                  return true;\n               }\n               break;\n            case 'desktop':\n               // We are not currently respecting this update type.\n               break;\n            case 'activedesktop':\n               // We are not currently respecting this update type.\n               break;\n            case 'titlebararea':\n               // We are not currently respecting this update type.\n               break;\n            case 'primarywindow':\n               // We are not currently respecting this update type.\n               break;\n            case 'secondarywindows':\n               // We are not currently respecting this update type.\n               break;\n            case 'rect':\n               // We are not currently respecting this update type.\n               break;\n            default:\n               JSCDKLogger.trace('Received unknown Unity update? ' + update);\n               break;\n         }\n\n         if (updateContentsInvalid) {\n            JSCDKLogger.error(\n               'Contents were invalid for Unity update of type: ' + type);\n         }\n\n         return false;\n      };\n\n      /**\n       * splitStringComponents\n       *\n       * Helper function used to split a string into a certain number of\n       * components at the space character.  The last word will contain the\n       * rest of the string, possibly including spaces.\n       *\n       * @param string  String to split.\n       * @param count   Number of components to split it into.\n       * @return        If successful, Array of string.  Otherwise null.\n       */\n      splitStringComponents = function(string, count) {\n         let components = null,\n            i = 0,\n            regex = '';\n\n         if (!!string && string.match instanceof Function) {\n            // Add regex components for all words other than the last one.\n            for (i = 0; i < count - 1; i++) {\n               regex += '(\\\\S+)\\\\s+';\n            }\n            // The last word should include all of the rest of the string.\n            regex += '(.*)';\n\n            components = new RegExp(regex).exec(string);\n\n            if (components instanceof Array) {\n               // The first index has the full update, which we don't want.\n               components.shift();\n            }\n         }\n\n         return components;\n      };\n\n      /**\n       * removeWindow\n       *\n       * Helper function used to remove a window from the internal tracker\n       * and call a listener to notify the consumer of the window removal.\n       *\n       * @param windowId   Window ID to remove.\n       * @return           true if a listener was triggered, false otherwise.\n       */\n      removeWindow = function(windowId) {\n         if (!!windowId) {\n            delete self.windows[windowId];\n            self.windowCount--;\n\n            if (!!self.onRemove) {\n               self.onRemove(windowId);\n               return true;\n            }\n         }\n         return false;\n      };\n\n      /**\n       * handleGetBinaryInfoMessage\n       *\n       * Helper function used to parse and handle the response to\n       * RPC_GET_BINARY_INFO.\n       *\n       * @param messageContents  The message-specific contents in a Uint8Array.\n       * @param onDone           Done slot that caller passed into\n       *    getBinaryInfo().\n       * @return                 true if successfully parsed the message, false\n       *    otherwise.\n       */\n      handleGetBinaryInfoMessage = function(messageContents, onDone) {\n         let tokenObject,\n            name,\n            images = [],\n            imageCount,\n            image,\n            imageBGRASize,\n            i;\n\n         tokenObject = StringUtils.uint8ArrayTokenize(messageContents, 0);\n         name = StringUtils.uint8ArrayToString(tokenObject.result);\n         if (name.length === 0) {\n            JSCDKLogger.error('Unable to parse application name from ' +\n               'getBinaryInfo response.');\n            return false;\n         }\n\n         tokenObject = StringUtils.uint8ArrayTokenize(messageContents, 0,\n            tokenObject.index + 1);\n         if (tokenObject.result.length === 0) {\n            JSCDKLogger.error(\n               'Unable to parse image count for application \"' + name +\n               '\" from getBinaryInfo response.');\n            return false;\n         }\n\n         imageCount =\n            parseInt(StringUtils.uint8ArrayToString(tokenObject.result), 10);\n\n         for (i = 0; i < imageCount; i++) {\n            image = {};\n\n            // The first null-separated string is the image width.\n            tokenObject = StringUtils.uint8ArrayTokenize(messageContents, 0,\n               tokenObject.index + 1);\n            image.width =\n               parseInt(StringUtils.uint8ArrayToString(tokenObject.result), 10);\n\n            // Next is the image height.\n            tokenObject = StringUtils.uint8ArrayTokenize(messageContents, 0,\n               tokenObject.index + 1);\n            image.height =\n               parseInt(StringUtils.uint8ArrayToString(tokenObject.result), 10);\n\n            /*\n             * Next is the image size, which tells us how many image bytes are after\n             * the next null.\n             */\n            tokenObject = StringUtils.uint8ArrayTokenize(messageContents, 0,\n               tokenObject.index + 1);\n            imageBGRASize =\n               parseInt(StringUtils.uint8ArrayToString(tokenObject.result), 10);\n\n            // Next is the image data.\n            image.bgra = messageContents.subarray(\n               tokenObject.index + 1, tokenObject.index + imageBGRASize + 1);\n            tokenObject.index += imageBGRASize + 1;  // Skip the following null\n                                                     // byte too.\n\n            // Now do some sanity checking\n            if (image.width <= 0 || image.height <= 0 || imageBGRASize <= 0 ||\n               imageBGRASize !== image.bgra.length) {\n               JSCDKLogger.error('Failed to parse image index ' + i +\n                  ' for application \"' + name + '\", image=' +\n                  JSON.stringify(image) + ', image.bgra.length=' +\n                  image.bgra.length + ', imageBGRASize=' + imageBGRASize);\n            } else {\n               images.push(image);\n            }\n         }\n\n         if (!!onDone) {\n            onDone(name, images);\n         }\n\n         return true;\n      };\n\n      /**\n       * handleGetIconDataMessage\n       *\n       * Helper function used to parse and handle the response to\n       * RPC_GET_ICON_DATA.\n       *\n       * @param messageContents  The message-specific contents in a Uint8Array.\n       * @param onDone           Done slot that caller passed into\n       *    getIconData().\n       * @param cookie           cookie that was used for last\n       *    RPC_GET_ICON_DATA message.\n       * @return                 true if successfully parsed the message, false\n       *    otherwise.\n       */\n      handleGetIconDataMessage = function(messageContents, onDone, cookie) {\n         let iconRequest,\n            tokenObject,\n            fullIconLength,\n            returnedIconLength,\n            iconChunk,\n            spaceCharCode = 32;\n\n         iconRequest = pendingIconRequests[cookie];\n         if (!iconRequest) {\n            // We need callback info because that's where we store icon chunks.\n            JSCDKLogger.error('Unexpectedly unable to find request info for ' +\n               ' getIconData response with cookie ' + cookie);\n            return false;\n         }\n\n         // The first token returned is the full image length.\n         tokenObject =\n            StringUtils.uint8ArrayTokenize(messageContents, spaceCharCode);\n         if (tokenObject.result.length === 0) {\n            JSCDKLogger.error('Unable parse full image length from ' +\n               'getIconData response.');\n            return false;\n         }\n\n         fullIconLength = parseInt(\n            StringUtils.uint8ArrayToString(tokenObject.result), 10);\n\n         tokenObject =\n            StringUtils.uint8ArrayTokenize(messageContents, spaceCharCode,\n               tokenObject.index + 1);\n         if (tokenObject.result.length === 0) {\n            JSCDKLogger.error('Unable to parse returned image length from ' +\n               'getIconData response.');\n            return false;\n         }\n\n         returnedIconLength = parseInt(\n            StringUtils.uint8ArrayToString(tokenObject.result), 10);\n\n         if (fullIconLength <= 0 || returnedIconLength <= 0) {\n            JSCDKLogger.error('getIconData response had bad icon lengths: ' +\n               fullIconLength + ', ' + returnedIconLength);\n            return false;\n         }\n\n         if (iconRequest.iconPosition + returnedIconLength > fullIconLength) {\n            JSCDKLogger.error(\n               'getIconData response overflowed end of buffer. Expected ' +\n               'end to be ' + fullIconLength + ' but received end of ' +\n               (iconRequest.iconPosition + returnedIconLength));\n            return false;\n         }\n\n         tokenObject.index++;\n         iconChunk = messageContents.subarray(tokenObject.index,\n            tokenObject.index + returnedIconLength);\n\n         if (iconChunk.length !== returnedIconLength) {\n            JSCDKLogger.error(\n               'getIconData response had bad icon data. ' + 'Expected ' +\n               returnedIconLength + ' bytes but ' + 'only received ' +\n               iconChunk.length + ' bytes.');\n            return false;\n         }\n\n         if (returnedIconLength === fullIconLength && !iconRequest.iconData) {\n            // Avoid an extra copy by just using the array directly.\n            iconRequest.iconData = iconChunk;\n         } else {\n            if (!iconRequest.iconData) {\n               // There is more image data to come, so allocate the full length.\n               iconRequest.iconData = new Uint8Array(fullIconLength);\n            }\n            iconRequest.iconData.set(iconChunk, iconRequest.iconPosition);\n         }\n\n         iconRequest.iconPosition += iconChunk.length;\n\n         if (iconRequest.iconPosition < fullIconLength) {\n            JSCDKLogger.trace('Received ' + iconRequest.iconPosition + ' of ' +\n               fullIconLength + ' icon bytes for cookie ' + cookie +\n               ', so sending another RPC.');\n\n            getIconDataChunk(iconRequest.windowId, iconRequest.size,\n               iconRequest.onDone, iconRequest.onAbort,\n               iconRequest.iconChunkSize, iconRequest.iconPosition,\n               cookie);\n         } else {\n            JSCDKLogger.trace('Received full ' + iconRequest.iconPosition +\n               ' bytes for cookie ' + cookie + ', so all done.');\n\n            delete pendingIconRequests[cookie];\n            if (!!onDone) {\n               onDone(iconRequest.iconData);\n            }\n         }\n\n         return true;\n      };\n\n      /**\n       * handleGetExecInfoHashMessage\n       *\n       * Helper function used to parse and handle the response to\n       * RPC_GET_EXEC_INFO_HASH.\n       *\n       * @param messageContents  The message-specific contents in a Uint8Array.\n       * @param onDone           Done slot that caller passed into\n       *    getExecInfoHash().\n       * @return                 true if successfully parsed the message, false\n       *    otherwise.\n       */\n      handleGetExecInfoHashMessage = function(messageContents, onDone) {\n         let xdrBuffer,\n            xdrObjectVersion,\n            xdrObjectMoreData,\n            xdrObjectData;\n\n         /*\n          * We need to XDR decode the response, which we read in the following order:\n          *   uint32 with struct version, 4-byte-aligned bool explaining whether\n          *   there is more data (should be true), then string with exec info hash.\n          */\n         xdrBuffer = new VDPService.XDRBuffer();\n         xdrBuffer.initDecoder(messageContents);\n         xdrObjectVersion = xdrBuffer.readUint32();\n         xdrObjectMoreData = (xdrBuffer.readUint32() !== 0);\n\n         // Note: We treat an empty exec info hash as success for now.\n         if (xdrObjectVersion === Unity.EXEC_INFO_HASH_V1 &&\n            xdrObjectMoreData) {\n            xdrObjectData = xdrBuffer.readString();\n\n            JSCDKLogger.trace('Received exec info hash: ' + xdrObjectData);\n            if (!!onDone) {\n               onDone(xdrObjectData);\n            }\n\n            return true;\n         } else {\n            JSCDKLogger.error(\n               'Received unexpected exec info hash response. version=' +\n               xdrObjectVersion + ', moreData=' + xdrObjectMoreData);\n            return false;\n         }\n      };\n\n      /**\n       * handleUnityUpdateMessage\n       *\n       * Helper function used to parse and handle a Unity update message.\n       *\n       * @param messageContents  The message-specific contents in a Uint8Array.\n       * @return                 true if successfully parsed the message, false\n       *    otherwise.\n       */\n      handleUnityUpdateMessage = function(messageContents) {\n         let messageComponents,\n            i,\n            listenerCalled = false;\n\n         if (!self.paused) {\n            messageComponents =\n               StringUtils.uint8ArrayToString(messageContents).split('\\x00');\n            if (messageComponents instanceof Array) {\n               for (i = 0; i < messageComponents.length; i++) {\n                  if (messageComponents[i].length !== 0) {\n                     if (parseUnityUpdate(messageComponents[i])) {\n                        listenerCalled = true;\n                     }\n                  }\n               }\n\n               if (messageComponents.length > 0) {\n                  JSCDKLogger.debug(\n                     'Finished parsing current Unity update. One or ' +\n                     'more listeners ' +\n                     (listenerCalled ? 'were' : 'were not') +\n                     ' called.');\n                  if (listenerCalled && !!self.onUpdateComplete) {\n                     self.onUpdateComplete();\n                  }\n               }\n            } else {\n               return false;\n            }\n         }\n\n         return true;\n      };\n\n      /**\n       * handleUnityActiveMessage\n       *\n       * Helper function used to parse and handle a Unity active message.\n       *\n       * @param messageContents  The message-specific contents in a Uint8Array.\n       * @return                 true if successfully parsed the message, false\n       *    otherwise.\n       */\n      handleUnityActiveMessage = function(messageContents) {\n         let xdrBuffer,\n            xdrActiveVersion,\n            xdrActiveData;\n\n         xdrBuffer = new VDPService.XDRBuffer();\n         xdrBuffer.initDecoder(messageContents);\n         xdrActiveVersion = xdrBuffer.readUint32();\n         xdrActiveData = xdrBuffer.readUint32();\n\n         if (xdrActiveVersion === Unity.ACTIVE_V1) {\n            if (!!self.onActiveChanged) {\n               self.onActiveChanged(xdrActiveData);\n            }\n            return true;\n         } else {\n            return false;\n         }\n      };\n\n      /**\n       * handleNotifyReadyMessage\n       *\n       * Helper function used to parse and handle a Unity ready message.\n       *\n       * @param messageContents  The message-specific contents in a Uint8Array.\n       * @return                 true if successfully parsed the message, false\n       *    otherwise.\n       */\n      handleNotifyReadyMessage = function(messageContents) {\n         let messageComponents =\n            StringUtils.uint8ArrayToString(messageContents).split('\\x00');\n\n         if (messageComponents instanceof Array &&\n            messageComponents.length >= 1) {\n            if (!!self.onReadyChanged) {\n               self.onReadyChanged(messageComponents[0] === 'ready');\n            }\n            return true;\n         } else {\n            return false;\n         }\n      };\n\n   }\n};\n\nif (Object.freeze) {\n   Unity = Object.freeze(Unity);\n}\n\n\nexport default Unity;\n\n\n// WEBPACK FOOTER //\n// ./desktop/remoteapp/unity.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * doLockHandler.js --\n *\n *      Implementation of the message handler to send doLock.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler} from './messageHandler';\n\n\nexport default function DoLockHandler() {\n   // member variables below\n   this.messageName = \"do-lock\";\n   this.messageText = \"do-lock\";\n   this.responseTag = \"lock\";\n\n   // register dependencies here\n   let router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nDoLockHandler.prototype = new MessageHandler();\nDoLockHandler.constructor = DoLockHandler;\n\nDoLockHandler.prototype.setRequestXML = function() {\n   this.requestXML = \"\";\n};\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nDoLockHandler.prototype.onUpdated = function() {\n   let doLockAction,\n      router = util.getObject(globalArray, \"router\"),\n      idleTimeoutTimerController = util.getObject(globalArray,\n         \"idle-timeout-timer\");\n\n   if (!idleTimeoutTimerController) {\n      JSCDKLogger.error(\n         \"do lock should only be triigered by the idleTimeoutTimerController\");\n      return;\n   }\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (!!(this.content[\"parsedResult\"]) &&\n      this.content[\"parsedResult\"][\"result\"] === \"ok\") {\n      JSCDKLogger.debug(\"doLock result is OK.\");\n      if (idleTimeoutTimerController.needDisplayDialogs) {\n         doLockAction = {name: \"DoLock\", result: \"ok\"};\n         JSCDKSetUI(JSON.stringify(doLockAction));\n      } else if (idleTimeoutTimerController.notifyLockEventToUI) {\n         JSCDKSetUI(JSON.stringify({name: \"AlreadyLock\"}));\n      }\n   } else {\n      JSCDKLogger.error(\"doLock failed.\");\n   }\n\n   // push error to UI\n   router.pushErrorToUser(this);\n};\n\n/**\n * parse locale information from the response XML of GetConfiguration\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return Object. key-value pairs parsed from response, if error then return\n *    null\n */\nDoLockHandler.prototype.parseResult = function(responseXML) {\n   let responseBody,\n      brokerTag,\n      responses,\n      resultText,\n      doLockResponse = {},\n      errorCodeElem,\n      errorMessageElem,\n      userMessageElem;\n\n   if (!responseXML || (responseXML === \"\")) {\n      return null;\n   }\n   responseBody = $(responseXML);\n   brokerTag = $(responseBody.children()[0]);\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of getAuthenticationStatus error\");\n      return null;\n   }\n   responses = brokerTag.children(this.responseTag);\n   resultText = responses.children(\"result\").text();\n   if (!!resultText && (resultText.trim() !== \"\")) {\n      doLockResponse[\"result\"] = resultText;\n   } else {\n      JSCDKLogger.error(\n         \"response of getAuthenticationStatus error, no valid result tag\");\n      return null;\n   }\n   if (resultText === \"error\") {\n      errorCodeElem = responseBody.find(\"error-code\");\n      doLockResponse[\"error-code\"] = errorCodeElem.text();\n      errorMessageElem = responseBody.find(\"error-message\");\n      doLockResponse[\"error-message\"] = errorMessageElem.text();\n      userMessageElem = responseBody.find(\"user-message\");\n      doLockResponse[\"user-message\"] = userMessageElem.text();\n   }\n   return doLockResponse;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/doLockHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getConfigurationHandler.js --\n *\n *      Implementation of the message handler to get configuration.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport JSCDKBrokerError from '../model/jscdkBrokerError';\nimport GetAuthenticationStatusHandler from './getAuthenticationStatusHandler';\nimport JSCDKClientController from './jscdkClientController';\n\n\n// all auth types here\nexport const HaveAuthTypesEnum = {\n   HAVEAUTHTYPE_DEFAULT: \"\",\n   HAVEAUTHTYPE_SAML: \"saml\",\n   HAVEAUTHTYPE_UNAUTH: \"unauthenticated\"\n};\n\nconst PasscodeAuthLabel = {\n   PASSCODE_AUTH_LABEL_RSA_SECURID: \"RSA SecurID\"\n};\n\nexport function GetConfigurationHandler() {\n   // member variables below\n   this.messageName = \"get-configuration\";\n   this.messageText = \"get-configuration\";\n   this.responseTag = \"configuration\";\n   this.authTypes = HaveAuthTypesEnum.HAVEAUTHTYPE_DEFAULT;\n\n   // register dependencies below, only involve setlocale when first sending\n   let setLocaleObject;\n   let router;\n   setLocaleObject = util.getObject(globalArray, \"set-locale\");\n   if (!!setLocaleObject) {\n      this.registerHandler(setLocaleObject, \"state\");\n   }\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n   this.ignoreResponseFlag = false;\n}\n\n// inherits MessageHandler prototype\nGetConfigurationHandler.prototype = new MessageHandler();\n// constructor\nGetConfigurationHandler.constructor = GetConfigurationHandler;\n\n/**\n * Set the request XML for Windows password authentication.\n *\n */\nGetConfigurationHandler.prototype.setRequestXML = function(ignoreResponse) {\n   // handle SAML\n   let samlNameElem,\n      unauthNameElem,\n      haveAuthTypesElem,\n      contentElem = \"\",\n      supprotedFeatures,\n      urlHandler = null,\n      authTypes;\n   authTypes = this.getAuthTypes();\n\n   if (authTypes === HaveAuthTypesEnum.HAVEAUTHTYPE_SAML) {\n      samlNameElem = util.createElement(\"name\", \"saml\");\n      haveAuthTypesElem =\n         util.createElement(\"have-authentication-types\", samlNameElem);\n      contentElem = haveAuthTypesElem;\n   } else if (authTypes === HaveAuthTypesEnum.HAVEAUTHTYPE_UNAUTH) {\n      unauthNameElem = util.createElement(\"name\", \"unauthenticated\");\n      haveAuthTypesElem =\n         util.createElement(\"have-authentication-types\", unauthNameElem);\n      contentElem = haveAuthTypesElem;\n   }\n\n   supprotedFeatures = util.createElement(\"feature\", \"lastUserActivity\");\n   supprotedFeatures += util.createElement(\"feature\", \"reauthentication\");\n   supprotedFeatures += util.createElement(\"feature\", \"nameResolution\");\n   supprotedFeatures += util.createElement(\"feature\", \"redirection\");\n   supprotedFeatures += util.createElement(\"feature\", \"workspaceOneMode\");\n   urlHandler = util.getObject(globalArray, \"url-handler\");\n   if (!!urlHandler && urlHandler.params.allowCollaboration === \"1\") {\n      supprotedFeatures += util.createElement(\"feature\", \"shadowSessions\");\n   }\n   contentElem += util.createElement(\"supported-features\", supprotedFeatures);\n\n   this.requestXML = contentElem;\n   if (ignoreResponse === true) {\n      this.ignoreResponseFlag = true;\n   } else {\n      this.ignoreResponseFlag = false;\n   }\n};\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nGetConfigurationHandler.prototype.onUpdated = function() {\n   let errorObj,\n      errorCode,\n      router = util.getObject(globalArray, \"router\"),\n      sendGetAuthenticationStatus = function() {\n         let getAuthenticationStatusObject =\n               globalArray[\"get-authentication-status\"],\n            handlerList;\n         if (!getAuthenticationStatusObject) {\n            getAuthenticationStatusObject =\n               new GetAuthenticationStatusHandler();\n            globalArray[getAuthenticationStatusObject.messageName] =\n               getAuthenticationStatusObject;\n            globalArray[getAuthenticationStatusObject.responseTag] =\n               getAuthenticationStatusObject;\n         } else {\n            getAuthenticationStatusObject.resetData();\n         }\n\n         if (!!getAuthenticationStatusObject && !!router) {\n            getAuthenticationStatusObject.setRequestXML(false);\n            handlerList = getAuthenticationStatusObject.composeHandlerList();\n            router.postMessage(handlerList);\n         }\n      };\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (this.ignoreResponseFlag === false) {\n      if (this.state === StateEnum.DONE) {\n         this.handleParsedResult(this.content[\"parsedResult\"]);\n      }\n      // if the error is special for this handler, alert\n      router.pushErrorToUser(this);\n   } else {\n      // treat already authed error as success\n      errorObj = this.content[\"error\"];\n      if (!!errorObj && !!errorObj[this.messageName]) {\n         errorCode = errorObj[this.messageName][\"errorCode\"];\n         if (errorCode ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_ALREADY_AUTHENTICATED) {\n            //treat as success to set state to done. cause further step info is\n            // already in error message\n            this.setState(StateEnum.DONE);\n         }\n\n         /**\n          * If in workspace one mode, push error to UI layer directly.\n          * No need to get authentication status in this case.\n          */\n         if (!!errorObj[this.messageName][\"workspaceOneServerHostname\"]) {\n            router.pushErrorToUser(this);\n            return;\n         }\n      }\n\n      /**\n       * Try send get-authentication-status XML, and use its response to\n       * decide next action\n       */\n      sendGetAuthenticationStatus();\n   }\n};\n\n/**\n * compose list of message handlers who can be sent together in a single message\n * @return handler list whose messages can be sent together in a single message\n */\nGetConfigurationHandler.prototype.composeHandlerList = function() {\n   let setLocaleObject,\n      composedHandlerList = this.composedHandlerList;\n   if (composedHandlerList.length > 0) {\n      return composedHandlerList;\n   }\n   if (!!globalArray) {\n      setLocaleObject = globalArray[\"set-locale\"];\n      if (!!setLocaleObject) {\n         composedHandlerList.push(setLocaleObject);\n      }\n   }\n   composedHandlerList.push(this);\n   return composedHandlerList;\n};\n\n/**\n * parse configuration information from the response XML of GetConfiguration\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return Object. key-value pairs parsed from response, if error then return null\n */\nGetConfigurationHandler.prototype.parseResult = function(responseXML) {\n   let responseBody = $(responseXML);\n   let authentication = {};\n   let brokerElem;\n   let responseTagElem;\n   let resultElem;\n   let resultText;\n   let authElem;\n   let authScreenElem;\n   let clientConfigElem;\n   let clientConfiguration = {};\n   let workspaceElem;\n   let screenNameElem;\n   let screenNameText;\n   let paramsElem;\n   let paramsLength;\n   let errorCodeElem;\n   let errorMessageElem;\n   let userMessageElem;\n   if (!responseXML || (responseXML === \"\")) {\n      return null;\n   }\n   brokerElem = responseBody.find(\"broker\");\n   if (!brokerElem) {\n      JSCDKLogger.error(\"response of GetConfiguration error\");\n      return null;\n   }\n   responseTagElem = brokerElem.find(this.responseTag);\n   resultElem = responseTagElem.find(\"result\");\n   resultText = resultElem.text();\n   if (!!resultText && (resultText.trim() !== \"\")) {\n      authentication[\"result\"] = resultText;\n   } else {\n      return null;\n   }\n   if (resultText === \"ok\") {\n      authElem = brokerElem.find(\"authentication\");\n      if (!authElem) {\n         JSCDKLogger.error(\n            \"No authentication element in response of getConfiguration\");\n         return null;\n      }\n\n      authScreenElem = authElem.children(\"screen\");\n      if (!authScreenElem) {\n         JSCDKLogger.error(\"No screen element in response of getConfiguration\");\n         return null;\n      }\n      screenNameText = $(authScreenElem).children(\"name\").text();\n      util.addItemForJson(authentication, \"screen\",\n         $(authScreenElem).children(\"name\").text());\n      $(authScreenElem).children(\"params\").children(\"param\").each(function() {\n         let child = $(this);\n         let nameText = child.find(\"name\").text();\n         let valueList = [];\n         child.find(\"value\").each(function() {\n            // Special handle for unauthenticated login\n            if (screenNameText === 'unauthenticated' &&\n               nameText === 'username') {\n               valueList.push({\n                  value: $(this).text(),\n                  default: !!$(this).attr('default')\n               });\n            } else {\n               valueList.push($(this).text());\n            }\n         });\n         util.addItemForJson(authentication, nameText, valueList);\n      });\n\n      // Parse client-configuration section\n      clientConfigElem = brokerElem.find(\"client-configuration\");\n      if (!!clientConfigElem) {\n         $(clientConfigElem).children(\"params\").children(\"param\")\n            .each(function() {\n               let child = $(this);\n               let nameText = child.find(\"name\").text();\n               let valueList = [];\n               child.find(\"value\").each(function() {\n                  valueList.push($(this).text());\n               });\n               util.addItemForJson(clientConfiguration, nameText, valueList);\n            });\n         util.addItemForJson(authentication, \"clientConfiguration\",\n            clientConfiguration);\n      }\n\n   } else if (resultText === \"error\") {\n      errorCodeElem = responseBody.find(\"error-code\");\n      authentication[\"error-code\"] = errorCodeElem.text();\n      errorMessageElem = responseBody.find(\"error-message\");\n      authentication[\"error-message\"] = errorMessageElem.text();\n      userMessageElem = responseBody.find(\"user-message\");\n      authentication[\"user-message\"] = userMessageElem.text();\n   }\n\n   // Parse workspaceOneServerHostname\n   workspaceElem = brokerElem.find(\"workspace-one-server-hostname\");\n   if (!!workspaceElem && !!workspaceElem.text()) {\n      util.addItemForJson(authentication, \"workspaceOneServerHostname\",\n         workspaceElem.text());\n\n      // Once broker returns ws1 server name, enable ws1 mode\n      globalArray['ws1Mode'] = true;\n      globalArray['workspaceOneServerHostname'] = workspaceElem.text();\n   }\n\n   return authentication;\n};\n\nGetConfigurationHandler.prototype.setAuthTypes = function(authTypes) {\n   this.authTypes = authTypes;\n};\n\nGetConfigurationHandler.prototype.getAuthTypes = function() {\n   return this.authTypes;\n};\n\n\n/**\n * handle parsed xml response to show different authentication dialgs.\n *\n * @param parsedResult [in] the result of parsed response.\n */\n\nGetConfigurationHandler.prototype.handleParsedResult =\n   function(parsedResult, isReauth) {\n      let urlHandler = util.getObject(globalArray, \"url-handler\"),\n         urlParams,\n         samlSecret,\n         submitAuthInfoAction = {},\n         label = PasscodeAuthLabel.PASSCODE_AUTH_LABEL_RSA_SECURID,\n         authenticationAction = {},\n         actionContent = {},\n         router = util.getObject(globalArray, \"router\"),\n         authType,\n         authChallenge;\n\n      if (parsedResult[\"screen\"] === \"windows-password\") {\n         authenticationAction.name = \"WindowsPassword\";\n         actionContent.domains = parsedResult[\"domain\"];\n\n         if (!!urlHandler) {\n            urlParams = urlHandler.params;\n            if (!!urlParams.userName) {\n               actionContent.username = urlParams.userName;\n            }\n            if (!!urlParams.domainName) {\n               actionContent.domainName = urlParams.domainName;\n            }\n         }\n      } else if (parsedResult[\"screen\"] === \"windows-password-expired\") {\n         authenticationAction.name = \"WindowsPasswordExpired\";\n      } else if (parsedResult[\"screen\"] === \"securid-passcode\") {\n         if (!!urlHandler) {\n            urlParams = urlHandler.params;\n            if (!!urlParams.tokenUserName) {\n               actionContent.username = urlParams.tokenUserName;\n            } else if (!!urlHandler.params.userName) {\n               actionContent.username = urlParams.userName;\n            }\n         }\n         authenticationAction.name = \"SecurIDPasscode\";\n         if (!!parsedResult[\"auth-label\"]) {\n            label = parsedResult[\"auth-label\"][0];\n         }\n         if (!!parsedResult[\"auth-type\"]) {\n            authType = parsedResult[\"auth-type\"][0];\n         }\n\n         actionContent.label = label;\n         actionContent.authType = authType;\n      } else if (parsedResult[\"screen\"] === \"securid-nexttokencode\") {\n         if (!!parsedResult[\"auth-label\"]) {\n            label = parsedResult[\"auth-label\"][0];\n         }\n         if (!!parsedResult[\"auth-type\"]) {\n            authType = parsedResult[\"auth-type\"][0];\n         }\n         if (!!parsedResult[\"auth-challenge-string\"]) {\n            authChallenge = parsedResult[\"auth-challenge-string\"][0];\n         }\n         authenticationAction.name = \"SecurIDNextTokenCode\";\n         actionContent.label = label;\n         actionContent.authType = authType;\n         actionContent.authChallenge = authChallenge;\n      } else if (parsedResult[\"screen\"] === \"securid-pinchange\") {\n         authenticationAction.name = \"SecurIDPinChange\";\n         if (parsedResult[\"message\"] && parsedResult[\"message\"][0]) {\n            actionContent.message = parsedResult[\"message\"][0];\n\n            /**\n             * \"user-selectable\" is currently not used because the information\n             * it provides us (whether there is a PIN and whether that PIN is\n             * read-only) are provided in another form by the broker\n             */\n            actionContent[\"user-selectable\"] =\n               parsedResult[\"user-selectable\"][0];\n         }\n         if (parsedResult[\"pin1\"] && parsedResult[\"pin1\"][0]) {\n            actionContent[\"pin1\"] = parsedResult[\"pin1\"][0];\n            actionContent[\"pin1ReadOnly\"] = parsedResult[\"pin1ReadOnly\"];\n         }\n      } else if (parsedResult[\"screen\"] === \"securid-wait\") {\n         authenticationAction.name = \"SecurIDWait\";\n      } else if (parsedResult[\"screen\"] === \"saml\") {\n         authenticationAction.name = \"SAML\";\n         samlSecret = util.getObject(globalArray, \"samlArt\");\n         submitAuthInfoAction.method = \"SubmitAuthInfo\";\n         submitAuthInfoAction.type = \"SAML\";\n         submitAuthInfoAction.secret = samlSecret;\n         submitAuthInfoAction.reAuth = isReauth;\n         delete globalArray[\"samlArt\"];\n         // SAML submit authentication information directly\n         JSCDKClientController.getInstance().execute(submitAuthInfoAction);\n      } else if (parsedResult[\"screen\"] === \"cert-auth\") {\n         /**\n          * If we have been asked to confirm \"cert-auth\", that means that the\n          * user already performed it as part of the SSL handshake when\n          * initially connecting to the server.  As a result, it is best to\n          * always accept it.\n          */\n         authenticationAction.name = \"CertAuth\";\n         submitAuthInfoAction.method = \"SubmitAuthInfo\";\n         submitAuthInfoAction.type = \"CertAuth\";\n         submitAuthInfoAction.accept = \"true\";\n         JSCDKClientController.getInstance().execute(submitAuthInfoAction);\n      } else if (parsedResult[\"screen\"] === \"disclaimer\") {\n         authenticationAction.name = \"Disclaimer\";\n         actionContent.label = parsedResult[\"text\"][0];\n      } else if (parsedResult[\"screen\"] === \"unauthenticated\") {\n         authenticationAction.name = \"Unauthenticated\";\n         actionContent.usernames = parsedResult[\"username\"];\n      }\n\n      // Don't set the username when use unauthenticated\n      if (authenticationAction.name !== \"Unauthenticated\" &&\n         !!(parsedResult[\"username\"]) && !!(parsedResult[\"username\"][0])) {\n         actionContent.username = parsedResult[\"username\"][0];\n         actionContent.usernameReadOnly = parsedResult.usernameReadOnly;\n      }\n      if (!!(parsedResult[\"domain\"]) && !!(parsedResult[\"domain\"][0])) {\n         actionContent.domain = parsedResult[\"domain\"][0];\n         actionContent.domainReadOnly = parsedResult.domainReadOnly;\n      }\n\n      if (parsedResult[\"error\"] && parsedResult[\"error\"][0]) {\n         actionContent.error = parsedResult[\"error\"][0];\n      }\n\n      if (!!parsedResult[\"clientConfiguration\"]) {\n         actionContent.clientConfig = {};\n         let clientConfiguration = parsedResult[\"clientConfiguration\"];\n\n         if (!!clientConfiguration[\"enableCredentialCleanupForHTMLAccess\"]) {\n            actionContent.clientConfig['enableCredentialCleanupForHTMLAccess'] =\n               (clientConfiguration[\"enableCredentialCleanupForHTMLAccess\"][0]\n               === \"true\");\n         }\n         if (!!clientConfiguration[\"clientHideServerInformation\"]) {\n            actionContent.clientConfig['clientHideServerInformation'] =\n               (clientConfiguration[\"clientHideServerInformation\"][0]\n               === \"true\");\n         }\n         if (!!clientConfiguration[\"clientHideDomainList\"]) {\n            actionContent.clientConfig['clientHideDomainList'] =\n               (clientConfiguration[\"clientHideDomainList\"][0] === \"true\");\n         }\n      }\n\n      if (!!parsedResult[\"workspaceOneServerHostname\"]) {\n         actionContent.workspaceOneServerHostname =\n            parsedResult[\"workspaceOneServerHostname\"];\n      }\n\n      actionContent.brokerUrl = encodeURIComponent(router.brokerUrl);\n      authenticationAction.content = actionContent;\n      JSCDKSetUI(JSON.stringify(authenticationAction));\n   };\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/getConfigurationHandler.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * GetUserGlobalPrefHandler.js --\n *\n *      Implementation of the message handler to get user global setting.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\n\n\nexport default function GetUserGlobalPrefHandler() {\n   // member variables\n   this.messageName = \"get-user-global-preferences\";\n   this.messageText = \"get-user-global-preferences\";\n   this.responseTag = \"user-global-preferences\";\n\n   this.notifyUI = true;\n\n   this.subHandlerList = [];\n   this.composedHandlerList = [];\n\n   this.prefData = {\n      favorites: [] //favorites is an array\n   };\n}\n\n// inherits MessageHandler prototype\nGetUserGlobalPrefHandler.prototype = new MessageHandler();\nGetUserGlobalPrefHandler.constructor = GetUserGlobalPrefHandler;\n\n/**\n * Reset handler's state and content.\n *\n */\nGetUserGlobalPrefHandler.prototype.resetData = function() {\n   MessageHandler.prototype.resetData.apply(this);\n};\n\n/**\n * set the request XML for getting user global preference\n */\nGetUserGlobalPrefHandler.prototype.setRequestXML = function() {\n   this.requestXML = util.createElement(\"get-user-global-preferences\");\n};\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nGetUserGlobalPrefHandler.prototype.onUpdated = function() {\n   let launchitemsHandler = globalArray['get-launch-items'];\n\n   MessageHandler.prototype.onUpdated.apply(this);\n\n   if (this.state === StateEnum.DONE) {\n      if (!!launchitemsHandler &&\n         !!(launchitemsHandler.content[\"parsedResult\"])) {\n         this.markFavorite(launchitemsHandler.content.parsedResult.desktops);\n         this.markFavorite(\n            launchitemsHandler.content.parsedResult.applications);\n      }\n   }\n   JSCDKSetUI(JSON.stringify({\n      ignoreData: true,\n      name: 'GetUserGlobalPref'\n   }));\n};\n\nGetUserGlobalPrefHandler.prototype.markFavorite = function(items) {\n   let key;\n   for (key in items) {\n      if (items.hasOwnProperty(key)) {\n         if (this.prefData.favorites.indexOf(items[key].id) >= 0) {\n            items[key].favorite = true;\n         } else {\n            items[key].favorite = false;\n         }\n      }\n   }\n};\n\n/**\n * parse user global preference information from the response XML\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\nGetUserGlobalPrefHandler.prototype.parseResult = function(responseXML) {\n   let responseBody = responseXML,\n      brokerTag = util.getChildNode(responseBody, \"broker\", 0),\n      result,\n      errorCodeNode,\n      errorMessageNode,\n      resultElem,\n      favoriteItems = {},\n      prefNodes,\n      resp = {},\n      i,\n      pref = {},\n      value = \"\",\n      len,\n      name,\n      key;\n\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of GetUserGlobalPref error.\");\n      return null;\n   }\n   this.prefData = {\n      favorites: [] //favorites is an array\n   };\n\n   resultElem = util.getChildNode(brokerTag, this.responseTag, 0);\n   resultElem = util.getChildNode(resultElem, 'result', 0);\n   if (!resultElem || !(resultElem.hasChildNodes())) {\n      return null;\n   }\n   result = resultElem.childNodes[0].nodeValue;\n   resp[\"result\"] = result;\n   if (result === \"ok\") {\n      prefNodes = brokerTag.getElementsByTagName(\"preference\");\n      for (i = 0, len = prefNodes.length; i < len; i++) {\n         name = prefNodes[i].getAttribute(\"name\");\n         if (!!name) {\n            value = $(prefNodes[i]).text();\n            if (name.substring(0, 'favorite'.length) === 'favorite') {\n               pref = {\n                  name: name,\n                  id: value\n               };\n               // pref[\"name\"] = name;\n               // pref[\"id\"] = value;\n               favoriteItems[Object.keys(favoriteItems).length] = pref;\n\n               this.prefData.favorites.push(value);\n            } else {\n               this.prefData[name] = value;\n            }\n         }\n      }\n\n      JSCDKLogger.debug(\"favorite items: \" + JSON.stringify(favoriteItems));\n      resp[\"items\"] = favoriteItems;\n   } else if (result === \"error\") {\n      errorCodeNode = util.getChildNode(responseBody, \"error-code\", 0);\n      if (!!errorCodeNode) {\n         resp[\"error-code\"] = $(errorCodeNode).text();\n      }\n      errorMessageNode = util.getChildNode(responseBody, \"error-message\", 0);\n      if (!!errorMessageNode) {\n         resp[\"error-message\"] = $(errorMessageNode).text();\n      }\n   }\n   return resp;\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/getUserGlobalPrefHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * jscdkClientController.js --\n *\n * JSCDKClientController is the centralized request handling class,\n * that delegates requests to appropriate command classes.\n *\n * Singleton Class\n *\n */\n\nimport FrontController from './frontController';\nimport SetViewURICommand from '../commands/setViewURICommand';\nimport ConnectToBrokerCommand from '../commands/connectToBrokerCommand';\nimport SubmitAuthInfoCommand from '../commands/submitAuthInfoCommand';\nimport ConnectToDesktopCommand from '../commands/connectToDesktopCommand';\nimport CancelAuthenticationCommand from '../commands/cancelAuthenticationCommand';\nimport LogoutBrokerCommand from '../commands/logoutBrokerCommand';\nimport ResetDesktopCommand from '../commands/resetDesktopCommand';\nimport RestartDesktopCommand from '../commands/restartDesktopCommand';\nimport KillSessionCommand from '../commands/killSessionCommand';\nimport RollbackDesktopCommand from '../commands/rollbackDesktopCommand';\nimport GetDesktopsCommand from '../commands/getDesktopsCommand';\nimport GetLaunchItemsCommand from '../commands/getLaunchItemsCommand';\nimport CancelCurrentRequestCommand from '../commands/cancelCurrentRequestCommand';\nimport HandleURICommand from '../commands/handleURICommand';\nimport GetTunnelConnectionCommand from '../commands/getTunnelConnectionCommand';\nimport ConnectToApplicationCommand from '../commands/connectToApplicationCommand';\nimport ReconnectApplicationSessionsCommand from '../commands/reconnectApplicationSessionsCommand';\nimport DisconnectSessionCommand from '../commands/disconnectSessionCommand';\nimport DoLockCommand from '../commands/doLockCommand';\nimport GetAuthenticationStatusCommand from '../commands/getAuthenticationStatusCommand';\nimport DoUnlockCommand from '../commands/doUnlockCommand';\nimport SetLastUserActivityCommand from '../commands/setLastUserActivityCommand';\nimport TimerCtrlCommand from '../commands/timerCtrlCommand';\nimport InitRouterCommand from '../commands/initRouterCommand';\nimport SetUserGlobalPrefCommand from '../commands/setUserGlobalPrefCommand';\nimport GetUserGlobalPrefCommand from '../commands/getUserGlobalPrefCommand';\nimport SetEnvironmentInfoCommand from '../commands/setEnvironmentInfoCommand';\n\n\nlet JSCDKClientController = (function() {\n\n   /**\n    * AuthenticationController derives from FrontController\n    *\n    * @returns {AuthenticationController}\n    */\n   function JSCDKFrontController() {\n      this.addCommand(\"SetViewURI\", SetViewURICommand);\n      this.addCommand(\"ConnectToBroker\", ConnectToBrokerCommand);\n      this.addCommand(\"SubmitAuthInfo\", SubmitAuthInfoCommand);\n      this.addCommand(\"ConnectToDesktop\", ConnectToDesktopCommand);\n      this.addCommand(\"ConnectToApplication\", ConnectToApplicationCommand);\n      this.addCommand(\"ReconnectSession\", ReconnectApplicationSessionsCommand);\n      this.addCommand(\"CancelAuthentication\", CancelAuthenticationCommand);\n      this.addCommand(\"LogoutFromBroker\", LogoutBrokerCommand);\n      this.addCommand(\"ResetDesktop\", ResetDesktopCommand);\n      this.addCommand(\"RestartDesktop\", RestartDesktopCommand);\n      this.addCommand(\"KillSession\", KillSessionCommand);\n      this.addCommand(\"RollbackDesktop\", RollbackDesktopCommand);\n      this.addCommand(\"GetDesktops\", GetDesktopsCommand);\n      this.addCommand(\"GetLaunchItems\", GetLaunchItemsCommand);\n      this.addCommand(\"CancelCurrentRequest\", CancelCurrentRequestCommand);\n      this.addCommand(\"HandleURI\", HandleURICommand);\n      this.addCommand(\"GetTunnelConnection\", GetTunnelConnectionCommand);\n      this.addCommand(\"DisconnectSession\", DisconnectSessionCommand);\n      this.addCommand(\"DoLock\", DoLockCommand);\n      this.addCommand(\"GetAuthenticationStatus\",\n         GetAuthenticationStatusCommand);\n      this.addCommand(\"SetLastUserActivity\", SetLastUserActivityCommand);\n      this.addCommand(\"DoUnlock\", DoUnlockCommand);\n      this.addCommand(\"TimerCtrl\", TimerCtrlCommand);\n      this.addCommand(\"InitRouter\", InitRouterCommand);\n      this.addCommand(\"SetUserGlobalPref\", SetUserGlobalPrefCommand);\n      this.addCommand(\"GetUserGlobalPref\", GetUserGlobalPrefCommand);\n      this.addCommand(\"SetEnvironmentInfo\", SetEnvironmentInfoCommand);\n   }\n\n   JSCDKFrontController.prototype = new FrontController();\n   JSCDKFrontController.constructor = JSCDKFrontController;\n\n   /**\n    * single instance of authenticate controller\n    */\n   let _instance;\n\n   return {\n\n      /**\n       * @returns  A singleton instance of {AuthenticationController}\n       */\n      getInstance: function() {\n         if (!_instance) {\n            _instance = new JSCDKFrontController();\n         }\n\n         return _instance;\n      }\n   };\n\n}());\n\nexport default JSCDKClientController;\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/jscdkClientController.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * restartDesktopHandler.js --\n *\n *      Implementation of the message handler to restart desktop.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport Router from './router';\n\n\nexport default function RestartDesktopHandler() {\n   let router;\n\n   // member variables below\n   this.messageName = \"perform-action\";\n   this.messageText = \"perform-action\";\n   this.responseTag = \"perform-action\";\n   this.composedHandlerList = [];\n   // requestId will increase when a new instance is created\n   // use prototype requestId to share in all instances\n   RestartDesktopHandler.prototype.requestId += 1;\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n   }\n}\n\n// inherits MessageHandler prototype\nRestartDesktopHandler.prototype = new MessageHandler();\n// constructor\nRestartDesktopHandler.constructor = RestartDesktopHandler;\n\n/**\n * parse information from the response XML of restart-desktop\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\nRestartDesktopHandler.prototype.parseResult = function(responseXML) {\n   let responseBody = responseXML;\n   let brokerTag;\n   let responses;\n   let result;\n   let tokenText;\n   let restartDesktopResponse = {};\n   let xmlDoc;\n\n   xmlDoc = $(responseXML);\n   brokerTag = $(xmlDoc.children()[0]);\n   responses = brokerTag.children(this.responseTag);\n   result = responses.children(\"result\").text();\n   if (result === \"ok\" || result === \"error\") {\n      /*\n       * Add the \"ok\" and \"error\" response to the response JSON struct,\n       * because for the \"ok\" and \"error\" result, the response XML structure\n       * are the same, the following code can work in both cases.\n       */\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         util.addItemForJson(restartDesktopResponse, nameText, $(this).text());\n      });\n   }\n   return restartDesktopResponse;\n};\n\n/**\n * Set the request XML for restart-desktop\n * @param desktopId[in] desktop id to restart\n *\n */\nRestartDesktopHandler.prototype.setRequestXML = function(desktopId) {\n   let idElem = util.createElement(\"id\", desktopId),\n      typeElem = util.createElement(\"type\", 'restart'),\n      content = idElem + typeElem,\n      desktopElem = util.createElement(\"desktop\", content);\n\n   this.requestXML = desktopElem;\n};\n\n/**\n * callback when received notification from handlers in dependency list or\n * router\n *\n */\nRestartDesktopHandler.prototype.onUpdated = function() {\n   let restartDesktopAction;\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (this.state === StateEnum.DONE) {\n      if (!!(this.content[\"parsedResult\"]) &&\n         this.content[\"parsedResult\"][\"result\"] === \"ok\") {\n         JSCDKLogger.debug('Restart desktop succeeds.');\n\n         // Kill session succeeds\n         restartDesktopAction = {name: \"RestartDesktop\", result: \"ok\"};\n         JSCDKSetUI(JSON.stringify(restartDesktopAction));\n      }\n   }\n\n   // push error if it exists\n   Router.prototype.pushErrorToUser(this);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/restartDesktopHandler.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * setLastUserActivityHandler.js --\n *\n *      Implementation of the message handler to set last user activity time.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\n\n\nexport default function SetLastUserActivityHandler()\n{\n   let router;\n\n   // member variables\n   this.messageName = \"set-last-user-activity\";\n   this.messageText = \"set-last-user-activity\";\n   this.responseTag = \"set-last-user-activity\";\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nSetLastUserActivityHandler.prototype = new MessageHandler();\nSetLastUserActivityHandler.constructor = SetLastUserActivityHandler;\n\n/**\n  * Set the request XML for set last activity.\n  *\n  * @param inactiveTime [in] t1-t0, in which t0 is the last time user have\n  *    activities, t1 is current time, both in seconds from 1970.\n  */\nSetLastUserActivityHandler.prototype.setRequestXML = function(inactiveTime)\n{\n  this.requestXML = util.createElement(\"last-user-activity\", inactiveTime);\n};\n\n/**\n  * callback when received notification from handlers in dependency list or\n  * network\n  *\n  */\nSetLastUserActivityHandler.prototype.onUpdated = function()\n{\n   let parsedResult,\n       errorInfo,\n       errorCode,\n       router = util.getObject(globalArray, \"router\");\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's onUpdated\n\n   if (this.content[\"error\"]) {\n      parsedResult = this.content[\"error\"];\n      if (!!(parsedResult[this.responseTag])) {\n         errorInfo = parsedResult[this.responseTag];\n         errorCode = errorInfo[\"error-code\"];\n         if (errorCode === \"OUT_OF_SEQUENCE_ERROR\") {\n            this.setState(StateEnum.DONE);\n            JSCDKLogger.debug(\"ignore error: \" + errorCode);\n         }\n      }\n   }\n\n   // ensure handler has done its task and request is from \"WindowsPassword\" to\n   // JSCDK\n   if (this.state === StateEnum.DONE) {\n      JSCDKLogger.debug(\"SetLastUserActivity success\");//ok\n   }\n   // push error to UI\n   router.pushErrorToUser(this);\n};\n\n/**\n  * parse desktops information from the response XML\n  *\n  * @param responseXML[in] response of xmlhttprequest from view broker\n  * @return key-value pairs parsed from response, if error then return null\n  */\nSetLastUserActivityHandler.prototype.parseResult = function(responseXML)\n{\n   let responseBody,\n       brokerTag,\n       responses,\n       resultText,\n       setLastUserActivityResponse = {};\n\n   if (!responseXML || (responseXML === \"\")) {\n      return null;\n   }\n   responseBody = $(responseXML);\n   brokerTag = $(responseBody.children()[0]);\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of getAuthenticationStatus error\");\n      return null;\n   }\n   responses = brokerTag.children(this.responseTag);\n   resultText = responses.children(\"result\").text();\n   if (!!resultText && (resultText.trim() !== \"\")) {\n      setLastUserActivityResponse[\"result\"] = resultText;\n   } else {\n      JSCDKLogger.error(\"response of getAuthenticationStatus error, no valid result tag\");\n      return null;\n   }\n   //no need to deal with 'ok'\n   if (resultText === \"error\") {\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         util.addItemForJson(setLastUserActivityResponse, nameText, $(this).text());\n      });\n   }\n   return setLastUserActivityResponse;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/setLastUserActivityHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * urlHandler.js --\n *\n *      Implementation of the handler to deal with url\n */\n\nimport $ from 'jquery';\nimport JSCDKLogger from '../jscdkLogger';\nimport util from '../util';\nimport {JSCDKSetUI} from '../jscdkClient';\n\n// the list for action names.\nconst ActionEnum = {\n   STARTSESSION: \"start-session\",\n   BROWSE: \"browse\",\n   LOGOFF: \"logoff\",\n   RESET: \"reset\"\n};\nconst UrlHandlerError = {\n   URI_ERROR_INVALID_URL_PARAMETER: \"INVALID_URL_PARAMETER\"\n   // XXX TODO: add more error type if needed in the future.\n};\n\nexport default function UrlHandler() {\n   // member variables below\n   this.name = \"url-handler\";\n\n   this.params = {\n      samlArt: null,\n      userName: null,\n      tokenUserName: null,\n      domainName: null,\n      host: null,\n      port: null,\n      desktopId: null,\n      desktopName: null,\n      desktopProtocol: null,\n      allowCollaboration: null,\n      collabSessionId: null,\n      applicationId: null,\n      applicationName: null,\n      schemeName: null,\n      path: null,\n      action: null,\n      horizonId: null,\n      mid: null,\n      args: null,\n      unauthenticatedAccessEnabled: null,\n      unauthenticatedAccessAccount: null,\n      spID: null\n   };\n}\n\nUrlHandler.constructor = UrlHandler;\n\n/**\n * handle url params in url\n *\n * @param url [in] url to be handled, such as window.location.search\n *\n */\nUrlHandler.prototype.handleUrlParams = function(url) {\n   let parsedUriInfo = {};\n   try {\n      if (typeof url === 'object') {\n         this.fillParams(url);\n         if (this.isErrorInParameters()) {\n            JSCDKLogger.error('Url has invalid param');\n            return;\n         }\n\n         JSCDKLogger.debug('Url has valid param');\n\n         parsedUriInfo.name = 'ParsedUriInfo';\n         parsedUriInfo.content = this.params;\n         JSCDKSetUI(JSON.stringify(parsedUriInfo));\n      } else if (typeof url === 'string') {\n         this.loadParams(url);\n\n         parsedUriInfo.name = 'Brokers';\n         parsedUriInfo.params = this.params;\n         JSCDKSetUI(JSON.stringify(parsedUriInfo));\n      }\n   } catch (error) {\n      JSCDKLogger.error('Url params are invalid: ' + error);\n\n      parsedUriInfo.name = 'Brokers';\n      JSCDKSetUI(JSON.stringify(parsedUriInfo));\n   }\n};\n\n/**\n * validate params in url and fill params\n *\n * @param url [in] url to be handled, such as window.location.search\n *\n */\nUrlHandler.prototype.fillParams = function(url) {\n   let urlKey,\n      paramKey;\n\n   for (urlKey in url) {\n      if (url.hasOwnProperty(urlKey)) {\n         for (paramKey in this.params) {\n            if (this.params.hasOwnProperty(paramKey)) {\n               if (paramKey.toLowerCase() === urlKey.toLowerCase()) {\n                  this.params[paramKey] = url[urlKey];\n                  break;\n               }\n            }\n         }\n      }\n   }\n\n   if (!!this.params.samlArt) {\n      this.params.samlArt = decodeURIComponent(this.params.samlArt);\n   }\n\n   if (!!this.params.userName) {\n      this.params.userName = decodeURIComponent(this.params.userName);\n   }\n\n   if (!!this.params.host) {\n      this.params.host = decodeURIComponent(this.params.host);\n   }\n\n   // the vcsId is not decoded, and will be returned and used directly\n\n   /* The desktop id is indicated in the path param.\n    * The path param starts with \"/\", so it needs to be removed to get the desktop id.\n    */\n   if (!!this.params.path && this.params.path.length > 1) {\n      this.params.desktopId = decodeURIComponent(this.params.path.substring(1));\n   }\n\n   // At present RDP is the only supported protocol for Metro client.\n   if (!this.params.desktopProtocol) {\n      this.params.desktopProtocol = 'RDP';\n   }\n};\n/**\n * This is done according to\n * https://wiki.eng.vmware.com/VDM/ClientBrokerXml#Request_23 and\n * https://wiki.eng.vmware.com/EUCBU/RX/SupportRDSHApplicationParameters\n * @sideeffects before this function, this.params.args is the escaped command\n *    line string, after, this.params.args will be an array of splited command\n *    lines according to XML spec\n */\nUrlHandler.prototype.formatArgs = function() {\n   let arg;\n   if (!!this.params.args) {\n      // use whole input string as the first and only param as spec requires\n      arg = this.params.args;\n      this.params.args = [arg];\n   }\n};\n\nUrlHandler.prototype.loadParams = function(url) {\n   let a, key, value;\n\n   a = $('<a>', {\n      href: url\n   })[0];\n   this.params.host = a.hostname;\n   this.params.port = a.port;\n   this.params.schemeName = a.protocol;\n\n   // Load mandatory params.\n   for (key in this.params) {\n      if (this.params.hasOwnProperty(key)) {\n         value = this.parseParam(a.search, key);\n         if (!!value) {\n            this.params[key] = value;\n         }\n      }\n   }\n\n   // BLAST is the default protocol.\n   if (!this.params.desktopProtocol) {\n      this.params.desktopProtocol = 'BLAST';\n   }\n\n   this.formatArgs();\n};\n\n/**\n * parse param value from url, param name is considered case-insensitiv\n *   param value is considered case-sensitive\n *\n * @param url [in] url to be handled, such as window.location.search\n * @param name [in] name of param key\n * @return param value\n *\n */\nUrlHandler.prototype.parseParam = function(url, name) {\n   // use 'i' here to ignore case of param name\n   return decodeURIComponent(\n      (new RegExp('.*([?|&]' + name + '=' + '([^&;]+?)(&|#|;|$))', 'i')\n         .exec(url) || [null, null, ''])[2]);\n};\n\n/**\n * refresh data\n *\n */\nUrlHandler.prototype.refresh = function() {\n   this.params = null;\n};\n\n/**\n * reset all params.\n */\nUrlHandler.prototype.resetParams = function() {\n   let key;\n   for (key in this.params) {\n      if (this.params.hasOwnProperty(key)) {\n         this.params[key] = null;\n      }\n   }\n};\n\n/**\n * Check wherther there is an error in parameters.\n *\n * @return true if there is an error, otherwise false.\n */\nUrlHandler.prototype.isErrorInParameters = function() {\n   let pushErrorToUI = {};\n\n   pushErrorToUI.content = {};\n\n   if (!this.params.action ||\n      this.params.action.toLowerCase() === ActionEnum.BROWSE) {\n      return false;\n   }\n\n   // For other actions like \"start-session\" there should be a desktopId.\n   if (!this.params.desktopId) {\n      // push error to UI\n      pushErrorToUI.name = \"ShowError\";\n      pushErrorToUI.content.errorType =\n         UrlHandlerError.URI_ERROR_INVALID_URL_PARAMETER;\n      pushErrorToUI.content.errorText =\n         util._(\n            \"The URL is invalid because it is missing the name of the desktop.\");\n      JSCDKSetUI(JSON.stringify(pushErrorToUI));\n      return true;\n   }\n   return false;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/urlHandler.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * idleTimeoutTimerController.js --\n *\n * timer and logic for idle timeout.\n *\n */\n\n\nimport {globalArray, JSCDKSetUI} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport util from '../util';\nimport {Timer, timerTypeEnum} from './timer';\nimport SetLastUserActivityHandler from '../controllers/setLastUserActivityHandler';\nimport UserActiveTimeSyncCtrl from './userActiveTimeSyncCtrl';\nimport DoLockHandler from '../controllers/doLockHandler';\nimport {\n   requestLastActiveTimeFromPortal,\n   requestLastActiveTimeFromRemoteSession\n} from './timer-util';\n\n\nexport default function IdleTimeoutTimerController() {\n   if (this.brokerVersionInvalid()) {\n      return;\n   }\n   JSCDKLogger.debug(\"IdleTimeoutTimerController created\");\n   this.timeSyncBuff = {ui: null, broker: null, local: null};\n   this.globalName = \"idle-timeout-timer\";\n   this.idleTimeout = -1;\n   this.aboutToIdleTimeout = -1;\n   this.userActivityInterval = -1;\n   this.hintTime = -1;//hint = idleTimeout - aboutToIdleTimeout\n   this.intervalTimer = new Timer(timerTypeEnum.interval);\n   this.aboutToTimeoutTimer = new Timer(timerTypeEnum.timeout);\n   this.timeoutTimer = new Timer(timerTypeEnum.timeout);\n   this.needDisplayDialogs = null;\n   this.notifyLockEventToUI = true;\n   this.requestLastActiveTimeFunction = null;\n}\n\n// only store functions\nIdleTimeoutTimerController.prototype = {};\nIdleTimeoutTimerController.constructor = IdleTimeoutTimerController;\n\n(function() {\n   //private functions:\n   //----------------------------------------------------------------------------------------------\n   function userActivityEvent(params) {\n      let self = params[0];\n\n      if (typeof self.requestLastActiveTimeFunction === \"function\") {\n         self.requestLastActiveTimeFunction();\n      } else {\n         JSCDKLogger.debug(\"requestLastActiveTimeFunction is not a function\");\n      }\n   }\n\n   function aboutToIdleTimeoutEvent() {\n      let requestLastUserActiveTimeAction = {};\n\n      JSCDKLogger.debug(\"aboutToIdleTimeout event reached\");\n      requestLastUserActiveTimeAction.name = \"AboutToTimeout\";\n      JSCDKSetUI(JSON.stringify(requestLastUserActiveTimeAction));\n   }\n\n   function idleTimeoutEvent() {\n      let requestLastUserActiveTimeAction = {};\n\n      JSCDKLogger.debug(\"idleTimeout event reached\");\n      requestLastUserActiveTimeAction.name = \"Timeout\";\n      JSCDKSetUI(JSON.stringify(requestLastUserActiveTimeAction));\n   }\n\n   function initCore(initType) {\n      /*jshint validthis: true*/\n      let idleTimeout;\n\n      switch (initType) {\n         // work on portal page for both webClient and chromeClient\n         case \"Portal\":\n            this.requestLastActiveTimeFunction =\n               requestLastActiveTimeFromPortal;\n            this.needDisplayDialogs = false;\n            break;\n         // work on desktop page for webClient\n         case \"Desktop\":\n            this.requestLastActiveTimeFunction =\n               requestLastActiveTimeFromRemoteSession;\n            this.needDisplayDialogs = false;\n            break;\n         default:\n            JSCDKLogger.debug(\"error: the initType is invalid\");\n            return;\n      }\n\n      // set timers enable property\n      idleTimeout = this.idleTimeout;\n      this.intervalTimer.setEnable();\n      if (idleTimeout <= 0) {\n         this.aboutToTimeoutTimer.setDisable();\n         this.timeoutTimer.setDisable();\n         this.idleTimeout = -1;// -1 means invalid\n         this.aboutToIdleTimeout = -1;// -1 means invalid\n      } else {\n         this.timeoutTimer.setEnable();\n         if (this.hintTime >= idleTimeout) {\n            JSCDKLogger.error(\n               \"invalid time setting params for IdleTimeoutTimerController.init()!!\");\n            this.aboutToTimeoutTimer.setDisable();\n            this.aboutToIdleTimeout = -1;// -1 means invalid\n         } else {\n            this.aboutToTimeoutTimer.setEnable();\n         }\n      }\n\n      //init timer and bounding callback\n      this.intervalTimer.init(userActivityEvent,\n         this.userActivityInterval * 1000, [this]);\n      if (this.needDisplayDialogs) {\n         this.aboutToTimeoutTimer.init(aboutToIdleTimeoutEvent,\n            this.aboutToIdleTimeout * 1000);\n      } else {\n         this.aboutToTimeoutTimer.setDisable();\n      }\n      this.timeoutTimer.init(idleTimeoutEvent, this.idleTimeout * 1000);\n      JSCDKLogger.debug(\"idle timeout controller inited\");\n   }\n\n   function sendSetLastUserActivityXMLtoBrokerWith(inactiveTime) {\n      let setLastUserActivityObject,\n         handlerList,\n         router = globalArray[\"router\"],\n         inactiveTimeVar,\n         inactiveTimeStr;\n\n      setLastUserActivityObject = globalArray[\"set-last-user-activity\"];\n      if (!setLastUserActivityObject) {\n         setLastUserActivityObject = new SetLastUserActivityHandler();\n         globalArray[setLastUserActivityObject.messageName] =\n            setLastUserActivityObject;\n         globalArray[setLastUserActivityObject.responseTag] =\n            setLastUserActivityObject;\n      } else {\n         setLastUserActivityObject.resetData();\n      }\n\n      if (!!setLastUserActivityObject && !!router) {\n         inactiveTimeVar = inactiveTime;//accept both number and string format\n         inactiveTimeStr = inactiveTimeVar.toString();\n         setLastUserActivityObject.setRequestXML(inactiveTimeStr);\n         handlerList = setLastUserActivityObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   }\n\n   function sendDoLockXML() {\n      let doLockObject,\n         handlerList,\n         router = globalArray[\"router\"];\n\n      doLockObject = globalArray[\"do-lock\"];\n      if (!doLockObject) {\n         doLockObject = new DoLockHandler();\n         globalArray[doLockObject.messageName] = doLockObject;\n         globalArray[doLockObject.responseTag] = doLockObject;\n      } else {\n         doLockObject.resetData();\n      }\n\n      if (!!doLockObject && !!router) {\n         doLockObject.setRequestXML();\n         handlerList = doLockObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   }\n\n   //called in the this.compareToAct\n   function setlocalTimeForCompare() {\n      /*jshint validthis: true*/\n      let localTargetTime = this.timeoutTimer.getTargetTime();\n      this.timeSyncBuff.local = localTargetTime - this.idleTimeout * 1000;\n   }\n\n   // public functions:\n   //----------------------------------------------------------------------------------------------\n   // class method to varify the version validation(using\n   // IdleTimeoutTimerController as a namespace)\n   IdleTimeoutTimerController.prototype.init =\n      function(userActivityInterval, idleTimeout, initType) {\n         if (this.brokerVersionInvalid()) {\n            return;\n         }\n         JSCDKLogger.debug(\"init timer controller with userActivityInterval:\" +\n            userActivityInterval + \", idleTimeout:\" + idleTimeout);\n\n         // this value should be changed, in seconds\n         this.hintTime = 30;\n\n         //copy a set of time value\n         this.idleTimeout = idleTimeout;// in s\n         this.userActivityInterval = userActivityInterval;// in s\n         this.aboutToIdleTimeout = this.idleTimeout - this.hintTime;// in s\n\n         initCore.call(this, initType);\n      };\n\n   IdleTimeoutTimerController.prototype.reset = function(initType) {\n      if (this.brokerVersionInvalid()) {\n         return;\n      }\n      JSCDKLogger.debug(\n         \"reset timer controller for chrome: with type: \" + initType);\n\n      initCore.call(this, initType);\n   };\n\n   IdleTimeoutTimerController.prototype.brokerVersionInvalid = function() {\n      if (!util.brokerSupportApplication()) {\n         JSCDKLogger.error(\n            \"timerController related functions should only be involved when is broker version is new enough\");\n         return true;\n      }\n      return false;\n   };\n\n   IdleTimeoutTimerController.prototype.ensureUpdatedOrStarted = function() {\n      this.intervalTimer.ensureUpdatedOrStarted();\n      sendSetLastUserActivityXMLtoBrokerWith(0);\n      this.aboutToTimeoutTimer.ensureUpdatedOrStarted();\n      this.timeoutTimer.ensureUpdatedOrStarted();\n      JSCDKLogger.info(\"----all timer are ensureUpdatedOrStarted\");\n   };\n\n   IdleTimeoutTimerController.prototype.start = function() {\n      this.intervalTimer.start();\n      sendSetLastUserActivityXMLtoBrokerWith(0);\n      this.aboutToTimeoutTimer.start();\n      this.timeoutTimer.start();\n      JSCDKLogger.info(\"----all timer started\");\n   };\n\n   IdleTimeoutTimerController.prototype.stop = function() {\n      //stop controller by discarding all timers\n      this.intervalTimer.discard();\n      this.aboutToTimeoutTimer.discard();\n      this.timeoutTimer.discard();\n      JSCDKLogger.info(\"----all timer discarded\");\n   };\n\n   IdleTimeoutTimerController.prototype.refresh = function(inactiveTime) {\n      this.aboutToTimeoutTimer.updateTimeoutValue(\n         this.aboutToIdleTimeout * 1000 - inactiveTime);\n      this.timeoutTimer.updateTimeoutValue(\n         this.idleTimeout * 1000 - inactiveTime);\n      JSCDKLogger.info(\n         \"----all timer refreshed with passed time:\" + inactiveTime);\n   };\n\n   IdleTimeoutTimerController.prototype.ensureStopped = function() {\n      this.intervalTimer.ensureStopped();\n      this.aboutToTimeoutTimer.ensureStopped();\n      this.timeoutTimer.ensureStopped();\n      JSCDKLogger.debug(\"all timers is ensure to be stopped\");\n   };\n\n   IdleTimeoutTimerController.prototype.getIdleTimeoutValue = function() {\n      JSCDKLogger.debug(\"in getIdleTimeoutValue return:\" + this.idleTimeout);\n      return this.idleTimeout;\n\n   };\n\n   IdleTimeoutTimerController.prototype.getSendIntervalValue = function() {\n      JSCDKLogger.debug(\n         \"in getSendIntervalValue return:\" + this.userActivityInterval);\n      return this.userActivityInterval;\n   };\n\n   IdleTimeoutTimerController.prototype.setlastUserActiveTime =\n      function(lastUserActiveTime, needSendXML, needRefreshTimer) {\n         let inactiveTime,\n            currentTime;\n\n         currentTime = new Date().getTime();\n         inactiveTime = currentTime - lastUserActiveTime;//in ms\n         JSCDKLogger.debug(\n            \"the lastUserActiveTime that passed in setlastUserActiveTime is: \" +\n            inactiveTime + \"ms\");\n         if (needRefreshTimer) {\n            this.refresh(inactiveTime);\n         }\n         if (needSendXML) {\n            sendSetLastUserActivityXMLtoBrokerWith(\n               parseInt(inactiveTime / 1000, 10));\n         }\n      };\n\n   IdleTimeoutTimerController.prototype.setUITimeForCompare =\n      function(UIlastUserActiveTime) {\n         this.timeSyncBuff.ui = UIlastUserActiveTime;\n      };\n\n   //send getAuthStatus with actionTrigger\n   IdleTimeoutTimerController.prototype.requestBrokerTimeForCompareFor =\n      function(actionTrigger) {\n         let userActiveTimeSyncCtrl = globalArray[\"get-broker-sso-time-ctrl\"],\n            callBackType = actionTrigger;\n         if (!userActiveTimeSyncCtrl) {\n            userActiveTimeSyncCtrl = new UserActiveTimeSyncCtrl();\n            globalArray[userActiveTimeSyncCtrl.ctrlName] =\n               userActiveTimeSyncCtrl;\n         }\n         userActiveTimeSyncCtrl.requestBrokerSSOTime(callBackType);\n      };\n\n   //called in the onupdate of getAuthStatusHandler\n   IdleTimeoutTimerController.prototype.setBrokerTimeForCompare =\n      function(timeToBrokerLocked) {\n         let brokerAheadTime = 11,//extra time for broker is like 11s\n            brokerlastUserActiveTime = new Date().getTime() -\n               (this.idleTimeout - (timeToBrokerLocked - brokerAheadTime)) *\n               1000;//now-(timeout-rest)\n         this.timeSyncBuff.broker = brokerlastUserActiveTime;\n      };\n\n   //called in the onupdate of getAuthStatusHandler\n   IdleTimeoutTimerController.prototype.compareToAct = function(actionTrigger) {\n      let newestTime,\n         needSendLastUserActivityXML,\n         timeDelayTolerance = 3000,\n         showAboutToTimeoutDialoagAction = {};\n\n      setlocalTimeForCompare.apply(this);\n      if (this.timeSyncBuff.ui > this.timeSyncBuff.broker) {\n         newestTime = this.timeSyncBuff.ui;\n         needSendLastUserActivityXML = true;\n      } else {\n         newestTime = this.timeSyncBuff.broker;\n         needSendLastUserActivityXML = false;\n      }\n\n      //if already synced, this is a valid trigger, do actions\n      if (Math.abs(newestTime - this.timeSyncBuff.local) < timeDelayTolerance) {\n         if (actionTrigger === \"syncWithTimer4AboutToTimeout\") {\n            //show about to timeout dialog\n            JSCDKLogger.debug(\"showAboutTimeOut dialog\");\n            showAboutToTimeoutDialoagAction.name = \"showAboutToTimeoutDialog\";\n            showAboutToTimeoutDialoagAction.showTime = this.hintTime;\n            JSCDKSetUI(JSON.stringify(showAboutToTimeoutDialoagAction));\n         } else if (actionTrigger === \"syncWithTimer4Timeout\") {\n            //send dolock\n            JSCDKLogger.debug(\"send dolock\");\n            sendDoLockXML();\n         }\n      } else {// else sync the time first\n         this.setlastUserActiveTime(newestTime, needSendLastUserActivityXML,\n            true);\n      }\n      this.timeSyncBuff = {ui: null, broker: null, local: null};\n   };\n\n   IdleTimeoutTimerController.prototype.detectBrokerLocked = function() {\n      let doLockAction;\n\n      JSCDKLogger.debug(\"detect broker is already locked\");\n      if (this.needDisplayDialogs) {\n         doLockAction = {name: \"DoLock\", type: \"detectBrokerLocked\"};\n         JSCDKSetUI(JSON.stringify(doLockAction));\n      } else if (this.notifyLockEventToUI) {\n         JSCDKSetUI(JSON.stringify({name: \"AlreadyLock\"}));\n      }\n\n   };\n}());\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/timer/idleTimeoutTimerController.js","module.exports = __webpack_public_path__ + \"icons-1/desktop-small2x.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./icons/desktop-small2x.png\n// module id = 57\n// module chunks = 0","module.exports = __webpack_public_path__ + \"icons-1/shadow-desktop-small2x.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./icons/shadow-desktop-small2x.png\n// module id = 58\n// module chunks = 0","var path = 'common/aboutdialog/about_dialog.html';\nvar html = \"<scrollable-dialog ng-controller=\\\"AboutDialogCtrl\\\">\\n   <div class=\\\"dialog-title\\\">{{ 'ABOUT_T' | i18n }}</div>\\n   <div class=\\\"dialog-content\\\" fuzzy-free>\\n      <div class=\\\"about-dialog-content selectable\\\">\\n         <div class=\\\"about-dialog-logo\\\"></div>\\n         <span class=\\\"about-dialog-product-name-text\\\">{{ 'COMPANY_NAME_T' | i18n }}<sup></sup> {{ 'PRODUCT_NAME_T' | i18n }}</span>\\n         <br>\\n         <span class=\\\"bold-text\\\">{{ 'VERSION_NUMBER_M' | i18n : \\\"4.6.0\\\" : \\\"1\\\"}}</span>\\n         <br><br>\\n         {{ 'COPYRIGHT_BODY_M' | i18n }}\\n\\n         <a href=\\\"{{ 'PATENT_URL' | i18n }}\\\" id=\\\"patentUrlLink\\\" target=\\\"_blank\\\">{{ 'PATENT_URL' | i18n }}</a>.\\n\\n         <br><br>\\n         {{ 'COPYRIGHT_FOOT_M' | i18n}}\\n      </div>\\n   </div>\\n   <div class=\\\"dialog-button-row\\\">\\n      <button id=\\\"aboutDialogCloseBtn\\\" class=\\\"modal-button-base modal-button-right modal-button-blue\\\" ng-click=\\\"closeThisDialog()\\\" dialog-prevent-key-up>\\n         {{ 'OK' | i18n }}\\n      </button>\\n      <a id=\\\"aboutDialogHelpUrl\\\" class=\\\"modal-button-base modal-button-right modal-button-blue\\\" target=\\\"_blank\\\" ng-href=\\\"{{helpUrl}}\\\">\\n         {{ 'HELP' | i18n }}\\n      </a>\\n   </div>\\n</scrollable-dialog>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./common/aboutdialog/about_dialog.html\n// module id = 59\n// module chunks = 0","var path = 'desktop/common/clip_ft_help_template.html';\nvar html = \"<scrollable-dialog>\\n   <div class=\\\"dialog-title\\\">{{ngDialogData.title | i18n }}</div>\\n   <div class=\\\"dialog-content\\\">\\n      <div class=\\\"clipboard-help-dialog-content selectable\\\">{{ngDialogData.msg | i18n : ngDialogData.modKey : ngDialogData.modKey : ngDialogData.modKey : ngDialogData.modKey}}</div>\\n   </div>\\n   <div class=\\\"dialog-button-row\\\">\\n      <div class=\\\"modal-button-base modal-button-right modal-button-blue\\\" ng-click=\\\"closeThisDialog()\\\">\\n         {{ 'OK' | i18n }}\\n      </div>\\n   </div>\\n</scrollable-dialog>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./desktop/common/clip_ft_help_template.html\n// module id = 60\n// module chunks = 0","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * app-center-controller.js --\n *\n * The center controller for whole angular application.\n *\n */\n\nimport $ from 'jquery';\n\nexport function AppCenterController($scope, $rootScope, constants,\n                                    $window, baseViewService,\n                                    connectionURIModel) {\n   /**\n    * If input URL is https://xxxxx/portal/webclient/index.html#/desktop\n    * that means user wants to enter desktop mode directly.\n    * Otherwise, redirect page to launcher.\n    */\n   if ($window.location.hash.indexOf('#/desktop') === 0) {\n      $rootScope.CLIENT_MODE = constants.CLIENT_MODE.DESKTOP;\n   } else {\n      $rootScope.CLIENT_MODE = constants.CLIENT_MODE.LAUNCHER;\n   }\n\n   /**\n    * Show preference button as default.\n    * The value can be set to false if in anonymous mode\n    * Use $rootScope here because we have to access it in multiple controllers\n    */\n   $rootScope.showPreference = true;\n\n   // Listen to any location change event for whole application\n   $rootScope.$on('$locationChangeStart', function(event, next, current) {\n      if (baseViewService.isBackInLauncher(next, current) &&\n         !baseViewService.locationChange) {\n         event.preventDefault();\n      } else if (baseViewService.isBackFromDesktop(next, current)) {\n         event.preventDefault();\n         /**\n          * NOTE: using connectionURIModel.isHWSession here is based on that\n          * we don't remove params in URI\n          */\n         if (!connectionURIModel.isHWSession()) {\n            /**\n             *  NOTE: Do not try to maintain the dependencies between\n             *  launcher and desktop module now. We just need to go back to\n             *  launcher with a refresh action.\n             */\n            baseViewService.goBackToLauncherFromDesktop();\n         }\n      }\n\n      baseViewService.locationChange = false;\n\n      // it will just run routeChangeStart not Success.\n      if (baseViewService.isRefreshingLauncher(next, current)) {\n         $scope.transitionState = \"showPage\";\n      }\n\n   });\n\n   $rootScope.$on(\"$routeChangeSuccess\", function(scope, next, current) {\n      $scope.transitionState = \"showPage\";\n   });\n\n   $rootScope.$on(\"$routeChangeStart\", function(scope, next, current) {\n      $scope.transitionState = \"hidePage\";\n   });\n\n   /**\n    * We're going to detect log off event!\n    * constants.CLIENT_LOGIN_KEY is deleted in 'view-service.js',\n    * 'entitleditems-service.js' and 'main-service.js'\n    */\n   $(window).bind('storage', function(e) {\n      if (e.originalEvent.key !== constants.CLIENT_LOGIN_KEY) {\n         return;\n      }\n      if (!!e.originalEvent.oldValue &&\n         (e.originalEvent.newValue === null ||\n         e.originalEvent.newValue === '')) {\n         // Once user logs off broker, return any other tabs to portal page\n         let launchPageURL;\n         if (!window.location.origin) {\n            launchPageURL = window.location.protocol + \"//\" +\n               window.location.hostname +\n               (window.location.port ? ':' + window.location.port : '');\n         } else {\n            launchPageURL = window.location.origin;\n         }\n\n         window.location.href = launchPageURL;\n      }\n   });\n}\n\nexport function config($window) {\n   // Prevent browser read page from cache\n   $window.onpageshow = function(event) {\n      if (event.persisted) {\n         $window.location.reload();\n      }\n   };\n\n   /**\n    *  Refreshing any page (except desktop page) triggers launching the\n    *  home page.\n    */\n   if (!!$window.location.hash && $window.location.hash !== '#/' &&\n      $window.location.hash !== '#/desktop') {\n      $window.location.hash = '#/';\n   }\n\n}\n\n\n// WEBPACK FOOTER //\n// ./app-center-controller.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport $ from 'jquery';\nimport WMKS from 'WMKS';\nimport angular from 'angular';\nimport commonModule from '../common/module';\nimport multimonModule from './multimon/main-page/module';\nimport ngRoute from 'angular-route';\nimport ngDialog from 'ng-dialog';\n\nimport routeConfig from './route';\n\nimport MKSVchan from './channels/mksvchan';\nimport VDPService from './channels/vdpservice';\nimport Unity from './remoteapp/unity';\nimport AB from './common/appblast-util';\nimport RTAVService from './rtav/rtav-service';\nimport verticalSliderDirective from './sidebar/vertical-slider';\nimport {\n   runningItemsFilter,\n   availableItemsFilter,\n   SidebarController,\n   sidebarDirective\n} from './sidebar/sidebar';\nimport contextMenuManager from './sidebar/context-menu-manager';\nimport settingsWindowController from './setting-dialog/settings-window-controller';\nimport unityService from './remoteapp/unity-service';\nimport reAuthCtrl from './re-auth/reauth-controller';\nimport reAuthChangePasswordCtrl from './re-auth/changepassword-controller';\nimport multimonSettingWindowController from './multimon/multimon-setting-window/multimon-setting-window-controller';\nimport FTUploadService from './filetransfer/file-transfer-upload-service';\nimport fileTransferService from './filetransfer/file-transfer-service';\nimport {\n   fileTransferController,\n   fileTransferPanel,\n   fileTransferInput,\n   fileDrop,\n   fileChange\n} from './filetransfer/file-transfer-panel';\nimport TransferHelper from './filetransfer/file-transfer-helper';\nimport FTDownloadService from './filetransfer/file-transfer-download-service';\nimport wmksServiceEventHandler from './common/wmks-service-event-handler';\nimport wmksService from './common/wmks-service';\nimport runningItemsModel from './common/runningitems-model';\nimport {PrintController, printFrame} from './common/print-service';\nimport panelService from './common/panel-service';\nimport messageHandlerService from './common/messagehandler-service';\nimport jscdkDesktopInvoker from './common/jscdk-desktop-invoker';\nimport idleSessionService from './common/idle-session-service';\nimport entitledItemsService from './common/entitleditems-service';\nimport entitledItemsModel from './common/entitleditems-model';\nimport DesktopCtrl from './common/desktop-controller';\nimport blastWmks from './common/blast-wmks-service';\nimport audioService from './common/audio-service';\nimport applicationSessionsModel from './common/applicationsessions-model';\nimport {\n   ajaxBusyOverlayController,\n   ajaxBusyOverlay\n} from './common/ajax-busy-overlay';\nimport {\n   clipboardController,\n   clipboardInput,\n   panelNotification,\n   clipboard\n} from './clipboard/clipboard';\nimport mainChannelService from './channels/rde-main-channel';\nimport tsdrChannelService from './channels/tsdr-channel';\nimport commonSvcService from './channels/commonSvc-service';\n\nexport default angular.module(\"com.vmware.vdi.htmlaccess.desktop\",\n   [ngDialog, ngRoute, commonModule, multimonModule])\n   .constant('WMKS', WMKS)\n   .constant('Unity', Unity)\n   .constant('VDPService', VDPService)\n   .constant('MKSVchan', MKSVchan)\n   .constant('RTAVService', RTAVService)\n   .constant('AB', AB)\n   .constant('jQuery', $)\n   .config(['$routeProvider', routeConfig])\n\n   .factory(\"contextMenuManager\", ['$window', contextMenuManager])\n   .factory(\"unityService\", ['$window', 'wmksService', 'Unity',\n      'wmksServiceEventHandler', unityService])\n   .factory('FTUploadService',\n      ['AB', 'wmksService', '$timeout', 'translate', 'fileTransferService',\n         FTUploadService\n      ])\n   .factory('fileTransferService',\n      ['AB', 'ngDialog', 'wmksService', '$timeout', 'translate',\n         fileTransferService\n      ])\n   .factory('TransferHelper',\n      ['wmksService', 'FTDownloadService', 'FTUploadService',\n         'wmksServiceEventHandler', TransferHelper])\n   .factory('FTDownloadService',\n      ['AB', 'wmksService', '$timeout', 'fileTransferService', 'translate',\n         FTDownloadService\n      ])\n   .factory('wmksService', [\n      'blastWmks',\n      'safeStorageService',\n      'entitledItemsModel',\n      'entitledItemsService',\n      'messageHandlerService',\n      'MKSVchan',\n      'WMKS',\n      'AB',\n      'jQuery',\n      '$timeout',\n      '$window',\n      '$rootScope',\n      'wmksServiceEventHandler',\n      'multimonService',\n      'commonSvcService',\n      'userGlobalPref',\n      wmksService\n   ])\n   .factory('panelService', ['$window', 'AB',\n      panelService\n   ])\n   .factory(\"blastWmks\", [\n      '$window',\n      'ngDialog',\n      'audioService',\n      'safeStorageService',\n      'VDPService',\n      'MKSVchan',\n      'RTAVService',\n      'multimonRenderingService',\n      '$timeout',\n      'WMKS',\n      'AB',\n      'jQuery',\n      'translate',\n      '$rootScope',\n      '$q',\n      'mainChannelService',\n      'tsdrChannelService',\n      blastWmks\n   ])\n   .factory(\"audioService\", ['AB', '$window', 'WMKS', audioService])\n   .factory(\"mainChannelService\", mainChannelService)\n   .factory(\"tsdrChannelService\", tsdrChannelService)\n   .factory(\"commonSvcService\", ['AB', 'wmksServiceEventHandler',\n      'dpiService', 'userGlobalPref', 'constants', commonSvcService])\n\n   .filter(\"runningItemsFilter\", runningItemsFilter)\n   // Filter for available items given a search query string and whether only\n   // favorites should be shown.\n   .filter(\"availableItemsFilter\", availableItemsFilter)\n   .controller(\"SidebarController\", [\n      '$scope',\n      '$window',\n      '$rootScope',\n      '$timeout',\n      'unityService',\n      'runningItemsModel',\n      'contextMenuManager',\n      'wmksService',\n      'entitledItemsModel',\n      'entitledItemsService',\n      'userGlobalPref',\n      'ngDialog',\n      'messageHandlerService',\n      'RTAVService',\n      'translate',\n      'WMKS',\n      'idleSessionService',\n      'wmksServiceEventHandler',\n      'commonSvcService',\n      'normalizationService',\n      SidebarController\n   ])\n   .controller('settingsWindowController',\n      ['$scope',\n         '$rootScope',\n         '$timeout',\n         'wmksService',\n         'userGlobalPref',\n         'entitledItemsService',\n         'ngDialog',\n         'WMKS',\n         'translate',\n         settingsWindowController])\n   .controller('reAuthCtrl',\n      ['$scope', '$rootScope', '$timeout', 'connectionServerModel',\n         'jscdkDesktopInvoker',\n         'viewClientModel',\n         'usernameUtil', 'entitledItemsService', 'ngDialog', reAuthCtrl])\n   .controller('reAuthChangePasswordCtrl',\n      ['$scope', '$rootScope', '$timeout', 'connectionServerModel',\n         'jscdkDesktopInvoker', reAuthChangePasswordCtrl])\n   .controller('multimonSettingWindowController', ['$scope',\n      '$rootScope',\n      '$timeout',\n      'wmksService',\n      'userGlobalPref',\n      'ngDialog',\n      'translate',\n      multimonSettingWindowController\n   ])\n   .controller('fileTransferController', ['$window', '$scope',\n      '$rootScope',\n      '$timeout',\n      'ngDialog',\n      'wmksService',\n      'WMKS',\n      'TransferHelper',\n      'translate',\n      'toastService',\n      'wmksServiceEventHandler',\n      'panelService',\n      fileTransferController\n   ])\n   .controller('PrintController', ['AB', '$scope',\n      '$timeout',\n      'WMKS',\n      'wmksService',\n      'translate',\n      'TransferHelper',\n      'toastService',\n      'wmksServiceEventHandler',\n      PrintController\n   ])\n   .controller('DesktopCtrl',\n      ['$window', 'AB', '$scope', '$location', 'wmksService',\n         'entitledItemsService', DesktopCtrl])\n   .controller('ajaxBusyOverlayController', ['$scope', '$rootScope', '$timeout',\n      ajaxBusyOverlayController])\n   .controller('clipboardController',\n      ['AB', '$scope',\n         '$rootScope',\n         '$timeout',\n         'ngDialog',\n         'wmksService',\n         'translate',\n         'wmksServiceEventHandler',\n         'panelService',\n         clipboardController])\n\n\n   .directive('printFrame', ['$timeout', 'AB', 'WMKS',\n      '$window', 'wmksService', 'toastService',\n      printFrame])\n   .directive('sidebar', sidebarDirective)\n   .directive('fileTransferPanel',\n      ['$window', 'panelService', '$timeout',\n         fileTransferPanel\n      ])\n   .directive('fileTransferInput', fileTransferInput)\n   .directive('fileDrop', fileDrop)\n   .directive('fileChange', fileChange)\n   .directive('verticalSlider',\n      ['$window', 'AB', verticalSliderDirective])\n   .directive('ajaxBusyOverlay', ajaxBusyOverlay)\n   .directive('clipboardInput', clipboardInput)\n   .directive('panelNotification', ['translate', panelNotification])\n   .directive('clipboard',\n      ['$window', 'panelService', '$timeout', clipboard])\n\n   .service('wmksServiceEventHandler',\n      ['$q', 'WMKS', 'AB', wmksServiceEventHandler])\n   .service(\"runningItemsModel\", ['AB', 'wmksService', 'unityService',\n      '$rootScope', '$timeout', 'translate', 'wmksServiceEventHandler',\n      runningItemsModel])\n   .service(\"messageHandlerService\", ['AB', '$window',\n      messageHandlerService\n   ])\n   .service('jscdkDesktopInvoker',\n      ['$rootScope', '$location', '$timeout', '$window', 'viewClientModel',\n         'userGlobalPref', 'dpiService', 'connectionServerModel', 'constants',\n         'timezone',\n         jscdkDesktopInvoker])\n   .service('idleSessionService', idleSessionService)\n   .service(\"entitledItemsService\", ['AB', 'safeStorageService',\n      'entitledItemsModel',\n      'applicationSessionsModel',\n      'blastSessionsModel',\n      'userGlobalPref',\n      '$rootScope',\n      '$q',\n      'multiSiteService',\n      'timezone',\n      'translate',\n      'constants',\n      'idleSessionService',\n      'dpiService',\n      'jscdkDesktopInvoker',\n      'ngDialog',\n      'viewClientModel',\n      'baseViewService',\n      entitledItemsService])\n   .service(\"entitledItemsModel\", [\"safeStorageService\", \"RTAVService\",\n      entitledItemsModel])\n   .service(\"applicationSessionsModel\", [\"jscdkDesktopInvoker\",\n      \"viewClientModel\", \"constants\",\n      applicationSessionsModel\n   ])\n\n   .name;\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/module.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport angular from 'angular';\nimport commonModule from '../common/module';\nimport ngRoute from 'angular-route';\nimport ngDialog from 'ng-dialog';\n\nimport routeConfig from './route';\n\nimport LauncherSettingsWindowController from './setting-dialog/setting-dialog-controller';\nimport LaunchItemsCtrlService from './launchitems/itemsctrl-service';\nimport LaunchItemsCtrl from './launchitems/items-controller';\nimport viewCtrlService from './common/viewctrl-service';\nimport viewService from './common/view-service';\nimport {\n   equalToDirective,\n   serverNameDirective\n} from './common/validate-directive';\nimport utilService from './common/util-service';\nimport timeoutService from './common/timeout-service';\nimport tabSyncService from './common/tabsync-service';\nimport mainService from './common/main-service';\nimport jscdkLauncherInvoker from './common/jscdk-launcher-invoker';\nimport HomeWarningCtrl from './common/homewarning-controller';\nimport {HeaderCtrl, headerDirective} from './common/header-controller';\nimport {\n   scrollTopDirective,\n   viewAutofocusDirective,\n   unstorablePasswordDirective,\n   fallbackSrcDirective,\n   progressCircleDirective,\n   helpLinkDirective,\n   downloadLinkdirective,\n   highlightDirective\n} from './common/common-directive';\nimport BlastDesktopCtrl from './common/blastdesktop-controller';\nimport WindowsPasswordCtrl from './login/windowspassword-controller';\nimport UnauthenticatedCtrl from './login/unauthenticated-controller';\nimport SecuridWaitCtrl from './login/securidwait-controller';\nimport SecuridPinChangeCtrl from './login/securidpinchange-controller';\nimport SecuridPasscodeCtrl from './login/securidpasscode-controller';\nimport SecuridNextTokenCodeCtrl from './login/securidnexttokencode-controller';\nimport {LoginCtrl, WaitingCtrl} from './login/login-controller';\nimport domainSelectMenuDirective from './login/domain-select-menu-directive';\nimport DisclaimerCtrl from './login/disclaimer-controller';\nimport ChangePasswordCtrl from './login/changepassword-controller';\nimport anonymousSelectDirective from './login/anonymous-select-directive';\n\n\nexport default angular.module('com.vmware.vdi.htmlaccess.launcher',\n   [ngRoute, ngDialog, commonModule])\n   .config(['$routeProvider', routeConfig])\n   .controller('LauncherSettingsWindowController',\n      ['$scope', '$rootScope', 'utilService', 'userGlobalPref', 'translate',\n         'dialogService', 'mainService', 'viewClientModel', 'prefData',\n         'timezone', '$timeout', 'jscdkLauncherInvoker',\n         LauncherSettingsWindowController])\n   .controller('LaunchItemsCtrl',\n      ['$scope', '$rootScope', '$timeout', 'connectionServerModel',\n         'viewClientModel', 'mainService', 'storageService',\n         'LaunchItemsCtrlService', 'utilService', 'safeStorageService',\n         'userGlobalPref', 'translate', 'connectionURIModel', 'dialogService',\n         'credCleanService', 'timezone', 'jscdkLauncherInvoker',\n         'brokerSessionStorageService', 'constants', LaunchItemsCtrl])\n   .controller('HomeWarningCtrl',\n      ['$scope', 'utilService', 'mainService', 'viewClientModel',\n         'storageService', HomeWarningCtrl])\n   .controller('HeaderCtrl',\n      ['$rootScope', '$scope', 'connectionServerModel', 'utilService',\n         'dialogService', HeaderCtrl])\n   .controller('BlastDesktopCtrl',\n      ['$window', '$scope', '$rootScope', 'mainService',\n         'connectionServerModel',\n         'blastSessionsModel', 'viewClientModel',\n         'connectionURIModel', 'multiSiteService', 'viewService', 'constants',\n         'userGlobalPref', 'baseViewService', 'jscdkLauncherInvoker',\n         BlastDesktopCtrl])\n   .controller('WindowsPasswordCtrl',\n      ['$scope', 'connectionServerModel', 'mainService',\n         'utilService', 'translate', 'dialogService', 'viewClientModel',\n         'connectionURIModel', 'viewService', 'usernameUtil',\n         'jscdkLauncherInvoker',\n         WindowsPasswordCtrl])\n   .controller('UnauthenticatedCtrl',\n      ['$scope', 'connectionServerModel', 'translate', 'viewService',\n         'mainService', 'jscdkLauncherInvoker',\n         'connectionURIModel', 'utilService', 'dialogService',\n         UnauthenticatedCtrl])\n   .controller('SecuridWaitCtrl',\n      ['$scope', '$rootScope', '$timeout', 'connectionServerModel',\n         'mainService', 'utilService', 'jscdkLauncherInvoker',\n         SecuridWaitCtrl])\n   .controller('SecuridPinChangeCtrl',\n      ['$scope', '$rootScope', '$timeout', 'connectionServerModel',\n         'mainService', 'utilService', 'jscdkLauncherInvoker', 'translate',\n         SecuridPinChangeCtrl])\n   .controller('SecuridPasscodeCtrl',\n      ['$scope', '$rootScope', '$timeout', 'connectionServerModel',\n         'mainService', 'utilService', 'jscdkLauncherInvoker', 'translate',\n         SecuridPasscodeCtrl])\n   .controller('SecuridNextTokenCodeCtrl',\n      ['$scope', '$rootScope', '$timeout', 'connectionServerModel',\n         'mainService', 'utilService', 'jscdkLauncherInvoker', 'translate',\n         SecuridNextTokenCodeCtrl])\n   .controller('LoginCtrl', ['$scope', '$rootScope', 'mainService',\n      'utilService', 'storageService', 'jscdkLauncherInvoker', LoginCtrl])\n   .controller(\"WaitingCtrl\", ['$scope', '$rootScope', WaitingCtrl])\n   .controller('DisclaimerCtrl',\n      ['$scope', '$rootScope', '$timeout', 'mainService', 'utilService',\n         'jscdkLauncherInvoker', DisclaimerCtrl])\n   .controller('ChangePasswordCtrl',\n      ['$scope', '$timeout', 'mainService', 'utilService',\n         'connectionServerModel', 'jscdkLauncherInvoker',\n         ChangePasswordCtrl])\n   .factory('LaunchItemsCtrlService',\n      ['connectionServerModel',\n         'mainService', 'utilService', 'dialogService', 'safeStorageService',\n         'translate', 'connectionURIModel',\n         'viewService', 'jscdkLauncherInvoker', LaunchItemsCtrlService])\n   .service('viewCtrlService', ['$rootScope', '$timeout', viewCtrlService])\n   .service('viewService', ['$location', '$timeout', 'utilService',\n      'connectionURIModel', 'tabSyncService', 'baseViewService',\n      'URIParamValidator', 'dialogService', 'jscdkLauncherInvoker', 'translate',\n      'constants', 'ws1Service', viewService])\n   .service('utilService', ['connectionURIModel', 'translate',\n      'dialogService', 'localize', 'brokerSessionStorageService',\n      'viewClientModel', 'jscdkLauncherInvoker', '$window',\n      utilService])\n   .service('timeoutService', ['$window', 'connectionServerModel',\n      'storageService', 'jscdkLauncherInvoker', timeoutService])\n   .service(\"tabSyncService\", ['$window', 'utilService', tabSyncService])\n   .service('mainService', ['$rootScope', 'utilService', '$route',\n      'dialogService', 'viewClientModel', 'connectionURIModel',\n      'translate', 'viewService', 'timeoutService',\n      'userGlobalPref', 'brokerSessionStorageService', 'viewCtrlService',\n      'jscdkLauncherInvoker', 'constants', '$window', 'ws1Service',\n      mainService])\n   .service('jscdkLauncherInvoker', ['$window', 'viewClientModel',\n      'connectionURIModel', 'userGlobalPref', 'dpiService',\n      'storageService', 'connectionServerModel', 'constants',\n      jscdkLauncherInvoker])\n   .directive('equalTo', equalToDirective)\n   .directive('serverName', serverNameDirective)\n   .directive('scrollTop', scrollTopDirective)\n   .directive('viewAutofocus', ['$timeout', viewAutofocusDirective])\n   .directive('unstorablePassword', ['$timeout', unstorablePasswordDirective])\n   .directive('fallbackSrc', fallbackSrcDirective)\n   .directive('progressCircle', progressCircleDirective)\n   .directive('helpLink', ['viewClientModel', 'utilService', 'translate',\n      '$timeout', '$rootScope', 'localize', helpLinkDirective])\n   .directive('downloadLink', ['translate',\n      '$timeout', '$rootScope', 'viewClientModel', 'localize',\n      downloadLinkdirective])\n   .directive('highlight', highlightDirective)\n   .directive('domainSelectMenu', ['$timeout', 'viewClientModel',\n      domainSelectMenuDirective])\n   .directive('anonymousSelect', ['$timeout', anonymousSelectDirective])\n   .directive('launcherHeader', headerDirective)\n   .name;\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/module.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// /Users/yuez/gitvmware/htmlaccess1/ui/bower_components/webmks/build/static/wmks/css/wmks-all.css\n// module id = 71\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// /Users/yuez/gitvmware/htmlaccess1/ui/~/jquery-ui-dist/jquery-ui.css\n// module id = 72\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// /Users/yuez/gitvmware/htmlaccess1/ui/~/toastr/build/toastr.css\n// module id = 73\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./styles/appblast.css\n// module id = 74\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./styles/clipboard.css\n// module id = 75\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./styles/sidebar.css\n// module id = 77\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./styles/style.css\n// module id = 78\n// module chunks = 0","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * app-htmlaccess.js\n * Entry for the whole html access app.\n * NOTE: this is not the entry for pdfjs and extended monitor page\n */\n\nimport angular from 'angular';\nimport 'jquery-ui';\n\n// All css import here. DO NOT change their order.\nimport 'jqueryuiCss';\nimport 'webmksCss';\nimport 'toastrCss';\nimport 'ngdialogCss';\n\nimport './styles/style.css';\nimport './styles/appblast.css';\nimport './styles/clipboard.css';\nimport './styles/sidebar.css';\nimport './styles/modal-dialogs.css';\n\n\nimport templateModule from './template-module';\nimport commonModule from './common/module';\nimport launcherModule from './launcher/module';\nimport desktopModule from './desktop/module';\nimport {AppCenterController, config} from './app-center-controller';\n\n\n\n// Define all controllers here for this module\nexport default angular.module('com.vmware.vdi.htmlaccess',\n   [templateModule, commonModule, launcherModule, desktopModule])\n   .run(['$window', config])\n   .controller('AppCenterController',\n      ['$scope', '$rootScope', 'constants', '$window', 'baseViewService',\n         'connectionURIModel', AppCenterController])\n   .name;\n\n\n\n\n// WEBPACK FOOTER //\n// ./app-htmlaccess.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function AboutDialogCtrl($scope, viewClientModel, localize) {\n   /**\n    * When continute the page merge, this part need to be merged with the one\n    * for the launcher also.\n    */\n   let getHelpLink = function(){\n      let locale = localize.getLocale(),\n         map = viewClientModel.linkModel['helpPages'];\n\n      if (map.hasOwnProperty(locale)) {\n         return map[locale];\n      }\n\n      return map.en;\n   };\n   $scope.helpUrl = viewClientModel.rebrandHelpUrl || getHelpLink();\n}\n\n\n// WEBPACK FOOTER //\n// ./common/aboutdialog/about-dialog-controller.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * dialog-service.js\n *\n * The unified dialog-service for desktop/launcher module.\n * It is a simple wrapper for ngDialog. And ngDialog is pre-configured in\n * 'common/module.js'\n */\n\nimport angular from 'angular';\nimport $ from 'jquery';\nimport errorDialogTemplate from './dialog_service_error.html';\nimport confirmDialogTemplate from './dialog_service_confirm.html';\nimport cancelDialogTemplate from './dialog_service_cancel_confirm.html';\n\n\nexport function ngDialogProvider(ngDialogProvider) {\n   ngDialogProvider.setDefaults({\n      name: \"DefaultDialog\",\n      className: \"session-ops-dialog\",\n      showClose: false,\n      closeByEscape: true,\n      closeByDocument: true\n   });\n}\n\nexport function dialogService(ngDialog) {\n   this._DEFAULT_ERROR_OPTIONS = {\n      name: \"DefaultErrorDialog\",\n      templateUrl: errorDialogTemplate\n   };\n   this._DEFAULT_CONFIRM_OPTOINS = {\n      name: \"DefaultConfirmDialog\",\n      templateUrl: confirmDialogTemplate\n   };\n\n   this.confirm = options => {\n      if (!options) {\n         options = {};\n      }\n      let defaultOptions = this._DEFAULT_CONFIRM_OPTOINS;\n      angular.extend(defaultOptions, options);\n      return ngDialog.open(defaultOptions);\n   };\n\n   this.confirmWithCancelAsDefault = function(options) {\n      if (!options) {\n         options = {};\n      }\n      let defaultOptions = {\n         name: \"ConfirmWithCancelAsDefault\",\n         templateUrl: cancelDialogTemplate\n      };\n      angular.extend(defaultOptions, options);\n      return ngDialog.open(defaultOptions);\n   };\n\n   this.error = options => {\n      if (!options) {\n         options = {};\n      }\n      let defaultOptions = this._DEFAULT_ERROR_OPTIONS;\n      angular.extend(defaultOptions, options);\n      return ngDialog.open(defaultOptions);\n   };\n\n   this.predefined = function(options, isConfirmDialog) {\n      if (isConfirmDialog) {\n         return ngDialog.openConfirm(options);\n      }\n      return ngDialog.open(options);\n   };\n\n   this.isDialogOpen = function(dialogID) {\n      return ngDialog.isOpen(dialogID);\n   };\n\n   this.hasDialogOpen = function() {\n      let dialog = $('.ngdialog');\n      return !(dialog === null || dialog.length === 0);\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/commondialog/dialog-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nconst constants = {\n   viewclientType: 'htmlaccess',\n   CLIENT_MODE: {\n      LAUNCHER: 'launcher',\n      DESKTOP: 'desktop'\n   },\n   DPI_100_PERCENT: 96,\n   ANONYMOUS_MODE_KEY: 'ANONYMOUS_MODE',\n   SP_ID_FOR_WS1_KEY: 'SP_ID_FOR_WS1',\n   CLIENT_LOGIN_KEY: 'HTML_ACCESS_LOGIN'\n};\n\nexport default constants;\n\n\n\n// WEBPACK FOOTER //\n// ./common/constant/app-constant.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * dialog-accessibility.js\n *\n */\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\nexport function dialogTabindex() {\n   /**\n    * this derective is serve to fix a bug when using native tabindex, so\n    * have the similar interface.\n    */\n   return {\n      require: '^dialogTabScope',\n      scope: {},\n      restrict: 'A',\n      link: function(scope, element, attrs, scopeCtrl) {\n         if (!scopeCtrl.inited) {\n            scopeCtrl.init();\n         }\n         //add this element under control\n         scopeCtrl.addChoosableElement(element, attrs.dialogTabindex);\n      }\n   };\n}\n\nexport function dialogPreventKeyUp($rootScope) {\n   /**\n    * When dialog is closed, the focus could go back to header\n    * element. And at this time it is possible that user is still\n    * holding the key and then the the key up event is received.\n    * That's not what we want.\n    */\n   return {\n      restrict: 'A',\n      link: function(scope, element) {\n         element.keydown(function(event) {\n            if (event.keyCode === 13) {\n               $rootScope.isDialogServiceKeyPress = true;\n            }\n         });\n      }\n   };\n}\n\nexport function dialogTabScope($timeout) {\n   /**\n    * this derective will create a isolated scope and controll the reaction\n    * for\n    * \"tab\" key pressing for all registered element in it.\n    */\n   return {\n      restrict: 'A',\n      scope: {},\n      controller: ['$rootScope', '$scope', '$element',\n         function($rootScope, $scope, $element) {\n            this.inited = false;\n            this.reseted = true;\n            this.choosableArray = [];\n            this.currentTabIndex = -1;\n\n            this.reset = function() {\n               this.reseted = true;\n               this.currentTabIndex = -1;\n            };\n\n            this.isInnerElement = function(parent, child) {\n               return parent.contains ?\n                  parent !== child && parent.contains(child) :\n                  !!(parent.compareDocumentPosition(child) & 16);\n            };\n\n            /**\n             * return a auto assigned index as the default index\n             */\n            this.getDefaultIndex = function() {\n               let i,\n                  startIndex = 0,\n                  indexSlot = startIndex;\n\n               for (i = 0; i < this.choosableArray.length; i++) {\n                  if (this.choosableArray[i].index >= startIndex) {\n                     if (indexSlot === this.choosableArray[i].index) {\n                        indexSlot++;\n                     } else {\n                        break;\n                     }\n                  }\n               }\n               return indexSlot;\n            };\n\n            /**\n             * add a choosable element under control\n             */\n            this.addChoosableElement = function(element, index) {\n               let i,\n                  indexNumber,\n                  item;\n\n               if (!index) {\n                  indexNumber = this.getDefaultIndex(index);\n               } else {\n                  indexNumber = Number(index);\n               }\n\n               item = {\n                  index: indexNumber,\n                  element: element\n               };\n\n               if (this.choosableArray.length === 0) {\n                  this.choosableArray.push(item);\n                  return;\n               }\n\n               if (this.findIndex(index) >= 0) {\n                  JSCDKLogger.debug(\n                     'repeat index is not allowed');\n                  return;\n               }\n\n               for (i = 0; i < this.choosableArray.length; i++) {\n                  if (this.choosableArray[i].index > index) {\n                     //insert at index with item\n                     this.choosableArray.splice(i, 0, item);\n                     return;\n                  }\n               }\n\n               this.choosableArray.push(item);\n            };\n\n            this.findIndex = function(targetTabIndex) {\n               let i;\n               if (targetTabIndex === -1) {\n                  return -1;\n               }\n               for (i = 0; i < this.choosableArray.length; i++) {\n                  if (this.choosableArray[i].index ===\n                     targetTabIndex) {\n                     return i;\n                  }\n               }\n               return -1;\n            };\n\n            this.getNextElementIndex = function() {\n               return (this.findIndex(this.currentTabIndex) + 1) %\n                  this.choosableArray.length;\n            };\n\n            this.onTabDown = () => {\n               $timeout(() => {\n                  let nextElementIndex;\n\n                  if (this.choosableArray.length === 0) {\n                     JSCDKLogger.debug(\n                        'the dialog-tabindex list is empty');\n                     return;\n                  }\n                  nextElementIndex = this.getNextElementIndex();\n                  this.choosableArray[nextElementIndex].element[0].focus();\n                  this.currentTabIndex = this.choosableArray[\n                     nextElementIndex].index;\n               });\n            };\n\n            this.onKeyDown = function(event) {\n               if (event.keyCode === 9) {\n                  JSCDKLogger.trace('tab key pressed');\n                  event.preventDefault();\n                  this.onTabDown();\n               }\n            };\n\n            this.focusOnDefault = function() {\n               let defaultElement = this.choosableArray[0];\n               if (!defaultElement) {\n                  JSCDKLogger.debug(\n                     'the default element to be focused don\\'t exist'\n                  );\n                  return;\n               }\n               defaultElement.element[0].focus();\n               this.currentTabIndex = defaultElement.index;\n            };\n\n            this.init = function() {\n               let onFocus,\n                  onFocusOut,\n                  workingDialog,\n                  children = $element.children(),\n                  keyDownFunc = this.onKeyDown.bind(this);\n\n               // valid check\n               if (!children || !children[0]) {\n                  return;\n               }\n               workingDialog = children[0];\n\n               //callbacks definition, binding \"this\" is for referring the\n               // this.choosableArray and this.currentTabIndex\n               onFocus = function(event) {\n                  if (this.reseted) {\n                     // set focus on the default button\n                     this.focusOnDefault();\n                     JSCDKLogger.debug(\n                        'dialog focus reseted to default');\n                     this.reseted = false;\n                  }\n               }.bind(this);\n\n               onFocusOut = function(event) {\n                  if (this.isInnerElement($element[0], event.target) &&\n                     !this.isInnerElement($element[0], event.relatedTarget)\n                  ) { //dialog loss focus\n                     this.reset();\n                  }\n               }.bind(this);\n\n               //callbacks bind\n               $element.on('keydown', keyDownFunc);\n               $(workingDialog).focus(onFocus);\n               $(workingDialog).focusout(onFocusOut);\n\n               //callbacks unbind when destructed\n               $element.on('$destroy', () => {\n                  $element.off('keydown', keyDownFunc);\n                  $(workingDialog).off('focus', onFocus);\n                  $(workingDialog).off('focusout',\n                     onFocusOut);\n                  this.inited = false;\n                  this.choosableArray = [];\n                  this.currentTabIndex = -1;\n               });\n\n               this.inited = true;\n            };\n         }]\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/directive/dialog-accessibility.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function fuzzyFree($rootScope, $timeout) {\n   /**\n    * This directive is for bug 1512510\n    * Some font is fuzzy in Chrome because of Chrome's bug\n    * It happens in odd pixel height.\n    */\n   return {\n      restrict: 'A',\n      link: function(scope, element) {\n         scope.$watch(function() {\n            return element[0].offsetHeight;\n         }, function(newHeight, oldHeight) {\n            if (newHeight === oldHeight) {\n               return;\n            }\n\n            $timeout(function() {\n               if (newHeight % 2 === 0) {\n                  newHeight++;\n                  element.css('height', newHeight + 'px');\n               }\n            });\n\n         });\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/directive/scrollable-dialog-fuzzy-free.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport angular from 'angular';\n\n\nexport default function scrollableDialog($window) {\n   return {\n      restrict: 'E',\n      replace: false,\n      link: function(scope, element) {\n         let defaultHeight;\n\n         scope.clamp = function(value, minValue, maxValue) {\n            return Math.min(maxValue, Math.max(value, minValue));\n         };\n\n         scope.windowResizeHandler = function() {\n            let newHeight;\n            if (!defaultHeight) {\n               defaultHeight = element.find('.dialog-content').outerHeight();\n            }\n            newHeight = scope.clamp(defaultHeight, 0,\n               $window.innerHeight\n               - element.find('.dialog-title').outerHeight()\n               - element.find('.dialog-button-row').outerHeight());\n            element.find('.dialog-content').css('height', newHeight);\n         };\n\n         angular.element($window).bind('resize', scope.windowResizeHandler);\n\n         /*\n          * a new directive is instantiated with every dialog open, so we fire a\n          * resize event on a small delay so that we adjust the size as soon as\n          * the dialog becomes visible.\n          */\n         setTimeout(scope.windowResizeHandler, 100);\n\n         scope.$on('$destroy', function() {\n            angular.element($window)\n               .unbind('resize', scope.windowResizeHandler);\n         });\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/directive/scrollable-dialog.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function model($rootScope, $timeout, brokerSessionStorageService, constants) {\n   function BaseViewClientModel() {\n      // Name of company that produced this client\n      this.vendor = 'VMware';\n\n      // Architecture of client\n      this.arch = '';\n\n      // Vendor-specific client-type identifier\n      this.product = 'VMware Horizon HTML Access';\n\n      // Product version\n      this.version = '';\n\n      // unique client ID\n      this.clientID = '';\n\n      this.linkModel = {\n         // Help Pages, now Unique ID\n         'helpPages': {\n            'en': 'https://docs.vmware.com/en/VMware-Horizon-HTML-Access/4.6/'+\n                  'com.vmware.horizon.html-access-46-user-guide/GUID-20F0C9F6-'+\n                  '7DE9-4D3D-8095-391C9F795F54.html',\n            'de': 'https://docs.vmware.com/de/VMware-Horizon-HTML-Access/4.6/'+\n                  'com.vmware.horizon.html-access-46-user-guide/GUID-20F0C9F6-'+\n                  '7DE9-4D3D-8095-391C9F795F54.html',\n            'es': 'https://docs.vmware.com/es/VMware-Horizon-HTML-Access/4.6/'+\n                  'com.vmware.horizon.html-access-46-user-guide/GUID-20F0C9F6-'+\n                  '7DE9-4D3D-8095-391C9F795F54.html',\n            'fr': 'https://docs.vmware.com/fr/VMware-Horizon-HTML-Access/4.6/'+\n                  'com.vmware.horizon.html-access-46-user-guide/GUID-20F0C9F6-'+\n                  '7DE9-4D3D-8095-391C9F795F54.html',\n            'ja': 'https://docs.vmware.com/jp/VMware-Horizon-HTML-Access/4.6/'+\n                  'com.vmware.horizon.html-access-46-user-guide/GUID-20F0C9F6-'+\n                  '7DE9-4D3D-8095-391C9F795F54.html',\n            'ko': 'https://docs.vmware.com/kr/VMware-Horizon-HTML-Access/4.6/'+\n                  'com.vmware.horizon.html-access-46-user-guide/GUID-20F0C9F6-'+\n                  '7DE9-4D3D-8095-391C9F795F54.html',\n            'zh-CN': 'https://docs.vmware.com/cn/VMware-Horizon-HTML-Access/4.6/'+\n                  'com.vmware.horizon.html-access-46-user-guide/GUID-20F0C9F6-'+\n                  '7DE9-4D3D-8095-391C9F795F54.html',\n            'zh-TW': 'https://docs.vmware.com/tw/VMware-Horizon-HTML-Access/4.6/'+\n                  'com.vmware.horizon.html-access-46-user-guide/GUID-20F0C9F6-'+\n                  '7DE9-4D3D-8095-391C9F795F54.html',\n         },\n         // go to forum Pages\n         'gotoForumPages': {\n            'en': 'https://communities.vmware.com/community/vmtn/horizon/view'\n         },\n         /*\n          * EULAs of HTML Access are in the installer instead of online web pages.\n          * Here are just some dummy IDs. Out-Of-Use\n          */\n         'eulaPages': {\n            'en': 'https://www.vmware.com/info?id=1327'\n         }\n\n      };\n\n      this.MIN_VERSION = {\n         'IE': 10,\n         'Firefox': 36,\n         'Gecko': 21,\n         'Chrome': 41,\n         'Safari': 7,\n         'WebKit': 536\n      };\n\n      this.acceptLanguage = null;\n      this.clientVersion = null;\n      this.logLevel = null;\n      this.ipAddress = null;\n      this.rebrandName = null;\n      this.rebrandHelpUrl = '';\n      this.rebrandGotoForumUrl = '';\n      this.windowsTimezone = null;\n\n      /**\n       *  Features in 'client-config' of broker response\n       */\n      this.clientHideDomainList = !!brokerSessionStorageService\n         .read('clientHideDomainList');\n      this.clientHideServerInformation = !!brokerSessionStorageService\n         .read('clientHideServerInformation');\n      this.credentialCleanup = !!brokerSessionStorageService\n         .read('credentialCleanup');\n      this.isAnonymousMode = !!brokerSessionStorageService\n         .read(constants.ANONYMOUS_MODE_KEY);\n      $timeout(() => {\n         $rootScope.showPreference = !this.isAnonymousMode;\n      });\n   }\n\n   // Return constructor function.\n   return BaseViewClientModel;\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/model/baseviewclient-model.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * blastsessions-model.js --\n *\n * Model to provide blast application sessions information for reconnection\n * using broker response of reconnect and broerkSessionStorageService.\n */\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\n\nexport default function blastSessionsModel(brokerSessionStorageService) {\n   //private:\n   let isNotValidString,\n      isInvalidBlastSession,\n      hasBlastInfoIn,\n      getFormatConvertedInfo,\n      getFormatConvertedInfoFromSessionInfo,\n      hasSessionInfoInStorage,\n      readFromStorage,\n      writeToStorage,\n      isInvalidLaunchResponse;\n\n   isNotValidString = function(data) {\n      return (typeof(data) !== 'string' || data.trim() === '');\n   };\n\n   isInvalidBlastSession = function(sessionInfo) {\n      if (!sessionInfo ||\n         isNotValidString(sessionInfo.sessionId) ||\n         sessionInfo.protocolIsBlast === false ||\n         typeof(sessionInfo.needNewConnectionWithBlast) !== 'boolean' ||\n         !sessionInfo.content ||\n         isNotValidString(sessionInfo.content.originId)) {\n         return true;\n      }\n\n      return false;\n   };\n\n   hasBlastInfoIn = function(sessionInfo) {\n      return sessionInfo.needNewConnectionWithBlast;\n   };\n\n   /**\n    * other useful but not reported info in sessionInfo.content includes:\n    * [userName, domainName, enableUsb, enableMmr, preferences]\n    */\n   getFormatConvertedInfo = function(data) {\n      let convertedSessionInfo = {};\n      if (!data) {\n         return {};\n      }\n      convertedSessionInfo.originId = data.originId;\n      convertedSessionInfo.blastUrl = data.url;\n      return convertedSessionInfo;\n   };\n\n   getFormatConvertedInfoFromSessionInfo = function(sessionInfo) {\n      return getFormatConvertedInfo(sessionInfo.content);\n   };\n\n   hasSessionInfoInStorage = function(originId) {\n      return brokerSessionStorageService.exist(originId);\n   };\n\n   readFromStorage = function(originId) {\n      return brokerSessionStorageService.read(originId);\n   };\n\n   writeToStorage = function(convertedSessionInfo) {\n      let originId = convertedSessionInfo.originId;\n\n      brokerSessionStorageService.write(originId, convertedSessionInfo);\n   };\n\n   isInvalidLaunchResponse = function(responseData) {\n      if (!responseData ||\n         isNotValidString(responseData.id) ||\n         isNotValidString(responseData.url)) {\n         return true;\n      }\n      return false;\n   };\n\n   //public:\n   /**\n    * designed for read out and fill the lacking data of the\n    * sessionInfoList side effect!: also write data. implement like this\n    * to increase efficiency and provide a simple API.\n    */\n   this.getFullSessionInfoWith = function(sessionInfoList) {\n      let i,\n         sessionInfo,\n         originId,\n         validSessionInfoList = [];\n\n      for (i = 0; i < sessionInfoList.length; i++) {\n         sessionInfo = sessionInfoList[i];\n         if (isInvalidBlastSession(sessionInfo)) {\n            // error\n            return [];\n         }\n\n         originId = sessionInfo.content.originId;\n         if (hasBlastInfoIn(sessionInfo)) {\n            validSessionInfoList[i] =\n               getFormatConvertedInfoFromSessionInfo(sessionInfo);\n            writeToStorage(validSessionInfoList[i]);\n         } else if (hasSessionInfoInStorage(originId)) {\n            validSessionInfoList[i] = readFromStorage(originId);//storage\n                                                                // service\n         } else {\n            validSessionInfoList[i] = {};\n         }\n      }\n      return validSessionInfoList;\n   };\n\n   /**\n    * designed for saving data that contains in the launch\n    * app(get-application-connection) XML response\n    */\n   this.saveFromXmlResponse = function(responseData) {\n      let validSessionInfo;\n      if (isInvalidLaunchResponse(responseData)) {\n         JSCDKLogger.debug(\n            'Error: fail to save, because the saveFromXmlResponse is called with invalid response');\n      }\n      validSessionInfo = getFormatConvertedInfo(responseData);\n      writeToStorage(validSessionInfo);\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/model/blastsessions-model.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * This file is to generate and reuse ClientID, currently, the\n * ClientID will be kept for 10 years, and can corss domains that\n * share a same root domain, so a user can access brokers in the\n * same root-domain with the identical clientID.\n *\n * But access throuth the static IP of broker or the hostName of\n * the static IP will use different Client ID, and will cost more\n * licenses when access RDSH desktop.\n *\n * And after the cookie is cleared by user, the previous client ID\n * will lost.\n *\n * The client ID is not cross browsers or machines but cross server.\n */\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\nexport default function clientIdFactory($window) {\n   let clientUID = null;\n\n   /**\n    * Whether the input string is a IP address\n    * Try to analysis for both IPv4 and IPv6, and the part for IPv6 is not\n    * tested with real IPv6 address.\n    *\n    * Althrough shorten 1:2:3:4:5:0:7:8 to 1:2:3:4:5::7:8 is not recommened\n    * by RFC 5952, but here still treat it as a valid IP address for giving\n    * warning info when user don't know this format rule. But do not accept\n    * the shorting from 1:2:3:4:5:6:7:0 to 1:2:3:4:5:6:7:: or things like\n    * 1:2:3:4:5:6:7:, while accept 1:2::8, 1:2:3::, ::7:8 or ::.\n    *\n    * @param hostAddress string\n    * @return isAnIPAddress bool\n    */\n   function isAnIP(hostAddress) {\n      let segmentArray,\n         segmentLength,\n         i,\n         temp,\n         isIPv4Address = false,\n         isIPv6Address = false;\n\n      if (hostAddress.split('.').length !== 4) {// not a IPv4\n         if ((hostAddress.split('::').length !== 2 ||\n            hostAddress.split(':').length > 7) &&\n            hostAddress.split(':').length !== 8) {// not a IPv6\n            return false;\n         }\n         segmentArray = hostAddress.split(':');\n         segmentLength = segmentArray.length;\n         isIPv6Address = true;\n      } else {\n         segmentArray = hostAddress.split('.');\n         segmentLength = segmentArray.length;\n         isIPv4Address = true;\n      }\n\n\n      if (isIPv4Address) {//IPv4\n         for (i = 0; i < segmentLength; i++) {\n            temp = parseInt(segmentArray[i], 10);\n            if (!(temp <= 255 && temp >= 0 && segmentArray[i].length <= 3)) {// NaN will be true\n               isIPv4Address = false;\n               break;\n            }\n         }\n      } else if (isIPv6Address) {//IPv6\n         if (hostAddress.split('::').length === 2) {// have ::\n            if (hostAddress === '::') {// all-zeros\n               return true;\n            }\n            if (segmentArray[0] === '' && segmentArray[1] === '') {//::X:X:X\n               for (i = 2; i < segmentLength; i++) {\n                  segmentArray[i - 2] = segmentArray[i];\n               }\n               segmentLength -= 2;\n            } else if (segmentArray[segmentLength - 1] === '' &&\n               segmentArray[segmentLength - 2] === '') {//X:X:X::\n               segmentLength -= 2;\n            } else {// X:X::X:X\n               segmentArray = hostAddress.replace('::', ':').split(':');\n               segmentLength = segmentArray.length;\n            }\n         }\n         for (i = 0; i < segmentLength; i++) {\n            temp = parseInt(segmentArray[i], 16);\n            if (!(temp <= 65535 && temp >= 0 &&\n               segmentArray[i].length <= 4)) {// NaN will be true\n               isIPv6Address = false;\n               break;\n            }\n         }\n      }\n      return (isIPv4Address || isIPv6Address);\n   }\n\n   /* Whether the input string is a parent-domain(or itself) of current page\n    *\n    * I use write and read test to test whether current page can access the\n    * input 'domain'.\n    *\n    * the usage of document.domain can also get rootDomain, but the DOM 2\n    * HTML standard defined document.domain as readonly while HTML Living\n    * Standard updated in 11th/sep/2014 define it as property that can be\n    * write, and web sites like q.com seems using this technic. But using\n    * it will involve the wired document.domain = document.domain in all\n    * other files and browser support them in different ways. So I do not\n    * choose this one. Might will be used after the Blast page is moved\n    * to Broker.\n    *\n    * the timestamp is to prevent browser do not rewrite identical cookie,\n    * which should never happen, and '=1' is to make it a key-value pair,\n    * both are just to make code stronger.\n    *\n    * @param  domain               string\n    * @return isAnAccessableDomain bool\n    */\n   function isAnAccessableDomain(domain) {\n      let testText = 'TCAT4' + domain + new Date().getTime() + '=1';\n\n      try {\n         // try write a cookie will expire after 5 seconds, for old browser\n         // it will be session cookie\n         $window.document.cookie =\n            testText + '; max-age=5; path=/; domain=' + domain + '; secure';\n\n         // try read\n         return $window.document.cookie.indexOf(testText) > -1;\n      }\n      catch (err) {\n         return false;\n      }\n   }\n\n   /* Whether the input string is a parent-domain(or itself) of current page\n    *\n    * This function can be rewirte with top-level domain suffix table as\n    * broswers do, but it need to be maintained all the time, and might loss\n    * support for suffix like '.cn, .jp, .tw' for small contries. So here I\n    * use write and read test to get the shortest 'domain' that current page\n    * can access. And treat it as the root domain.\n    *\n    * It also take the domain name without suffix like .com as valid root\n    * domain, for this product might be only used in LAN with DNS settings\n    * that allows the domain name represented in the short form.\n    *\n    * @param  hostAddress          string\n    * @return rootDomain           string\n    */\n   function getRootDomain(hostAddress) {\n      let segmentArray = hostAddress.split('.'),\n         segmentLength = segmentArray.length,\n         rootDomain = null;\n\n      // try filter IP address out, and the continuing code can still work\n      // with IP not recognized\n      if (isAnIP(hostAddress)) {\n         JSCDKLogger.warning(\n            'launch the html access by IP may generate extra licenses!');\n         return hostAddress;\n      }\n\n      /* take the domain name without suffix like .com as valid, for this\n       * product might be only used in LAN with domain name in short form\n       */\n      do {\n         segmentLength--;\n         if (!rootDomain) {\n            rootDomain = segmentArray[segmentLength];\n         } else {\n            rootDomain = segmentArray[segmentLength] + '.' + rootDomain;\n         }\n         if (isAnAccessableDomain(rootDomain)) {\n            return rootDomain;\n         }\n      } while (segmentLength > 0);\n\n      return hostAddress;\n   }\n\n   function setClientUIDFromCookie() {\n      let name = 'CID=',\n         cookies = $window.document.cookie.split(/;\\s*/),\n         cookiesLength = cookies.length,\n         i;\n\n      for (i = cookiesLength - 1; i >= 0; i--) {\n         if (cookies[i].indexOf(name) === 0) {\n            clientUID = cookies[i].replace(name, '');\n            return;\n         }\n      }\n      clientUID = null;\n   }\n\n   function writeClientUIDToCookie() {\n      let rootDomain = getRootDomain($window.location.host),\n         d = new Date(),\n         expires;\n\n      // cookie will exist for 10 years (an old way to support old browsers)\n      d.setTime(d.getTime() + 10 * 365.25 * 24 * 60 * 60 * 1000);\n      expires = '; expires=' + d.toGMTString();\n      $window.document.cookie =\n         'CID=' + clientUID + expires + '; path=/; domain=' + rootDomain +\n         '; secure';\n   }\n\n   /* generate a new Client ID by random array\n    *\n    * the platform ID is generated as MS requested in MSDN.\n    *\n    * navigator.platform is supported by Chrome, FF, IE, Opera, Safari, and\n    * Android, Chrome for Andriod, FF Mobile, IE Mobile, Opera Mobile, Safari\n    * Mobile, using UA again is just to make code stronger for old browsers.\n    *\n    * and the String is matched with capital charactor reserved for reducing\n    * the chance of mismatching.\n    */\n   function generateRandomArray() {\n      let platformID = '04-00-00-00'; //default\n\n      if (!!$window.navigator.platform) {\n         if ($window.navigator.platform.indexOf('Win') === 0) {//'Win32','Windows'\n            platformID = '02-00-00-00';\n         }\n         if ($window.navigator.platform.indexOf('Mac') === 0) {// 'Mac68K', 'MacPPC', 'Macintosh', 'MacIntel'\n            platformID = '06-00-00-00';\n         }\n      } else if (!!$window.navigator.userAgent) {\n         if ($window.navigator.userAgent.indexOf('Windows') > -1) { //Windows NT 5.0, Windows 2000, Windows NT 5.1, Windows XP, Windows NT 5.2,\n                                                            // Windows 2003, Windows NT 6.0, Windows Vista, Windows NT 6.1, Windows 7,\n                                                            // Windows 8\n            platformID = '02-00-00-00';\n         }\n         if ($window.navigator.userAgent.indexOf('Mac') > -1) {\n            platformID = '06-00-00-00';\n         }\n      }\n      /**\n       * Generate a random number in [0,1), by using the current time.\n       */\n      function random() {\n         let d = new Date(),\n            seed = Math.abs(1000 * d.getSeconds() + d.getMilliseconds()),\n            r = seed * Math.random();\n         return r - Math.floor(r);\n      }\n\n\n      return (platformID +\n      ' xx-xx-xx-xx xx-xx-xx-xx xx-xx-xx-xx xx-xx-xx-xx').replace(/x/g,\n         function() {\n            let r = random() * 16 | 0;\n            return r.toString(16);\n         }).split(/ |-/);\n   }\n\n   function arrayToBase64(uidIntArray) {\n      let i = 0,\n         arrayLength = uidIntArray.length,\n         h1, h2, h3,\n         number,\n         c1, c2, c3, c4,\n         toBase64Table = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',\n         charsArray = [],\n         result,\n         indexAc = 0,\n         r;\n\n      do { // pack three bytes into four charactors in 64-base\n         h1 = parseInt(uidIntArray[i++], 16); //undefine will return NaN\n         h2 = parseInt(uidIntArray[i++], 16);\n         h3 = parseInt(uidIntArray[i++], 16);\n\n         number = h1 << 16 | h2 << 8 | h3; //NaN will be treated as 0\n\n         c1 = number >> 18 & 0x3f;\n         c2 = number >> 12 & 0x3f;\n         c3 = number >> 6 & 0x3f;\n         c4 = number & 0x3f;\n\n         // Convert decimal into base64, and append to array to avoid\n         // realloc spaces too often.\n         charsArray[indexAc++] =\n            toBase64Table[c1] + toBase64Table[c2] + toBase64Table[c3] +\n            toBase64Table[c4];\n      } while (i < arrayLength);\n      result = charsArray.join('');\n\n      //replace the undefined pure-0 charactor(A)s part with '='s\n      r = uidIntArray.length % 3;\n      return (r ? result.slice(0, r - 3) : result) + '==='.slice(r || 3);\n   }\n\n\n   function generateUID() {\n      let uidIntArray = generateRandomArray();\n      return arrayToBase64(uidIntArray);\n   }\n\n   function getClientID() {\n      setClientUIDFromCookie();\n      if (!clientUID) {\n         clientUID = generateUID();\n         writeClientUIDToCookie();\n      }\n      return clientUID;\n   }\n\n   // Return client ID.\n   return getClientID();\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/model/clientid-model.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function connectionServerModel($window) {\n   function ServerModel() {\n      // Server host address.\n      this.host = '';\n\n      // An array of supported protocols.\n      this.supportedProtocols = ['BLAST'];\n\n      // Launch an appropriate client for the connection protocol\n      this.connectionProtocol = 'BLAST';\n\n      // Username\n      this.username = '';\n\n      // Domain\n      this.domain = '';\n\n      // Token username\n      this.tokenUsername = '';\n\n      /*\n       * A HWS session identifier.\n       * wiki: https://wiki.eng.vmware.com/View/ViewWorkspaceSessionSynchronization\n       */\n      this.horizonId = '';\n\n      // Reset server model.\n      this.reset = function() {\n         this.username = '';\n         this.domain = '';\n         this.tokenUsername = '';\n         this.horizonId = '';\n      };\n\n      /*\n       * load the data from the URL model, should be trigger when the info in\n       * the URL is valid as the current connected info.\n       */\n      this.loadFromURIModel = function(connectionURIModel) {\n         let i,\n            key,\n            srcKey,\n            params,\n            keyList = ['username', 'domain', 'horizonId', 'tokenUsername'],\n            specialKeyMap = {\n               domain: 'domainName',\n               username: 'userName'\n            };\n\n         if (!connectionURIModel || !connectionURIModel.params) {\n            return;\n         }\n         params = connectionURIModel.params;\n         for (i = 0; i < keyList.length; i++) {\n            key = keyList[i];\n            srcKey = specialKeyMap[key] || key;\n            if (!!params[srcKey]) {\n               this[key] = params[srcKey];\n            }\n         }\n      };\n   }\n\n   let serverModel = new ServerModel();\n   // Server host address.\n   serverModel.host = $window.location.host;\n\n   return serverModel;\n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/model/connection-server-model.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function connectionURIModel(storageService, usernameUtil,\n                                           viewClientModel) {\n   // URI parameters\n   this.params = null;\n\n   // Whether the current URI connection is the same as the previous one.\n   this.reuseSession = false;\n\n   /**\n    * This function detects whether it's the same user logins to the\n    * broker.\n    *\n    * @param oldHost    Make function params same with Chrome client.\n    *    oldHost is not used here for now.\n    * @param callback   Use callback to deal with identical result.\n    *                   It will make the funtion action the same with\n    *    Chrome client.\n    */\n   this.isIdenticalUser = function(oldHost, callback) {\n      // If connectionURIModel.params is null, return.\n      if (!this.params) {\n         callback(true);\n         return;\n      }\n\n      if (this._isSwitchingToAnonymous()) {\n         callback(false);\n         return;\n      }\n\n      let userName = this._getUsername(),\n         oldUserName = storageService.cookie.read(\n            storageService.cookie.COOKIE_USER_NAME),\n         domainName = this.params.domainName,\n         oldDomainName = storageService.cookie.read(\n            storageService.cookie.COOKIE_DOMAIN_NAME),\n         tokenUsername = this.params.tokenUserName,\n         oldTokenUsername = storageService.cookie.read(\n            storageService.cookie.COOKIE_TOKEN_USER_NAME),\n         horizonId = this.params.horizonId,\n         oldHorizonId = storageService.cookie.read(\n            storageService.cookie.COOKIE_HORIZON_ID);\n\n      /**\n       * NOTE: If userName contains domain, then that domain should\n       * always be the same with domainName.\n       * We have this check in 'connectToBroker' of view-service.js\n       */\n      if ((!!userName && !!oldUserName &&\n         !this.usernameEquals(userName, oldUserName)) ||\n         !this.domainEquals(userName, domainName,\n            oldUserName, oldDomainName) ||\n         (!!tokenUsername && !!oldTokenUsername &&\n         (tokenUsername !== oldTokenUsername)) ||\n         (!!horizonId && !!oldHorizonId &&\n         (horizonId !== oldHorizonId))) {\n         callback(false);\n      } else {\n         callback(true);\n      }\n   };\n\n   this._getUsername = function() {\n      // Ignore userName if in anonymous mode\n      if (this.isAnonymous()) {\n         if (this.params.unauthenticatedAccessAccount) {\n            return this.params.unauthenticatedAccessAccount;\n         }\n         return null;\n      }\n\n      if (this.params.userName) {\n         return this.params.userName;\n      }\n\n      return null;\n   };\n\n   this._isSwitchingToAnonymous = function() {\n      // If previous session is not anonymous one, but the current is.\n      return this.isAnonymous() && !viewClientModel.isAnonymousMode;\n   };\n\n   /**\n    * isHWSession\n    *\n    * Use the HWS session identifier to detect whether\n    * the url is generated by a Workspace or not.\n    */\n   this.isHWSession = function() {\n      return !!this.params && !!this.params.horizonId;\n   };\n\n   /**\n    * isF5Session\n    *\n    * Use the F5 session identifier to detect whether\n    * the url is generated by a F5 APM server or not.\n    */\n   this.isF5Session = function() {\n      return !!this.params && !!this.params.mid;\n   };\n\n   this.isSamlUsed = function() {\n      return !!this.params && !!this.params.samlArt;\n   };\n\n   this.isAnonymous = function() {\n      return !!this.params && !!this.params.unauthenticatedAccessEnabled &&\n         (this.params.unauthenticatedAccessEnabled.toLowerCase() === 'true');\n   };\n\n   this.getSpID = function() {\n      if (!!this.params && !!this.params.spID) {\n         return this.params.spID;\n      }\n      return '';\n   };\n\n   /**\n    * Refer to this page:\n    * https://confluence.eng.vmware.com/display/WOR/Horizon+Client+SP+Init+Flow+a.k.a+Fix+Access+Policy+support+in+Horizon\n    *\n    * Finally we have agreement with vIDM team that we just send the parameter\n    * as it is now and they can send them back\n    */\n   this.generateRelayInfo = function() {\n      if (!this.params) {\n         return '';\n      }\n      let relayInfo = '';\n\n      for (let key in this.params) {\n         if ((key === 'path' || key === 'action' || key === 'mid' ||\n            key === 'args') && !!this.params[key]) {\n            relayInfo += key + '=' + encodeURIComponent(this.params[key]) + '&';\n         }\n      }\n      // Cut the final '&'\n      if (relayInfo.length >= 1) {\n         relayInfo = relayInfo.substr(0, relayInfo.length - 1);\n      }\n\n      return relayInfo;\n   };\n\n   /**\n    * getF5postFix\n    *\n    * return the mid=XXX string, currently we still not support ISO\n    */\n   this.getF5postFix = function() {\n      if (!this.isF5Session()) {\n         return '';\n      }\n      return \"?mid=\" + this.params.mid;\n   };\n\n   // Case insensitive string compare.\n   this.ignoreCaseEquals = function(str1, str2) {\n      if (!str1 || !str2) {\n         return false;\n      }\n\n      return str1.toLowerCase() === str2.toLowerCase();\n   };\n\n   this.usernameEquals = function(username1, username2) {\n      if (usernameUtil.domainInUsername(username1)) {\n         username1 = usernameUtil.getUsername(username1);\n      }\n      if (usernameUtil.domainInUsername(username2)) {\n         username2 = usernameUtil.getUsername(username2);\n      }\n\n      return this.ignoreCaseEquals(username1, username2);\n   };\n\n   this.domainEquals = function(userName, domainName,\n                                oldUserName, oldDomainName) {\n      let domainName1 = domainName,\n         domainName2 = oldDomainName;\n      /**\n       * It is possible there is no domainName param in URI, but the\n       * username is UPN or domain\\username.\n       * So if username contains domain info, use it to compare with the\n       * other one. If not, then use the domainName param.\n       *\n       * NOTE: we have domain check in uri-param-validator.js\n       * The domain info in username and domainName param should always\n       * be the same.\n       */\n      if (usernameUtil.domainInUsername(userName)) {\n         domainName1 = usernameUtil.getDomain(userName);\n      }\n      if (usernameUtil.domainInUsername(oldUserName)) {\n         domainName2 = usernameUtil.getDomain(oldUserName);\n      }\n\n      /**\n       * Only compare domain when both of them exist.\n       * Otherwise assume they are the same\n       */\n      if (!!domainName1 && !!domainName2) {\n         return this.ignoreCaseEquals(domainName1, domainName2);\n      }\n      return true;\n   };\n\n   // Clear URI data.\n   this.clear = function(needReuseSession) {\n      this.params = null;\n      if (needReuseSession === false) {\n         this.reuseSession = false;\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/model/connection-uri-model.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function osModel() {\n   function detectOS(platform) {\n      let prefix = \"download_rich_client_\",\n         os = platform || \"unknown\",\n         getOSLiteral,\n         mIsWin32 = false,\n         mIsWin64 = false,\n         mIsWinMobile = false,\n         mIsLinux32 = false,\n         mIsLinux64 = false,\n         mIsMacOS = false,\n         mIsIOS = false,\n         mIsAndroid = false,\n         mIsChromeOS = false,\n         /*\n          * Localization Map\n          *   return the local key of the respective OS:\n          *\n          * win32 - os_win32\n          * win64 - os_win64\n          * winphone - os_winphone\n          * linux32 - os_linux32\n          * linux64 - os_linux64\n          * mac - os_mac\n          * android - os_android\n          * ios - os_ios\n          * chromeos - os_chromeos\n          * unknown - os_unknown\n          */\n         osNames = {\n            win32: 'os_win32',\n            win64: 'os_win64',\n            winmobile: 'os_winmobile',\n            linux32: 'os_linux32',\n            linux64: 'os_linux64',\n            mac: 'os_mac',\n            android: 'os_android',\n            ios: 'os_ios',\n            chromeos: 'os_chromeos',\n            unknown: 'os_unknown'\n         };\n\n      switch (os) {\n         case 'win32':\n            mIsWin32 = true;\n            break;\n         case 'win64':\n            mIsWin64 = true;\n            break;\n         case 'winmobile':\n            mIsWinMobile = true;\n            break;\n         case 'linux32':\n            mIsLinux32 = true;\n            break;\n         case 'linux64':\n            mIsLinux64 = true;\n            break;\n         case 'mac':\n            mIsMacOS = true;\n            break;\n         case 'android':\n            mIsAndroid = true;\n            break;\n         case 'ios':\n            mIsIOS = true;\n            break;\n         case 'chromeos':\n            mIsChromeOS = true;\n            break;\n         default:\n            break;\n      }\n\n      getOSLiteral = function(os) {\n         return prefix + (osNames[os] || osNames.unknown);\n      };\n\n      /*\n       * OS:\n       *   win32, win64, linux32, linux64, mac, android, ios, chromeos, unknown\n       */\n      return {\n         os: os,\n         osLiteral: getOSLiteral(os),\n         mIsWin32: mIsWin32,\n         mIsWin64: mIsWin64,\n         mIsWinMobile: mIsWinMobile,\n         mIsLinux32: mIsLinux32,\n         mIsLinux64: mIsLinux64,\n         mIsMacOS: mIsMacOS,\n         mIsIOS: mIsIOS,\n         mIsAndroid: mIsAndroid,\n         mIsChromeOS: mIsChromeOS\n      };\n   }\n\n   return detectOS;\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/model/os-model.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport $ from 'jquery';\nimport angular from 'angular';\nimport util from '../../jscdk/util';\n\nexport default function viewClientModel($window, BaseViewClientModel, osModel,\n   clientID,\n   storageService) {\n\n   let clientInfo,\n      clientModel = new BaseViewClientModel(),\n      ua = $window.navigator.userAgent.toLowerCase(),\n      vs = $window.navigator.appVersion.toString(),\n      inited = false,\n      failToInited = false,\n      onInitCallback = null;\n\n   // Architecture of client\n   clientModel.arch = 'browser';\n   // Product version\n   clientModel.version = __VDM_WEB_CLIENT_VERSION__;\n   // Client ID\n   clientModel.clientID = clientID;\n\n   clientModel.ipAddress = '0.0.0.0';\n\n   clientModel.buildNum = __BUILD_NUMBER__;\n   // Installer URL of the native client on this specific OS\n   clientModel.nativeInstallerLink =\n      'https://www.vmware.com/go/viewclients';\n\n   clientModel.initClientInfo = function(data) {\n      if (!!data.clientIPAddress) {\n         this.ipAddress = data.clientIPAddress;\n         this.machineName = data.clientIPAddress.replace(/\\./g, '-') + '-' + this.browserName;\n      }\n      if (!!data.logLevel && !isNaN(data.logLevel)) {\n         JSCDKLogger.setLogLevel(data.logLevel);\n         this.logLevel = data.logLevel;\n      }\n\n      if (!!data.rebrandName) {\n         this.rebrandName = data.rebrandName;\n         this.rebrandEnable = true; // used by BlastDesktopCtrl\n      } else {\n         this.rebrandEnable = false;\n      }\n\n      if (!!data.rebrandHelpUrl) {\n         this.rebrandHelpUrl = data.rebrandHelpUrl;\n      }\n\n      if (!!data.rebrandGotoForumUrl) {\n         this.rebrandGotoForumUrl = data.rebrandGotoForumUrl;\n      }\n\n      if (!!data.acceptLanguage) {\n         this.acceptLanguage = data.acceptLanguage;\n         // Set language for jscdk\n         util.l10N.setLocaleAndLoad(data.acceptLanguage);\n      }\n\n      /*\n       * Client OS platform, could be:\n       * win32, win64, winmobile, linux32, linux64, mac,\n       * android, ios, chromeos or unknown\n       */\n      if (!!data.os) {\n         angular.extend(this, osModel(data.os));\n      }\n\n      /*\n       * User is able to customize native installers download links\n       * in the configuration file.\n       *\n       * If no download links are customized in the configuration file,\n       * use the default download link: https://www.vmware.com/go/viewclients\n       */\n      if (!!data.installerLink) {\n         this.nativeInstallerLink = data.installerLink;\n      }\n\n      this.contextPath = data.contextPath;\n      inited = true;\n      if (typeof onInitCallback === \"function\") {\n         onInitCallback();\n      }\n   };\n\n   clientModel.onFailReadingClientInfo = function() {\n      failToInited = true;\n      if (typeof onInitCallback === \"function\") {\n         onInitCallback();\n      }\n   };\n\n   clientModel.onReady = function(callback) {\n      /**\n       * Since VADC don't have info.jsp, and BSG is only allow access using\n       * specified address for info.jsp, it's possible of failing to get the\n       * info.jsp. When that happens, the client will continute for the initing\n       * as before.\n       */\n      if (inited || failToInited) {\n         callback();\n      } else {\n         onInitCallback = callback;\n      }\n   };\n\n   clientInfo = storageService.cookie.read('clientInfo');\n   if (!!clientInfo) {\n      clientModel.initClientInfo(JSON.parse(clientInfo));\n   } else {\n      JSCDKLogger.error(\n         'Failed to get locale and product info in cookies.');\n\n      // for grunt server task, in clientModel case, the local\n      // http server does not set cookie\n      // Request locale and product info from the server.\n      $.ajax({\n         type: 'GET',\n         url: '../info.jsp',\n         dataType: 'json',\n         async: true,\n         cache: false,\n         success: function(data) {\n            JSCDKLogger.debug('Request locale and product info ' +\n               'from the server : ' + JSON.stringify(data));\n            clientModel.initClientInfo(data);\n         },\n         error: function() {\n            JSCDKLogger.error('Request locale and product ' +\n               'info from the server failed.');\n            clientModel.onFailReadingClientInfo();\n         }\n      });\n   }\n\n   // Detect browser version.\n   // the browser and version detection copied from original code,\n   // but it's better that we can have a browser service to do this job\n   clientModel.mIsIE = ua.indexOf('msie') > -1;\n   clientModel.mVersionIE = clientModel.mIsIE ?\n      parseInt(vs.slice(vs.indexOf('MSIE ') + 'MSIE '.length).split(';')[0], 10) : null;\n\n   /*\n    * The user-agent string for Internet Explorer 11 looks like:\n    * 'mozilla/5.0 (windows nt 6.1; wow64; trident/7.0; rv:11.0) like gecko'.\n    * It has removed 'MSIE' token. Detect 'trident' instead.\n    */\n   if (!clientModel.mIsIE) {\n      clientModel.mIsIE = ua.indexOf('trident') > -1;\n      clientModel.mVersionIE =\n         clientModel.mIsIE ? /rv[:\\s]([\\w.]+)/.exec(vs) : null;\n      clientModel.mVersionIE =\n         clientModel.mVersionIE ? clientModel.mVersionIE[1] : null;\n   }\n\n   /*\n    * The user-agent string for Internet Explorer 12/Edge looks like:\n    * 'Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko)\n    * Chrome/39.0.2171.71 Safari/537.36 Edge/12.0'.\n    * Detect 'Edge' here.\n    */\n   if (!clientModel.mIsIE) {\n      clientModel.mIsIE = ua.indexOf('edge') > -1;\n      clientModel.mVersionIE = clientModel.mIsIE ?\n         parseFloat(\n            ua.slice(ua.indexOf('edge')).split('/')[1].split(' ')[0]) :\n         null;\n   }\n\n\n   // clientModel version is * 100 (e.g. '533' instead of 5.3.3)\n   clientModel.mIsWebKit = ua.indexOf('applewebkit') > -1;\n   clientModel.mVersionWebKit = clientModel.mIsWebKit ?\n      parseInt(\n         ua.slice(ua.indexOf('applewebkit/') + 'applewebkit/'.length),\n         10) : null;\n\n   clientModel.mIsOpera = ua.indexOf('opera/') > -1;\n   clientModel.mVersionOpera = clientModel.mIsOpera ?\n      parseInt(ua.slice(ua.indexOf('Opera/') + 'Opera/'.length), 10) :\n      null;\n\n   if (!clientModel.mIsIE && !clientModel.mIsOpera &&\n      ua.indexOf('applewebkit') !== -1) {\n      clientModel.mIsChrome = ua.indexOf('chrome') > -1;\n      clientModel.mVersionChrome = clientModel.mIsChrome ?\n         parseFloat(\n            ua.slice(ua.indexOf('chrome')).split('/')[1].split(' ')[0]) :\n         null;\n   } else {\n      clientModel.mIsChrome = false;\n   }\n\n   // See:\n   // https://developer.mozilla.org/en/Gecko_user_agent_string_reference\n   // Also, Webkit says it's 'like Gecko', so we get a false positive\n   // here.\n   clientModel.mIsGecko = !clientModel.mIsWebKit && ua.indexOf('gecko') > -1;\n   clientModel.mVersionGecko = clientModel.mIsGecko ?\n      parseFloat(ua.slice(ua.indexOf('rv:') + 'rv:'.length)) : null;\n\n   // Detect IE9+ mobile versions.\n   clientModel.mIsIEMobile =\n      ua.indexOf('IEMobile') > -1 && clientModel.mVersionIE > 8;\n\n   clientModel.mIsIPhone = ua.indexOf('iphone') > -1;\n\n   if (clientModel.mIsIOS) {\n      // even chrome on iOS has 'safari' in user agent,\n      // but chrome uses 'crios'.\n      clientModel.mIsIOSSafari =\n         ua.indexOf('safari') > -1 && ua.indexOf('crios') === -1;\n   } else {\n      clientModel.mIsIOSSafari = false;\n   }\n\n   if (clientModel.mIsAndroid) {\n      clientModel.browserName = 'An';\n   } else if (clientModel.mIsIEMobile) {\n      clientModel.browserName = 'IEM';\n   } else if (clientModel.mIsIOS) {\n      clientModel.browserName = 'IOS';\n   } else if (clientModel.mIsIE) {\n      // mobile browsers should not enter here or after\n      clientModel.browserName = 'IE';\n   } else if (clientModel.mIsChrome) {\n      clientModel.browserName = 'Chr';\n   } else if (clientModel.mIsWebKit) {\n      clientModel.browserName = 'Saf';\n   } else if (clientModel.mIsOpera) {\n      clientModel.browserName = 'Op';\n   } else if (clientModel.mIsGecko) {\n      // webkit will not enter here\n      clientModel.browserName = 'FF';\n   } else {\n      clientModel.browserName = 'UNK';\n   }\n\n   return clientModel;\n}\n\n\n// WEBPACK FOOTER //\n// ./common/model/viewclient-model.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function baseViewService($location, $timeout, $window,\n                                        viewClientModel, credCleanService) {\n   this.locationChange = false;\n\n   this.changeLocation = function(value) {\n      $timeout(() => {\n         this.locationChange = true;\n         $location.path(value);\n      });\n   };\n\n   this.gotoPortal = function() {\n      $window.location.href =\n         $location.protocol() + '://' + $location.host() + ':' +\n         $location.port() + viewClientModel.contextPath;\n   };\n\n   this.goBackToLauncherFromDesktop = function() {\n      // TODO remove it when we don't need to redirect for back to launcher\n      credCleanService.setFlagBeforePageJumping();\n      $window.location.href = './index.html';\n   };\n\n   this.isBackInLauncher = function(next, current) {\n      let nextHash = this._getHashFromURL(next),\n         currentHash = this._getHashFromURL(current);\n      return currentHash === '#/launchitems' &&\n         nextHash !== '#/blastdesktop';\n   };\n\n   this.isBackFromDesktop = function(next, current) {\n      /**\n       * If the next hash is not #/desktop, we will treat it as back\n       * button click\n       */\n      let nextHash = this._getHashFromURL(next),\n         currentHash = this._getHashFromURL(current);\n      return currentHash === '#/desktop' &&\n         nextHash !== '#/desktop';\n   };\n\n   this.isJumpingToDesktop = function(next, current) {\n      let nextHash = this._getHashFromURL(next),\n         currentHash = this._getHashFromURL(current);\n      return currentHash === '#/blastdesktop' &&\n         nextHash === '#/desktop';\n   };\n\n   this._getHashFromURL = function(url) {\n      if (!url) {\n         return '';\n      }\n\n      let str = decodeURIComponent(url);\n      let loc = str.indexOf('#');\n      if (loc < 0) {\n         return '';\n      }\n      return str.substr(loc);\n   };\n\n   // in launcher page, in the url tab, delete launchitems and refresh page,\n   this.isRefreshingLauncher = function(next, current) {\n      return current.indexOf('#/launchitems') > 0 &&\n         next.indexOf('#/blastdesktop') <= 0;\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/base-view-service.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * brokerSessionStorage-service.js --\n *\n * utility serive to provide API for maintain a storage live as long as the\n * broker session and shared among tabs.\n */\n\n\nexport default function brokerSessionStorageService($window, storageService) {\n   // private:\n   let getFullKey,\n      isManagedKey,\n      storage,\n      keyHeader = 'BSS_';//'broker session storage'\n\n   try {\n      /**\n       * Try local storage first.\n       * We don't have good way to mock local storage right now.\n       * So there is no UT for code below.\n       */\n      storage = $window.localStorage;\n      storage.setItem('testKey123', 'foobar');\n      storage.removeItem('testKey123');\n   } catch (err) {\n      storage = storageService.localStorage;\n   }\n\n   getFullKey = function(key) {\n      return keyHeader + key;\n   };\n\n   isManagedKey = function(itemKey) {\n      // compatible with very short input\n      return itemKey.substring(0, keyHeader.length) === keyHeader;\n   };\n\n   this.read = function(key) {\n      let fullKey,\n         content;\n\n      fullKey = getFullKey(key);\n      content = storage.getItem(fullKey);\n      /**\n       * If the storage here is referred to storageService.localStorage,\n       * then it is actually stored in cookie. And it is possible the\n       * return value is ''. See the getItem function in\n       * storage-service.js.\n       *\n       * However JSON.parse('') always throw error. So we should return\n       * null in this case\n       */\n      try {\n         return JSON.parse(content);\n      } catch (e) {\n         return null;\n      }\n   };\n\n   this.write = function(key, value) {\n      let fullKey,\n         content = JSON.stringify(value);\n\n      fullKey = getFullKey(key);\n      storage.setItem(fullKey, content);\n   };\n\n   this.exist = function(key) {\n      let value = this.read(key);\n      return value !== null;\n   };\n\n   this.clear = function() {\n      let i,\n         itemkey;\n\n      for (i = 0; i < storage.length; i++) {\n         itemkey = storage.key(i);\n         if (isManagedKey(itemkey)) {\n            storage.removeItem(itemkey);\n         }\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/broker-session-storage-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport {globalArray} from '../../jscdk/jscdkClient';\n\nexport default function credCleanService($window, userGlobalPref,\n                                         viewClientModel) {\n   this._isPageJump = false;\n\n   this.init = function() {\n      if (!viewClientModel.credentialCleanup) {\n         return;\n      }\n\n      this._isPageJump = false;\n      $window.addEventListener('beforeunload', () => {\n         this._actionForPageTearDown();\n      });\n      $window.addEventListener('unload', function() {\n         // Do nothing here yet\n      });\n   };\n\n   this._actionForPageTearDown = function() {\n      if (!this._isPageJump) {\n         this._sendLogoutAction();\n      }\n   };\n\n   this._sendLogoutAction = function() {\n      const uiController = globalArray['uiController'];\n      if (!!uiController) {\n         uiController.invokeJSCDK({\n            method: 'LogoutFromBroker',\n            prefData: userGlobalPref.toFlatFormat(),\n            async: false,\n            timeout: 2000\n         });\n      }\n   };\n\n   this.setFlagBeforePageJumping = function() {\n      // This function can be removed after launcher/desktop page merged\n      this._isPageJump = true;\n   };\n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/credentialclean-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\nexport default function dpiService($window, constants, userGlobalPref) {\n   let logger = {\n      info: function (msg) {\n         JSCDKLogger.info('[dpiService] ' + msg);\n      },\n      error: function (msg) {\n         JSCDKLogger.error('[dpiService] ' + msg);\n      },\n      debug: function (msg) {\n         JSCDKLogger.debug('[dpiService] ' + msg);\n      }\n   };\n\n   return {\n      getDPI: function () {\n         let dpi;\n         if(userGlobalPref.getPrefData().enableDPISync !== 'true') {\n            dpi = parseFloat(constants.DPI_100_PERCENT *\n               $window.devicePixelRatio).toString();\n         } else {\n            logger.info(\"DPI Sync is disabled.  \" +\n               \"Ignore the real client DPI\");\n            dpi = '96';\n         }\n         logger.info(\"System DPI is \" + dpi);\n         return dpi;\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/dpi-service.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport $ from 'jquery';\n\nexport function localize($window, viewClientModel, $rootScope) {\n\n   /**\n    * Deals with some of the L10N features like using display text based\n    * on user's locale.\n    */\n   let locale = {\n\n      // Mapping of supported locales to the corresponding JSON file.\n      supportedLocale: {\n         'en': 'en',\n         'es': 'es',\n         'de': 'de',\n         'fr': 'fr',\n         'ja': 'ja',\n         'ko': 'ko',\n         'zh': 'zh-CN',\n         'en-us': 'en',\n         'es-es': 'es',\n         'de-de': 'de',\n         'fr-fr': 'fr',\n         'ja-jp': 'ja',\n         'ko-kr': 'ko',\n         'zh-cn': 'zh-CN',\n         'zh-hans': 'zh-CN',\n         'zh-hant': 'zh-TW',\n         'zh-tw': 'zh-TW',\n         'zh-hk': 'en',\n         'zh-mo': 'en',\n         'zh-hans-hk': 'en',\n         'zh-hant-hk': 'en',\n         'zh-hans-mo': 'en',\n         'zh-hant-mo': 'en'\n      },\n\n      // Locale to be used during translation. Default is English.\n      locale: 'en',\n\n      // JSON object containing the translated text.\n      translatedTable: null,\n\n      // Is localization server already load resource from server?\n      localizationReady: false,\n\n      // Get Locale info\n      getLocale: function() {\n         return this.locale;\n      },\n\n      // Set the locale and load the corresponding JSON translation table.\n      setLocaleAndLoad: function(acceptLanguage) {\n         let url,\n            selectedLocale;\n\n         if (!acceptLanguage) {\n            // The language version of the platform\n            acceptLanguage = $window.navigator.language ||\n               $window.navigator.userLanguage;\n         }\n\n         if (!!acceptLanguage) {\n            // Determine the corresponding JSON translation file.\n            selectedLocale = this.getBestLocale(acceptLanguage);\n            if (!!selectedLocale) {\n               this.locale = selectedLocale;\n            }\n         }\n\n         JSCDKLogger.debug(\n            'Load translation table for locale: ' + this.locale);\n\n         /**\n          * Load language JSON file according to browser's locale setting\n          * using AJAX synchronous call. TODO: change to server side code\n          */\n         url = './locale/' + this.locale + '.json?v=' + __BUILD_NUMBER__;\n         $.ajax({\n            type: 'GET',\n            url: url,\n            dataType: 'json',\n            async: false,\n            cache: false,\n            success: (data) => {\n               if (!!data) {\n                  this.translatedTable = data;\n               } else {\n                  JSCDKLogger.error(\n                     'Invalid translation data from url: ' + url);\n               }\n\n               this.localizationReady = true;\n               let lang = this.getHTMLLang(this.locale);\n               $('html').attr(\"lang\", lang);\n               $rootScope.$emit(\"model:localizationReady\");\n            },\n            error: function(jqXHR, textStatus, errorThrown) {\n               JSCDKLogger.error(\n                  'Failed to load translation data, url: ' + url +\n                  ', status: ' + textStatus + ', errorThrown: ' +\n                  errorThrown);\n            }\n         });\n      },\n\n      // set html lang attribute to fix accessibility\n      getHTMLLang: function (locale) {\n         //https://www.w3schools.com/tags/ref_language_codes.asp\n         if (locale === 'zh-CN'){\n            locale = 'zh-Hans';\n         }\n         if (locale === 'zh-TW'){\n            locale = 'zh-Hant';\n         }\n\n         return locale;\n      },\n\n      translate: function(msgid) {\n         let translatedStr,\n            i,\n            args = [];\n\n         // Skip the first parameter for it is the key.\n         for (i = 1; i < arguments.length; i++) {\n            args.push(arguments[i]);\n         }\n         /**\n          * If the translated msgid exists, return the translated string,\n          * else return the original string.\n          */\n         if (!!this.translatedTable && !!this.translatedTable[msgid]) {\n            /**\n             * The tool po2json used for converting po to json puts the\n             * translated string to an array and the translated result is\n             * in the second element.\n             */\n            translatedStr = this.translatedTable[msgid];\n         } else {\n            translatedStr = msgid;\n         }\n\n         if (args) {\n            // If args, replace placeholders with the args values passed.\n            if ($.isArray(args)) {\n               // Iterate & replace placeHolders matching number of input args.\n               for (i = 0; i < args.length; i++) {\n                  translatedStr = translatedStr.replace(\"{\" + i + \"}\", args[i]);\n               }\n            }\n            else {\n               // Replace the first place holder {0}\n               translatedStr = translatedStr.replace(\"{0}\", args);\n            }\n         }\n\n         return translatedStr;\n      },\n\n      /**\n       * For a given list of desired locales, determine which language\n       * out of our supported languages we should display.\n       */\n      getBestLocale: function(acceptLanguage) {\n         let matchedLocale = null,\n            matchedRank = 0,\n            accepted,\n            i,\n            kv,\n            parts,\n            thisRank,\n            localeAndRank;\n\n         if (!acceptLanguage) {\n            return null;\n         }\n\n         /**\n          * For each of the languages in the acceptLanguage param, see\n          * if getSupportedLocale likes it. If so, set the currently\n          * preferred language and its rank ('q=' value.) Do this for\n          * all languages.\n          */\n         accepted = acceptLanguage.split(',');\n         for (i = 0; i < accepted.length; i++) {\n            if (accepted[i].indexOf('*') >= 0) {\n               // Ignore the wildcard.\n               continue;\n            }\n\n            /*\n             * There may be a 'q=' section with a rank for this language.\n             * Set rank value to 1 by default.\n             */\n            thisRank = 1;\n            parts = $.trim(accepted[i]).split(';', 2);\n            if (parts.length === 2) {\n               kv = parts[1].split('=', 2);\n               if (kv[0] === 'q' && kv.length === 2) {\n                  thisRank = parseFloat(kv[1]);\n               }\n            } else if (parts.length < 1) {\n               continue;\n            }\n\n            /**\n             * If this locale entry is supported, compare its rank to the\n             * highest matched rank thus far.\n             */\n            localeAndRank = this.getSupportedLocale(parts[0], thisRank);\n            if (!!localeAndRank) {\n               if (localeAndRank[1] > matchedRank) {\n                  matchedLocale = localeAndRank[0];\n                  matchedRank = localeAndRank[1];\n               }\n            }\n         }\n\n         return matchedLocale;\n      },\n\n      /**\n       * For a given locale, determine the best supported localization\n       * fit for that language using the supportedLocale dictionary.\n       */\n      getSupportedLocale: function(locale, returnRank) {\n         let langCode,\n            selectedLocale,\n            specifiers;\n\n         // Convert to lower-case.\n         locale = locale.toLowerCase();\n\n         if (this.supportedLocale.hasOwnProperty(locale)) {\n            // The full locale is specifically supported.\n            selectedLocale = this.supportedLocale[locale];\n         } else {\n            specifiers = locale.split('-');\n            if (specifiers.length > 2) {\n               // Locale string like 'zh-hant' or 'zh-hant'.\n               langCode = specifiers[0] + '-' + specifiers[1];\n               if (this.supportedLocale.hasOwnProperty(langCode)) {\n                  // The language is zh-hans or zh-hant\n                  selectedLocale = this.supportedLocale[langCode];\n               }\n            }\n            if (!selectedLocale && specifiers.length > 0) {\n               // Locale string like 'en-us' or 'zh-tw'.\n               langCode = specifiers[0];\n               if (this.supportedLocale.hasOwnProperty(langCode)) {\n                  /**\n                   * The language is supported, but not in the desired\n                   * locale, the request is generic (xx instead of xx-YY)\n                   */\n                  selectedLocale = this.supportedLocale[langCode];\n               }\n            }\n         }\n\n         if (!!selectedLocale) {\n            return [selectedLocale, returnRank];\n         }\n\n         return null;\n      }\n   };\n\n   locale.setLocaleAndLoad(viewClientModel.acceptLanguage);\n\n   return locale;\n}\n\nexport function i18n(localize) {\n   return function(input) {\n      return localize.translate.apply(localize, arguments);\n   };\n}\n\nexport function translate(localize) {\n   return localize.translate.bind(localize);\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/localize-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function multiSiteService($window) {\n   /**\n    * In normal case, this function will redirect client to the new server.\n    * However, if the params are illegal, the function will return, and\n    * client continues the previous action.\n    *\n    * @param redirectProperties\n    */\n   this.redirectAndStartSession = function(redirectProperties) {\n      let serverAddress = redirectProperties['server-address'],\n         desktopName = redirectProperties['desktop-name'],\n         SAMLart = redirectProperties['saml-art'],\n         desktopProtocol = redirectProperties['desktop-protocol'];\n\n      if (!serverAddress || !desktopName || !SAMLart ||\n         desktopProtocol.toLowerCase() !== 'blast') {\n         // Shared module doesn't have logger\n         throw 'Redirect properties are not working for HTML Access!';\n      }\n\n      /**\n       * DaaS desktop URL format:\n       * https://ip or domain/appblast/webclient/index.html\n       * https://ip or domain/appblast/desktop/index.html\n       *\n       * We don't get desktop ID in this case, so we use desktop name.\n       */\n      $window.document.location.href =\n         'https://' + serverAddress + '/appblast/webclient/index.html?' +\n         'desktopName=' + encodeURIComponent(desktopName) + '&SAMLart=' +\n         encodeURIComponent(SAMLart) +\n         '&action=start-session';\n   };\n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/multisite-service.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport angular from 'angular';\n\nexport default function prefData() {\n   let data = {\n      favorites: [], //favorites is an array\n      isHighResolution: '',\n      useMacOSXKeyMappings: '',\n      enableWindowsKey: false,\n\n      reset: function() {\n         this.favorites = [];\n         this.isHighResolution = '';\n         this.useMacOSXKeyMappings = '';\n         this.enableWindowsKey = false;\n         this.timezoneSync = '';\n      },\n\n      equals: function(data) {\n         try {\n            if (this.favorites.sort().toString() ===\n               data.favorites.sort().toString() &&\n               this.isHighResolution === data.isHighResolution &&\n               this.useMacOSXKeyMappings === data.useMacOSXKeyMappings &&\n               this.enableWindowsKey === data.enableWindowsKey &&\n               this.timezoneSync === data.timezoneSync) {\n               return true;\n            } else {\n               return false;\n            }\n         } catch (e) {\n            return false;\n         }\n      },\n\n      toJSON: function() {\n         let r = {};\n\n         angular.forEach(this, function(value, index) {\n            if (typeof value !== 'function') {\n               if (index === 'favorites') {\n                  angular.forEach(value, function(value, index) {\n                     this['favorite' + index] = value;\n                  }, r);\n               } else {\n                  this[index] = value;\n               }\n            }\n         }, r);\n         return r;\n      }\n   };\n\n   return data;\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/prefdata.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * A temp service before the merge of blast into webClient.\n *\n * Only using session storage/storage.local here to improve the security.\n * And for storage.local, I add a clearup when closing the extension.(TODO)\n *\n * usage:\n * 1) include safeStorageService into dependency\n * 2) safeStorageService.setItem(itemName, item, privateKey) to storage info,\n *    item can be any type\n * 3) safeStorageService.getItem(itemName, asyncCallback, privateKey) to get\n *    stored info back, the retirved item will be identical to the one used\n *    to call setItem. and it will be presented in the async way as the\n *    parameter of asyncCallback.\n */\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\n\nexport default function safeStorageService($window) {\n   let itemOperators = {},\n      keyHeader = 'SSS_',\n      managedKeyPool = {},\n      enabled = false;\n\n   // Detect whether the browser supports sessionStorage.\n   function isSessionStorageAllowed() {\n      try {\n         $window.sessionStorage.setItem('testKey', true);\n         $window.sessionStorage.removeItem('testKey');\n         return true;\n      } catch (e) {\n         JSCDKLogger.error(\n            'This browser does not support sessionStorage. ' + e);\n         return false;\n      }\n   }\n\n   function init() {\n      // test typeof for chrome could be never declared\n      if (!!$window || !!$window.sessionStorage) {\n         if (!isSessionStorageAllowed()) {\n            JSCDKLogger.error('the session storage is not valid');\n            return;\n         }\n         itemOperators.setItem = function(key, value) {\n            $window.sessionStorage.setItem(key, value);\n         }; //do this to avoid illegal invocation\n         itemOperators.getItem = function(key, callback) {\n            callback($window.sessionStorage.getItem(key));\n         };\n         itemOperators.removeItem = null; //if needed, can be\n                                          // window.sessionStorage.removeItem;\n         enabled = true;\n         JSCDKLogger.debug(\n            'safeStorageService is configed for webClient');\n      } else {\n         JSCDKLogger.error('the safe storage can\\'t be inited properly');\n      }\n   }\n\n   init();\n\n   function encode(data, privateKey) {\n      return data; // refer the encryptor here\n   }\n\n   function decode(encodedData, privateKey) {\n      return encodedData; // refer the decryptor here\n   }\n\n   /**\n    * this function is to encode and store info into proper place\n    *\n    * @key:              string,\n    *     the name of the recorded item\n    * @value:            any stringfiable type,\n    *     the data that need to be stored\n    * #privateKeyString: any unempty string or null\n    *    the string that used to encode the data, the longer the better\n    *    but slower to decode. it could be token+sessionID.\n    */\n   this.setItem = function(key, value, privateKeyString) {\n      let encodedValue = encode(JSON.stringify(value), privateKeyString),\n         extendedkey = keyHeader + key;\n\n      if (!enabled) {\n         return false;\n      }\n      itemOperators.setItem(extendedkey, encodedValue);\n      managedKeyPool[extendedkey] = true;\n      return true;\n   };\n\n   /**\n    * this function is to get and decode info from proper place\n    *\n    * @key:              string,\n    *     the name of the target item\n    * @callback:         function,\n    *     the asyc callback function that use the readed data, the data\n    *    is\n    *     identical to the one stored in when calling setItem.\n    * #privateKeyString: any unempty string or null,\n    *     should be the same one used for encoding, and in future it can\n    *     specify which type of encoding is used or even pass in a\n    *    decoder.\n    */\n   this.getItem =\n      function(key, callback, privateKeyString, callbackParam) {\n         let extendedkey = keyHeader + key,\n            callbackWithDecodedData = function(data) {\n               let decodedData;\n\n               if (typeof(data) === 'string' || data === null) {\n                  decodedData = decode(data, privateKeyString);\n               } else if (typeof(data) === 'object') {\n                  decodedData =\n                     decode(data[extendedkey], privateKeyString);\n               } else {\n                  JSCDKLogger.debug(\n                     'error: the getItem retrive a unknown type of data, will not call back');\n                  return;\n               }\n\n               if (!!decodedData) {\n                  callback(JSON.parse(decodedData), callbackParam);\n               } else {\n                  callback(null, callbackParam);\n               }\n            };\n\n         if (!enabled) {\n            callback(null, callbackParam);\n            return;\n         }\n         itemOperators.getItem(extendedkey, callbackWithDecodedData);\n      };\n\n   /**\n    * a function to delete all managed items when closing chromeClient.\n    *\n    * currently dependen on the header-controller for its calling is in\n    * the function 'exitHorizonClient' there.\n    */\n   this.clearAllManagedItems = function() {\n      let key,\n         removeItemCallback = function() {\n            JSCDKLogger.debug('remove ' + key + 'from safe-storage');\n         };\n      for (key in managedKeyPool) {\n         if (managedKeyPool.hasOwnProperty(key) &&\n            !!itemOperators.removeItem) {\n            itemOperators.removeItem(key, removeItemCallback);\n         }\n      }\n      managedKeyPool = {};\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/safe-storage-service.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function storageService($window) {\n   this.cookie = {\n      // A delimiter thats not part of the userName / domainName.\n      COOKIE_VALUE_DELIMITER: '/',\n\n      // Cookie name to store userName value.\n      COOKIE_USER_NAME: 'UID',\n\n      // Cookie name to store tokenName value.\n      COOKIE_TOKEN_USER_NAME: 'TID',\n\n      // Cookie name to store domainName value.\n      COOKIE_DOMAIN_NAME: 'DID',\n\n      // Cookie name to store idle-timeout value.\n      COOKIE_IDLE_TIMEOUT: 'ITO',\n\n      // Cookie name to store user-activity-interval value.\n      COOKIE_SEND_TIME_INTERVAL: 'STI',\n\n      // Cookie name to store horizon ID value.\n      COOKIE_HORIZON_ID: 'HID',\n\n      /**\n       * Create a cookie of name/value pair, which is permanent.\n       *\n       * @param name    cookie name\n       * @param value   cookie value\n       * @param days    expiration days, optional\n       */\n      write: (name, value, days) => {\n         let expires = '',\n            date = new Date(),\n            data;\n\n         if (typeof days === 'number') {\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n            expires = '; expires=' + date.toGMTString();\n         }\n\n         data = encodeURIComponent(this.base64.encode(value));\n         $window.document.cookie =\n            name + '=' + data + expires + '; path=/; domain=' +\n            $window.location.host + '; secure';\n      },\n\n      /**\n       * Read a cookie of specified name\n       *\n       * @param name cookie name\n       * @return cookie value string\n       */\n      read: name => {\n         let cookies = $window.document.cookie.split(/;\\s*/),\n            i;\n\n         name += '=';\n         for (i = cookies.length - 1; i >= 0; i--) {\n            if (cookies[i].indexOf(name) === 0) {\n               return this.base64.decode(\n                  decodeURIComponent(cookies[i].replace(name, '')));\n            }\n         }\n\n         return '';\n      },\n\n      /**\n       * Delete a cookie of specified name\n       *\n       * @param name cookie name\n       */\n      clear: function(name) {\n         // Expire and remove the value.\n         $window.document.cookie =\n            name + '=; expires=Thu, 01-Jan-70 00:00:01 GMT;' +\n            '; path=/; domain=' + $window.location.host + '; secure';\n      },\n\n      /**\n       * Clear session cookies set by the client.\n       */\n      clearSessionCookies: function() {\n         this.clear(this.COOKIE_USER_NAME);\n         this.clear(this.COOKIE_TOKEN_USER_NAME);\n         this.clear(this.COOKIE_DOMAIN_NAME);\n         this.clear(this.COOKIE_IDLE_TIMEOUT);\n         this.clear(this.COOKIE_SEND_TIME_INTERVAL);\n         this.clear(this.COOKIE_HORIZON_ID);\n      },\n\n      /**\n       * isEnabled\n       *\n       *    Check whether the browser cookie is enabed\n       *\n       * @return true if the browser cookie is enabled; false otherwise.\n       */\n      isEnabled: function() {\n         let cookieEnabled = $window.navigator.cookieEnabled,\n            test;\n\n         if (typeof cookieEnabled === 'undefined') {\n            // Try to write a cookie which expires in 10 seconds.\n            test = 'test=' + new Date.getTime();\n            $window.document.cookie = test + '; max-age=10; domain='\n               + $window.location.host + '; secure';\n\n            // Check wether the cookie is set successfully.\n            if ($window.document.cookie.indexOf(test) > -1) {\n               cookieEnabled = true;\n            }\n         }\n\n         return cookieEnabled;\n      }\n   };\n\n   this.base64 = {\n      /* Convert data (an array of integers) to a Base64 string. */\n      toBase64Table: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',\n\n      /**\n       * function encode\n       *\n       *    Take an integer array and return a base64 encoded string.\n       *\n       * @param data Original string.\n       * @return A base64 encoded string.\n       */\n      encode: data => {\n         let o1, o2, o3, h1, h2, h3, h4, bits, r,\n            chrTable = this.base64.toBase64Table.split(''),\n            result = '',\n            i = 0,\n            ac = 0,\n            tmpArray = [];\n\n         if (!data) {\n            return data;\n         }\n\n         if (typeof $window.btoa === 'function') {\n            // Encode via browser's native Base64 encode function.\n            // Avoid Character Out Of Range exception when dealing with a\n            // Unicode string.\n            return $window.btoa(unescape(encodeURIComponent(data)));\n         }\n\n         data = this.utf8.encode(data);\n         do { // pack three octets into four hexets\n            o1 = data.charCodeAt(i++);\n            o2 = data.charCodeAt(i++);\n            o3 = data.charCodeAt(i++);\n\n            bits = o1 << 16 | o2 << 8 | o3;\n\n            h1 = bits >> 18 & 0x3f;\n            h2 = bits >> 12 & 0x3f;\n            h3 = bits >> 6 & 0x3f;\n            h4 = bits & 0x3f;\n\n            // use hexets to index into b64, and append result to encoded\n            // string.\n            tmpArray[ac++] =\n               chrTable[h1] + chrTable[h2] + chrTable[h3] + chrTable[h4];\n         } while (i < data.length);\n\n         result = tmpArray.join('');\n\n         r = data.length % 3;\n\n         return (r ? result.slice(0, r - 3) : result) +\n            '==='.slice(r || 3);\n      },\n\n      /**\n       * function decode\n       *\n       *    Decode a base64 encoded string to its original data.\n       *\n       * @param data A base64 encoded string.\n       * @return decoded data.\n       */\n      decode: data => {\n         let o1, o2, o3, h1, h2, h3, h4, bits,\n            b64 = this.base64.toBase64Table,\n            i = 0,\n            ac = 0,\n            result = '',\n            tmpArray = [];\n\n         if (!data) {\n            return data;\n         }\n\n         data += '';\n\n         if (typeof $window.atob === 'function') {\n            // Decode via browser's native Base64 decode function.\n            // Avoid Character Out Of Range exception when dealing with a\n            // Unicode string.\n            return decodeURIComponent(escape(window.atob(data)));\n         }\n\n         do {\n            h1 = b64.indexOf(data.charAt(i++));\n            h2 = b64.indexOf(data.charAt(i++));\n            h3 = b64.indexOf(data.charAt(i++));\n            h4 = b64.indexOf(data.charAt(i++));\n\n            bits = h1 << 18 | h2 << 12 | h3 << 6 | h4;\n\n            o1 = bits >> 16 & 0xff;\n            o2 = bits >> 8 & 0xff;\n            o3 = bits & 0xff;\n\n            if (h3 === 64) {\n               tmpArray[ac++] = String.fromCharCode(o1);\n            } else if (h4 === 64) {\n               tmpArray[ac++] = String.fromCharCode(o1, o2);\n            } else {\n               tmpArray[ac++] = String.fromCharCode(o1, o2, o3);\n            }\n         } while (i < data.length);\n\n         result = tmpArray.join('');\n\n         return this.utf8.decode(result);\n      }\n   };\n\n   this.utf8 = {\n      /*\n       * UTF-8 encoding\n       *\n       * @param string encode string\n       */\n      encode: function(string) {\n         let utftext = '',\n            i, c;\n\n         if (!string) {\n            return '';\n         }\n\n         string = string.replace(/\\r\\n/g, '\\n');\n         for (i = 0; i < string.length; i++) {\n            c = string.charCodeAt(i);\n\n            if (c < 128) {\n               utftext += String.fromCharCode(c);\n            } else if ((c > 127) && (c < 2048)) {\n               utftext += String.fromCharCode((c >> 6) | 192);\n               utftext += String.fromCharCode((c & 63) | 128);\n            } else {\n               utftext += String.fromCharCode((c >> 12) | 224);\n               utftext += String.fromCharCode(((c >> 6) & 63) | 128);\n               utftext += String.fromCharCode((c & 63) | 128);\n            }\n         }\n\n         return utftext;\n      },\n\n      /*\n       * UTF-8 decoding\n       *\n       * @param utftext decode string\n       */\n      decode: function(utftext) {\n         let string = '',\n            i = 0,\n            c, c2, c3;\n\n         if (!utftext) {\n            return '';\n         }\n\n         while (i < utftext.length) {\n            c = utftext.charCodeAt(i);\n\n            if (c < 128) {\n               string += String.fromCharCode(c);\n               i++;\n            } else if ((c > 191) && (c < 224)) {\n               c2 = utftext.charCodeAt(i + 1);\n               string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n               i += 2;\n            } else {\n               c2 = utftext.charCodeAt(i + 1);\n               c3 = utftext.charCodeAt(i + 2);\n               string += String.fromCharCode(\n                  ((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n               i += 3;\n            }\n         }\n\n         return string;\n      }\n   };\n\n   /**\n    * localStorage\n    *\n    *    Simulate localStorage with cookie fallback.\n    */\n   this.localStorage = (() => {\n      // All the keys are stored in the cookie named LOCAL_STORAGE_KEYS.\n      let LOCAL_STORAGE_COOKIE = this.base64.encode(\n         'LOCAL_STORAGE_COOKIE');\n      // In memory local storage data.\n      let storage = {\n         data: [],\n\n         // Stringify data delimited by ';'.\n         stringify: function() {\n            return storage.data.join(';');\n         },\n\n         // Add key=value pair into data.\n         add: function(key, value) {\n            key = encodeURIComponent(key);\n            value = encodeURIComponent(value);\n\n            storage.data.push(key + '=' + value);\n         },\n\n         // Remove item at specified index.\n         remove: function(index) {\n            if (index > -1 && index < storage.data.length) {\n               storage.data.splice(index, 1);\n            }\n         },\n\n         // Update key=value pair at specified index.\n         set: function(index, key, value) {\n            if (index > -1 && index < storage.data.length) {\n               key = encodeURIComponent(key);\n               value = encodeURIComponent(value);\n\n               storage.data[index] = key + '=' + value;\n            }\n         },\n\n         // Find the index of item with named key.\n         find: function(key) {\n            let i,\n               item,\n               regexp;\n\n            regexp = new RegExp('^' + encodeURIComponent(key) + '=');\n            for (i = 0; i < storage.data.length; i++) {\n               item = storage.data[i];\n               if (item.search(regexp) !== -1) {\n                  return i;\n               }\n            }\n\n            return -1;\n         },\n\n         // Return the key name of item at specified index.\n         getKey: function(index) {\n            if (index > -1 && index < storage.data.length) {\n               return decodeURIComponent(storage.data[index].split('=')[0]);\n            }\n\n            return '';\n         },\n\n         // Return the value of item at specified index.\n         getValue: function(index) {\n            if (index > -1 && index < storage.data.length) {\n               return decodeURIComponent(storage.data[index].split('=')[1]);\n            }\n\n            return '';\n         }\n      };\n\n      (() => {\n         let value = this.cookie.read(LOCAL_STORAGE_COOKIE);\n\n         if (value !== '') {\n            // Read localStorage from cookie add store it into storage.\n            storage.data = value.split(';');\n         }\n      })();\n\n      return {\n         /**\n          * identifier\n          *\n          *    The cookie key name of local storage data.\n          */\n         identifier: LOCAL_STORAGE_COOKIE,\n\n         /**\n          * length\n          *\n          *    Length of local storage.\n          */\n         length: storage.data.length,\n\n         /**\n          * getItem\n          *\n          *    Retrieves the data of the key from the cookie.\n          *\n          * @param key name\n          * @return data\n          */\n         getItem: function(key) {\n            let index = storage.find(key);\n\n            if (index > -1) {\n               return storage.getValue(index);\n            }\n\n            return '';\n         },\n\n         /**\n          * setItem\n          *\n          *    Add a key/value pair or update it in the cookie.\n          *    The expiration time is 30 days.\n          *\n          * @param key name\n          * @param value data\n          */\n         setItem: (key, value) => {\n            let index = storage.find(key);\n            if (index < 0) {\n               // Add 'key=value' pair into storage.\n               storage.add(key, value);\n               this.localStorage.length++;\n            } else {\n               // Update 'key=value' pair.\n               storage.set(index, key, value);\n            }\n            // Store updated localStorage data into cookie.\n            this.cookie.write(LOCAL_STORAGE_COOKIE, storage.stringify(),\n               30);\n         },\n\n         /**\n          * removeItem\n          *\n          *    Remove the key from the cookie.\n          *\n          * @param key name\n          */\n         removeItem: (key) => {\n            let index = storage.find(key);\n\n            if (index > -1) {\n               // Remove item from storage.\n               storage.remove(index);\n               this.localStorage.length--;\n\n               if (storage.data.length > 0) {\n                  // Write updated localStorage data into cookie.\n                  this.cookie.write(LOCAL_STORAGE_COOKIE,\n                     storage.stringify(), 30);\n               } else {\n                  this.cookie.clear(LOCAL_STORAGE_COOKIE);\n               }\n            }\n         },\n\n         /**\n          * key\n          *\n          *    Return the name of the nth key.\n          *\n          * @param key An integer representing the number of the key.\n          * @return the name of the nth key.\n          */\n         key: function(key) {\n            return storage.getKey(key);\n         },\n\n         /**\n          * clear\n          *\n          *    Empty all keys from the cookie.\n          */\n         clear: () => {\n            storage.data = [];\n            this.localStorage.length = 0;\n            this.cookie.clear(LOCAL_STORAGE_COOKIE);\n         }\n      };\n   })();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/storage-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport angular from 'angular';\nimport toastr from 'toastr';\n\nexport default function toastService() {\n\n   this.TOAST_TYPE = {\n      DEFAULT: 0,\n      PREDEFINED: 1,\n      FT: 2,\n      PRINT: 3\n   };\n\n   this.LEVEL = {\n      INFO: 'info',\n      SUCCESS: 'success',\n      WARNING: 'warning',\n      ERROR: 'error'\n   };\n\n   this.COMMON_OPTIONS = {\n      \"closeButton\": false,\n      \"debug\": false,\n      \"newestOnTop\": false,\n      \"progressBar\": false,\n      \"positionClass\": \"toast-top-center\",\n      \"preventDuplicates\": false,\n      \"onclick\": null,\n      \"showDuration\": \"300\",\n      \"hideDuration\": \"1000\",\n      \"timeOut\": \"5000\",\n      \"extendedTimeOut\": \"1000\",\n      \"showEasing\": \"swing\",\n      \"hideEasing\": \"linear\",\n      \"showMethod\": \"fadeIn\",\n      \"hideMethod\": \"fadeOut\"\n   };\n   this.DEFAULT_OPTIONS = {};\n   this.PRINT_OPTIONS = {};\n   this.FT_OPTIONS = {};\n   angular.copy(this.COMMON_OPTIONS, this.DEFAULT_OPTIONS);\n   angular.copy(this.COMMON_OPTIONS, this.PRINT_OPTIONS);\n   angular.copy(this.COMMON_OPTIONS, this.FT_OPTIONS);\n   this.PRINT_OPTIONS.timeOut = \"0\";\n   this._currentToast = null;\n   this._toastArray = [];\n\n   toastr.options = this.DEFAULT_OPTIONS;\n\n   this.setOptions = function(options) {\n      if (!options) {\n         return;\n      }\n      toastr.options = options;\n   };\n\n   this._showToast = function(level, text, type) {\n      if (!text) {\n         return;\n      }\n\n      if (level !== this.LEVEL.INFO && level !== this.LEVEL.ERROR &&\n         level !== this.LEVEL.WARNING && level !== this.LEVEL.SUCCESS) {\n         throw 'Error level type is used';\n      }\n\n      if (!type) {\n         type = this.TOAST_TYPE.DEFAULT;\n      }\n\n      let optionCache = toastr.options;\n      switch (type) {\n         case this.TOAST_TYPE.DEFAULT: {\n            toastr.options = this.DEFAULT_OPTIONS;\n            this._currentToast = toastr[level](text);\n            break;\n         }\n         case this.TOAST_TYPE.PREDEFINED: {\n            this._currentToast = toastr[level](text);\n            break;\n         }\n         case this.TOAST_TYPE.FT: {\n            toastr.options = this.FT_OPTIONS;\n            this._currentToast = toastr[level](text);\n            toastr.options = optionCache;\n            break;\n         }\n         case this.TOAST_TYPE.PRINT: {\n            toastr.options = this.PRINT_OPTIONS;\n            this._currentToast = toastr[level](text);\n            toastr.options = optionCache;\n            break;\n         }\n         default: {\n            throw 'Error msg type is used.';\n         }\n      }\n      this._toastArray.push({\n         toast: this._currentToast,\n         type: type\n      });\n   };\n\n   this.success = function(text, type) {\n      this._showToast(this.LEVEL.SUCCESS, text, type);\n   };\n\n   this.warning = function(text, type) {\n      this._showToast(this.LEVEL.WARNING, text, type);\n   };\n\n   this.error = function(text, type) {\n      this._showToast(this.LEVEL.ERROR, text, type);\n   };\n\n   this.info = function(text, type) {\n      this._showToast(this.LEVEL.INFO, text, type);\n   };\n\n   this.clearCurrentToast = function() {\n      if (!!this._currentToast) {\n         toastr.clear(this._currentToast);\n      }\n   };\n\n   this.clearEarlyToast = function(type) {\n      if (this._toastArray.length < 1) {\n         return;\n      }\n\n      if (!type) {\n         type = this.TOAST_TYPE.DEFAULT;\n      }\n\n      let i = 0;\n      while (i < this._toastArray.length) {\n         if (this._toastArray[i].type === type) {\n            toastr.clear(this._toastArray[i].toast);\n            this._toastArray.splice(i, 1);\n            continue;\n         }\n         i++;\n      }\n   };\n\n   this.clearAll = function() {\n      toastr.clear();\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/toast-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function URIParamValidator(usernameUtil) {\n\n   this.isValid = function(URIParams) {\n      if (!URIParams) {\n         // If there is no URI params, that is valid as well\n         return true;\n      }\n\n      // userName=test@domain1&domainName=domain2\n      if (usernameUtil.domainInUsername(URIParams.userName) &&\n         !!URIParams.domainName) {\n         let domain = usernameUtil.getDomain(URIParams.userName);\n         if (domain.toLowerCase() !== URIParams.domainName.toLowerCase()) {\n            return false;\n         }\n      }\n\n      // TODO more params check here\n\n      return true;\n   };\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/uri-param-validator.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport angular from 'angular';\nimport {globalArray} from '../../jscdk/jscdkClient';\n\nexport default function userGlobalPref($log, $rootScope, $window, prefData) {\n\n   this.initialized = false;\n   this.dirty = false;\n\n   let commandName = 'SetUserGlobalPref';\n\n   if (!!$window.addEventListener) {\n      $window.addEventListener('beforeunload', () => {\n         this.postPrefData();\n         this.clearPrefData();\n      });\n   }\n\n   this.postPrefData = function() {\n      if (this.readyToSend()) {\n         let uiController = globalArray['uiController'];\n         if (!!uiController) {\n            uiController.invokeJSCDK({\n               method: commandName,\n               prefData: prefData.toJSON(),\n               async: false,\n               timeout: 2000\n            });\n         }\n      }\n   };\n\n   this.clearPrefData = function() {\n      prefData.reset();\n      this.dirty = false;\n   };\n\n   this.onDataSent = function() {\n      this.dirty = false;\n   };\n\n   this.readyToSend = function() {\n      return this.initialized && this.dirty;\n   };\n\n   this.setPrefData = function(data) {\n      JSON.parse(JSON.stringify(data));\n      $log.info('Received data: ' + JSON.stringify(data));\n\n      prefData.favorites = data.favorites;\n\n      /**\n       * High resolution mode is always true\n       */\n      prefData.enableWindowsKey = data.enableWindowsKey;\n      prefData.enableMP4 = data.enableMP4;\n      prefData.useMacOSXKeyMappings = data.useMacOSXKeyMappings;\n      prefData.timezoneSync = data.timezoneSync;\n      /**\n       * Refer to getDPI function in dpi-service.\n       * When the value is 'true', it doesn't do dpi sync actually...\n       */\n      prefData.enableDPISync = typeof data.enableDPISync ===\n      'undefined' ? 'false' : data.enableDPISync;\n      prefData.isHighResolution = prefData.enableDPISync;\n\n      this.initialized = true;\n      // Dispatch event of name 'prefDataInit'.\n      $rootScope.$emit('prefDataInit');\n\n      $log.info('Preference data set: ' + JSON.stringify(prefData));\n   };\n\n   this.getPrefData = function() {\n      return angular.copy(prefData, {});\n   };\n\n   /**\n    https://wiki.eng.vmware.com/VDM/ClientBrokerXml#GetUserGlobalPreferences\n    data: {name, text, action}\n    */\n   this.updatePrefData = function(data) {\n      let favArray, s;\n\n      switch (data.action) {\n         case 'FavOff':\n            favArray = prefData.favorites;\n            angular.forEach(favArray, function(value, index) {\n               if (value === data.text) {\n                  favArray.splice(index, 1);\n               }\n            });\n            break;\n         case 'FavOn':\n            prefData.favorites.push(data.text);\n            break;\n         case 'isHighResolution':\n         case 'useMacOSXKeyMappings':\n         case 'enableWindowsKey':\n         case 'enableMP4':\n         case 'timezoneSync':\n         case 'enableDPISync':\n            prefData[data.action] = data.text;\n            break;\n         default:\n            $log.info(\n               'Action \\'' + data.action + '\\' is not supported yet.');\n      }\n\n      this.dirty = true;\n      s = JSON.stringify(prefData);\n      $log.info('Preference data updated: ' + s);\n   };\n\n   this.toFlatFormat = function() {\n      return prefData.toJSON();\n   };\n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/userglbpref.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * username-util.js\n *\n * Service for username related code.\n *\n * Three login username formats here:\n * 1. username        (broker supported)\n * 2. username@domain (broker supported)\n * 3. domain\\username (broker not supported)\n *\n */\n\n\nexport default function usernameUtil() {\n\n   this.isDomainUsername = function(username) {\n      if (!username) {\n         return false;\n      }\n      return username.indexOf('\\\\') !== -1 &&\n         username.indexOf('@') === -1;\n   };\n\n   this.isUPN = function(username) {\n      if (!username) {\n         return false;\n      }\n      return username.indexOf('@') !== -1 &&\n         username.indexOf('\\\\') === -1;\n   };\n\n   this.domainInUsername = function(username) {\n      if (!username) {\n         return false;\n      }\n\n      return this.isUPN(username) || this.isDomainUsername(username);\n   };\n\n   this.getUsernameFromDomainUsername = function(username) {\n      if (!this.isDomainUsername(username)) {\n         throw 'Not an illegal domain username!';\n      }\n\n      let backslash = username.indexOf('\\\\');\n      return username.substr(backslash + 1);\n   };\n\n   this.getDomainFromDomainUsername = function(username) {\n      if (!this.isDomainUsername(username)) {\n         throw 'Not an illegal domain username!';\n      }\n\n      let backslash = username.indexOf('\\\\');\n      return username.substr(0, backslash);\n   };\n\n   this.getUsernameFromUPN = function(username) {\n      if (!this.isUPN(username)) {\n         throw 'Not an illegal UPN!';\n      }\n\n      let at = username.indexOf('@');\n      return username.substr(0, at);\n   };\n\n   this.getDomainFromUPN = function(username) {\n      if (!this.isUPN(username)) {\n         throw 'Not an illegal UPN!';\n      }\n\n      let at = username.indexOf('@');\n      return username.substr(at + 1);\n   };\n\n   this.getUsername = function(username) {\n      if (!this.domainInUsername(username)) {\n         return username;\n      }\n\n      if (this.isUPN(username)) {\n         return this.getUsernameFromUPN(username);\n      } else if (this.isDomainUsername(username)) {\n         return this.getUsernameFromDomainUsername(username);\n      }\n\n      throw 'Cannot get legal username!';\n   };\n\n   this.getDomain = function(username) {\n      if (!this.domainInUsername(username)) {\n         return '';\n      }\n\n      if (this.isUPN(username)) {\n         return this.getDomainFromUPN(username);\n      } else if (this.isDomainUsername(username)) {\n         return this.getDomainFromDomainUsername(username);\n      }\n\n      throw 'Cannot get legal domain!';\n   };\n\n   this.isUsernameLegal = function(username) {\n      return !(username.indexOf('\\\\') !== -1 &&\n      username.indexOf('@') !== -1);\n   };\n\n   this.isDomainLegal = function(domain) {\n      // Only check if domain is empty now\n      return !!domain;\n   };\n\n   this.isDomainInDomainList = function(domain, domains) {\n      if (!domain || !domains || domains.length <= 0) {\n         throw 'Domain or domain list cannot be null!';\n      }\n\n      for (let i = 0; i < domains.length; i++) {\n         if (domain.toLowerCase() === domains[i].toLowerCase()) {\n            return true;\n         }\n      }\n      return false;\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/username-util.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * ws1-service.js\n *\n * Service for Workspace one integration\n */\n\nimport util from '../../jscdk/util';\n\nexport default function ws1Service(constants, brokerSessionStorageService,\n                                   connectionURIModel) {\n\n   /**\n    * Service provider ID.\n    * vIDM/WS1 passes the value when it launches client.\n    * Refer to\n    * https://confluence.eng.vmware.com/display/WOR/Horizon+Client+SP+Init+Flow+a.k.a+Fix+Access+Policy+support+in+Horizon\n    */\n   this.spID = brokerSessionStorageService.read(constants.SP_ID_FOR_WS1_KEY);\n\n   /**\n    *  TODO: This function should replace connectionURIModel.isHWSession()\n    *  and messageHandlerService.isFromHWS()\n    *  I will do this work in next patch.\n    */\n   this.isWS1Mode = function() {\n      return util.isWS1Mode();\n   };\n\n   this.getWS1Hostname = function() {\n      return util.getWS1Hostname();\n   };\n\n   /**\n    * Refer to\n    * https://confluence.eng.vmware.com/display/WOR/Horizon+Client+SP+Init+Flow+a.k.a+Fix+Access+Policy+support+in+Horizon\n    */\n   this.redirectToWS1 = function(ws1ServerName, windowObject) {\n      ws1ServerName = ws1ServerName.toLowerCase();\n      if (ws1ServerName.indexOf('https://') !== 0) {\n         ws1ServerName = 'https://' + ws1ServerName;\n      }\n\n      let serverAddress = ws1ServerName;\n\n      let appName;\n      if (!!connectionURIModel.params &&\n         !!connectionURIModel.params.applicationId) {\n         appName = connectionURIModel.params.applicationId;\n      } else if (!!connectionURIModel.params &&\n         !!connectionURIModel.params.desktopId) {\n         appName = connectionURIModel.params.desktopId;\n      }\n\n      // If there is no app to launch, just handle off to ws1 server\n      if (!appName) {\n         windowObject.location.href = serverAddress;\n         return;\n      }\n\n      const serverAPI = '/SAAS/API/1.0/GET/apps/launch/sp-init/';\n      const spURLParam = 'spURL=' + windowObject.location.host;\n\n      // Append app name\n      serverAddress += serverAPI + encodeURIComponent(appName);\n\n      // Append spURL\n      serverAddress += '?' + spURLParam;\n\n      // Append spID\n      if (!!this.spID) {\n         serverAddress += '&spID=' + this.spID;\n      }\n\n      /**\n       * Append relayInfo\n       * Server side decode is placed in:\n       * com.vmware.vdi.installer.ui.filters.RelayInfoFilter\n       */\n      let relayInfo = connectionURIModel.generateRelayInfo();\n      if (!!relayInfo) {\n         serverAddress += '&' + relayInfo;\n      }\n\n      // Tell vIDM we need launch html access client rather than native client\n      serverAddress += '&clientType=BROWSER';\n\n      windowObject.location.href = serverAddress;\n   };\n\n   this.storeSpId = function(spID) {\n      if (!spID) {\n         return;\n      }\n\n      brokerSessionStorageService.write(constants.SP_ID_FOR_WS1_KEY, spID);\n      this.spID = spID;\n   };\n\n   this.isLaunchedFromWS1 = function() {\n      /**\n       * If we have SAMLart and horizonId in URI, then we say it is launched\n       * from WS1\n       */\n      return (!!connectionURIModel.params && !!connectionURIModel.params.samlArt &&\n         !!connectionURIModel.params.horizonId);\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/service/ws1-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport timezoneListTemplate from './time-zone-list.html';\n\n\nexport function timezoneListDirective() {\n   return {\n      replace: true,\n      restrict: 'E',\n      templateUrl: timezoneListTemplate\n   };\n}\n\nexport function timezone($window, $log, prefData) {\n   return {\n      /*\n       * https://wiki.eng.vmware.com/VDM/ClientBrokerXml#\n       * TimeOffset_GMT : -07:00\n       * TZID : Europe/London\n       * Windows_Timezone: GMT Standard Time\n       */\n      timeZoneMap: {\n         \"-12:00\": \"Etc/GMT-12\",\n         \"-11:00\": \"Etc/GMT-11\",\n         \"-10:00\": \"Pacific/Honolulu\",\n         \"-09:30\": \"Pacific/Marquesas\",\n         \"-09:00\": \"America/Anchorage\",\n         \"-08:00\": \"America/Los_Angeles\",\n         \"-07:00\": \"America/Denver\",\n         \"-06:00\": \"America/Chicago\",\n         \"-05:00\": \"America/New_York\",\n         \"-04:00\": \"America/Asuncion\",\n         \"-03:30\": \"America/St_Johns\",\n         \"-03:00\": \"America/Sao_Paulo\",\n         \"-02:00\": \"America/Noronha\",\n         \"-01:00\": \"Atlantic/Azores\",\n         \"-00:00\": \"Europe/London\",\n         \"+01:00\": \"Europe/Budapest\",\n         \"+02:00\": \"Europe/Kiev\",\n         \"+03:00\": \"Europe/Moscow\",\n         \"+03:30\": \"Asia/Tehran\",\n         \"+04:00\": \"Asia/Dubai\",\n         \"+04:30\": \"Asia/Kabul\",\n         \"+05:00\": \"Asia/Tashkent\",\n         \"+05:30\": \"Asia/Calcutta\",\n         \"+05:45\": \"Asia/Katmandu\",\n         \"+06:00\": \"Asia/Almaty\",\n         \"+06:30\": \"Asia/Rangoon\",\n         \"+07:00\": \"Asia/Bangkok\",\n         \"+08:00\": \"Asia/Shanghai\",\n         \"+08:30\": \"Asia/Pyongyang\",\n         \"+08:45\": \"Australia/Eucla\",\n         \"+09:00\": \"Asia/Tokyo\",\n         \"+09:30\": \"Australia/Darwin\",\n         \"+10:00\": \"Australia/Sydney\",\n         \"+10:30\": \"Australia/Lord_Howe\",\n         \"+11:00\": \"Etc/GMT+11\",\n         \"+12:00\": \"Pacific/Fiji\",\n         \"+12:45\": \"Pacific/Chatham\",\n         \"+13:00\": \"Tonga\",\n         \"+14:00\": \"Pacific/Honolulu\"\n      },\n\n      isDaylightSaving: function() {\n         Date.prototype.stdTimezoneOffset = function() {\n            let jan = new Date(this.getFullYear(), 0, 1);\n            let jul = new Date(this.getFullYear(), 6, 1);\n            return Math.max(jan.getTimezoneOffset(),\n               jul.getTimezoneOffset());\n         };\n\n         Date.prototype.dst = function() {\n            return this.getTimezoneOffset() < this.stdTimezoneOffset();\n         };\n\n         let today = new Date();\n         return !!today.dst();\n      },\n\n      getTimezoneOffsetData: function() {\n         let offset, r, h;\n         offset = new $window.Date().getTimezoneOffset();\n\n         if (this.isDaylightSaving()) {\n            offset = offset + 60;\n         }\n\n         r = offset < 0 ? '+' : '-';\n         offset = offset < 0 ? (0 - offset) : offset;\n\n         offset = String(offset / 60).split('.');\n         h = offset[0].length > 1 ? offset[0] : '0' + offset[0];\n         r += h;\n         r += \":\";\n\n         r += offset.length > 1 ? '30' : '00';\n\n         /**\n          * As we want to keep remote desktop time the same with local,\n          * so  don't consider daylight saving now. Bug 1730455\n          */\n         $log.info(\"Timezone offset: \" + r);\n         return r;\n      },\n\n      getWindowsTimezone: function() {\n         if (!prefData.timezoneSync) {\n            let timezoneOffset = this.getTimezoneOffsetData();\n            let WindowsTimezone = this.timeZoneMap[timezoneOffset];\n            $log.info(\"Auto get Timezone data: \" + WindowsTimezone);\n            return WindowsTimezone;\n         } else {\n            $log.info(\n               \"Prefer timezone user preference: \" + prefData.timezoneSync);\n            return prefData.timezoneSync;\n         }\n      }\n\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./common/timezone/timezone.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * commonSvcService.js --\n *\n * The service to communicate with server in main channel\n *\n * Server code: bfg-main\n *    depot/bora/bfg-main/apps/rde/rdeSvc/server/commonSvc.cpp\n *    depot/bora/bfg-main/apps/rde/rdeSvc/server/commonSvc.h\n *    depot/bora/bfg-main/apps/rde/rdeSvc/shared/commonSvc_defines.h\n *\n * Once the connection established, server pushes the DPI message version.\n * After that, the communication protocol would follow\n *   https://wiki.eng.vmware.com/EUCBU/CART/DpiSync#Relationship_between_DPI_Sync_feature_and_.22Enable_display_scaling.22_feature\n *\n *\n */\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport VDPService from './vdpservice';\n\n\nexport default function commonSvcService(AB, wmksServiceEventHandler,\n                                         dpiService,\n                                         userGlobalPref, constants) {\n   let comSvcMgrMap = {},\n      Mgr,\n      COMMON_SVC = {\n         DPI_SYNC_VERSION: 1,\n\n         // bora/apps/rde/rdeSvc/shared/commonSvc_defines.h\n         MSG_TYPE: {\n            CLIENT_COMMON_PLUGIN_MSG: 0,\n            ENVIRONMENT_VAR_INFO_MSG: 1,\n            DPI_SYNC_MSG: 2\n         },\n\n         DPI_SYNC_COMMAND_TYPE: {\n            DPI_SYNC_COMMAND_NONE: 0,\n            DPI_SYNC_COMMAND_VERSION: 1,\n            DPI_SYNC_COMMAND_DPI: 2\n         }\n      },\n      logger = {\n         info: function(msg) {\n            JSCDKLogger.info('[commonSvcService] ' + msg);\n         },\n         error: function(msg) {\n            JSCDKLogger.error('[commonSvcService] ' + msg);\n         },\n         debug: function(msg) {\n            JSCDKLogger.debug('[commonSvcService] ' + msg);\n         }\n      },\n      wmksService = null,\n      // object name, see,\n      // depot/bora/bfg-main/apps/rde/rdeSvc/shared/commonSvc_defines.h\n      commonSvcObject = 'CommonSvcObject';\n\n   Mgr = function(vdpService, wmksKey, mainChannel) {\n      let self = this,\n         remoteDPI = null,\n         inited = false,\n         vdpServiceMainChannel = mainChannel;\n\n      this.wmksKey = wmksKey;\n      mainChannel.addMessageHandler(this);\n\n      /**\n       * send client dpi to server\n       * @param dpi\n       * @param {Function} [onDone]\n       *    Called when the rpc has completed.\n       * @param {Function} [onAbort]\n       *    Called if the rpc has aborted.\n       * @return {Boolean} success\n       *    Returns true on success, false on failure\n       */\n      function sendRPC(dpi, onDone, onAbort) {\n         let packet = WMKS.Packet.createNewPacketLE();\n\n         packet.writeUint32(\n            COMMON_SVC.DPI_SYNC_COMMAND_TYPE.DPI_SYNC_COMMAND_VERSION);\n         packet.writeUint32(dpi);\n\n         if (0 === vdpServiceMainChannel.invoke({\n               command: COMMON_SVC.MSG_TYPE.DPI_SYNC_MSG,\n               type: VDPService.RPC_TYPE.REQUEST,\n               params: [0, 0, packet.getData()],\n               onDone: onDone,\n               onAbort: onAbort,\n               objName: commonSvcObject\n            })) {\n            logger.error('Failed to send DPI message.');\n            return false;\n         }\n\n         return true;\n      }\n\n      /**\n       * handleRPCFromServer\n       *\n       * Helper function used to parse the RPC data that we\n       * receive from a server.\n       *\n       * @param rpc      RPC object that was posted by VDPService.\n       */\n      this.handleRPCFromServer = function(rpc) {\n         let packet,\n            commandType,\n            version;\n\n         if (rpc.command === COMMON_SVC.MSG_TYPE.DPI_SYNC_MSG) {\n            packet = WMKS.Packet.createFromBufferLE(rpc.params[2]);\n            if (packet != null) {\n               commandType = packet.readUint32();\n               if (commandType ===\n                  COMMON_SVC.DPI_SYNC_COMMAND_TYPE.DPI_SYNC_COMMAND_VERSION) {\n                  version = packet.readUint32();\n                  logger.info('Remote DPI version is: ' + version);\n                  sendRPC(dpiService.getDPI());\n               } else if (commandType ===\n                  COMMON_SVC.DPI_SYNC_COMMAND_TYPE.DPI_SYNC_COMMAND_DPI) {\n                  remoteDPI = packet.readUint32();\n                  inited = true;\n                  logger.info('Remote Desktop DPI : ' + remoteDPI);\n\n                  self.displayScale();\n               } else {\n                  logger.error('Invalid command type: ' + commandType);\n               }\n            }\n            return 0;\n         } else {\n            return 1;\n         }\n      };\n\n      /**\n       * Compasate for Agent DPI scale\n       */\n      this.displayScale = function() {\n         let scale,\n            wmksSession,\n            enabled =\n               (userGlobalPref.getPrefData().enableDPISync === 'true');\n\n         wmksSession = wmksService.getWmksSession(this.wmksKey);\n         wmksSession.setRemoteDPI(remoteDPI);\n         scale = this.getRemoteDPI();\n         wmksSession.wmks('option', 'displayScale', scale);\n\n         /**\n          * Workaround for bug 1852996 to avoid agent recieve request in a too\n          * short time, 3000ms is a tested value to by pass this bug.\n          */\n         setTimeout(function(){\n            logger.info(\"adjust display for remote scale as \" + scale);\n            wmksSession.updateResolution(\n               AB.UTIL.getDesiredResolution(), true);\n         }, 3000);\n      };\n\n      this.getRemoteDPI = function() {\n         if (!remoteDPI) {\n            return 1.0;\n         }\n         return parseFloat(remoteDPI) / parseFloat(constants.DPI_100_PERCENT);\n      };\n\n      this.isInited = function() {\n         return inited;\n      };\n   };\n\n   function onWmksSessionConnecting(wmksKey, isApplicationSession,\n                                    vdpService, mainChannel) {\n      let mgr = new Mgr(vdpService, wmksKey, mainChannel);\n      comSvcMgrMap[wmksKey] = mgr;\n   }\n\n   function onWmksSessionConnected(wmksKey) {\n      logger.info('In onWmksSessionConnected');\n   }\n\n   function onWmksSessionDisconnected(wmksKey) {\n      destroyComSvcMgr(wmksKey);\n   }\n\n   function onWmksSessionRemoved(wmksKey) {\n      destroyComSvcMgr(wmksKey);\n   }\n\n   function destroyComSvcMgr(wmksKey) {\n      let mgr = comSvcMgrMap[wmksKey];\n      if (!mgr) {\n         return;\n      }\n\n      delete comSvcMgrMap[wmksKey];\n      mgr = null;\n      logger.info('CommonSvc Manager Object Destroyed.  wmksKey: ' +\n         wmksKey);\n   }\n\n   function init(wmksServiceInstance) {\n      wmksService = wmksServiceInstance;\n      wmksServiceEventHandler.addEventListener('sessionConnecting',\n         onWmksSessionConnecting);\n      wmksServiceEventHandler.addEventListener('sessionConnected',\n         onWmksSessionConnected);\n      wmksServiceEventHandler.addEventListener('sessionDisconnected',\n         onWmksSessionDisconnected);\n      wmksServiceEventHandler.addEventListener('sessionRemoved',\n         onWmksSessionRemoved);\n\n      wmksServiceEventHandler.listenerReadyForModule(\n         wmksServiceEventHandler.MODULE_NAME.COMMON_SVC_SERVICE);\n\n   }\n\n   return {\n      getCommonSvcMgr: function(wmksKey) {\n         return comSvcMgrMap[wmksKey];\n      },\n\n      init: init,\n\n      /**\n       * @return {boolean} This returns whether remote DPI is 100%\n       */\n      isInitedForSession: function(wmksKey) {\n         if (!comSvcMgrMap || !comSvcMgrMap.hasOwnProperty(wmksKey)) {\n            return false;\n         }\n         return comSvcMgrMap[wmksKey].isInited();\n      },\n      /**\n       * @return {number} This returns the remote DPI in ratio, absent\n       *    value as 1.0\n       */\n      getRemoteDPI: function(wmksKey) {\n         if (!comSvcMgrMap || !comSvcMgrMap.hasOwnProperty(wmksKey)) {\n            return 1.0;\n         }\n         return comSvcMgrMap[wmksKey].getRemoteDPI();\n      },\n      COMMON_SVC: COMMON_SVC,\n      commonSvcObject: commonSvcObject\n   };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/channels/commonSvc-service.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\nexport default function mainChannelService() {\n   let vdpServiceMainChannelNamePrefix = 'RPC#VMwareRde#';\n\n   function ChannelObj(vdpService) {\n      // currently, main channel has 2 object names\n      this.desiredObjectNames = ['UnitySvcObject', 'CommonSvcObject'];\n\n      this.vdpService = vdpService;\n\n      this.msgHandlers = [];\n\n      this.vdpServiceMainChannel = null;\n   }\n\n   ChannelObj.prototype.init = function() {\n      let self = this;\n\n      this.vdpService.addChannelCreatedListener(function(channel) {\n         if (channel.name.indexOf(vdpServiceMainChannelNamePrefix) ===\n            0) {\n            if (self.vdpService.connectChannel(channel,\n                  self.desiredObjectNames)) {\n               JSCDKLogger.debug(\n                  'Successfully accepted main channel');\n            } else {\n               JSCDKLogger.error('Failed to open Unity main channel');\n               return;\n            }\n\n            self.vdpServiceMainChannel = channel;\n\n            channel.onReady = function() {\n               JSCDKLogger.debug(\n                  'Main channel is ready for traffic.');\n            };\n\n            channel.onDisconnect = function() {\n               self.vdpServiceMainChannel = null;\n               JSCDKLogger.debug(\n                  'Main channel was closed by the remote desktop.');\n            };\n\n            channel.onInvoke = function(rpc) {\n         console.error(\"main!!!!!!!!!!!\",rpc);\n               self.handleRPCFromServer(rpc);\n            };\n         }\n      });\n\n      ChannelObj.prototype.handleRPCFromServer = function(rpc) {\n         let i, ret;\n\n         for (i = 0; i < this.msgHandlers.length; i++) {\n            ret = this.msgHandlers[i].handleRPCFromServer(rpc);\n            if (ret === 0) { // means the message has been consumed\n               break;\n            }\n         }\n      };\n\n      ChannelObj.prototype.addMessageHandler = function(handler) {\n         this.msgHandlers.push(handler);\n      };\n\n      ChannelObj.prototype.invoke = function(param) {\n         return this.vdpServiceMainChannel.invoke(param);\n      };\n   };\n\n   return {\n      getChannel: function(vdpService) {\n         return new ChannelObj(vdpService);\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/channels/rde-main-channel.js","import JSCDKLogger from '../../jscdk/jscdkLogger';\nlet FOLDER_REDIRECTION_CMD = \"FORLDER_REDIRECTION_CMD\";\nlet FOLDER_REDIRECTION_NOTIFICATION = \"FOLDER_REDIRECTION_NOTIFICATION\";\nlet RDPDR_POLICY = {\n   TSDR_RDPDR_HEADER_SIZE: 4,\n   TSDR_POLICY_HEADER_SIZE: 8,\n   TSDR_GLOBAL_POLICY_SIZE: 8,\n   TSDR_FOLDER_POLICY_SIZE: 8,\n\n   TSDR_DEVID_AC_SHIFT: 24,\n   TSDR_DEVID_AC_MASK: 0xFFFFFF,\n   // Some defailts in https://wiki.eng.vmware.com/EUCBU/CART/FolderRedirection/Readonly\n   TSDR_FOLDER_PERMISSION: {\n      TSDR_PERM_UNKNOWN: 0, // Cannot be determined\n      TSDR_PERM_OPEN_READ_ONLY: 1, // cannot create/open for write\n      TSDR_PERM_READ_ONLY: 2, // cannot write data\n      TSDR_PERM_OPEN_WRITE_ONLY: 3, // cannot create/open for read\n      TSDR_PERM_WRITE_ONLY: 4, // cannot read data\n      TSDR_PERM_NORMAL: 5 // normal permission\n   }\n};\n//https://opengrok.eng.vmware.com/source/xref/bfg-main.perforce.1666/bora/apps/rde/tsdr/common/RdpEfs.h\nlet RDPDR_TYPE = {\n   RDPDR_CTYP_CORE: 0x4472,\n   RDPDR_CTYP_PRN: 0x5052,\n\n   /* PacketId [MS-RPDEFS 2.2.1.1] */\n   PAKID_CORE_SERVER_ANNOUNCE: 0x496E,\n   PAKID_CORE_CLIENTID_CONFIRM: 0x4343,\n   PAKID_CORE_CLIENT_NAME: 0x434E,\n   PAKID_CORE_DEVICELIST_ANNOUNCE: 0x4441,\n   PAKID_CORE_DEVICE_REPLY: 0x6472,\n   PAKID_CORE_DEVICE_IOREQUEST: 0x4952,\n   PAKID_CORE_DEVICE_IOCOMPLETION: 0x4943,\n   PAKID_CORE_SERVER_CAPABILITY: 0x5350,\n   PAKID_CORE_CLIENT_CAPABILITY: 0x4350,\n   PAKID_CORE_DEVICELIST_REMOVE: 0x444D,\n   PAKID_PRN_CACHE_DATA: 0x5043,\n   PAKID_CORE_USER_LOGGEDON: 0x554C,\n   PAKID_PRN_USING_XPS: 0x5543,\n\n\n   RDPDR_DEVICE_REMOVE_PDUS:          0x00000001,\n   RDPDR_CLIENT_DISPLAY_NAME_PDU:     0x00000002,\n   RDPDR_USER_LOGGEDON_PDU:           0x00000004,\n\n   /*CAP_GENERAL_TYPE:                  0x0001,\n   CAP_PRINTER_TYPE:                  0x0002,\n   CAP_PORT_TYPE:                     0x0003,\n   CAP_DRIVE_TYPE:                    0x0004,\n   CAP_SMARTCARD_TYPE:                0x0005,\n\n   RDPDR_DTYP_FILESYSTEM:             0x00000008,\n   RDPDR_DTYP_SMARTCARD:              0x00000020,\n\n\n   GENERAL_CAPABILITY_VERSION_02:     0x00000002,\n   PRINT_CAPABILITY_VERSION_01:       0x00000001,\n   PORT_CAPABILITY_VERSION_01:        0x00000001,\n   DRIVE_CAPABILITY_VERSION_02:       0x00000002,\n   SMARTCARD_CAPABILITY_VERSION_01:   0x00000001,*/\n\n\n   //Only support 1-dimension array, not support things like char[2][2]\n   BASE_TYPE: {\n      \"char\": 1,//\"UINT8\",\n      \"CHAR\": 1,//\"UINT8\",\n      \"BYTE\": 1,//\"UINT8\",\n      \"unsigned char\": 1,//\"UINT8\",\n      \"unsigned short\": 2,//\"UINT16\",\n      \"UINT32\": 4,//\"UINT32\",\n      \"WCHAR\": 2,//\"UINT16\",\n      \"BOOLEAN\": 1,//\"UINT8\", // uint8_t\n   },\n\n   IRP_MJ_CREATE: 0,\n   IRP_MJ_CLOSE: 2,\n   IRP_MJ_READ: 3,\n   IRP_MJ_WRITE: 4,\n\n\n   IRP_MJ_DEVICE_CONTROL: 0x00000000E,\n   IRP_MJ_QUERY_VOLUME_INFORMATION: 0xA,\n   IRP_MJ_SET_VOLUME_INFORMATION: 0xB,\n   IRP_MJ_QUERY_INFORMATION: 0x5,\n   IRP_MJ_SET_INFORMATION: 0x6,\n   IRP_MJ_DIRECTORY_CONTROL: 0xC,\n   IRP_MJ_LOCK_CONTROL: 0x11,\n\n   IRP_MN_QUERY_DIRECTORY: 0x1,\n   IRP_MN_NOTIFY_CHANGE_DIRECTORY: 2,\n\n   //[MS-SMB2 2.2.13.1.1]\n   FILE_ACCESS_DELETE: 0x10000,\n   FILE_ACCESS_GENERIC_ALL: 0x10000000,\n   FILE_ACCESS_GENERIC_WRITE: 0x40000000,\n\n\n\n   RDP_LOWIO_OP_SHAREDLOCK: 0x00000002,\n   RDP_LOWIO_OP_EXCLUSIVELOCK: 0x00000003,\n   RDP_LOWIO_OP_UNLOCK: 0x00000004,\n   RDP_LOWIO_OP_UNLOCK_MULTIPLE: 0x00000005,\n\n   CAP_TYPES: {\n      CAP_GENERAL_TYPE: 1,\n      CAP_PRINTER_TYPE: 2,\n      CAP_PORT_TYPE: 3,\n      CAP_DRIVE_TYPE: 4,\n      CAP_SMARTCARD_TYPE: 5\n   },\n   GENERAL_CAPABILITY_VERSION: {\n      GENERAL_CAPABILITY_VERSION_01: 1,\n      GENERAL_CAPABILITY_VERSION_02: 2\n   },\n\n   /* PAKID_CORE_DEVICELIST_ANNOUNCE */\n   RDPDR_DTYP_SMARTCARD: 0x00000020,\n\n   /* The Preferred Dosname length in DEVICE_ANNOUNCE packet. */\n   PREFERRED_DOS_NAME_LENGTH: 8,\n   /*\n    * DeviceData length. Derived from RDPDR_DRIVEDEVICE's\n    * szRedirectorLocalName size.\n    */\n   DEVICE_DATA_LOCAL_NAME_LENGTH: 250,\n   DEVICE_TYPE: 8,//defined in RdpdrChannel.cpp\n\n   /*\n    *  Allow SmartCard client to have 65K Smartcard readers.  The remainder\n    *  of the DWORD will be reserved for FR (and other future purposes).\n    */\n   SMARTCARD_MAX_DEVICE_ID: 0xffff,\n\n   /* RDP file system device [MS-RDPEFS 2.2.1.3] */\n   RDPDR_DTYPE_FILESYSTEM: 0x8,\n\n   /* Shared Protocol Header [MS-RPDEFS 2.2.1.1] */\n   FORMAT: {\n      RDPDR_HEADER: new Map([\n         [\"Component\", \"unsigned short\"],\n         [\"PacketId\", \"unsigned short\"]\n      ]), // RDPDR_HEADER, *PRDPDR_HEADER;\n\n      DR_CORE_SERVER_ANNOUNCE_REQ: new Map([\n         [\"Header\", \"RDPDR_HEADER\"],\n         [\"VersionMajor\", \"unsigned short\"],\n         [\"VersionMinor\", \"unsigned short\"],\n         [\"ClientId\", \"UINT32\"]\n      ]), //DR_CORE_SERVER_ANNOUNCE_REQ, *PDR_CORE_SERVER_ANNOUNCE_REQ;\n\n      DR_CORE_CLIENT_ANNOUNCE_RSP: new Map([\n         [\"Header\", \"RDPDR_HEADER\"],\n         [\"VersionMajor\", \"unsigned short\"],\n         [\"VersionMinor\", \"unsigned short\"],\n         [\"ClientId\", \"UINT32\"]\n      ]), // DR_CORE_CLIENT_ANNOUNCE_RSP, *PDR_CORE_CLIENT_ANNOUNCE_RSP;\n\n      DR_CORE_CLIENT_NAME_REQ: new Map([\n         [\"Header\", \"RDPDR_HEADER\"],\n         [\"UnicodeFlag\", \"UINT32\"],\n         [\"CodePage\", \"UINT32\"],\n         [\"ComputerNameLen\", \"UINT32\"],\n         [\"ComputerName\", \"WCHAR[Variance]\"]\n      ]), // DR_CORE_CLIENT_NAME_REQ, *PDR_CORE_CLIENT_NAME_REQ;\n\n\n      //------------------------------------\n      RDP_DR_DEVICE_IOREQUEST: new Map([\n         [\"DeviceId\", \"UINT32\"],\n         /* Id from Client DeviceList Announce Request */\n         [\"FileId\", \"UINT32\"],\n         /* Id from Device Create Response */\n         [\"CompletionId\", \"UINT32\"],\n         /* Unique Id for Each request */\n         [\"MajorFunction\", \"UINT32\"],\n         /* The IRP_MJ_AAA request */\n         [\"MinorFunction\", \"UINT32\"],\n         /* The IRP_MNAAA function (With IRP_MJ_DIRECTORY_CONTROL) */\n         [\"Parameters\", [//TODO\n            /* IRP_MJ_CREATE [MS-RPDEFS 2.2.1.4.1] */\n            {\n               \"type\": \"Create\",\n               \"format\": new Map([\n                  [\"DesiredAccess\", \"UINT32\"], // Wanted level of access\n                  [\"AllocationSize\", \"UINT32\"], // Initial allocaiton size for the file\n                  [\"FileAttributes\", \"UINT32\"], // Attributes for the created file\n                  [\"SharedAccess\", \"UINT32\"], // Sharing mode for the opened file\n                  [\"CreateDisposition\", \"UINT32\"], // Action to take of file already exists\n                  [\"CreateOptions\", \"UINT32\"], // Creation options\n                  [\"PathLength\", \"UINT32\"] // Length in bytes of data (Path) following the structure\n                     //Path\", \"WCHAR[.PathLength]\"\n               ])\n            },\n            /* IRP_MJ_CLOSE [MS-RPDEFS 2.2.1.4.2]\n             * No structure, 32 bytes padding\n             */\n\n            /* IRP_MJ_READ  [MS-RPDEFS 2.2.1.4.3] */\n            {\n               \"type\": \"Read\",\n               \"format\": new Map([\n                  [\"Length\", \"UINT32\"], // Maximum Number of chars to read\n                  [\"Offset\", \"LARGE_INTEGER\"], // Byte offset where read starts\n                  [\"Padding\", \"char[20]\"] // Padding\n               ])\n            },\n\n            /* IRP_MJ_WRITE  [MS-RPDEFS 2.2.1.4.4]*/\n            {\n               \"type\": \"Write\",\n               \"format\": new Map([\n                  [\"Length\", \"UINT32\"], // Number of char's to write\n                  [\"Offset\", \"LARGE_INTEGER\"], // Byte offset where write starts\n                  [\"Padding\", \"char[20]\"], // Padding\n                  //WriteData\", \"char[.Length]\" // Variable lenght Data to write\n               ])\n            },\n            /* IRP_MJ_DEVICE_CONTROL  [MS-RPDEFS 2.2.1.4.5]*/\n            {\n               \"type\": \"DeviceIoControl\",\n               \"format\": new Map([\n                  [\"OutputBufferLength\", \"UINT32\"], // Maximum num of bytes in OutputBuffer (See DR_CONTROL_RSP)\n                  [\"InputBufferLength\", \"UINT32\"], // Number of bytes in InputBuffer\n                  [\"IoControlCode\", \"UINT32\"], // IOCTL_AAA\n                  [\"Padding\", \"char[20]\"], // Padding\n                  //InputBuffer\": char[.InputBufferLength] // Variable lenght Data to send\n               ])\n            }, {\n               \"type\": \"QueryDirectory\",\n               \"format\": new Map([\n                  [\"FileInformationClass\", \"UINT32\"],\n                  [\"InitialQuery\", \"BOOLEAN\"],\n                  [\"PathLength\", \"UINT32\"],\n                  [\"Padding\", \"UCHAR[23]\"],\n                  //szPath\", \"WCHAR[.PathLength]\"\n               ])\n            }, {\n               \"type\": \"SetInformation\",\n               \"format\": new Map([\n                  [\"FileInformationClass\", \"UINT32\"],\n                  [\"Length\", \"UINT32\"],\n                  [\"Padding\", \"UCHAR[24]\"]\n               ])\n            }, {\n               \"type\": \"QueryInformation\",\n               \"format\": new Map([\n                  [\"FsInformationClass\", \"UINT32\"],\n                  [\"Padding\", \"UCHAR[28]\"]\n               ])\n            },\n            /* IRP_MJ_SET_VOLUME_INFORMATION  [MS-RPDEFS 2.2.3.3.7] */\n            {\n               \"type\": \"SetVolumeInformation\",\n               \"format\": new Map([\n                  [\"FsInformationClass\", \"UINT32\"],\n                  [\"Length\", \"UINT32\"],\n                  [\"Padding\", \"UCHAR[24]\"]\n               ])\n            }, {\n               \"type\": \"QueryVolumeInformation\",\n               \"format\": new Map([\n                  [\"FsInformationClass\", \"UINT32\"],\n                  [\"Padding\", \"UCHAR[28]\"]\n               ])\n            }, {\n               \"type\": \"NotifyChangeDirectory\",\n               \"format\": new Map([\n                  [\"WatchTree\", \"BOOLEAN\"],\n                  [\"CompletionFilter\", \"UINT32\"],\n                  [\"Padding\", \"UCHAR[27]\"]\n               ])\n            },\n            /* IRP_MJ_LOCK_CONTROL  [MS-RPDEFS 2.2.3.3.12] */\n            {\n               \"type\": \"Lock\",\n               \"format\": new Map([\n                  [\"Operation\", \"UINT32\"], // Lock type\n                  [\"F\", \"UINT32\"], // Fail immediately\n                  [\"NumLocks\", \"UINT32\"], // Number of locks requested\n                  [\"Padding\", \"UCHAR[20]\"], // Padding\n                  //Locks\": RDP_LOCK_INFO[.NumLocks]    // Variable length array of locks\n               ])\n            }]\n         ]\n      ]),\n\n\n      /* RDP_LOCK_INFO [MS-RPDEFS 2.2.1.6] */\n      RDP_LOCK_INFO: new Map([\n         [\"Length\", \"LARGE_INTEGER\"],\n         [\"Offset\", \"LARGE_INTEGER\"]\n      ]),\n\n      /* RDPDR_DEVICE_IOREQUEST [MS-RPDEFS 2.2.1.4] */\n      DR_DEVICE_IOREQUEST: new Map([\n         [\"Header\", \"RDPDR_HEADER\"],\n         [\"IoRequest\", \"RDP_DR_DEVICE_IOREQUEST\"]\n      ]),\n\n      /*\n       * RDP_DR_DEVICE_IOCOMPLETION\n       * [MS-RPDEFS 2.2.1.5]\n       * Sent by the client to indicate an I/O operation has completed\n       * Note: Should contain Protocol Header, I have separated the\n       *       Header from the request, it's included in the\n       *       DR_DEVICE_IOCOMPLETION below\n       */\n      RDP_DR_DEVICE_IOCOMPLETION: new Map([//TODO\n         // RDP_DR_DEVICE_IOCOMPLETION_HEADER\n         [\"DeviceId\", \"UINT32\"], // Must match DeviceId used in the RDP_DR_DEVICE_IOREQUEST\n         [\"CompletionId\", \"UINT32\"], // Must match the CompletionId in the RDP_DR_DEVICE_IOREQUEST\n         [\"IoStatus\", \"UINT32\"], // NT Status code for the request\n         [\"Parameters\", [\n            /* IRP_MJ_CREATE [MS-RPDEFS 2.2.1.5.1] */\n            {\n               type: \"Create\",\n               formate: new Map([\n                  [\"FileId\", \"UINT32\"], // Unique FileId for the created object\n                  [\"Information\", \"unsigned char\"] // Indicates the success of the Create/Open operation\n               ])\n            },\n            /* IRP_MJ_CLOSE [MS-RPDEFS 2.2.1.5.2] */\n            {\n               type: \"Close\",\n               formate: new Map([\n                  [\"Padding\", \"char[5]\"]\n               ])\n            },\n            /* IRP_MJ_READ [MS-RPDEFS 2.2.1.5.3] */\n            {\n               type: \"Read\",\n               formate: new Map([\n                  [\"Length\", \"UINT32\"], // Number of bytes that were read\n                  [\"ReadData\", \"unsigned char[1]\"], // Variable Output data from the read request\n               ])\n            },\n            /* IRP_MJ_WRITE [MS-RPDEFS 2.2.1.5.4] */\n            {\n               type: \"Write\",\n               formate: new Map([\n                  [\"Length\", \"UINT32\"], // Number of bytes that were written\n                  [\"Padding\", \"char[1]\"] // Variable Output data from the read request\n               ])\n            },\n            /* IRP_MJ_DEVICE_CONTROL [MS-RPDEFS 2.2.1.5.5] */\n            {\n               type: \"DeviceIoControl\",\n               formate: new Map([\n                  [\"OutputBufferLength\", \"UINT32\"], // Number of bytes in the OutputBuffer\n                  [\"OutputBuffer\", \"unsigned char[1]\"] // Variable lenght array of bytes\n               ])\n            }, {\n               type: \"QueryVolumeInformation\",\n               formate: new Map([\n                  [\"Length\", \"UINT32\"],\n                  [\"VolumeInformation\", \"char[1]\"]\n               ])\n            }, {\n               type: \"SetVolumeInformation\",\n               formate: new Map([\n                  [\"Length\", \"UINT32\"],\n                  [\"Padding\", \"char[1]\"]\n               ])\n            }, {\n               type: \"QueryInformation\",\n               formate: new Map([\n                  [\"Length\", \"UINT32\"],\n                  [\"FileInformation\", \"char[1]\"]\n               ])\n            }, {\n               type: \"QueryDirectory\",\n               formate: new Map([\n                  [\"Length\", \"UINT32\"],\n                  [\"FileInformation\", \"char[1]\"]\n               ])\n            }, {\n               type: \"NotifyChangeDirectory\",\n               formate: new Map([\n                  [\"Length\", \"UINT32\"],\n                  [\"FileNotifyInformation\", \"char[1]\"]\n               ])\n            },\n            /* IRP_MJ_LOCK_CONTROL  [MS-RPDEFS 2.2.3.4.12] */\n            {\n               type: \"Lock\",\n               formate: new Map([\n                  [\"Padding\", \"char[5]\"]\n               ])\n            }\n         ]]\n      ]),\n      /* [MS-RPDEFS 2.2.1.5] */\n      DR_DEVICE_IOCOMPLETION: new Map([\n         [\"Header\", \"RDPDR_HEADER\"],\n         [\"IoCompletion\", \"RDP_DR_DEVICE_IOCOMPLETION\"]\n      ]),\n      /* [MS-RDPEFS 2.2.2.2 for server] and [MS-RDPEFS 2.2.2.6 for client] */\n      DR_CORE_ANNOUNCE_REQ: new Map([\n         [\"Header\", \"RDPDR_HEADER\"],\n         [\"VersionMajor\", \"unsigned short\"],\n         [\"VersionMinor\", \"unsigned short\"],\n         [\"ClientId\", \"UINT32\"]\n      ]),\n      CAPABILITY_HEADER: new Map([\n         [\"CapabilityType\", \"unsigned short\"],\n         [\"CapabilityLength\", \"unsigned short\"],\n         [\"Version\", \"UINT32\"]\n      ]),\n      /* [MS-RDPEFS 2.2.2.7.1] */\n      GENERAL_CAPS_SET: new Map([\n         [\"Header\", \"CAPABILITY_HEADER\"],\n         [\"osType\", \"UINT32\"],\n         [\"osVersion\", \"UINT32\"],\n         [\"protocolMajorVersion\", \"unsigned short\"],\n         [\"protocolMinorVersion\", \"unsigned short\"],\n         [\"ioCode1\", \"UINT32\"],\n         [\"ioCode2\", \"UINT32\"],\n         [\"extendedPDU\", \"UINT32\"],\n         [\"extraFlags1\", \"UINT32\"],\n         [\"extraFlags2\", \"UINT32\"],\n         [\"SpecialTypeDeviceCap\", \"UINT32\"]\n      ]),\n      PRINTER_CAPS_SET: new Map([\n         [\"Header\", \"CAPABILITY_HEADER\"]\n      ]),\n      PORT_CAPS_SET: new Map([\n         [\"Header\", \"CAPABILITY_HEADER\"]\n      ]),\n      DRIVE_CAPS_SET: new Map([\n         [\"Header\", \"CAPABILITY_HEADER\"]\n      ]),\n      SMARTCARD_CAPS_SET: new Map([\n         [\"Header\", \"CAPABILITY_HEADER\"]\n      ]),\n      /* [MS-RDPEFS 2.2.2.7 for server] and [MS-RDPEFS 2.2.2.8 for client] */\n      DR_CORE_CAPABILITY_REQ: new Map([\n         [\"Header\", \"RDPDR_HEADER\"],\n         [\"numCapabilities\", \"unsigned short\"],\n         [\"Padding\", \"unsigned short\"],\n         [\"CapabilityMessage\", \"Variance\"]\n      ]),\n      //------------\n      DEVICE_ANNOUNCE_HEADER: new Map([\n         [\"DeviceType\", \"UINT32\"],\n         [\"DeviceId\", \"UINT32\"],\n         [\"DosName\", \"CHAR[..PREFERRED_DOS_NAME_LENGTH]\"],\n         [\"DeviceDataLength\", \"UINT32\"],\n         [\"DeviceData\", \"BYTE[.DeviceDataLength]\"]\n      ]),\n      DR_CORE_DEVICELIST_ANNOUNCE_REQ: new Map([\n         [\"Header\", \"RDPDR_HEADER\"],\n         [\"DeviceCount\", \"UINT32\"],\n         [\"DeviceList\", \"DEVICE_ANNOUNCE_HEADER[1]\"],//for now we send only one per request\n         //Duplicated data in DEVICE_ANNOUNCE_HEADER, DeviceData\", \"CHAR[]\"\n      ]),\n      DR_CORE_DEVICE_ANNOUNCE_RSP: new Map([\n         [\"Header\", \"RDPDR_HEADER\"],\n         [\"DeviceId\", \"UINT32\"],\n         [\"ResultCode\", \"UINT32\"]\n      ]),\n      DR_DEVICELIST_REMOVE: new Map([\n         [\"Header\", \"RDPDR_HEADER\"],\n         [\"DeviceCount\", \"UINT32\"],\n         [\"DeviceIds\", \"UINT32\"]\n      ])\n   }\n};\n//https://opengrok.eng.vmware.com/source/xref/bfg-main.perforce.1666/bora/apps/rde/tsdr/common/TsdrDefs.h\nlet TDSR_TYPE = {\n   /*\n    * TSDR Version Exchange Component/PacketId defines.\n    */\n   TSDR_COMPONENT_CAPS: 0xfffe,\n   TSDR_PACKID_VERSION_EXCHANGE: 0x0001,\n   TSDR_PACKID_AGENT_POLICY: 0x0002,\n\n   TSDR_FOLDER_ENUM_BUF_SIZE: 4096,\n\n   /*\n    * Bitmask for peer capbilities\n    */\n   TSDR_CAPS_MUL_ENTRIES: 0x1,\n\n   /*\n    * TSDR Version Exchange Packet structure.\n    */\n   FORMAT: {\n      TSDR_CAPS_VERSION_EXCHANGE_REQ: {\n         Header: \"RDPDR_HEADER\", //4\n         Version: \"unsigned short\", //2\n         Caps: \"unsigned short\", //2\n      }\n   },\n\n   //(sizeof(TSDR_CAPS_VERSION_EXCHANGE_REQ) - sizeof(unsigned short))\n   MIN_TSDR_CAPS_VERSION_EXCHANGE_REQ_SIZE: 6,\n\n\n   /*\n    * enum TsdrVersion\n    *\n    *   Represents the version of the TSDR endpoint.\n    *\n    *   TSDR_VERSION_UNKNOWN = Unknown version.\n    *   TSDR_VERSION_V1 = Initial release.\n    *   TSDR_VERSION_V2 = Read/Write only CDR support.\n    *\n    *   XXX: When adding a version, mention the new features/capabilities here.\n    */\n   VERSION: {\n      TSDR_VERSION_UNKNOWN: 0,\n      TSDR_VERSION_V1: 1,\n      TSDR_VERSION_V2: 2, // Start to support agent policy\n      TSDR_VERSION_V3: 3 // Start to support cache\n   }\n};\n\n/**\n * Uint8Array data\n */\nfunction StreamHelper(data){\n   let offset = 0;\n   let getBytes = function(bytes){\n      if(data.length < offset+bytes){\n         console.error(\"too small data to read\");\n         return 0;\n      }\n      let number = 0;\n      for(let i=0; i<bytes; i++){\n         number |= data[offset+i]<<(i*8);\n      }\n      offset+=bytes;\n      return number;\n   };\n   this.getUint8= function(){\n      return getBytes(1);\n   };\n   this.getUint16 = function(){\n      return getBytes(2);\n   };\n   this.getUint32 = function(){\n      return getBytes(4);\n   };\n   this.getUint64 = function(){\n      return getBytes(8);\n   };\n   this.getRest = function() {\n      return data.subarray(offset, data.length);\n   };\n   this.getBytes = getBytes;\n   this.getOffset = function() {\n      return offset;\n   };\n   this.reset = function(){\n      offset = 0;\n   };\n}\nfunction StreamWriter(type){\n   let temp = [];\n   let pushBytes =function(number, bytes){\n      for(let i=0; i<bytes; i++){\n         temp.push(number&0xFF);\n         number >>= 8;\n      }\n   };\n   this.pushUint8 = function(number){\n      pushBytes(number,1);\n   };\n   this.pushUint16 = function(number){\n      pushBytes(number,2);\n   };\n   this.pushUint32 = function(number){\n      pushBytes(number,4);\n   };\n   this.pushUint64 = function(number){\n      pushBytes(number,8);\n   };\n   this.getStream = function(){\n      return new Uint8Array(temp);\n   };\n   this.getArray = function(){\n      return temp;\n   };\n   this.hasData = function(){\n      return temp.length>0;\n   };\n   this.clear = function(){\n      temp = [];\n   };\n   this.pushBytes = pushBytes;\n   //UTF-16\n   this.pushUnitCode = function(string){\n      for(let i=0;i<string.length;i++){\n         let charCode = string.charCodeAt(i);\n         this.pushUint16(charCode);\n      };\n      this.pushUint16(0);//add end 2 bytes as /0\n   };\n   //ascii code\n   this.pushString = function(string, length){\n      if(string.length !== length-1){\n         console.error(\"error when push string, the length is not matched with the input string length\");\n      }\n      for(let i=0;i<string.length;i++){\n         let charCode = string.charCodeAt(i);\n         this.pushUint8(charCode);\n      };\n      this.pushUint8(0);//add end 2 bytes as /0\n   };\n   this.getString = function() {\n      let hexNumbers = [];\n      temp.forEach((number)=>{\n         hexNumbers.push(number.toString(16));\n      });\n      return hexNumbers;\n   };\n}\nfunction ProtocolHelper(baseTypes, coodbook) {\n   let convertToCaml =function(string){\n      if(!(string.length>0)){\n         return \"\";\n      }\n      return string[0].toLowerCase() + string.substr(1);\n   };\n   return {\n      isInvalidType: function(type) {\n         return !coodbook.hasOwnProperty(type);\n      },\n      parseByStruct: function(streamHelper, struct, result, param){\n         if(!struct){\n            return;\n         }\n         struct.forEach((dataType, propertyKey)=>{\n            let propertyName = convertToCaml(propertyKey);\n            let logBase = \"read \" + JSON.stringify(dataType) + \" for property \"+ propertyName;\n            result[propertyName] = {};//default as empty object, will be overwritten if is number\n            let propertySlot = result[propertyName];\n            if(typeof dataType === 'string'){\n               if(baseTypes.hasOwnProperty(dataType)){\n                  console.log(logBase + \" as baseTypes of \" + baseTypes[dataType]+\" bytes\");\n                  result[propertyName]=streamHelper.getBytes(baseTypes[dataType]);\n               } else if(coodbook.hasOwnProperty(dataType)){//should be another type\n                  let subStruct = coodbook[dataType];\n                  this.parseByStruct(streamHelper, subStruct, propertySlot, param);//subStruct is of type struct \"json\"\n                  console.log(logBase + \" as another sub structure \" + subStruct);\n               } else if (dataType===\"Variance\"){// where the length is not sure, so check param for detail\n                  console.error(logBase + \" as Variance TODO\");\n                  //TODO: use param to match which should be used.\n\n               } else if (dataType === \"WCHAR[Variance]\") {\n                  console.error(logBase + \" as WCHAR[Variance] TODO\");\n                  //TODO: use param to match which should be used.\n               } else {\n                  console.error(logBase + \" failed, since the data type is unkonwn: \"+ dataType);\n               }\n            } else if(typeof dataType === 'object'){\n               if(Array.isArray(dataType)){//array is used as union, so need to use param to decide\n                  console.error(logBase + \" as union\");\n                  console.error(Array);\n                  if(!param.hasOwnProperty(propertyName)){\n                     console.error(logBase + \" as union fails, since param is invalid\");\n                  }\n                  let unionType = '';\n                  if(typeof param[propertyName] === \"string\"){\n                     unionType = param[propertyName];\n                  } else if(typeof param[propertyName] === \"function\"){\n                     // Only support the result.\n                     unionType = param[propertyName](result);\n                  }\n                  let hasMatchedType = false;\n                  if(!!unionType){\n                     let hasMatchedType = dataType.some((value, key)=>{\n                        if(value.type === unionType){\n                           console.error(logBase + \" as union success as \" + unionType);\n                           this.parseByStruct(streamHelper, value.format, propertySlot, param);//subStruct is of type struct \"json\"\n                           return true;\n                        }\n                        return false;\n                     });\n                  }\n                  if(!hasMatchedType){\n                     console.error(logBase + \" as union fails, since can't find the matched union type\");\n                  }\n               } else {// Explicity structure\n                  console.log(logBase + \" as object of explicity structure: \", dataType);\n                  this.parseByStruct(streamHelper, subStruct, propertySlot, param);\n               }\n            } else{\n               console.error(logBase + \" failed, since the type is invalid: \", dataType);\n            }\n         });\n         return result;\n      },\n      parseByName: function(streamHelper, type, result, param) {\n         if(this.isInvalidType(type)){\n            console.warn(\"invalid type to parse\");\n            return;\n         }\n         if (!result) {\n            result = {};\n         }\n         let struct = coodbook[type];\n         this.parseByStruct(streamHelper, struct, result, param);\n         return result;\n      },\n      /**\n       * from streamHelper to result\n       * @param  {[type]} streamHelper [description]\n       * @param  {[type]} type         [description]\n       * @return {[type]}              [description]\n       */\n      parse: function(streamHelper, type,param) {\n         let result = {};\n         return this.parseByName(streamHelper, type, result, param);\n         /**\n         let component = streamHelper.getUint16();\n         let packetId = streamHelper.getUint16();\n         return {\n            component: component,\n            packetId: packetId\n         };**/\n      },\n      streamifyByStruct: function(streamWriter, struct, data, param){\n         if(!struct){\n            return;\n         }\n         struct.forEach((dataType, propertyKey)=>{\n            let propertyName = convertToCaml(propertyKey);\n            let logBase = \"write \" + JSON.stringify(dataType) + \" for property \"+ propertyName;\n            let propertyValue = data[propertyName];\n            if(typeof dataType === 'string'){\n               let arrayMatcher = new RegExp('\\\\w+\\\\[.{0,2}\\\\w+\\\\]');\n               let matchedArray = arrayMatcher.exec(dataType);\n               if(baseTypes.hasOwnProperty(dataType)){\n                  console.log(logBase + \" as baseTypes of \" + baseTypes[dataType]+\" bytes\");\n                  streamWriter.pushBytes(propertyValue, baseTypes[dataType]);\n               } else if(coodbook.hasOwnProperty(dataType)){//should be another type\n                  let subStruct = coodbook[dataType];\n                  this.streamifyByStruct(streamWriter, subStruct, propertyValue, param);//subStruct is of type struct \"json\"\n                  console.log(logBase + \" as another sub structure \" + subStruct);\n               } else if (dataType===\"Variance\"){// where the length is not sure, so check param for detail\n                  if(!param || !param.hasOwnProperty(propertyName)){\n                     console.error(logBase + \" as Variance fail, since find no key \" +propertyName+ \" in the param: \", param);\n                     return;\n                  }\n                  let varientTypes = param[propertyName];\n                  console.error(logBase + \" as Variance:\" + varientTypes);\n                  //TODO, currently only accept array of sub type names\n                  if(Array.isArray(varientTypes)){\n                     for(let j=0;j<varientTypes.length;j++){\n                        let varientType = varientTypes[j];\n                        let varientName = varientType;//Don't use the caml for this case\n                        if(!coodbook.hasOwnProperty(varientType)){\n                           console.error(logBase + \" as Variance fail, since we only support array of subtype names for now, but one of sub type is:\", varientType);\n                           return;\n                        }\n                        let varientStruct = coodbook[varientType];\n                        if(!propertyValue.hasOwnProperty(varientName)){\n                           console.error(logBase + \" as Variance fail, since the proterty don't has corresponding data for \" +varientType, propertyValue);\n                           return;\n                        }\n                        let varientData = propertyValue[varientName];\n                        console.error(logBase + \" as Variance for :\" + varientName, varientStruct, varientData);\n                        this.streamifyByStruct(streamWriter, varientStruct, varientData, param/*TODO support nested param*/);\n                     }\n                  }\n                  //TODO: use param to match which should be used.\n\n               } else if (dataType === \"WCHAR[Variance]\") {\n                  console.error(logBase + \" as WCHAR[Variance]: \" + propertyValue);\n                  //TODO: use param to match which should be used.\n                  streamWriter.pushUnitCode(propertyValue);\n               } else if(!!matchedArray) {\n                  let splittedString = matchedArray[0].split(/[\\[\\]]+/);\n                  if(splittedString.length !==3 && splittedString[2]===''){\n                     console.error(logBase + \" failed, since the array indicator is invalid: \"+ dataType);\n                     return;\n                  }\n                  let arrayType = splittedString[0];\n                  let arrayLengthString = splittedString[1];\n                  let arrayLength = Number(arrayLengthString);\n                  if(!arrayLength){\n                     if(arrayLengthString[0] !== '.'){\n                        console.error(logBase + \" failed, since the array length is invalid: \"+ dataType);\n                     }\n                     if(arrayLengthString[1] === '.'){\n                        let macroName = arrayLengthString.slice(2,arrayLengthString.length);\n                        if(!RDPDR_TYPE.hasOwnProperty(macroName) || typeof RDPDR_TYPE[macroName] !== 'number'){\n                           console.error(logBase + \" failed, since the array length is invalid macro: \"+ dataType);\n                        }\n                        arrayLength = RDPDR_TYPE[macroName];\n                     } else {\n                        let lengthPropertyName = convertToCaml(arrayLengthString.slice(1,arrayLengthString.length));\n                        if(!data.hasOwnProperty(lengthPropertyName) || typeof data[lengthPropertyName] !== 'number'){\n                           console.error(logBase + \" failed, since the array length is invalid property: \"+ dataType);\n                        }\n                        arrayLength = data[lengthPropertyName];\n                     }\n                  }\n                  if (arrayLength>0) {\n                     if(typeof propertyValue === 'string' && baseTypes[arrayType] === 1){\n                        streamWriter.pushString(propertyValue, arrayLength);\n                     }else{//default as number\n                        for(let i=0;i<arrayLength;i++) {\n                           let arrayData = propertyValue[i];\n                           if(baseTypes.hasOwnProperty(arrayType)) {\n                              console.log(logBase + \" as baseTypes of \" + baseTypes[arrayType]+\" bytes\");\n                              streamWriter.pushBytes(arrayData, baseTypes[arrayType]);\n                           } else if(coodbook.hasOwnProperty(arrayType)){//should be another type\n                              let arrayStruct = coodbook[arrayType];\n                              this.streamifyByStruct(streamWriter, arrayStruct, arrayData, param);//arrayStruct is of type struct \"json\"\n                              console.log(logBase + \" as another sub structure in the array\" + arrayStruct);\n                           } else {\n                              console.log(logBase + \" failed, since the array data type is invalid\" + dataType);\n                           }\n                        }\n                     }\n                  } else {\n                     console.log(logBase + \" failed, since the array length is invalid\" + dataType);\n                  }\n               } else {\n                  console.error(logBase + \" failed, since the data type is unkonwn: \"+ dataType);\n               }\n            } else if(typeof dataType === 'object'){\n               if(Array.isArray(dataType)){//array is used as union, so need to use param to decide\n                  console.error(logBase + \" as union TODO\");\n                  //TODO: use param to match which should be used.\n               } else {//explicity structure\n                  console.log(logBase + \" as object of explicity structure: \", dataType);\n                  this.streamifyByStruct(streamWriter, subStruct, propertyValue, param);\n               }\n            } else{\n               console.error(logBase + \" failed, since the type is invalid: \", dataType);\n            }\n         });\n      },\n      streamifyByName: function(streamWriter, type, data, param){\n         if(this.isInvalidType(type)){\n            console.warn(\"invalid type to parse\");\n            return;\n         }\n         let struct = coodbook[type];\n         this.streamifyByStruct(streamWriter, struct, data, param);\n      },\n      /**\n       * from data into streamWriter\n       * @param  {[type]} streamWriter [description]\n       * @param  {[type]} type         [description]\n       * @param  {[type]} data         [description]\n       * @param  {[type]} param        [description]\n       * @return {[type]}              [description]\n       */\n      streamify: function(streamWriter, type, data, param) {\n         streamWriter.clear();\n         this.streamifyByName(streamWriter, type, data, param);\n         return;\n         /*\n         //header\n         streamWriter.pushUint16(RDPDR_TYPE.RDPDR_CTYP_CORE);\n         //corespoding to DR_CORE_CLIENT_ANNOUNCE_RSP https://opengrok.eng.vmware.com/source/xref/bfg-main.perforce.1666/bora/apps/rde/rds/manager/channels.cpp#3619\n         streamWriter.pushUint16(RDPDR_TYPE.PAKID_CORE_CLIENTID_CONFIRM);\n\n\n         //this.streamify(streamWriter,data,type)//DR_CORE_CLIENT_ANNOUNCE_RSP\n         streamWriter.pushUint16(data.versionMajor);\n         streamWriter.pushUint16(data.versionMinor);\n         streamWriter.pushUint32(data.clientId);\n         return streamWriter;*/\n      }\n   };\n}\nexport default function RdpdrChannelManager(tsdrChannel, tsdrControlObject) {\n   let deviceIdCounter = RDPDR_TYPE.SMARTCARD_MAX_DEVICE_ID;\n   let selectedFolders = [];\n   let userLoggedOn = false;\n   let pPolicy = null;\n   let serverVersion = TDSR_TYPE.VERSION.TSDR_VERSION_UNKNOWN;\n\n   let protocolHelper = ProtocolHelper(RDPDR_TYPE.BASE_TYPE,RDPDR_TYPE.FORMAT);\n   /*let rdpdrChannel = (function(){\n      let onDataReceived = null;\n      return {\n         init: function(onData){\n            onDataReceived = onData;\n         },\n         send: function(stream){\n         },\n         processData: function(stream){\n            if(typeof onDataReceived == 'function'){\n               onDataReceived(stream);\n            }\n         }\n      }\n   })();*/\n   let handleVersionExchange = function() {\n      console.error(\"handleVersionExchange\");\n      return true;\n   };\n   let handleTsdrPolicy = function() {\n      console.error(\"handleTsdrPolicy\");\n      return true;\n   };\n   /**\n    * will make sure the string length is no more than length-1, since last char\n    * must be /0\n    * @param  {[type]} string [description]\n    * @param  {[type]} length [description]\n    * @return {[type]}        [description]\n    */\n   let clipCString = function(string, length) {\n      return string.slice(0,length-1);\n   };\n   let deviceListAnnounce = function(folder) {\n      let deviceId = deviceIdCounter;\n      let deviceType = RDPDR_TYPE.DEVICE_TYPE;\n      let folderName = \"testFolder\";// from folder propertys\n      let folderPermission = RDPDR_POLICY.TSDR_FOLDER_PERMISSION.TSDR_PERM_OPEN_READ_ONLY;//only support this in first version\n\n      //clip folder name\n      let dosName = clipCString(folderName, RDPDR_TYPE.PREFERRED_DOS_NAME_LENGTH);\n      folderName = clipCString(folderName, RDPDR_TYPE.DEVICE_DATA_LOCAL_NAME_LENGTH);\n\n      // Use 1st Byte in device id for access control\n      deviceId |= folderPermission << RDPDR_POLICY.TSDR_DEVID_AC_SHIFT;\n\n      let deviceAnnounce = {\n         header:{//RDPDR_HEADER\n            component: RDPDR_TYPE.RDPDR_CTYP_CORE,\n            packetId: RDPDR_TYPE.PAKID_CORE_DEVICELIST_ANNOUNCE\n         },\n         deviceCount : 1,\n         deviceList: [{//DEVICE_ANNOUNCE_HEADER, only has one in this version\n            deviceType: deviceType,\n            deviceId: deviceId,\n            dosName: dosName,//char[8]\n            deviceDataLength: folderName.length+1,//strlen(deviceList.DeviceData) + 1;\n            deviceData:folderName,//char[]\n         }]\n      };\n      let param = {};\n\n      sendResponse(\"DR_CORE_DEVICELIST_ANNOUNCE_REQ\", deviceAnnounce, param);\n\n      deviceIdCounter++;\n   };\n   let redirectSelectedFolders =function(){\n      //for(let folder in selectedFolders){\n      //   deviceListAnnounce();\n      //}\n      deviceListAnnounce();\n   };\n   let onUserReady = function() {\n      console.error(\"onUserReady\");\n      redirectSelectedFolders();\n   };\n   let sendRPC = function(streamWriter, onDone, onAbort) {\n      if (!tsdrChannel) {\n         JSCDKLogger.error('RPC send failed: tsdrChannel not initialized');\n         onAbort();\n         return;\n      }\n      let command = 0;\n      let result = tsdrChannel.invoke({\n         object: tsdrControlObject,\n         command: 0,//not sure, just reuse the one in the request\n         type: 4,//use POST.  1,//VDPService.RPC_TYPE.REQUEST,\n         params: streamWriter.hasData() ? [streamWriter.getStream()] : [],\n         onDone: onDone,\n         onAbort: onAbort\n      });\n      console.error('send back', streamWriter.getString());\n      return !!result;\n   };\n   let onAbort = function(){\n      console.error(\"send rpc aborted\");\n   };\n   let onDone = function(){\n      console.error(\"send rpc done\");\n   };\n\n   let sendResponse = function(type, data, param){\n      console.error(\"sending response of type \"+type+\" :\", data);\n      let streamWriter = new StreamWriter();\n      protocolHelper.streamify(streamWriter, type, data, param);\n      sendRPC(streamWriter, onDone, onAbort);//commandMap[type] instead of type\n   };\n\n   let handleServerAnnounce = function(streamHelper) {\n      console.error(\"handleServerAnnounce\");\n      let serverVersionInfo = protocolHelper.parse(streamHelper, \"DR_CORE_SERVER_ANNOUNCE_REQ\");\n      serverVersion = serverVersionInfo.versionMajor;\n\n      let clientVersionInfo = serverVersionInfo;\n\n      clientVersionInfo.versionMinor = 12;//for testing and also same as window client\n      clientVersionInfo.header.packetId = RDPDR_TYPE.PAKID_CORE_CLIENTID_CONFIRM;\n\n      sendResponse(\"DR_CORE_CLIENT_ANNOUNCE_RSP\",clientVersionInfo);\n   };\n   let sendClientCapability = function(){\n      let generalCapsSet = {//GENERAL_CAPS_SET\n         header: {\n            capabilityType:RDPDR_TYPE.CAP_TYPES.CAP_GENERAL_TYPE,\n            capabilityLength:0x2c,//sizeof(GENERAL_CAPS_SET)\n            version:RDPDR_TYPE.GENERAL_CAPABILITY_VERSION.GENERAL_CAPABILITY_VERSION_02,\n         },\n         osType:0x00000002,//unlike 0x0002, 0x0000\n         osVersion:0x00060001,//unlike 0x0001, 0x0006\n         protocolMajorVersion:1,\n         protocolMinorVersion:0x0c,\n         ioCode1:0xffff,\n         ioCode2:0,\n         extendedPDU:RDPDR_TYPE.RDPDR_DEVICE_REMOVE_PDUS |\n                     RDPDR_TYPE.RDPDR_CLIENT_DISPLAY_NAME_PDU |\n                     RDPDR_TYPE.RDPDR_USER_LOGGEDON_PDU,\n         extraFlags1:1,//ENABLE_ASYNCIO = 1\n         extraFlags2:0,\n         specialTypeDeviceCap:0\n      };\n      let printerCapSet={\n         header: {\n            capabilityType:RDPDR_TYPE.CAP_TYPES.CAP_PRINTER_TYPE,\n            capabilityLength:0x08,//sizeof(printerCapSet)\n            version:1,\n         }\n      };\n      let portCapSet={\n         header: {\n            capabilityType:RDPDR_TYPE.CAP_TYPES.CAP_PORT_TYPE,\n            capabilityLength:0x08,//sizeof(printerCapSet)\n            version:1,\n         }\n      };\n      let driveCapSet={\n         header: {\n            capabilityType:RDPDR_TYPE.CAP_TYPES.CAP_DRIVE_TYPE,\n            capabilityLength:0x08,//sizeof(printerCapSet)\n            /* CAP_DRIVE_TYPE enabled with v2 to\n             * support device names longer than 8 bytes.\n             */\n            version:2,\n         }\n      };\n      let smartcardCapSet={\n         header: {\n            capabilityType:RDPDR_TYPE.CAP_TYPES.CAP_SMARTCARD_TYPE,\n            capabilityLength:0x08,//sizeof(printerCapSet)\n            version:1,\n         }\n      };\n\n      let clientCapability ={\n         header: {\n            component: RDPDR_TYPE.RDPDR_CTYP_CORE,\n            packetId: RDPDR_TYPE.PAKID_CORE_CLIENT_CAPABILITY\n         },\n         numCapabilities: 0x0005,\n         padding: 0x0000,\n         capabilityMessage: {//array of sub objects\n            GENERAL_CAPS_SET:generalCapsSet,\n            PRINTER_CAPS_SET:printerCapSet,\n            PORT_CAPS_SET:portCapSet,\n            DRIVE_CAPS_SET:driveCapSet,\n            SMARTCARD_CAPS_SET:smartcardCapSet\n         }\n      };\n      let param = {\n         capabilityMessage: [\"GENERAL_CAPS_SET\", \"PRINTER_CAPS_SET\", \"PORT_CAPS_SET\", \"DRIVE_CAPS_SET\", \"SMARTCARD_CAPS_SET\"]\n      };\n      sendResponse(\"DR_CORE_CAPABILITY_REQ\", clientCapability, param);\n   };\n   let sendClientName = function(){\n      let machineName = \"HorizonClient\";\n      let clientName ={\n         header: {\n            component: RDPDR_TYPE.RDPDR_CTYP_CORE,\n            packetId: RDPDR_TYPE.PAKID_CORE_CLIENT_NAME\n         },\n         unicodeFlag: 0x00000001,\n         codePage: 0,\n         computerNameLen : (machineName.length+1)*2,//(cchComputerNameLength + 1) * sizeof(WCHAR),\n         computerName: machineName\n      };\n      sendResponse(\"DR_CORE_CLIENT_NAME_REQ\", clientName);\n   };\n   /**\n    * like Mobile clients webclient also will simplify the capacity to only one.\n    * RDSDRQueueClientCapabiltyResponse\n    */\n   let handleServerCapability = function(streamHelper) {\n      console.error(\"handleServerCapability\");\n      /**\n      let numCapabilities = streamHelper.getUint16();//force to use only just 1 capacity\n      let padding = streamHelper.getUint16();\n      let CapabilityMessage = streamHelper.getRest();\n\n \n      let capacityHelper = new StreamHelper(CapabilityMessage);// of many GENERAL_CAPS_SET\n      // CAPABILITY_HEADER;\n      let capabilityType = capacityHelper.getUint16();// as CAP_GENERAL_TYPE;\n      let capabilityLength = capacityHelper.getUint16(); // as sizeof(GENERAL_CAPS_SET);\n      let version = capacityHelper.getUint32(); //as GENERAL_CAPABILITY_VERSION_02;\n      //\n      let osType = capacityHelper.getUint32();// as 0\n      let osVersion = capacityHelper.getUint32();//as 0\n      let protocolMajorVersion = capacityHelper.getUint16();//as 1\n      let protocolMinorVersion = capacityHelper.getUint16();//as 0xC\n      let ioCode1 = capacityHelper.getUint32();//as 0xffff\n      let ioCode2 = capacityHelper.getUint32();//as 0\n      /**\n       * as RDPDR_DEVICE_REMOVE_PDUS |\n       * RDPDR_CLIENT_DISPLAY_NAME_PDU |\n       * RDPDR_USER_LOGGEDON_PDU;\n       *-/\n      let extendedPDU = capacityHelper.getUint32();\n      let extraFlags1 = capacityHelper.getUint32();//as ENABLE_ASYNCIO;\n      let extraFlags2 = capacityHelper.getUint32();// as 0\n      let specialTypeDeviceCap = capacityHelper.getUint32();// as 0\n\n      console.warn(capacityHelper.getOffset());\n      console.warn(capacityHelper.getRest());\n\n      let serverCapability = {\n         capacityHeader:{\n            capabilityType: capabilityType,\n            capabilityLength: capabilityLength,\n            version: version,\n         },\n         osType:osType,\n         osVersion:osVersion,\n         protocolMajorVersion:protocolMajorVersion,\n         protocolMinorVersion:protocolMinorVersion,\n         ioCode1:ioCode1,\n         ioCode2:ioCode2,\n         extendedPDU:extendedPDU,\n         extraFlags1:extraFlags1,\n         extraFlags2:extraFlags2,\n         specialTypeDeviceCap:specialTypeDeviceCap,\n      };\n      console.error(serverCapability);\n      //sendResponse(\"PAKID_CORE_CLIENT_CAPABILITY\",clientVersion);\n      //streamWriter=new StreamWriter();//of struct DR_CORE_CAPABILITY_RSP\n      //PAKID_CORE_CLIENT_CAPABILITY;\n      */\n\n      sendClientCapability();\n      sendClientName();\n      return true;\n   };\n   let handleDeviceReply = function() {\n      console.error(\"handleDeviceReply\");\n      return true;\n   };\n   let handleIoRequest = function(streamHelper) {\n      console.error(\"handleIoRequest\");\n      let param = {\n         parameters: function(parsed){\n            let typeMap = {};\n            typeMap[RDPDR_TYPE.IRP_MJ_CREATE] = \"Create\";\n            typeMap[RDPDR_TYPE.IRP_MJ_CLOSE] = \"Close\";\n            typeMap[RDPDR_TYPE.IRP_MJ_READ] = \"Read\";\n            typeMap[RDPDR_TYPE.IRP_MJ_WRITE] = \"Write\";\n            typeMap[RDPDR_TYPE.IRP_MJ_DEVICE_CONTROL] = \"DeviceControl\";\n            typeMap[RDPDR_TYPE.IRP_MJ_QUERY_VOLUME_INFORMATION] = \"QueryVolumeInformation\";\n            typeMap[RDPDR_TYPE.IRP_MJ_SET_VOLUME_INFORMATION] = \"SetVolumeInformation\";\n            typeMap[RDPDR_TYPE.IRP_MJ_QUERY_INFORMATION] = \"QueryInformation\";\n            typeMap[RDPDR_TYPE.IRP_MJ_SET_INFORMATION] = \"SetInformation\";\n            typeMap[RDPDR_TYPE.IRP_MJ_DIRECTORY_CONTROL] = function(){\n               let minorMap = {};\n               minorMap[RDPDR_TYPE.IRP_MN_QUERY_DIRECTORY] = \"DirectoryControl\";\n               minorMap[RDPDR_TYPE.IRP_MN_NOTIFY_CHANGE_DIRECTORY] = \"NotifyChangeDirectory\";\n               if(minorMap.hasOwnProperty(parsed.minorFunction)){\n                  return minorMap[parsed.minorFunction];\n               }\n               return \"NotImplemented\";\n            },\n            typeMap[RDPDR_TYPE.IRP_MJ_LOCK_CONTROL] = \"LockControl\";\n            if(!typeMap.hasOwnProperty(parsed.majorFunction)){\n               return null;\n            }\n            let resultType = typeMap[parsed.majorFunction];\n            if(typeof resultType === 'function'){\n               return resultType();\n            }\n            return resultType;\n         }\n      };\n      let serverVersionInfo = protocolHelper.parse(streamHelper, \"RDP_DR_DEVICE_IOREQUEST\", param);\n      return true;\n   };\n\n   let handleUserLoggedon = function() {\n      console.error(\"handleUserLoggedon\");\n      userLoggedOn = true;\n      let ret = true;\n      if ((serverVersion === TDSR_TYPE.VERSION.TSDR_VERSION_V1) || // Backward compatible\n         (serverVersion !== TDSR_TYPE.VERSION.TSDR_VERSION_UNKNOWN && pPolicy)) {\n         ret = onUserReady();\n      }\n      return ret;\n   };\n\n   let processData = function(stream) {\n      console.error(\"get tsdr message\" + stream);\n      let type = '';\n      let offset = 4;\n      let streamHelper = new StreamHelper(stream.params[0]);\n      let rdpdrHeader = protocolHelper.parse(streamHelper, \"RDPDR_HEADER\");\n      console.log(rdpdrHeader);\n      let ret = true;\n      if (rdpdrHeader.component === TDSR_TYPE.TSDR_COMPONENT_CAPS) {\n         /*\n          * For backward compatibilty and potential race condition,\n          * OnUserReady will only be called when\n          * User_Login, version and policy are all received.\n          */\n         //lock policy\n         if (rdpdrHeader.packetId === TDSR_TYPE.TSDR_PACKID_VERSION_EXCHANGE) {\n            ret = handleVersionExchange();\n            if (!!userLoggedOn && (pPolicy || serverVersion === TDSR_TYPE.VERSION.TSDR_VERSION_V1)) {\n               onUserReady();\n            }\n         } else if (rdpdrHeader.packetId === TDSR_TYPE.TSDR_PACKID_AGENT_POLICY) {\n            ret = handleTsdrPolicy();\n            if (!!userLoggedOn && serverVersion !== TDSR_TYPE.VERSION.TSDR_VERSION_UNKNOWN) {\n               onUserReady();\n            }\n         }\n      } else if (rdpdrHeader.component !== RDPDR_TYPE.RDPDR_CTYP_CORE) {\n         console.error(\"Received packet with component != CORE component:\" + rdpdrHeader.component + \"\\n\");\n         return FALSE;\n      }\n      /* Handle message */\n      switch (rdpdrHeader.packetId) {\n         case RDPDR_TYPE.PAKID_CORE_SERVER_ANNOUNCE://DR_CORE_SERVER_ANNOUNCE_REQ\n            // exchange tsdr version\n            streamHelper.reset();\n            ret = handleServerAnnounce(streamHelper);\n            break;\n         case RDPDR_TYPE.PAKID_CORE_SERVER_CAPABILITY://DR_CORE_CAPABILITY_REQ\n            // exchange capability\n            ret = handleServerCapability(streamHelper);\n            break;\n         case RDPDR_TYPE.PAKID_CORE_DEVICE_REPLY:\n            ret = handleDeviceReply();\n            break;\n         case RDPDR_TYPE.PAKID_CORE_USER_LOGGEDON:\n            //AutoMutexLock lock(m_policyLock);\n            ret = handleUserLoggedon();\n            break;\n         case RDPDR_TYPE.PAKID_CORE_DEVICE_IOREQUEST:\n            ret = handleIoRequest(streamHelper);\n            break;\n         default:\n            ret = true;\n      }\n      return ret;\n   };\n   return {\n      //onRequestCallback is function([function] onDone), where onDone is function([bool] success, [object]param)\n      init: function(onRequestCallback, onDone) {\n         //rdpdrChannel.init(OnData);\n         onDone();\n      },\n      //command, type, param, onDone, onError\n      send: function(request) {\n         if (protocolHelper.isInvalidType(request.param.type)) {\n            return;\n         }\n         let dataBuffer = protocolHelper.streamify(request.param);\n         //tsdrChannel.invoke();\n         /*tsdrChannel.send({\n            command: request.command,\n            type: request.type,\n            param: dataBuffer,\n            onDone: request.onDone,\n            onAbort: request.onAbort,\n            //object/object-name/object-id\n         });*/\n      },\n      handleTSDRFromServer: processData //rdpdrChannel.processData\n   };\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/channels/rdpdr-channel-manager.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport RdpdrChannelManager from './rdpdr-channel-manager';\n\nexport default function tsdrChannelService() {\n   let tsdrChannelNamePrefix = 'RPC#tsdr#';\n\n   function ChannelObj(vdpService) {\n      // currently, tsdr channel has ? object names\n      this.desiredObjectNames = ['tsdrControlObj', 'tsdrDataObj'];\n\n      this.vdpService = vdpService;\n\n      this.msgHandlers = [];\n\n      this.tsdrChannel = null;\n   }\n\n   ChannelObj.prototype.init = function() {\n      let self = this;\n      this.vdpService.addChannelCreatedListener(function(channel) {\n         if (channel.name.indexOf(tsdrChannelNamePrefix) ===\n            0) {\n            console.error(\"connect channel to \"+channel.name);\n            if (self.vdpService.connectChannel(channel, self.desiredObjectNames)) {\n               JSCDKLogger.error(\n                  'Successfully accepted tsdr channel');\n            } else {\n               JSCDKLogger.error('Failed to open tsdr channel');\n               return;\n            }\n\n            self.tsdrChannel = channel;\n\n            channel.onReady = function(object) {\n               console.error(\n                  'tsdr channel is ready for traffic.', object);\n\n               if (object.name === self.desiredObjectNames[0]) {\n                  self.tsdrControlObj = object;\n                  console.error(\n                     'tsdr data channel is ready for traffic.');\n               } else if (object.name === self.desiredObjectNames[1]) {\n                  self.tsdrDataObj = object;\n                  console.error(\n                     'tsdr control channel is ready for traffic.');\n               }\n               if (self.onReady) {\n                  self.onReady(object.name);\n               }\n            };\n\n            channel.onDisconnect = function() {\n               self.tsdrChannel = null;\n               JSCDKLogger.error(\n                  'tsdr channel was closed by the remote desktop.');\n            };\n\n            channel.onInvoke = function(tsdr) {\n               console.error(\"!!!!!!!!!!!invoke tsdr\",tsdr);\n               self.handleTSDRFromServer(tsdr);\n            };\n         }\n      });\n\n      ChannelObj.prototype.onReady = function(objectName){\n         console.error(\"channel object \" + objectName + \" ready.\");\n         if(objectName === self.desiredObjectNames[0]){\n            self.addMessageHandler(new RdpdrChannelManager(self.tsdrChannel, self.tsdrControlObj));\n         }\n      };\n      ChannelObj.prototype.handleTSDRFromServer = function(tsdr) {\n         let i, ret;\n         console.error(\"!!!!!!!!!!!\",tsdr);\n\n         for (i = 0; i < this.msgHandlers.length; i++) {\n            ret = this.msgHandlers[i].handleTSDRFromServer(tsdr);\n            if (ret === 0) { // means the message has been consumed\n               break;\n            }\n         }\n      };\n\n      ChannelObj.prototype.addMessageHandler = function(handler) {\n         this.msgHandlers.push(handler);\n      };\n\n      ChannelObj.prototype.invoke = function(param) {\n         console.error(\"!!!!!!!!!!!\",param);\n         return this.tsdrChannel.invoke(param);\n      };\n   };\n\n   return {\n      getChannel: function(vdpService) {\n         return new ChannelObj(vdpService);\n      }\n   };\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/channels/tsdr-channel.js","/********************************************************\n * Copyright 2016 VMware, Inc.  All rights reserved.\n ********************************************************/\n\n\nimport angular from 'angular';\nimport $ from 'jquery';\nimport helpTemplate from '../common/clip_ft_help_template.html';\nimport cpTemplate from './clipboard_template.html';\nimport MKSVchan from '../channels/mksvchan';\n\nexport function clipboard($window,\n                          panelService,\n                          $timeout) {\n   return {\n      restrict: 'E',\n      replace: true, // Replace with the template below\n      templateUrl: cpTemplate,\n      scope: true,\n      link: function(scope, element) {\n         let savedClipboardHeight = 0,\n            panelServiceInstance = panelService.getService();\n\n         panelServiceInstance.addPanelElement('clipboard', element);\n\n         element.resizable({\n            containment: \"document\"\n         }).draggable({\n            containment: \"window\",\n            handle: \".clipboard-handle\",\n            start: function(event, ui) {\n               element.css(\"z-index\", panelServiceInstance.getNewZIndex());\n            }\n         });\n\n         scope.windowResizeHandler = panelServiceInstance\n            .windowResizeHandler(scope, 'showClipboardPanel',\n               element);\n\n         angular.element($window)\n            .bind('resize', scope.windowResizeHandler);\n\n         // resizes the clipboard contents to fit within the clipboard\n         // panel\n         scope.resizeClipboardContents = function() {\n            if (scope.showClipboardText) {\n               /**\n                * clipboard contents sit under the label and fills the\n                * remaining panel space. Its height is panel height minus\n                * label height.\n                *\n                * 39 is the header height and 19 is the footer height.\n                */\n               let newHeight = element.outerHeight() - 36 - 19;\n               $('.clipboard-content').css('height', newHeight);\n            }\n         };\n\n         /*\n          * minimizes/restores the clipboard panel. Needs to remember the panel\n          * height on minimize and then set the height on restore.\n          */\n         scope.toggleClipboardText = function() {\n            if (scope.showClipboardText) {\n               savedClipboardHeight = element.outerHeight();\n               element.addClass('minimized');\n            } else {\n               element.css('height', savedClipboardHeight);\n               element.removeClass('minimized');\n               scope.resizeClipboardContents();\n            }\n            scope.showClipboardText = !scope.showClipboardText;\n         };\n\n         element.bind('resize', scope.resizeClipboardContents);\n\n         scope.$on('$destroy', function() {\n            element.unbind('resize', scope.resizeClipboardContents);\n            angular.element($window)\n               .unbind('resize', scope.windowResizeHandler);\n         });\n         $timeout(function() {\n            scope.resizeClipboardContents();\n         });\n      }\n   };\n}\n\nexport function clipboardController(AB, $scope, $rootScope, $timeout, ngDialog,\n                                    wmksService, _,\n                                    wmksServiceEventHandler, panelService) {\n   let defaultText = '';\n   $scope.clipboard = {text: defaultText};\n   $scope.clipboardPolicy = {text: ''};\n   $scope.clipboardInput = null;\n   $scope.focused = false;\n   $scope.showNotification = null;\n   $scope.showClipboardPanel = false;\n   $scope.showClipboardText = true;\n   $scope.toggleClipboardText = null;\n   $scope.hasClipboardData = false;\n   $scope.clipboardReady = false;\n   $scope.copyEnabled = true;\n   $scope.pasteEnabled = true;\n   $scope.isMacOS = WMKS.BROWSER.isMacOS;\n   $scope.windowResizeHandler = null;\n   $scope.resizeClipboardContents = null;\n\n   $scope.setDefaultPolicyText = function() {\n      let policyText = '';\n      if (!$scope.clipboardReady) {\n         policyText = _('COPY_PASTE_UNAVAILABLE_CONTENT');\n      } else if ($scope.clipboardReady && $scope.copyEnabled &&\n         $scope.pasteEnabled) {\n         policyText = _('COPY_PASTE_ENABLED_CONTENT');\n      } else if ($scope.clipboardReady && $scope.copyEnabled &&\n         !$scope.pasteEnabled) {\n         policyText = _('PASTE_DISABLED_CONTENT');\n      } else if ($scope.clipboardReady && !$scope.copyEnabled &&\n         $scope.pasteEnabled) {\n         policyText = _('COPY_DISABLED_CONTENT');\n      } else if ($scope.clipboardReady && !$scope.copyEnabled &&\n         !$scope.pasteEnabled) {\n         policyText = _('COPY_PASTE_DISABLED_CONTENT');\n      }\n      $scope.clipboardPolicy.text = policyText;\n   };\n\n   // Redirects input to the clipboard's hidden input\n   $scope.focusInput = function() {\n      if ($scope.clipboardInput) {\n         $timeout(function() {\n            $scope.clipboardInput.select();\n         });\n      }\n   };\n\n   // Clears clipboard contents\n   $scope.clipboardClear = function() {\n      $scope.clipboard.text = defaultText;\n      wmksService.clearClipboard();\n      $scope.showNotification('CLIPBOARD_CLEARED_M');\n      $scope.hasClipboardData = false;\n   };\n\n   /*\n    * Intercepts a copy event and replaces the copied text with the current\n    * clipboard contents.\n    */\n   $scope.clipboardCopy = function(e) {\n      AB.LOGGER.log(\"Copy operation is captured.\");\n      if (!$scope.hasClipboardData) {\n         AB.LOGGER.log(\"There is no data in the clipboard.\");\n         return;\n      }\n\n      AB.UTIL.setClipboardText(e, $scope.clipboard.text);\n\n      $scope.showNotification('CLIPBOARD_COPIED_M');\n      $scope.focusInput();\n      e.preventDefault();\n   };\n\n   /*\n    * Intercept a paste event to get paste data, then update clipboard and send\n    * the appropriate call to update the server clipboard.\n    */\n   $scope.clipboardPaste = function(e) {\n      let text;\n\n      AB.LOGGER.log(\n         \"Paste operation is captured and data is sent to remote server.\");\n      text = AB.UTIL.getClipboardText(e);\n      wmksService.sendClipboardText(text);\n\n      $scope.focusInput();\n      e.preventDefault();\n   };\n\n   // Handle clipboard panel focus event\n   $scope.clipboardFocus = function() {\n      if ($scope.showClipboardPanel) {\n         $scope.focused = true;\n         panelService.getService().onFocus('clipboard');\n      }\n   };\n\n   // Handle clipboard panel blur event\n   $scope.clipboardBlur = function() {\n      $scope.focused = false;\n   };\n\n   // shows/hides the clipboard panel\n   $scope.toggleClipboardPanel = function($event) {\n      $scope.showClipboardPanel = !$scope.showClipboardPanel;\n      if ($scope.showClipboardPanel) {\n         $timeout(function() {\n            $scope.windowResizeHandler();\n            $scope.resizeClipboardContents();\n         });\n      }\n\n      if ($event) {\n         $event.stopPropagation();\n         $event.preventDefault();\n      }\n      $scope.focusInput();\n   };\n\n   $scope.openClipboardHelp = function() {\n\n      let modKey = $scope.isMacOS() ? _('CMD_KEY') : _('CTRL_KEY');\n\n      ngDialog.open({\n         name: \"ClipboardHelpWindow\", // dialog name\n         templateUrl: helpTemplate, // dialog template\n         className: \"clipboard-help-window\", // CSS class\n         data: {\n            title: 'CLIPBOARD_HELP_DIALOG_T',\n            msg: 'CLIPBOARD_HELP_DIALOG_M',\n            modKey: modKey\n         },\n         showClose: false, // do not show close button\n         closeByEscape: true, // allow escape to close window\n         closeByDocument: true // allow clicking on background to close\n      });\n   };\n\n   // Listen to server clipboard updates and sync panel with remote\n   // clipboard data\n   wmksServiceEventHandler.addEventListener('clipboardChanged',\n      function(data, error) {\n         $timeout(function() {\n            AB.LOGGER.log(\n               \"Clipboard data in the remote server is synced to client.\");\n            if (data === null) {\n               $scope.showNotification('CLIPBOARD_FAILED_M');\n               return;\n            }\n\n            $scope.clipboard.text = data;\n            $scope.hasClipboardData = true;\n\n            if (error ===\n               MKSVchan.CLIPBOARD_ERROR.MAX_LIMIT_EXCEEDED) {\n               $scope.showNotification('CLIPBOARD_TRUNCATED_M');\n            } else {\n               $scope.showNotification('CLIPBOARD_SYNCED_M');\n            }\n         });\n      });\n\n   wmksServiceEventHandler.addEventListener(\n      \"clipboardCapabilitiesChanged\",\n      function(clipboardReady, copyEnabled, pasteEnabled) {\n         $timeout(function() {\n            $scope.clipboardReady = clipboardReady;\n            $scope.copyEnabled = copyEnabled;\n            $scope.pasteEnabled = pasteEnabled;\n            $scope.setDefaultPolicyText();\n         });\n      }\n   );\n\n   wmksServiceEventHandler.addEventListener('clipboardRequestFailed',\n      function(data) {\n         $scope.showNotification('CLIPBOARD_FAILED_M');\n      });\n   wmksServiceEventHandler.listenerReadyForModule(\n      wmksServiceEventHandler.MODULE_NAME.CLIPBOARD);\n\n   $rootScope.$on('toggleClipboardPanel', $scope.toggleClipboardPanel);\n}\n\nexport function clipboardInput() {\n   return {\n      restrict: 'E',\n      replace: true, // Replace with the template below\n      template: \"<input></input>\",\n      link: function(scope, element) {\n         scope.clipboardInput = element;\n         element.val(\" \");\n      }\n   };\n}\n\nexport function panelNotification(_) {\n   return {\n      restrict: 'E',\n      replace: true, // Replace with the template below\n      template: \"<div></div>\",\n      link: function(scope, element) {\n         element.addClass(\"hidden\");\n         element.addClass('clipboard-notification');\n         element.addClass('noselect');\n\n         // Removes notification element from display at end of fade\n         // animation\n         element.bind('transitionend oTransitionEnd webkitTransitionEnd',\n            function() {\n               element.addClass(\"hidden\");\n               element.removeClass(\"hideme\");\n            });\n\n         // Shows a popup notification with the given text that then fades\n         // out\n         scope.showNotification = function(msgKey) {\n            let temp;\n            element.html(_(msgKey));\n            element.removeClass(\"hidden\");\n            element.removeClass(\"hideme\");\n            /*\n             * Accessing offsetHeight forces reflow, which updates classes and\n             * styling and restarts the fadeout animation. We don't need to use\n             * the value, but we have to assign it to something to prevent lint\n             * errors.\n             */\n            temp = element[0].offsetHeight;\n            element.addClass(\"hideme\");\n         };\n      }\n   };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/clipboard/clipboard.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * ajax-busy-overlay.js --\n *\n * Module to implement a busy overlay to indicate server is busy.\n *\n */\n\nexport function ajaxBusyOverlay() {\n   return {\n      restrict: 'E',\n      scope: {},\n      controller: 'ajaxBusyOverlayController',\n      template: '<div ng-show=\"showAjaxBusyOverlay\"><div class=\"ajax-busy-overlay\"/><div class=\"ajax-busy-icon\"/><div>'\n   };\n}\n\nexport function ajaxBusyOverlayController($scope, $rootScope, $timeout) {\n   // Variable that toggles the visibility of ajax busy overlay\n   // $scope.showAjaxBusyOverlay = false;\n   $scope.showAjaxBusyOverlay = false;\n\n   // Listen on the root scope for the event that tells us to display\n   // ajax busy overlay.\n   $rootScope.$on('toggleBusyOverlay', function(e, flag) {\n      // We need a timeout here for it might be called in the digest or\n      // not in digest process.\n      $timeout(function() {\n         if (typeof flag !== \"undefined\") {\n            $scope.showAjaxBusyOverlay = flag;\n         } else {\n            $scope.showAjaxBusyOverlay = !$scope.showAjaxBusyOverlay;\n         }\n      });\n   });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/ajax-busy-overlay.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * applicationsessions-model.js --\n *\n * Module to provide application sessions information to decide session usage\n * when launching from Sidebar, this should be realized in commen folder as the\n * model for manipulate items, but put it here for now.\n *\n * The async API of getApplicationSessions is caused by using the jscdk to get\n * the list from the broker.\n */\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\n\nexport default function applicationSessionsModel(jscdkDesktopInvoker,\n   viewClientModel,\n   constants) {\n   let applicationSessions = null,\n      callbackBuff = null;\n\n   /**\n    * should be in the commen codes, but put it here now\n    */\n   function getApplicationSessions(data, targetList) {\n      let applicationSessionSet,\n         applicationSessionKey;\n      if (data && data.content) {\n         //store the application-sessions localContent\n         applicationSessionSet = data.content.applicationSessions;\n         for (applicationSessionKey in applicationSessionSet) {\n            /* istanbul ignore else */\n            if (applicationSessionSet.hasOwnProperty(\n                  applicationSessionKey)) {\n               targetList.push(\n                  applicationSessionSet[applicationSessionKey]);\n            }\n         }\n      }\n   }\n\n   /**\n    * handle the readed object from safe storage with key(EntitledItems),\n    * and construct entitled item.\n    */\n   function onStorageReaded(localContent) {\n      // set the list using localContent\n      applicationSessions = [];\n      getApplicationSessions(localContent, applicationSessions);\n      // clear buff first in case callback will call\n      // getApplicationSessions again\n      /* istanbul ignore else */\n      if (!!callbackBuff) {\n         let callbackFunc = callbackBuff;\n         callbackBuff = null;\n         callbackFunc(applicationSessions);\n      }\n   }\n\n   /**\n    * ApplicationSessionModel.getApplicationSessions\n    *\n    * Return a array of application session\n    *\n    */\n   this.getApplicationSessions =\n      function(callback, jscdkHandler, useBuffedData) {\n         /* istanbul ignore if */\n         if (!!callbackBuff) {\n            JSCDKLogger.debug(\n               \"Error: the getApplicationSessions do not support parallal\" +\n               \" usage\");\n            return;\n         }\n         if (typeof(callback) !== \"function\") {\n            JSCDKLogger.debug(\n               \"Error: the callback passed to getApplicationSessions is\" +\n               \" not a function\");\n            return;\n         }\n         if (applicationSessions !== null && useBuffedData) {\n            JSCDKLogger.debug(\n               \"applicationSessions is already readed and used\");\n            callback(applicationSessions);\n         } else {\n            JSCDKLogger.debug(\"applicationSessions not fully inited\");\n\n            jscdkHandler.handlerGetLaunchItems = function(localContent) {\n               onStorageReaded(localContent);\n            };\n            callbackBuff = callback;\n            viewClientModel.onReady(() => {\n               /**\n                * sync model into jscdk to init environment info for get-launch-item to\n                * support: https://jira-hzn.eng.vmware.com/browse/DPM-1211\n                * decouple from current _getEnvironmentInfo since they are different,\n                * and under current code structure better to be seperated.\n                */\n               let environmentInfo = {};\n\n               if (!!viewClientModel.ipAddress) {\n                  environmentInfo['IP_Address'] =\n                     viewClientModel.ipAddress;\n                  environmentInfo['Machine_Name'] =\n                     viewClientModel.machineName;\n               }\n               if (!!viewClientModel.clientID) {\n                  environmentInfo['Client_ID'] = viewClientModel.clientID;\n               }\n               environmentInfo['Client_Version'] = viewClientModel.version + '-' +\n                  viewClientModel.buildNum;\n               environmentInfo['Type'] = constants.viewclientType;\n               jscdkDesktopInvoker.setEnvironmentInfo(environmentInfo);\n               jscdkDesktopInvoker.sendLaunchItemsXML();\n            });\n         }\n      };\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/applicationsessions-model.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * audio-service.js --\n *\n * Factory service for playing audio.\n *\n */\n\n\nexport default function audioService(AB, $window, WMKS) {\n   let audioEnabled = false,\n      audioUseOpus = false,\n      audioUseAac = false,\n      audioUseWebAudioAPI = false,\n\n      MAX_CHANNEL_NUMBER = 2,\n      MSG_TYPE_CHANNEL_VOLUME_MUTE = 0,\n      MSG_TYPE_CHANNEL_VOLUME_CHANGE = 1,\n\n      init,\n      AudioServiceFactory = null,\n      globalAudioContext = null;\n\n   /**\n    * init\n    *\n    * Test browser API compatibility and set proper global variables.\n    *\n    */\n   init = function() {\n      let test;\n      try {\n         test = new Audio();\n         $window.URL = $window.URL || $window.webkitURL;\n         audioUseOpus =\n            test.canPlayType('audio/ogg; codecs=\"opus\"') === 'probably';\n         audioUseAac =\n            test.canPlayType('audio/mp4; codecs=\"mp4a.40.2\"') === 'probably';\n         audioEnabled = true;\n         AB.LOGGER.info(\n            'HTML5 Audio is available, Opus = ' + audioUseOpus + \" AAC: \" +\n            audioUseAac);\n      } catch (e2) {\n         AB.LOGGER.info('HTML5 Audio is unavailable.');\n      }\n\n      try {\n         $window.AudioContext =\n            $window.AudioContext || $window.webkitAudioContext;\n         globalAudioContext = new AudioContext();\n\n         /*\n          * This is necessary due to:\n          * https://developer.mozilla.org/en-US/docs/Web_Audio_API/Porting_webkitAudioContext_code_to_standards_based_AudioContext\n          */\n         if (typeof $window.AudioContext.prototype.createGain ===\n            'undefined') {\n            $window.AudioContext.prototype.createGain =\n               $window.AudioContext.prototype.createGainNode;\n         }\n\n         audioUseWebAudioAPI = true;\n         AB.LOGGER.info('Web Audio API support is available.');\n      } catch (e) {\n         globalAudioContext = null;\n         AB.LOGGER.info('Web Audio API support is unavailable.');\n      }\n   };\n\n   /**\n    * AudioServiceFactory\n    *\n    * Constructor function.\n    *\n    */\n   AudioServiceFactory = function() {\n      this.audioNextTime = 0;\n      this.volumeInfo = [];\n      this.isMuted = false;\n      this.lastUpdateChannelId = 0;\n      // We support 2 channels at most. The default value is 1.\n      for (let i = 0; i < MAX_CHANNEL_NUMBER; i++) {\n         this.volumeInfo.push(1.0);\n      }\n   };\n\n   /**\n    * AudioServiceFactory.isAudioEnabled\n    *\n    * Return whether audio is enabled on the browser.\n    *\n    */\n   AudioServiceFactory.prototype.isAudioEnabled = function() {\n      return audioEnabled;\n   };\n\n   /**\n    * AudioServiceFactory.updateAudioMixer\n    *\n    * Update the audio mixer for each channel.\n    *\n    */\n   AudioServiceFactory.prototype.updateAudioMixer =\n      function(audioMixerInfo) {\n         let volumeNumber = 0;\n         let db;\n         if (audioMixerInfo.msgType === MSG_TYPE_CHANNEL_VOLUME_CHANGE) {\n            /*\n             * Convert from volume level ticks to dB.\n             */\n            db = audioMixerInfo.data / 0x10000;\n\n            /*\n             * Solve for the amplitude of the dB.\n             * dB = 10 log_10(A^2) = 20 log_20(A); A = 10^(dB / 20).\n             */\n            volumeNumber = Math.pow(10.0, db / 20);\n\n            /*\n             * Only allow attenuation through sndconvert.\n             */\n            if (volumeNumber > 1.0) {\n               volumeNumber = 1.0;\n            }\n            this.volumeInfo[audioMixerInfo.channelId] = volumeNumber;\n            this.lastUpdateChannelId = audioMixerInfo.channelId;\n         } else if (audioMixerInfo.msgType ===\n            MSG_TYPE_CHANNEL_VOLUME_MUTE) {\n            // Audio muted update.\n            this.isMuted = !!audioMixerInfo.data;\n         } else {\n            return;\n         }\n      };\n\n   /**\n    * AudioServiceFactory.canAudioUseOpus\n    *\n    * Return whether audio Opus is supported on the browser.\n    *\n    */\n   AudioServiceFactory.prototype.canAudioUseOpus = function() {\n      return audioUseOpus;\n   };\n\n   /**\n    * AudioServiceFactory.canAudioUseAac\n    *\n    * Return whether audio Aac is supported on the browser.\n    *\n    */\n   AudioServiceFactory.prototype.canAudioUseAac = function() {\n      return audioUseAac;\n   };\n\n   /**\n    * AudioServiceFactory.initializeAudioForTouch\n    *\n    * Initialize variables for touch device.\n    *\n    */\n   AudioServiceFactory.prototype.initializeAudioForTouch = function() {\n      let silentTone;\n      let gainNode;\n\n      if (!audioUseWebAudioAPI) {\n         // We only need to do this for the Web Audio API.\n         return true;\n      }\n\n      AB.LOGGER.trace('Initializing audio for touch.');\n\n      try {\n         silentTone = globalAudioContext.createOscillator();\n         gainNode = globalAudioContext.createGain();\n\n         gainNode.gain.value = 0;\n         gainNode.connect(globalAudioContext.destination);\n\n         silentTone.type = 'sine';\n         silentTone.frequency.value = 200;\n         silentTone.connect(gainNode);\n         silentTone.noteOn(0);\n         silentTone.stop(0);\n      } catch (e) {\n         AB.LOGGER.info('Fail to Initialize audio for touch.');\n      }\n\n      /*\n       * Ironically, audio should now be unmuted.\n       * Explanation: http://stackoverflow.com/questions/12517000/no-sound-on-ios-6-web-audio-api\n       */\n      return true;\n   };\n\n   /**\n    * AudioServiceFactory.playAudio\n    *\n    * Play a clip of audio information.\n    *\n    * @params audioInfo audio byte streams.\n    */\n   AudioServiceFactory.prototype.playAudio = function(audioInfo) {\n      let buffer = new ArrayBuffer(audioInfo.data.length);\n      let bufferView = new Uint8Array(buffer);\n\n      AB.LOGGER.trace(\n         'Received ' + audioInfo.data.length + ' audio bytes.');\n\n      for (let i = 0; i < audioInfo.data.length; i++) {\n         bufferView[i] = audioInfo.data[i];\n      }\n\n      if (globalAudioContext) {\n         // Web Audio API\n         this.playAudioWithWebAudioAPI(audioInfo, buffer);\n      } else {\n         // HTML5 audio object\n         this.playAudioWithAudioObject(audioInfo, buffer);\n      }\n   };\n\n   /**\n    *\n    * AudioServiceFactory.createBufferSource\n    *\n    * This is to work around Web Audio API portability issues across\n    * browsers. See:\n    * https://developer.mozilla.org/en-US/docs/Web_Audio_API/Porting_webkitAudioContext_code_to_standards_based_AudioContext\n    *\n    */\n   AudioServiceFactory.prototype.createBufferSource = function() {\n      let source = globalAudioContext.createBufferSource();\n      if (typeof source.start === 'undefined') {\n         source.start = source.noteOn;\n      }\n      if (typeof source.stop === 'undefined') {\n         source.stop = source.noteOff;\n      }\n      return source;\n   };\n\n   /**\n    *\n    * playAudioWithWebAudioAPI\n    *\n    * Play audio using the Web Audio API.\n    *\n    * @params audioInfo audio byte streams.\n    * @params buffer    buffer source.\n    */\n   AudioServiceFactory.prototype.playAudioWithWebAudioAPI =\n      function(audioInfo, buffer) {\n         let self = this;\n\n         globalAudioContext.decodeAudioData(buffer,\n            function(audioBuffer) {\n               let source = self.createBufferSource();\n               let gainNodeArray = [];\n               let curTime = globalAudioContext.currentTime;\n               let offset = self.audioNextTime - curTime;\n               let delay = Math.max(offset, 0);\n               let startTime = curTime + delay;\n               let duration = audioInfo.containerSize / 1000.0;\n               let overlap = audioInfo.sampleRate / 1000.0;\n               let durationDiff = audioBuffer.duration - duration;\n               let fadeInBy = startTime + overlap;\n               let fadeOutAt = startTime + duration - overlap;\n               let endTime = startTime + duration;\n               let numberOfChannels = audioInfo.numChannels;\n               let channelSplitter = null;\n               let channelMerger = null;\n\n               for (let i = 0; i < numberOfChannels; i++) {\n                  gainNodeArray.push(globalAudioContext.createGain());\n               }\n\n               /*\n                * \"audioBuffer.duration\" will always be slightly larger or\n                * slightly smaller than the original PCM duration which\n                * is sent over as \"audioInfo.containerSize\". We want to\n                * keep the original duration.\n                *\n                * \"overlap\" is the amount of time which this clip\n                * overlaps with the previous one. We encode redundant\n                * data so we can effectively crossfade and minimize\n                * any audio glitches at the seams caused by stitching\n                * together lossy clips. We want the next track to start\n                * at the overlap point and then we crossfade between the\n                * two.\n                */\n               self.audioNextTime = startTime + duration - overlap;\n\n               // Extensive log computation, hence moving it inside a log\n               // level check.\n               if (AB.LOGGER.LOG_LEVEL === AB.LOGGER.LEVEL_TRACE) {\n                  AB.LOGGER.trace('Playing audio (Web Audio API)');\n                  AB.LOGGER.trace('Offset: ' + offset + 's' +\n                     ', delay: ' + delay + 's' +\n                     ', current time: ' + curTime);\n                  AB.LOGGER.trace(\n                     'Sample rate: ' + audioBuffer.sampleRate +\n                     ', frames: ' + audioBuffer.length +\n                     ', channels: ' + audioBuffer.numberOfChannels);\n                  AB.LOGGER.trace(\n                     'Lossy duration: ' + audioBuffer.duration + 's' +\n                     ', PCM duration: ' + duration + 's' +\n                     ', diff: ' + durationDiff + 's');\n                  AB.LOGGER.trace('Start: ' + startTime + 's' +\n                     ', fade in by: ' + fadeInBy + 's' +\n                     ', fade out at: ' + fadeOutAt + 's');\n                  AB.LOGGER.trace('End: ' + endTime + 's' +\n                     ', overlap: ' + overlap + 's');\n               }\n\n               source.buffer = audioBuffer;\n               if (numberOfChannels === 1) {\n                  source.connect(gainNodeArray[0]);\n                  gainNodeArray[0].connect(\n                     globalAudioContext.destination);\n               } else if (numberOfChannels === 2) {\n                  /*\n                   * We need to split audio track to left and right channels. Add a\n                   * GainNode to control the volume for each channel. Finally, merge\n                   * the two channel to an audio track. Here is an example from mozilla.\n                   * See: https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createChannelSplitter\n                   */\n                  channelSplitter =\n                     globalAudioContext.createChannelSplitter(2);\n                  channelMerger =\n                     globalAudioContext.createChannelMerger(2);\n                  source.connect(channelSplitter);\n                  for (let i = 0; i < numberOfChannels; i++) {\n                     channelSplitter.connect(gainNodeArray[i], i);\n                     gainNodeArray[i].connect(channelMerger, 0, i);\n                  }\n                  channelMerger.connect(globalAudioContext.destination);\n               }\n\n               /*\n                * Fade in...\n                */\n               if (overlap && !self.isMuted) {\n                  for (let i = 0; i < numberOfChannels; i++) {\n                     gainNodeArray[i].gain.linearRampToValueAtTime(0,\n                        startTime);\n                     gainNodeArray[i].gain.linearRampToValueAtTime(\n                        self.volumeInfo[i], fadeInBy);\n                  }\n               }\n\n               for (let i = 0; i < numberOfChannels; i++) {\n                  gainNodeArray[i].gain.setValueAtTime(\n                     (!self.isMuted ? self.volumeInfo[i] : 0), startTime);\n               }\n\n               source.start(startTime);\n\n               /*\n                * Fade out...\n                */\n               if (overlap && !self.isMuted) {\n                  for (let i = 0; i < numberOfChannels; i++) {\n                     gainNodeArray[i].gain.linearRampToValueAtTime(\n                        self.volumeInfo[i], fadeOutAt);\n                     gainNodeArray[i].gain.linearRampToValueAtTime(0,\n                        endTime);\n                  }\n               }\n            },\n            function() {\n               AB.LOGGER.trace('Error decoding audio data.');\n            });\n      };\n\n   /**\n    *\n    * playAudioWithAudioObject\n    *\n    * Play audio using an HTML5 audio object.\n    *\n    * @params audioInfo audio byte streams.\n    * @params buffer    buffer source.\n    */\n   AudioServiceFactory.prototype.playAudioWithAudioObject =\n      function(audioInfo, buffer) {\n         let self = this;\n         let audio = new Audio();\n         let audioType =\n            (audioInfo.flags & WMKS.VNCDecoder.prototype.audioflagFmtMask)\n            >> WMKS.VNCDecoder.prototype.audioflagFmtShift;\n         let mimeType =\n            (audioType === WMKS.VNCDecoder.prototype.audioFlagFmtClipsOpus)\n               ? 'audio/ogg' : 'audio/mp4';\n         let blob = new Blob([buffer], {type: mimeType});\n\n         let playClip = function() {\n            let curTime = new Date().getTime();\n            // audioInfo.containerSize is really our duration!\n            let duration = audioInfo.containerSize;\n            // audioInfo.sampleRate is really our overlap!\n            let overlap = audioInfo.sampleRate;\n            let offset = self.audioNextTime - curTime;\n            let delay = Math.max(offset, 0);\n\n            self.audioNextTime = curTime + delay + duration - overlap;\n\n            if (AB.LOGGER.LOG_LEVEL === AB.LOGGER.LEVEL_TRACE) {\n               AB.LOGGER.trace('Playing audio (HTML5 Audio object)');\n               AB.LOGGER.trace('Offset: ' + offset + 'ms' +\n                  ', delay: ' + delay + 'ms' +\n                  ', current time: ' + curTime +\n                  ', duration: ' + duration + 'ms' +\n                  ', overlap: ' + overlap + 'ms');\n            }\n            setTimeout(function() {\n               audio.muted = self.isMuted;\n               if (!self.isMuted) {\n                  audio.volume =\n                     self.volumeInfo[self.lastUpdateChannelId];\n               }\n               audio.play();\n               if (overlap) {\n                  /*\n                   * The audio object doesn't really support our\n                   * crossfade trick so start playing after any\n                   * overlap.\n                   */\n                  try {\n                     /*\n                      * This can throw an exception if the metadata\n                      * hasn't been loaded yet.\n                      */\n                     audio.currentTime = overlap / 1000.0;\n                  } catch (e) {\n                     AB.LOGGER.warn('Error setting currentTime!');\n                  }\n               }\n               setTimeout(function() {\n                  $window.URL.revokeObjectURL(audio.src);\n               }, duration + 20);\n            }, delay);\n         };\n\n         audio.src = $window.URL.createObjectURL(blob);\n         audio.addEventListener('loadeddata', playClip, false);\n      };\n\n   // Initialize all global browser compatibility variables.\n   init();\n   return {\n      /**\n       *\n       * getAudioServiceInstance\n       *\n       * Return an audio service instance.\n       *\n       */\n      getAudioServiceInstance: function() {\n         return new AudioServiceFactory();\n      }\n   };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/audio-service.js","/******************************************************************************\n * Copyright 2014-2017 VMware, Inc.  All rights reserved.\n *****************************************************************************/\n\n/**\n *------------------------------------------------------------------------------\n *\n * blast-wmks-service.js\n *\n * Blast WMKS client implementation for use with NGP.\n * AB.CONST and WMKS are pre-requisite namespaces.\n *\n *------------------------------------------------------------------------------\n */\n\nimport angular from 'angular';\nimport AB from './appblast-util';\nimport errorDialogTemplate from '../../common/commondialog/dialog_service_error.html';\nimport confirmDialogTemplate from '../../common/commondialog/dialog_service_confirm.html';\n\n// Todo Remove those two constants.\nAB.CONST.BlastWMKS = {\n   BSG_TIMEOUT_MS: (2 * 60 * 1000) - 1,      // Just under 2 mins.\n   INIT_BACKOFF_DELAY_MS: 1000,\n   REQUEST_DISCONNECT_TIMEOUT: 5000,\n   MAP_META_TO_CTRL_FOR_KEYS: [65, 67, 86, 88], // Map CMD to CTRL when used\n                                                // with A, C, V and X\n   IGNORE_RAW_KEY_CODES: [20], // CAPS: VK_CAPITAL = 20\n   WIN_KEY_CODES: [91, 92] // WIN: VK_LWIN = 91, VK_RWIN = 92\n};\n\nexport default function blastWmks($window, ngDialog, audioService,\n                                  safeStorageService,\n                                  VDPService, MKSVchan,\n                                  RTAVService, multimonRenderingService,\n                                  $timeout, WMKS, AB, $, _, $rootScope, $q,\n                                  mainChannelService, tsdrChannelService) {\n\n   let containerId = 0, mp4Enabled = false,\n      BlastWMKS = function(wmksService, key, isApplicationSession, isShadow, name) {\n         // Private var to denote wmks connected state.\n         this.isWmksConnected = false;\n         this.isWmksActive = false;\n         this.isDestroyed = false;\n         this.wasWmksConnectedOnce = false;\n         this.isActive = false;\n         this.clipboardReady = false;\n\n         this.key = key;\n         containerId++;\n         this.canvasId = containerId;\n\n         /*\n          * Stores clipboard capabilities for this session. Default to enabled\n          * since wmks only gives us an update if either is disabled.\n          */\n         this.copyEnabled = true;\n         this.pasteEnabled = true;\n\n         this.multimonServerEnabled = false;\n\n         this.isMP4Enabled = false;\n\n         this.wmksOfflineMessageQueue = [];\n\n         this.backoffDelayMs = AB.CONST.BlastWMKS.INIT_BACKOFF_DELAY_MS;\n         // Initialize our various timers to null.\n         this.heartbeatTimeout = null;\n         this.reconnectTimeout = null;\n         this.backoffTimeout = null;\n         this.disconnectRequestTimeout = null;\n\n         this.wmksContainer = null;\n\n         this.requestedDisconnect = false;\n         this.isApplicationSession =\n            isApplicationSession !== undefined ? isApplicationSession :\n               true;\n         this.isShadow = isShadow !== undefined ? isShadow : false;\n         this.isEmpty = true;\n\n         this.audioService = audioService.getAudioServiceInstance();\n         this.mksVchanClient = null;\n         this.url = null;\n         this.name = name || \"\";\n\n         this.closeReasonFromBlast = undefined;\n         this.disconnectedDialog = null;\n         this.disconnectedDialogOption = null;\n         // The delegate object to handle some events.\n         this.wmksService = wmksService;\n         this.remoteDPI = 0;\n         this.mainChannel = null;\n         this.tsdrChannel = null;\n\n         /**\n          * scale factor is added for bug 1792047\n          *\n          * When remote agent DPI is more than 100%, displayed cursor is\n          * way bigger than host OS cursor.  Client scaling way is taking\n          * MAC client as the reference as MAC client is doing cursor\n          * scaling.\n          *\n          * Regarding the factor value which is 105 in this commit,\n          * ideally it should be 96 because according to dumped cursor\n          * image, it's 2 times larger when DPI is 200% than 100%.\n          * However, when doing cursor scaling, we may need to\n          * compensate the canvas size.  105 is chosen according the\n          * reservation.\n          */\n         this.cursorFactor = 105;\n\n         this.cursorHandler =\n            function(src, width, height, postResize, hotx, hoty) {\n               let ratio;\n\n               if (this.remoteDPI !== 0 && this.remoteDPI !== 96) {\n                  ratio = parseFloat(this.remoteDPI / this.cursorFactor);\n                  $q(function(resolve, reject) {\n                     let img = new Image();\n\n                     img.onload = function() {\n                        resolve(img);\n                     };\n                     img.src = src;\n                  }).then(img => {\n                     let ctx;\n\n                     if (!this.canvas) {\n                        this.canvas = document.createElement(\"canvas\");\n                     }\n\n                     this.canvas.width = Math.round(width / ratio);\n                     this.canvas.height =\n                        Math.round(\n                           this.canvas.width * parseFloat(height / width));\n                     ctx = this.canvas.getContext(\"2d\");\n                     ctx.drawImage(img, 0, 0, this.canvas.width,\n                        this.canvas.height);\n\n                     return this.canvas.toDataURL(\"image/x-icon\");\n                  }).then(function(url) {\n                     let hx, hy;\n\n                     // need to scale hotspot as well\n                     if (!!hotx) {\n                        hx = Math.round(hotx / ratio);\n                     }\n                     if (!!hoty) {\n                        hy = Math.round(hoty / ratio);\n                     }\n                     AB.LOGGER.debug(\n                        \"[MKS]ratio=\" + ratio + \", hx=\" + hx + \", hy=\" + hy);\n                     postResize(url, hx, hy);\n                  });\n               } else {\n                  postResize(src);\n               }\n            }.bind(this);\n      };\n\n   /**\n    * initialize\n    *\n    * Initialize the WMKS client given a URL.\n    * NOTE: #canvas-container is the parent that shows the grey screen\n    * and\n    * hence WMKS should be added inside this div. It is also the parent\n    * div for positioning jquery ui dialogs.\n    *\n    * @param url target agent uri user is connecting to.\n    * @param settings contains prperties enableHighResMode,\n    *    useMacOSXKeySettings, enableWindowsKey, enableMP4\n    */\n   BlastWMKS.prototype.initialize = function(url, settings) {\n      let self = this,\n         targetUrl = url,\n         screenSize = AB.UTIL.getDesiredResolution(),\n         ignoredRawKeyCodes,\n         enableHighResMode = !!settings && settings.enableHighResMode,\n         useMacOSXKeySettings = !!settings &&\n            settings.useMacOSXKeySettings,\n         enableWindowsKey = !!settings && settings.enableWindowsKey,\n         enableMP4 = !!settings ? settings.enableMP4 : undefined,\n         fitGuest = !this.isShadow,\n         fitToParent = this.isShadow;\n\n      // Nullify this in case we came here via the reconnect path.\n      this.url = targetUrl;\n\n      /*\n       * settings object contains properties:\n       * {\n       *     enableHighResMode,\n       *     useMacOSXKeySettings,\n       *     enableWindowsKey,\n       *     enableMP4\n       * }\n       */\n      this.settings = settings;\n\n      if (this.backoffTimeout) {\n         $timeout.cancel(this.backoffTimeout);\n         this.backoffTimeout = null;\n      }\n\n      // Windows key is diabled in an application session.\n      enableWindowsKey = !this.isApplicationSession && enableWindowsKey;\n      // If Windows key simulation is disabled, don't process WIN code.\n      ignoredRawKeyCodes =\n         enableWindowsKey ? AB.CONST.BlastWMKS.IGNORE_RAW_KEY_CODES :\n            AB.CONST.BlastWMKS.IGNORE_RAW_KEY_CODES.concat(\n               AB.CONST.BlastWMKS.WIN_KEY_CODES);\n      this.isMP4Enabled =\n         angular.isDefined(enableMP4) ? enableMP4 : this.isMP4Enabled;\n\n      mp4Enabled = this.isMP4Enabled;\n\n      /*\n       * Setup our wmks widget.\n       *\n       * 1. Set the preferred screen size to wmks container, so it autofits\n       *    upon connection.\n       * 2. Blast requests the desired resolution, hence:\n       *    if it is a primary session, we set fitToParent = false, fitToGuest = true.\n       *    if it is a shadow session, we will set fitToGuest = false.\n       * 3. Browser sends unicode and raw keyboard inputs, set flag.\n       * 4. Do not process CAPS LOCK keys (send as non-unicode keys).\n       *    If Windows key simulation is disabled, don't process WIN code.\n       *    VK_LWIN = 91, VK_RWIN = 92, CAPS: VK_CAPITAL = 20 are non-unicode keys.\n       *    NOTE: Unicode 91, 92 are [ and \\ respectively. (PR 885884)\n       */\n      this.wmksContainer =\n         $('<div/>', {id: 'wmksContainer' + this.canvasId})\n            .appendTo($(AB.CONST.CANVAS_PARENT_ID))\n            .css({\n               position: 'absolute',\n               display: 'none',\n               border: 0\n            });\n\n      this.wmksContainer.hideLoading = false;\n      this.updateResolution(screenSize, false);\n      this.wmksContainer.wmks({\n         useVNCHandshake: false,\n         fitToParent: fitToParent,\n         fitGuest: fitGuest,\n         useUnicodeKeyboardInput: true,\n         enableOpusAudioClips: this.audioService.isAudioEnabled() &&\n         this.audioService.canAudioUseOpus(),\n         enableAacAudioClips: this.audioService.isAudioEnabled() &&\n         this.audioService.canAudioUseAac(),\n         enableVMWSessionClose: true,\n         enableSubRectangleCache: true,\n         enableMP4: this.isMP4Enabled,\n         enableVMWAudioMixer: true,\n         sendProperMouseWheelDeltas: true,\n         ignoredRawKeyCodes: ignoredRawKeyCodes,\n         retryConnectionInterval: -1,\n         useNativePixels: enableHighResMode,\n         mapMetaToCtrlForKeys: useMacOSXKeySettings\n            ? AB.CONST.BlastWMKS.MAP_META_TO_CTRL_FOR_KEYS : [],\n         enableWindowsKey: enableWindowsKey,\n         resolutionHandler: this.resolutionHandler,\n         cursorHandler: this.cursorHandler,\n         multimonRenderer: multimonRenderingService\n      });\n\n      if (WMKS.BROWSER.isTouchDevice()) {\n         this.wmksContainer.css({\n            overflow: 'hidden'\n         });\n      }\n\n      // Register our callbacks.\n      this.wmksContainer\n         .bind(\"wmksconnected\", function() {\n            self.onConnected();\n            if (AB.UTIL.isRTAVSupported()) {\n               RTAVService.onConnected(self.key);//wmks session ID\n            }\n         })\n         .bind(\"wmksconnecting\", function(e, info) {\n            self.onConnecting(info.vvc, info.vvcSession);\n            if (AB.UTIL.isRTAVSupported()) {\n               RTAVService.onConnecting(self.key, info.vvcSession);// at\n                                                                   // the\n                                                                   // same\n                                                                   // level\n                                                                   // of\n                                                                   // MKS\n                                                                   // functions,\n                                                                   // but\n                                                                   // leave\n                                                                   // the\n                                                                   // wmksContainer\n                                                                   // binding\n                                                                   // here for\n                                                                   // now\n            }\n         })\n         .bind(\"wmksbeforedisconnected\", function(e, closeReason) {\n            AB.LOGGER.debug(\n               'Closing reason from blast is : ' + closeReason);\n            self.closeReasonFromBlast = closeReason;\n         })\n         .bind(\"wmksdisconnected\", function(e, info) {\n            self.onDisconnected(info.code);\n            if (AB.UTIL.isRTAVSupported()) {\n               RTAVService.onDisconnected(self.key);//wmks session ID,\n                                                    // and RTAV will not\n                                                    // care about the\n                                                    // reason of\n                                                    // disconnection\n            }\n         })\n         .bind(\"wmksresolutionchanged\", function(e, size) {\n            AB.LOGGER.trace('New size: ' + JSON.stringify(size));\n            /*\n             *  TODO: If there are any resize issues, we can rely on the return\n             *  value and verify against the requested desktop size.\n             */\n         })\n         .bind(\"wmkserror\", function(e, err) {\n            AB.LOGGER.error('Error: ', err);\n            /*\n             *  TODO: Disconnection errors (non-1000 codes) trigger this.\n             *  We don't care about those as we handle them in the disconnected\n             *  handler but we should figure out what else could trigger this\n             *  and consider handling those cases.\n             */\n         })\n         .bind(\"wmksheartbeat\", function(e, interval) {\n            self.onHeartbeat(interval);\n         })\n         .bind(\"wmkscopy\", function(e, data) {\n            AB.LOGGER.log(\"wmks copy\");\n            self.wmksService.onClipboardChange(self);\n         })\n         .bind(\"wmkstoggle\", function(e, itemName, toggleState) {\n            AB.LOGGER.log(\"wmks toggle\", itemName, toggleState);\n            // Todo: It used to be for mobile client.\n         })\n         .bind(\"wmksaudio\", function(e, audioInfo) {\n            self.audioService.playAudio(audioInfo);\n         })\n         .bind(\"wmksaudiomixer\", function(e, audioMixerInfo) {\n            self.audioService.updateAudioMixer(audioMixerInfo);\n         })\n         .bind(\"wmksreconnecttoken\", function(e, token) {\n            self.onReconnectToken(token);\n         })\n         .bind(\"wmksupdatemultimoncapacityui\", function(e, data) {\n            AB.LOGGER.log(\"update-multimon-capacity-ui\", data);\n            self.multimonServerEnabled = data;\n         })\n         .bind(\"wmksupdatecopypasteui\", function(e, data) {\n            AB.LOGGER.log(\"update-copy-paste-ui\", data);\n            self.copyEnabled = !data.noCopyUI;\n            self.pasteEnabled = !data.noPasteUI;\n\n            /*\n             * Notifies wmksService to update its clipboard capabilities. Note\n             * that wmksService always updates with the capabilities of its\n             * currently active session. If this session is not currently active\n             * then the call is redundant, but harmless.\n             */\n            self.wmksService.updateClipboardCapabilities();\n         }).bind(\"wmksuseractivity\", function() {\n         self.wmksService.setUserActivityTime();\n      });\n\n      // @Todo: Change it safeStorage if we wanna support Chrome Client.\n      let reconnectTokenData = sessionStorage.getItem('ReconnectToken');\n      if (reconnectTokenData) {\n         reconnectTokenData = angular.fromJson(reconnectTokenData);\n         if (reconnectTokenData[this.key]) {\n            targetUrl += (targetUrl.indexOf('?') === -1) ? '?' : '&';\n            targetUrl += 'session=' +\n               encodeURIComponent(reconnectTokenData[this.key]);\n         }\n      }\n      // Initiate the remote desktop connection.\n      this.wmksContainer.wmks('connect', targetUrl);\n      return true;\n   };\n\n   /**\n    * setVisibility\n    *\n    * Show or hide the canvas itself. Returns true if a change was made.\n    *\n    * @params isShow if to show the canvas.\n    */\n   BlastWMKS.prototype.setVisibility = function(isShow) {\n      if (this.isActive === isShow) {\n         return false;\n      }\n\n      this.isActive = isShow;\n\n      if (isShow) {\n         if (this.wmksContainer) {\n            this.wmksContainer.show();\n         }\n         if (this.disconnectedDialogOption !== null) {\n            this.openDisconnectedDialog(\n               this.disconnectedDialogOption.reconnecting,\n               this.disconnectedDialogOption.reason);\n            this.disconnectedDialogOption = null;\n         }\n      } else {\n         if (this.wmksContainer) {\n            this.wmksContainer.hide();\n         }\n      }\n      return true;\n   };\n\n   /**\n    * toggleVisibility\n    *\n    * Show or hide the active canvas.\n    *\n    * @params isShow if to show the canvas.\n    */\n   BlastWMKS.prototype.toggleVisibility = function(isShow) {\n      if (this.wmksContainer) {\n         if (isShow) {\n            this.wmksContainer.hideLoading = false;\n            // As there will be many times toggle to show, but one time to hide.\n            // so check the status first.\n            if (this.wmksContainer.css('display') === 'block') {\n               return;\n            } else {\n               this.wmksContainer.show();\n            }\n         } else {\n            this.wmksContainer.hide();\n            this.wmksContainer.hideLoading = true;\n         }\n      }\n   };\n\n   /**\n    * setEmpty\n    *\n    * Change the application session is empty or not.\n    * @params isEmpty if there is any unity window active on this session.\n    */\n   BlastWMKS.prototype.setEmpty = function(isEmpty) {\n      if (!this.isApplicationSession) {\n         AB.LOGGER.error(\"We can not set a desktop session \" + this.key +\n            \" to empty.\");\n         return;\n      }\n      this.isEmpty = isEmpty;\n   };\n\n   /**\n    * onConnected\n    *\n    * Called upon successful connection.\n    */\n   BlastWMKS.prototype.onConnected = function() {\n      // Note that we're connected with wmks.\n      AB.LOGGER.info(this.key + 'Remoting connection successful - wmks.');\n      this.isWmksConnected = true;\n      this.wasWmksConnectedOnce = true;\n      // Clear previous state if any, and start the heartbeats.\n      this.resetStateAndInitHeartbeat();\n\n      // Now send the messages from the queue if any.\n      this.sendQueueMessages();\n\n      // Show the canvas if we are the active session.\n      if (this.isActive && !this.wmksContainer.hideLoading) {\n         this.wmksContainer.show();\n      }\n      this.wmksService.sessionOnConnected(this);\n   };\n\n   /**\n    * onConnecting\n    *\n    * Called while the MKS is connecting.  This currently is only used to\n    * create an instance of Unity.Mgr and log what it receives. This will\n    * also create and initialize an mksVchan client for the session.\n    */\n   BlastWMKS.prototype.onConnecting = function(vvc, vvcSession) {\n      let self = this,\n         vdpService,\n         client;\n\n      this.isWmksActive = true;\n      if (!vvc) {\n         AB.LOGGER.warn(\"The agent version this session \" + this.key +\n            \" is connected to is deprecated.\");\n         this.copyEnabled = false;\n         this.pasteEnabled = false;\n         return;\n      }\n\n      this.clipboardReady = false;\n      this.copyEnabled = true;\n      this.pasteEnabled = true;\n\n      vdpService = new VDPService.Service(vvc, vvcSession);\n      client = new MKSVchan.Client(vdpService);\n\n      this.mainChannel = mainChannelService.getChannel(vdpService);\n      this.mainChannel.init();\n\n      this.tsdrChannel = tsdrChannelService.getChannel(vdpService);\n      this.tsdrChannel.init();\n\n      this.mksVchanClient = client;\n      client.onReady = function() {\n         self.clipboardReady = true;\n         self.wmksService.onClipboardReady(self.key);\n      };\n      client.onDownloadFilesChange = function(downloadList, error) {\n         self.wmksService.handleDownloadListChange(downloadList, client,\n            error);\n      };\n      client.onPrintDownloadFilesChange = function(downloadList, error) {\n         self.wmksService.handlePrintDownloadListChange(downloadList,\n            client,\n            error);\n      };\n      client.onClipboardChanged = function(clipboard, error) {\n         self.wmksService.handleClipboardReceived(clipboard, error);\n      };\n      client.onFileTransferConfigChange = function(error) {\n         self.wmksService.handleFileTransferConfigChange(error);\n      };\n      client.onFileTransferError = function(error) {\n         self.wmksService.handleFileTransferError(error);\n      };\n      client.onPrintError = function(error) {\n         self.wmksService.handlePrintError(error);\n      };\n      client.initialize();\n\n      AB.LOGGER.info(this.key + ' connecting ' +\n         (this.isApplicationSession ? 'application' : 'desktop') +\n         ' session - wmks.');\n      this.wmksService.sessionOnConnecting(this, vdpService);\n   };\n\n   /**\n    * resetStateAndInitHeartbeat\n    *\n    * Upon successful connection we have to clear some old state if this\n    * is from a previous reconnect attempt. Remove old dialogs, reset\n    * timeouts, initialize heartbeats, etc. For more details see PR:\n    * 1200406\n    */\n   BlastWMKS.prototype.resetStateAndInitHeartbeat = function() {\n      // Close the reconnecting dialog now that we're\n      // connected/reconnected.\n      AB.LOGGER.info(this.key +\n         \" is connected and close all the disconnected dialog\");\n      this.noReconnectAgain = false;\n      this.closeDisconnectedDialog('connected');\n      this.disconnectedDialogOption = null;\n\n      // Clear any reconnect timeouts if set.\n      if (this.reconnectTimeout !== null) {\n         $timeout.cancel(this.reconnectTimeout);\n         this.reconnectTimeout = null;\n      }\n      // Reset the backoffDelayMs used for reconnect.\n      this.backoffDelayMs = AB.CONST.BlastWMKS.INIT_BACKOFF_DELAY_MS;\n\n      /*\n       * Initialize the heartbeat as soon as we have a successful connection.\n       * A successful connection is a valid heartbeat from the server.\n       */\n      this.onHeartbeat(20);\n   };\n\n   /**\n    * resolution handler is called in\n    * WMKS.widgetProto.updateFitGuestSize to adjust the resolution\n    *\n    * @param width\n    * @param height\n    * @returns {[*,*]}\n    */\n   BlastWMKS.prototype.resolutionHandler = function(width, height) {\n      let w = parseInt(width), h = parseInt(height);\n\n      // We need to round width to even for RDSH, see PR:1172572\n      if (w % 2) {\n         w = w - 1;\n      }\n\n      // We need to round height to even for H.264\n      if (mp4Enabled && h % 2) {\n         h = h - 1;\n      }\n\n      return [w, h];\n   };\n\n\n   /**\n    * For this wmks session, set the remote DPI\n    * @param remoteDPI\n    */\n   BlastWMKS.prototype.setRemoteDPI = function(remoteDPI) {\n      this.remoteDPI = remoteDPI;\n   };\n\n   /**\n    * Set a single canvas dimension, either width or height. Given a\n    * desired value, we adjust the value until we get a valid setting for\n    * that canvas dimension. Returns the final dimension value after\n    * adjustments.\n    *\n    * @params isWidth: flags whether we are setting width or height\n    * @params desiredValue: initial desired value for this dimension\n    */\n   BlastWMKS.prototype.setDimension =\n      function(isWidth, desiredValue) {\n         let value,\n            minReached = false,\n            diff,\n            minimum = isWidth ? AB.UTIL.INFO.minScreenWidth :\n               AB.UTIL.INFO.minScreenHeight,\n            dimensionName = isWidth ? \"width\" : \"height\";\n\n         if (desiredValue < minimum) {\n            desiredValue = minimum;\n            minReached = true;\n         }\n\n         value = desiredValue;\n         // call wmksContainer.width() or wmksContainer.height()\n         this.wmksContainer[dimensionName](value);\n\n         /**\n          * When client DPI is more than 100%, sometimes, the container\n          * height would be a float value.  For example, if we set the\n          * height to be 720, and browser would make it 720.0000323.\n          * In this case, it does not really trigger a scrollbar, and\n          * now necessarily to decrease the value.  See VHCH-879\n          */\n         diff = parseInt(this.wmksContainer[dimensionName]()) /\n            this.wmksContainer[dimensionName]();\n         AB.LOGGER.debug(\"Container \" + dimensionName +\n            \" is \" + this.wmksContainer[dimensionName]());\n         AB.LOGGER.debug(\"Desired value is \" + value);\n\n         if (!(diff > 0.999 && diff < 1.001)) {\n            /*\n             * If the browser is zoomed, the dimensions sometimes will not off by 1\n             * because of rounding errors. If this happens, decrease the dimensions\n             * until we get a value that doesn't get altered.\n             *\n             * We adjust downwards first to avoid having a scrollbar show up, but\n             * if we hit the minimum we will adjust up instead.\n             */\n\n            while (this.wmksContainer[dimensionName]() !== value) {\n               if (!minReached) {\n                  value -= 2;\n                  if (value < minimum) {\n                     value = desiredValue + 2;\n                     minReached = true;\n                  }\n               } else {\n                  value += 2;\n               }\n               this.wmksContainer[dimensionName](value);\n            }\n         }\n\n         return value;\n      };\n\n   /**\n    * updateResolution\n    *\n    * This function applies the new screen size to the wmks container,\n    * and\n    * may make adjustments if necessary. If specified we will also make a\n    * wmks request to rescale the canvas containing the desktop.\n    *\n    * @params screenSize: an Array [x,y] containing the new width and\n    *    height\n    * @params rescale: whether to send wmks rescale\n    */\n   BlastWMKS.prototype.updateResolution = function(screenSize, rescale) {\n      let w, h;\n\n      AB.LOGGER.info(\n         \"requested resolution change to \" + screenSize[0] + \" \" +\n         screenSize[1]);\n\n      w = this.setDimension(true, screenSize[0]);\n      h = this.setDimension(false, screenSize[1]);\n\n      AB.LOGGER.info(\"resolution adjusted to \" + w + \" \" + h);\n      if (rescale) {\n         this.wmksContainer.wmks('rescale');\n      }\n   };\n\n   /**\n    * onDisconnected\n    *\n    * Called upon disconnection with the WebSocket close code.\n    * We may come through here multiple times when trying to reconnect.\n    */\n   BlastWMKS.prototype.onDisconnected = function(code) {\n      let self = this,\n         closeReason = this.closeReasonFromBlast;\n\n      // Fix for 1589336\n      // When refreshing page, return directly.\n      // Mainly for Firefox, but the code does not do harm to Chrome or\n      // Safari.\n      if ($rootScope.beforeunload === true) {\n         return;\n      }\n\n      this.clipboardReady = false;\n      delete this.mksVchanClient;\n\n      this.isWmksConnected = false;\n      this.isWmksActive = false;\n\n      this.closeReasonFromBlast = undefined;\n      if (!!this.mainChannel) {\n         delete this.mainChannel;\n      }\n      if (!!this.tsdrChannel) {\n         delete this.tsdrChannel;\n      }\n\n      AB.LOGGER.warn(this.key + ' disconnected: ' + code);\n\n      /* If the user requests to disconnect this session\n       * or an empty app session is closed by some reason,\n       * just drop this session.\n       */\n      if (this.requestedDisconnect ||\n         (this.isApplicationSession && this.isEmpty &&\n         this.wasWmksConnectedOnce)) {\n         this.destroy();\n         return;\n      } else {\n         this.cleanup(true);\n         this.destroyWmks();\n      }\n\n      this.wmksService.sessionOnDisconnected(this, code);\n\n      // On idle session disconnect, the sidebar handles this case by\n      // taking user back to login\n      if (this.isApplicationSession &&\n         this.wmksService.isSessionTimedOut()) {\n         this.openDisconnectedDialog(false,\n            AB.CONST.DISCONNECT_REASON.IDLE_TIMEOUT);\n\n         // For closeReasonFromBlast, please refer to VDPConnectionResult\n         // in cart-main.perforce.1666/bora/public/VMwareVDPPlugin.h\n      } else if (closeReason === 10 || // Session expired due to timeout.\n         closeReason === 11 || // User initiated disconnect or logout.\n         closeReason === 12 || // Admin manually disconnected the session\n                               // from admin ui.\n         closeReason === 13 || // Server initiated disconnect as a\n                               // precursor to pending reconnect.\n         closeReason === 27 || // Generic logout.\n         closeReason === 28 || // Generic shutdown.\n         closeReason === 29 || // Generic reset.\n         code === 1000 ||\n         code === 1005) {\n         /*\n          * 1000 is a normal closure code initiated by remote system shutdown,\n          * user logoff or the local disconnect button.\n          * 1005 is an empty status code which does not indicate an error state,\n          * but merely that a closing frame was received with no status code.\n          */\n         this.openDisconnectedDialog(false);\n      } else if (code === AB.CONST.DISCONNECT_REASON.RECONNECT_FAILED) {\n         /*\n          * We gave up trying to reconnect (3000).\n          */\n         this.openDisconnectedDialog(false, code);\n      } else {\n\n         /*\n          * This is an unexpected closure, attempt reconnection.\n          */\n         if (!this.isDisconnectedDialogOpen() &&\n            this.noReconnectAgain !== true) {\n            this.openDisconnectedDialog(true);\n         }\n\n         if (!this.reconnectTimeout) {\n            this.reconnectTimeout =\n               $timeout(function() {\n                  AB.LOGGER.warn(self.key +\n                     ' giving up on reconnection. sending code: 3000');\n                  self.reconnectTimeout = null;\n                  self.onDisconnected(\n                     AB.CONST.DISCONNECT_REASON.RECONNECT_FAILED);\n                  /*\n                   * Give it two minutes before we give up --\n                   * The BSG will revoke our route after exactly 2 minutes.\n                   */\n               }, AB.CONST.BlastWMKS.BSG_TIMEOUT_MS);\n         }\n\n         // Exponentially backoff our reconnect attempts with a max of\n         // 20s.\n         this.backoffDelayMs = Math.min(2 * this.backoffDelayMs, 20000);\n         AB.LOGGER.info(this.key + ' attempt reconnect in (ms): ' +\n            this.backoffDelayMs);\n\n         if (this.backoffTimeout) {\n            AB.LOGGER.debug(\"Unexpected backoff timeout does exist.\");\n         }\n\n         this.backoffTimeout =\n            $timeout(function() {\n               AB.LOGGER.debug(\n                  self.key + ' attempting to reconnect to desktop...');\n               // Use storing url and setting params to reconnect.\n               self.initialize(self.url, self.settings);\n            }, this.backoffDelayMs);\n      }\n   };\n\n   /**\n    * onHeartbeat\n    *\n    *    Called upon receiving a heartbeat event.\n    */\n   BlastWMKS.prototype.onHeartbeat = function(interval) {\n      let self = this;\n      if (this.heartbeatTimeout !== null) {\n         $timeout.cancel(this.heartbeatTimeout);\n      }\n\n      this.heartbeatTimeout =\n         $timeout(function() {\n            AB.LOGGER.warn(\n               self.key + ' timed out waiting for a heartbeat.');\n            self.onDisconnected(\n               AB.CONST.DISCONNECT_REASON.HEARTBEAT_TIMEOUT);\n            /*\n             * \"interval\" is in seconds --\n             * Two intervals without a heartbeat means we're dead.\n             */\n         }, interval * 1000 * 2);\n   };\n\n   /**\n    * shadowHeartbeat\n    *\n    *    This is special handle for bug 1731596\n    *\n    *    Stop heartbeat watching when print since the print dialog in\n    *    Firefox and Safari can block JS code, which prevent client\n    * receiving heart beat from server. At last client will disconnect\n    * from server itself. Therefore we have to stop heartbeat watching in\n    * this case\n    */\n   BlastWMKS.prototype.shadowHeartbeat = function() {\n      if (this.heartbeatTimeout !== null) {\n         $timeout.cancel(this.heartbeatTimeout);\n      }\n   };\n\n   /**\n    * recoverHeartbeat\n    *\n    *    This is special handle for bug 1731596\n    *    Recover heartbeat watching after print finish\n    */\n   BlastWMKS.prototype.recoverHeartbeat = function() {\n      this.onHeartbeat(20);\n   };\n\n   /**\n    * onReconnectToken\n    *\n    *    Called upon receiving a reconnect token.\n    */\n   BlastWMKS.prototype.onReconnectToken = function(token) {\n      let reconnectTokenData = sessionStorage.getItem(\"ReconnectToken\");\n      if (!reconnectTokenData) {\n         reconnectTokenData = {};\n      } else {\n         reconnectTokenData = angular.fromJson(reconnectTokenData);\n      }\n\n      reconnectTokenData[this.key] = token;\n      sessionStorage.setItem('ReconnectToken',\n         angular.toJson(reconnectTokenData));\n   };\n\n   /**\n    * sendQueueMessages\n    *\n    * Loop through the list of messages in the queue and send them.\n    */\n   BlastWMKS.prototype.sendQueueMessages = function() {\n      let i,\n         message,\n         length = this.wmksOfflineMessageQueue.length;\n\n      // send all messages, messages may be re-added to list on failure\n      for (i = 0; i < length; i++) {\n         message = this.wmksOfflineMessageQueue.shift();\n         this.wmks.apply(this, message);\n      }\n   };\n\n   /*\n    * wmks\n    *\n    *Invoke WMKS widget APIs.\n    */\n   BlastWMKS.prototype.wmks = function() {\n      let widget = this.wmksContainer;\n\n      if (widget && this.isWmksConnected) {\n         // Send to wmks if its connected.\n         widget.wmks.apply(widget, arguments);\n         return;\n      }\n      // Queue these requests for sending upon connection.\n      this.wmksOfflineMessageQueue.push(arguments);\n   };\n\n   /**\n    * requestDisconnect\n    *\n    * Attempt a graceful disconnect from the server. If the server is\n    * already disconnected, triggers a page reflow. If the request takes\n    * too long to complete or fails, force the disconnect after a delay.\n    */\n   BlastWMKS.prototype.requestDisconnect = function() {\n      let self = this;\n      this.requestedDisconnect = true;\n\n      if (this.isWmksActive) {\n         this.wmks('disconnect');\n\n         if (!this.disconnectRequestTimeout) {\n            this.disconnectRequestTimeout =\n               $timeout(function() {\n                  self.disconnectRequestTimeout = null;\n                  if (self.isWmksActive) {\n                     AB.LOGGER.warn(\n                        self.key + ' disconnect request timed out');\n                     self.onDisconnected(\n                        AB.CONST.DISCONNECT_REASON.DISCONNECT_REQUEST_TIMEOUT);\n                  }\n               }, AB.CONST.BlastWMKS.REQUEST_DISCONNECT_TIMEOUT);\n         }\n      } else {\n         this.destroy();\n      }\n   };\n\n   /**\n    * cleanup\n    *\n    * Clean up the selected timeout task. Default is to\n    * clean up all the tasks.\n    *\n    * @params isIgnoreReconnect if we ignore reconnect timeout\n    */\n   BlastWMKS.prototype.cleanup = function(isIgnoreReconnect) {\n      // Remove all the timeout tasks for it is useless in the shutdown\n      // process.\n      if (this.heartbeatTimeout) {\n         $timeout.cancel(this.heartbeatTimeout);\n         this.heartbeatTimeout = null;\n      }\n\n      if (this.reconnectTimeout && !isIgnoreReconnect) {\n         $timeout.cancel(this.reconnectTimeout);\n         this.reconnectTimeout = null;\n      }\n\n      if (this.backoffTimeout) {\n         $timeout.cancel(this.backoffTimeout);\n         this.backoffTimeout = null;\n      }\n\n      if (this.disconnectRequestTimeout) {\n         $timeout.cancel(this.disconnectRequestTimeout);\n         this.disconnectRequestTimeout = null;\n      }\n   };\n\n   /**\n    * removeReconnectToken\n    *\n    * Remove the reconnect token for this websocket connection.\n    */\n   BlastWMKS.prototype.removeReconnectToken = function() {\n      // @Todo: Change it safeStorage if we wanna support Chrome Client.\n      let reconnectTokenData = $window.sessionStorage.getItem(\n         \"ReconnectToken\");\n      if (!reconnectTokenData) {\n         return;\n      }\n\n      reconnectTokenData = angular.fromJson(reconnectTokenData);\n      if (reconnectTokenData[this.key]) {\n         delete reconnectTokenData[this.key];\n         $window.sessionStorage.setItem(\"ReconnectToken\",\n            angular.toJson(reconnectTokenData));\n      }\n   };\n\n   /**\n    * isDisconnectedDialogOpen\n    *\n    * @return return if the disconnected dialog is open.\n    */\n   BlastWMKS.prototype.isDisconnectedDialogOpen = function() {\n      return !!this.disconnectedDialog;\n   };\n\n\n   /**\n    * openDisconnectedDialogCallback\n    *\n    * Callback to displays the dialog indicating the desktop has been\n    * disconnected. Or to bring up the SSL CertAccept page for the agent\n    * we are trying to connect to if triedSSLVerify is false.\n    *\n    * @params reconnecting are we trying to reconnect\n    * @params reason: a optional DISCONNECT_REASON code\n    * @params triedSSLVerify false if we have not tried to load the\n    *    certAccept page for this agent.\n    */\n   BlastWMKS.prototype.openDisconnectedDialogCallback =\n      function(reconnecting,\n               reason,\n               triedSSLVerify) {\n         let redirectUrl,\n            self = this,\n            match,\n            dialogText,\n            numPages;\n\n         if (!this.isActive) {\n            this.disconnectedDialogOption = {\n               'reconnecting': reconnecting,\n               'reason': reason\n            };\n            AB.LOGGER.info(\n               'Disconnected dialog is forbidden for session ' +\n               this.key + ' is not active.');\n            return;\n         }\n\n         if (!this.wasWmksConnectedOnce && this.url &&\n            (reconnecting ||\n            reason === AB.CONST.DISCONNECT_REASON.RECONNECT_FAILED)) {\n            /* matches things of the form:\n             * wss://<host>:<port>/<path>/<auth token>\n             * We strip out the auth token and replace wss with https\n             */\n            match = this.url.match(/wss:\\/\\/(\\w.+:\\d+\\/\\S*\\/)\\S*/);\n            if (match && match.length >= 2) {\n               numPages = 1;\n\n               /**\n                * The Windows 10 Edge browser breaks our untrusted SSL\n                * workflow because its untrusted cert warning clobbers\n                * the history entry for the client page. This means that\n                * moving back one page takes us back to certAccept.html,\n                * and moving back 2 pages takes us back to the launcher\n                * page.\n                *\n                * The fix is to use history.pushState() to add a new\n                * entry for the client page. This entry is just a\n                * duplicate of the URL of the client page. This entry\n                * gets clobbered by Edge, but having the extra entry\n                * means that the original history entry for the client\n                * page is not touched by edge, so moving back two pages\n                * takes us back to the client page.\n                */\n               if (WMKS.BROWSER.isIE()) {\n                  AB.LOGGER.info('Pushing extra history entry on Edge');\n                  history.pushState({state: \"certAcceptReturnAddress\"},\n                     \"\",\n                     $window.location.href);\n                  /**\n                   * Set jump page to 3 after page combined.\n                   * I'm not sure what happens in Edge. But after page\n                   * combined, client doesn't jump back to desktop page\n                   * if numPages is 2. It jumps back to\n                   * 'https://xxx/webclient/index.html'.\n                   * Anyway, setting numPages to 3 works here...\n                   */\n                  numPages = 3;\n               }\n\n               redirectUrl =\n                  'https://' + match[1] + 'certAccept.html?numPages=' +\n                  numPages;\n\n               // If we have not tried to verify the cert of the agent\n               // then do so.\n               triedSSLVerify = triedSSLVerify || {};\n               if (!triedSSLVerify[this.url]) {\n                  triedSSLVerify[this.url] = true;\n                  safeStorageService.setItem(\"TriedSSLVerify\",\n                     triedSSLVerify);\n                  $window.location.href = redirectUrl;\n                  return;\n               }\n            }\n         }\n\n         this.closeDisconnectedDialog('old');\n\n         dialogText = _('DESKTOP_DISCONNECTED_M');\n\n         if (reconnecting) {\n            dialogText += \" \" + _('ATTEMPTING_RECONNECT_M');\n         } else {\n            switch (reason) {\n               case AB.CONST.DISCONNECT_REASON.RECONNECT_FAILED:\n                  dialogText += \" \" + _('RECONNECT_FAIL_M');\n                  break;\n               default:\n               // unrecognized reason, no need to add anything\n            }\n            self.noReconnectAgain = false;\n            // destroy unless we plan to reconnect\n            self.destroy();\n         }\n\n         if (reconnecting) {\n            /*\n             ** Here we should use openconfirm,but it can't be closed\n             ** by close() method, so that we can't get closePromise.\n             ** We use open instead of openconfirm in order we could\n             ** close it by codes as before.\n             ** It helps us resolve the promise that was returned.\n             */\n            this.disconnectedDialog = ngDialog.open({\n               name: \"DisconnectedDialog\" + this.key,\n               templateUrl: confirmDialogTemplate,\n               className: \"session-ops-dialog\",\n               data: {\n                  errorMessage: dialogText,\n                  title: _('DESKTOP_DISCONNECTED_T'),\n                  message: dialogText,\n                  buttonLabelConfirm: _('YES'),\n                  buttonLabelCancel: _('NO')\n               },\n               controller: ['$scope', function($scope) {\n                  $scope.confirm = function() {\n                     /*\n                      ** Button Yes, put the reconnection to background and\n                      ** try to reconnect\n                      */\n                     self.noReconnectAgain = true;\n                     self.disconnectedDialog.close('backRun');\n                  };\n               }],\n               showClose: false,\n               closeByEscape: true,\n               closeByDocument: false\n            });\n         } else {\n            this.disconnectedDialog = ngDialog.open({\n               name: \"DisconnectedDialog\" + this.key,\n               templateUrl: errorDialogTemplate,\n               className: \"session-ops-dialog\",\n               data: {\n                  errorMessage: dialogText,\n                  title: _('DESKTOP_DISCONNECTED_T'),\n                  buttonLabel: _('CLOSE')\n               },\n               showClose: false,\n               closeByEscape: true,\n               closeByDocument: false\n            });\n         }\n\n         if (!!this.disconnectedDialog) {\n            AB.LOGGER.info(\n               \"Dialog is created for \" + this.key + \" with id \" +\n               this.disconnectedDialog.id);\n\n            this.disconnectedDialog.closePromise.then(function(data) {\n               AB.LOGGER.info(\"The reason for closing dialog: \" +\n                  (data.value || \"unknown\") +\n                  \" with id \" +\n                  self.disconnectedDialog.id);\n               if (data.value === 'backRun') {\n                  self.disconnectedDialogOption = null;\n                  self.disconnectedDialog = null;\n                  return;\n               }\n               self.noReconnectAgain = false;\n               if (!(data.value === 'old' || data.value === 'hide')) {\n                  self.disconnectedDialogOption = null;\n\n                  // Destroy everything unless the dialog is closed by a\n                  // connection\n                  if (data.value !== 'connected') {\n                     self.destroy();\n                  }\n\n                  self.disconnectedDialog = null;\n               }\n            });\n         }\n      };\n\n\n   /**\n    * openDisconnectedDialog\n    *\n    * Displays the dialog indicating the desktop has been disconnected.\n    *\n    * @params reconnecting are we trying to reconnect\n    * @params reason: a optional DISCONNECT_REASON code\n    */\n   BlastWMKS.prototype.openDisconnectedDialog =\n      function(reconnecting, reason) {\n         let self = this;\n         safeStorageService.getItem(\"TriedSSLVerify\",\n            function(triedSSLVerify) {\n               self.openDisconnectedDialogCallback(\n                  reconnecting,\n                  reason,\n                  triedSSLVerify);\n            });\n      };\n\n   /**\n    * closeDisconnectedDialog\n    *\n    * Close the disconnected dialog.\n    */\n   BlastWMKS.prototype.closeDisconnectedDialog = function(value) {\n      if (this.isDisconnectedDialogOpen()) {\n         AB.LOGGER.info(\"Closing dialog \" + this.disconnectedDialog.id +\n            \" with value \" + value);\n         try {\n            this.disconnectedDialog.close(value);\n         } catch (e) {\n            AB.LOGGER.info(\n               \"Closing dialog \" + this.disconnectedDialog.id + \" fails\");\n         }\n      }\n   };\n\n   /**\n    * enableWindowsKey\n    *\n    * Enable/disable Windows key simulation funcionality\n    *\n    * @param enabled true means enable, false means disable\n    */\n   BlastWMKS.prototype.enableWindowsKey = function(enabled) {\n      let ignoredRawKeyCodes;\n\n      // Windows key is always disabled in an application session.\n      if (this.isApplicationSession) {\n         return;\n      }\n\n      // If Windows key simulation is disabled, don't process WIN code.\n      ignoredRawKeyCodes =\n         enabled ? AB.CONST.BlastWMKS.IGNORE_RAW_KEY_CODES :\n            AB.CONST.BlastWMKS.IGNORE_RAW_KEY_CODES.concat(\n               AB.CONST.BlastWMKS.WIN_KEY_CODES);\n      this.wmks({\n         ignoredRawKeyCodes: ignoredRawKeyCodes,\n         enableWindowsKey: enabled\n      });\n   };\n\n   /**\n    * destroyWmks\n    *\n    * Destroys this session's wmks instance and remove the canvas\n    */\n   BlastWMKS.prototype.destroyWmks = function() {\n      if (this.wmksContainer) {\n         this.wmksContainer.unbind('wmksdisconnected');\n         // here's a issue when update to jquery 1.9.1 call wmks prior to\n         // initialization\n         this.wmksContainer.wmks().wmks('destroy');\n         this.wmksContainer.remove();\n      }\n   };\n\n   /**\n    * destroy\n    *\n    * Destroys this session after performing the necessary cleanup actions\n    */\n   BlastWMKS.prototype.destroy = function() {\n      if (!this.isDestroyed) {\n         this.destroyWmks();\n         this.isActive = false;\n         this.cleanup();\n         this.removeReconnectToken();\n         this.wmksService.sessionOnRemoved(this);\n         this.isDestroyed = true;\n      }\n   };\n\n   return {\n      getWmksSessionInstance: function(wmksService, key,\n                                       isApplicationSession, isShadow,\n                                       name) {\n         return new BlastWMKS(wmksService, key, isApplicationSession, isShadow, name);\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/blast-wmks-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * desktop-controller.js --\n *\n * The center controller for desktop module.\n *\n */\n\nexport default function DesktopCtrl($window, AB, $scope, $location, wmksService,\n                                    entitledItemsService) {\n   // Initialize AB with debug logging level.\n   AB.initialize({\n      LOG_LEVEL: 1\n   });\n\n   /*\n    * blastURL is one of the info set by the launcher page before it brings the user\n    * to the client page. If blastURL is not set then the user navigated to the\n    * launcher page directly. In this case send the user to the launcher as we will\n    * not have the information we need to run the client.\n    */\n   try {\n      /* istanbul ignore if */\n      if (!$window.sessionStorage.getItem('blastURL')) {\n         AB.UTIL.returnToLauncher();\n      }\n   } catch (e) {\n      /* istanbul ignore next */\n      AB.UTIL.returnToLauncher();\n   }\n\n   // Init for desktop connection\n   entitledItemsService.init();\n   wmksService.init();\n\n   // Remove query string\n   // TODO wait for html5 mode change\n   $location.search({});\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/desktop-controller.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * entitleditem-model.js --\n *\n * Module to provide entitled items information for Sidebar.\n *\n */\n\nimport signal from './signal';\nimport $ from 'jquery';\nimport AB from './appblast-util';\n\nexport default function entitledItemsModel(safeStorageService, RTAVService) {\n   let entitledItems = [],\n      idleTimeout = -1,\n      init,\n      reset,\n      onEntitleItemsRead = null,\n      self = this;\n\n   init = function() {\n      signal.makeObservable(self);\n      self.addSignal('valueChanged');\n      RTAVService.onDeviceStatusChanged(function() {\n         self.emit(\"valueChanged\");\n      });\n      reset();\n   };\n\n   reset = function() {\n      entitledItems = [];\n      safeStorageService.getItem(\"EntitledItems\", onEntitleItemsRead,\n         null);\n   };\n\n   /**\n    * onEntitleItemsRead\n    *\n    * Read serialized string from local storage with key(EntitledItems).\n    * Decode it into JSON format and construct entitled item.\n    */\n   onEntitleItemsRead = function(localContent) {\n      let // Enumerate desktop information from localStorage.\n         desktopKey,\n         desktops,\n         desktop,\n         // Enumerate shadow session information from localStorage.\n         shadowSessionKey,\n         shadowSessions,\n         shadowSession,\n         // Enumerate application information from localStorage.\n         applicationKey,\n         applications,\n         application,\n         iconIndex = -1;\n\n      if (localContent && localContent.timerInfo &&\n         localContent.timerInfo.idleTimeout) {\n         idleTimeout = localContent.timerInfo.idleTimeout;\n      }\n\n      if (localContent && localContent.content) {\n         desktops = localContent.content.desktops;\n         for (desktopKey in desktops) {\n            /* istanbul ignore else */\n            if (desktops.hasOwnProperty(desktopKey)) {\n               desktop = desktops[desktopKey];\n\n               if (desktop['protocol-match'] === 'false') {\n                  // Don't show this desktop because its display protocol\n                  // is not allowed.\n                  continue;\n               }\n\n               // Desktop icon is always the same. we use the icon in the\n               // template html.\n               $.extend(desktop, {\n                  type: AB.CONST.ITEMS_TYPE.DESKTOP,\n                  isShadow: false,\n                  iconSrc: \"\"\n               });\n               entitledItems.push(desktop);\n            }\n         }\n\n         shadowSessions = localContent.content.shadowSessions;\n         for( shadowSessionKey in shadowSessions) {\n            /* istanbul ignore else */\n            if (shadowSessions.hasOwnProperty(shadowSessionKey)) {\n               shadowSession = shadowSessions[shadowSessionKey];\n\n               if (shadowSession['protocol-match'] === 'false' ||\n                   shadowSession.type !== 'desktop') {\n                  continue;\n               }\n               // Todo: Reuse desktop icon for now. Will replace it once\n               // it is available.\n               $.extend(shadowSession, {\n                  type: AB.CONST.ITEMS_TYPE.DESKTOP,\n                  isShadow: true,\n                  iconSrc: \"\"\n               });\n               entitledItems.push(shadowSession);\n            }\n         }\n\n         applications = localContent.content.applications;\n         for (applicationKey in applications) {\n            /* istanbul ignore else */\n            if (applications.hasOwnProperty(applicationKey)) {\n               application = applications[applicationKey];\n\n               if (application['protocol-match'] === 'false') {\n                  // Don't show this application because its display\n                  // protocol is not allowed.\n                  continue;\n               }\n\n               $.extend(application, {\n                  type: AB.CONST.ITEMS_TYPE.APP,\n                  iconSrc: \"\"\n               });\n               iconIndex = AB.UTIL.getAppIconIndex(application.icons, 48);\n               if (iconIndex === -1) {\n                  application.iconSrc = AB.CONST.ICONS.BIG_DEFAULT_ICON;\n               } else {\n                  application.iconSrc = application.icons[iconIndex].path;\n               }\n               entitledItems.push(application);\n            }\n         }\n\n         self.emit(\"valueChanged\");\n      }\n   };\n\n   /**\n    * entitledItemsModel.getEntitledItems\n    *\n    * Return a array of entitled items.\n    */\n   this.getEntitledItems = function() {\n      return entitledItems;\n   };\n\n   /**\n    * entitledItemsModel.reset\n    *\n    * Reset the state of the service and read the entitled items from the\n    * safe storage service.\n    */\n   this.reset = reset;\n\n   this.getIdleTimeout = function() {\n      return idleTimeout;\n   };\n\n   init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/entitleditems-model.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * this service do not support multiple calling at the same time, so please\n * make sure the UI is designed to forbidden user to do so.\n *\n * this service is not ready at once it's loaded for chromeClient, and the code\n * changes need to be done for that.\n *\n * currently that's the only service in blast side calling JSCDK, so I think\n * it's ok to mimic the mainService function here before the JSCDK refactory is\n * done. after that, the mainService will be needed no more, and the new\n * callback API of JSCDK is also fit for \"many mainService pattern\".\n *\n * the safeStorageService is to make the coding easy before the blast-page\n * merged with webClient as a one page app. after that, the IP and ID can be\n * get from clientmodel\n *\n * if the including of entitledItemsModel cause any dependency error(like\n * loop), one can set it as a refer at outside with a extra entitledItemsModel\n * setter API.\n *\n * when try launch the same desktop, this service will return blastURL, and\n * it's not good for the user, so the UI should forbidden user to do so, or pre\n * deal this case for better user experience.\n *\n * the locked status check will be done using a will-check-in patch, that patch\n * can get the locked status without asking broker, thus save time and netwrok\n * traffic.\n *\n * the blastUrl in returned response as the param of callback could be changed\n * to an object that contains all info like item id, name , type, therefor ease\n * the info cache in outside if needed.\n *\n * disconnected-related logic and cache should not be handled here, but put it\n * here for the 1st patch.\n *\n * the null segment are optional once JSCDK is using callback.\n *\n * currently the response of resetAllApplicationSessions is ok only when all of\n * the application-session- killing is ok, and error if any of them fails. This\n * could be changed to return a list of the success info, but currently I see\n * no need, so merge them here.\n */\n\nimport reauthDialogTemplate from '../re-auth/dialog_service_reauth.html';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport {\n   globalArray,\n   UIEventToJSCDK,\n   jscdkClientSetUIController\n} from '../../jscdk/jscdkClient';\nimport errorDialogTemplate from '../../common/commondialog/dialog_service_error.html';\nimport $ from 'jquery';\n\n\nexport default function entitledItemsService(AB,\n                                             safeStorageService,\n                                             entitledItemsModel,\n                                             applicationSessionsModel,\n                                             blastSessionsModel,\n                                             userGlobalPref,\n                                             $rootScope,\n                                             $q,\n                                             multiSiteService,\n                                             timezone,\n                                             _,\n                                             constants,\n                                             idleSessionService,\n                                             dpiService,\n                                             jscdkDesktopInvoker,\n                                             ngDialog,\n                                             viewClientModel,\n                                             baseViewService) {\n   //private:\n   let _applicationSessions,\n      _desktops,\n      _applications,\n      _callBackfunc,\n      _callBackParam,\n      _itemTypeEnum = {\n         desktop: \"Desktop\",\n         application: \"Application\"\n      },\n      _canReuseBlastSession,\n      _jscdkHandler; //this will be defined near the end of the file\n\n   function _fillInDesktopsAndApplicationList(entitledItems) {\n      _desktops = [];\n      _applications = [];\n      for (let i = 0; i < entitledItems.length; i++) {\n         if (AB.UTIL.isDesktop(entitledItems[i])) {\n            _desktops.push(entitledItems[i]);\n         } else {\n            _applications.push(entitledItems[i]);\n         }\n      }\n   }\n\n   function _findItemWithPropertyInList(propertyName, targetValue,\n                                        itemList) {\n      for (let i = 0; i < itemList.length; i++) {\n         if (itemList[i][propertyName] === targetValue) {\n            return itemList[i];\n         }\n      }\n      return null;\n   }\n\n   function _findDesktop(desktopId) {\n      return _findItemWithPropertyInList('id', desktopId, _desktops);\n   }\n\n   function _findApplication(applicationId) {\n      return _findItemWithPropertyInList('id', applicationId,\n         _applications);\n   }\n\n   /**\n    * the application session list might be outdated, so don't check it\n    * here, if needed, one can add condition like ||\n    * !_findItemWithPropertyInList('origin-id', currentFarmId,\n    * _applicationSessions)\n    */\n   function _sessionExisting(application, currentFarmId) {\n      return application['origin-id'] === currentFarmId;\n   }\n\n   /**\n    * this function is to avoid session reuse error, and should be\n    * included in the base sevice it suffer from a defect caused by\n    * out-dated data, but I don't fix it now.\n    */\n   function _getNeedDisconnectedSessionForLaunching(application,\n                                                    applicationSessions) {\n      let existingSession = _findItemWithPropertyInList('origin-id',\n         application['origin-id'], applicationSessions);\n      if (!!existingSession && existingSession['state'] === \"connected\") {\n         return existingSession;\n      }\n      return null;\n   }\n\n   /**\n    * this function is to launch target desktop, and the desktopId can be\n    * replaced with desktop object and exclude the entitleditemsModle\n    */\n   function _launchDesktop(desktopId) {\n      let desktop = _findDesktop(desktopId);\n\n      if (!desktop) {\n         JSCDKLogger.error(\n            \"can't find the desktop with ID: \" + desktopId +\n            \" in the entitledList\");\n         return;\n      }\n\n      // here assume the desktop launching always want to see the result\n      // url.\n      _canReuseBlastSession = false;\n      jscdkDesktopInvoker.launchDesktop(desktop);\n   }\n\n   function _launchApplication(applicationId, currentConnectedFarmID) {\n      let application = _findApplication(applicationId);\n\n      if (!application) {\n         JSCDKLogger.error(\n            \"can't find the application with ID: \" + applicationId +\n            \" in the entitledList\");\n         return;\n      }\n      if (_sessionExisting(application, currentConnectedFarmID)) {\n         _canReuseBlastSession = true;\n         jscdkDesktopInvoker.launchApplication({\n            application: application\n         });\n      } else {\n         // the blastURL should be returned\n         _canReuseBlastSession = false;\n\n         applicationSessionsModel.getApplicationSessions(\n            function(applicationSessions) {\n               let badSession = _getNeedDisconnectedSessionForLaunching(\n                  application, applicationSessions);\n               if (!!badSession) {\n                  JSCDKLogger.info(\n                     'Application ID \"' + application.id + '\" has a ' +\n                     'corresponding connected application session ' +\n                     badSession.id +\n                     '. Disconnecting it now.');\n                  // for launching application after disconnect\n                  _jscdkHandler.applicationCache = application;\n                  // try disconnect and ignore any error.\n                  jscdkDesktopInvoker.disconnectApplicationSession(badSession);\n               } else {\n                  jscdkDesktopInvoker.launchApplication({\n                     application: application\n                  });\n               }\n            }, _jscdkHandler);\n      }\n   }\n\n   function _setCallbackFunction(callbackFunc, callbackParam) {\n      if (typeof(callbackFunc) !== 'function') {\n         JSCDKLogger.debug(\n            \"Error: the callbackFunc is not a function in entitledItemsService\");\n         return false;\n      }\n      _callBackfunc = callbackFunc;\n\n      if (callbackParam !== undefined) {\n         _callBackParam = callbackParam;\n      } else {\n         _callBackParam = null;\n      }\n   }\n\n   this._initTimer = function(initTimerAction) {\n      if (!initTimerAction) {\n         throw 'Init timer action cannot be null!';\n      }\n\n      // Only work for server return not authenticated error\n      // _setCallbackFunction(idleSessionService.handleNotAuthenticate);\n      _jscdkHandler.invokeJSCDK(initTimerAction, true);\n   };\n\n   this._sendLastUserActiveTime = function(sendLastUserActiveTimeAction) {\n      if (!sendLastUserActiveTimeAction) {\n         throw 'Last user active time action cannot be null!';\n      }\n\n      // Only work for server return not authenticated error\n      // _setCallbackFunction(idleSessionService.handleNotAuthenticate);\n      _jscdkHandler.invokeJSCDK(sendLastUserActiveTimeAction, true);\n   };\n\n   _jscdkHandler = {\n      applicationCache: null,\n      ajaxBusy: false,\n      invokeJSCDK: function(action, doNotBlock) {\n         let actionString = JSON.stringify(action);\n\n         JSCDKLogger.debug(\"UI request to JSCDK : \" + actionString);\n\n         // Set the ajaxBusy flag here before the JSCDK call is made to\n         // prevent race conditions and to deal with the case where\n         // action.async === false which means that the operation will\n         // complete before UIEventToJSCDK() returns\n         if (!doNotBlock) {\n            _jscdkHandler.ajaxBusy = true;\n         }\n\n         UIEventToJSCDK(actionString);\n      },\n\n      invokeCallback: function(response) {\n         let callback = _callBackfunc;\n         if (!!callback) {\n            _callBackfunc = null;\n            _jscdkHandler.ajaxBusy = false;\n            callback(response);\n         }\n      },\n\n      invokeCallbackWithCallbackParam: function(response) {\n         let callback = _callBackfunc,\n            param = _callBackParam;\n         if (!!callback) {\n            _callBackfunc = null;\n            _callBackParam = null;\n            _jscdkHandler.ajaxBusy = false;\n            callback(response, param);\n         }\n      },\n\n      handleItemConnect: function(actionData) {\n         let response = {\n            success: true,\n            blastURL: null,\n            sessionLocked: false,\n            error: null\n         };\n         if (actionData.isApplicationSession) {\n            blastSessionsModel.saveFromXmlResponse(actionData);\n         }\n         if (_canReuseBlastSession === false) {\n            /**\n             * if need further info like id, desktop/application name,\n             * isApplicationSession, we can change the blastURL into\n             * sessionSwitchNeededInfo as an object, but those infos are\n             * available when launching the item, so either way seems ok.\n             * but the data for toolbar need to be changed accordingly,\n             * and might need to update session storage if page jumping\n             * is involved(I guess not).\n             */\n            if (!!actionData && !!actionData.url) {\n               response.blastURL = actionData.url;\n            } else {\n               JSCDKLogger.debug(\n                  \"Error: actionData.url do not exist when do not reuse blast session\");\n            }\n         }\n         _canReuseBlastSession = null;\n\n         this.invokeCallback(response);\n      },\n\n      handleDisconnect: function() {\n         jscdkDesktopInvoker.launchApplication({\n            application: _jscdkHandler.applicationCache\n         });\n         _jscdkHandler.applicationCache = null;\n      },\n\n      handleError: function(actionData) {\n         let response;\n\n         response = {\n            success: false,\n            sessionLocked: null,\n            error: { // only pass those info to UI, could be changed if needed\n               errorType: actionData.errorType,\n               userMsg: actionData.errorText,\n               errorMsg: actionData.errorMessage,\n               errorDetail: actionData.errorDetail\n            }\n         };\n         if(!!_callBackParam) {\n            this.invokeCallbackWithCallbackParam(response);\n         } else {\n            this.invokeCallback(response);\n         }\n      },\n\n      handleSuccessResponse: function() {\n         let response;\n         response = {\n            success: true,\n            sessionLocked: false,\n            error: null\n         };\n\n         this.invokeCallback(response);\n      },\n\n      handlerReconnectResponse: function(actionData) {\n         let response;\n         response = {\n            success: true,\n            sessionLocked: false,\n            successSessionInfo: blastSessionsModel.getFullSessionInfoWith(\n               actionData),\n            error: null\n         };\n         this.invokeCallbackWithCallbackParam(response);\n      },\n\n      handleAuthenticationStatusLocked: function(actionData) {\n         if ($rootScope.reAuthDialog) {\n            return;\n         }\n\n         $rootScope.$emit('toggleBusyOverlay', false);\n         $rootScope.reAuthDialog = ngDialog.open({\n            name: \"reAuth\",\n            templateUrl: reauthDialogTemplate,\n            showClose: false,\n            className: \"re-auth-dialog\",\n            data: {\n               title: 're-authentication',\n               actionData: actionData\n            },\n            closeByEscape: true, // do not allow escape to close window\n            closeByDocument: true\n         });\n         $rootScope.reAuthDialog.closePromise.then(() => {\n            $rootScope.reAuthDialog = null;\n         });\n      },\n\n      handleLastUserActiveTime: function(actionName) {\n         JSCDKLogger.debug(\n            \"JSCDK response to blast desktop : \" + actionName);\n         idleSessionService.requestLastActiveTime(actionName);\n      },\n\n      handleAuthenticationStatusReAuth: function(handler) {\n         if ($rootScope.reAuthDialog) {\n            $rootScope.reAuthDialog.close();\n            $rootScope.reAuthDialog = null;\n            $rootScope.$emit('toggleBusyOverlay', true);\n            handler.appConnectCallBack();\n         } else {\n            JSCDKLogger.debug(\n               \"There's no reauth dialog\");\n         }\n      },\n      /**\n       * JSCDK response handler\n       *\n       * action will never be null, so don't check here\n       * complex as mainservice in web.js and will be deleted after\n       * refactory\n       */\n      responseToJSCDKEvent: action => {\n         let actionObj = $.parseJSON(action),\n            actionName = actionObj.name,\n            actionData = actionObj.content;\n\n         JSCDKLogger.debug(\"JSCDK response to UI : \" + actionName);\n         //If there's a response from jscdk,set the value to true.\n         $rootScope.isJSCDKResponse = true;\n         switch (actionName) {\n            case \"ShowError\":\n               // handlerError\n               _jscdkHandler.handleError(actionData);\n               break;\n            case \"DisconnectSession\":\n            // ignore DisconnectSessionFailed, and just call\n            // handleDisconnect connect application\n            case \"DisconnectSessionFailed\":\n               _jscdkHandler.handleDisconnect();\n               break;\n            case \"ShowAppBlastApplication\":\n            case \"ShowAppBlastDesktop\":\n               // Multi-site redirection only works for desktop now\n               if (!!actionData.redirectProperties &&\n                  actionName === 'ShowAppBlastDesktop') {\n                  // Multi-site redirection\n                  try {\n                     multiSiteService.redirectAndStartSession(\n                        actionData.redirectProperties);\n                     return;\n                  } catch (e) {\n                     JSCDKLogger.debug(\n                        'Error: fail to redirect due to: ' + e);\n                  }\n               }\n               /* If we got an ShowAppBlastDesktop or ShowAppBlastApplication message\n                * but we think we should reuse an existing session this means that\n                * the current session is not completely set up yet (ie Stuck on\n                * SSO, etc). In this case the user needs to get a message telling\n                * them to complete the login for that session before launching more\n                * apps. Report an error and that will let the user launch the\n                * apps again.\n                */\n               if (_canReuseBlastSession) {\n                  JSCDKLogger.debug(\n                     \"Error: do not reuse a reusable blast session\");\n                  _jscdkHandler.handleError({\n                     errorType: \"CannotReuseSession\",\n                     errorText: _(\"CANNOT_REUSE_SESSION_M\"),\n                     errorMessage: _(\"CANNOT_REUSE_SESSION_M\"),\n                     errorDetail: null\n                  });\n               } else {\n                  _jscdkHandler.handleItemConnect(actionData);\n               }\n               break;\n            case \"ApplicationAlreadyConnected\":\n               if (!_canReuseBlastSession) {\n                  /* If we got an ApplicationAlreadyConnected message but we think we can't\n                   * reuse the session that most likely means that we aborted a reconnect\n                   * attempt. In that case the broker thinks we still have a session\n                   * and that we should reuse it. However we can't because we have dropped\n                   * the info for the session. Report an error to the user and tell them\n                   * to try again later. Eventually the broker will drop the session\n                   * and the user will be able to launch their app\n                   */\n                  JSCDKLogger.debug(\n                     \"Error: reuse a un-reusalbe blast session\");\n                  /* Remove the error dialog to fix bug 1755785\n                   * In the CPA environment, when the application is global\n                   * entitlement and connected. The origin-id of\n                   * application-session is different from the apps origin-id.\n                   * We can't detect whether a session we could reuse or not.\n                   */\n               } else {\n                  _jscdkHandler.handleItemConnect(actionData);\n               }\n               break;\n            case \"KillSession\":\n            case \"KillAllApplicationSessions\":\n            case \"ResetDesktop\":\n            case \"RestartDesktop\":\n            case 'Brokers': // old result type for \"LogoutFromBroker\"\n                            // action\n            case 'Logout': // newer result type for \"LogoutFromBroker\" action\n               /**\n                * If client can enter desktop page, localStorage must be\n                * supported. No need to check it\n                */\n               if (actionName === 'Logout') {\n                  window.localStorage.removeItem(constants.CLIENT_LOGIN_KEY);\n               }\n               _jscdkHandler.handleSuccessResponse();\n               break;\n            case \"GetUserGlobalPref\":\n               userGlobalPref.setPrefData(\n                  globalArray[\"get-user-global-preferences\"].prefData);\n               if (this.getUserGlobalPrefDeferred) {\n                  this.getUserGlobalPrefDeferred.resolve(\n                     userGlobalPref.getPrefData());\n                  this.getUserGlobalPrefDeferred = null;\n               }\n               $rootScope.$emit('userGlobalPrefsRead');\n               break;\n            case \"SetUserGlobalPref\":\n            case \"RequestAborted\":\n               break;\n            case \"GetLaunchItems\":\n               _jscdkHandler.handlerGetLaunchItems(actionObj);\n               break;\n            case \"ReconnectAppSession\":\n               _jscdkHandler.handlerReconnectResponse(actionData);\n               break;\n            case \"RequestLastUserActiveTime\":\n            case \"Timeout\":\n               _jscdkHandler.handleLastUserActiveTime(actionName);\n               break;\n            case 'AlreadyLock':\n               if (viewClientModel.isAnonymousMode) {\n                  _setCallbackFunction(function() {\n                     baseViewService.gotoPortal();\n                  });\n                  jscdkDesktopInvoker.logout();\n                  return;\n               }\n               break;\n            case \"SessionUnlocked\":\n            case 'LockedNewTab':\n               _jscdkHandler.invokeCallback(actionObj);\n               break;\n            case \"AuthenticationStatusUnlocked\":\n               this.appConnectCallBack();\n               break;\n            case \"AuthenticationStatusLocked\":\n               this.connectToBrokerWithCallback(this.sendDoUnlock);\n               break;\n            case \"unLock\":\n               _jscdkHandler.handleAuthenticationStatusReAuth(this);\n               break;\n            case \"WindowsPassword\":\n               _jscdkHandler.handleAuthenticationStatusLocked(actionObj);\n               $rootScope.reWindowsPasswordExpired = false;\n               $rootScope.$emit('changeWindowsPassword', actionObj);\n               break;\n            case \"WindowsPasswordExpired\":\n               _jscdkHandler.handleAuthenticationStatusLocked(actionObj);\n               $rootScope.reWindowsPasswordExpired = true;\n               $rootScope.$emit('reAuthWindowsPasswordExpired', actionObj);\n               break;\n            default:\n               JSCDKLogger.error(\"unknown type of response returned\");\n         }\n         _jscdkHandler.ajaxBusy = false;\n\n         if (actionName === \"GetLaunchItems\") {\n            this.initDoneDeferred.resolve();\n         }\n      },\n\n      //will be changed after JSCDK refactory\n      initJSCDK: function(responseHandler, brokerUrl, urlParam) {\n         _jscdkHandler.ajaxBusy = false;\n         _jscdkHandler.invokeJSCDK({\n            method: \"InitRouter\",\n            brokerUrl: brokerUrl,\n            urlParam: urlParam\n         }, true);\n         jscdkClientSetUIController(responseHandler);\n         jscdkDesktopInvoker.jscdkHandler = this;\n      }\n   };\n   //public:\n   this.init = () => {\n      _fillInDesktopsAndApplicationList(\n         entitledItemsModel.getEntitledItems()); // it may suffer problem\n                                                 // with chromeClient\n      _callBackfunc = null;\n      _callBackParam = null;\n      _canReuseBlastSession = null;\n\n      if (!this.initDoneDeferred) {\n         this.initDoneDeferred = $q.defer();\n      }\n\n      function onBrokerUrlReaded(brokerUrlInfo) {\n         if (!brokerUrlInfo) {\n            AB.UTIL.returnToLauncher();\n         } else {\n            _jscdkHandler.initJSCDK(_jscdkHandler, brokerUrlInfo.url,\n               brokerUrlInfo.urlParam);\n            // pass in _jscdkHandler as main service for quickly resolve\n            // a blocking defect for Q2, after refactorying it could\n            // easily changed to look better.\n            applicationSessionsModel.getApplicationSessions(\n               function(applicationSessions) {\n                  _applicationSessions = applicationSessions;\n               }, _jscdkHandler);\n         }\n      }\n\n      safeStorageService.getItem(\"BrokerUrlInfo\", onBrokerUrlReaded,\n         null);\n   };\n\n\n   /**\n    * realize the old API to handle the JSCDK response, will be changed\n    * after JSCDK refactory the locked status is checked before sending\n    * any XML, so not included here.\n    */\n\n   this.responseToJSCDKEvent = _jscdkHandler.responseToJSCDKEvent;\n   this.itemTypeEnum = _itemTypeEnum;\n   this.invokeJSCDK = _jscdkHandler.invokeJSCDK;\n\n   /**\n    * try launch a user-entitled item.\n    *\n    * @itemId: of string,\n    *    be the target entitled itemID, do not use object to decompose\n    *    the\n    *    model of view\n    *    (might stored in the sub-controller of view) and the one for\n    *    higher level.\n    * @type: of itemTypeEnum,\n    *    be the type of the item.\n    * @currentConnectedFarmID: of string or null,\n    *    be the orignal ID(running environment ID of agent?), and used to\n    *    check whether the current session can be reused for new\n    *    application. when launching a desktop, this param will be\n    *    ignored.\n    * @callbackFunc: of function,\n    *    be the callback function that handle the response like:\n    *    {\n          *       success: of bool,\n          *       sessionLocked: of bool or null(when return error),\n          *       blastURL: of string or null,\n          *       error: of object,\n          *    }\n    * @return: of bool\n    *    indicate whether the params used for calling is valid\n    */\n   this.launch =\n      function(itemId, type, currentConnectedFarmID, callbackFunc) {\n         if (_jscdkHandler.ajaxBusy) {\n            JSCDKLogger.debug(\n               \"Error: do not support do multiple actions at the same time in the entitledItemsService\");\n            return false;\n         }\n         _setCallbackFunction(callbackFunc);\n\n         if (type === _itemTypeEnum.desktop) {\n            _launchDesktop(itemId);\n         } else if (type === _itemTypeEnum.application) {\n            _launchApplication(itemId, currentConnectedFarmID);\n         } else {\n            JSCDKLogger.debug(\n               \"Error: unknown item type in entitledItemsService.launch()\");\n            return false;\n         }\n         return true;\n      };\n\n   /**\n    * This function is different from wmksService.hasApplicationSession\n    * This function will return the whether user has exsiting application\n    * session, from get-launch-item msg. While\n    * wmksService.hasApplicationSession will return whether user has\n    * running application session.\n    */\n   this.hasApplicationSession = function() {\n      let deferred = $q.defer();\n\n      applicationSessionsModel.getApplicationSessions(\n         function(applicationSessions) {\n            deferred.resolve(applicationSessions);\n         }, _jscdkHandler);\n\n      return deferred.promise;\n   };\n\n   this.resetAllApplications = function(callbackFunc) {\n      if (_jscdkHandler.ajaxBusy) {\n         JSCDKLogger.debug(\n            \"Error: do not support do multiple actions at the same time in the entitledItemsService\");\n         return false;\n      }\n      _setCallbackFunction(callbackFunc);\n      jscdkDesktopInvoker.resetAllApplicationSessions();\n   };\n\n   /**\n    * if kill an application, this function will send killSession to the\n    * broker, and it would made the current session invalid, so a dialog\n    * might be needed.\n    *\n    * if kill a desktop, this function will send resetDesktop to the\n    * broker, and it would make the current session invalid, so might\n    * need to disconnect the wmks also.\n    */\n   this.killItem = function(itemId, type, callbackFunc) {\n      let isDesktop;\n\n      if (_jscdkHandler.ajaxBusy) {\n         JSCDKLogger.debug(\n            \"Error: do not support do multiple actions at the same time in the entitledItemsService\");\n         return false;\n      }\n\n      _setCallbackFunction(callbackFunc);\n      if (type === _itemTypeEnum.desktop) {\n         isDesktop = true;\n      } else if (type === _itemTypeEnum.application) {\n         isDesktop = false;\n      } else {\n         JSCDKLogger.debug(\n            \"Error: unknown item type in entitledItemsService.launch()\");\n         return false;\n      }\n      jscdkDesktopInvoker.resetItem(itemId, isDesktop);\n      return true;\n   };\n\n   this.resetDesktop = function(desktopId, callbackFunc) {\n      if (_jscdkHandler.ajaxBusy) {\n         JSCDKLogger.debug(\n            \"Error: do not support do multiple actions at the same time in the entitledItemsService\");\n         return false;\n      }\n      _setCallbackFunction(callbackFunc);\n\n      jscdkDesktopInvoker.resetDesktop(desktopId);\n   };\n\n   this.restartDesktop = function(desktopId, callbackFunc) {\n      if (_jscdkHandler.ajaxBusy) {\n         JSCDKLogger.debug(\n            \"Error: do not support do multiple actions at the same time in the entitledItemsService\");\n         return false;\n      }\n      _setCallbackFunction(callbackFunc);\n\n      jscdkDesktopInvoker.restartDesktop(desktopId);\n   };\n\n   /*\n    * logout\n    *\n    * Logout the user from the broker and then invoke the callback\n    *\n    * @param callbackFunc callback to call once the user is logged out\n    */\n   this.logout = function(callbackFunc) {\n      _setCallbackFunction(callbackFunc);\n      jscdkDesktopInvoker.logout();\n   };\n\n   this.reconnectApplicationSessions =\n      function(callbackFunc, callbackParam, targetAppSessionIdList,\n               excludedOriginalId) {\n         if (_jscdkHandler.ajaxBusy) {\n            JSCDKLogger.debug(\n               \"Error: do not support do multiple actions at the same time in the entitledItemsService\");\n            return false;\n         }\n         _setCallbackFunction(callbackFunc, callbackParam);\n         jscdkDesktopInvoker.reconnectApplicationSessions(\n            targetAppSessionIdList, excludedOriginalId);\n      };\n\n   this.unitTestStatusSetters = {\n      setCallback: _setCallbackFunction,\n      setCanReuseBlastSession: function(canReuse) {\n         _canReuseBlastSession = canReuse;\n      },\n      setApplicationCache: function(obj) {\n         _jscdkHandler.applicationCache = obj;\n      }\n   };\n\n   this.getUserGlobalPref = function() {\n      // the promise we will return\n      let deferred;\n\n      // If there is promise in flight use that promise\n      if (this.getUserGlobalPrefDeferred) {\n         deferred = this.getUserGlobalPrefDeferred;\n      } else {\n\n         deferred = $q.defer();\n\n         // If there is no promise in flight but\n         // get-user-global-preferences exists then that means that the\n         // preferences where read already and that the process of\n         // getting the preferences has completed.\n         if (globalArray[\"get-user-global-preferences\"]) {\n            deferred.resolve(userGlobalPref.getPrefData());\n         } else {\n            // Otherwise we need to read the preferences because they\n            // have not been read yet.\n            deferred = $q.defer();\n            this.getUserGlobalPrefDeferred = deferred;\n            jscdkDesktopInvoker.getUserGlobalPref();\n         }\n      }\n\n      return deferred.promise;\n   };\n\n   this.connectToBrokerWithCallback = function(callback) {\n      jscdkDesktopInvoker.connectToBroker();\n      _setCallbackFunction(callback);\n   };\n\n   this.authenticationStatusCheck = function(callback, ondone) {\n      jscdkDesktopInvoker.authenticationStatusCheck();\n      _setCallbackFunction(ondone);\n      this.appConnectCallBack = callback;\n   };\n\n   this.addInitDoneCallback = function(callback) {\n      if (!this.initDoneDeferred) {\n         this.initDoneDeferred = $q.defer();\n      }\n      this.initDoneDeferred.promise.then(callback);\n   };\n\n   this.abortRequest = function() {\n      _jscdkHandler.ajaxBusy = false;\n      jscdkDesktopInvoker.cancelCurrentRequest();\n   };\n\n   this.sendDoUnlock = function() {\n      jscdkDesktopInvoker.sendDoUnlock();\n   };\n\n   this.submitWindowsPasswordWithCallback = function(username, password,\n                                                     domain, reAuth, callback) {\n      _setCallbackFunction(callback, this.appConnectCallBack);\n      jscdkDesktopInvoker.submitWindowsPassword(username, password,\n         domain, reAuth);\n   };\n\n   this.startIdleTimer = function(brokerSupportIdleTimeout, idleTimeout,\n                                  userActivityInterval, brokerUrl,\n                                  brokerUrlWithTimestamp,\n                                  handleUserActivityCallback) {\n      idleSessionService.initialize(brokerSupportIdleTimeout, idleTimeout,\n         userActivityInterval, brokerUrl,\n         brokerUrlWithTimestamp, _jscdkHandler,\n         handleUserActivityCallback,\n         this._initTimer, this._sendLastUserActiveTime);\n   };\n\n   this.stopIdleTimer = function() {\n      JSCDKLogger.debug(\"Stop idle timer for desktop module\");\n      _jscdkHandler.invokeJSCDK({\n         method: 'TimerCtrl',\n         type: 'stopTimer'\n      }, true);\n   };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/entitleditems-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * idle-session-service.js --\n *\n * This file performs the manage work to init a timerContrller in JSCDK, and\n * is also the middle layer between blast page and JSCDK, thus it will provide\n * an API to let JSCDK send last-user-active time request through post-massage\n * and also handle the response and told back to JSCDK.\n *\n * NOTE: the file is almost copied from slim client\n */\n\nimport signal from './signal';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\nexport default function idleSessionService() {\n   signal.makeObservable(this);\n   this.addSignal('not-authenticated');\n\n   this.actionTrigger = null;\n   this.jscdkHandler = null;\n   this.handleUserActivityCallback = null;\n   this.initTimer = null;\n   this.sendLastUserActiveTime = null;\n\n   /**\n    * pass in the last-user-active-time getter function to init the idle\n    * timer in JSCDK\n    */\n   this.initialize =\n      function(brokerSupportIdleTimeout, idleTimeout, userActivityInterval,\n               brokerUrl, brokerUrlWithTimestamp, jscdkHandler,\n               handleUserActivityCallback, initTimer,\n               sendLastUserActiveTime) {\n         if (typeof handleUserActivityCallback !== 'function' ||\n            typeof initTimer !== 'function' ||\n            typeof sendLastUserActiveTime !== 'function') {\n            throw 'Wrong parameters for idleSessionService to init!';\n         }\n\n         if (!jscdkHandler) {\n            throw 'jscdkHandler should not be null!';\n         }\n\n         this.jscdkHandler = jscdkHandler;\n         this.handleUserActivityCallback = handleUserActivityCallback;\n         this.initTimer = initTimer;\n         this.sendLastUserActiveTime = sendLastUserActiveTime;\n\n         let initTimerAction,\n            bypassApplicationVersionCheck;\n\n         if (!brokerSupportIdleTimeout) {\n            return;\n         }\n         bypassApplicationVersionCheck = \"true\";\n\n         // session storage is no need to be sent, for before enter, it has\n         // already been set.\n         initTimerAction = {\n            method: \"TimerCtrl\",\n            type: \"InitTimer\",\n            initType: \"Desktop\",\n            idleTimeout: idleTimeout,\n            userActivityInterval: userActivityInterval,\n            bypassApplicationVersionCheck: bypassApplicationVersionCheck,\n            brokerUrl: brokerUrl,\n            brokerUrlWithTimestamp: brokerUrlWithTimestamp\n         };\n         this.initTimer(initTimerAction);\n      };\n\n   /**\n    * the interface to let timerCtrl in JSCDK call to get last user active\n    * time\n    *\n    * through post-message, will get value in the callback bound in listener\n    *\n    * @param actionTrigger String:\n    *    indicates the reason that this function is invovled, null is the\n    *    default value, and stands for \"RequestLastUserActiveTime\", while\n    *    this assum that the requests other than\n    *    \"RequestLastUserActiveTime\"(now only \"Timeout\") should not come too\n    *    close to each other. while the best way need to pass extra string\n    *    to AB and change codes in it.\n    * @return nothing\n    */\n   this.requestLastActiveTime = actionTrigger => {\n      if (actionTrigger === \"Timeout\") {\n         this.actionTrigger = actionTrigger;\n      }\n\n      let lastUserActiveTime = this.handleUserActivityCallback();\n      this.sendLastUserActiveTimeToTimerCtrl(lastUserActiveTime);\n   };\n\n   /**\n    * the function that send last user active time to JSCDK\n    *\n    * sending with invokeJSCDK\n    *\n    * @param lastUserActiveTime long\n    * @return nothing\n    */\n   this.sendLastUserActiveTimeToTimerCtrl = lastUserActiveTime => {\n      let sendLastUserActiveTimeAction,\n         actionTrigger = this.actionTrigger,\n         actionType = null;\n\n      if (actionTrigger === \"Timeout\") {\n         actionType = \"syncWithTimer4Timeout\";\n         this.actionTrigger = null;\n      } else {\n         actionType = \"sendLastUserActiveTime\";\n      }\n      JSCDKLogger.debug(\"handle app-blast response as: \" + actionType);\n\n      sendLastUserActiveTimeAction = {\n         method: \"TimerCtrl\",\n         type: actionType,\n         lastUserActiveTime: lastUserActiveTime\n      };\n      this.sendLastUserActiveTime(sendLastUserActiveTimeAction);\n   };\n\n   this.handleNotAuthenticate = () => {\n      this.emit('not-authenticated');\n   };\n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/idle-session-service.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport $ from 'jquery';\n\nexport default function jscdkDesktopInvoker($rootScope, $location, $timeout,\n                                            $window, viewClientModel,\n                                            userGlobalPref, dpiService,\n                                            connectionServerModel,\n                                            constants, timezone) {\n\n   this.jscdkHandler = null;\n\n   this._invokeJSCDK = action => {\n      // TODO: Move to jscdkUIAdapter later\n      this.jscdkHandler.invokeJSCDK(action);\n   };\n\n\n   this.resetItem = (itemId, isDesktop) => {\n      let killItemAction = {};\n      killItemAction.method = \"KillSession\";\n      killItemAction.itemInfo = {\n         id: itemId,\n         isDesktop: isDesktop\n      };\n      this.jscdkHandler.invokeJSCDK(killItemAction);\n   };\n\n   this.resetDesktop = desktopId => {\n      const resetDesktopAction = {\n         method: \"ResetDesktop\",\n         desktopId: desktopId\n      };\n      this.jscdkHandler.invokeJSCDK(resetDesktopAction);\n   };\n\n   this.restartDesktop = desktopId => {\n      const restartDesktopAction = {\n         method: \"RestartDesktop\",\n         desktopId: desktopId\n      };\n      this.jscdkHandler.invokeJSCDK(restartDesktopAction);\n   };\n\n   this.logout = () => {\n      const logoutAction = {\n         method: 'LogoutFromBroker',\n         prefData: userGlobalPref.toFlatFormat()\n      };\n      this.jscdkHandler.invokeJSCDK(logoutAction);\n   };\n\n   this.submitWindowsPassword = (username, password,\n                                 domain, reAuth) => {\n      const submitAuthInfoAction = {\n         method: 'SubmitAuthInfo',\n         type: 'WindowsPassword',\n         isDesktopReAuth: true,\n         username: username,\n         secret: password,\n         domain: domain\n      };\n      if (reAuth) {\n         submitAuthInfoAction.reAuth = true;\n      }\n\n      this.jscdkHandler.invokeJSCDK(submitAuthInfoAction);\n   };\n\n   this.changePassword = (oldPassword, newPassword1,\n                          newPassword2) => {\n      const submitAuthInfoAction = {\n         method: 'SubmitAuthInfo',\n         isDesktopReAuth: true,\n         type: 'WindowsPasswordExpired'\n      };\n      submitAuthInfoAction.oldPassword = oldPassword;\n      submitAuthInfoAction.newPassword1 = newPassword1;\n      submitAuthInfoAction.newPassword2 = newPassword2;\n\n      this.jscdkHandler.invokeJSCDK(submitAuthInfoAction);\n   };\n\n   this.cancelCurrentRequest = doneAction => {\n      this.jscdkHandler.invokeJSCDK({\n         method: 'CancelCurrentRequest',\n         doneAction: doneAction\n      });\n   };\n\n   this.sendLaunchItemsXML = () => {\n      const getLaunchItemsAction = {\n         method: 'GetLaunchItems',\n         skipTunnelAndPref: true,\n         skipTimer: true\n      };\n      this.jscdkHandler.invokeJSCDK(getLaunchItemsAction);\n   };\n\n   this.getUserGlobalPref = () => {\n      this.jscdkHandler.invokeJSCDK({\n         method: \"GetUserGlobalPref\"\n      });\n   };\n\n   this.disconnectApplicationSession = applicationsession => {\n      this.jscdkHandler.invokeJSCDK({\n         method: \"DisconnectSession\",\n         launchItemId: applicationsession.id\n      });\n   };\n\n   this.resetAllApplicationSessions = () => {\n      let resetApplicationSessionAction = {};\n      resetApplicationSessionAction.method = 'KillSession';\n      resetApplicationSessionAction.killAllApplicationSessions = true;\n      this.jscdkHandler.invokeJSCDK(resetApplicationSessionAction);\n   };\n\n   this.reconnectApplicationSessions =\n      (targetSessionIds, excludedOriginalId) => {\n         let reconnectApplicationSessionsAction = {};\n         reconnectApplicationSessionsAction.method = \"ReconnectSession\";\n         reconnectApplicationSessionsAction.targetSessionIds =\n            targetSessionIds;\n         reconnectApplicationSessionsAction.disconnectAll = false;\n         reconnectApplicationSessionsAction.excludedOriginalId =\n            excludedOriginalId;\n         reconnectApplicationSessionsAction.environmentInfo =\n            this._getEnvironmentInfo(false);\n\n         this.jscdkHandler.invokeJSCDK(reconnectApplicationSessionsAction);\n      };\n\n   this.launchApplication = appInfo => {\n      let application = appInfo.application,\n         args = appInfo.args,\n         selectApplicationAction = {};\n\n      // connect to application\n      selectApplicationAction.method = 'ConnectToApplication';\n      /*\n       * launch application for the specific protocol\n       * currently, only BLAST is allowed.\n       */\n      selectApplicationAction.protocol =\n         connectionServerModel.connectionProtocol;\n      selectApplicationAction.applicationId = application.id;\n      selectApplicationAction.originId =\n         application['origin-id'];\n      selectApplicationAction.maximized = 'false';\n      selectApplicationAction.environmentInfo =\n         this._getEnvironmentInfo(false);\n\n      selectApplicationAction.preferences = {\n         applicationName: application.name,\n         resolution: {\n            'x': 0,\n            'y': 0,\n            'w': $(window).width(),\n            'h': $(window).height()\n         }\n      };\n      if (!!args) {\n         selectApplicationAction.launchParam = {\n            \"args\": args\n         };\n      }\n\n      selectApplicationAction.prefData =\n         userGlobalPref.toFlatFormat();\n      this.jscdkHandler.invokeJSCDK(selectApplicationAction);\n   };\n\n   this.launchDesktop = desktop => {\n      let selectDesktopAction = {},\n         ratio = 1;\n\n      selectDesktopAction.method = 'ConnectToDesktop';\n      /* launch desktop for the specific protocol\n       * currently, only BLAST is allowed.\n       */\n      selectDesktopAction.protocol =\n         connectionServerModel.connectionProtocol;\n      selectDesktopAction.desktopId = desktop.id;\n      selectDesktopAction.isShadow = desktop.isShadow;\n      if (!desktop.isShadow) {\n         selectDesktopAction.environmentInfo =\n            this._getEnvironmentInfo(true);\n      }\n\n      selectDesktopAction.preferences = {\n         desktopName: desktop.name,\n         resolution: {\n            'x': 0,\n            'y': 0,\n            'w': $(window).width() * ratio,\n            'h': $(window).height() * ratio\n         }\n      };\n\n      selectDesktopAction.prefData =\n         userGlobalPref.toFlatFormat();\n      this.jscdkHandler.invokeJSCDK(selectDesktopAction);\n   };\n\n   this.connectToBroker = () => {\n      let connectBrokerAction = {},\n         clientCommonInfo,\n         clientStats,\n         addClientCommonInfo,\n         addClientStats,\n         userAgent = navigator.userAgent,\n         isHandheldDevice = !!userAgent.match(\n            /(iPad)|(iPhone)|(iPod)|(android)|(IEMobile)|(webOS)/i),\n         matches,\n         browserName = 'unknown',\n         browserVersion,\n         browserArch = navigator.platform;\n\n      // Connect To the Broker\n      connectBrokerAction.method = 'ConnectToBroker';\n      connectBrokerAction.address = connectionServerModel.host;\n      connectBrokerAction.supportedProtocols =\n         connectionServerModel.supportedProtocols;\n\n      // //ignore ISO for now\n      // if (!!connectionURIModel.isF5Session()) {\n      //    connectBrokerAction.mid = connectionURIModel.getF5postFix();\n      // }\n\n      if (userAgent.toLowerCase().match(/(iphone|ipod|ipad)/i)) {\n         // Apple iOS6 introduced a new xml post bug where the browser\n         // would cache response if the request data did not change.\n         // Hack to make sure we always request a new url, by adding a\n         // timestamp whenever get an iOS browser\n         connectBrokerAction.urlParam = '?_ab=' + $.now();\n      }\n\n      // Match pattern like 'Chrome/26.0.1410.64' to retrieve browser\n      // name and version.\n      matches = userAgent.match(\n         /(opera|chrome|safari|firefox|msie|trident)\\/?\\s*(\\.?\\d+(\\.\\d+)*)/i);\n      if (!!matches) {\n         browserName = matches[1];\n         browserVersion = matches[2];\n      }\n\n      // For Microsoft Edge, the useragent is like:\n      // \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36\n      // (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36\n      // Edge/12.0\". Match pattern Edge, because there's a \"chrome\"\n      // string in it.\n      if (userAgent.toLowerCase().indexOf('edge')) {\n         matches = userAgent.match(/(edge)\\/?\\s*(\\.?\\d+(\\.\\d+)*)/i);\n         if (!!matches) {\n            browserName = matches[1];\n            browserVersion = matches[2];\n         }\n      }\n\n      if (browserName === 'Safari') {\n         // For Safari, the version is in 'Version/6.0.3'.\n         matches = userAgent.match(/version\\/([\\.\\d]+)/i);\n         if (!!matches) {\n            browserVersion = matches[1];\n         }\n      } else if (browserName === 'Trident') {\n         // For IE 11, the version is in 'rv:11.0'.\n         browserName = 'Internet Explorer';\n         matches = userAgent.match(/rv[:\\s]([\\w.]+)/i);\n         if (!!matches) {\n            browserVersion = matches[1];\n         }\n      }\n      // For Chromebook, detect browser-arch from userAgent text.\n      matches = userAgent.match(/cros\\s*[a-z0-9_\\.]*/i);\n      if (!!matches) {\n         browserArch = matches[0];\n      }\n\n      // Client common info\n      clientCommonInfo = {\n         // 'VMware'\n         'client-vendor': viewClientModel.vendor,\n         // 'VMware Horizon HTML Access'\n         'client-product': viewClientModel.product,\n         // View client version\n         'client-version': viewClientModel.version + '-' +\n         viewClientModel.buildNum,\n         // 'Chrome Apps'\n         'client-arch': viewClientModel.arch\n      };\n      // Client platform specific info\n      clientStats = {\n         // Browser info\n         'browser-user-agent': userAgent,\n         // Browser core\n         'browser-core': browserName,\n         // Browser version\n         'browser-version': browserVersion,\n         // System info\n         'browser-arch': browserArch,\n         // Is mobile device\n         'browser-is-handheld': isHandheldDevice ? 'true' : 'false'\n      };\n\n      addClientCommonInfo = {\n         'entity-type': 'CLIENT',\n         'data-type': 'configuration'\n      };\n\n      addClientStats = {\n         // the same with windows client\n         'entity-id': 'singleton'\n      };\n\n      connectBrokerAction.clientInfo = {\n         'clientCommonInfo': clientCommonInfo,\n         'clientStats': clientStats,\n         'addClientCommonInfo': addClientCommonInfo,\n         'addClientStats': addClientStats,\n      };\n\n      this.jscdkHandler.invokeJSCDK(connectBrokerAction);\n   };\n\n   this.sendDoUnlock = () => {\n      const sendDoUnlockAction = {\n         method: 'DoUnlock'\n      };\n      this.jscdkHandler.invokeJSCDK(sendDoUnlockAction);\n   };\n\n   this.authenticationStatusCheck = (callback, ondone) => {\n      const authStatusCheckAction = {\n         method: 'GetAuthenticationStatus',\n         workForSilentMode: true\n      };\n\n      this.jscdkHandler.invokeJSCDK(authStatusCheckAction);\n   };\n\n   this.setEnvironmentInfo = function(environmentInfo) {\n      const setEnvironmentInfoAction = {\n            \"method\": \"SetEnvironmentInfo\",\n            \"data\": environmentInfo\n         };\n      this.jscdkHandler.invokeJSCDK(setEnvironmentInfoAction);\n   };\n\n   this._getEnvironmentInfo = isDesktop => {\n      let environmentInfo = {};\n\n      if (!!viewClientModel.ipAddress) {\n         environmentInfo['IP_Address'] =\n            viewClientModel.ipAddress;\n         environmentInfo['Machine_Name'] =\n            viewClientModel.machineName;\n      }\n      if (!!viewClientModel.clientID) {\n         environmentInfo['Client_ID'] = viewClientModel.clientID;\n      }\n      environmentInfo['Client_Version'] = viewClientModel.version + '-' +\n         viewClientModel.buildNum;\n      environmentInfo['TZID'] = timezone.getWindowsTimezone();\n      environmentInfo['Type'] = constants.viewclientType;\n\n      environmentInfo['Displays.SystemDpi'] =\n         dpiService.getDPI();\n\n      return environmentInfo;\n   };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/jscdk-desktop-invoker.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\n/**\n * @fileoverview messagehandler-service.js -- messageHandlerService\n * This service offering the same API to decouple the different design for IE\n *    and non-IE browsers, it will inform the current tab about the launching\n *    info in one way or another with same API.\n *\n * The implement is using API of postMessage for non-IE or Edge browsers to\n *    provide better user exprience, while will use API of storage event for\n *    IE. For we have a different design using storage for IE with version\n *    below or equal to 11, since it suffers from some postMessage Bugs, please\n *    refer below link for details:\n *    http://stackoverflow.com/questions/16226924/is-cross-origin-postmessage-broken-in-ie10\n */\n\n\nexport default function messageHandlerService(AB, $window) {\n   let launchingFunc = null,\n      brokerAddress = '',\n      horizonId = '',\n      userName = '',\n      domainName = '',\n      inited = false;\n\n   /**\n    * check whether the data passed from the HWS is invalid\n    * will treat the data for another HWS session as invalid,\n    * since HWS should never use postMessage for that case.\n    *\n    * @param  {object} data\n    * @return {boolean} This returns whether the action is acceptable\n    * to the WebClient.\n    */\n   function invalidHWSData(data) {\n      if (!data.itemType || !data.itemId || !data.horizonId) {\n         return true;\n      }\n      if (data.horizonId !== horizonId ||\n         decodeURIComponent(data.userName) !== userName ||\n         data.domainName !== domainName) { // message is sent by a invalid horizon session\n         return true;\n      }\n      return false;\n   }\n\n   /**\n    * deal with the postMessage form the HWS\n    * @param  {object} data The structure holds the action related\n    *    information\n    * @return {boolean} This returns whether the message is accepted\n    */\n   function dealWithHWSMessage(data) {\n      let itemType = data.itemType,\n         itemId = decodeURIComponent(data.itemId);\n\n      if (invalidHWSData(data)) {\n         return false;\n      }\n\n      if (typeof launchingFunc === 'function') {\n         launchingFunc(itemType, itemId);\n      }\n      return true;\n   }\n\n   function receiveMessage(event) {\n      let message,\n         success;\n\n      message = JSON.parse(event.data);\n      if (message.type === \"HWS\") {\n         success = dealWithHWSMessage(message.data);\n         if (success) {\n            event.source.postMessage(JSON.stringify({\n               type: \"WebClient\",\n               data: 'Ack'\n            }), \"*\");\n         } else {\n            event.source.postMessage(JSON.stringify({\n               type: \"WebClient\",\n               data: 'Nak'\n            }), \"*\");\n         }\n      }\n   }\n\n   function onStorageChange(event) {\n      let message,\n         success,\n         eventKey = \"HWS_BKA_\" + brokerAddress;\n\n      if (event.key === eventKey) {\n         message = JSON.parse(event.newValue);\n         if (message.origin !== \"newTab\") {\n            return;\n         }\n         success = dealWithHWSMessage(message.data);\n         if (success) { // return a success message.\n            $window.localStorage.setItem(eventKey, JSON.stringify({\n               origin: \"oldTab\", // this message is from a tab older than\n                                 // the reciever tab.\n               data: 'Merged' // message indicate the request content is\n                              // merged successfully into this tab old\n                              // tab.\n            }));\n         }\n      }\n   }\n\n   return {\n      /**\n       * Init function to set the current session info, if param are\n       * correct, listener will also be registered.\n       *\n       * @param {object} localInfo The object contains properties of\n       *    brokerAddress, horizonId, userName, and domainName\n       */\n      init: function(localInfo) {\n         if (inited || !localInfo) {\n            return;\n         }\n         brokerAddress = localInfo.brokerAddress;\n         horizonId = localInfo.horizonId;\n         userName = localInfo.userName;\n         domainName = localInfo.domainName;\n         if (!!brokerAddress && !!horizonId && !!userName &&\n            !!domainName) { //only when info are fully given enable the listener\n            if (!AB.UTIL.supportPostMessage()) {\n               if (!!$window.localStorage) {\n                  $window.addEventListener(\"storage\", onStorageChange,\n                     false);\n               }\n            } else {\n               $window.addEventListener(\"message\", receiveMessage, false);\n            }\n         }\n         inited = true;\n      },\n\n      /**\n       * Used to register in the launch callback, which will be called\n       * when receive the specified request\n       * @param  {function} launchCallback Could be the identical\n       *    function used for sidebar launching\n       */\n      registerLaunchCallback: function(launchCallback) {\n         launchingFunc = launchCallback;\n      },\n\n      /**\n       * @return {Boolean} This returns whether current session is\n       *    launched from HWS\n       */\n      isFromHWS: function() {\n         return !!horizonId;\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/messagehandler-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function panelService($window, AB) {\n   /**\n    * maxYValue\n    *\n    * returns the maximum Y value for the top of the clipboard window so\n    * that all of the window will still be seen\n    */\n   function maxYValue(element) {\n      return Math.max(0, ($window.innerHeight - element[0].offsetHeight));\n   }\n\n   /**\n    * maxXValue\n    *\n    * returns the maximum X value for the left side of the clipboard\n    * window so that all of the window will still be seen or 0 if the\n    * window is wider than the browser.\n    */\n   function maxXValue(element) {\n      return Math.max(0, ($window.innerWidth - element[0].offsetWidth));\n   }\n\n   /**\n    * clampY\n    *\n    * Given a Y value that is to large or two small for the entire\n    * clipboard window to be seen on the screen clamp so that the windows\n    * would be seen. Or 0 if the window is taller than the browser.\n    */\n   function clampY(y, element) {\n      return AB.UTIL.clamp(y, 0, maxYValue(element));\n   }\n\n   /**\n    * clampX\n    *\n    * Given an X value that is to large or two small for the entire\n    * clipboard window to be seen on the screen clamp so that the windows\n    * would be seen\n    */\n   function clampX(x, element) {\n      return AB.UTIL.clamp(x, 0, maxXValue(element));\n   }\n\n   function Service() {\n      // Refer to .panel-front in clipboard.css\n      this.zIndex = 201;\n      this.panelList = [];\n   }\n\n   /**\n    * windowResizeHandler\n    *\n    * Callback invoked when the browser window is resized. If the window\n    * would fall out view because of the resize this method will\n    * reposition it so that it will still be visible\n    */\n   Service.prototype.windowResizeHandler = function(scope, showPanel, element) {\n      if (!scope || !showPanel || !element) {\n         return;\n      }\n\n      return function() {\n         let x, y;\n\n         // Only move the window if it is visible otherwise we will\n         // calculate the wrong x and y\n         if (!scope[showPanel]) {\n            return;\n         }\n\n         /**\n          *  The height or width of the panel can never be 0.\n          *  If offsetWidth or offsetHeight return 0, the element is not\n          *  rendered yet. We need to skip window re-location in this\n          *  situation. Otherwise the panel could be placed at left-top\n          *  of the window.\n          */\n         if (element[0].offsetHeight === 0 ||\n            element[0].offsetWidth === 0) {\n            AB.LOGGER.debug('Element is not ready, do nothing this time.');\n            return;\n         }\n\n         y = clampY(element[0].offsetTop, element);\n         x = clampX(element[0].offsetLeft, element);\n\n         element.css({\n            top: y + 'px',\n            left: x + 'px'\n         });\n      };\n   };\n\n   Service.prototype.addPanelElement = function(name, element) {\n      if (!name || !element) {\n         AB.LOGGER.debug('There is no element to add.');\n         return;\n      }\n\n      this.panelList.push({\n         name: name,\n         element: element\n      });\n   };\n\n   Service.prototype.getNewZIndex = function() {\n      return this.zIndex++;\n   };\n\n   Service.prototype.onFocus = function(name) {\n      for (let i = 0; i < this.panelList.length; i++) {\n         if (this.panelList[i].name === name) {\n            this.panelList[i].element.addClass('panel-front');\n            this.panelList[i].element.removeClass('panel-behind');\n            this.panelList[i].element.css(\"z-index\", this.getNewZIndex());\n         } else {\n            this.panelList[i].element.addClass('panel-behind');\n            this.panelList[i].element.removeClass('panel-front');\n         }\n      }\n   };\n\n   let service = null;\n\n   return {\n      getService: function() {\n         if (!service) {\n            service = new Service();\n         }\n         return service;\n      }\n   };\n}\n\n\n\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/panel-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport angular from 'angular';\nimport MKSVchan from '../channels/mksvchan';\n\nexport function printFrame($timeout, AB, WMKS, $window, wmksService,\n         toastService) {\n   let template, linkFn, postPrint;\n\n   postPrint = function(scope) {\n      scope.isPrinting = false;\n      AB.LOGGER.debug('Printing done, print next one');\n      wmksService.recoverAllHeartbeatForPrint();\n      // The toast is showed for each PDF. Remember to clear it after\n      // printing.\n      $timeout(function() {\n         toastService.clearEarlyToast(toastService.TOAST_TYPE.PRINT);\n      }, 500);\n      scope.printNextFile();\n   };\n\n   if (WMKS.BROWSER.isFirefox()) {\n      template = \"<iframe id='printPDF' style='height: 0;width: 0;border: none;'\" +\n         \"src='../pdfjs/web/viewer.html?v='\" + __BUILD_NUMBER__ + \"></iframe>\";\n      linkFn = function(scope, element) {\n         scope.frame = element[0];\n         $window.addEventListener('message', function(event) {\n            if (event.origin !== location.origin) {\n               AB.LOGGER.debug(\"Unknown origin\");\n               return;\n            }\n\n            if (angular.isString(event.data)) {\n               if (event.data === 'ready') {\n                  scope.viewerReady = true;\n               } else if (event.data === 'print done') {\n                  postPrint(scope);\n               }\n            }\n\n         }, false);\n      };\n   } else if (!WMKS.BROWSER.isIE()) {\n      template = \"<iframe id='printPDF' \" +\n         \"style='height: 0;width: 0;border: none;'></iframe>\";\n      linkFn = function(scope, element) {\n         scope.initialized = false;\n         scope.frame = element[0];\n         scope.frame.onload = function() {\n            AB.LOGGER.debug(\"Entering frame onload\");\n            $timeout(function() {\n               scope.frame.contentWindow.focus();\n               scope.frame.contentWindow.print();\n               scope.isPrinting = true;\n               /**\n                * Bind focus event for iframe window to support print\n                * multiple files\n                */\n               $(scope.frame.contentWindow).on('focus.print', function() {\n                  $(scope.frame.contentWindow).off('focus.print');\n                  postPrint(scope);\n               });\n            }, 0);\n         };\n      };\n   }\n\n   return {\n      restrict: 'E',\n      controller: 'PrintController',\n      replace: true,\n      template: template,\n      link: linkFn\n   };\n}\n\nexport function PrintController(AB, $scope, $timeout, WMKS,\n         wmksService, _, TransferHelper, toastService,\n         wmksServiceEventHandler) {\n   $scope.transferHelper =\n      TransferHelper.getInstance(MKSVchan.FILE_TRANSFER_CONSUMER.PRINT);\n   $scope.isPrinting = false;\n\n   $scope.beginDownload = function(mksClient) {\n      let downloadFiles =\n            mksClient.FTUtil\n               .downloadList[MKSVchan.FILE_TRANSFER_CONSUMER.PRINT],\n         downloadService =\n            mksClient\n               .downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.PRINT];\n      downloadService.init(downloadFiles, function() {\n         AB.LOGGER.debug('Document for print download finished.');\n         if (!$scope.isPrinting) {\n            $scope.printNextFile(downloadFiles);\n         }\n      });\n\n      if (!downloadService.downloadReady()) {\n         return;\n      }\n\n      /**\n       * For print download job, PDF could not be 0 size or a folder, and it\n       * cannot be stopped. So the error can only be that PDF is exceeding\n       * 500MB size.\n       *\n       * For print download job, server always send new added file one by\n       * one. So we just need to verify the last file in the queue.\n       *\n       * There are 4 situations:\n       * 1. No ft task, no error file. Just show the normal toast.\n       * 2. No ft task, error file exists. Show toast to warn\n       *    user there is error file which cannot be printed.\n       * 3. FT task exists, no error file. Show toast print job blocked.\n       * 4. FT task exists, error file exists. Show toast to warn\n       *    user there is error file which cannot be printed.\n       */\n      if ($scope.ifLatestFileHasTransferError(downloadFiles)) {\n         toastService.warning(_('PRINT_FILE_TOO_LARGE'),\n            toastService.TOAST_TYPE.PRINT);\n      } else if (wmksService.isFileDownloadingInCurrentSession()) {\n         toastService.warning(_('PRINT_BLOCK_BY_FT'),\n            toastService.TOAST_TYPE.PRINT);\n      } else {\n         toastService.info(_(\"PRINT_FILE_DOWNLOAD_BEGIN\"),\n            toastService.TOAST_TYPE.PRINT);\n      }\n\n      downloadService.beginDownload();\n   };\n\n   /**\n    * If downloadFiles is past in, use it. Otherwise search for the entire\n    * download list.\n    * @param downloadFiles\n    */\n   $scope.printNextFile = function(downloadFiles) {\n      let list;\n      if (typeof downloadFiles === 'undefined') {\n         // Search for entire download list.\n         AB.LOGGER.debug('No download list past in,' +\n            ' search for other mks client.');\n         list = $scope.searchForNextDownloadList();\n      } else {\n         AB.LOGGER.debug('Download list past in.');\n         list = downloadFiles;\n      }\n\n      // Search for a downloaded file and print it\n      if (!list || list.length <= 0) {\n         AB.LOGGER.debug('There is not more file to print.');\n         return;\n      }\n\n      for (let i = 0; i < list.length; i++) {\n         if (list[i].progress === 100) {\n            $scope.printFile(list[i], list);\n            return;\n         }\n      }\n   };\n\n   $scope.searchForNextDownloadList = function() {\n      let mksClientList = wmksService.getAllmksClient(),\n         downloadFileList;\n      for (let i = 0; i < mksClientList.length; i++) {\n         downloadFileList = mksClientList[i].FTUtil\n            .downloadList[MKSVchan.FILE_TRANSFER_CONSUMER.PRINT];\n         for (let j = 0; j < downloadFileList.length; j++) {\n            if (downloadFileList[j].progress === 100) {\n               AB.LOGGER.debug('Download list found for print.');\n               return downloadFileList;\n            }\n         }\n      }\n\n      AB.LOGGER.debug('No download list is ready for print.');\n      return [];\n   };\n\n   $scope.ifLatestFileHasTransferError = function(downloadFiles) {\n      let length = downloadFiles.length,\n         transferError;\n      if (!downloadFiles || length <= 0) {\n         return false;\n      }\n\n      transferError = downloadFiles[length - 1].transferError;\n      // Remove the file if it has transfer error\n      if (transferError) {\n         downloadFiles.splice(length - 1, 1);\n      }\n      return transferError;\n   };\n\n   $scope.sendMsg = function(file) {\n      $scope.isPrinting = true;\n      $scope.frame.contentWindow.postMessage(file.contentData,\n         location.origin);\n   };\n\n   $scope.printFile = function(file, downloadFiles) {\n      wmksService.shadowAllHeartbeatForPrint();\n      if (WMKS.BROWSER.isFirefox()) {\n         if ($scope.viewerReady) {\n            $scope.sendMsg(file);\n         }\n      } else {\n         let data;\n         data = new Blob([file.contentData.buffer], {\n            type: 'application/pdf'\n         });\n\n         if (!!$scope.frame) {\n            $scope.frame.contentWindow.\n            location.replace(window.URL.createObjectURL(data));\n         }\n      }\n\n      // Delete the file once it is printed.\n      $scope.clearFileDataAfterPrint(file, downloadFiles);\n   };\n\n   $scope.clearFileDataAfterPrint = function(file, downloadFiles) {\n      for (let i = 0; i < downloadFiles.length; i++) {\n         if (file === downloadFiles[i]) {\n            downloadFiles.splice(i, 1);\n            break;\n         }\n      }\n   };\n\n   if (!WMKS.BROWSER.isIE()) {\n      // IE is disabled\n      wmksServiceEventHandler.addEventListener(\n         'downloadPrintFileListChanged',\n         function(fileList, client, error) {\n            $timeout(function() {\n               if (client.FTUtil.config.printDownloadEnabled === false ||\n                  !fileList || fileList.length <= 0 ||\n                  !client.downloadServices\n                     [MKSVchan.FILE_TRANSFER_CONSUMER.PRINT]) {\n                  AB.LOGGER.log(\"Download not enable or list is empty!\");\n                  return;\n               }\n\n               if (error === MKSVchan.CLIPBOARD_ERROR.MAX_LIMIT_EXCEEDED) {\n                  AB.LOGGER.log(\"File list exceeds the max size!\");\n               }\n\n               // Store old and new file list\n               $scope.transferHelper.updateDownloadFileList(fileList,\n                  client);\n               $scope.beginDownload(client);\n            });\n         });\n\n      wmksServiceEventHandler.addEventListener('printError',\n         function(error) {\n            switch (error) {\n               case MKSVchan.FILE_TRANSFER_ERROR.PRINT_TIMEOUT:\n                  toastService.warning(_(\"PRINT_FILE_TIMEOUT\"),\n                     toastService.TOAST_TYPE.PRINT);\n                  break;\n               default:\n                  AB.LOGGER.error('Invalid error number: ' + error +\n                     ' received from server.');\n            }\n         });\n      wmksServiceEventHandler.listenerReadyForModule(\n         wmksServiceEventHandler.MODULE_NAME.PRINT);\n\n      $scope.transferHelper.addStatusListener(function() {\n         $scope.transferHelper.initTransferService();\n      });\n   }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/print-service.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * runningitem-model.js --\n *\n * Module to provide running items information for Sidebar.\n *\n */\n\nimport angular from 'angular';\nimport signal from './signal';\nimport Unity from '../remoteapp/unity';\n\nexport default function runningItemsModel(AB, wmksService, unityService,\n                                          $rootScope,\n                                          $timeout, _,\n                                          wmksServiceEventHandler) {\n   let runningItems = [],\n      /*\n       * Fast query table for visible window, associate windowId with itemObj\n       * in application instance array.\n       */\n      runningVisibleItemsMap = {},\n      // Fast query table for apps, associate windowPath+execPath with\n      // application array.\n      runningApplicationMap = {},\n      // Fast query table for all available unity Windows from server.\n      runningItemsMap = {},\n      // Fast Query table for all running desktops.\n      runningDesktopMap = {},\n\n      // Special \"Loading\" item that contains placeholders for loading\n      // sessions\n      loadingSessionsItem = null,\n      loadingSessionsMap = {},\n\n      // Add/Delete/Update operation for application level array.\n      getApplicationItems = null,\n      removeApplicationItems = null,\n      updateApplicationAttribute = null,\n      updateApplicationFocusedItem = null,\n\n      // Add/Delete/Update operation for running item level array.\n      addRunningItem = null,\n      setCanvasVisibility = null,\n      updateRunningItemVisibility = null,\n      removeRunningItem = null,\n      updateRunningItem = null,\n      updateRunningItemAttribute = null,\n      updateRunningItemType = null,\n      isRunningItemVisibleOnUI = null,\n      checkVisibleWindows = null,\n\n      // Remove all the items from the same farm.\n      removeAllRunningItemsPerSession = null,\n\n      // Enable disable for running application and desktop.\n      changeRunningItemStatus = null,\n\n      // Helper function to generate application and running item id.\n      generateApplicationId = null,\n      generateRunningItemId = null,\n\n      checkVisibleWindowTimer = null,\n      checkVisibleWindowTimeout = 300,\n      unityReadyTimer = null,\n      unityReadyTimeout = 1000,\n      onUnityReady = null,\n\n      /**\n       * Fill in current shown desktop item info.\n       */\n      addDesktopItem = null,\n      removeDesktopItem = null,\n\n      addLoadingPlaceholder = null,\n      removeLoadingPlaceholder = null,\n      addAttentionRequired = null,\n      removeAttentionRequired = null,\n\n      changeFocusedSession = null,\n      onSessionRemoved = null,\n      currentFocusWmksKey = null,\n      // Init method to register all the callbacks.\n      self = this,\n      init = null;\n\n   /**\n    * generateApplicationId\n    *\n    * Generate a unique id based on parameters.\n    * @param wmksKey     the key to identify this unique wmksSession.\n    * @param windowPath  window path for this application.\n    * @param exePath     exec path for this application.\n    * return unique application id.\n    */\n   generateApplicationId = function(wmksKey, windowPath, execPath) {\n      return wmksKey + windowPath + execPath;\n   };\n\n   /**\n    * generateRunningItemId\n    *\n    * Generate a unique id based on parameters.\n    * @param wmksKey     the key to identify this unique wmksSession.\n    * @param windowId    window id for this application.\n    * return unique running item id.\n    */\n   generateRunningItemId = function(wmksKey, windowId) {\n      return wmksKey + windowId;\n   };\n\n   /**\n    * getApplicationItems\n    *\n    * Get an application item instance by windowPath and execPath.\n    * If the application doesn't exist and createNew is true, then create\n    * a new application and request an attr update from the server.\n    *\n    * @param wmksKey     the key to identify this unique wmksSession.\n    * @param windowPath  window path for this application.\n    * @param exePath     exec path for this application.\n    * @param windowId    windowId for the unity window calling this\n    *    function\n    * @param createNew   flags whether we should create a running\n    *    application if no application is found\n    *\n    * return application item if found, else, returns null.\n    */\n   getApplicationItems = function(wmksKey, windowPath, execPath,\n                                  windowId, createNew) {\n      let id = generateApplicationId(wmksKey, windowPath, execPath),\n         newApplication;\n      if (!runningApplicationMap[id]) {\n         if (!createNew) {\n            return null;\n         }\n         newApplication = {\n            wmksKey: wmksKey,\n            windowPath: windowPath,\n            execPath: execPath,\n            iconSrc: AB.CONST.ICONS.BIG_DEFAULT_ICON,\n            name: _(\"LOADING_APP\"),\n            focusedItem: null,\n            isCollapsed: true,\n            type: AB.CONST.ITEMS_TYPE.LOADING_APP,\n            state: AB.CONST.ITEMS_STATE.CONNECTED,\n            instances: [],\n            orderedInstances: [], // instances ordered from LRU to MRU\n            isFocusedItem: function() {\n               return (this.wmksKey === currentFocusWmksKey) &&\n                  !!this.focusedItem;\n            }\n         };\n         runningApplicationMap[id] = newApplication;\n         runningItems.push(newApplication);\n         // This is the first window and we need to retrieve application\n         // name and icon.\n         unityService.getAppAttr(wmksKey, windowPath, execPath, windowId);\n      }\n      return runningApplicationMap[id];\n   };\n\n   /**\n    * removeApplicationItems\n    *\n    * Remove an application item instance by windowPath and execPath.\n    *\n    * @param wmksKey     the key to identify this unique wmksSession.\n    * @param windowPath  window path for this application.\n    * @param exePath     exec path for this application.\n    * return true if removing this application.\n    */\n   removeApplicationItems = function(wmksKey, windowPath, execPath) {\n      let id = generateApplicationId(wmksKey, windowPath, execPath),\n         currentApp,\n         appIndex;\n\n      if (runningApplicationMap[id]) {\n         currentApp = runningApplicationMap[id];\n         appIndex = runningItems.indexOf(currentApp);\n         if (appIndex !== -1) {\n            runningItems.splice(appIndex, 1);\n         }\n\n         delete runningApplicationMap[id];\n         return true;\n      }\n      return false;\n   };\n\n   /**\n    * updateApplicationAttribute\n    *\n    * Update an application item attributes by windowPath and execPath.\n    * It will fire a value changed event.\n    *\n    * @param wmksKey     the key to identify this unique wmksSession.\n    * @param windowPath  window path for this application.\n    * @param exePath     exec path for this application.\n    * @param params      params value to be updated.\n    * return true if value is updated.\n    */\n   updateApplicationAttribute =\n      function(wmksKey, windowPath, execPath, params) {\n         let id = generateApplicationId(wmksKey, windowPath, execPath),\n            currentApp;\n\n         if (runningApplicationMap[id]) {\n            currentApp = runningApplicationMap[id];\n            if (angular.isString(params.iconSrc)) {\n               currentApp.iconSrc = params.iconSrc;\n            }\n            if (angular.isString(params.windowTitle)) {\n               currentApp.name = params.windowTitle;\n            }\n            currentApp.type = AB.CONST.ITEMS_TYPE.APP;\n            self.emit(\"valueChanged\");\n            return true;\n         }\n         return false;\n      };\n\n   /**\n    * updateApplicationFocusedItem\n    *\n    * Update an focused item property in its parent application item.\n    * It will also reset all others application focused item to null.\n    * For we only allow one focused item even if there are multiple farms.\n    *\n    * @param focusedItem current focused item.\n    */\n   updateApplicationFocusedItem = function(focusedItem) {\n      let currentApp = getApplicationItems(focusedItem.wmksKey,\n         focusedItem.windowPath,\n         focusedItem.execPath, focusedItem.windowId,\n         false),\n         applicationIdKey = null,\n         index = -1;\n\n      if (currentApp) {\n         currentApp.focusedItem = focusedItem;\n\n         // Move the current item to the end of the ordered instance list\n         index = currentApp.orderedInstances.indexOf(focusedItem);\n         if (index !== -1) {\n            currentApp.orderedInstances.splice(index, 1);\n         }\n         currentApp.orderedInstances.push(focusedItem);\n\n         /*\n          * Reset other focused unity Window in same farmer to false.\n          */\n         for (applicationIdKey in runningApplicationMap) {\n            if (runningApplicationMap.hasOwnProperty(applicationIdKey) &&\n               runningApplicationMap[applicationIdKey] !== currentApp &&\n               runningApplicationMap[applicationIdKey].wmksKey ===\n               currentApp.wmksKey &&\n               runningApplicationMap[applicationIdKey].focusedItem) {\n               runningApplicationMap[applicationIdKey].focusedItem.isFocused =\n                  false;\n               runningApplicationMap[applicationIdKey].focusedItem = null;\n            }\n         }\n         return true;\n      } else {\n         AB.LOGGER.warn(\n            \"updateApplicationFocusedItem: application not found\");\n         return false;\n      }\n   };\n\n   /**\n    * addRunningItem\n    *\n    * Add an window item instance by windowId to items map.\n    * All the new window is located in items map and it is\n    * not visible.\n    *\n    * @param wmksKey     the key to identify this unique wmksSession.\n    * @param windowId    window id for this application.\n    * @param windowPath  window path for this application.\n    * @param exePath     exec path for this application.\n    * return true if a running item is added.\n    */\n   addRunningItem = function(wmksKey, windowId, windowPath, execPath) {\n      let id = generateRunningItemId(wmksKey, windowId),\n         newItem,\n         applicationItem;\n      if (!runningVisibleItemsMap[id] && !runningItemsMap[id]) {\n         newItem = {\n            wmksKey: wmksKey,\n            windowId: windowId,\n            windowPath: windowPath,\n            execPath: execPath,\n            iconSrc: AB.CONST.ICONS.SMALL_DEFAULT_ICON,\n            isFocused: false,\n            name: '',\n            /*\n             * Todo :Remove all the following three attributes after we\n             * have a kind of unity-window-ready notification in unity.js.\n             * We should use cached data in unity.js in the end.\n             */\n            windowType: undefined,\n            isTransparent: true,\n            isToolWindow: true,\n            // Remove this attribute and use cached data in unity.js\n            isMinimized: undefined\n         };\n         runningItemsMap[id] = newItem;\n         return true;\n      } else {\n         return false;\n      }\n   };\n\n   /*\n    * updateRunningItemVisibility\n    *\n    * Checks a running item's visibility. If the item is visible and in the\n    * runningItemsMap, move it to runningVisibleItemsMap. If the item is not\n    * visible and in runningVisibleItemsMap, move it to runningItemsMap. This\n    * method should be called on a window whenever one of its parameters that\n    * may effect visibility is changed.\n    *\n    * NOTE: If an item's visibility is changed, this method will emit valueChanged\n    *\n    * @params: item - the running item to check visibility on\n    *\n    * @return: Returns true if the item visibility has changed (the item has been\n    * moved to a different running item map based on visibility)\n    */\n   updateRunningItemVisibility = function(item) {\n      let id = generateRunningItemId(item.wmksKey, item.windowId),\n         applicationItem,\n         removed;\n\n      if (runningItemsMap[id] && isRunningItemVisibleOnUI(item)) {\n         applicationItem =\n            getApplicationItems(item.wmksKey, item.windowPath,\n               item.execPath, item.windowId,\n               true);\n         runningVisibleItemsMap[id] = item;\n         delete runningItemsMap[id];\n         applicationItem.instances.push(item);\n         if (item.isFocused === true) {\n            updateApplicationFocusedItem(item);\n         }\n         self.emit(\"valueChanged\");\n         return true;\n      } else if (runningVisibleItemsMap[id] &&\n         !isRunningItemVisibleOnUI(item)) {\n         removed = removeRunningItem(item.wmksKey, item.windowId);\n         if (removed) {\n            // removeRunningItem already emits valueChanged on success\n            runningItemsMap[id] = item;\n         }\n         return removed;\n      } else {\n         return false;\n      }\n   };\n\n   /*\n    * setCanvasVisibility\n    *\n    * Set a running item's visibility.\n    *\n    * @params: wmksKey - the key to identify this unique wmksSession.\n    *\n    * @isShow: set visibility to show or hide\n    */\n   setCanvasVisibility = function(wmksKey, isShow) {\n      wmksService.setCanvasVisibility(wmksKey, isShow);\n   };\n\n   /**\n    * removeRunningItem\n    *\n    * remove an window item instance by windowId.\n    * if this running item is the last instance of its application,\n    * application item would be removed, too.\n    * It will fire a value changed event if it is visible.\n    *\n    * @param wmksKey     the key to identify this unique wmksSession.\n    * @param windowId    window id for this application.\n    * return true if a running item is removed.\n    */\n   removeRunningItem = function(wmksKey, windowId) {\n      let id = generateRunningItemId(wmksKey, windowId),\n         currentItem,\n         currentApp,\n         itemIndex,\n         orderedItemIndex;\n\n      currentItem = runningItemsMap[id];\n      /*\n       * It is in the running item maps. It is not visible on the UI yet.\n       * We only need to remove it from this temporary cache.\n       */\n      if (currentItem) {\n         delete runningItemsMap[id];\n         currentItem = null;\n         return true;\n      }\n\n      currentItem = runningVisibleItemsMap[id];\n      if (currentItem) {\n         currentApp = getApplicationItems(currentItem.wmksKey,\n            currentItem.windowPath,\n            currentItem.execPath, windowId, false);\n         if (!currentApp) {\n            AB.LOGGER.warn(\"removeRunningItem: application not found\");\n            return false;\n         }\n         itemIndex = currentApp.instances.indexOf(currentItem);\n         if (itemIndex !== -1) {\n            currentApp.instances.splice(itemIndex, 1);\n         }\n\n         orderedItemIndex =\n            currentApp.orderedInstances.indexOf(currentItem);\n         if (orderedItemIndex !== -1) {\n            currentApp.orderedInstances.splice(orderedItemIndex, 1);\n         }\n\n         if (currentApp.focusedItem === currentItem) {\n            currentApp.focusedItem = null;\n         }\n\n         if (currentApp.instances.length === 0) {\n            removeApplicationItems(currentItem.wmksKey,\n               currentApp.windowPath, currentApp.execPath);\n         } else if (currentApp.instances.length === 1) {\n            currentApp.isCollapsed = true;\n         }\n\n         delete runningVisibleItemsMap[id];\n         currentItem = null;\n         self.emit(\"valueChanged\");\n\n         checkVisibleWindows();\n         return true;\n      } else {\n         return false;\n      }\n   };\n\n   /**\n    * updateRunningItem\n    *\n    * Update an running item attributes by windowId.\n    * It will fire a value changed event if the item is visible.\n    *\n    * @param wmksKey   the key to identify this unique wmksSession.\n    * @param windowId  window id for this running item.\n    * @param params    params value to be updated.\n    * return true if value is updated.\n    */\n   updateRunningItem = function(wmksKey, windowId, params) {\n      let id = generateRunningItemId(wmksKey, windowId),\n         currentItem,\n         visibleChanged = false,\n         isFromVisibleMap = true;\n\n      currentItem = runningVisibleItemsMap[id];\n      if (!currentItem) {\n         currentItem = runningItemsMap[id];\n         isFromVisibleMap = false;\n      }\n\n      if (currentItem) {\n         if (angular.isString(params.windowTitle)) {\n            currentItem.name = params.windowTitle;\n         }\n\n         if (angular.isString(params.iconSrc)) {\n            currentItem.iconSrc = params.iconSrc;\n         }\n\n         if (angular.isString(params.windowTitle) ||\n            angular.isString(params.iconSrc)) {\n            visibleChanged = updateRunningItemVisibility(currentItem);\n         }\n\n         /*\n          * Notify UI only if item is visible and visibility has not changed.\n          * Note that if visibility changes, updateRunningItemVisibility will\n          * handle the valueChanged signal.\n          */\n         if (isFromVisibleMap && !visibleChanged) {\n            self.emit(\"valueChanged\");\n         }\n         return true;\n      } else {\n         return false;\n      }\n   };\n\n   /**\n    * updateRunningItemAttribute\n    *\n    * Update an running item attributes by windowId.\n    * It will fire a value changed event if instance value is changed\n    * and this item is visible.\n    *\n    * @param wmksKey   the key to identify this unique wmksSession.\n    * @param windowId  window id of unity window.\n    * @param type      type of value.\n    * @param value     value of this attribute.\n    * return true if value is updated.\n    */\n   updateRunningItemAttribute = function(wmksKey, windowId, type, value) {\n      let id = generateRunningItemId(wmksKey, windowId),\n         currentItem,\n         currentApp = null,\n         isChanged = false,\n         applicationIdKey = null,\n         isFromVisibleMap = true;\n\n      currentItem = runningVisibleItemsMap[id];\n      if (!currentItem) {\n         currentItem = runningItemsMap[id];\n         isFromVisibleMap = false;\n      }\n\n      if (currentItem) {\n         if (type === Unity.WINDOW_ATTR_FOCUSED &&\n            currentItem.isFocused !== value) {\n            currentItem.isFocused = value;\n            if (value === true) {\n               updateApplicationFocusedItem(currentItem);\n            } else {\n               currentApp = getApplicationItems(currentItem.wmksKey,\n                  currentItem.windowPath,\n                  currentItem.execPath,\n                  currentItem.windowId,\n                  false);\n               if (currentApp && currentApp.focusedItem === currentItem) {\n                  currentApp.focusedItem = null;\n               }\n            }\n            self.emit(\"valueChanged\");\n            isChanged = true;\n         } else if (type === Unity.WINDOW_ATTR_TRANSPARENT ||\n            type === Unity.WINDOW_ATTR_TOOLWINDOW) {\n            if (type === Unity.WINDOW_ATTR_TRANSPARENT) {\n               currentItem.isTransparent = value;\n            } else if (type === Unity.WINDOW_ATTR_TOOLWINDOW) {\n               currentItem.isToolWindow = value;\n            }\n            isChanged = updateRunningItemVisibility(currentItem);\n         } else if (type === Unity.WINDOW_ATTR_MINIMIZED) {\n            currentItem.isMinimized = value;\n            if (value === true) {\n               checkVisibleWindows();\n               isChanged = false;\n            }\n         }\n      }\n      return isChanged;\n   };\n\n   /**\n    * updateRunningItemType\n    *\n    * Update an running item type by windowId.\n    * The item would become visible if all the conditions are meet.\n    * It will fire a value changed event.\n    *\n    * @param wmksKey   the key to identify this unique wmksSession.\n    * @param windowId  window id for this running item.\n    * @param type      window type.\n    * return true if value is updated.\n    */\n   updateRunningItemType = function(wmksKey, windowId, type) {\n      let id = generateRunningItemId(wmksKey, windowId),\n         currentItem,\n         isFromVisibleMap = false;\n\n      currentItem = runningItemsMap[id];\n      if (!currentItem) {\n         currentItem = runningVisibleItemsMap[id];\n         isFromVisibleMap = true;\n      }\n\n      if (!!currentItem) {\n         currentItem.windowType = type;\n         return updateRunningItemVisibility(currentItem);\n      } else {\n         return false;\n      }\n   };\n\n   /**\n    * isRunningItemVisibleOnUI\n    *\n    * If two attributes are changed from true to false,\n    * and its window type is normal,\n    * we will consider this running item is visible on UI.\n    * Todo: Remove this to Unity-service.js util we have\n    * unity-window-ready notification in unity.js.\n    *\n    * @param runningItem running item\n    *\n    * Return true if running item is visible on UI.\n    */\n   isRunningItemVisibleOnUI = function(runningItem) {\n      if (!runningItem.name && !runningItem.iconSrc) {\n         return false;\n      }\n      return (runningItem.windowType === Unity.WINDOW_TYPE_NORMAL &&\n      runningItem.isTransparent === false &&\n      runningItem.isToolWindow === false);\n   };\n\n   /**\n    * checkVisibleWindows\n    *\n    * If unity is running and there is no visible running item on the\n    * current active session, we should popup sidebar if sidebar is\n    * collapsed. And emit \"noVisibleWindow\" to notify the sidebar to open\n    * if collapsed We don't care about the item which is not visible on\n    * the sidebar.\n    *\n    */\n   checkVisibleWindows = function(ignoreUnity) {\n      /*\n       * If unity has just become ready, we set a timer that blocks visible\n       * window checks. We need to wait a bit for us to be notified of all\n       * the windows on a pre-existing session, or we may open the sidebar\n       * when no windows are visible, but the server has not yet sent us the\n       * data on visible items on the desktop.\n       */\n      if (!!unityReadyTimer) {\n         return;\n      }\n\n      // Do not open sidebar if unity is paused, we are likely in UAC mode\n      if ((typeof ignoreUnity === 'undefined' || !ignoreUnity)\n         && !unityService.isUnityRunning(currentFocusWmksKey)) {\n         return;\n      }\n\n      if (checkVisibleWindowTimer) {\n         $timeout.cancel(checkVisibleWindowTimer);\n         checkVisibleWindowTimer = null;\n      }\n      checkVisibleWindowTimer = $timeout(function() {\n         let runningItemKey;\n\n         checkVisibleWindowTimer = null;\n         for (runningItemKey in runningVisibleItemsMap) {\n            if (runningVisibleItemsMap.hasOwnProperty(runningItemKey) &&\n               runningVisibleItemsMap[runningItemKey].wmksKey ===\n               currentFocusWmksKey &&\n               !runningVisibleItemsMap[runningItemKey].isMinimized) {\n               return;\n            }\n         }\n         self.emit(\"noVisibleWindow\");\n      }, checkVisibleWindowTimeout, false);\n   };\n\n   /**\n    * removeAllRunningItemsPerSession\n    *\n    * Remove all the running items from the specified farm.\n    * It will fire a value changed event if instance value is changed.\n    *\n    * @param wmksKey   the key to identify this unique wmksSession.\n    */\n   removeAllRunningItemsPerSession = function(wmksKey) {\n      let runningItemKey,\n         removed = false;\n      for (runningItemKey in runningItemsMap) {\n         if (runningItemsMap.hasOwnProperty(runningItemKey) &&\n            runningItemsMap[runningItemKey].wmksKey === wmksKey) {\n            if (removeRunningItem(wmksKey,\n                  runningItemsMap[runningItemKey].windowId)) {\n               removed = true;\n            }\n         }\n      }\n\n      for (runningItemKey in runningVisibleItemsMap) {\n         if (runningVisibleItemsMap.hasOwnProperty(runningItemKey) &&\n            runningVisibleItemsMap[runningItemKey].wmksKey === wmksKey) {\n            if (removeRunningItem(wmksKey,\n                  runningVisibleItemsMap[runningItemKey].windowId)) {\n               removed = true;\n            }\n         }\n      }\n      return removed;\n   };\n\n   /**\n    * addDesktopItem\n    *\n    * Handle the notification from wmksSevice about the added desktop.\n    * Add current desktop item into running section and set the current\n    * desktop to be focused. And notify UI if value is changed.\n    *\n    * @params desktopId unique desktopId.\n    * @params isApplicationSession if it is an application session.\n    * @params isShadowSession if it is a shadow session.\n    * @params desktopName current desktop name\n    * Return true if a desktop item is added successfully.\n    */\n   addDesktopItem =\n      function(desktopId, isApplicationSession, isShadow, desktopName) {\n         let newDesktopItem;\n         if (isApplicationSession) {\n            return false;\n         }\n\n         if (!runningDesktopMap[desktopId]) {\n            newDesktopItem = {\n               wmksKey: desktopId,\n               name: desktopName,\n               type: AB.CONST.ITEMS_TYPE.DESKTOP,\n               state: AB.CONST.ITEMS_STATE.CONNECTED,\n               isShadow: isShadow,\n               instances: [],\n               isCollapsed: true,\n               isFocusedItem: function() {\n                  return (desktopId === currentFocusWmksKey);\n               }\n            };\n\n            runningItems.push(newDesktopItem);\n            runningDesktopMap[desktopId] = newDesktopItem;\n            self.emit(\"valueChanged\");\n            return true;\n         } else {\n            return false;\n         }\n      };\n\n   /**\n    * onUnityReady\n    *\n    * Called when a unity session becomes ready. First, search for and\n    * remove any session placeholder entries in runningItems. Then, start\n    * a timer that blocks checkVisibleWindows in its duration, then calls\n    * checkVisibleWindows on completion. This lets us wait a short\n    * duration for unity to reload the windows on the session before we\n    * do a visible windows check. See bug #1398864\n    *\n    * @params wmksKey: the key of the wmks session that has become ready\n    */\n   onUnityReady = function(wmksKey) {\n      removeAttentionRequired(wmksKey);\n\n      if (!!unityReadyTimer) {\n         return;\n      }\n      unityReadyTimer = $timeout(function() {\n         unityReadyTimer = null;\n         checkVisibleWindows();\n      }, unityReadyTimeout, false);\n   };\n\n   /**\n    * changeFocusedSession\n    *\n    * Handle the notification from wmksSevice about the changed active\n    * session. set the current focused session key and notify UI.\n    *\n    * @params wmksKey unique identifier for session.\n    */\n   changeFocusedSession = function(wmksKey) {\n      if (currentFocusWmksKey !== wmksKey) {\n         currentFocusWmksKey = wmksKey;\n         self.emit(\"valueChanged\");\n      }\n\n      // If we are currently focused on a session loading placeholder,\n      // unfocus it\n      if (loadingSessionsItem.focusedItem) {\n         loadingSessionsItem.focusedItem.isFocused = false;\n         loadingSessionsItem.focusedItem = null;\n      }\n      // If focused session has a loading placeholder, set focus on the\n      // placeholder\n      if (loadingSessionsMap[wmksKey]) {\n         loadingSessionsItem.focusedItem = loadingSessionsMap[wmksKey];\n         loadingSessionsItem.focusedItem.isFocused = true;\n      }\n   };\n\n   /**\n    * onSessionRemoved\n    *\n    * Responds to a session removed event, will remove any placeholders\n    * and desktop items associated with the given session.\n    *\n    * @params wmksKey: the key of the calling session\n    */\n   onSessionRemoved = function(wmksKey, isApplicationSession) {\n      let removed = false;\n\n      removeLoadingPlaceholder(wmksKey);\n\n      if (isApplicationSession) {\n         removed = removeAllRunningItemsPerSession(wmksKey);\n      } else {\n         removed = removeDesktopItem(wmksKey);\n      }\n      // If we removed a session, do a visible windows check\n      if (removed) {\n         checkVisibleWindows(true);\n      }\n   };\n\n   /**\n    * removeDesktopItem\n    *\n    * Handle the notification from wmksSevice about the removed desktop.\n    * Remove specified desktop and notify UI if value is changed.\n    *\n    * @params desktopId unique desktopId.\n    */\n   removeDesktopItem = function(desktopId) {\n      let desktopItemIndex = -1,\n         currentDesktopItem = runningDesktopMap[desktopId];\n      if (currentDesktopItem) {\n         desktopItemIndex = runningItems.indexOf(currentDesktopItem);\n         if (desktopItemIndex !== -1) {\n            runningItems.splice(desktopItemIndex, 1);\n         }\n         delete runningDesktopMap[desktopId];\n         self.emit(\"valueChanged\");\n         return true;\n      } else {\n         return false;\n      }\n   };\n\n   /**\n    * addLoadingPlaceholder\n    *\n    * Creates a placeholder for a loading session, to be displayed as an\n    * instance under the special \"Loading\" item. If the \"Loading\" item is\n    * not displayed, add it to the list of displayed items.\n    *\n    * @param wmksKey: The key of the calling wmks session\n    */\n   addLoadingPlaceholder = function(wmksKey) {\n      let newSessionInstance = {\n         wmksKey: wmksKey,\n         name: _(\"LOADING_SESSION\"),\n         iconSrc: AB.CONST.ICONS.LOADING_ICON,\n         isFocused: false\n      };\n\n      /*\n       * if we had no placeholders and we just added one, add the loading item to\n       * the runningItems list\n       */\n      if (loadingSessionsItem.instances.length === 0) {\n         runningItems.push(loadingSessionsItem);\n      }\n      loadingSessionsItem.instances.push(newSessionInstance);\n      loadingSessionsMap[wmksKey] = newSessionInstance;\n\n      // If session placeholder is focused, set focus on UI\n      if (currentFocusWmksKey === wmksKey) {\n         loadingSessionsItem.focusedItem = newSessionInstance;\n         loadingSessionsItem.focusedItem.isFocused = true;\n      }\n   };\n\n   /**\n    * removeLoadingPlaceholder\n    *\n    * Removes a loading items placeholder instance for a given session.\n    * If the\n    * \"Loading\" item has no instances, remove it from the sidebar.\n    *\n    * @param wmksKey: The key of the calling wmks session\n    */\n   removeLoadingPlaceholder = function(wmksKey) {\n      /*\n       * If session leaves the connecting state, remove any session\n       * placeholder entries that exist.\n       */\n      let currentSessionInstance = loadingSessionsMap[wmksKey];\n      let index = loadingSessionsItem.instances.indexOf(\n         currentSessionInstance);\n\n      if (!currentSessionInstance) {\n         return;\n      }\n\n      if (loadingSessionsItem.focusedItem === currentSessionInstance) {\n         loadingSessionsItem.focusedItem = null;\n      }\n\n      if (index !== -1) {\n         loadingSessionsItem.instances.splice(index, 1);\n      }\n\n      /*\n       * if the last placeholder has been removed, remove the loading\n       * item from runningItems\n       */\n      if (loadingSessionsItem.instances.length === 0) {\n         index = runningItems.indexOf(loadingSessionsItem);\n         if (index !== -1) {\n            runningItems.splice(index, 1);\n         }\n      }\n\n      delete loadingSessionsMap[wmksKey];\n      self.emit(\"valueChanged\");\n   };\n\n   /**\n    * addAttentionRequired\n    *\n    * Adds an \"Attention Required\" item for a paused session to the\n    * sidebar.\n    *\n    * @param wmksKey: The key of the calling wmks session\n    */\n   addAttentionRequired = function(wmksKey) {\n      let newSessionItem;\n\n      if (!runningItemsMap[wmksKey]) {\n         newSessionItem = {\n            wmksKey: wmksKey,\n            name: _('ATTENTION_REQUIRED'),\n            iconSrc: AB.CONST.ICONS.ATTENTION_ICON,\n            type: AB.CONST.ITEMS_TYPE.NEED_ATTENTION,\n            instances: [],\n            isCollapsed: true,\n            isFocusedItem: function() {\n               return (wmksKey === currentFocusWmksKey);\n            }\n         };\n         runningItems.push(newSessionItem);\n         runningItemsMap[wmksKey] = newSessionItem;\n\n         self.emit(\"valueChanged\");\n      } else {\n         AB.LOGGER.warn(\n            \"addAttentionRequired: attempted to add placeholder that already existed\");\n      }\n   };\n\n   /**\n    * removeAttentionRequired\n    *\n    * Removes the \"Attention Required\" item for a given paused session to\n    * the sidebar.\n    *\n    * @param wmksKey: The key of the calling wmks session\n    */\n\n   removeAttentionRequired = function(wmksKey) {\n      let sessionItem, index;\n      if (runningItemsMap[wmksKey]) {\n         sessionItem = runningItemsMap[wmksKey];\n         index = runningItems.indexOf(sessionItem);\n         if (index !== -1) {\n            runningItems.splice(index, 1);\n         }\n         delete runningItemsMap[wmksKey];\n         self.emit(\"valueChanged\");\n      } else {\n         AB.LOGGER.warn(\n            \"removeAttentionRequired: attemped to remove placeholder that did not exist\");\n      }\n   };\n\n   /**\n    * changeRunningItemStatus\n    *\n    * Change item status based on session status.\n    *\n    * @params wmksKey unique session id.\n    * @params isApplicationSession isDesktop or application.\n    * @params state: the item state to change to\n    * Return true if status is changed.\n    */\n   changeRunningItemStatus =\n      function(wmksKey, isApplicationSession, state) {\n         let isChanged = false,\n            runningApplicationKey,\n            currentItem,\n            hasApps = false;\n\n         if (!isApplicationSession) {\n            currentItem = runningDesktopMap[wmksKey];\n            if (currentItem && currentItem.state !== state) {\n               currentItem.state = state;\n               isChanged = true;\n            }\n         } else {\n            for (runningApplicationKey in runningApplicationMap) {\n               if (runningApplicationMap.hasOwnProperty(\n                     runningApplicationKey) &&\n                  runningApplicationMap[runningApplicationKey].wmksKey ===\n                  wmksKey) {\n                  hasApps = true;\n                  if (runningApplicationMap[runningApplicationKey].state !==\n                     state) {\n                     isChanged = true;\n                     runningApplicationMap[runningApplicationKey].state =\n                        state;\n                  }\n               }\n            }\n\n            /*\n             * On session connecting, if that session has no associated apps we\n             * create a placeholder instance under the \"Loading\" item.\n             */\n            if (!hasApps && state === AB.CONST.ITEMS_STATE.CONNECTING\n               && !loadingSessionsMap[wmksKey]) {\n               addLoadingPlaceholder(wmksKey);\n               isChanged = true;\n            } else if (state !== AB.CONST.ITEMS_STATE.CONNECTING\n               && loadingSessionsMap[wmksKey]) {\n               removeLoadingPlaceholder(wmksKey);\n               isChanged = true;\n            }\n\n         }\n         if (isChanged) {\n            self.emit(\"valueChanged\");\n         }\n         return isChanged;\n      };\n\n   /**\n    * init\n    *\n    * Listen to all the events of wmksService.\n    */\n   init = function() {\n      // initialize the \"Loading\" item to hold loading session\n      // placeholders\n      loadingSessionsItem = {\n         name: _('LOADING'),\n         iconSrc: AB.CONST.ICONS.LOADING_ICON,\n         type: AB.CONST.ITEMS_TYPE.LOADING_ITEM,\n         focusedItem: null,\n         instances: [],\n         isCollapsed: true,\n         isFocusedItem: function() {\n            return !!loadingSessionsMap[currentFocusWmksKey];\n         }\n      };\n\n      wmksServiceEventHandler.addEventListener('sessionAdded',\n         addDesktopItem);\n      wmksServiceEventHandler.addEventListener('sessionRemoved',\n         onSessionRemoved);\n      wmksServiceEventHandler.addEventListener('sessionConnecting',\n         function(wmksKey, isApplicationSession) {\n            changeRunningItemStatus(wmksKey, isApplicationSession,\n               AB.CONST.ITEMS_STATE.CONNECTING);\n         });\n      wmksServiceEventHandler.addEventListener('sessionConnected',\n         function(wmksKey, isApplicationSession) {\n            changeRunningItemStatus(wmksKey, isApplicationSession,\n               AB.CONST.ITEMS_STATE.CONNECTED);\n         });\n      wmksServiceEventHandler.addEventListener('sessionDisconnected',\n         function(wmksKey, isApplicationSession) {\n            changeRunningItemStatus(wmksKey, isApplicationSession,\n               AB.CONST.ITEMS_STATE.DISCONNECTED);\n         });\n      wmksServiceEventHandler.addEventListener('activeSessionChanged',\n         changeFocusedSession);\n      wmksServiceEventHandler.listenerReadyForModule(\n         wmksServiceEventHandler.MODULE_NAME.RUNNING_ITEMS);\n\n      unityService.addEventListener('windowAdded', addRunningItem);\n      unityService.addEventListener('visibleChanged',\n         function(wmksKey, isShow) {\n            setCanvasVisibility(wmksKey, isShow);\n         });\n      unityService.addEventListener('windowRemoved', removeRunningItem);\n      unityService.addEventListener('titleChanged',\n         function(wmksKey, windowId, windowTitle) {\n            updateRunningItem(wmksKey, windowId,\n               {windowTitle: windowTitle});\n         }\n      );\n      unityService.addEventListener('iconChanged',\n         function(wmksKey, windowId, iconSrc) {\n            updateRunningItem(wmksKey, windowId, {iconSrc: iconSrc});\n         }\n      );\n      unityService.addEventListener('appAttrChanged',\n         function(wmksKey, windowPath, execPath, name, iconSrc) {\n            updateApplicationAttribute(\n               wmksKey, windowPath, execPath,\n               {windowTitle: name, iconSrc: iconSrc}\n            );\n         }\n      );\n      unityService.addEventListener('attrChanged',\n         updateRunningItemAttribute);\n      unityService.addEventListener('typeChanged', updateRunningItemType);\n      unityService.addEventListener('unityReady', onUnityReady);\n      unityService.addEventListener('unityPaused', addAttentionRequired);\n      unityService.addEventListener('unityDestroyed',\n         removeAttentionRequired);\n\n      signal.makeObservable(self);\n      self.addSignal('valueChanged');\n      self.addSignal('noVisibleWindow');\n   };\n\n   /**\n    * runningItemsModel.getRunningItems\n    *\n    * Return a array of running application and desktop.\n    */\n   this.getRunningItems = function() {\n      return runningItems;\n   };\n\n   $rootScope.$on('$destroy', function() {\n      if (unityReadyTimer) {\n         $timeout.cancel(unityReadyTimer);\n         unityReadyTimer = null;\n      }\n      if (checkVisibleWindowTimer) {\n         $timeout.cancel(checkVisibleWindowTimer);\n         checkVisibleWindowTimer = null;\n      }\n   });\n\n   /**\n    * runningItemsModel.reset\n    *\n    * Reset all the internal status.\n    */\n   this.reset = function() {\n      // We want to empty the array but preserve the reference\n      runningItems.length = 0;\n      runningItemsMap = {};\n      runningVisibleItemsMap = {};\n      runningApplicationMap = {};\n      runningDesktopMap = {};\n      if (unityReadyTimer) {\n         $timeout.cancel(unityReadyTimer);\n         unityReadyTimer = null;\n      }\n      if (checkVisibleWindowTimer) {\n         $timeout.cancel(checkVisibleWindowTimer);\n         checkVisibleWindowTimer = null;\n      }\n\n      self.emit('valueChanged');\n   };\n\n   /**\n    * getInternalState - For unit test use only!\n    *\n    * Returns runningItemModel's internal state variables\n    */\n   this.getInternalState = function() {\n      return {\n         runningItems: runningItems,\n         runningItemsMap: runningItemsMap,\n         runningVisibleItemsMap: runningVisibleItemsMap,\n         runningApplicationMap: runningApplicationMap,\n         runningDesktopMap: runningDesktopMap,\n         loadingSessionsMap: loadingSessionsMap\n      };\n   };\n\n   init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/runningitems-model.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * wmks-service-event-handler.js --\n *\n * The the centralized place to manage all the event listener for wmksService.\n * All the services/controllers which are using wmksService event listener\n * should use this service. On the other handle, only when these\n * servers/controllers finish their listener registry, then wmksService can\n * do the rest of init work.\n *\n */\n\nimport signal from './signal';\n\nexport default function wmksServiceEventHandler($q, WMKS, AB) {\n   this.MODULE_NAME = {\n      CLIPBOARD: 'clipboard',\n      PRINT: 'print',\n      RUNNING_ITEMS: 'runningItems',\n      SIDEBAR: 'sidebar',\n      UNITY_SERVICE: 'unityService',\n      FT_CONTROLLER: 'fileTransferController',\n      FT_HELPER: 'fileTransferHelper',\n      PRINT_HELPER: 'printHelper',\n      COMMON_SVC_SERVICE: 'commonSvcService'\n   };\n   this._initStatus = {\n      clipboard: false,\n      print: !!WMKS.BROWSER.isIE(),\n      runningItems: false,\n      sidebar: false,\n      unityService: false,\n      fileTransferController: false,\n      fileTransferHelper: false,\n      printHelper: !!WMKS.BROWSER.isIE(),\n      commonSvcService: false\n   };\n   this.defer = $q.defer();\n\n   signal.makeObservable(this);\n   this.addSignal('sessionAdded');\n   this.addSignal('activeSessionChanged');\n   this.addSignal('sessionConnected');\n   this.addSignal('sessionConnecting');\n   this.addSignal('sessionDisconnected');\n   this.addSignal('sessionRemoved');\n   this.addSignal('idleSessionWarning');\n   this.addSignal('clipboardChanged');\n   this.addSignal('clipboardCapabilitiesChanged');\n   this.addSignal('clipboardRequestFailed');\n   this.addSignal('fileTransferFailed');\n   this.addSignal('update-copy-paste-ui');\n   this.addSignal('downloadFileListChanged');\n   this.addSignal('downloadPrintFileListChanged');\n   this.addSignal('fileTransferConfigChange');\n   this.addSignal('fileTransferError');\n   this.addSignal('printError');\n   this.addSignal('sessionDataReady');\n   this.addSignal('dpiSyncMsg');\n\n   this.listenersReady = function() {\n      return this.defer.promise;\n   };\n\n   this.listenerReadyForModule = function(moduleName) {\n      if (!moduleName) {\n         throw 'No module name is passed in!';\n      }\n\n      if (!this._initStatus.hasOwnProperty(moduleName)) {\n         throw 'Wrong module name is passed in!';\n      }\n\n      this._initStatus[moduleName] = true;\n      AB.LOGGER.debug(\"Listeners of module \" + moduleName +\n         \" is ready for event.\");\n      this._checkInitStatus();\n   };\n\n   this._checkInitStatus = function() {\n      let key;\n      for (key in this._initStatus) {\n         if (this._initStatus.hasOwnProperty(key)) {\n            if (this._initStatus[key] === false) {\n               return;\n            }\n         }\n      }\n      // All listeners are ready! Fire the promise\n      AB.LOGGER.debug(\"All listeners are ready! Going to init wmksService.\");\n      this.defer.resolve();\n   };\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/wmks-service-event-handler.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * wmks-service.js --\n *\n * Module for managing multiple webmks adapter instances. Wmks Service is a\n * singleton service.\n *\n */\n\nimport angular from 'angular';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\nexport default function wmksService(blastWmks,\n                                    safeStorageService,\n                                    entitledItemsModel,\n                                    entitledItemsService,\n                                    messageHandlerService,\n                                    MKSVchan,\n                                    WMKS,\n                                    AB,\n                                    $,\n                                    $timeout,\n                                    $window,\n                                    $rootScope,\n                                    wmksServiceEventHandler,\n                                    multimonService,\n                                    commonSvcService,\n                                    userGlobalPref) {\n   let wmksService = {},\n      handleDownloadListChange,\n      handlePrintDownloadListChange,\n      handleClipboardReceived,\n      sendFileDownloadRequest,\n      handleFileTransferConfigChange,\n      readAndSendFileChunks,\n      stopFileDownload,\n      stopFileUpload,\n      isFileTransferringForAllSession,\n      isFileTransferringInSession = null,\n      isFileTransferringInCurrentSession,\n      isFileDownloadingInSession = null,\n      isFileDownloadingInCurrentSession,\n      isPrintFileTransferringForAllSession,\n      isPrintFileTransferringInSession = null,\n      isPrintFileTransferringInCurrentSession,\n      handleClipboardFailure = null,\n      handleFileTransferFailure = null,\n      handleFileTransferError,\n      handlePrintError,\n\n      // Handle all the notifications from postMessage.\n      readSessionData = null,\n      sessionData,\n      handleSessionData = null,\n      handleUserActivity = null,\n      stopTimer,\n\n      // Track user activity.\n      userActivityTime = $.now(),\n      setIdleTimeoutWarning = null,\n      setUserActivityTime = null,\n\n      // Variables for tracking logoff behavior.\n      closeOnExit = false,\n\n      // Handle logoff request from UI. Ideally, this function should not\n      // be here.\n      pageFlowAfterDisconnect = null,\n\n      // Handle resize and touchstart event.\n      handleResize = null,\n      handleTouchResize = null,\n      handleTouchStart = null,\n\n      // Sync session between memory and local session storage.\n      readRunningSession = null,\n      writeRunningSession = null,\n      sortRunningSession = null,\n      executeRunningSession = null,\n\n      // Handle external command.\n      connectToServer = null,\n      requestDisconnect,\n      sendCtrlAltDel,\n      sendEsc,\n      launchKeyboard,\n\n      sessionIdleTimeout = -1, // broker idle timeout setting in\n                               // milliseconds\n      idleWarningTimeBeforeDisconnect = 300, // five minutes by default\n      idleWarningTimer = null,\n      sessionTimedOut = false,\n\n      isHighResModeSupported,\n      toggleHighResMode,\n      getWmksSession,\n      isHighResModeEnabled = userGlobalPref.getPrefData().enableDPISync ===\n         \"true\",\n      isMP4Supported = AB.UTIL.isMP4Supported,\n      toggleMP4,\n      isMP4Enabled = false,\n      toggleUseMacOSXKeyMappings,\n      areMacOSXKeyMappingsSupported = WMKS.BROWSER.isMacOS,\n      areMacOSXKeyMappingsEnabled = false,\n      toggleWindowsKey,\n      isWindowsKeyEnabled = false,\n      applyInitialHighResSetting = null,\n      applyInitialHighResSettingCallback = null,\n      getCurrentMKSVchanClient = null,\n      clearClipboard,\n      pushClipboard = null,\n      sendClipboardText,\n      onClipboardReady,\n      onClipboardChange,\n      updateClipboardCapabilities = null,\n\n      hasMultimonCapacity,\n      addMonitor,\n      quitMultimon,\n      destroyMultimon,\n      whenNotInMultimon,\n      enterMultimon,\n      disconnectEventConnections,\n      recoveryEventConnections,\n\n      connectToDesktop = null,\n      changeWmksSession = null,\n      activateWmksSession = null,\n      setCanvasVisibility,\n      connectToApplication = null,\n      connectToAllApplications = null,\n      allAppsReconnected = false,\n\n      // Variables for handling multiple webmks session.\n      wmksSessionMap = {},\n      currentWmksSession = null,\n      currentActiveSessionKey = null,\n\n      isCurrentSession = null,\n      isCurrentSessionApp,\n      isCurrentSessionDesktop,\n      isCurrentSessionHasDPIChannelInited,\n      getCurrentSessionDPI,\n\n      // Handle all the delegate requests from wmksSession.\n      sessionOnConnecting,\n      sessionOnConnected,\n      sessionOnDisconnected,\n      sessionOnRemoved,\n\n      // Returns true if one of the active sessions is an app session\n      hasApplicationSession = null,\n      updateEmptySession,\n      prepareForSessionReset,\n      sessionResetDone,\n\n      // Global clipboard object to be shared between sessions\n      globalClipboard = null,\n\n      shadowAllHeartbeatForPrint,\n      recoverAllHeartbeatForPrint,\n\n      shadowAllHeartbeatWhenSafariHidden = null,\n      recoverAllHeartbeatWhenSafariVisible = null,\n\n      getAllmksClient,\n\n      init;\n\n    /*\n     *init\n     *\n     * Init all the events we are listening to from postMessage\n     * and browser native events.\n     */\n   init = function() {\n      AB.LOGGER.debug(\"wmksService is waiting for listeners ready.\");\n      wmksServiceEventHandler.listenersReady().then(function() {\n         AB.LOGGER.debug(\n            \"Listeners ready, wmksService is doing the rest work.\");\n         let shouldPassKeyboard;\n\n         sessionData = readSessionData();\n         wmksServiceEventHandler.emit('sessionDataReady', sessionData);\n         handleSessionData(sessionData);\n\n         // Listen to all the events for tracking user activity.\n         $(document).bind(\n            'mousemove.useractivity mousedown.useractivity mouseup.useractivity',\n            setUserActivityTime);\n         $(document).bind('keydown.useractivity keyup.useractivity',\n            setUserActivityTime);\n         $(document).bind(\n            'touchstart.useractivity touchmove.useractivity touchend.useractivity',\n            setUserActivityTime);\n         $(document)\n            .bind('orientationchange.useractivity', setUserActivityTime);\n         $(document)\n            .bind('extendedmonitoruse.useractivity', setUserActivityTime);\n         $(document)\n            .bind('primarymonitoruse.useractivity', setUserActivityTime);\n\n         globalClipboard = new MKSVchan.Clipboard();\n\n          /*\n           * Create a check on a DOM element to determine whether the element\n           * should pass keyboard events to the canvas rather than consume it.\n           * The behaviour is browser specific.\n           */\n         if (WMKS.BROWSER.isIE() && WMKS.BROWSER.version.major < 12) {\n            shouldPassKeyboard = function(elem) {\n                /*\n                 * In old IE, elements like divs are focusable and we check\n                 * isContentEditable to filter out elements like inputs from the\n                 * list of elements that should pass keyboard events.\n                 *\n                 * Windows Edge will behave like the other browsers\n                 */\n               return (!elem.isContentEditable &&\n               elem.nodeName !== \"CANVAS\");\n            };\n         } else {\n            shouldPassKeyboard = function(elem) {\n                /*\n                 * In non IE browsers, most elements aren't focusable and the\n                 * keyboard event gets targeted directly at the body unless it is\n                 * an input, etc.\n                 */\n               return elem.nodeName === \"BODY\";\n            };\n         }\n\n         if (WMKS.BROWSER.isSafari()) {\n            $window.document.addEventListener(\"visibilitychange\", function() {\n               if ($window.document.hidden) {\n                  // Shadow heartbeat for Safari\n                  shadowAllHeartbeatWhenSafariHidden();\n               } else {\n                  // Recover heartbeat for Safari\n                  recoverAllHeartbeatWhenSafariVisible();\n               }\n            }, false);\n         }\n\n          /*\n           * We currently catch any key events not consumed by an input, canvas,\n           * etc and redirects the input to the canvas. This ensures that we\n           * don't lose any keystrokes while being focused on a non-interactable\n           * part of the sidebar, since there's no UI indication that the sidebar\n           * is focused.\n           */\n         $(window).bind(\"keypress keydown keyup\", function(e) {\n            if (currentWmksSession && shouldPassKeyboard(e.target)) {\n               let canvas = currentWmksSession.wmksContainer.find(\n                  \"canvas\");\n               if (canvas.length > 0) {\n                  e.target = canvas[0];\n                  canvas.trigger(e);\n               }\n            }\n         });\n\n         $rootScope.beforeunload = false;\n         $(window).bind('beforeunload', function() {\n            $rootScope.beforeunload = true;\n         });\n\n         // Listen to onSize to adjust window size.\n         if (WMKS.BROWSER.isTouchDevice()) {\n            $(window).on('orientationchange', handleResize);\n            $(window).on('touchstart', handleTouchStart);\n            //change the main div to position fixed, bug 1583810\n            $(\"#main\").css({position: 'fixed'});\n         }\n         // add resize for touchdevice to solve bug 1916087\n         // screen need to resize if open soft keyboard on touchdevice\n         $(window).on('resize', handleResize);\n\n         // Gets idle timeout data, and inits the idle warning timer.\n         sessionIdleTimeout = entitledItemsModel.getIdleTimeout();\n         AB.LOGGER.log(\"Session idle timeout is \" + sessionIdleTimeout);\n\n         if (sessionIdleTimeout !== -1) {\n            idleWarningTimeBeforeDisconnect\n               = Math.min(idleWarningTimeBeforeDisconnect,\n               Math.floor(sessionIdleTimeout / 5));\n            AB.LOGGER.log(\"Idle warning time set to \" +\n               idleWarningTimeBeforeDisconnect);\n            setIdleTimeoutWarning();\n         }\n      });\n\n   };\n\n   /**\n    * iPhone not supported\n    */\n   isHighResModeSupported = function() {\n      return WMKS.UTIL.isHighResolutionSupported() && !AB.UTIL.isIPhone();\n   };\n\n   /**\n    * handleDownloadListChange\n    *\n    * handles download file list change notifications from the remote\n    * server\n    *\n    * @params downloadList: formatted file list reference\n    */\n   handleDownloadListChange = function(downloadList, client, error) {\n      wmksServiceEventHandler.emit(\"downloadFileListChanged\",\n         downloadList, client,\n         error);\n   };\n\n   /**\n    * handlePrintDownloadListChange\n    *\n    * handles print download file list change notifications from the\n    * remote server\n    *\n    * @params downloadList: formatted file list reference\n    */\n   handlePrintDownloadListChange = function(downloadList, client, error) {\n      wmksServiceEventHandler.emit(\"downloadPrintFileListChanged\",\n         downloadList,\n         client, error);\n   };\n\n   /**\n    * handleClipboardReceived\n    *\n    * handles clipboard change notifications from the remote server\n    *\n    * @params clipboard: A mksVchan clipboard object\n    */\n   handleClipboardReceived = function(clipboard, error) {\n      globalClipboard = clipboard;\n\n      let text = globalClipboard.getText(MKSVchan.CP_FORMAT.TEXT);\n\n      if (text != null) {\n         wmksServiceEventHandler.emit(\"clipboardChanged\", text, error);\n      }\n   };\n\n   /**\n    * handleClipboardFailed\n    *\n    * handles failures to send clipboard RPCs to the remote server\n    */\n   handleClipboardFailure = function() {\n      AB.LOGGER.error(\"Failed to send clipboard RPC\");\n      wmksServiceEventHandler.emit(\"clipboardRequestFailed\");\n   };\n\n\n   /**\n    * handleClipboardFailed\n    *\n    * handles failures to send clipboard RPCs to the remote server\n    */\n   handleFileTransferFailure = function() {\n      AB.LOGGER.error(\"Failed to send file transfer RPC\");\n      wmksServiceEventHandler.emit(\"fileTransferFailed\");\n   };\n\n   /**\n    * handleFileTransferError\n    *\n    * handles error sent from server for file transfer\n    */\n   handleFileTransferError = function(error) {\n      wmksServiceEventHandler.emit(\"fileTransferError\", error);\n   };\n\n   /**\n    * handlePrintError\n    *\n    * handles error sent from server for print\n    */\n   handlePrintError = function(error) {\n      wmksServiceEventHandler.emit(\"printError\", error);\n   };\n\n   /**\n    * handleFileTransferConfigChange\n    *\n    * handles config received from MKSvchan server\n    */\n   handleFileTransferConfigChange = function(error) {\n      wmksServiceEventHandler.emit(\"fileTransferConfigChange\", error);\n   };\n\n   /**\n    * readRunningSession\n    *\n    * Read runningSession item from localStorage. If we never set this\n    * item, for desktop, we will use the session data passed from portal\n    * page, for application, we will call reconnectApplicationSessions to\n    * get all the application sessions for this user. If we have set this\n    * item, we will trust the data in localStorage and run the session\n    * one by one.\n    *\n    * @params focusedSession session info passed from portal page.\n    */\n   readRunningSession = function(focusedSession) {\n      // Schedule all of this work for after entitledItemsService.init()\n      // is done\n      entitledItemsService.addInitDoneCallback(function() {\n         if (sessionData['idleTimeout'] !== \"-1\") {\n            entitledItemsService.startIdleTimer(\n               sessionData['brokerSupportIdleTimeout'],\n               sessionData['idleTimeout'],\n               sessionData['userActivityXMLSendingInterval'],\n               sessionData['brokerUrl'],\n               sessionData['brokerUrlWithTimestamp'],\n               handleUserActivity);\n         }\n         safeStorageService.getItem(\"RunningSession\",\n            function(data) {\n               let runningSessions, i;\n               if (data === null) {\n                  // We launch an item from portal page.\n                  executeRunningSession(focusedSession);\n               } else {\n                  // User refreshes browser\n                  runningSessions = angular.fromJson(data);\n                  for (i = 0; i < runningSessions.length; i++) {\n                     if (runningSessions[i].isApplicationSession) {\n                        allAppsReconnected = true;\n                        break;\n                     }\n                  }\n                  executeRunningSession(angular.fromJson(data), true);\n               }\n            },\n            null);\n      });\n   };\n\n   /**\n    * writeRunningSession\n    *\n    * Sync all session data to localStorage.\n    *\n    */\n   writeRunningSession = function() {\n      let tempArray = [],\n         wmksKey = null,\n         wmksSession = null;\n\n      for (wmksKey in wmksSessionMap) {\n          /* istanbul ignore else */\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            wmksSession = wmksSessionMap[wmksKey];\n            tempArray.push({\n               key: wmksSession.key,\n               url: wmksSession.url,\n               isActive: wmksSession.isActive,\n               isApplicationSession: wmksSession.isApplicationSession,\n               isShadow: wmksSession.isShadow,\n               name: wmksSession.name\n            });\n         }\n      }\n      safeStorageService.setItem(\"RunningSession\",\n         angular.toJson(tempArray));\n   };\n\n   /**\n    * sortRunningSession\n    *\n    * Sort an array of running sessions such that the last element in the\n    * array is the active session.\n    */\n   sortRunningSession = function(runningSession) {\n      let i;\n      if (runningSession.length < 2) {\n         return;\n      }\n\n      // Move the active session to the end of the list\n      for (i = 0; i < runningSession.length; i++) {\n         // Assume there is only one active item in the array.\n         if (runningSession[i].isActive) {\n            runningSession.push(runningSession.splice(i, 1)[0]);\n            break;\n         }\n      }\n   };\n\n   /**\n    * executeRunningSession\n    *\n    * Connect to running session one by one.\n    * Active status might not be right when resuming the session. Will fix\n    * it in next changelist.\n    *\n    * @params runningSession: a list of running session\n    * @params sort: whether or not to sort the list of running sessions so\n    *    that the active session is the last session\n    * @param onDone: callback to invoke when the last session is resumed\n    */\n   executeRunningSession = function(runningSession, sort, onDone) {\n      let currentSession = null,\n         session = null,\n         i = 0;\n      if (!angular.isArray(runningSession)) {\n         runningSession = [runningSession];\n      }\n\n      if (sort) {\n         sortRunningSession(runningSession);\n      }\n\n      // If there is a session left in the array try to resume it\n      if (runningSession.length > 0) {\n         currentSession = runningSession.shift();\n\n         AB.LOGGER.debug(\"Starting to load\" +\n            (currentSession.isActive ? \" active\" : \" inactive\") +\n            \" key \" + currentSession.key +\n            (!currentSession.isShadow ? \" primary\" : \" shadow\") +\n            (currentSession.isApplicationSession ? \" application\" :\n               \" desktop\") +\n            \" session with url \" + currentSession.url);\n\n         // Try to resume the current session. If this is the last\n         // session\n         // in the array then schedule onDone as the callback for when\n         // that session resumes (or fails to resume). If there are more\n         // than one remaining sessions then schedule the handling of\n         // these sessions as a callback. This is necessary becasuse\n         // connectToApplication/connectToADesktop make an async call so\n         // the callback is needed to force the calls to follow a\n         // sequence.\n         if (currentSession.isApplicationSession) {\n            connectToApplication(undefined, currentSession.key,\n               currentSession.url,\n               runningSession.length === 0 ?\n                  onDone :\n                  function() {\n                     executeRunningSession(runningSession, false, onDone);\n                  });\n         } else {\n            connectToDesktop(currentSession.key, currentSession.name,\n               currentSession.url,\n               currentSession.isShadow,\n               runningSession.length === 0 ?\n                  onDone :\n                  function() {\n                     executeRunningSession(runningSession, false, onDone);\n                  });\n         }\n      }\n   };\n\n   /**\n    * Read data from session storage. This function is implemented by\n    * kwikclient previously. Now we need to do it ourselves.\n    */\n   readSessionData = function() {\n      let sessionParams = {\n         desktopName: null,\n         desktopId: null,\n         user: null,\n         domainName: null,\n         closeOnExit: null,\n         referer: null,\n         rebrand: null,\n         idleTimeout: null,\n         userActivityXMLSendingInterval: null,\n         brokerSupportIdleTimeout: null,\n         brokerUrl: null,\n         brokerUrlWithTimestamp: null,\n         blastURL: null,\n         isApplicationSession: true,\n         isShadow: false,\n         horizonId: null,\n         logLevel: null\n      };\n\n      // Load optional params. One of these can tell us about logout.\n      let key,\n         value;\n      for (key in sessionParams) {\n         value = window.sessionStorage.getItem(key);\n         AB.LOGGER.log(\"Read session data \" + key + \" : \" + value);\n         if (!!value && value !== 'null' && value !== 'undefined') {\n            sessionParams[key] = value;\n         }\n      }\n\n      return sessionParams;\n   };\n\n   /**\n    * handleSessionData\n    *\n    * pmManager callback for the handleSessionData.\n    * We will start the bootstrap session.\n    */\n   handleSessionData = function(args) {\n      // Append relevant text from parent window.\n      let desktopInfo = args.desktopName || '',\n         userInfo = args.userName || '',\n         blastURL = args.blastURL,\n         horizonId = args.horizonId || '',\n         webSocketUrl,\n         isApplicationSession = (args.isApplicationSession &&\n            args.isApplicationSession === \"true\"),\n         isShadow =  (args.isShadow && args.isShadow === \"true\");\n\n      // Set the flag to true only if the flag exists and has a true\n      // string value.\n      closeOnExit = (args.closeOnExit && args.closeOnExit === \"true\");\n\n      // Init the messageHandlerService with current user info, currently,\n      // only use the horizonId\n      messageHandlerService.init({\n         horizonId: horizonId,\n         userName: userInfo,\n         domainName: args.domainName || '',\n         brokerAddress: location.host\n      });\n\n      if (!blastURL) {\n         return;\n      }\n\n      if (!!args.logLevel) {\n         AB.LOGGER.setLevel(Number(args.logLevel));\n         JSCDKLogger.setLogLevel(Number(args.logLevel));\n      }\n\n      if (!isApplicationSession) {\n         safeStorageService.getItem(\"OriginDesktop\",\n            function(data) {\n               if (!data || !data.id || !data.name) {\n                  AB.LOGGER.log(\n                     \"There is no desktop information during bootstrap process.\");\n                  return;\n               }\n               readRunningSession({\n                  key: data.id,\n                  name: data.name,\n                  url: blastURL,\n                  isActive: true,\n                  isApplicationSession: false,\n                  isShadow: isShadow\n               });\n            },\n            null);\n      } else {\n         // Connect to apps.\n         safeStorageService.getItem(\"OriginAppID\",\n            function(originId) {\n               if (!originId) {\n                  AB.LOGGER.log(\n                     \"There is no application id information during bootstrap process.\");\n                  return;\n               }\n               readRunningSession({\n                  key: originId,\n                  url: blastURL,\n                  isActive: true,\n                  isApplicationSession: true\n               });\n            },\n            null);\n      }\n   };\n\n   /**\n    * connectToAllApplications\n    *\n    * Connect to all the running app session.\n    *\n    * @params focusedSessionKey focused session key.\n    */\n   connectToAllApplications = function(focusedSessionKey) {\n      AB.LOGGER.log(\n         \"Start to reload all the applications which is triggered by \" +\n         focusedSessionKey);\n      entitledItemsService.reconnectApplicationSessions(\n         function(response) {\n            let sessionList = [],\n               i = 0;\n            AB.LOGGER.log(response);\n            if (response.success\n               && response.successSessionInfo\n               && response.successSessionInfo.length > 0) {\n               for (i = 0; i < response.successSessionInfo.length; i++) {\n                  // Do not try to reconnect to a session with the same\n                  // origin ID as the already running focused session\n                  if (response.successSessionInfo[i].originId ===\n                     focusedSessionKey) {\n                     AB.LOGGER.error(\n                        \"should not reload a loaded session\");\n                     continue;\n                  }\n                  sessionList.push({\n                     key: response.successSessionInfo[i].originId,\n                     url: response.successSessionInfo[i].blastUrl,\n                     isActive: response.successSessionInfo[i].originId ===\n                     focusedSessionKey,\n                     isApplicationSession: true\n                  });\n               }\n               // Launch the other sessions and schedule changing the\n               // the focus to focusedSession as a callback\n               executeRunningSession(sessionList, true, function() {\n                  changeWmksSession(focusedSessionKey, false);\n               });\n            } else {\n               // No sessions to reconnect just bring the focused session\n               // to the front\n               changeWmksSession(focusedSessionKey, false);\n            }\n         },\n         null,\n         [],\n         focusedSessionKey\n      );\n   };\n\n   /**\n    * connectToApplication\n    *\n    * Connect to a specified application. If it is the bootstrap time,\n    * we will connect the specified url. If it is launched by sidebar,\n    * we try to reuse the session from the same farm and launch an app\n    * from it. Otherwise, launch a new app session.\n    *\n    * @params applicationId unique applicationId.\n    * @params originId the original farm identifier .\n    * @params targetUrl target url for connecting.\n    * @params onDone the callback when completing the request.\n    */\n   connectToApplication =\n      function(applicationId, originId, targetUrl, onDone, timeoutHandler) {\n         let callback = function(response) {\n            // start timer\n            if (!!timeoutHandler) {\n               timeoutHandler();\n            }\n            entitledItemsService.getUserGlobalPref()\n               .then(function(prefData) {\n                  let canReuseSession;\n                  isHighResModeEnabled =\n                     prefData.enableDPISync === \"true\";\n                  areMacOSXKeyMappingsEnabled =\n                     areMacOSXKeyMappingsSupported()\n                     && prefData.useMacOSXKeyMappings !== 'false';\n                  isWindowsKeyEnabled = prefData.enableWindowsKey === \"true\";\n                  isMP4Enabled = prefData.enableMP4 === \"true\";\n\n                  if (targetUrl) {\n                     // Bootstrap process for application.\n                     connectToServer(targetUrl,\n                        true,\n                        false, // We don't support shadow session for applications.\n                        originId);\n                     changeWmksSession(originId, true);\n                     if (!allAppsReconnected) {\n                        allAppsReconnected = true;\n                        connectToAllApplications(originId);\n                     }\n                      /* istanbul ignore else */\n                     if (onDone) {\n                        onDone(true);\n                     }\n                  } else {\n                     canReuseSession =\n                        wmksSessionMap[originId] ? true : false;\n                     entitledItemsService.launch(applicationId,\n                        entitledItemsService.itemTypeEnum.application,\n                        canReuseSession ? originId : null,\n                        function(response) {\n                           AB.LOGGER.log(response);\n                           if (response.success) {\n                              if (!canReuseSession) {\n                                 connectToServer(response.blastURL,\n                                    true,\n                                    false, // We don't support shadow session for applications.\n                                    originId);\n                              }\n                              changeWmksSession(originId, !canReuseSession);\n                              if (!allAppsReconnected) {\n                                 allAppsReconnected = true;\n                                 $timeout(function() {\n                                    connectToAllApplications(originId);\n                                 }, 0, false);\n                              }\n                           }\n                            /* istanbul ignore else */\n                           if (onDone) {\n                              onDone(response);\n                           }\n                        }\n                     );\n                  }\n               });\n         };\n         entitledItemsService.authenticationStatusCheck(callback, onDone);\n      };\n\n   /**\n    * connectToDesktop\n    *\n    * Connect to a specified desktop. If it is the bootstrap time,\n    * we will connect the specified url. If it is launched by sidebar,\n    * we will get a new session. Otherwise, we will display the hidden\n    * desktop.\n    *\n    * @params desktopId unique desktopId.\n    * @params desktopName desktop name .\n    * @params targetUrl target url for connecting.\n    * @params isShadow a shadow desktop\n    * @params onDone the callback when completing the request.\n    */\n   connectToDesktop =\n      function(desktopId, desktopName, targetUrl, isShadow, onDone) {\n         entitledItemsService.getUserGlobalPref()\n            .then(function(prefData) {\n               let addSession = function() {\n                  $timeout(function() {\n                     wmksServiceEventHandler.emit('sessionAdded',\n                        desktopId, false,\n                        isShadow,\n                        desktopName);\n                  }, 0, false);\n               };\n\n               isHighResModeEnabled =\n                  prefData.enableDPISync === \"true\";\n               areMacOSXKeyMappingsEnabled =\n                  areMacOSXKeyMappingsSupported()\n                  && prefData.useMacOSXKeyMappings !== 'false';\n               isWindowsKeyEnabled = prefData.enableWindowsKey === \"true\";\n               isMP4Enabled = prefData.enableMP4 === \"true\";\n\n               if (!wmksSessionMap[desktopId]) {\n                  if (!targetUrl) {\n                     // From sidebar.\n                     entitledItemsService.launch(\n                        desktopId,\n                        entitledItemsService.itemTypeEnum.desktop,\n                        null,\n                        function(response) {\n                           AB.LOGGER.log(response);\n                           if (response.success && response.blastURL) {\n                              addSession();\n                              connectToServer(response.blastURL,\n                                 false,\n                                 isShadow,\n                                 desktopId,\n                                 desktopName);\n                              changeWmksSession(desktopId, true);\n                           }\n\n                            /* istanbul ignore else */\n                           if (onDone) {\n                              onDone(response);\n                           }\n                        }\n                     );\n                  } else {\n                     // For bootstrap process.\n                     addSession();\n                     connectToServer(targetUrl,\n                        false,\n                        isShadow,\n                        desktopId,\n                        desktopName);\n                     changeWmksSession(desktopId, true);\n\n                      /* istanbul ignore else */\n                     if (onDone) {\n                        onDone(true);\n                     }\n                  }\n               } else {\n                  // Show the hidden canvas of this desktop when clicking\n                  // on entitle item section.\n                  changeWmksSession(desktopId);\n                   /* istanbul ignore else */\n                  if (onDone) {\n                     onDone(true);\n                  }\n               }\n            });\n      };\n\n   /**\n    * activateWmksSession\n    *\n    * Activate specified wmksSession .\n    *\n    * @params activeSessionKey unique identifier for this wmks session.\n    *\n    * Return true if active session is changed.\n    */\n   activateWmksSession = function(activeSessionKey) {\n      currentActiveSessionKey = activeSessionKey;\n      let wmksKey;\n\n      if (!wmksSessionMap[activeSessionKey]) {\n         AB.LOGGER.warn(\n            'Tried to activate unknown session: ' + activeSessionKey);\n         return false;\n      }\n\n      if (!currentWmksSession) {\n         wmksSessionMap[activeSessionKey].setVisibility(true);\n         currentWmksSession = wmksSessionMap[activeSessionKey];\n         updateClipboardCapabilities();\n         return true;\n      } else if (currentWmksSession.key === activeSessionKey) {\n         return false;\n      } else {\n         for (wmksKey in wmksSessionMap) {\n             /* istanbul ignore else */\n            if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n               wmksSessionMap[wmksKey].setVisibility(\n                  activeSessionKey === wmksKey);\n            }\n         }\n         currentWmksSession = wmksSessionMap[activeSessionKey];\n         updateClipboardCapabilities();\n         return true;\n      }\n   };\n\n   /**\n    * setCanvasVisibility\n    *\n    * Display specified wmksSession .\n    *\n    * @params wmksKey unique identifier for this wmks session.\n    *\n    */\n   setCanvasVisibility = function(wmksKey, isShow) {\n      if (!wmksSessionMap[wmksKey]) {\n         AB.LOGGER.warn(\n            'Tried to set unknown session: ' + wmksKey);\n         return;\n      }\n\n      wmksSessionMap[wmksKey].toggleVisibility(isShow && (currentActiveSessionKey === wmksKey));\n   };\n\n   /**\n    * changeWmksSession\n    *\n    * Activate specified session and notify UI.\n    *\n    * @params wmksKey unique desktopId.\n    * @params isNewSession: indicates that the wmks session is newly\n    *    created\n    */\n   changeWmksSession = function(wmksKey, isNewSession) {\n      if (activateWmksSession(wmksKey)) {\n         writeRunningSession();\n         $timeout(function() {\n            if (!isNewSession) {\n               pushClipboard();\n            }\n            wmksServiceEventHandler.emit('activeSessionChanged', wmksKey);\n         }, 0, false);\n      }\n   };\n\n   /**\n    * handleUserActivity\n    *\n    * Callback for the handleRequestUserActivity.\n    */\n   handleUserActivity = function() {\n      let sessionIdleTimeoutMS = sessionIdleTimeout * 1000;\n      setIdleTimeoutWarning();\n\n      if (sessionIdleTimeout === -1) {\n         sessionTimedOut = false;\n         return;\n      } else {\n         sessionTimedOut =\n            (($.now() - userActivityTime) >= sessionIdleTimeoutMS);\n      }\n\n      return userActivityTime;\n   };\n\n   stopTimer = function() {\n      entitledItemsService.stopIdleTimer();\n   };\n\n   /**\n    * setIdleTimeoutWarning\n    *\n    * When called, calculates the time until we need to show a idle\n    * session warning, then sets a timer to issue the warning if\n    * necessary. If the timer is already set, then its duration is\n    * updated. The warning is only issued if we are connected to an\n    * application session.\n    *\n    */\n   setIdleTimeoutWarning = function() {\n      let timeElapsedMS, warningTimeMS;\n\n      // Cancel old timer\n      $timeout.cancel(idleWarningTimer);\n      idleWarningTimer = null;\n\n      // proceed if idle timeout is set and longer than the warning time\n      if (sessionIdleTimeout !== -1 &&\n         sessionIdleTimeout > idleWarningTimeBeforeDisconnect) {\n         // Calculate time to warning in milliseconds\n         warningTimeMS =\n            1000 * (sessionIdleTimeout - idleWarningTimeBeforeDisconnect);\n         timeElapsedMS = $.now() - userActivityTime;\n         AB.LOGGER.info(\n            \"Time since last activity (ms): \" + timeElapsedMS);\n\n         // if warning time is in the future, set a timer for it\n         if (timeElapsedMS < warningTimeMS) {\n            idleWarningTimer = $timeout(function() {\n               if (hasApplicationSession()) {\n                  wmksServiceEventHandler.emit('idleSessionWarning');\n               }\n            }, warningTimeMS - timeElapsedMS);\n         }\n      }\n   };\n\n   /**\n    * setUserActivityTime\n    *\n    * Record the activity time when user is using the web client.\n    */\n   setUserActivityTime = function() {\n      userActivityTime = $.now();\n   };\n\n   /**\n    * handleResize\n    *\n    * We need to resize the remote desktop for onSize.\n    * Todo: We need to resize the desktop for all the sessions?\n    */\n   handleResize = function(e) {\n      if (WMKS.BROWSER.isAndroid()) {\n         handleTouchResize();\n      } else {\n         let screenSize = AB.UTIL.getDesiredResolution(),\n            wmksKey,\n            wmksInstance;\n\n         // Send a rescale request to resize based on the parent container\n         // size.\n         for (wmksKey in wmksSessionMap) {\n             /* istanbul ignore else */\n            if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n               wmksInstance = wmksSessionMap[wmksKey];\n               if (wmksInstance !== multimonService.getMultimonSession()) {\n                  wmksInstance.updateResolution(screenSize, true);\n               } else {\n                  JSCDKLogger.debug(\"skip resize for session wmksKey: \" + wmksKey);\n               }\n            }\n         }\n      }\n\n   };\n\n\n   /**\n    * handleTouchResize\n    *\n    * We need to resize the remote desktop for onSize.\n    * Todo: We need to resize the desktop for all the sessions?\n    */\n   handleTouchResize = function(e) {\n      let callback = function(screenSize) {\n         let wmksKey;\n\n         // Send a rescale request to resize based on the parent container\n         // size.\n         for (wmksKey in wmksSessionMap) {\n             /* istanbul ignore else */\n            if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n               if (wmksSessionMap[wmksKey] !==\n                  multimonService.getMultimonSession()) {\n                  wmksSessionMap[wmksKey].updateResolution(screenSize, true);\n               } else {\n                  JSCDKLogger.debug(\"skip resize for session wmksKey\");\n               }\n            }\n         }\n      };\n      AB.UTIL.getTouchDeviceDesiredResolution(callback);\n   };\n\n   /**\n    * hasMultimonCapacity\n    *\n    * Return whether the current session supporting multimon\n    */\n   hasMultimonCapacity = function() {\n      if (!currentWmksSession) {\n         return false;\n      }\n\n      return currentWmksSession.multimonServerEnabled;\n   };\n\n   /**\n    * addMonitor\n    */\n   addMonitor = function(uiCallback, closeSidebar) {\n      if (!!currentWmksSession &&\n         currentWmksSession.hasOwnProperty(\"wmksContainer\") &&\n         currentWmksSession.wmksContainer.length >= 1) {\n         AB.LOGGER.log(\"add a monitor for session \" + currentWmksSession.key);\n         let options = {\n            enableH264: isMP4Supported() && isMP4Enabled\n         };\n         multimonService.addMonitor(currentWmksSession,\n            currentWmksSession.wmksContainer[0], uiCallback, closeSidebar,\n            handleResize, options);\n      }\n   };\n\n   /**\n    * quitMultimon\n    */\n   quitMultimon = function() {\n      if (!!currentWmksSession) {\n         AB.LOGGER.log(\"add a monitor for session \" + currentWmksSession.key);\n         multimonService.switchToSingleMon(currentWmksSession);\n      }\n   };\n\n   /**\n    * destroyMultimon\n    */\n   destroyMultimon = function() {\n      multimonService.destroyMultimon();\n   };\n\n   /**\n    * Will processing only when the current session is not in the multimon\n    *     mode\n    * @param  {function} processingFunction The processing function\n    */\n   whenNotInMultimon = function(processingFunction) {\n      if (!!currentWmksSession) {\n         multimonService.whenNotInMultimon(processingFunction);\n      } else {\n         processingFunction();\n      }\n   };\n\n   /**\n    * enterMultimon\n    */\n   enterMultimon = function() {\n      if (!!currentWmksSession) {\n         AB.LOGGER.log(\"enter multimon for session \" + currentWmksSession.key);\n         multimonService.enterMultimonMode();\n      }\n   };\n\n   /**\n    * recoveryEventConnections\n    */\n   recoveryEventConnections = function () {\n      for (let wmksKey in wmksSessionMap) {\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            try {\n               wmksSessionMap[wmksKey].wmks(\"connectEvents\");\n            } catch (e) {\n               JSCDKLogger.debug(\n                  \"fail to reconnect wmks events, please check the network\");\n            }\n         }\n      }\n   };\n\n   /**\n    * disconnectEventConnections\n    */\n   disconnectEventConnections = function () {\n      for (let wmksKey in wmksSessionMap) {\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            wmksSessionMap[wmksKey].wmks(\"disconnectEvents\");\n         }\n      }\n      /**\n       * Adding some extra lines since wmks is not symatrix so we can't remove\n       * all the events by calling disconnectEvents, which seems can't be done\n       * easily.\n       */\n      $(window).unbind('mousedown.wmks');\n      $(window).unbind('mousewheel.wmks');\n      $(window).unbind('mousemove.wmks');\n      $(window).unbind('mouseup.wmks');\n   };\n\n   /**\n    * handleTouchStart\n    *\n    * We need to initialize the audio context for onTouchStart.\n    * Todo: We need to initialize audio service for all the sessions?\n    */\n   handleTouchStart = function(e) {\n      if (currentWmksSession) {\n         currentWmksSession.audioService.initializeAudioForTouch();\n      }\n   };\n\n   /**\n    * pageFlowAfterDisconnect\n    *\n    * Page flow behavior after user logoff.\n    *\n    */\n   pageFlowAfterDisconnect = function() {\n      if (closeOnExit) {\n         // Horizon workspace will launch us into a separate tab, so we\n         // want to close on exit in this case.\n\n         // NOTE: This won't work in any modern browser when the window\n         // is not opened via script / ahref.\n         $window.open('', '_self', '');\n         $window.close();\n      } else {\n         AB.UTIL.returnToLauncher();\n      }\n   };\n\n   /**\n    * connectToServer\n    *\n    * Connect to server with server agent url.\n    *\n    * @params targetUrl the server url which is connecting to.\n    * @params key unique identifier for this wmks session.\n    * @params isApplicationSession if this is a desktop or an application\n    *    session.\n    * @params isShadow if there is a shadow session.\n    * @params key unique identifer for a session.\n    * @params name session name.\n    */\n   connectToServer = function(targetUrl,\n                              isApplicationSession,\n                              isShadow,\n                              key,\n                              name) {\n      let wmksSession = blastWmks.getWmksSessionInstance(wmksService,\n         key,\n         isApplicationSession,\n         isShadow,\n         name),\n         webSocketUrl = targetUrl.replace('http', 'ws');\n      wmksSession.initialize(webSocketUrl, {\n         enableHighResMode: isHighResModeEnabled,\n         useMacOSXKeySettings: areMacOSXKeyMappingsSupported() &&\n         areMacOSXKeyMappingsEnabled,\n         enableWindowsKey: isWindowsKeyEnabled,\n         enableMP4: isMP4Supported() && isMP4Enabled\n      });\n      wmksSessionMap[key] = wmksSession;\n   };\n\n   /**\n    * requestDisconnect\n    *\n    * Attempt a graceful disconnect from the server. If the server is\n    * already disconnected, triggers a page reflow.\n    */\n   requestDisconnect = function(id) {\n      let wmksKey;\n      if (id && wmksSessionMap[id]) {\n         wmksSessionMap[id].requestDisconnect();\n      } else {\n         for (wmksKey in wmksSessionMap) {\n             /* istanbul ignore else */\n            if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n               wmksSessionMap[wmksKey].requestDisconnect();\n            }\n         }\n\n         // Trigger page navigation after we logout from broker.\n         entitledItemsService.logout(pageFlowAfterDisconnect);\n      }\n   };\n\n   /**\n    * sendCtrlAltDel\n    *\n    * Send Ctrl-Alt-Del to the guest.\n    */\n   sendCtrlAltDel = function() {\n      if (currentWmksSession) {\n         currentWmksSession.wmks('sendKeyCodes', [17, 18, 46]);\n      }\n   };\n\n   /**\n    * sendEsc\n    *\n    * Send Esc to the guest.\n    */\n   sendEsc = function() {\n      if (currentWmksSession) {\n         currentWmksSession.wmks('sendKeyCodes', [27]);\n      }\n   };\n\n   /**\n    * toggleKeyBoard\n    *\n    */\n   launchKeyboard = function() {\n      if (currentWmksSession) {\n         currentWmksSession.wmks('toggleKeyboard');\n      }\n   };\n\n   /**\n    * Get the wmks session according to the key\n    * @param key the key passed in\n    * @returns {*} the session if the session exists, otherwise null\n    */\n   getWmksSession = function(key) {\n      if (wmksSessionMap.hasOwnProperty(key)) {\n         return wmksSessionMap[key];\n      } else {\n         return null;\n      }\n   };\n\n   /**\n    * toggleHighResMode\n    *\n    * Function to toggle high resolution mode to a new value on all\n    * wmksSessions.\n    *\n    * @return the new value for high resolution mode\n    */\n   toggleHighResMode = function() {\n      if (isHighResModeSupported()) {\n         isHighResModeEnabled = !isHighResModeEnabled;\n         let wmksKey;\n         for (wmksKey in wmksSessionMap) {\n             /* istanbul ignore else */\n            if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n               wmksSessionMap[wmksKey].wmks('option',\n                  'useNativePixels',\n                  isHighResModeEnabled);\n            }\n         }\n      }\n      return isHighResModeEnabled;\n   };\n\n   /**\n    * toggleMP4\n    *\n    * Function to toggle MP4 Enablement to a new value on all\n    * wmksSessions.\n    *\n    * @return the new value for MP4 Enablement\n    */\n   toggleMP4 = function() {\n      if (isMP4Supported()) {\n         isMP4Enabled = !isMP4Enabled;\n      }\n      return isMP4Enabled;\n   };\n\n   /**\n    * toggleUseMacOSXKeyMappings\n    *\n    * Function to toggle key mappings for this session.\n    *\n    * @return the new value for high resolution mode\n    */\n   toggleUseMacOSXKeyMappings = function() {\n      if (areMacOSXKeyMappingsSupported()) {\n         areMacOSXKeyMappingsEnabled = !areMacOSXKeyMappingsEnabled;\n         let wmksKey;\n         for (wmksKey in wmksSessionMap) {\n             /* istanbul ignore else */\n            if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n               wmksSessionMap[wmksKey].wmks(\n                  'option',\n                  'mapMetaToCtrlForKeys',\n                  areMacOSXKeyMappingsEnabled\n                     ? AB.CONST.BlastWMKS.MAP_META_TO_CTRL_FOR_KEYS : []);\n            }\n         }\n      }\n      return areMacOSXKeyMappingsEnabled;\n   };\n\n   /**\n    * toggleWindowsKey\n    *\n    * Function to toggle Windows key simulation functionality.\n    *\n    * @return true or false\n    */\n   toggleWindowsKey = function() {\n      let wmksKey;\n\n      isWindowsKeyEnabled = !isWindowsKeyEnabled;\n      for (wmksKey in wmksSessionMap) {\n          /* istanbul ignore else */\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            // Enable/disable Windows key in the desktop session.\n            wmksSessionMap[wmksKey].enableWindowsKey(isWindowsKeyEnabled);\n         }\n      }\n\n      return isWindowsKeyEnabled;\n   };\n\n   /**\n    * getCurrentMKSVchanClient\n    *\n    * Utility function that returns the MKSVchan client of the current\n    * wmks session, if available. If the current session or its mksVchan\n    * client does not exist, this function returns null.\n    */\n   getCurrentMKSVchanClient = function() {\n      if (!!currentWmksSession && !!currentWmksSession.mksVchanClient) {\n         return currentWmksSession.mksVchanClient;\n      }\n      return null;\n   };\n\n   /**\n    * isFileTransferringForAllSession\n    *\n    * Whether user has transferring file in all sessions.\n    */\n   isFileTransferringForAllSession = function() {\n      let wmksKey,\n         mksVchanClient,\n         uploadService,\n         downloadService;\n      for (wmksKey in wmksSessionMap) {\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            mksVchanClient = wmksSessionMap[wmksKey].mksVchanClient;\n            if (!!mksVchanClient) {\n               uploadService = mksVchanClient.uploadService;\n               if (!!mksVchanClient.downloadServices) {\n                  downloadService =\n                     mksVchanClient.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.FT];\n               }\n            }\n            if ((!!uploadService &&\n               uploadService.isTransferringFileWithNoDialog()) ||\n               (!!downloadService &&\n               downloadService.isTransferringFileWithNoDialog())) {\n               return true;\n            }\n         }\n      }\n      return false;\n   };\n\n   /**\n    * isFileTransferringInSession\n    *\n    * Whether user has transferring file in specific sessions.\n    */\n   isFileTransferringInSession = function(wmksKey) {\n      if (!wmksKey || !wmksSessionMap.hasOwnProperty(wmksKey)) {\n         return false;\n      }\n\n      let mksVchanClient = wmksSessionMap[wmksKey].mksVchanClient,\n         uploadService,\n         downloadService;\n\n      if (!!mksVchanClient) {\n         uploadService = mksVchanClient.uploadService;\n         if (!!mksVchanClient.downloadServices) {\n            downloadService =\n               mksVchanClient.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.FT];\n         }\n      }\n      return (!!uploadService &&\n         uploadService.isTransferringFileWithNoDialog()) ||\n         (!!downloadService &&\n         downloadService.isTransferringFileWithNoDialog());\n   };\n\n   isFileTransferringInCurrentSession = function() {\n      if (!currentWmksSession || !currentWmksSession.key) {\n         return false;\n      }\n      return isFileTransferringInSession(currentWmksSession.key);\n   };\n\n   isFileDownloadingInSession = function(wmksKey) {\n      if (!wmksKey || !wmksSessionMap.hasOwnProperty(wmksKey)) {\n         return false;\n      }\n\n      let mksVchanClient = wmksSessionMap[wmksKey].mksVchanClient,\n         downloadService;\n\n      if (!!mksVchanClient && !!mksVchanClient.downloadServices) {\n         downloadService =\n            mksVchanClient.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.FT];\n      }\n      return !!downloadService &&\n         downloadService.isTransferringFileWithNoDialog();\n   };\n\n   isFileDownloadingInCurrentSession = function() {\n      if (!currentWmksSession || !currentWmksSession.key) {\n         return false;\n      }\n      return isFileDownloadingInSession(currentWmksSession.key);\n   };\n\n   isPrintFileTransferringForAllSession = function() {\n      let wmksKey,\n         mksVchanClient,\n         downloadService;\n      for (wmksKey in wmksSessionMap) {\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            mksVchanClient = wmksSessionMap[wmksKey].mksVchanClient;\n            if (!!mksVchanClient && !!mksVchanClient.downloadServices) {\n               downloadService =\n                  mksVchanClient.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.PRINT];\n            }\n            if (!!downloadService &&\n               downloadService.isTransferringFileWithNoDialog()) {\n               return true;\n            }\n         }\n      }\n      return false;\n   };\n\n   isPrintFileTransferringInSession = function(wmksKey) {\n      if (!wmksKey || !wmksSessionMap.hasOwnProperty(wmksKey)) {\n         return false;\n      }\n\n      let mksVchanClient = wmksSessionMap[wmksKey].mksVchanClient,\n         downloadService;\n\n      if (!!mksVchanClient && !!mksVchanClient.downloadServices) {\n         downloadService =\n            mksVchanClient.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.PRINT];\n      }\n      return !!downloadService &&\n         downloadService.isTransferringFileWithNoDialog();\n   };\n\n   isPrintFileTransferringInCurrentSession = function() {\n      if (!currentWmksSession || !currentWmksSession.key) {\n         return false;\n      }\n      return isPrintFileTransferringInSession(currentWmksSession.key);\n   };\n\n   /**\n    * clearClipboard\n    *\n    * clears the contents of our global clipboard.\n    */\n   clearClipboard = function() {\n      globalClipboard.clear();\n   };\n\n    /*\n     * pushClipboard\n     *\n     * Pushes the local clipboard to the remote guest.\n     */\n   pushClipboard = function() {\n      let client = getCurrentMKSVchanClient();\n      if (!client) {\n         handleClipboardFailure();\n         return;\n      }\n      client.sendClipboard(globalClipboard,\n         function() {\n            AB.LOGGER.info(\"Clipboard synced with focused session\");\n         },\n         handleClipboardFailure);\n   };\n\n   /**\n    * sendClipboardText\n    *\n    * Sends a local clipboard text change to the remote guest.\n    *\n    * @params text: A string that we will update the remote clipboard with\n    */\n   sendClipboardText = function(text) {\n      let client = getCurrentMKSVchanClient();\n\n      if (!currentWmksSession || !currentWmksSession.pasteEnabled) {\n         return;\n      }\n\n      if (!client) {\n         handleClipboardFailure();\n         return;\n      }\n      client.sendClipboardText(\n         text,\n         function(text, error) {\n            AB.LOGGER.info(\"Clipboard update successfully sent\");\n            globalClipboard.setText(text, MKSVchan.CP_FORMAT.TEXT);\n            wmksServiceEventHandler.emit(\"clipboardChanged\", text, error);\n         },\n         handleClipboardFailure\n      );\n   };\n\n   /**\n    * onClipboardReady\n    *\n    * Called by a wmks session when its clipboard is ready. If the\n    * session is the current session, sync the remote clipboard with the\n    * local clipboard\n    *\n    * @param session: the calling session\n    */\n   onClipboardReady = function(wmksKey) {\n      if (!!currentWmksSession && wmksKey === currentWmksSession.key) {\n         updateClipboardCapabilities();\n         pushClipboard();\n      }\n   };\n\n   /**\n    * updateClipboardCapabilities\n    *\n    * Updates the clipboard capabilities, always with the capabilities of\n    * the current wmks session.\n    */\n   updateClipboardCapabilities = function() {\n      if (currentWmksSession) {\n         wmksServiceEventHandler.emit(\"clipboardCapabilitiesChanged\",\n            currentWmksSession.clipboardReady,\n            currentWmksSession.copyEnabled,\n            currentWmksSession.pasteEnabled);\n      }\n   };\n\n   /**\n    * onClipboardChange\n    *\n    * handles the notification from the remote guest that clipboard has\n    * changed, sends a request RPC for clipboard contents.\n    *\n    * @params session: the wmks session that sent the request\n    */\n   onClipboardChange = function(session) {\n      // Get session mksVchan client and sent a clipboard request RPC\n      let client = session.mksVchanClient;\n      if (!currentWmksSession || !currentWmksSession.copyEnabled) {\n         return;\n      }\n      if (!!client) {\n         client.sendClipboardRequest(\n            function() {\n               AB.LOGGER.info(\"Clipboard request successfully sent\");\n            },\n            handleClipboardFailure\n         );\n      } else {\n         handleClipboardFailure();\n      }\n   };\n\n   /**\n    * sendFileDownloadRequest\n    *\n    * Send request to MKSVchan server to ask for files.\n    *\n    */\n   sendFileDownloadRequest = function(mksClient, type) {\n      // Get session mksVchan client and sent a file download request RPC\n      if (!mksClient || !mksClient.FTUtil) {\n         handleFileTransferFailure();\n         return;\n      }\n\n      let enabled = false;\n\n      if (type === MKSVchan.FILE_TRANSFER_CONSUMER.FT) {\n         enabled = mksClient.FTUtil.config.downloadEnabled;\n      } else if (type === MKSVchan.FILE_TRANSFER_CONSUMER.PRINT) {\n         enabled = mksClient.FTUtil.config.printDownloadEnabled;\n      }\n\n      if (!enabled) {\n         return;\n      }\n\n      mksClient.sendFileTransferRequest(type,\n         function() {\n            AB.LOGGER.info(\"File download request successfully sent\");\n         },\n         handleFileTransferFailure\n      );\n   };\n\n   /**\n    * readAndSendFileChunks\n    *\n    * Upload file chunks to MKSVchan server.\n    *\n    * @params fileChunk: file chunk object\n    * @params onDone: onDone event\n    * @params onAbort: onAbort event\n    */\n   readAndSendFileChunks =\n      function(mksClient, fileChunks, onDone, onAbort) {\n         if (!fileChunks || !Array.isArray(fileChunks)) {\n            AB.LOGGER.error(\"File chunks is not a array object!\");\n            return;\n         }\n\n         if (fileChunks.length === 0) {\n            return;\n         }\n\n         let fileReader = new FileReader(),\n            chunkBlob,\n            readerOnload,\n            readerOnerror,\n            fileChunk = fileChunks.shift(),\n            self = this;\n\n         if (!!mksClient) {\n            chunkBlob = fileChunk.fileRef.slice(\n               fileChunk.chunkNum * fileChunk.chunkSize,\n               fileChunk.chunkNum * fileChunk.chunkSize +\n               fileChunk.currentChunkSize);\n\n            readerOnload = function(evt) {\n               let uint8Array = new Uint8Array(evt.target.result);\n\n               mksClient.sendFileChunk(fileChunk.chunkNum,\n                  fileChunk.totalChunkNum, fileChunk.currentChunkSize,\n                  fileChunk.fileRef.name, uint8Array,\n                  fileChunk.fileRef.size, function() {\n                     $timeout(function() {\n                        onDone();\n                        fileChunk.fileRef.progress =\n                           (fileChunk.chunkNum + 1) /\n                           fileChunk.totalChunkNum * 100;\n                     });\n                  },\n                  function() {\n                     if (onAbort) {\n                        onAbort();\n                     }\n                     handleFileTransferFailure();\n                  });\n\n               self.readAndSendFileChunks(mksClient, fileChunks, onDone,\n                  onAbort);\n            };\n\n            readerOnerror = function() {\n               $timeout(function() {\n                  fileChunk.fileRef.transferError = true;\n                  onAbort();\n               });\n            };\n\n            fileReader.onload = readerOnload;\n            fileReader.onerror = readerOnerror;\n            fileReader.readAsArrayBuffer(chunkBlob);\n\n         } else {\n            handleFileTransferFailure();\n         }\n      };\n\n   /**\n    * stopFileUpload\n    *\n    * Stop upload specific file.\n    *\n    * @params fileChunk: file chunk object\n    */\n   stopFileUpload = function(mksClient, fileName, onDone) {\n      if (!!mksClient) {\n         mksClient.sendStopUploadRequest(fileName, onDone, function() {\n            handleFileTransferFailure();\n         });\n      } else {\n         handleFileTransferFailure();\n      }\n   };\n\n   /**\n    * stopFileDownload\n    *\n    * Stop download specific file.\n    *\n    * @params fileChunk: file chunk object\n    */\n   stopFileDownload = function(mksClient, file, onDone) {\n      if (!!mksClient && !!file && !!file.fullPath && !!file.uuid) {\n         mksClient.sendStopDownloadRequest(\n            file.uuid + '|' + file.fullPath,\n            onDone, function() {\n               handleFileTransferFailure();\n            });\n      } else {\n         handleFileTransferFailure();\n      }\n   };\n\n   /**\n    * hasApplicationSession\n    *\n    * Returns true if any of the sessions in the session map are an\n    * application session.\n    */\n   hasApplicationSession = function() {\n      let wmksKey;\n      for (wmksKey in wmksSessionMap) {\n          /* istanbul ignore else */\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            if (wmksSessionMap[wmksKey].isApplicationSession) {\n               return true;\n            }\n         }\n      }\n      return false;\n   };\n\n   /**\n    * updateEmptySession\n    *\n    * update emtpy status for an app session.\n    * @param wmksKey key to identify app session.\n    * @param isEmpty empty status for this app session.\n    */\n   updateEmptySession = function(wmksKey, isEmpty) {\n      let appSession = wmksSessionMap[wmksKey];\n      if (appSession && appSession.isApplicationSession) {\n         appSession.setEmpty(isEmpty);\n      } else {\n         AB.LOGGER.error(\"Session \" + wmksKey + \" is not found.\");\n      }\n   };\n\n   /**\n    * prepareForSessionReset\n    *\n    * Informs the wmksService that an application reset will be performed.\n    * The service sets the requestedDisconnect flag to true for all of its\n    * application sessions to prevent them from displaying a disconnected\n    * dialog\n    */\n   prepareForSessionReset = function(resetWmksKey) {\n      let wmksKey,\n         wmksSession;\n\n      if (resetWmksKey) {\n         wmksSession = wmksSessionMap[resetWmksKey];\n         if (wmksSession) {\n            AB.LOGGER.info(\n               \"Setting requestedDisconnect to true for session: \" +\n               resetWmksKey);\n            wmksSession.requestedDisconnect = true;\n         }\n      } else {\n         for (wmksKey in wmksSessionMap) {\n             /* istanbul ignore else */\n            if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n               wmksSession = wmksSessionMap[wmksKey];\n               if (wmksSession && wmksSession.isApplicationSession) {\n                  AB.LOGGER.info(\n                     \"Setting requestedDisconnect to true for session: \" +\n                     wmksKey);\n                  wmksSession.requestedDisconnect = true;\n               }\n            }\n         }\n      }\n   };\n\n   /**\n    * sessionResetDone\n    *\n    * Tells the wmksService that the application session reset has done,\n    * and that the requestedDisconnect flag should be reset for the\n    * sessions for which the reset failed.\n    *\n    * @param wmksKeys an array of wmks session keys for which the reset\n    *    failed. requestedDisconnect will be set to false for these\n    *    sessions.\n    */\n   sessionResetDone = function(wmksKeys) {\n      let wmksSession,\n         i;\n\n      if (!wmksKeys) {\n         return;\n      }\n\n      for (i = 0; i < wmksKeys.length; i++) {\n         AB.LOGGER.error(\"Failed to reset session: \" + wmksKeys[i]);\n         wmksSession = wmksSessionMap[wmksKeys[i]];\n         if (wmksSession) {\n            wmksSession.requestedDisconnect = false;\n         }\n      }\n   };\n\n   /**\n    * isCurrentSession\n    *\n    * Utility function to check if a wmksKey matches the key of the\n    * current session\n    */\n   isCurrentSession = function(wmksKey) {\n      return currentWmksSession ? wmksKey === currentWmksSession.key :\n         false;\n   };\n\n   /**\n    * isCurrentSessionAPP\n    *\n    * Utility function to check if current wmks session is remote\n    * application\n    */\n   isCurrentSessionApp = function() {\n      return !!currentWmksSession &&\n         currentWmksSession.isApplicationSession;\n   };\n\n   /**\n    * isCurrentSessionDesktop\n    *\n    * Utility function to check if current wmks session is remote\n    * desktop\n    */\n   isCurrentSessionDesktop = function() {\n      return !!currentWmksSession && !currentWmksSession.isApplicationSession;\n   };\n\n   /**\n    * isCurrentSessionHasDPIChannelInited\n    *\n    * Utility function to check if current wmks session has establish a\n    * DPI sub connection\n    */\n   isCurrentSessionHasDPIChannelInited = function() {\n      return !!currentWmksSession &&\n         commonSvcService.isInitedForSession(currentWmksSession.key);\n   };\n\n   /**\n    * getCurrentSessionDPI\n    *\n    * Utility function to getCurrentSessinoDPI\n    */\n   getCurrentSessionDPI = function() {\n      if(!currentWmksSession){\n         return 1.0;\n      }\n      return commonSvcService.getRemoteDPI(currentWmksSession.key);\n   };\n\n   /**\n    * sessionOnConnecting\n    *\n    * Handle the onConnecting delegate request from wmksSession.\n    */\n   sessionOnConnecting = function(wmksSession, vdpService) {\n      wmksServiceEventHandler.emit(\"sessionConnecting\", wmksSession.key,\n         wmksSession.isApplicationSession, vdpService,\n         wmksSession.mainChannel);\n   };\n\n   /**\n    * sessionOnConnected\n    *\n    * Handle the onConnected delegate request from wmksSession.\n    */\n   sessionOnConnected = function(wmksSession) {\n      $timeout(function() {\n         wmksServiceEventHandler.emit(\"sessionConnected\", wmksSession.key,\n            wmksSession.isApplicationSession);\n      }, 0, false);\n   };\n\n   /**\n    * sessionOnDisconnected\n    *\n    * Handle the onDisconnected delegate request from wmksSession.\n    */\n   sessionOnDisconnected = function(wmksSession) {\n      let wasCurrentSession = isCurrentSession(wmksSession.key);\n      $timeout(function() {\n         wmksServiceEventHandler.emit(\"sessionDisconnected\",\n            wmksSession.key,\n            wmksSession.isApplicationSession,\n            wasCurrentSession);\n      }, 0, false);\n   };\n\n   /**\n    * sessionOnRemoved\n    *\n    * Handle the onRemoved delegate request from wmksSession.\n    */\n   sessionOnRemoved = function(wmksSession) {\n      let wmksKey,\n         deletedWmksKey = wmksSession.key,\n         isEmpty = wmksSession.isEmpty,\n         deletedItemIsApplication = wmksSession.isApplicationSession;\n\n      if (!wmksSessionMap[deletedWmksKey]) {\n         AB.LOGGER.warn(\n            'Tried to remove unknown session: ' + deletedWmksKey);\n         return;\n      }\n\n      $timeout(function() {\n         wmksServiceEventHandler.emit(\"sessionRemoved\", deletedWmksKey,\n            deletedItemIsApplication);\n      }, 0, false);\n\n      delete wmksSessionMap[deletedWmksKey];\n\n      // Switch to another session if possible. Todo: Choose the most\n      // recent used session.\n      if (currentWmksSession &&\n         (deletedWmksKey === currentWmksSession.key)) {\n         currentWmksSession = null;\n         // If this is not an empty application session, we will switch to\n         // another session.\n         if (!(deletedItemIsApplication && isEmpty)) {\n            for (wmksKey in wmksSessionMap) {\n                /* istanbul ignore else */\n               if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n                  changeWmksSession(wmksKey);\n                  break;\n               }\n            }\n         }\n      }\n\n      writeRunningSession();\n   };\n\n   getAllmksClient = function() {\n      let wmksKey,\n         wmksSession,\n         mksClient,\n         mksClientList = [];\n      for (wmksKey in wmksSessionMap) {\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            wmksSession = wmksSessionMap[wmksKey];\n            mksClient = wmksSession.mksVchanClient;\n            if (!!mksClient) {\n               mksClientList.push(mksClient);\n            }\n         }\n      }\n\n      return mksClientList;\n   };\n\n   shadowAllHeartbeatForPrint = function() {\n      if (!WMKS.BROWSER.isFirefox() && !WMKS.BROWSER.isSafari()) {\n         // Only work for Firefox and Safari\n         return;\n      }\n\n      AB.LOGGER.debug('Stop heartbeat for print.');\n      let wmksKey;\n      for (wmksKey in wmksSessionMap) {\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            wmksSessionMap[wmksKey].shadowHeartbeat();\n         }\n      }\n   };\n\n   recoverAllHeartbeatForPrint = function() {\n      if (!WMKS.BROWSER.isFirefox() && !WMKS.BROWSER.isSafari()) {\n         // Only work for Firefox and Safari\n         return;\n      }\n\n      AB.LOGGER.debug('Recover heartbeat for print.');\n      let wmksKey;\n      for (wmksKey in wmksSessionMap) {\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            wmksSessionMap[wmksKey].recoverHeartbeat();\n         }\n      }\n   };\n\n   shadowAllHeartbeatWhenSafariHidden = function() {\n      if (!WMKS.BROWSER.isSafari()) {\n         // Only work for Safari\n         return;\n      }\n\n      AB.LOGGER.debug('Stop heartbeat when Safari is hidden.');\n      let wmksKey;\n      for (wmksKey in wmksSessionMap) {\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            wmksSessionMap[wmksKey].shadowHeartbeat();\n         }\n      }\n   };\n\n   recoverAllHeartbeatWhenSafariVisible = function() {\n      if (!WMKS.BROWSER.isSafari()) {\n         // Only work for Safari\n         return;\n      }\n\n      AB.LOGGER.debug('Recover heartbeat when Safari is visible.');\n      let wmksKey;\n      for (wmksKey in wmksSessionMap) {\n         if (wmksSessionMap.hasOwnProperty(wmksKey)) {\n            wmksSessionMap[wmksKey].recoverHeartbeat();\n         }\n      }\n   };\n\n\n   $.extend(wmksService, {\n      init: init,\n      connectToDesktop: connectToDesktop,\n      connectToApplication: connectToApplication,\n      requestDisconnect: requestDisconnect,\n      pageFlowAfterDisconnect: pageFlowAfterDisconnect,\n      sendCtrlAltDel: sendCtrlAltDel,\n      sendEsc: sendEsc,\n      launchKeyboard: launchKeyboard,\n      isHighResModeEnabled: function() {\n         return isHighResModeEnabled;\n      },\n      isHighResModeSupported: isHighResModeSupported,\n      toggleHighResMode: toggleHighResMode,\n      isMP4Enabled: function() {\n         return isMP4Enabled;\n      },\n      isMP4Supported: isMP4Supported,\n      toggleMP4: toggleMP4,\n      areMacOSXKeyMappingsEnabled: function() {\n         return areMacOSXKeyMappingsEnabled;\n      },\n      areMacOSXKeyMappingsSupported: areMacOSXKeyMappingsSupported,\n      toggleUseMacOSXKeyMappings: toggleUseMacOSXKeyMappings,\n      isWindowsKeyEnabled: function() {\n         return isWindowsKeyEnabled;\n      },\n      toggleWindowsKey: toggleWindowsKey,\n      applyInitialHighResSetting: applyInitialHighResSetting,\n      applyInitialHighResSettingCallback: applyInitialHighResSettingCallback,\n      changeWmksSession: changeWmksSession,\n      onClipboardReady: onClipboardReady,\n      clearClipboard: clearClipboard,\n      updateClipboardCapabilities: updateClipboardCapabilities,\n      sendClipboardText: sendClipboardText,\n      onClipboardChange: onClipboardChange,\n      handleDownloadListChange: handleDownloadListChange,\n      handlePrintDownloadListChange: handlePrintDownloadListChange,\n      sendFileDownloadRequest: sendFileDownloadRequest,\n      handleClipboardReceived: handleClipboardReceived,\n      handleFileTransferError: handleFileTransferError,\n      handlePrintError: handlePrintError,\n      handleFileTransferConfigChange: handleFileTransferConfigChange,\n      isFileTransferringForAllSession: isFileTransferringForAllSession,\n      isFileTransferringInSession: isFileTransferringInSession,\n      isFileTransferringInCurrentSession: isFileTransferringInCurrentSession,\n      isFileDownloadingInSession: isFileDownloadingInSession,\n      isFileDownloadingInCurrentSession: isFileDownloadingInCurrentSession,\n      isPrintFileTransferringForAllSession: isPrintFileTransferringForAllSession,\n      isPrintFileTransferringInSession: isPrintFileTransferringInSession,\n      isPrintFileTransferringInCurrentSession: isPrintFileTransferringInCurrentSession,\n      readAndSendFileChunks: readAndSendFileChunks,\n      stopFileUpload: stopFileUpload,\n      stopFileDownload: stopFileDownload,\n      isCurrentSession: isCurrentSession,\n      isCurrentSessionApp: isCurrentSessionApp,\n      isCurrentSessionDesktop: isCurrentSessionDesktop,\n      isCurrentSessionHasDPIChannelInited: isCurrentSessionHasDPIChannelInited,\n      getCurrentSessionDPI: getCurrentSessionDPI,\n      sessionOnConnecting: sessionOnConnecting,\n      hasApplicationSession: hasApplicationSession,\n      sessionOnConnected: sessionOnConnected,\n      sessionOnDisconnected: sessionOnDisconnected,\n      sessionOnRemoved: sessionOnRemoved,\n      updateEmptySession: updateEmptySession,\n      prepareForSessionReset: prepareForSessionReset,\n      getCurrentMKSVchanClient: getCurrentMKSVchanClient,\n      sessionResetDone: sessionResetDone,\n      isMacOS: WMKS.BROWSER.isMacOS,\n      setUserActivityTime: setUserActivityTime,\n      shadowAllHeartbeatForPrint: shadowAllHeartbeatForPrint,\n      recoverAllHeartbeatForPrint: recoverAllHeartbeatForPrint,\n      getAllmksClient: getAllmksClient,\n      isSessionTimedOut: function() {\n         return sessionTimedOut;\n      },\n      handleUserActivity: handleUserActivity,\n      stopTimer: stopTimer,\n      hasMultimonCapacity: hasMultimonCapacity,\n      addMonitor: addMonitor,\n      quitMultimon: quitMultimon,\n      destroyMultimon: destroyMultimon,\n      whenNotInMultimon: whenNotInMultimon,\n      enterMultimon: enterMultimon,\n      disconnectEventConnections: disconnectEventConnections,\n      recoveryEventConnections: recoveryEventConnections,\n      getWmksSession: getWmksSession,\n      setCanvasVisibility: setCanvasVisibility,\n      activateWmksSession:activateWmksSession\n   });\n   return wmksService;\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/common/wmks-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * file-transfer-service.js --\n *\n * Module for read file and reassemble file service.\n *\n */\n\nimport MKSVchan from '../channels/mksvchan';\n\nexport default function FTDownloadService(AB, wmksService, $timeout,\n                                          fileTransferService, _) {\n   function Service(mksClient, type) {\n      this.mksClient = mksClient;\n      this.downloadFileNum = 0;\n      this.totalFileSize = 0;\n      this.unusedFileList = [];\n      this.type = type || MKSVchan.FILE_TRANSFER_CONSUMER.FT;\n      if (this.type !== MKSVchan.FILE_TRANSFER_CONSUMER.FT &&\n         this.type !== MKSVchan.FILE_TRANSFER_CONSUMER.PRINT) {\n         throw 'Error file transfer consumer type!';\n      }\n   }\n\n   Service.prototype = fileTransferService.baseService;\n\n   Service.prototype.downloadReady = function() {\n      let enabled = false;\n      if (this.type === MKSVchan.FILE_TRANSFER_CONSUMER.FT) {\n         enabled = this.mksClient.FTUtil.config.downloadEnabled;\n      } else if (this.type === MKSVchan.FILE_TRANSFER_CONSUMER.PRINT) {\n         enabled = this.mksClient.FTUtil.config.printDownloadEnabled;\n      }\n      if (!enabled) {\n         // If download not allowed, just return\n         AB.LOGGER.debug('File download is not allowed.');\n         return false;\n      }\n\n      if (!this.fileList || this.fileList.length < 1) {\n         this.openErrorDialog('NoFileWarningDialog',\n            _('FT_NO_FILE_WARNING_M'));\n         return false;\n      }\n\n      return true;\n   };\n\n   Service.prototype.verifyTotalSize = function(newSize) {\n      this.totalFileSize = this.getTotalFileSizeForList(this.fileList);\n      let size = this.totalFileSize + newSize,\n         readableSize;\n      if (size > MKSVchan.FILE_TRANSFER_MAX_TOTAL_SIZE) {\n         readableSize = this.mksClient.FTUtil.getReadableSize(size);\n         this.openErrorDialog('TotalSizeTooLargeWarningDialog',\n            _('FT_TOTAL_SIZE_TOO_LARGE_WARNING_M', [readableSize]));\n         return false;\n      }\n\n      return true;\n   };\n\n   Service.prototype.beginDownload = function() {\n      // Calculate how many file need to be download\n      this.downloadFileNum = this.getDownloadFileNum();\n      this.downloadedFileNum = this.getAlreadyDownloadedFileNum();\n      this.totalFileSize = this.getTotalFileSizeForList(this.fileList);\n\n      if (this.downloadFileNum === this.downloadedFileNum) {\n         return;\n      }\n\n      if (this.downloadFileNum !== 0) {\n         this.isTransferring = true;\n         wmksService.sendFileDownloadRequest(this.mksClient,\n            this.type);\n      }\n   };\n\n   Service.prototype.getTotalFileSizeForList = function(fileList) {\n      if (!fileList || fileList.length < 1) {\n         return 0;\n      }\n\n      let size = 0;\n      for (let i = 0; i < fileList.length; i++) {\n         if (fileList[i].transferError !== true &&\n            fileList[i].stopTransfer !== true) {\n            size += fileList[i].size;\n         }\n      }\n      return size;\n   };\n\n   Service.prototype.getDownloadFileNum = function() {\n      if (!this.fileList || !this.fileList.length) {\n         return 0;\n      }\n\n      let count = 0;\n      // Count every valid download file, including downloaded ones\n      for (let i = 0; i < this.fileList.length; i++) {\n         if (this.fileList[i].stopTransfer !== true &&\n            this.fileList[i].transferError !== true) {\n            count++;\n         }\n      }\n      AB.LOGGER.debug(\"There are: \" + count + \" files to download.\");\n      return count;\n   };\n\n   Service.prototype.getAlreadyDownloadedFileNum = function() {\n      if (!this.fileList || !this.fileList.length) {\n         return 0;\n      }\n\n      let count = 0;\n      // Count every downloaded file\n      for (let i = 0; i < this.fileList.length; i++) {\n         if (this.fileList[i].progress === 100) {\n            count++;\n         }\n      }\n      AB.LOGGER.debug(\n         \"There are: \" + count + \" files already downloaded.\");\n      return count;\n   };\n\n   Service.prototype.stopFileDownload = function(file) {\n      file.stopTransfer = true;\n      this.downloadFileNum--;\n      if (this.transferProgess === this.downloadFileNum) {\n         this.isTransferring = false;\n         this.downloadFileNum = 0;\n         if (this.onTransferFinish) {\n            this.onTransferFinish();\n         }\n      }\n      wmksService.stopFileDownload(this.mksClient, file, function() {\n         AB.LOGGER.debug(\"Successfully send cancel download request.\");\n      });\n   };\n\n   Service.prototype.getPathAndUUIDFromIdentifier =\n      function(chunkIdentifier) {\n         if (!chunkIdentifier) {\n            return null;\n         }\n\n         let index = chunkIdentifier.indexOf(\"|\");\n         if (index < 0 || index > chunkIdentifier.length) {\n            AB.LOGGER.error(\"Invalid identifier.\");\n            return null;\n         }\n\n         return {\n            uuid: chunkIdentifier.substr(0, index),\n            fullPath: chunkIdentifier.substr(index + 1)\n         };\n      };\n\n   Service.prototype.searchReceiveFile = function(chunkIdentifier) {\n      let info = this.getPathAndUUIDFromIdentifier(chunkIdentifier);\n\n      if (info === null) {\n         return null;\n      }\n\n      for (let i = 0; i < this.fileList.length; i++) {\n         if (info.fullPath === this.fileList[i].fullPath &&\n            info.uuid === this.fileList[i].uuid) {\n            return this.fileList[i];\n         }\n      }\n      return null;\n   };\n\n   Service.prototype.tryStopUnusedFileDownload =\n      function(chunkIdentifier) {\n         let info = this.getPathAndUUIDFromIdentifier(chunkIdentifier);\n\n         if (info === null) {\n            return false;\n         }\n\n         for (let i = 0; i < this.unusedFileList.length; i++) {\n            if (info.fullPath === this.unusedFileList[i].fullPath &&\n               info.uuid === this.unusedFileList[i].uuid) {\n               wmksService.stopFileDownload(this.mksClient, {\n                  uuid: info.uuid,\n                  fullPath: info.fullPath\n               });\n               this.unusedFileList.splice(i, 1);\n               return true;\n            }\n         }\n         return false;\n      };\n\n   Service.prototype.tryAddUnknownFileToList =\n      function(chunkIdentifier,\n               fileSize) {\n         if (!chunkIdentifier || !fileSize) {\n            return null;\n         }\n\n         let info = this.getPathAndUUIDFromIdentifier(chunkIdentifier),\n            relPath = '';\n\n         if (info === null) {\n            return null;\n         }\n\n         // Find file name from file full path\n         for (let i = info.fullPath.length - 1; i >= 0; i--) {\n            // Take care for windows '\\\\' and linux '/'\n            if (info.fullPath[i] === '\\\\' ||\n               info.fullPath[i] === '/') {\n               relPath = info.fullPath.substr(i + 1);\n               break;\n            }\n         }\n\n         this.fileList.push({\n            fullPath: info.fullPath,\n            relPath: relPath,\n            uuid: info.uuid,\n            size: fileSize,\n            readableSize: this.mksClient.FTUtil.getReadableSize(\n               fileSize),\n            fileType: MKSVchan.FILE_TRANSFER_FILE_TYPE.FILE,\n            contentData: null,\n            progress: 0,\n            transferError: false,\n            stopTransfer: false\n         });\n         return this.fileList[this.fileList.length - 1];\n      };\n\n   Service.prototype.reassembleChunks =\n      function(chunkNum, totalChunkNum, chunkIdentifier,\n               chunkData, fileSize) {\n         if (typeof chunkNum !== \"number\" ||\n            typeof totalChunkNum !== \"number\" ||\n            typeof fileSize !== \"number\" || chunkIdentifier == null ||\n            chunkData == null) {\n            AB.LOGGER.error(\n               \"Cannot reassemble with wrong parameters!\");\n            // TODO May need stop the download process\n            this.isTransferring = false;\n            return;\n         }\n         let uint8Array,\n            self = this,\n            file,\n            stopUnusedFile;\n\n         $timeout(function() {\n            file = self.searchReceiveFile(chunkIdentifier);\n\n            // First search if the file chunk belongs to some file in\n            // the file list\n            if (file === null) {\n               /**\n                *  If the chunk doesn't belong to any file in file\n                * list, and it is not the first chunk, do nothing\n                * here.\n                */\n               if (chunkNum !== 0) {\n                  AB.LOGGER.info(\n                     \"Cannot reassemble wrong file chunks!\");\n                  return;\n               }\n\n               /**\n                * If it is the first chunk, try to find it belongs to\n                * the unused file list. If so, ask server to stop\n                * transferring.\n                */\n               stopUnusedFile =\n                  self.tryStopUnusedFileDownload(chunkIdentifier);\n\n               // If find in unused file list, return.\n               if (stopUnusedFile === true) {\n                  return;\n               }\n\n               /**\n                * If not find in unused file list, it should be a\n                * 'bug' file. See bug 1645572. We need to add it into\n                * file list here.\n                */\n               file = self.tryAddUnknownFileToList(chunkIdentifier,\n                  fileSize);\n               if (file === null) {\n                  return;\n               }\n            }\n            uint8Array = new Uint8Array(chunkData);\n            if (chunkNum === 0) {\n               file.contentData = new Uint8Array(fileSize);\n            }\n            file.contentData.set(uint8Array,\n               self.mksClient.FTUtil.config.chunkSize * chunkNum);\n            file.progress = (chunkNum + 1) / totalChunkNum * 100;\n\n            if (file.progress === 100) {\n               self.transferProgess++;\n            }\n\n            if (self.transferProgess === self.downloadFileNum) {\n               self.isTransferring = false;\n               self.downloadFileNum = 0;\n               if (self.onTransferFinish) {\n                  self.onTransferFinish();\n               }\n            }\n         });\n      };\n\n   return {\n      getService: function(mksClient, type) {\n         if (!mksClient) {\n            AB.LOGGER.error(\"Invalid mksvchan client.\");\n            return null;\n         }\n         return new Service(mksClient, type);\n      }\n   };\n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/filetransfer/file-transfer-download-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * file-transfer-helper.js --\n *\n * Common helper for both ft and print service.\n *\n */\n\nimport MKSVchan from '../channels/mksvchan';\nimport AB from '../common/appblast-util';\n\nexport default function TransferHelper(wmksService, FTDownloadService,\n                                       FTUploadService,\n                                       wmksServiceEventHandler) {\n\n   function Service(consumer) {\n      if (consumer !== MKSVchan.FILE_TRANSFER_CONSUMER.FT &&\n         consumer !== MKSVchan.FILE_TRANSFER_CONSUMER.PRINT) {\n         throw 'Wrong type of consumer is used!';\n      }\n\n      AB.LOGGER.debug(\"Init transfer helper\");\n      this.consumer = consumer;\n   }\n\n   /**\n    * Update the download file list.\n    * Since it is possible that some file in the coming list has\n    * already been added, we need to be careful and verify if it is\n    * added. See bug 1645572.\n    */\n\n   Service.prototype.updateDownloadFileList = function(fileList,\n                                                       client) {\n      /**\n       * $scope.downloadFiles is referred to\n       * mksClient.FTUtil.downloadList[FT/PRINT]. We need to use the\n       * later one, in case some bugs while desktop switch.\n       * See bug 1755174, 1755201, 1756222.\n       */\n      if (!client || !client.FTUtil) {\n         AB.LOGGER.error(\"Cannot find FTUtil for this desktop!\");\n         return;\n      }\n\n      let isAdded,\n         downloadList = client.FTUtil.downloadList[this.consumer];\n      for (let i = 0; i < fileList.length; i++) {\n         isAdded = false;\n         for (let j = 0; j < downloadList.length; j++) {\n            if (fileList[i].fullPath ===\n               downloadList[j].fullPath &&\n               fileList[i].uuid === downloadList[j].uuid\n            ) {\n               isAdded = true;\n               break;\n            }\n         }\n\n         if (isAdded === false) {\n            downloadList.push(fileList[i]);\n         }\n      }\n   };\n\n   /**\n    * Used to get current mks client with transfer service.\n    * @param consumer\n    * @returns {*}\n    */\n   Service.prototype.initTransferService = function() {\n      let mksClient = wmksService.getCurrentMKSVchanClient();\n      if (mksClient == null) {\n         return null;\n      }\n\n      // Only file transfer has upload service now\n      if (!mksClient.uploadService &&\n         this.consumer === MKSVchan.FILE_TRANSFER_CONSUMER.FT) {\n         mksClient.uploadService = FTUploadService\n            .getService(mksClient);\n      }\n      if (!mksClient\n            .downloadServices[this.consumer]) {\n         mksClient.downloadServices[this.consumer] =\n            FTDownloadService.getService(mksClient, this.consumer);\n      }\n\n      return mksClient;\n   };\n\n   Service.prototype.addStatusListener = function(func) {\n      if (typeof func !== \"function\") {\n         AB.LOGGER.info(\"Invalid parameter\");\n         return;\n      }\n\n      wmksServiceEventHandler.addEventListener(\n         \"fileTransferConfigChange\",\n         function(error) {\n            func();\n         }\n      );\n\n      // Listen to session change\n      wmksServiceEventHandler.addEventListener('activeSessionChanged',\n         func);\n      // Listen to new session\n      wmksServiceEventHandler.addEventListener('sessionConnected',\n         func);\n\n      if (this.consumer === MKSVchan.FILE_TRANSFER_CONSUMER.FT) {\n         wmksServiceEventHandler.listenerReadyForModule(\n            wmksServiceEventHandler.MODULE_NAME.FT_HELPER);\n      } else if (this.consumer ===\n         MKSVchan.FILE_TRANSFER_CONSUMER.PRINT) {\n         wmksServiceEventHandler.listenerReadyForModule(\n            wmksServiceEventHandler.MODULE_NAME.PRINT_HELPER);\n      }\n   };\n\n   return {\n      getInstance: function(consumer) {\n         return new Service(consumer);\n      }\n   };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/filetransfer/file-transfer-helper.js","/******************************************************************************\n * Copyright 2016-2017 VMware, Inc.  All rights reserved.\n *****************************************************************************/\n\n\nimport angular from 'angular';\nimport $ from 'jquery';\nimport ftTemplate from './file_transfer_template.html';\nimport MKSVchan from '../channels/mksvchan';\nimport AB from '../common/appblast-util';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport helpTemplate from '../common/clip_ft_help_template.html';\nimport {saveAs} from 'fileSaver';\nimport errorDialogTemplate from '../../common/commondialog/dialog_service_error.html';\n\nexport function fileTransferPanel($window, panelService, $timeout) {\n   return {\n      restrict: 'E',\n      replace: true, // Replace with the template below\n      templateUrl: ftTemplate,\n      scope: true,\n      link: function(scope, element) {\n         let panelServiceInstance = panelService.getService();\n\n         panelServiceInstance.addPanelElement('ft', element);\n\n         element.resizable({\n            containment: \"document\",\n            /**\n             * The min height and min width are the same with the\n             * style '.file-transfer-panel' in style.css\n             * List them here to prevent bug 1788445. Otherwise\n             * Edge could set the height much smaller\n             */\n            minHeight: 350,\n            minWidth: 500\n         }).draggable({\n            containment: \"window\",\n            handle: \".file-transfer-handle\",\n            start: function(event, ui) {\n               element.css(\"z-index\", panelServiceInstance.getNewZIndex());\n            }\n         });\n\n         scope.windowResizeHandler = panelServiceInstance\n            .windowResizeHandler(scope, 'showFileTransferPanel',\n               element);\n\n         angular.element($window).bind('resize',\n            scope.windowResizeHandler);\n\n         /**\n          * resizes the clipboard contents to fit within the\n          * clipboard panel\n          *\n          * 39 is the header height and 19 is the footer height.\n          */\n         scope.resizeFileContent = function() {\n            let newHeight = element.outerHeight() - 36 - 19;\n            $('.file-content').css('height', newHeight);\n            $('.file-content-list').css('height', newHeight -\n               $('.file-area-header').outerHeight());\n         };\n\n         element.bind('resize', scope.resizeFileContent);\n\n         scope.$on('$destroy', function() {\n            element.unbind('resize', scope.resizeFileContent);\n            angular.element($window).unbind('resize',\n               scope.windowResizeHandler);\n         });\n         $timeout(function() {\n            scope.resizeFileContent();\n         });\n      }\n   };\n}\n\nexport function fileTransferController($window, $scope, $rootScope, $timeout, ngDialog,\n                                       wmksService,\n                                       WMKS,\n                                       TransferHelper, _,\n                                       toastService, wmksServiceEventHandler,\n                                       panelService) {\n   $rootScope.disableFTPanel = false;\n   $scope.transferHelper =\n      TransferHelper.getInstance(MKSVchan.FILE_TRANSFER_CONSUMER.FT);\n   $scope.showFileTransferPanel = false;\n   $scope.focused = false;\n   // Used for focus/blur event\n   $scope.fileTransferInput = null;\n   $scope.showFileDownload = true;\n   $scope.showFileUpload = false;\n   $scope.showNotification = null;\n   $scope.downloadFiles = [];\n   $scope.uploadFiles = [];\n   $scope.uploadEnabled = true;\n   $scope.downloadEnabled = true;\n   $scope.clipboardToServer = false;\n   $scope.clipboardToClient = false;\n   $scope.modKey = WMKS.BROWSER.isMacOS() ?\n      _('CMD_KEY') : _('CTRL_KEY');\n   $scope.windowResizeHandler = null;\n   $scope.resizeFileContent = null;\n   $scope.selectFile = null;\n   $scope.uploadHandler = null;\n   $scope.beginDownload = null;\n   $scope.beginUpload = null;\n   $scope.uploadService = null;\n   $scope.downloadService = null;\n   $scope.PANEL_TAB = {\n      DOWNLOAD: 0,\n      UPLOAD: 1\n   };\n   $scope.errorDialog = null;\n\n   $scope.switchFileTab = function(type) {\n      switch (type) {\n         case $scope.PANEL_TAB.DOWNLOAD:\n            $scope.showFileDownload = true;\n            $scope.showFileUpload = false;\n            break;\n         case $scope.PANEL_TAB.UPLOAD:\n            $scope.showFileDownload = false;\n            $scope.showFileUpload = true;\n            break;\n      }\n   };\n\n   // shows/hides the clipboard panel\n   $scope.toggleFileTransferPanel = function($event, closePanel) {\n      if (closePanel === true) {\n         $scope.showFileTransferPanel = false;\n      } else if (closePanel === false) {\n         $scope.showFileTransferPanel = true;\n      } else {\n         $scope.showFileTransferPanel = !$scope.showFileTransferPanel;\n      }\n\n      if ($scope.showFileTransferPanel) {\n         $timeout(function() {\n            $scope.windowResizeHandler();\n            $scope.resizeFileContent();\n         });\n      }\n\n      if ($event) {\n         $event.stopPropagation();\n         $event.preventDefault();\n      }\n      $scope.focusInput();\n   };\n\n   $scope.focusInput = function() {\n      if ($scope.fileTransferInput) {\n         $timeout(function() {\n            $scope.fileTransferInput.select();\n         });\n      }\n   };\n\n   $scope.ftPanelFocus = function() {\n      if ($scope.showFileTransferPanel) {\n         $scope.focused = true;\n         panelService.getService().onFocus('ft');\n      }\n   };\n\n   $scope.ftPanelBlur = function() {\n      $scope.focused = false;\n   };\n\n   $scope.openFileTransferHelp = function() {\n      ngDialog.open({\n         name: \"FileTransferHelpWindow\", // dialog name\n         templateUrl: helpTemplate, // template\n         className: \"file-transfer-help-window\", // CSS class\n         data: {\n            title: 'FILE_TRANSFER_HELP_DIALOG_T',\n            msg: 'FILE_TRANSFER_HELP_DIALOG_M',\n            modKey: $scope.modKey\n         },\n         showClose: false, // do not show close button\n         closeByEscape: true, // allow escape to close window\n         closeByDocument: true // allow clicking on background to close\n      });\n   };\n\n   $scope.clearDownloadList = function() {\n      if ($scope.downloadService.isTransferringFile()) {\n         AB.LOGGER.debug(\"Another task is in process.\");\n         return;\n      }\n\n      for (let i = 0; i < $scope.downloadFiles.length; i++) {\n         if (!!$scope.downloadFiles[i].contentData) {\n            // Delete the file content first to trigger gc\n            delete $scope.downloadFiles[i].contentData;\n         }\n      }\n      // Be careful, this is referenced array\n      $scope.downloadFiles.splice(0, $scope.downloadFiles.length);\n   };\n\n   $scope.stopFileDownload = function(file) {\n      $scope.downloadService.stopFileDownload(file);\n   };\n\n   $scope.removeDownloadFile = function(file) {\n      for (let i = 0; i < $scope.downloadFiles.length; i++) {\n         if (file === $scope.downloadFiles[i]) {\n            $scope.downloadFiles.splice(i, 1);\n            break;\n         }\n      }\n   };\n\n   $scope.clearUploadList = function() {\n      if ($scope.uploadService.isTransferringFile()) {\n         AB.LOGGER.debug(\"Another task is in process.\");\n         return;\n      }\n\n      $scope.uploadFiles.splice(0, $scope.uploadFiles.length);\n      clearFileInput();\n   };\n\n   $scope.stopFileUpload = function(file) {\n      $scope.uploadService.stopFileUpload(file);\n\n      clearFileInput();\n   };\n\n   $scope.uploadHandler = function(event) {\n      if (!$scope.uploadEnabled) {\n         return;\n      }\n\n      $scope.switchFileTab($scope.PANEL_TAB.UPLOAD);\n\n      let mksClient,\n         files,\n         i;\n\n      mksClient = wmksService.getCurrentMKSVchanClient();\n      if (mksClient == null) {\n         return;\n      }\n\n      files = event.target.files ||\n         event.originalEvent.dataTransfer.files;\n      for (i = 0; i < files.length; i++) {\n         files[i].fullPath = files[i].name;\n         files[i].relPath = files[i].name;\n         files[i].readableSize =\n            mksClient.FTUtil.getReadableSize(files[i].size);\n         files[i].progress = 0;\n         files[i].stopTransfer = false;\n         // Is the file put into upload queue\n         files[i].queued = false;\n\n         if (checkFileNameLength(files[i].name) &&\n            checkIllegalCharater(files[i].name)) {\n            files[i].transferError = false;\n         } else {\n            files[i].transferError = true;\n         }\n\n         $scope.uploadFiles.push(files[i]);\n      }\n\n      $scope.$apply();\n      $scope.beginUpload();\n   };\n\n   /**\n    * Defined this function into window instead of scope to bypass the bug\n    * 1793969, where if the $(\"#upload-file-input\").click(); is in the\n    * $timeout, no file selection window will be generated when using\n    * multimon. And remove the $timeout alone will generate apply error,\n    * since we call scope event-firing function inside scope event handing\n    * funciton.\n    */\n   $window.chooseUploadFiles = function() {\n      $('#upload-file-input').click();\n   };\n\n   $scope.beginUpload = function() {\n      $scope.uploadService.init($scope.uploadFiles, function() {\n         AB.LOGGER.debug('Upload task finish.');\n      });\n\n      if (!$scope.uploadService.uploadReady()) {\n         return;\n      }\n\n      $scope.uploadService.beginUpload();\n      clearFileInput();\n   };\n\n   $scope.beginDownload = function() {\n      $scope.downloadService.init($scope.downloadFiles, function() {\n         AB.LOGGER.debug('Download task finish.');\n      });\n\n      if (!$scope.downloadService.downloadReady()) {\n         return;\n      }\n\n      // Show toast if print service is downloading file\n      if (wmksService.isPrintFileTransferringInCurrentSession()) {\n         // Treat it as a print toast since it is blocked by print\n         toastService.warning(_('FT_BLOCK_BY_PRINT'),\n            toastService.TOAST_TYPE.PRINT);\n      }\n\n      $scope.downloadService.beginDownload();\n   };\n\n   /**\n    * save file into the local machine, which will bring side effects when\n    * using multimon so need to emit event for multimon module to handle.\n    */\n   $scope.saveFile = function(file) {\n      $(window).trigger(\"fileDownloaded\");\n      saveAs(new Blob([file.contentData.buffer]), file.relPath);\n   };\n\n   function clearFileInput() {\n      let inputEle = $('#upload-file-input');\n      /**\n       * Special handle for IE\n       * $('#upload-file-input').val('') will trigger new file input\n       * change event in IE.\n       * See here:\n       * http://stackoverflow.com/questions/1043957/clearing-input\n       * -type-file-using-jquery/1043969#1043969\n       */\n      if (WMKS.BROWSER.isIE() && WMKS.BROWSER.version.major <= 11) {\n         inputEle.wrap('<form>').closest('form').get(0).reset();\n         inputEle.unwrap();\n      } else {\n         inputEle.val('');\n      }\n   }\n\n   function adjustFileTransferPolicy(mksClient) {\n      /**\n       * If copy/paste from server to client is disabled, file\n       * download cannot be used\n       */\n      if ($scope.clipboardToClient === false) {\n         mksClient.FTUtil.config.downloadEnabled = false;\n         $scope.downloadEnabled = false;\n      }\n\n      if (!$scope.downloadEnabled && !$scope.uploadEnabled) {\n         $rootScope.disableFTPanel = true;\n         $scope.showFileTransferPanel = false;\n         return;\n      }\n\n      $rootScope.disableFTPanel = false;\n      if (!$scope.downloadEnabled && $scope.uploadEnabled) {\n         $scope.switchFileTab($scope.PANEL_TAB.UPLOAD);\n      }\n      if ($scope.downloadEnabled && !$scope.uploadEnabled) {\n         $scope.switchFileTab($scope.PANEL_TAB.DOWNLOAD);\n      }\n   }\n\n   $scope.updateMKSvchanClient = function() {\n      $timeout(function() {\n         let mksClient = $scope.transferHelper.initTransferService(\n            MKSVchan.FILE_TRANSFER_CONSUMER.FT);\n         if (mksClient == null) {\n            return;\n         }\n         $scope.uploadService = mksClient.uploadService;\n         $scope.downloadService =\n            mksClient.downloadServices[MKSVchan.FILE_TRANSFER_CONSUMER.FT];\n         $scope.downloadFiles =\n            mksClient.FTUtil.downloadList[MKSVchan.FILE_TRANSFER_CONSUMER.FT];\n         $scope.uploadFiles = mksClient.FTUtil.uploadList;\n         $scope.uploadService.fileChunkQueue =\n            mksClient.FTUtil.fileChunkQueue;\n\n         $scope.downloadEnabled =\n            !!mksClient.FTUtil.config.downloadEnabled &&\n            !WMKS.BROWSER.isSafari();\n         $scope.uploadEnabled = !!mksClient.FTUtil.config.uploadEnabled;\n\n         adjustFileTransferPolicy(mksClient);\n\n         if ($scope.showFileTransferPanel) {\n            $scope.showNotification('FT_SESSION_UPDATE_M');\n         }\n      });\n   };\n\n   function checkFileNameLength(fileName) {\n      /**\n       * Windows has the max 260 path length restriction\n       * Mac has max 255 file name length restriction\n       * Since we save uploaded file to C:/Users/userName/Documents/,\n       * we need to calculate the length the whole path\n       */\n      const MAX_LENGTH = 250;\n\n      if (!fileName || fileName === '' ||\n         fileName.length > MAX_LENGTH) {\n         return false;\n      }\n\n      return 21 + fileName.length + $scope.userName.length <=\n         MAX_LENGTH;\n   }\n\n   function checkIllegalCharater(fileName) {\n      return fileName.indexOf('\\\\') < 0 && fileName.indexOf('/') < 0 &&\n         fileName.indexOf(':') < 0 && fileName.indexOf('*') < 0 &&\n         fileName.indexOf('?') < 0 && fileName.indexOf('\"') < 0 &&\n         fileName.indexOf('<') < 0 && fileName.indexOf('>') < 0 &&\n         fileName.indexOf('|') < 0;\n   }\n\n   wmksServiceEventHandler.addEventListener('sessionDataReady',\n      function(sessionData) {\n         $scope.userName = sessionData.user;\n      });\n   // Listen to file transfer updates and sync panel with agent\n   wmksServiceEventHandler.addEventListener('downloadFileListChanged',\n      function(fileList, client, error) {\n         /**\n          * TODO reference client here in case some bugs while\n          * desktop switch. See bug 1755174, 1755201, 1756222.\n          * These bugs have same root cause. Since it is not likely\n          * happen in ft, let's fix it later.\n          */\n         $timeout(function() {\n            AB.LOGGER.log(\n               \"File download list from remote server is\" +\n               \" synced to client.\");\n            if ($scope.downloadEnabled === false || !fileList ||\n               fileList.length <= 0 || !$scope.downloadService\n            ) {\n               AB.LOGGER.log(\n                  \"Download not enable or list is empty!\");\n               return;\n            }\n\n            let i;\n            // If panel not opened, do nothing\n            if (!$scope.showFileTransferPanel) {\n               AB.LOGGER.debug(\"File control panel is not opened\" +\n\n                  \" now.\");\n\n               for (i = 0; i < fileList.length; i++) {\n                  $scope.downloadService.unusedFileList\n                     .push(fileList[i]);\n               }\n               return;\n            }\n\n            $scope.downloadService.verifyTotalSize(\n               $scope.downloadService.getTotalFileSizeForList(\n                  fileList)\n            );\n\n            if (error ===\n               MKSVchan.CLIPBOARD_ERROR.MAX_LIMIT_EXCEEDED) {\n               if ($scope.showFileTransferPanel) {\n                  $scope.showNotification(\n                     'FT_FILE_LIST_TRUNCATED_M');\n               }\n            }\n\n            // Store old and new file list\n            $scope.transferHelper.updateDownloadFileList(fileList,\n               client);\n\n            // If open panel, begin download right now\n            $scope.beginDownload();\n         });\n      });\n\n   wmksServiceEventHandler.addEventListener('fileTransferFailed',\n      function() {\n         if ($scope.showFileTransferPanel) {\n            $scope.showNotification('FT_FAILED_M');\n         }\n      });\n\n   wmksServiceEventHandler.addEventListener('fileTransferError',\n      function(error) {\n         if (!!$scope.errorDialog &&\n            ngDialog.isOpen($scope.errorDialog.id)) {\n            JSCDKLogger.debug('Only open one dialog each time.');\n            $scope.errorDialog.close();\n         }\n\n         let errorMsg;\n\n         switch (error) {\n            case MKSVchan.FILE_TRANSFER_ERROR.NO_ENOUGH_DISK:\n               errorMsg = _('FT_ERROR_NO_ENOUGH_DISK');\n               for (let i = 0; i < $scope.uploadFiles.length; i++) {\n                  if ($scope.uploadFiles[i].progress !== 100 &&\n                     $scope.uploadFiles[i].stopTransfer !== true &&\n                     $scope.uploadFiles[i].transferError !== true) {\n                     $scope.stopFileUpload($scope.uploadFiles[i]);\n                  }\n               }\n               break;\n            case MKSVchan.FILE_TRANSFER_ERROR.IS_TRANSFERRING:\n               errorMsg = _('FT_ERROR_SERVER_IS_TRANSFERRING_FILES');\n               break;\n            case MKSVchan.FILE_TRANSFER_ERROR.UNKNOWN_ERROR:\n               errorMsg = _('FT_ERROR_UNKNOWN_ERROR');\n               break;\n            default:\n               JSCDKLogger.error('Invalid error number: ' + error +\n                  ' received from server.');\n         }\n         $scope.errorDialog = ngDialog.open({\n            name: 'FileTransferServerErrorDialog',\n            templateUrl: errorDialogTemplate,\n            className: \"session-ops-dialog\",\n            data: {\n               errorMessage: errorMsg,\n               title: _('FT_WARNING_T'),\n               buttonLabel: _('OK')\n            },\n            showClose: false,\n            closeByEscape: true,\n            closeByDocument: true\n         });\n      });\n\n   /**\n    * Download is associated with copy from agent to client\n    * (copyEnabled)\n    */\n   wmksServiceEventHandler.addEventListener(\n      \"clipboardCapabilitiesChanged\",\n      function(clipboardReady, copyEnabled, pasteEnabled) {\n         $timeout(function() {\n            $scope.clipboardToServer = pasteEnabled;\n            $scope.clipboardToClient = copyEnabled;\n            let mksClient = $scope.transferHelper.initTransferService();\n            if (mksClient == null) {\n               return;\n            }\n\n            adjustFileTransferPolicy(mksClient);\n         });\n      }\n   );\n   wmksServiceEventHandler.listenerReadyForModule(\n      wmksServiceEventHandler.MODULE_NAME.FT_CONTROLLER);\n\n   $scope.transferHelper.addStatusListener($scope.updateMKSvchanClient);\n   $rootScope.$on('toggleFileTransferPanel',\n      $scope.toggleFileTransferPanel);\n}\n\nexport function fileTransferInput() {\n   return {\n      restrict: 'E',\n      replace: true, // Replace with the template below\n      template: \"<input></input>\",\n      link: function(scope, element) {\n         scope.fileTransferInput = element;\n         element.val(\" \");\n      }\n   };\n}\n\nexport function fileDrop() {\n   return {\n      restrict: 'A',\n      scope: {\n         fileDrop: '&fileDrop'\n      },\n      link: function(scope, element) {\n         element.on('dragover', function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n         });\n         element.on('dragenter', function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n         });\n         element.on('drop', function(e) {\n            if (typeof scope.fileDrop === 'function') {\n               scope.fileDrop({\n                  event: e\n               });\n            }\n\n            e.preventDefault();\n         });\n      }\n   };\n}\n\nexport function fileChange() {\n   return {\n      restrict: 'A',\n      scope: {\n         fileChange: '&'\n      },\n      link: function(scope, element) {\n         element.on('change', function(e) {\n            if (typeof scope.fileChange === 'function') {\n               scope.fileChange({\n                  event: e\n               });\n            }\n         });\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/filetransfer/file-transfer-panel.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * file-transfer-service.js --\n *\n * Base class for upload & download service.\n *\n */\n\nimport MKSVchan from '../channels/mksvchan';\nimport errorDialogTemplate from '../../common/commondialog/dialog_service_error.html';\n\nexport default function fileTransferService(AB, ngDialog, wmksService, $timeout,\n                                            _) {\n   function Service() {\n      this.fileList = [];\n      this.isTransferring = false;\n      this.onTransferFinish = null;\n      this.transferProgess = 0;\n      this.dialog = null;\n   }\n\n   Service.prototype.openErrorDialog =\n      function(errorDgName, errorMsg) {\n         if (!!this.dialog && ngDialog.isOpen(this.dialog.id)) {\n            AB.LOGGER.debug('Only open one dialog each time.');\n            this.dialog.close();\n         }\n\n         this.dialog = ngDialog.open({\n            name: errorDgName,\n            templateUrl: errorDialogTemplate,\n            className: \"session-ops-dialog\",\n            data: {\n               errorMessage: errorMsg,\n               title: _('FT_WARNING_T'),\n               buttonLabel: _('OK')\n            },\n            showClose: false,\n            closeByEscape: true,\n            closeByDocument: true\n         });\n      };\n\n   Service.prototype.init = function(fileList, onTransferFinish) {\n      if (!fileList || typeof onTransferFinish !== 'function') {\n         AB.LOGGER.error(\n            'Cannot init file transfer service due to param error!');\n         return;\n      }\n\n      this.transferProgess = 0;\n      for (let i = 0; i < fileList.length; i++) {\n         if (fileList[i].progress === 100) {\n            this.transferProgess++;\n         }\n      }\n      this.fileList = fileList;\n      this.onTransferFinish = onTransferFinish;\n   };\n\n   Service.prototype.isTransferringFile = function() {\n      if (this.isTransferring) {\n         this.openErrorDialog('BeingTransferWarningDialog',\n            _('FT_BEING_TRANSFER_WARNING_M'));\n         return true;\n      }\n      return false;\n   };\n\n   Service.prototype.isTransferringFileWithNoDialog = function() {\n      return this.isTransferring;\n   };\n\n   Service.prototype.checkFileSize = function() {\n      let res = false;\n\n      for (let i = 0; i < this.fileList.length; i++) {\n         if (this.fileList[i].size >=\n            MKSVchan.FILE_TRANSFER_MAX_FILE_SIZE ||\n            this.fileList[i].size === 0) {\n            this.fileList[i].transferError = true;\n            res = true;\n         }\n      }\n      return res;\n   };\n\n   Service.prototype.checkFolderExist = function() {\n      let res = false;\n\n      for (let i = 0; i < this.fileList.length; i++) {\n         if (this.fileList[i].fileType ===\n            MKSVchan.FILE_TRANSFER_FILE_TYPE.DIRECTORY) {\n            this.fileList[i].transferError = true;\n            res = true;\n         }\n      }\n      return res;\n   };\n\n   Service.prototype.checkSymlinkExist = function() {\n      let res = false;\n\n      for (let i = 0; i < this.fileList.length; i++) {\n         if (this.fileList[i].fileType ===\n            MKSVchan.FILE_TRANSFER_FILE_TYPE.SYMLINK) {\n            this.fileList[i].transferError = true;\n            res = true;\n         }\n      }\n      return res;\n   };\n\n   return {\n      baseService: new Service()\n   };\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/filetransfer/file-transfer-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * file-transfer-upload-service.js --\n *\n * Module for upload file service.\n *\n */\n\nexport default function FTUploadService(AB, wmksService, $timeout, _,\n                                        fileTransferService) {\n   function Service(mksClient) {\n      this.mksClient = mksClient;\n      // Store reference for mksvchan.ftutil.fileChunkQueue\n      this.fileChunkQueue = null;\n      this.NUMBER_OF_CHUNK_SEND_ONE_TIME = 10;\n      this.currentNumChunkSendOneTime = 0;\n      this.chunkSendNum = 0;\n   }\n\n   Service.prototype = fileTransferService.baseService;\n\n   Service.prototype.uploadReady = function() {\n      if (!this.mksClient.FTUtil.config.uploadEnabled) {\n         // If upload not allowed, just return\n         AB.LOGGER.debug('File upload is not allowed.');\n         return false;\n      }\n\n      if (!this.fileList || this.fileList.length < 1) {\n         this.openErrorDialog('NoFileWarningDialog',\n            _('FT_NO_FILE_WARNING_M'));\n         return false;\n      }\n\n      return true;\n   };\n\n   Service.prototype.queueFileChunks = function(file) {\n      if (file.transferError === true || file.progress > 0 ||\n         file.stopTransfer === true || file.queued === true) {\n         return;\n      }\n\n      let fileChunkNum,\n         configChunkSize,\n         currentChunkSize,\n         i;\n\n      if (this.mksClient == null) {\n         return;\n      }\n\n      file.queued = true;\n      configChunkSize = this.mksClient.FTUtil.config.chunkSize;\n      currentChunkSize = configChunkSize;\n      fileChunkNum = (file.size % configChunkSize === 0) ?\n         Math.floor(file.size / configChunkSize) :\n         Math.floor(file.size / configChunkSize + 1);\n\n      for (i = 0; i < fileChunkNum; i++) {\n         if (i === fileChunkNum - 1) {\n            currentChunkSize = file.size -\n               (fileChunkNum - 1) * configChunkSize;\n         }\n         this.fileChunkQueue.push({\n            fileRef: file,\n            chunkNum: i,\n            totalChunkNum: fileChunkNum,\n            currentChunkSize: currentChunkSize,\n            chunkSize: configChunkSize\n         });\n      }\n   };\n\n   Service.prototype.removeFileChunksFromQueue = function(file) {\n      for (let i = this.fileChunkQueue.length - 1; i >= 0; i--) {\n         if (file === this.fileChunkQueue[i].fileRef) {\n            this.fileChunkQueue.splice(i, 1);\n         }\n      }\n   };\n\n   Service.prototype.sendNextFileChunks = function() {\n      if (this.fileChunkQueue.length === 0) {\n         AB.LOGGER.debug(\"File upload finished.\");\n         this.isTransferring = false;\n         return;\n      }\n\n      let onDone,\n         onAbort;\n\n      onDone = () => {\n         this.chunkSendNum++;\n\n         if (this.chunkSendNum === this.currentNumChunkSendOneTime) {\n            this.chunkSendNum = 0;\n            this.sendNextFileChunks();\n         }\n      };\n\n      onAbort = () => {\n         this.isTransferring = false;\n         this.fileChunkQueue.splice(0, this.fileChunkQueue.length);\n      };\n\n      this.currentNumChunkSendOneTime =\n         Math.min(this.NUMBER_OF_CHUNK_SEND_ONE_TIME,\n            this.fileChunkQueue.length);\n\n      let chunks = [],\n         chunk;\n      for (let i = 0; i < this.currentNumChunkSendOneTime; i++) {\n         chunk = this.fileChunkQueue.shift();\n         chunks.push(chunk);\n      }\n      wmksService.readAndSendFileChunks(this.mksClient, chunks, onDone,\n         onAbort);\n   };\n\n   Service.prototype.checkFileValid = function(fileList, onValidDone) {\n      if (!fileList || typeof onValidDone !== 'function') {\n         AB.LOGGER.error(\"Error file list or onValidDone function!\");\n         return;\n      }\n\n      // Read each item for 1 byte to verify if it is a valid file\n      let fileTester = fileIndex => {\n            if (fileIndex > fileList.length - 1) {\n               onValidDone();\n               return;\n            }\n\n            let currentFile = fileList[fileIndex],\n               reader,\n               oneByteBlob;\n\n            if (currentFile.transferError === true ||\n               currentFile.queued === true) {\n               fileTester(fileIndex + 1);\n               return;\n            }\n\n            if (currentFile.size === 0 || currentFile.size >\n               this.mksClient.FTUtil.config.maxChunkNum *\n               this.mksClient.FTUtil.config.chunkSize) {\n               $timeout(function() {\n                  currentFile.transferError = true;\n                  fileTester(fileIndex + 1);\n               });\n               return;\n            }\n\n            reader = new FileReader();\n            oneByteBlob = currentFile.slice(0, 1);\n\n            reader.onload = function(evt) {\n               fileTester(fileIndex + 1);\n            };\n\n            reader.onerror = function() {\n               $timeout(function() {\n                  currentFile.transferError = true;\n                  fileTester(fileIndex + 1);\n               });\n            };\n            reader.readAsArrayBuffer(oneByteBlob);\n         };\n\n      fileTester(0);\n   };\n\n   Service.prototype.beginUpload = function() {\n      // Remember call ready before this function\n      let onValidDone = () => {\n         for (let i = 0; i < this.fileList.length; i++) {\n            this.queueFileChunks(this.fileList[i]);\n         }\n\n         if (this.isTransferring === false) {\n            this.isTransferring = true;\n            this.sendNextFileChunks();\n         }\n      };\n\n      this.checkFileValid(this.fileList, onValidDone);\n   };\n\n   Service.prototype.checkUploadStatus = function() {\n      for (let i = 0; i < this.fileList.length; i++) {\n         if (this.fileList[i].transferError === true) {\n            return false;\n         }\n      }\n      return true;\n   };\n\n   Service.prototype.stopFileUpload = function(file) {\n      file.stopTransfer = true;\n      this.removeFileChunksFromQueue(file);\n\n      // If already begin upload, tell mksvchan server to release file\n      if (file.progress !== 0 && file.progress !== 100) {\n         wmksService.stopFileUpload(this.mksClient, file.name,\n            function() {\n               AB.LOGGER.debug(\n                  \"Successfully send cancel upload request.\");\n            });\n      }\n   };\n\n   return {\n      getService: function(mksClient) {\n         if (!mksClient) {\n            AB.LOGGER.error(\"Invalid mksvchan client.\");\n            return null;\n         }\n         return new Service(mksClient);\n      }\n   };\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/filetransfer/file-transfer-upload-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * extended-monitor-service.js -- extendedMonitorService\n *\n * provide data\n * extendedMonitorService\n */\n\nimport JSCDKLogger from '../../../jscdk/jscdkLogger';\n\nexport default function extendedMonitorService($window, $, _) {\n   let getTranslateMap = function() {\n      let keys = [\"MM_WAIT_OTHER_MONITOR_READY\",\n            \"MM_HINT_MOVE\",\n            \"MM_SELECT_MONITOR\",\n            \"MM_QUIT_MULTIMON_T\",\n            \"MM_QUIT_MULTIMON_M\",\n            \"OK\",\n            \"CANCEL\",\n            \"MM_MONITOR_DETECTOR\"\n         ],\n         translationMap = {};\n\n      //user promise if translationService allow.\n      for (let i = 0; i < keys.length; i++) {\n         translationMap[keys[i]] = _(keys[i]);\n      }\n      return translationMap;\n   };\n\n   this.statusMap = {\n      opened: 0,\n      inited: 1,\n      readyToDisplay: 2,\n      displaying: 3,\n      close: -1,\n      confirmedQuit: -2\n   };\n\n   this.wmksSession = null; //TODO: should be set outside\n   this.translationMap = getTranslateMap();\n   this.onMouseButton = function(data) {\n      this.wmksSession.wmksContainer.wmks('sendMouseButtonMessage',\n         data.position,\n         data.isDownEvent, data.bmask);\n      $(document).trigger(\"extendedmonitoruse\");\n   };\n   this.onMouseMove = function(data) {\n      this.wmksSession.wmksContainer.wmks('sendMouseMoveMessage',\n         data.position);\n      $(document).trigger(\"extendedmonitoruse\");\n   };\n   this.onMouseWheel = function(data) {\n      this.wmksSession.wmksContainer.wmks('sendScrollMessage', data.position,\n         data.dx,\n         data.dy);\n      $(document).trigger(\"extendedmonitoruse\");\n   };\n   this.onKeyEvent = function(data) {\n      this.wmksSession.wmksContainer.wmks('sendKeyMessage', data);\n      $(document).trigger(\"extendedmonitoruse\");\n   };\n   this.onBlur = function(data) {\n      JSCDKLogger.debug(\"focus leave extended monitor\");\n      this.wmksSession.wmksContainer.wmks('onBlur');\n      $(document).trigger(\"extendedmonitoruse\");\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/main-page/extended-monitor-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * extended-monitor.js -- ExtendedMonitor\n *\n * Class to control the extended monitor.\n * contained by the model\n *\n * mainly maintain the inner status and response to message and inner data for communication\n *\n * user JSCDKLogger for now later will change when the new logservice is ready\n */\n\nimport JSCDKLogger from '../../../jscdk/jscdkLogger';\n\nexport default function ExtendedMonitor($window, extendedMonitorService,\n   vncDecoder, $timeout) {\n   return function() {\n      /**\n       * @private\n       * @type {boolean}\n       */\n      this.inited = false;\n      this.canRender = false;\n\n      this.origin = \"https://\" + $window.location.hostname;\n\n      this.sendMessage = function(message) {\n         if (!this.inited) {\n            return;\n         }\n         message.uid = this.uid;\n         this.extendedWindow.postMessage(message, this.origin);\n      };\n      this.setStatus = function(status) {\n         this.status = status;\n         this.onStatusChanged(this.id, status);\n      };\n\n      this.initPage = function(data) {\n         this.uid = data.uid;\n         this.sendMessage({\n            type: \"init\",\n            data: {\n               id: this.id,\n               translationMap: extendedMonitorService.translationMap\n            }\n         });\n      };\n\n      this.sendUnmaximizableRegion = function() {\n         this.sendMessage({\n            type: \"updateUnmaxableRegions\",\n            data: {\n               regions: this.unmaximizableRegions\n            }\n         });\n      };\n\n      this.onPostMessage = function(event) {\n         let responseData = event.data,\n            origin = event.origin || event.originalEvent.origin,\n            source = event.source || event.originalEvent.source;\n\n         if (origin !== this.origin || source !== this.extendedWindow) {\n            return;\n         }\n         if (this.uid !== \"\" && responseData.uid !== this.uid) {\n            return;\n         }\n\n         switch (responseData.type) {\n            case \"ready\":\n               this.initPage(responseData);\n               break;\n            case \"initDone\":\n               this.setStatus(extendedMonitorService.statusMap[\"inited\"]);\n               break;\n            case \"setUnmaxableRegion\":\n               this.onRegionUpdated(this.id, responseData.data.region);\n               break;\n            case \"readyToDisplay\":\n               this.onRegionUpdated(this.id, responseData.data.region);\n               this.setStatus(extendedMonitorService.statusMap[\"readyToDisplay\"]);\n               break;\n            case \"close\":\n               this.onRegionUpdated(this.id, null);\n               this.onStatusChanged(this.id, extendedMonitorService.statusMap[\"closed\"]);\n               break;\n            case \"confirmedClose\":\n               this.onStatusChanged(this.id, extendedMonitorService\n                  .statusMap[\"confirmedQuit\"]);\n               break;\n            case \"onBlur\":\n               extendedMonitorService.onBlur();\n               break;\n            case \"keyEvent\":\n               extendedMonitorService.onKeyEvent(responseData.data);\n               break;\n            case \"mouseButton\":\n               extendedMonitorService.onMouseButton(responseData.data);\n               break;\n            case \"mouseWheel\":\n               extendedMonitorService.onMouseWheel(responseData.data);\n               break;\n            case \"mouseMove\":\n               extendedMonitorService.onMouseMove(responseData.data);\n               break;\n            case \"renderingDone\":\n               responseData.renderingIndeces.forEach(item => {\n                  this.onRenderingDone(this.id, item);\n               });\n               break;\n            default:\n               JSCDKLogger.debug(\"unknown message type\", responseData);\n         }\n      }.bind(this);\n      /**\n       * init this instance\n       * @param  {[type]} id              The extended monitor id\n       * @param  {[type]} unmaximizableRegions The regions that don't allow maximize\n       * @param  {[type]} onStatusChanged The callback for monitor status change (id , status)\n       * @param  {[type]} onRegionUpdated The callback for regions changes (id ,data(could be null))\n       */\n      this.init = function(id, unmaximizableRegions, onStatusChanged, onRegionUpdated) {\n         this.id = id;\n         this.unmaximizableRegions = unmaximizableRegions;\n         this.onRegionUpdated = onRegionUpdated;\n         this.onStatusChanged = onStatusChanged;\n         this.status = extendedMonitorService.statusMap[\"opened\"];\n         this.containingMonitor = null;\n         this.uid = \"\";\n         this.extendedWindow = $window.open(\"./app-extended-monitor.html?v=\" + __BUILD_NUMBER__,\n            \"extended_monitor\" + this.id,\n            \"height=300, width=300, status=yes, toolbar=no, menubar=no, location=no\");\n         if (!this.extendedWindow) {\n            console.error(\"failed to open pop up window\");\n            $timeout(function() {\n               this.onStatusChanged(this.id, extendedMonitorService.statusMap[\"closed\"]);\n            }.bind(this));\n            return;\n         }\n         this.extendedWindow.addEventListener(\"message\", this.onPostMessage, false);\n         this.inited = true;\n      };\n\n      /**\n       * This function should be called when other monitor detector found any changes\n       * It will set regions to the all used regions except itself\n       * @param  {object} allUsedRegions The object contains the regeion\n       */\n      this.updateUnmaxizableRegions = function(allUsedRegions) {\n         this.unmaximizableRegions = Object.assign({}, allUsedRegions);\n         delete this.unmaximizableRegions[this.id];\n         this.sendUnmaximizableRegion();\n      };\n\n      /**\n       * should be called when user want to use all monitors\n       * @param  {object} screenBase\n       * @param  {object} screenModel\n       * @param  {function} onRenderingDone\n       */\n      this.startDisplay = function(screenBase, onRenderingDone, screenModel, sizeFactor) {\n         if (this.status !== extendedMonitorService.statusMap[\"readyToDisplay\"]) {\n            JSCDKLogger.debug(\"skip startDisplay since not ready on\" + this.id);\n            return;\n         }\n         this.onRenderingDone = onRenderingDone;\n         this.sendMessage({\n            type: \"startDisplay\",\n            data: {\n               screenBase: screenBase,\n               screenModel: screenModel,\n               sizeFactor: sizeFactor\n            }\n         });\n         this.status = extendedMonitorService.statusMap[\"working\"];\n         this.canRender = true;\n         this.vncRects = [];\n         this.currentFrameId = 0;\n         this.frameWaitTimer = null;\n         this.frameWaitTime = 50;\n      };\n\n      this.appendChange = function(data) {\n         let frameId = data.rect.frameId;\n         if (this.currentFrameId !== frameId) {\n            this.sendDisplayChange();\n            this.currentFrameId = frameId;\n         }\n         this.vncRects.push(data);\n         if (!this.frameWaitTimer) {\n            this.frameWaitTimer = $timeout(this.sendDisplayChange, this.frameWaitTime);\n         }\n      };\n\n      this.sendDisplayChange = function() {\n         if (this.vncRects.length > 0) {\n            if (!!this.extendedWindow) {\n               this.extendedWindow.postMessage({\n                  type: \"display\",\n                  uid: this.uid,\n                  data: this.vncRects\n               }, this.origin);\n            }\n\n            this.vncRects.forEach(item => {\n               vncDecoder.releaseRectData(item);\n            });\n            this.vncRects = [];\n         }\n         if (!!this.frameWaitTimer) {\n            clearTimeout(this.frameWaitTimer);\n            this.frameWaitTimer = null;\n         }\n      }.bind(this);\n\n\n      /**\n       * [onDisplayChanged description]\n       * @param  {[type]} regionData [description]\n       * @return {[type]}            [description]\n       */\n      this.onDisplayChanged = function(rect, renderingIndex) {\n         if (this.status !== extendedMonitorService.statusMap[\"working\"]) {\n            JSCDKLogger.debug(\"skip display since not working on \" + this.id);\n            return;\n         }\n         if (!this.canRender) {\n            JSCDKLogger.trace(\"skip display since extended monitor is busy on \" +\n               this.id);\n            return;\n         }\n\n         this.appendChange({\n            rect: rect,\n            renderingIndex: renderingIndex\n         });\n         rect.skipRelease = true;\n      };\n\n      /**\n       * [onCursorChanged description]\n       * @param  {[type]} cursorAddress [description]\n       * @return {[type]}               [description]\n       */\n      this.onCursorChanged = function(cursorAddress) {\n         if (this.status !== extendedMonitorService.statusMap[\"working\"]) {\n            JSCDKLogger.debug(\"skip changeCursor since not working on \" + this.id);\n            return;\n         }\n         this.sendMessage({\n            type: \"setCursor\",\n            data: {\n               url: cursorAddress\n            }\n         });\n      };\n\n      // double ensurance to close extended window, since chrome has bug sometime\n      this.close = () => {\n         this.canRender = false;\n         this.status = extendedMonitorService.statusMap[\"opened\"];\n         this.extendedWindow.removeEventListener(\"message\", this.onPostMessage, false);\n         $timeout(function() {\n            this.sendMessage({\n               type: \"forcibleClose\"\n            });\n            this.extendedWindow = null;\n            this.inited = false;\n         }.bind(this));\n      };\n\n      this.showDisplay = function() {\n         this.sendMessage({\n            type: \"showDisplay\"\n         });\n      };\n\n      this.hideDisplay = function() {\n         this.sendMessage({\n            type: \"hideDisplay\"\n         });\n      };\n   };\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/main-page/extended-monitor.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport sharedUtil from '../common/module';\nimport primaryMonitorService from './primary-monitor-service';\nimport multimonService from './multimon-service';\nimport multimonModel from './multimon-model';\nimport monitorManageService from './monitor-manage-service';\nimport extendedMonitorService from './extended-monitor-service';\nimport ExtendedMonitor from './extended-monitor';\nimport multimonRenderingService from './multimon-rendering-service';\n\nexport default angular.module('com.vmware.vdi.htmlaccess.desktop.multimon',\n   [sharedUtil])\n   .service(\"primaryMonitorService\", [\"jQuery\",\n      \"$window\",\n      \"$timeout\",\n      \"fullscreenService\",\n      \"wmksBaseService\",\n      \"vncDecoder\",\n      \"normalizationService\",\n      primaryMonitorService\n   ])\n   .service(\"multimonService\", [\"monitorManageService\",\n      \"multimonModel\",\n      \"dialogService\",\n      \"$timeout\",\n      \"translate\",\n      multimonService\n   ])\n   .service(\"multimonModel\", [\"ExtendedMonitor\",\n      \"primaryMonitorService\",\n      multimonModel\n   ])\n   .service(\"monitorManageService\", [\"$timeout\",\n      \"$window\",\n      \"$rootScope\",\n      \"multimonModel\",\n      \"extendedMonitorService\",\n      \"normalizationService\",\n      \"dialogService\",\n      \"vncDecoder\",\n      \"renderCacheService\",\n      \"translate\",\n      monitorManageService\n   ])\n   .service(\"multimonRenderingService\", [\"monitorManageService\",\n      multimonRenderingService\n   ])\n   .service(\"extendedMonitorService\", [\"$window\", \"jQuery\", \"translate\",\n      extendedMonitorService\n   ])\n   .service(\"ExtendedMonitor\", [\"$window\", \"extendedMonitorService\",\n      \"vncDecoder\", \"$timeout\",\n      ExtendedMonitor\n   ])\n   .name;\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/main-page/module.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * monitor-manage-service.js -- monitorManageService\n *\n * service to control all monitors for multimon.\n * service to bound events to update the model\n *\n * entermultimon, will always call addMonitor, PrimaryMonitor.enable, bound\n * events\n */\n// step: switchToMultiMonitor, addMonitor\n\nimport $ from 'jquery';\nimport JSCDKLogger from '../../../jscdk/jscdkLogger';\n\nexport default function monitorManageService($timeout, $window, $rootScope,\n   multimonModel,\n   extendedMonitorService,\n   normalizationService,\n   dialogService, vncDecoder,\n   renderCacheService, _) {\n   this.canvasBuffer = null;\n   this.canvasContainer = document.getElementById('canvas-container');\n   this.quitConfirmDialog = null;\n   this.renderingList = {\n      0: {}\n   };\n   this.renderingCallback = {};\n   this.renderingIndex = 0;\n   this.monitorBounds = null;\n   this.caches = [];\n   this._cacheInited = false;\n   this._isDisplaying = false;\n   this._isH264Enabled = false;\n   this._activeBackground = null;\n   /**\n    * MutationObserver is defined as in\n    * https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver\n    */\n   this.cursorObserver = new MutationObserver(function(mutations) {\n      mutations.forEach(function(mutationRecord) {\n         $timeout(function() {\n            $(window).trigger(\"CursorChanged\");\n         });\n      });\n   });\n\n   this.setMonitorBounds = function() {\n      let baseX = multimonModel.monitorSettings.baseX,\n         baseY = multimonModel.monitorSettings.baseY;\n\n      this.monitorBounds = {};\n      multimonModel.forEachSettings(function(key, setting) {\n         this.monitorBounds[key] = {\n            x: baseX + setting.x,\n            y: baseY + setting.y,\n            width: setting.width,\n            height: setting.height\n         };\n      }.bind(this));\n   };\n\n   this.clearRenderStatus = function() {\n      let key;\n      for (key in this.renderingList) {\n         if (this.renderingList.hasOwnProperty(key) &&\n            JSON.stringify(this.renderingList[key]) !== \"{}\") {\n            this.renderingCallback[key].onDone();\n         }\n      }\n      this.renderingList = {\n         0: {}\n      };\n      this.renderingCallback = {};\n      this.renderingIndex = 0;\n   };\n\n   /**\n    * Uses the overall decoding delay, which might bring down the fps, but\n    *    should be more stable\n    * @param  {number} monitorIndex The index of monitor\n    * @param  {number} frameIndex   The index of rendered frame\n    * @param  {number} decodeStart  The start time of rendering\n    */\n   this.onRenderingDone = function(monitorIndex, frameIndex) {\n      if (!this.renderingList[frameIndex] || !this.renderingCallback[frameIndex]) {\n         JSCDKLogger.debug(\"can't finish rendering twice for index: \" + frameIndex);\n         return;\n      }\n      delete this.renderingList[frameIndex][monitorIndex];\n      if (JSON.stringify(this.renderingList[frameIndex]) === \"{}\") {\n         this.renderingCallback[frameIndex].onDone();\n         delete this.renderingList[frameIndex];\n         delete this.renderingCallback[frameIndex];\n      }\n   }.bind(this);\n\n   this.onCursorChanged = function() {\n      let cursorAddress = $(this._activeBackground).css(\"cursor\"),\n         key;\n\n      // dispatch to all monitors.\n      for (key in multimonModel.monitors) {\n         if (multimonModel.monitors.hasOwnProperty(key)) {\n            multimonModel.monitors[key].onCursorChanged(cursorAddress);\n         }\n      }\n   }.bind(this);\n\n   this.isOutsideBound = function(x, y, width, height, bound) {\n      return x < bound.x || x + width > bound.x + bound.width ||\n         y < bound.y || y + height > bound.y + bound.height;\n   };\n\n   /**\n    * Return whether a package should be dispatch to monitor with key as index\n    * dispatching EOF to all monitors to ensure all monitors are responding\n    * and able to deal with comming frames\n    *\n    * extra logic for frame buffer cache\n    */\n   this.shouldDispatch = function(rect, key) {\n      let rectWidth = rect.width || (!!rect.image && rect.image.width),\n         rectHeight = rect.height || (!!rect.image && rect.image.height);\n\n      // dispatch message to all monitors when init cache\n      if (rect.encoding === vncDecoder.encodingTypes[\"encUpdateCache\"] &&\n         rect.opcode === renderCacheService.cacheOperationType[\"updateCacheOpInit\"]) {\n         return true;\n      }\n      if (!this.monitorBounds || !this.monitorBounds.hasOwnProperty(key)) {\n         JSCDKLogger.error(\"wrong status in the monitorBounds\");\n         return false;\n      }\n      if (this.isOutsideBound(rect.x, rect.y, rectWidth, rectHeight,\n            this.monitorBounds[key])) {\n         return false;\n      }\n      if (!!rect.srcX && !!rect.srcY && this.isOutsideBound(rect.srcX,\n            rect.srcY, rectWidth, rectHeight, this.monitorBounds[key])) {\n         JSCDKLogger.debug(\"cross monitor move detected\");\n         return false;\n      }\n      return true;\n   };\n\n   this.initImageBuffer = function() {\n      this.canvasContainer.style.height = \"1px\"; //TODO\n      this.canvasContainer.style.width = \"1px\";\n\n      this.sessionContainer = multimonModel.sessionContainer;\n      this.sessionContainer.style.display = \"none\";\n      let backgroundCanvas = $(this.sessionContainer).children(\"#mainCanvas\")[0];\n      let backgroundVideo = $(this.sessionContainer).children(\"video\")[0];\n      /**\n       * Don't use this._isH264Enabled for now, since current wmks design allows\n       * inconsistent between settings and real working mode, but still keep the\n       * mode info for feature usage.\n       */\n      if (!!backgroundVideo) {\n         this._activeBackground = backgroundVideo;\n      } else {\n         this._activeBackground = backgroundCanvas;\n      }\n      this.canvasBuffer = backgroundCanvas.getContext('2d');\n      $(window).off(\"CursorChanged\");\n      $(window).on(\"CursorChanged\", this.onCursorChanged);\n   };\n\n   this.clearImageBuffer = function() {\n      this.canvasContainer.style.height = \"100%\";\n      this.canvasContainer.style.width = \"100%\";\n      if (!!this._activeBackground) {\n         this._activeBackground.style.display = \"none\";\n         let switchDelay = 2000;\n         $timeout( () => {\n            this._activeBackground.style.display = \"\";\n            this._activeBackground = null;\n         }, switchDelay);\n      }\n      if (!!this.sessionContainer) {\n         this.sessionContainer.style.display = \"\";\n         this.sessionContainer = null;\n      }\n      this.canvasBuffer = null;\n      $(window).off(\"CursorChanged\", this.onCursorChanged);\n   };\n\n   /**\n    * This release will always fire onSingleMonitor and onQuitMultimon at the\n    * same time, but later will be different, user will be allow to adjust the\n    * displayers\n    * @param  {object} wmksSession     The wmks session object\n    * @param  {object} sessionContainer The DOM that contains the blast session\n    * @param  {function} onQuitMultimon The callback when quit multimon mode, but still in the config phase\n    * @param  {function} onEnterMultimon The callback when leave config phase and enter multimon\n    * @param  {function} onSingleMonitor The callback when switch back to single monitor mode\n    */\n   this.switchToMultiMonitor = function(wmksSession, sessionContainer, onQuitMultimon,\n      onEnterMultimon, onSingleMonitor, onMultiMonitor, onTopologyChanged,\n      onMonitorChanged, options) {\n      multimonModel.init(wmksSession, sessionContainer);\n      extendedMonitorService.wmksSession = wmksSession;\n      this.onSingleMonitor = onSingleMonitor;\n      this.onEnterMultimon = onEnterMultimon;\n      this.onMultiMonitor = onMultiMonitor;\n      this.onQuitMultimon = onQuitMultimon;\n      this.onTopologyChanged = onTopologyChanged;\n      this.onMonitorChanged = onMonitorChanged;\n      multimonModel.primaryMonitor.init(this.onRegionUpdated);\n      // pop out first detector\n      this.addMonitor();\n      $window.addEventListener(\"beforeunload\", this.switchToSingleMonitor);\n      $rootScope.$on('$locationChangeStart', this.onLocationChanged);\n      this.renderingList = {\n         0: {}\n      };\n      this.renderingIndex = 0;\n      this.caches = [];\n      if (!!options) {\n         this._isH264Enabled = options.enableH264;\n      }\n   };\n\n   this.onLocationChanged = function(event, next, current) {\n      if (current.indexOf('#/desktop') !== -1 &&\n         next.indexOf('#/desktop') === -1) {\n         this.switchToSingleMonitor();\n      }\n   }.bind(this);\n\n   this.switchToSingleMonitor = function() {\n      let key;\n      //close all extended\n      for (key in multimonModel.monitors) {\n         if (multimonModel.monitors.hasOwnProperty(key) &&\n            typeof multimonModel.monitors[key].close === \"function\") {\n            multimonModel.monitors[key].close();\n         }\n      }\n      //then quitMultimonMode should be called\n      this.quitMultimonMode();\n      $window.removeEventListener(\"beforeunload\", this.switchToSingleMonitor);\n      if (!!$rootScope && typeof $rootScope.$off === 'function') {\n         $rootScope.$off('$locationChangeStart', this.onLocationChanged);\n      }\n      if (!!this.quitConfirmDialog) {\n         this.quitConfirmDialog.close();\n         this.quitConfirmDialog = null;\n      }\n   }.bind(this);\n\n   this.startSpyCursor = function() {\n      this.cursorObserver.observe(this._activeBackground, {\n         attributes: true,\n         attributeFilter: ['style']\n      });\n   };\n   this.stopSpyCursor = function() {\n      this.cursorObserver.disconnect();\n   };\n   /**\n    * @private\n    * @return {[type]} [description]\n    */\n   this.quitMultimonMode = function() {\n      multimonModel.usingMultimon = false;\n      this._cacheInited = false;\n      this.monitorBounds = null;\n      JSCDKLogger.log(\"quit multimon mode\");\n      this.stopSpyCursor();\n      multimonModel.primaryMonitor.disable();\n      this.clearImageBuffer();\n      this.clearRenderStatus();\n      multimonModel.clear();\n      normalizationService.clear();\n      this.onQuitMultimon();\n      this.onSingleMonitor();\n   };\n\n   /**\n    * @return {[type]} [description]\n    */\n   this.addMonitor = function() {\n      multimonModel.addMonitor(this.onStatusChanged, this.onRegionUpdated);\n   };\n\n   this.keepInMultimon = function() {\n      multimonModel.usingMultimon = true;\n      multimonModel.updateSettings();\n      multimonModel.primaryMonitor.enterFullscreen();\n      this.onEnterMultimon();\n   };\n\n   /**\n    * Don't allow to close dialog by esc since this dialog can be triggered\n    *    by it.\n    */\n   this.onPrimaryMonitorQuit = cancelAsDefault => {\n      if (!!this.quitConfirmDialog) {\n         return;\n      }\n      $timeout(() => {\n         let setting = {\n            data: {\n               title: _('MM_QUIT_MULTIMON_T'),\n               message: _('MM_QUIT_MULTIMON_M'),\n               buttonLabelConfirm: _('YES'),\n               buttonLabelCancel: _('CANCEL')\n            },\n            showClose: false,\n            closeByEscape: false,\n            closeByDocument: false,\n            controller: ['$scope', $scope => {\n               $scope.confirm = () => {\n                  this.switchToSingleMonitor();\n                  if (!this.quitConfirmDialog) {\n                     return;\n                  }\n                  this.quitConfirmDialog.close();\n                  this.quitConfirmDialog = null;\n               };\n               $scope.close = () => {\n                  this.keepInMultimon();\n                  if (!this.quitConfirmDialog) {\n                     return;\n                  }\n                  this.quitConfirmDialog.close();\n                  this.quitConfirmDialog = null;\n               };\n            }]\n         };\n         if (cancelAsDefault) {\n            this.quitConfirmDialog = dialogService.confirmWithCancelAsDefault(setting);\n         } else {\n            this.quitConfirmDialog = dialogService.confirm(setting);\n         }\n      });\n   };\n\n   /**\n    * @private\n    * @return {[type]} [description]\n    */\n   this.enterMultimonMode = function() {\n      let key,\n         sizeFactor,\n         alreadyEnter = false;\n\n      multimonModel.usingMultimon = true;\n      JSCDKLogger.log(\"enter multimon mode\");\n      multimonModel.primaryMonitor.enable(multimonModel.wmksSession,\n         function() {\n            let screenBase,\n               screenModels;\n\n            multimonModel.monitorSettings[0] =\n               multimonModel.primaryMonitor.getSetting();\n            normalizationService.setRawSetting('0', multimonModel.monitorSettings[0]);\n            if (!alreadyEnter && normalizationService.isScaleMismatched()) {\n               $timeout(function(){\n                  dialogService.error({\n                     data: {\n                        title: _('WARNING'),\n                        errorMessage: _('MM_MOUSE_MISMATCH_WARN_M')\n                     }\n                  });\n               });\n            }\n            alreadyEnter = true;\n            normalizationService.calculate();\n            multimonModel.monitorSettings = normalizationService.getNormalizedSettings();\n            multimonModel.updateSettings();\n            screenBase = {\n               x: multimonModel.monitorSettings.baseX,\n               y: multimonModel.monitorSettings.baseY\n            };\n            screenModels = normalizationService.getNormalizationModel();\n            sizeFactor = normalizationService.getSizeFactor(0);\n            multimonModel.primaryMonitor.setScreenBase(screenBase);\n            multimonModel.primaryMonitor.setScreenModel(screenModels[0]);\n            multimonModel.primaryMonitor.onDPISettingChanged(sizeFactor);\n            multimonModel.primaryMonitor.initScreen();\n            this.onTopologyChanged();\n            this.setMonitorBounds();\n            this._isDisplaying = true;\n            $timeout(function() {\n               this.onMultiMonitor();\n               this.initImageBuffer();\n               this.startSpyCursor();\n               for (key in multimonModel.monitors) {\n                  if (multimonModel.monitors.hasOwnProperty(key) &&\n                     key !== \"0\") {\n                     sizeFactor = normalizationService.getSizeFactor(key);\n                     multimonModel.monitors[key].startDisplay(screenBase,\n                        this.onRenderingDone, screenModels[key], sizeFactor);\n                  }\n               }\n            }.bind(this));\n         }.bind(this), this.onPrimaryMonitorQuit, this.onRenderingDone);\n      this.onEnterMultimon();\n   };\n\n   this.readyToEnterMultimon = function() {\n      let key,\n         isNotEmpty = false;\n\n      for (key in multimonModel.monitors) {\n         if (multimonModel.monitors.hasOwnProperty(key) &&\n            key !== \"0\") {\n            isNotEmpty = true;\n            if (multimonModel.monitors[key].status !==\n               extendedMonitorService.statusMap[\"readyToDisplay\"] &&\n               multimonModel.monitors[key].status !==\n               extendedMonitorService.statusMap[\"working\"]) {\n               return false;\n            }\n         }\n      }\n      return isNotEmpty;\n   };\n\n   this.getMonitorInfo = function() {\n      let key,\n         monitorInfo = {};\n\n      for (key in multimonModel.monitors) {\n         if (multimonModel.monitors.hasOwnProperty(key)) {\n            monitorInfo[key] = {\n               settings: multimonModel.monitorSettings[key],\n               ready: multimonModel.monitors[key].status ===\n                  extendedMonitorService.statusMap[\"readyToDisplay\"]\n            };\n         }\n      }\n      return monitorInfo;\n   };\n\n   this.onStatusChanged = function(id, status) {\n      switch (status) {\n         case (extendedMonitorService.statusMap[\"inited\"]):\n            multimonModel.monitors[id].updateUnmaxizableRegions(\n               multimonModel.monitorSettings);\n            //TODO: if back from fullsreen mode need to do more action here to\n            // support hot switch after Q1\n            break;\n         case (extendedMonitorService.statusMap[\"readyToDisplay\"]):\n            this.onMonitorChanged(this.getMonitorInfo(),\n               this.readyToEnterMultimon());\n            break;\n         case (extendedMonitorService.statusMap[\"closed\"]):\n            this.onRegionUpdated(id, null);\n            multimonModel.updateSettings();\n            if (multimonModel.usingMultimon) {\n               if (multimonModel.monitorCount === 1) {\n                  this.switchToSingleMonitor();\n               } else {\n                  this.onTopologyChanged();\n               }\n            }\n            break;\n         case (extendedMonitorService.statusMap[\"confirmedQuit\"]):\n            this.switchToSingleMonitor();\n            break;\n      }\n   }.bind(this);\n\n   this.onRegionUpdated = function(id, value, stillUpdating) {\n      let monitorCount = 0,\n         key,\n         monitorSettings = multimonModel.monitorSettings;\n\n      if (!value) {\n         delete monitorSettings[id];\n         delete multimonModel.monitors[id];\n         normalizationService.removeRawSetting(id);\n      } else { //update/add\n         monitorSettings[id] = value;\n         normalizationService.setRawSetting(id, value);\n      }\n      for (key in multimonModel.monitors) {\n         if (multimonModel.monitors.hasOwnProperty(key)) {\n            monitorCount++;\n            if (key !== id.toString()) {\n               multimonModel.monitors[key].updateUnmaxizableRegions(monitorSettings);\n            }\n         }\n      }\n      multimonModel.monitorCount = monitorCount;\n      this.onMonitorChanged(this.getMonitorInfo(), this.readyToEnterMultimon(),\n         stillUpdating);\n   }.bind(this);\n\n   this.renderingNext = function() {\n      this.renderingIndex++;\n      if (this.renderingIndex === Number.MAX_SAFE_INTEGER) {\n         this.renderingIndex = 0;\n      }\n   };\n\n   this._hideDisplay = function(){\n      if(this._isDisplaying){\n         Object.entries(multimonModel.monitors).forEach(([key, item]) => {\n            item.hideDisplay();\n         });\n         this._isDisplaying = false;\n      }\n   };\n\n   /**\n    * During prepare of renderring, we better hide the screen\n    */\n   this._showDisplay = function() {\n      let prepareTimeEstimation = 500;\n      if (!this._isDisplaying) {\n         $timeout( () => {\n            Object.entries(multimonModel.monitors).forEach(([key, item]) => {\n               item.showDisplay();\n            });\n         }, prepareTimeEstimation);\n         this._isDisplaying = true;\n      }\n   };\n\n   this.rectStream = {\n      appendData: function(data, onDone, onError) {\n         let rect = data.data,\n            key = 0,\n            monitorSettings = multimonModel.monitorSettings,\n            dispatchCount = 0,\n            i;\n\n         if (rect.encoding === vncDecoder.encodingTypes[\"encUpdateCache\"]) {\n            if (rect.opcode === renderCacheService.cacheOperationType[\"updateCacheOpInit\"]) {\n               this._cacheInited = true;\n               this._showDisplay();\n            }\n            if (!this._cacheInited) {\n               JSCDKLogger.trace(\"receive a cache rect during switching\");\n               this._hideDisplay();\n               onDone();\n               return;\n            }\n         }\n         rect.frameId = data.frameId;\n         this.renderingList[this.renderingIndex] = {};\n         this.renderingCallback[this.renderingIndex] = {\n            onDone: onDone,\n            onError: onError\n         };\n\n         if (rect.opcode ===\n            renderCacheService.cacheOperationType[\"updateCacheOpBegin\"]) {\n            if (this.caches.length !== 0) {\n               JSCDKLogger.debug(\"cache begin from a wrong place\");\n               onError();\n            }\n            this.caches[0] = {\n               rect: rect,\n               renderingIndex: this.renderingIndex\n            };\n            this.renderingNext();\n            return;\n         } else if (this.caches.length > 0 && rect.opcode !==\n            renderCacheService.cacheOperationType[\"updateCacheOpEnd\"]) {\n            this.caches.push({\n               rect: rect,\n               renderingIndex: this.renderingIndex\n            });\n            this.renderingNext();\n            return;\n         }\n         // dispatch to all valid monitors.\n         for (key in multimonModel.monitors) {\n            if (multimonModel.monitors.hasOwnProperty(key)) {\n               if (this.shouldDispatch(rect, key)) {\n                  this.renderingList[this.renderingIndex][key] = true;\n                  if (rect.opcode ===\n                     renderCacheService.cacheOperationType[\"updateCacheOpEnd\"]) {\n                     if (this.caches.length === 0) {\n                        JSCDKLogger.debug(\"cache end to a wrong place\");\n                        onError();\n                     }\n                     for (i = 0; i < this.caches.length; i++) {\n                        multimonModel.monitors[key].onDisplayChanged(\n                           this.caches[i].rect, this.caches[i].renderingIndex);\n                     }\n                     this.caches = [];\n                  }\n                  multimonModel.monitors[key].onDisplayChanged(rect,\n                     this.renderingIndex);\n                  dispatchCount++;\n               }\n            }\n         }\n         if (rect.opcode !==\n            renderCacheService.cacheOperationType[\"updateCacheOpEnd\"] &&\n            !rect.skipRelease) {\n            vncDecoder.releaseRectData(rect);\n         }\n         if (dispatchCount === 0) {\n            JSCDKLogger.debug(\"A rectangle is not dispatched to any monitor!\");\n            onError();\n            delete this.renderingList[this.renderingIndex];\n            delete this.renderingCallback[this.renderingIndex];\n         }\n         this.renderingNext();\n      }.bind(this)\n   };\n\n   this.h264Stream = {\n      //TODO: dispach enable H264/disable H264 to show/hide elements\n      init: function(key, onDecodeComplete, onDecodeMP4Error) {\n         // do nothing right now.\n      },\n      appendData: function(key, data, onDecodeComplete, onDecodeMP4Error) {\n         // do nothing right now.\n      }\n   };\n\n   this.reset = function() {\n      // do nothing right now.\n   };\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/main-page/monitor-manage-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * multimon-model.js -- multimonModel\n *\n * module to hold all multimon related informations, mainly for sync them before\n * working\n */\n\nexport default function multimonModel(ExtendedMonitor, primaryMonitorService) {\n   let idCounter;\n\n   this.init = function(wmksSession, sessionContainer) {\n      this.primaryMonitor = primaryMonitorService;\n      idCounter = 1;\n      this.monitors = {};\n      this.monitors[0] = this.primaryMonitor;\n      this.monitorCount = 1; //TODO\n      this.monitorSettings = {};\n      this.usingMultimon = false;\n      this.wmksSession = wmksSession;\n      this.sessionContainer = sessionContainer;\n   };\n\n   this.clear = function() {\n      idCounter = 0;\n      this.monitors = {};\n      this.monitorCount = 0; //TODO\n      this.monitorSettings = {};\n      this.usingMultimon = false;\n      this.wmksSession = null;\n      this.sessionContainer = null;\n   };\n\n   this.addMonitor = function(onStatusChanged, onRegionUpdated) {\n      let id = idCounter.toString(),\n         extendedMonitor = new ExtendedMonitor();\n\n      extendedMonitor.init(id, this.monitorSettings, onStatusChanged,\n         onRegionUpdated);\n      this.monitors[id] = extendedMonitor;\n      this.monitorCount++;\n      idCounter++;\n   };\n\n   /**\n    * Set the baseX and baseY based on the current settings, which are both\n    * defined as -min(.) corresponding to the agent buffer settings.\n    *\n    * p.s. the agent buffer setting will not contains the positive offset\n    * also, so change max(0, -min(.)) to -min(.), and default as 0\n    */\n   this.updateSettings = function() {\n      let minX = NaN,\n         minY = NaN;\n\n      this.forEachSettings(function(key, setting) {\n         if (isNaN(minX) && isNaN(minY)) {\n            minX = setting.x;\n            minY = setting.y;\n         } else {\n            minX = Math.min(minX, setting.x);\n            minY = Math.min(minY, setting.y);\n         }\n      });\n      if (isNaN(minX)) {\n         minX = 0;\n      }\n      if (isNaN(minY)) {\n         minY = 0;\n      }\n      this.monitorSettings.baseX = -minX;\n      this.monitorSettings.baseY = -minY;\n   };\n\n   /**\n    * forEachSettings\n    * @param  {function} processFunction The function will be called for\n    *    each key setting pair\n    */\n   this.forEachSettings = function(processFunction) {\n      let key;\n\n      for (key in this.monitorSettings) {\n         if (this.monitorSettings.hasOwnProperty(key) &&\n            typeof this.monitorSettings[key] === 'object') {\n            processFunction(key, this.monitorSettings[key]);\n         }\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/main-page/multimon-model.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * multimon-rendering-service.js -- multimonRenderingService\n *\n * The API service of multimon to pass into the wmks.\n */\n\nexport default function multimonRenderingService(monitorManageService) {\n   this.reset = monitorManageService.reset;\n   this.onInit = function(type, param, onSuccess, onError) {\n      monitorManageService.h264Stream.init(param.streamId, onSuccess, onError);\n   };\n   this.onData = function(type, param, onSuccess, onError) {\n      if (type === \"mp4\") {\n         monitorManageService.h264Stream.appendData(param.streamId, param.data,\n            onSuccess, onError);\n      } else {\n         this.onRectData = monitorManageService.rectStream.appendData(param,\n            onSuccess, onError);\n      }\n   };\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/main-page/multimon-rendering-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * multimon-service.js -- multimonService\n *\n * The top level service of multimon which provide 2 APIs:\n *  - addMonitor\n *  - switchToSingleMon\n */\n\nimport JSCDKLogger from '../../../jscdk/jscdkLogger';\n\nexport default function multimonService(monitorManageService, multimonModel,\n   dialogService, $timeout, _) {\n   let onQuitUICallback = null;\n   this.onTopologyChanged = () => {\n      /*if(!settings valid) {\n       return;\n       }*/\n      //TODO, to support ad hoc monitor modify, need to add code here\n      this.sendTopologyRequest();\n   };\n\n   this.onQuitMultimon = () => {\n      JSCDKLogger.info(\"quit multimon\");\n      // clear hint here if PM want to\n      this.uiCallback(\"onQuitMultimon\");\n   };\n\n   this.onEnterMultimon = () => {\n      JSCDKLogger.info(\"enter multimon\");\n      // pop out hint here if PM want to\n      this.closeSidebar();\n      this.uiCallback(\"onEnterMultimon\");\n   };\n\n   this.onSingleMonitor = () => {\n      this.handleResize();\n      this.uiCallback(\"onSingleMonitor\");\n      if (!!onQuitUICallback) {\n         onQuitUICallback();\n         onQuitUICallback = null;\n      }\n   };\n\n   this.onMultiMonitor = () => {\n      this.uiCallback(\"onMultiMonitor\");\n   };\n\n   this.onMonitorChanged = (settings, allReady, stillUpdating) => {\n      JSCDKLogger.debug(\"monitor status changed\");\n      this.uiCallback(\"onMonitorChanged\", {\n         settings: settings,\n         allReady: allReady,\n         stillUpdating: !!stillUpdating\n      });\n   };\n\n   this.switchToMultimon = function(wmksSession, sessionContainer, uiCallback,\n      closeSidebar, handleResize, options) {\n      if (!!multimonModel.wmksSession) {\n         return;\n      }\n      this.closeSidebar = closeSidebar;\n      this.uiCallback = uiCallback;\n      this.handleResize = handleResize;\n      monitorManageService.switchToMultiMonitor(wmksSession, sessionContainer,\n         this.onQuitMultimon, this.onEnterMultimon, this.onSingleMonitor,\n         this.onMultiMonitor, this.onTopologyChanged, this.onMonitorChanged,\n         options);\n      onQuitUICallback = null;\n   };\n\n   this.sendTopologyRequest = function() {\n      let monitorSettings = multimonModel.monitorSettings,\n         topologySettings = [],\n         session = multimonModel.wmksSession;\n\n      if (!session) {\n         return;\n      }\n\n      // we can round the settings here.\n      JSCDKLogger.info(\"set displayer settings to \" + JSON.stringify(monitorSettings));\n\n      multimonModel.forEachSettings(function(key, setting) {\n         topologySettings.push({\n            requestedWidth: setting.width,\n            requestedHeight: setting.height,\n            left: setting.x,\n            top: setting.y\n         });\n      });\n      session.wmksContainer.wmks('updateTopology', topologySettings, true);\n   };\n\n   this.switchToSingleMon = function(wmksSession) {\n      if (!multimonModel.wmksSession ||\n         wmksSession !== multimonModel.wmksSession) {\n         return;\n      }\n      monitorManageService.switchToSingleMonitor();\n   };\n\n   this.destroyMultimon = function() {\n      if (!multimonModel.wmksSession) {\n         return;\n      }\n      monitorManageService.switchToSingleMonitor();\n   };\n\n   this.addMonitor = function(wmksSession, sessionContainer, uiCallback,\n      closeSidebar, handleResize, options) {\n      if (!multimonModel.wmksSession) {\n         this.switchToMultimon(wmksSession, sessionContainer, uiCallback,\n            closeSidebar, handleResize, options);\n      } else if (wmksSession === multimonModel.wmksSession) {\n         monitorManageService.addMonitor();\n      }\n   };\n\n   this.whenNotInMultimon = function(processingFunction) {\n      if (!multimonModel.wmksSession) {\n         processingFunction();\n         return;\n      }\n      let dialog = dialogService.confirm({\n         data: {\n            title: _('MM_QUIT_MULTIMON_T'),\n            message: _('MM_QUIT_MULTIMON_M')\n         },\n         controller: ['$scope', function($scope) {\n            $scope.confirm = function() {\n               onQuitUICallback = function() {\n                  $timeout(processingFunction);\n               };\n               monitorManageService.switchToSingleMonitor();\n               dialog.close();\n            };\n            $scope.close = function() {\n               JSCDKLogger.debug(\"cancel action to continue use multimon\");\n               dialog.close();\n            };\n         }]\n      });\n   };\n\n   /**\n    * Return the multimon using session\n    * @return {string} return null if no session is using multimon\n    */\n   this.getMultimonSession = function() {\n      if (!multimonModel.usingMultimon) {\n         return null;\n      }\n      return multimonModel.wmksSession;\n   };\n\n   /**\n    * Enter the multimon mode\n    */\n   this.enterMultimonMode = function() {\n      if (!multimonModel.usingMultimon) {\n         monitorManageService.enterMultimonMode();\n      }\n   };\n}\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/main-page/multimon-service.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * primary-monitor-service.js -- primaryMonitorService\n *\n * service to control the primary monitor.\n * will write data into the model\n *\n *\n * in the detect mode, dispatch all events to other windows using model\n */\n\nimport JSCDKLogger from '../../../jscdk/jscdkLogger';\n\nexport default function primaryMonitorService($, $window, $timeout, fullscreenService,\n                                              wmksBaseService, vncDecoder, normalizationService) {\n   this.enabled = false;\n   this.primaryCanvas = null;\n   this.canvasContent = null;\n   this.offset = null;\n   this.conflictEventTime = 0;\n   this.browserSizeFactor = 1;\n   /**\n    * @private\n    * A number indicate the button status, and 0 represent no\n    * button is being pressed.\n    */\n   this.buttonStatus = 0;\n\n   /**\n    * factor might be dpi_b or dpi_a*dpi_b\n    * @param  {[type]} factor [description]\n    * @return {[type]}        [description]\n    */\n   this.onDPISettingChanged = function(factor){\n      this.browserSizeFactor = factor;\n      if (this.primaryCanvas.width !== screen.width * this.browserSizeFactor ||\n         this.primaryCanvas.height !== screen.height * this.browserSizeFactor)\n      {\n         this.primaryCanvas.width = screen.width * this.browserSizeFactor;\n         this.primaryCanvas.height = screen.height * this.browserSizeFactor;\n         vncDecoder.onDPIChanged(this.primaryCanvas);\n      }\n   };\n\n   /**\n    * @private\n    * @param  {[type]} wmksSession [description]\n    * @return {[type]}             [description]\n    */\n   this.createPrimaryCanvas = function(wmksSession) {\n      let primaryCanvas,\n         canvasContainner;\n\n      canvasContainner = document.getElementById(\"canvas-container\");\n      primaryCanvas = document.createElement('canvas');\n      primaryCanvas.id = 'primary-monitor';\n      primaryCanvas.width = screen.width * this.browserSizeFactor;\n      primaryCanvas.height = screen.height * this.browserSizeFactor;\n      primaryCanvas.style.width = screen.width + \"px\";\n      primaryCanvas.style.height = screen.height + \"px\";\n      primaryCanvas.style.zIndex = 8;\n      canvasContainner.appendChild(primaryCanvas);\n      primaryCanvas.oncontextmenu = function(e) {\n         e.preventDefault();\n      };\n      /**\n       * Detect on document instead of canvas to resolve drag outside the\n       * browser issue for mousemove and mouseup;\n       * Since only bind part of event on to document looks wired, bound all\n       * onto it, and disable the default wmks handling to avoid bugs caused\n       * by conflicts.\n       */\n      this.wmksSession = wmksSession;\n      $(document).on(\"mousemove\", this.onMouseMove);\n      $(document).on(\"mousedown\", this.onMouseDown);\n      $(document).on(\"mouseup\", this.onMouseUp);\n      $(document).on(\"mousewheel\", this.onMouseWheel);\n      $(canvasContainner).on(\"keyup\", this.onKeyUp);\n      $(canvasContainner).on(\"keydown\", this.onKeyDown);\n      $(canvasContainner).on(\"keypress\", this.onKeyPress);\n      $(window).on(\"blur\", this.onBlur);\n      this.primaryCanvas = primaryCanvas;\n      this.buttonStatus = 0;\n      vncDecoder.setCanvas(primaryCanvas);\n   };\n\n   /**\n    * @private\n    * @param  {object} event\n    */\n   this.isPrimaryCanvasEvent = function(event) {\n      let evt = event || window.event;\n      let element = evt.target || evt.srcElement;\n      // Allow drag through the sidebar or panels.\n      if (this.buttonStatus !== 0) {\n         return true;\n      } else {\n         return element === this.primaryCanvas;\n      }\n   };\n\n   /**\n    * @private\n    * @param  {object} event\n    */\n   this.onBlur = function(event) {\n      JSCDKLogger.debug(\"focus leave primary monitor\");\n      this.buttonStatus = 0;\n      this.wmksSession.wmksContainer.wmks(\"onBlur\");\n      $(document).trigger(\"primarymonitoruse\");\n   }.bind(this);\n\n   /**\n    * @private\n    * @param  {object} event\n    */\n   this.onMouseMove = function(event) {\n      let position;\n\n      if (this.isPrimaryCanvasEvent()) {\n         position = wmksBaseService.getEventPosition(event, this.offset);\n         this.wmksSession.wmksContainer.wmks('sendMouseMoveMessage', position);\n      }\n      $(document).trigger(\"primarymonitoruse\");\n   }.bind(this);\n\n   /**\n    * @private\n    * @param  {object} event\n    */\n   this.onMouseDown = function(event) {\n      let position;\n\n      if (this.isPrimaryCanvasEvent()) {\n         position = wmksBaseService.getEventPosition(event, this.offset);\n         this.wmksSession.wmksContainer.wmks('sendMouseButtonMessage', position,\n            1, 1 << event.button);\n         this.buttonStatus |= 1 << event.button;\n      }\n      $(document).trigger(\"primarymonitoruse\");\n   }.bind(this);\n\n   /**\n    * @private\n    * @param  {object} event\n    */\n   this.onMouseUp = function(event) {\n      let position;\n\n      if (this.isPrimaryCanvasEvent()) {\n         position = wmksBaseService.getEventPosition(event, this.offset);\n         this.wmksSession.wmksContainer.wmks('sendMouseButtonMessage', position,\n            0, 1 << event.button);\n         this.buttonStatus &= ~(1 << event.button);\n      }\n      $(document).trigger(\"primarymonitoruse\");\n   }.bind(this);\n\n   /**\n    * @private\n    * @param  {object} event\n    */\n   this.onMouseWheel = function(event) {\n      let position,\n         dx,\n         dy;\n\n      if (this.isPrimaryCanvasEvent()) {\n         position = wmksBaseService.getEventPosition(event, this.offset);\n         dx = Math.max(Math.min(event.wheelDeltaX, 1), -1);\n         dy = Math.max(Math.min(event.wheelDeltaY, 1), -1);\n         this.wmksSession.wmksContainer.wmks('sendScrollMessage', position, dx,\n            dy);\n      }\n      $(document).trigger(\"primarymonitoruse\");\n   }.bind(this);\n\n   /**\n    * @private\n    * @param  {object} event\n    */\n   this.onKeyUp = function(event) {\n      this.onKeyEvent(\"KeyUp\", event);\n   }.bind(this);\n\n   /**\n    * @private\n    * @param  {object} event\n    */\n   this.onKeyDown = function(event) {\n      this.onKeyEvent(\"KeyDown\", event);\n   }.bind(this);\n\n   /**\n    * @private\n    * @param  {object} event\n    */\n   this.onKeyPress = function(event) {\n      this.onKeyEvent(\"KeyPress\", event);\n   }.bind(this);\n\n   /**\n    * @private\n    * @param  {string} type\n    * @param  {object} event\n    */\n   this.onKeyEvent = function(type, event) {\n      this.wmksSession.wmksContainer.wmks('sendKeyMessage', {\n         type: type,\n         event: event\n      });\n      if (wmksBaseService.shouldPreventDefault(event)) {\n         event.preventDefault();\n      }\n      event.stopPropagation();\n      $(document).trigger(\"primarymonitoruse\");\n   }.bind(this);\n\n   /**\n    * @private\n    * Destroy the primary canvas with the mks event for it and reconnect\n    * default events back.\n    *\n    * Add a try catch block since the wmksSession might fail.\n    */\n   this.destroyPrimaryCanvas = function() {\n      let canvasContainner = document.getElementById(\"canvas-container\");\n      canvasContainner.removeChild(this.primaryCanvas);\n      $(document).off(\"mousemove\", this.onMouseMove);\n      $(document).off(\"mousedown\", this.onMouseDown);\n      $(document).off(\"mouseup\", this.onMouseUp);\n      $(document).off(\"mousewheel\", this.onMouseWheel);\n      $(canvasContainner).off(\"keyup\", this.onKeyUp);\n      $(canvasContainner).off(\"keydown\", this.onKeyDown);\n      $(canvasContainner).off(\"keypress\", this.onKeyPress);\n      $(window).off(\"blur\", this.onBlur);\n   };\n\n   /**\n    * @private\n    * @return {[type]} [description]\n    */\n   this.startRegionDetector = function(onRegionUpdated) {\n      let lastRegion = null,\n\n         detectRegionChange = function(stillUpdate) {\n            //TODO, seems the API is not consistent, need to clip in the\n            // comming patch\n            let currentRegion = {\n               x: screen.availLeft,\n               y: screen.availTop,\n               height: screen.availHeight,\n               width: screen.availWidth,\n               devicePixelRatio: devicePixelRatio\n            };\n            if (!lastRegion ||\n               JSON.stringify(lastRegion) !== JSON.stringify(currentRegion)) {\n               onRegionUpdated(0, currentRegion, stillUpdate);\n               lastRegion = currentRegion;\n            }\n         };\n         detectRegionChange(true);\n         this.detectTimer = setInterval(detectRegionChange, 1000);\n      };\n      /**\n       * @private\n       * @return {[type]} [description]\n       */\n      this.stopRegionDetector = function() {\n         if (!!this.detectTimer) {\n            clearInterval(this.detectTimer);\n         }\n      };\n\n      /**\n       * Although very very corner, this function also be implemented to avoid\n       * primary monitor move after extended monitor connected for 3+ display case.\n       */\n      this.updateUnmaxizableRegions = function(allRegions) {\n         JSCDKLogger.log(\"the setting is updated as\" + JSON.stringify(allRegions));\n      };\n\n      this.onCursorChanged = function(cursorAddress) {\n         if (!this.enabled) {\n            return;\n         }\n         this.primaryCanvas.style.cursor = cursorAddress;\n      };\n\n      this.onDisplayChanged = function(rect, renderingIndex) {\n         if (!this.enabled) {\n            return;\n         }\n         vncDecoder.render(rect, this.offset, function() {\n            this.onRenderingDone(0, renderingIndex);\n         }.bind(this));\n   };\n\n   /**\n    * Init the primary monitor\n    * @param  {function} onRegionUpdated The callback should be called when\n    *    region changed\n    */\n   this.init = function(onRegionUpdated) {\n      this.startRegionDetector(onRegionUpdated);\n   };\n\n   this.enterFullscreen = function() {\n      fullscreenService.enterFullscreen(document.body);\n   };\n\n   this.exitFullscreen = function() {\n      fullscreenService.unbindFullScreen();\n      fullscreenService.exitFullscreen();\n   };\n\n   this.onConflictEvent = function() {\n      this.conflictEventTime = Date.now();\n   }.bind(this);\n\n   /**\n    * Enable primary monitor\n    * @param  {object} wmksSession The session that want to use the primary\n    *    monitor\n    * @param  {function} onDone The callback after the enable done.\n    * @param  {object} screenBase The object that include property x and y for\n    *     the screen base offset.\n    */\n   this.enable = function(wmksSession, onDone, onQuit, onRenderingDone) {\n      if (!!this.enabled) {\n         return;\n      }\n      this.stopRegionDetector();\n      this.createPrimaryCanvas(wmksSession);\n\n      fullscreenService.onExitFullscreen(function() {\n         let mayHasConflict,\n            conflictTime = 100, //use 100ms as a workaround in 17Q1 to wait\n                                // event take effects\n            currentTime = Date.now();\n\n         console.log(currentTime, this.conflictEventTime);\n         mayHasConflict = (currentTime - this.conflictEventTime < conflictTime);\n         onQuit(mayHasConflict);\n      }.bind(this));\n      fullscreenService.onEnterFullscreen(function() {\n         $timeout(onDone);\n      });\n      fullscreenService.bindFullScreen();\n      this.enterFullscreen();\n      this.canvasContent = this.primaryCanvas.getContext('2d');\n      this.enabled = true;\n      $(window).on(\"fileDownloaded\", this.onConflictEvent);\n      this.onRenderingDone = onRenderingDone;\n   };\n\n   /**\n    * Disable primary monitor\n    */\n   this.disable = function() {\n      if (!this.enabled) {\n         return;\n      }\n      this.exitFullscreen();\n      this.offset = null;\n      this.stopRegionDetector();\n      this.destroyPrimaryCanvas();\n      this.primaryCanvas = null;\n      this.canvasContent = null;\n      this.enabled = false;\n      $(window).off(\"fileDownloaded\", this.onConflictEvent);\n   };\n\n   /**\n    * return the monitor setting\n    */\n   this.getSetting = function() {\n      return wmksBaseService.getScreenSetting();\n   };\n\n   /**\n    * set the offset\n    * @param {object} screenBase The base offset in the co-ordination\n    */\n   this.setScreenBase = function(screenBase) {\n      this.offset = screenBase;\n   };\n\n   this.setScreenModel = function(model) {\n      normalizationService.setScreenModel(model);\n   };\n\n   this.initScreen = function() {\n      vncDecoder.initScreen();\n   };\n\n   this.showDisplay = function() {\n      this.primaryCanvas.style.display = \"\";\n   };\n\n   this.hideDisplay = function() {\n      this.primaryCanvas.style.display = \"none\";\n   };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/main-page/primary-monitor-service.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * multimon-setting-window-controller.js -- multimonSettingWindowController\n *\n * Module to implement modal dialogs for the Blast UI using Angular JS.\n * The funciton of this window is still not reviewed thus not finalized, so\n *    refactory will not be done for now.\n */\n\nimport AB from '../../common/appblast-util';\nimport errorDialogTemplate from '../../../common/commondialog/dialog_service_error.html';\n\nexport default function multimonSettingWindowController($scope, $rootScope,\n                                                        $timeout, wmksService,\n                                                        userGlobalPref, ngDialog, _) {\n   $scope.addButtonEnabled = false;\n   $scope.allReady = false;\n   $scope.hasConflictedDetector = false;\n\n   $scope.startConfiguring = false;\n   $scope.hasTooLargeMonitor = false;\n   $scope.verticalMonitorNumber = 0;\n   $scope.maxMonitorNumber = 2;\n   /**\n    * Helper function to check whether rectangles coincide\n    * @param  {object} rectA\n    * @param  {object} rectB\n    * @return {boolean}\n    */\n   this.rectanglesCoincide = function(rectA, rectB) {\n      return rectA.x === rectB.x && rectA.y === rectB.y &&\n         rectA.width === rectB.width && rectA.height === rectB.height;\n   };\n\n   /**\n    * Helper function to check whether non-trivial rectangles has non-zero\n    *    shared area\n    * It's written in the less effective but more readable way\n    * @param  {object} rectA\n    * @param  {object} rectB\n    * @return {boolean}\n    */\n   this.rectanglesShareArea = function(rectA, rectB) {\n      let minAx = rectA.x,\n         minAy = rectA.y,\n         maxAx = rectA.x + rectA.width,\n         maxAy = rectA.y + rectA.height,\n         minBx = rectB.x,\n         minBy = rectB.y,\n         maxBx = rectB.x + rectB.width,\n         maxBy = rectB.y + rectB.height,\n         aLeftOfB = maxAx <= minBx,\n         aRightOfB = minAx >= maxBx,\n         aAboveB = minAy >= maxBy,\n         aBelowB = maxAy <= minBy;\n\n      return !(aLeftOfB || aRightOfB || aAboveB || aBelowB) ||\n         this.rectanglesCoincide(rectA, rectB);\n   };\n\n   /**\n    * Helper function to check whether targetKey is conflict with others,\n    *    and always return false for key \"0\"\n    * @param {string} targetKey The key we check for\n    * @param {object} content Contains all the items\n    * @return {boolean} This will return result\n    */\n   this.hasConflict = function(targetKey, content) {\n      let key,\n         targetRect = content[targetKey].settings,\n         comparedRect;\n\n      if (targetKey === \"0\") {\n         return false;\n      }\n      for (key in content) {\n         if (content.hasOwnProperty(key) && targetKey !== key) {\n            comparedRect = content[key].settings;\n            if (this.rectanglesShareArea(targetRect, comparedRect)) {\n               return true;\n            }\n         }\n      }\n      return false;\n   };\n\n   /**\n    * Helper function to derive the settings suitable to be previewed\n    * @param {object} content The content to be previewed\n    * @return {object} This returns a object containing all adjusted rect\n    *    and requested canvas size\n    */\n   this.getPreviewSettings = function(content, maxWidth, maxHeight) {\n      let key,\n         baseOffset,\n         currentRect,\n         scale,\n         visibleScaleFactor,\n         canvasSize,\n         setting,\n         overallWidth,\n         overallHeight,\n         scaleFactor = 0.85,\n         rects = {},\n         overallRect = null;\n\n      for (key in content) {\n         if (content.hasOwnProperty(key)) {\n            setting = content[key].settings;\n            currentRect = {\n               minX: setting.x,\n               minY: setting.y,\n               maxX: setting.x + setting.width,\n               maxY: setting.y + setting.height\n            };\n            if (!overallRect) {\n               overallRect = currentRect;\n            } else {\n               overallRect.minX = Math.min(overallRect.minX, currentRect.minX);\n               overallRect.minY = Math.min(overallRect.minY, currentRect.minY);\n               overallRect.maxX = Math.max(overallRect.maxX, currentRect.maxX);\n               overallRect.maxY = Math.max(overallRect.maxY, currentRect.maxY);\n            }\n         }\n      }\n\n      overallWidth = overallRect.maxX - overallRect.minX;\n      overallHeight = overallRect.maxY - overallRect.minY;\n      scale = Math.min(maxWidth / overallWidth, maxHeight / overallHeight);\n      visibleScaleFactor = scale * scaleFactor;\n      canvasSize = {\n         width: Math.floor(scale * overallWidth),\n         height: Math.floor(scale * overallHeight)\n      };\n      baseOffset = {\n         x: (1 - scaleFactor) * 0.5 * overallWidth * scale,\n         y: (1 - scaleFactor) * 0.5 * overallHeight * scale\n      };\n\n\n      for (key in content) {\n         if (content.hasOwnProperty(key)) {\n            setting = content[key].settings;\n            rects[key] = {\n               x: Math.round(\n                  (setting.x - overallRect.minX) * visibleScaleFactor +\n                  baseOffset.x),\n               y: Math.round(\n                  (setting.y - overallRect.minY) * visibleScaleFactor +\n                  baseOffset.y),\n               width: Math.round(setting.width * visibleScaleFactor),\n               height: Math.round(setting.height * visibleScaleFactor)\n            };\n            rects[key].ready = content[key].ready;\n            rects[key].conflicted = this.hasConflict(key, content);\n         }\n      }\n\n      return {\n         rects: rects,\n         canvasOffset: {\n            x: Math.floor(maxWidth - canvasSize.width) / 2,\n            y: Math.floor(maxHeight - canvasSize.height) / 2\n         }\n      };\n   };\n\n   /**\n    * Helper function to check whether value in (min, max)\n    * @param {number} value\n    * @param {number} min\n    * @param {number} max\n    * @return {boolean}\n    */\n   this.InRange = function(value, min, max) {\n      return min < value && value < max;\n   };\n\n   /**\n    * Helper function to check whether non-trivial rectangles has adjacent\n    * Edge. It's written in the less effective but more readable way\n    *\n    * Since In Q1 we have other functions to implement use a tricky tolerentY\n    *    to cope with the problem that browser can't return real monitor\n    *    resolution since the up and down system bar area is not allow to\n    *    be used by browser, it will make the condition losser than it should\n    *    be, but the condition-difference is very trivial and demage\n    *    acceptable, and this is disucssed with Jack and get agreement for Q1.\n    *    And we should change this after Q1 by adjust workflow if PM is ok\n    *    with the drawback of that \"good\" design which will make the screen\n    *    blink once before seeing error message.\n    *\n    * @param  {object} rectA\n    * @param  {object} rectB\n    * @return {boolean}\n    */\n   this.rectanglesAdjacent = function(rectA, rectB) {\n      let tolerentY = 100, // TODO: remove this after 17Q1 release\n         minAx = rectA.x,\n         minAy = rectA.y,\n         maxAx = rectA.x + rectA.width,\n         maxAy = rectA.y + rectA.height,\n         minBx = rectB.x,\n         minBy = rectB.y,\n         maxBx = rectB.x + rectB.width,\n         maxBy = rectB.y + rectB.height,\n         minAxInBx = this.InRange(minAx, minBx, maxBx),\n         maxAxInBx = this.InRange(maxAx, minBx, maxBx),\n         minAyInBy = this.InRange(minAy, minBy, maxBy),\n         maxAyInBy = this.InRange(maxAy, minBy, maxBy),\n         minBxInAx = this.InRange(minBx, minAx, maxAx),\n         maxBxInAx = this.InRange(maxBx, minAx, maxAx),\n         minByInAy = this.InRange(minBy, minAy, maxAy),\n         maxByInAy = this.InRange(maxBy, minAy, maxAy),\n         someAxInBx = minAxInBx || maxAxInBx,\n         someAyInBy = minAyInBy || maxAyInBy,\n         someBxInAx = minBxInAx || maxBxInAx,\n         someByInAy = minByInAy || maxByInAy,\n         axEqualBx = minAx === minBx && maxAx === maxBx,\n         ayEqualBy = minAy === minBy && maxAy === maxBy,\n         xShareRange = someAxInBx || someBxInAx || axEqualBx,\n         yShareRange = someAyInBy || someByInAy || ayEqualBy,\n         aLeftOfB = maxAx === minBx,\n         aRightOfB = minAx === maxBx,\n         aBelowB = maxBy <= minAy && minAy < (maxBy + tolerentY),\n         aAboveB = (minBy - tolerentY) < maxAy && maxAy <= minBy;\n\n      return ((aLeftOfB && yShareRange) ||\n      (aRightOfB && yShareRange) ||\n      (aAboveB && xShareRange) ||\n      (aBelowB && xShareRange));\n   };\n\n   /**\n    * slow but easily readable way to detect non adjacent rect\n    * don't reuse key to make code more readable\n    */\n   this.hasNonAdjacentRect = function(content) {\n      let k1,\n         k2,\n         rect1,\n         rect2,\n         hasAdjacent;\n\n      for (k1 in content) {\n         if (content.hasOwnProperty(k1)) {\n            rect1 = content[k1].settings;\n            hasAdjacent = false;\n            for (k2 in content) {\n               if (content.hasOwnProperty(k2) && k1 !== k2) {\n                  rect2 = content[k2].settings;\n                  if (!!rect2 && this.rectanglesAdjacent(rect1, rect2)) {\n                     hasAdjacent = true;\n                     break;\n                  }\n               }\n            }\n            if (!hasAdjacent) {\n               return true;\n            }\n         }\n      }\n      return false;\n   };\n\n   /**\n    * Return whether a monitor is abnormal large\n    *\n    * The max supported resolution is 3840*2160 as in the document:\n    * https://www.vmware.com/pdf/horizon-view/horizon-client-windows-44-document.pdf\n    * \"With the VMware Blast display protocol or the PCoIP display protocol, a\n    * remote desktop screen resolution of 4K (3840 x 2160) is supported.\"\n    * Although it's for windows client, the limitation is on the agent side, so\n    * commen for all Clients.\n    */\n   this.isTooLargeMonitor = function(rect, factor) {\n      const maxWidth = 3840,\n         maxHeight = 2160;\n\n\n      if (!rect || rect.devicePixelRatio === undefined) {\n         return false;\n      }\n\n      return (rect.width * factor * rect.devicePixelRatio > maxWidth) ||\n         (rect.height * factor * rect.devicePixelRatio > maxHeight);\n   };\n\n   /**\n    * Detect whether has abnormal large monitor caused by agent status\n    */\n   this.checkTooLargeMonitor = function(content) {\n      let agentScale = wmksService.getCurrentSessionDPI();\n      if (agentScale === 1) {\n         return false;\n      }\n      let devideFactor = (userGlobalPref.getPrefData().enableDPISync !== 'true') ?\n         devicePixelRatio : 1;\n      let factor = agentScale / devideFactor;\n\n      for (let key in content) {\n         if (content.hasOwnProperty(key)){\n            if (this.isTooLargeMonitor(content[key].settings, factor)) {\n               return true;\n            }\n         }\n      }\n      return false;\n   };\n\n   /**\n    * display the monitor status and position as rect for user to preview\n    * @param {object} content The previewed content, it contains all\n    * @param {boolean} stillUpdating Whether the update is not finished\n    * monitor status and position info\n    */\n   $scope.updatePreview = function(content, stillUpdating) {\n      let key,\n         previewSettings,\n         offset,\n         rects,\n         rect,\n         previewCanvas = document.getElementById(\"topology-preview-canvas\"),\n         previewContext,\n         rectNumber = 0;\n\n      if (!previewCanvas || typeof previewCanvas.getContext !== \"function\") {\n         return;\n      }\n      previewContext = previewCanvas.getContext(\"2d\");\n      $scope.hasNonAdjacentMonitors = this.hasNonAdjacentRect(content);\n      $scope.hasTooLargeMonitor = this.checkTooLargeMonitor(content);\n      previewSettings = this.getPreviewSettings(content,\n         previewCanvas.width, previewCanvas.height);\n      rects = previewSettings.rects;\n\n      offset = previewSettings.canvasOffset;\n      previewContext.beginPath();\n      previewContext.rect(0, 0, previewCanvas.width, previewCanvas.height);\n      previewContext.fillStyle = \"#cccccc\";\n      previewContext.fill();\n      $scope.hasConflictedDetector = false;\n      $scope.verticalMonitorNumber = 0;\n      for (key in rects) {\n         if (rects.hasOwnProperty(key)) {\n            rect = rects[key];\n            rectNumber++;\n            if (rect.height > rect.width) {\n               $scope.verticalMonitorNumber++;\n            }\n            //TODO: need PM's input for UX details\n            if (!rect.conflicted) {\n               previewContext.beginPath();\n               previewContext.rect(offset.x + rect.x, offset.y + rect.y,\n                  rect.width, rect.height);\n               if (key === \"0\" || rect.ready) {\n                  previewContext.fillStyle = \"#77FF77\";\n               } else {\n                  previewContext.fillStyle = \"#777777\";\n               }\n               previewContext.fill();\n               previewContext.lineWidth = 2;\n               previewContext.strokeStyle = 'black';\n               previewContext.stroke();\n            } else {\n               $scope.hasConflictedDetector = true;\n            }\n         }\n      }\n      $scope.startConfiguring = (rectNumber > 1);\n      if (!stillUpdating) {\n         $scope.addButtonEnabled = (rectNumber < $scope.maxMonitorNumber);\n      }\n   }.bind(this);\n\n   $scope.addMonitor = function() {\n      AB.LOGGER.log(\"call addMonitor\");\n      let uiCallback = function(type, data) {\n         $timeout(function() {\n            switch (type) {\n               case \"onMonitorChanged\":\n                  $scope.allReady = data.allReady;\n                  $scope.updatePreview(data.settings, data.stillUpdating);\n                  break;\n               case \"onMultiMonitor\":\n                  // to fix bug 1852282\n                  wmksService.disconnectEventConnections();\n                  break;\n               case \"onEnterMultimon\":\n                  $rootScope.setMultimonStarted(true);\n                  break;\n               case \"onSingleMonitor\":\n                  // to fix bug 1852282\n                  wmksService.recoveryEventConnections();\n                  break;\n               case \"onQuitMultimon\":\n                  $rootScope.setMultimonStarted(false);\n                  break;\n               default:\n                  AB.LOGGER.log(\"unknown message from multimon\");\n            }\n         });\n      };\n      $timeout(function() {\n         // disable before real number calculated to avoid user click too\n         // quickly\n         $scope.addButtonEnabled = false;\n         $scope.startConfiguring = true;\n         wmksService.addMonitor(uiCallback, function() {\n            $rootScope.collapseSidebar();\n         });\n      });\n   };\n\n   /**\n    * In Q1, we use the dialog to show 2 vertial display message since user\n    *    is doing valid operations but the result is not a valid horizon\n    *    multimon setting.\n    * p.s. dialog service is suggested to procide identical API with options as\n    *    dialogService.error(contentKey, optimalOptions);\n    */\n   $scope.showErrorMessage = function(contentKey, options) {\n      options = options || {};\n      ngDialog.open({\n         name: \"SessionOpsError\", // dialog name\n         templateUrl: errorDialogTemplate, // dialog template\n         showClose: false, // do not show the default close button\n         className: \"session-ops-dialog\", // css class to apply\n         data: {\n            errorMessage: _(contentKey, options.massageParam)\n         }, // data object for $scope.ngDialogData\n         closeByEscape: true, // allow escape to close window\n         closeByDocument: true // allow clicking on background to\n         // close window\n      });\n   };\n\n   $scope.startMultimon = function() {\n      AB.LOGGER.log(\"start multimon\");\n      $scope.closeThisDialog();\n      wmksService.enterMultimon();\n   };\n\n   $scope.multimonCancelClicked = function() {\n      AB.LOGGER.log(\"close multimon\");\n      $scope.closeThisDialog();\n      wmksService.quitMultimon();\n   };\n\n   $scope.multimonOkClicked = function() {\n      if (!($scope.startConfiguring && !$scope.hasConflictedDetector &&\n         $scope.allReady)) {\n         return;\n      }\n\n      if ($scope.verticalMonitorNumber > 2) {\n         $scope.showErrorMessage(\"MM_MAX_2_VERTICAL\");\n      } else if ($scope.hasNonAdjacentMonitors) {\n         $scope.showErrorMessage(\"MM_NONADJACENT_MONITOR\");\n      } else if ($scope.hasTooLargeMonitor) {\n         $scope.showErrorMessage(\"MM_HAS_TOO_LARGE_MONITOR\");\n      } else {\n         $scope.startMultimon();\n      }\n   };\n\n   /**\n    * When this window is renderred show the preview right away, and the\n    *    initial x,y doesn't matters, any data can derive the same UI, so set\n    *    to 0 here.\n    */\n   $scope.initPreview = function() {\n      let initialContent = {\n         \"0\": {\n            \"settings\": {\n               \"x\": 0,\n               \"y\": 0,\n               \"width\": screen.availWidth,\n               \"height\": screen.availHeight,\n               \"devicePixelRatio\": devicePixelRatio\n            },\n            \"ready\": false\n         }\n      };\n      $scope.updatePreview(initialContent);\n   };\n\n   $scope.$watch('$viewContentLoaded', function() {\n      $timeout(function() {\n         $scope.initPreview();\n      });\n   });\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/multimon/multimon-setting-window/multimon-setting-window-controller.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function reAuthChangePasswordCtrl($scope, $rootScope, $timeout,\n                                                 connectionServerModel,\n                                                 jscdkDesktopInvoker) {\n    $scope.renderData = function(data) {\n        if (!!data && !!data.content) {\n            if (!!data.content.username) {\n                $scope.username = data.content.username;\n            }\n            if (!!data.content.oldpassword) {\n                $scope.credential.oldpassword = data.content.oldpassword;\n            }\n            // Set error message.\n            if (!!data.content.error) {\n                $scope.error = data.content.error;\n            }\n        }\n    };\n\n    // Initialize ChangePasswordCtrl controller.\n    $scope.init = function(actionData) {\n        $scope.loadingAllow = true;\n        let data = actionData ? actionData : $scope.ngDialogData.actionData;\n\n        // Name of the controller.\n        $scope.name = 'WindowsPasswordExpired';\n        // Set host address.\n        $scope.host = connectionServerModel.host;\n        // Error message.\n        $scope.error = '';\n        // User credentials.\n        $scope.credential = {\n            oldpassword: '',\n            newpassword: '',\n            newpasswordRepeat: ''\n        };\n        $scope.ajaxBusy = false;\n        $scope.renderData(data);\n    };\n\n    $scope.changePassword = function(form) {\n        if (form.$valid && !$scope.ajaxBusy) {\n            jscdkDesktopInvoker.changePassword($scope.credential.oldpassword,\n                    $scope.credential.newpassword,\n                    $scope.credential.newpasswordRepeat);\n            $scope.ajaxBusy = true;\n            $scope.loadingAllow = true;\n        }\n    };\n\n    $scope.cancel = function() {\n        $scope.loadingAllow = false;\n        if ($scope.ajaxBusy) {\n            jscdkDesktopInvoker.cancelCurrentRequest({\n                name: 'WindowsPasswordExpired',\n                content: {\n                    oldpassword: $scope.credential.oldpassword,\n                    error: $scope.error\n                }\n            });\n            $scope.ajaxBusy = false;\n        } else {\n            $rootScope.reAuthDialog.close();\n            $rootScope.reAuthDialog = null;\n        }\n    };\n\n    $scope.keyPress = function(event, form) {\n        if (!!event && event.keyCode === 13) {\n            // Press enter key.\n            $scope.changePassword(form);\n        }\n    };\n\n    $rootScope.$on('reAuthWindowsPasswordExpired', function(e, data) {\n        $timeout(function() {\n            $scope.init(data);\n        });\n    });\n\n    $timeout(function() {\n        $scope.init();\n    });\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/re-auth/changepassword-controller.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport AB from '../common/appblast-util';\nimport errorDialogTemplate from '../../common/commondialog/dialog_service_error.html';\nimport JSCDKBrokerError from '../../jscdk/model/jscdkBrokerError';\n\nexport default function reAuthCtrl($scope, $rootScope, $timeout,\n                                   connectionServerModel,\n                                   jscdkDesktopInvoker,\n                                   viewClientModel, usernameUtil,\n                                   entitledItemsService,\n                                   ngDialog) {\n   // Case insensitive string compare.\n   let ignoreCaseEquals = function(str1, str2) {\n      if (!str1 || !str2) {\n         return false;\n      }\n\n      return str1.toLowerCase() === str2.toLowerCase();\n   };\n\n   let renderData = function(data) {\n      let domain, i;\n      if (!!data && !!data.content) {\n         // Initialize credential data binding model.\n         $scope.credential.username = data.content.username;\n         // Set available domains.\n         $scope.domains = data.content.domains;\n\n         // Set current domain.\n         if (!!$scope.domains && $scope.domains.length > 0) {\n            if (!!data.content.domainName) {\n               domain = data.content.domainName;\n            }\n\n            for (i = 0; i < $scope.domains.length; i++) {\n               if (ignoreCaseEquals($scope.domains[i],\n                     domain)) {\n                  break;\n               }\n            }\n            if (i >= $scope.domains.length) {\n               i = 0;\n            }\n\n            $scope.credential.domain = $scope.domains[i];\n         }\n         // Set error message.\n         if (!!data.content.error) {\n            $scope.error = data.content.error;\n         }\n      }\n   };\n\n   // Initialize LoginCtrl controller.\n   $scope.init = function(actionData) {\n      $scope.loadingAllow = true;\n      $rootScope.reWindowsPasswordExpired = false;\n      let data = actionData ? actionData : $scope.ngDialogData.actionData;\n      //check platform to use native select.\n      if (viewClientModel.mIsAndroid || viewClientModel.mIsIEMobile ||\n         viewClientModel.mIsIOS) {\n         $scope.isPhone = true;\n      } else {\n         $scope.isPhone = false;\n      }\n      // Error message.\n      $scope.error = '';\n      // User credentials.\n      $scope.credential = {\n         username: connectionServerModel.username,\n         password: '',\n         domain: ''\n      };\n      // User name input editability.\n      $scope.userNameReadOnly = true;\n      // Domain select disable\n      $scope.domainReadOnly = true;\n\n      if (viewClientModel.clientHideDomainList) {\n         $(\"#domain-button\").addClass('ui-hide');\n      }\n\n      renderData(data);\n      $scope.ajaxBusy = false;\n   };\n\n   $scope.loginCallback = function(response, onDone) {\n      let MAX_ERROR = \"Maximum login attempts exceeded.\";\n      $scope.ajaxBusy = false;\n      if ((typeof response === 'object') && !response.success) {\n         if (response.error &&\n             response.error.errorType ===\n             JSCDKBrokerError.JSCDK_BROKER_ERROR_AUTHENTICATION_FAILED &&\n             response.error.userMsg.indexOf(MAX_ERROR) > -1){\n            $scope.maxLogin = ngDialog.open({\n               name: \"LoginError\",\n               templateUrl: errorDialogTemplate,\n               showClose: false,\n               className: \"session-ops-dialog\",\n               data: {\n                  errorMessage: response.error.userMsg\n               }\n            });\n            if (!!$scope.maxLogin) {\n               $scope.maxLogin.closePromise.then(function() {\n                  // take it back to the login page.\n                  AB.UTIL.returnToLauncher();\n               });\n            }\n         } else if (response.error &&\n            response.error.errorType ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_ALREADY_AUTHENTICATED) {\n            // already authenticated close dialog\n            if (!!$rootScope.reAuthDialog) {\n               $rootScope.reAuthDialog.close();\n               $rootScope.reAuthDialog = null;\n            }\n            //launch app\n            if(!!onDone) {\n               onDone();\n            }\n         }\n      }\n   };\n\n   // Login method.\n   $scope.login = function(form) {\n      let domain;\n\n      if (form.$valid) {\n         if (usernameUtil.domainInUsername($scope.credential.username)) {\n            domain = usernameUtil.getDomain($scope.credential.username);\n         } else {\n            domain = $scope.credential.domain;\n         }\n\n         entitledItemsService.submitWindowsPasswordWithCallback(\n            $scope.credential.username,\n            $scope.credential.password, domain, true, $scope.loginCallback);\n         $scope.loadingAllow = true;\n         $scope.ajaxBusy = true;\n         $scope.error = '';\n      }\n   };\n\n   $scope.cancel = function() {\n      $scope.loadingAllow = false;\n      // wirte in datas that needed when back to login page\n      let backContent = {\n         username: $scope.credential.username,\n         domains: $scope.domains,\n         domainName: $scope.credential.domain\n      };\n\n      backContent.usernameReadOnly = 'yes';\n      backContent.domainReadOnly = 'yes';\n      // cancel current request\n      if ($scope.ajaxBusy) {\n         jscdkDesktopInvoker.cancelCurrentRequest({\n            name: 'WindowsPassword',\n            content: backContent\n         });\n      } else {\n         $rootScope.reAuthDialog.close();\n         $rootScope.reAuthDialog = null;\n      }\n   };\n\n   $scope.keyPress = function(event, form) {\n      if (!!event && event.keyCode === 13) {\n         // Press enter key.\n         $scope.login(form);\n      }\n   };\n\n   $rootScope.$on('changeWindowsPassword', function(e, data) {\n      $timeout(function() {\n         $scope.init(data);\n      });\n   });\n\n   $timeout(function() {\n      $scope.init();\n   });\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/re-auth/reauth-controller.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * unity-service.js --\n *\n * Module for wrapping unity to angular factory service. Unity Service is a\n * singleton service.\n *\n * Todo: we will go to manage several unityMgr instances in this factory\n * service.\n *\n */\n\nimport AB from '../common/appblast-util';\nimport $ from 'jquery';\nimport signal from '../common/signal';\n\nexport default function unityService($window, wmksService, Unity,\n                                     wmksServiceEventHandler) {\n   let init,\n      unityService = {},\n      unityMgrMap = {},\n      unityFeatures = Unity.SHOW_FLOATING_LANGUAGE_BAR,\n\n      /**\n       * Private functions for handling unity notification.\n       */\n      handleWindowAdded = null,\n      handleWindowRemove = null,\n      handleTitleChanged = null,\n      handleAttrChanged = null,\n      handleTypeChanged = null,\n      handleIconChanged = null,\n      handleActiveChanged = null,\n      handleCapsChanged = null,\n      handleReadyChanged = null,\n      handleVisibilityChanged = null,\n\n      /**\n       * Private functions for initializing and handling app event.\n       */\n      initEventsListener = null,\n      removeEventsListener = null,\n\n      /**\n       * Handle notification from wmksSession\n       */\n      onWmksSessionConnecting = null,\n      onWmksSessionConnected = null,\n      onWmksSessionDisconnected = null,\n      onWmksSessionRemoved = null,\n\n      // The help function to retrieve data for a specified windowId.\n      getIconDataHelper = null,\n\n      // The help function to update the empty status for an app session.\n      updateEmptySession = null,\n\n      destroyUnityMgr = null;\n\n   /**\n    * init\n    *\n    * subscribe to wmksService events\n    */\n   init = function() {\n      signal.makeObservable(unityService);\n      unityService.addSignal('windowAdded');\n      unityService.addSignal('windowRemoved');\n      unityService.addSignal('titleChanged');\n      unityService.addSignal('iconChanged');\n      unityService.addSignal('attrChanged');\n      unityService.addSignal('appAttrChanged');\n      unityService.addSignal('typeChanged');\n      unityService.addSignal('unityReady');\n      unityService.addSignal('unityPaused');\n      unityService.addSignal('unityDestroyed');\n      unityService.addSignal('visibleChanged');\n\n      wmksServiceEventHandler.addEventListener('sessionConnecting',\n         onWmksSessionConnecting);\n      wmksServiceEventHandler.addEventListener('sessionConnected',\n         onWmksSessionConnected);\n      wmksServiceEventHandler.addEventListener('sessionDisconnected',\n         onWmksSessionDisconnected);\n      wmksServiceEventHandler.addEventListener('sessionRemoved',\n         onWmksSessionRemoved);\n      wmksServiceEventHandler.listenerReadyForModule(\n         wmksServiceEventHandler.MODULE_NAME.UNITY_SERVICE);\n   };\n\n   /**\n    * destroyUnityMgr\n    *\n    * Reset the internal status of wmksService.\n    *\n    * @param wmksKey the wmksSession identifier.\n    */\n   destroyUnityMgr = function(wmksKey) {\n      let unityMgr = unityMgrMap[wmksKey];\n      if (!unityMgr) {\n         return;\n      }\n      removeEventsListener(wmksKey);\n      delete unityMgrMap[wmksKey];\n      unityMgr = null;\n      unityService.emit('unityDestroyed', wmksKey);\n   };\n\n   /**\n    * onWmksSessionConnecting\n    *\n    * If this is an app session, create an UnityMgr instance.\n    * Otherwise, do nothing.\n    *\n    * @params wmksKey               the key to identify this unique\n    *    wmksSession.\n    * @params isApplicationSession  if this is an application session.\n    * @params vdpService            vdpService associated with\n    *    wmksSession.\n    */\n   onWmksSessionConnecting =\n      function(wmksKey, isApplicationSession, vdpService, mainChannel) {\n         let unityMgr;\n\n         if (!isApplicationSession) {\n            return;\n         }\n\n         unityMgr = new Unity.Mgr(vdpService, mainChannel);\n\n         unityMgrMap[wmksKey] = unityMgr;\n         initEventsListener(wmksKey);\n         unityMgr.onVisibilityChanged(false);\n      };\n\n   /**\n    * onWmksSessionConnected\n    *\n    * On WMKS connection, notify listeners if unity is not yet ready (off\n    * or paused).\n    *\n    * @params wmksKey               the key to identify this unique\n    *    wmksSession.\n    */\n   onWmksSessionConnected = function(wmksKey) {\n      let unityMgr = unityMgrMap[wmksKey];\n\n      if (unityMgr && (!unityMgr.isOn || unityMgr.paused)) {\n         unityService.emit('unityPaused', wmksKey);\n      }\n   };\n\n   /**\n    * onWmksSessionDisconnected\n    *\n    * Cleanup the specific wmksSession.\n    *\n    * @params wmksKey the key to identify this unique wmksSession.\n    */\n   onWmksSessionDisconnected = function(wmksKey) {\n      destroyUnityMgr(wmksKey);\n   };\n\n   /**\n    * onWmksSessionRemoved\n    *\n    * Respond to a session removal by cleaning up the associated unityMgr.\n    *\n    * @params wmksKey: the key to identify this unique wmksSession\n    */\n   onWmksSessionRemoved = function(wmksKey) {\n      destroyUnityMgr(wmksKey);\n   };\n\n   /**\n    * handleWindowAdded\n    *\n    * Return a closure that roxy windowAdded event from unityMgr to its\n    * consumer.\n    *\n    * @param wmksKey the wmksSession identifier.\n    * @return a function to handle onWindowAdded.\n    */\n   handleWindowAdded = function(wmksKey) {\n      return function(windowId, windowPath, execPath) {\n         AB.LOGGER.info(\n            'Window added with id ' + windowId + ', windowPath ' +\n            windowPath +\n            ', and execPath ' + execPath);\n         updateEmptySession(wmksKey, true);\n\n         unityService.emit('windowAdded', wmksKey, windowId, windowPath,\n            execPath);\n      };\n   };\n\n   /**\n    * handleWindowRemove\n    *\n    * Return a closure that proxy windowRemove event from unityMgr to its\n    * consumer.\n    *\n    * @param wmksKey the wmksSession identifier.\n    * @return a function to handle onWindowRemoved.\n    */\n   handleWindowRemove = function(wmksKey) {\n      return function(windowId) {\n         AB.LOGGER.info('Window removed with id ' + windowId);\n         updateEmptySession(wmksKey, false);\n\n         unityService.emit('windowRemoved', wmksKey, windowId);\n      };\n   };\n\n   /**\n    * handleTitleChanged\n    *\n    * Return a closure that proxy titleChanged event from unityMgr to its\n    * consumer.\n    *\n    * @param wmksKey the wmksSession identifier.\n    * @return a function to handle onTitleChanged.\n    */\n   handleTitleChanged = function(wmksKey) {\n      return function(windowId, windowTitle) {\n         AB.LOGGER.info('Window with id ' + windowId + ' now has title ' +\n            windowTitle);\n\n         unityService.emit('titleChanged', wmksKey, windowId,\n            windowTitle);\n      };\n   };\n\n   /**\n    * handleAttrChanged\n    *\n    * Return a closure that proxy attrChanged event from unityMgr to its\n    * consumer.\n    *\n    * @param wmksKey the wmksSession identifier.\n    * @return a function to handle onAttrChanged.\n    */\n   handleAttrChanged = function(wmksKey) {\n      return function(windowId, type, value) {\n         AB.LOGGER.info(\n            'Window with id ' + windowId + ' has attribute ' + type +\n            ' change to value ' + value);\n\n         unityService.emit('attrChanged', wmksKey, windowId, type, value);\n      };\n   };\n\n   /**\n    * handleTypeChanged\n    *\n    * Return a closure that proxy typeChanged event from unityMgr to its\n    * consumer.\n    *\n    * @param wmksKey the wmksSession identifier.\n    * @return a function to handle onTypeChanged.\n    */\n   handleTypeChanged = function(wmksKey) {\n      return function(windowId, type) {\n         AB.LOGGER.info(\n            'Window with id ' + windowId + ' now is of type ' + type);\n\n         unityService.emit('typeChanged', wmksKey, windowId, type);\n      };\n   };\n\n   /**\n    * handleIconChanged\n    *\n    * Return a closure that call getIconDataHelper to get proper icon.\n    * Send proper notification to its consumer.\n    *\n    * @param wmksKey the wmksSession identifier.\n    * @return a function to handle onIconChanged.\n    */\n   handleIconChanged = function(wmksKey) {\n      return function(windowId) {\n         getIconDataHelper(wmksKey, windowId, function(data) {\n            let iconSrc = !!data ? data :\n               AB.CONST.ICONS.SMALL_DEFAULT_ICON;\n            unityService.emit('iconChanged', wmksKey, windowId, iconSrc);\n         });\n      };\n   };\n\n   /**\n    * getIconDataHelper\n    *\n    * Send request of getting proper icon information to unityMgr.\n    * We will try 32*32 at first and then fallback to 16*16.\n    * And call onDone callback if callback is set by user.\n    *\n    * @param wmksKey     unique identifier of wmksSession.\n    * @param windowId    window id of unity window.\n    * @param onDone      callback called when requesting is finished.\n    */\n   getIconDataHelper = function(wmksKey, windowId, onDone) {\n      let iconSizeSets = [32, 16],\n         iconSrc = \"\",\n         iconSize,\n         getIconData,\n         unityMgr = unityMgrMap[wmksKey];\n\n      AB.LOGGER.info(\n         'Window with id ' + windowId + ' has a new icon available.');\n\n      getIconData = function() {\n         if (iconSizeSets.length > 0) {\n            iconSize = iconSizeSets.shift();\n            unityMgr.getIconData(windowId, iconSize,\n               function(bgra) {\n                  AB.LOGGER.info(\n                     'Retrieved ' + iconSize + ' icon with length: ' +\n                     bgra.length +\n                     ' for window ' + windowId);\n                  iconSrc = 'data:image/png;base64,' +\n                     $window.btoa(String.fromCharCode.apply(null, bgra));\n                  if (onDone) {\n                     onDone(iconSrc);\n                  }\n               },\n               function(error) {\n                  AB.LOGGER.info(\n                     'Failed to retrieve icon data for window ' +\n                     windowId + ' width ' + iconSize + ' with error: ' +\n                     error);\n                  getIconData();\n               }\n            );\n         } else {\n            if (onDone) {\n               onDone(iconSrc);\n            }\n         }\n      };\n\n      getIconData();\n   };\n\n   /**\n    * updateEmptySession\n    *\n    * If an app session empty status is changed, we will notify\n    * wmksService to update it.\n    *\n    * @param wmksKey the wmksSession identifier.\n    * @param isAdd flags whether we are invoking this on an add or remove\n    *    operation\n    */\n   updateEmptySession = function(wmksKey, isAdd) {\n      let unityMgr = unityMgrMap[wmksKey];\n      /* istanbul ignore if */\n      if (!unityMgr) {\n         return;\n      }\n\n      if (unityMgr.windowCount === 1 && isAdd) {\n         // Unity window number is changed from 0 to 1. It is not empty.\n         wmksService.updateEmptySession(wmksKey, false);\n      } else if (unityMgr.windowCount === 0 && !isAdd) {\n         // Unity window number is changed from 1 to 0. It is empty now.\n         wmksService.updateEmptySession(wmksKey, true);\n      }\n   };\n\n   /**\n    * handleActiveChanged\n    *\n    * None.\n    *\n    * @param wmksKey the wmksSession identifier.\n    * @return a function to handle onActiveChanged.\n    */\n   handleActiveChanged = function(wmksKey) {\n      return function(active) {\n         AB.LOGGER.info('Unity is now ' + (active ? 'on' : 'off'));\n      };\n   };\n\n   /**\n    * handleCapsChanged\n    *\n    * None.\n    *\n    * @param wmksKey the wmksSession identifier.\n    * @return a function to handle onCapsChanged.\n    */\n   handleCapsChanged = function(wmksKey) {\n      return function(caps) {\n         AB.LOGGER.info('Server advertised capabilities: ' + caps);\n      };\n   };\n\n   /**\n    * handleReadyChanged\n    *\n    * None.\n    *\n    * @param wmksKey the wmksSession identifier.\n    * @return a function to handle onReadyChanged.\n    */\n   handleReadyChanged = function(wmksKey) {\n      return function(ready) {\n         let unityMgr = unityMgrMap[wmksKey];\n         AB.LOGGER.info('Server is ' + (ready ? 'ready' : 'not ready') +\n            ' for unity.');\n         if (ready) {\n            if (unityMgr.isOn) {\n               if (unityMgr.paused) {\n                  AB.LOGGER.info('Unpausing Unity now.');\n                  unityService.emit('unityReady', wmksKey);\n                  unityMgr.unpause();\n               } else {\n                  AB.LOGGER.info(\n                     'Ignoring duplicate \"Unity ready\" notification.');\n               }\n            } else {\n               AB.LOGGER.info('Entering Unity now.');\n               unityService.emit('unityReady', wmksKey);\n               unityMgr.on(unityFeatures);\n            }\n         } else {\n            if (unityMgr.isOn) {\n               if (unityMgr.paused) {\n                  AB.LOGGER.info(\n                     'Ignoring duplicate \"Unity not ready\" notification.');\n               } else {\n                  AB.LOGGER.info('Pausing Unity now.');\n                  unityMgr.pause();\n                  unityService.emit('unityPaused', wmksKey);\n               }\n            } else {\n               /*\n                * Clients that do actual seamless windows need this notification\n                * but we don't.\n                */\n               AB.LOGGER.info(\n                  'Ignoring \"Unity not ready\" when not in Unity mode.');\n               // Unity not ready, show login desktop directly.\n               unityMgr.onVisibilityChanged(true);\n            }\n         }\n      };\n   };\n\n   /**\n    * handleVisibilityChanged\n    *\n    * None.\n    *\n    * @param wmksKey the wmksSession identifier.\n    * @return a function to handle onReadyChanged.\n    */\n   handleVisibilityChanged = function(wmksKey) {\n      return function(isShow) {\n         unityService.emit('visibleChanged', wmksKey, isShow);\n      };\n   };\n\n   /**\n    * initEventsListener\n    *\n    * Bind callback to all the unityMgr events.\n    *\n    * @param wmksKey the wmksSession identifier.\n    */\n   initEventsListener = function(wmksKey) {\n      let unityMgr = unityMgrMap[wmksKey];\n      /* istanbul ignore if */\n      if (!unityMgr) {\n         return;\n      }\n      unityMgr.onAdd = handleWindowAdded(wmksKey);\n      unityMgr.onRemove = handleWindowRemove(wmksKey);\n      unityMgr.onTitleChanged = handleTitleChanged(wmksKey);\n      unityMgr.onAttrChanged = handleAttrChanged(wmksKey);\n      unityMgr.onTypeChanged = handleTypeChanged(wmksKey);\n      unityMgr.onIconChanged = handleIconChanged(wmksKey);\n      unityMgr.onActiveChanged = handleActiveChanged(wmksKey);\n      unityMgr.onCapsChanged = handleCapsChanged(wmksKey);\n      unityMgr.onReadyChanged = handleReadyChanged(wmksKey);\n      unityMgr.onVisibilityChanged = handleVisibilityChanged(wmksKey);\n   };\n\n   /**\n    * removeEventsListener\n    *\n    * Clear callbacks of Unity instance.\n    *\n    * @param wmksKey the wmksSession identifier.\n    */\n   removeEventsListener = function(wmksKey) {\n      let unityMgr = unityMgrMap[wmksKey];\n      /* istanbul ignore if */\n      if (!unityMgr) {\n         return;\n      }\n      unityMgr.onAdd = null;\n      unityMgr.onRemove = null;\n      unityMgr.onTitleChanged = null;\n      unityMgr.onAttrChanged = null;\n      unityMgr.onTypeChanged = null;\n      unityMgr.onIconChanged = null;\n      unityMgr.onActiveChanged = null;\n      unityMgr.onCapsChanged = null;\n      unityMgr.onReadyChanged = null;\n      unityMgr.onVisibilityChanged = null;\n   };\n\n   let helper = {\n      /**\n       * unityService.closeWindow\n       *\n       * Send closing window command to unityMgr.\n       *\n       * @param wmksKey  the wmksSession identifier.\n       * @param windowId window to be closed.\n       */\n      closeWindow: function(wmksKey, windowId) {\n         this.closeWindows(wmksKey, [windowId]);\n      },\n\n      /**\n       * unityService.closeWindows\n       *\n       * Send close commands to unityMgr for a list of windowIds. Windows\n       * are closed in reverse order of input, so if the windows failed\n       * to close, they are stacked on screen in the order of input\n       * (window 1 on top of window 2, etc).\n       *\n       * @param wmksKey  the wmksSession identifier.\n       * @param windowIds an array of windowIds to be closed.\n       */\n      closeWindows: function(wmksKey, windowIds) {\n         let unityMgr = unityMgrMap[wmksKey],\n            i;\n\n         if (!unityMgr) {\n            return;\n         }\n\n         // Bring windows to top first,  so they can open \"save content\"\n         // dialogs\n         unityMgr.setTopWindows(windowIds);\n         // close in opposite order to setTopWindows\n         for (i = windowIds.length - 1; i >= 0; i--) {\n            unityMgr.closeWindow(windowIds[i]);\n         }\n      },\n\n      /**\n       * unityService.toggleWindow\n       *\n       * Toggle unity window's status\n       *\n       * @param wmksKey the wmksSession identifier.\n       * @param windowId windowId to be toggled.\n       */\n      toggleWindow: function(wmksKey, windowId) {\n         let unityMgr = unityMgrMap[wmksKey],\n            unityWindow;\n\n         if (!unityMgr) {\n            return;\n         }\n\n         unityWindow = unityMgr.windows[windowId];\n         if (!!unityWindow) {\n            if (unityWindow.attributes[Unity.WINDOW_ATTR_MINIMIZED]) {\n               AB.LOGGER.info(\n                  'Restoring minimized Unity window: ' + windowId);\n               unityMgr.unminimize(windowId);\n            } else {\n               AB.LOGGER.info('Activating Unity window: ' + windowId);\n               unityMgr.setTopWindows([windowId]);\n            }\n         }\n      },\n\n      /**\n       * unityService.getAppAttr\n       *\n       * Send get app name and icons command to unityMgr.\n       * Once we get the information, we will fire appAttrChanged event\n       * to its consumer.\n       *\n       * @param wmksKey    the wmksSession identifier.\n       * @param windowPath window path for identifying application.\n       * @param execPath   exec path for identifying application.\n       * @param windowId   window id for the first unity window of this\n       *    application.\n       */\n      getAppAttr: function(wmksKey, windowPath, execPath, windowId) {\n         let unityMgr = unityMgrMap[wmksKey];\n         if (!unityMgr) {\n            return;\n         }\n\n         unityMgr.getExecInfoHash(execPath, function(execInfoHash) {\n            AB.LOGGER.info(\n               'ExecPath ' + execPath + ' has exec info hash: ' +\n               execInfoHash);\n         }, function(error) {\n            AB.LOGGER.info(\n               'Failed to retrieve exec info hash for ExecPath ' +\n               execPath + ' with error: ' + error);\n         });\n\n         unityMgr.getBinaryInfo(windowPath, function(name, images) {\n            let iconSrc = \"\",\n               iconIndex = -1;\n            AB.LOGGER.info(\n               'Window path ' + windowPath + ' has name \"' + name +\n               '\" and ' + images.length + ' icons.');\n            if (images.length > 0) {\n               iconIndex = AB.UTIL.getAppIconIndex(images, 48);\n               if (iconIndex !== -1) {\n                  iconSrc = AB.UTIL.bgraMapToPNG(images[iconIndex].bgra,\n                     images[iconIndex].width,\n                     images[iconIndex].height);\n               }\n            }\n\n            if (iconSrc !== \"\") {\n               unityService.emit('appAttrChanged', wmksKey, windowPath,\n                  execPath, name, iconSrc);\n            } else {\n               /*\n                * On failure to retrieve or convert the icon to PNG, we use a\n                * fallback RPC to try and retrieve it from the running instance.\n                * The fallback is susceptible to a race condition if the server\n                * application is changing icons when the RPC arrives, giving us\n                * an outdated icon. However we should only need to send the RPC\n                * rarely, and the race condition should be even rarer, so we can\n                * reasonably ignore this case.\n                *\n                * PNG conversion will fail if canvas is not supported (IE9), so\n                * the RPC will let us continue to support IE9.\n                */\n               getIconDataHelper(wmksKey, windowId, function(data) {\n                  let iconSrc = !!data ? data :\n                     AB.CONST.ICONS.BIG_DEFAULT_ICON;\n                  unityService.emit('appAttrChanged', wmksKey, windowPath,\n                     execPath, name, iconSrc);\n               });\n            }\n         }, function(error) {\n            AB.LOGGER.info(\n               'Failed to retrieve binary info for window path ' +\n               windowPath + ' with error: ' + error);\n         });\n      },\n\n      isUnityRunning: function(key) {\n         let unityMgr = unityMgrMap[key];\n         if (unityMgr) {\n            return unityMgr.isOn && !unityMgr.paused;\n         } else {\n            return false;\n         }\n      }\n   };\n\n   $.extend(unityService, helper);\n\n   init();\n   return unityService;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/remoteapp/unity-service.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport desktopTemplate from './common/desktop.html';\n\n\nexport default function routeConfig($routeProvider) {\n   $routeProvider\n      .when('/desktop', {\n         templateUrl: desktopTemplate,\n         reloadOnSearch: false,\n         controller: 'DesktopCtrl'\n      });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/route.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview audiocapture.js -- AudioCapture\n * Class to handle audio capturing\n *\n * Support but not recommand to change the default sample rate.\n */\n\nimport RTAV from './logservice';\n\nexport default function AudioCapture() {\n   this.clipBuffer =\n      new this.ClipBuffer(AudioCapture.clipTarget, AudioCapture.clipBufferLen);\n   this.previousSampleRate = null;\n   this.inited = false;\n};\n\n// It's one of the API required length, so need to clip before\n// compress+translate\nAudioCapture.bufferLen = 512;\n// Required length at service side\nAudioCapture.clipTarget = 160;\n// A length enough for buffering the data\nAudioCapture.clipBufferLen = 1024;\n// browser API sample rate\nAudioCapture.machineSampleRate = 44100;\n\nAudioCapture.statusEnum = {\n   Uninited: 'Uninited',\n   Inited: 'Inited',\n   Working: 'Working'\n};\n\n/**\n * Get what status this audio src is in, cuurently only Uinited is detected,\n * but keep the API as it for future extension and debugging\n * @return {string} This returns one of the AudioCapture.statusEnum of\n *    'Uninited', 'Inited', 'Working'\n */\nAudioCapture.prototype.getStatus = function() {\n   let status;\n   if (!this.inited) {\n      status = AudioCapture.statusEnum['Uninited'];\n   } else {\n      if (this.paused) {\n         status = AudioCapture.statusEnum['Inited'];\n      } else {\n         status = AudioCapture.statusEnum['Working'];\n      }\n   }\n   return status;\n};\n\n/**\n * Init capturing audio by binding events to the passed in stream, and for each\n * data segment, call the callback with it. Similar to mAudInput.Open for\n * native clients, use prefs and timer, but here also pass in stream and\n * callback which is done differently for native clients. and the caller should\n * be similar to VCamServer::InitAudioInDev, to reset sync timer if needed. It\n * looks like \"open\" but the real open didn't happen here, it's acctually init\n * the opened source, we do not open it here to avoid anoying hint diaglog\n * which is forced by some browsers like firefox.\n *\n * @param  {object} syncTimer The timer object user to sync audio and video\n * @param  {function} callback The function for dealing with each frame\n */\nAudioCapture.prototype.init = function(audioParam, syncTimer, callback) {\n   let sampleRate = audioParam.sampleRate;\n\n   if (this.inited) {\n      RTAV.logService.error(\n         'this audio capture has already been inited, init fail');\n      return;\n   }\n   if (typeof callback !== 'function') {\n      return;\n   }\n\n   if (!sampleRate || sampleRate <= 0) {\n      sampleRate = 8000;\n   }\n   if (sampleRate >= AudioCapture.machineSampleRate) {\n      RTAV.logService.devError('do not support sample rate greater than 44100');\n   }\n\n   if (this.previousSampleRate !== sampleRate) {\n      if (this.hasOwnProperty('resampler') && !!this.resampler) {\n         delete this.resampler;\n      }\n      this.resampler =\n         new this.Resampler(AudioCapture.machineSampleRate, sampleRate, AudioCapture.bufferLen);\n   }\n\n   this.callback = callback;\n   this.paused = true;\n   this.syncTimer = syncTimer;\n\n   this.inited = true;\n};\n\n/**\n * Clear the status and release audio capture related resources which make this\n * srouce to start a new srouce for another stream session(start_A and stop_A).\n * But be aware of that, the stream object which will hold the devices will not\n * be release in this level, but in the mediacapture.clear(). and that should\n * only happen when the wmks session don't want RTAV anymore, like when the\n * wmks session is closed.\n */\nAudioCapture.prototype.clear = function() {\n   if (!this.inited) {\n      RTAV.logService.error('this audio capture is not inited, clear fail');\n      return;\n   }\n   if (!this.paused) {\n      RTAV.logService.trace(\n         'negative: the audio capture is not stopped yet, stop it before clear it.');\n      this.stop();\n   }\n   this.scriptNode = null;\n   this.mediaCtx = null;\n   this.mediaStreamSource = null;\n   // Edge seems not support close method which is defined in html5 standard\n   // for now, so we need the check\n   if (!!this.audioContext && typeof this.audioContext.close === 'function') {\n      this.audioContext.close();\n   }\n   this.audioContext = null;\n   this.clipBuffer.reset();\n   this.resampler.reset();\n   this.inited = false;\n   this.paused = true;\n   this.losingDevice = false;\n   this.deviceUnpluged = false;\n   this.localStream = null;\n};\n\n/**\n * Start capturing data with inited param\n * @param  {object} stream The stream object obtained by the getUserMedia\n */\nAudioCapture.prototype.start = function(stream) {\n   let numChannelsIn = 1,\n      numChannelsOut = 1;\n\n   if (!stream) {\n      RTAV.logService.error('the audio stream is not valid, start fail');\n      return;\n   }\n   if (!this.inited) {\n      RTAV.logService.error(\n         'the audio capture is not being inited, start fail');\n      return;\n   }\n   if (!this.paused) {\n      RTAV.logService.error(\n         'find existing audio capturing session, start fail');\n      return;\n   }\n\n   this.lastValidTime = -1;\n   this.freezeCount = 0;\n   this.losingDevice = false;\n   this.deviceUnpluged = false;\n   this.audioContext = new window.AudioContext();\n   this.localStream = stream;\n   this.mediaStreamSource = this.audioContext.createMediaStreamSource(stream);\n   this.mediaCtx = this.mediaStreamSource.context;\n   this.scriptNode =\n      this.mediaCtx.createScriptProcessor(AudioCapture.bufferLen, numChannelsIn,\n         numChannelsOut);\n   this.scriptNode.onaudioprocess = function(event) {\n      let clip,\n         capturedData,\n         resampledBuff;\n      if (this.paused) {\n         return;\n      }\n\n      this.updateActiveStatus();\n      // Buffer has length specified in _useStream\n      capturedData = event.inputBuffer.getChannelData(0);\n      resampledBuff = this.resampler.process(capturedData);\n      // Add the samples immediately to the Clip, with correct format(float32\n      // to uint16)\n      this.clipBuffer.add(resampledBuff, this.syncTimer.getTime());\n      clip = this.clipBuffer.getClip();\n      if (!!clip) {\n         // The callback should compress the clip, and send the compressed data\n         // in package on VVC.\n         this.callback(clip);\n      }\n   }.bind(this);\n\n   this.mediaStreamSource.connect(this.scriptNode);\n   this.scriptNode.connect(this.mediaCtx.destination);\n   this.paused = false;\n};\n\n/**\n * Stop capturing data, and enter waiting status.\n */\nAudioCapture.prototype.stop = function() {\n   if (!this.inited) {\n      RTAV.logService.error('the audio capture is not being inited, stop fail');\n      return;\n   }\n   if (this.paused) {\n      RTAV.logService.error('find no audio capturing session, stop fail');\n      return;\n   }\n   this.mediaStreamSource.disconnect(this.scriptNode);\n   this.scriptNode.disconnect(this.mediaCtx.destination);\n   //since its in the single thread, set the puase flag here is early enough\n   this.paused = true;\n   this.losingDevice = false;\n   this.deviceUnpluged = false;\n};\n\n/**\n * Update the device active status\n */\nAudioCapture.prototype.updateActiveStatus = function() {\n   let freezeTolerence = AudioCapture.machineSampleRate /\n      AudioCapture.bufferLen;\n\n   if (!!this.localStream.currentTime) {\n      if (this.localStream.currentTime === this.lastValidTime) {\n         this.freezeCount = this.freezeCount + 1;\n         if (!this.losingDevice && this.freezeCount > freezeTolerence) {\n            this.losingDevice = true;\n            RTAV.logService.trace(\n               'negative: seems the audio device becomes invalid, please check');\n            RTAV.resourceManager.emitDeviceStatusChanged();\n         }\n      } else {\n         if (this.localStream.currentTime > 0) {\n            this.lastValidTime = this.localStream.currentTime;\n         }\n         this.freezeCount = 0;\n         if (this.losingDevice) {\n            this.losingDevice = false;\n            RTAV.logService.trace(\n               'negative: seems the audio device becomes valid again, which means it might unstable');\n            RTAV.resourceManager.emitDeviceStatusChanged();\n         }\n      }\n   }\n\n   if (!!this.localStream && typeof this.localStream.active === 'boolean') {\n      if (!this.localStream.active && !this.deviceUnpluged) {\n         this.deviceUnpluged = true;\n         RTAV.logService.trace('negative: seems the audio device is unpluged');\n         RTAV.resourceManager.emitDeviceStatusChanged();\n      }\n   }\n};\n\n/**\n * This returns whether the device can provide valid data\n */\nAudioCapture.prototype.isActive = function() {\n   return !this.losingDevice && !this.deviceUnpluged;\n};\n\n/**\n * FIFO clipper buffer\n * @param {number} segmentLength [description]\n * @param {number} buffsize      [description]\n */\nAudioCapture.prototype.ClipBuffer = function(segmentLength, buffsize) {\n   /**\n    * Init the instance\n    */\n   this.init = function() {\n      this.segmentLength = segmentLength;\n      this.buffsize = buffsize;\n      this.buff = new Uint16Array(this.buffsize);\n      this.reset();\n   };\n\n   this.reset = function() {\n      this.startIndex = 0;\n      this.tailIndex = 0;\n      this.length = 0;\n      this.lastTimeStamp = {\n         value: 0,\n         index: 0\n      };\n      this.newTimeStamp = {\n         value: 0,\n         index: 0\n      };\n   };\n\n   /**\n    * A simple float to short(int16) converting function\n    * @param  {number} floatNum A number in the range [-1,1]\n    * @return {number} This returns a short number in the range [-32767, 32767]\n    */\n   this.convertToShort = function(floatNum) {\n      let maxShortValue = 32767;\n      return Math.round(maxShortValue * floatNum);\n   };\n\n   /**\n    * Add data to the ClipBuffer with floating number converted to short\n    * @param {Array} data\n    * @param {number} timeStamp\n    */\n   this.add = function(data, timeStamp) {\n      let i, k;\n      if (data.length > this.buffsize - this.length) {\n         return;\n      }\n\n      this.lastTimeStamp.value = this.newTimeStamp.value;\n      this.lastTimeStamp.index = this.newTimeStamp.index;\n      for (i = 0, k = this.tailIndex; i < data.length;\n           i++, k = (k + 1) % this.buffsize) {\n         this.buff[k] = this.convertToShort(data[i]);\n      }\n      this.length += data.length;\n      this.tailIndex = (this.tailIndex + data.length) % this.buffsize;\n      this.newTimeStamp.value = timeStamp;\n      this.newTimeStamp.index = this.tailIndex;\n   };\n\n   /**\n    * get the extended index to easy the calculation of accurate timestamp\n    * @param  {number} srcIndex The original index, which might get extended if\n    *    too small\n    * @param  {number} minIndex The lower bound of the index\n    * @return {number} This returns the extended index which is larger or equal\n    *    to minIndex\n    */\n   this.getExtendedIndex = function(srcIndex, minIndex) {\n      if (srcIndex < minIndex) {\n         return srcIndex + this.buffsize;\n      } else {\n         return srcIndex;\n      }\n   };\n\n   /**\n    * Get a object with ArrayBuffer as data and number as timeStamp if possible\n    * @return {object|null}\n    */\n   this.getClip = function() {\n      let i,\n         k,\n         resultLength,\n         result,\n         sampleExtenedIndex,\n         newExtenedIndex,\n         lastIndex,\n         addup,\n         timeStamp;\n\n      if (this.length < this.segmentLength) {\n         return null;\n      }\n\n      // shift out the data\n      resultLength = this.length - this.length % this.segmentLength;\n      result = new Uint16Array(resultLength);\n      for (i = 0, k = this.startIndex; i < resultLength;\n           i++, k = (k + 1) % this.buffsize) {\n         result[i] = this.buff[k];\n      }\n      this.length -= result.length;\n      this.startIndex = (this.startIndex + result.length) % this.buffsize;\n\n      // calculate the corresponding timeStamp with linear assumsion, which\n      // should be acurate enough for the currect use case\n      lastIndex = this.lastTimeStamp.index;\n      sampleExtenedIndex = this.getExtendedIndex(this.startIndex, lastIndex);\n      newExtenedIndex =\n         this.getExtendedIndex(this.newTimeStamp.index, lastIndex);\n      // approximate increamental time from the 2nd last newTimeStamp, and that\n      // is using linear assumsion with 2nd last and last newTimeStamp to get.\n      addup = (this.newTimeStamp.value - this.lastTimeStamp.value) /\n         (newExtenedIndex - lastIndex) * (sampleExtenedIndex - lastIndex);\n      // add the increamental time to 2nd last newTimeStamp, and get the result\n      // timeStamp\n      timeStamp = Math.round(this.lastTimeStamp.value + addup);\n      return {\n         data: result.buffer,\n         timeStamp: timeStamp\n      };\n   };\n   this.init();\n};\n\n/**\n * Resampler for converting data in high sample rate to lower.\n * @param {number} originalRate The input sample rate\n * @param {number} targetRate   The target sample rate\n * @param {number} inputSize    The input data length\n */\nAudioCapture.prototype.Resampler =\n   function(originalRate, targetRate, inputSize) {\n      /**\n       * Init the instance\n       */\n      this.init = function() {\n         if (originalRate < targetRate) {\n            RTAV.logService.devError('resample can only have less samples');\n            return;\n         }\n         this.sampleIndexInc = originalRate / targetRate;\n         // Math.ceil(this.sampleIndexInc) * 2 is large enough extra space for\n         // the non-processed and being processed data\n         this.buffSize = inputSize + Math.ceil(this.sampleIndexInc) * 2;\n         this.buff = new Array(this.buffSize);\n         this.inputSize = inputSize;\n         this.reset();\n      };\n\n      this.reset = function() {\n         this.startIndex = 0;\n         this.tailIndex = 0;\n         this.sampleStartIndex = 0;\n      };\n\n      /**\n       * Insert data in the inner buffer\n       * @private\n       */\n      this.push = function(data) {\n         let i, k;\n         if (data.length > this.buffSize - this.length) {\n            return false;\n         }\n         for (i = 0, k = this.tailIndex; i < data.length;\n              i++, k = (k + 1) % this.buffSize) {\n            this.buff[k] = data[i];\n         }\n         this.tailIndex = (this.tailIndex + data.length) % this.buffSize;\n         return true;\n      };\n\n      /**\n       * @return {float} return the resampled value\n       */\n      this.getResampledData = function(startIndex, endIndex) {\n         let i,\n            is, ie,\n            ws, we,\n            sum;\n\n         // Start index of included data segment(included)\n         is = Math.ceil(startIndex);\n         // End index of included data segment(not included)\n         ie = Math.floor(endIndex);\n         // The persentage of sample that should be count in before the\n         // included data segment\n         ws = (is - startIndex);\n         // The persentage of sample that should be count in after the included\n         // data segment\n         we = (endIndex - ie);\n         // Count in the data before the included data segment\n         sum = ws * this.buff[Math.floor(startIndex)];\n         // Count in the data after the included data segment\n         if (we > 0) {\n            sum += we * this.buff[ie];\n         }\n         // Count in the included data segment\n         if (ie < is) {\n            ie += this.buffSize;\n            for (i = is; i < ie; i++) {\n               sum += this.buff[i % this.buffSize];\n            }\n         } else {\n            for (i = is; i < ie; i++) {\n               sum += this.buff[i];\n            }\n         }\n         return sum / this.sampleIndexInc;\n      };\n\n      /**\n       * @param  {number} index\n       * @return {boolean} This returns whether the index is in the valid range\n       */\n      this.isInRange = function(index) {\n         if (this.startIndex < this.tailIndex) {\n            return (index <= this.tailIndex) && (index >= this.startIndex);\n         }\n         return (index >= this.startIndex) || (index <= this.tailIndex);\n      };\n\n      /**\n       * Using reverting check to tell when both input index are valid, whether\n       * the range in between is also valid\n       * @param  {number}  sampleIndexStart The valid start index of the range\n       * @param  {number}  sampleIndexEnd The valid end index of the range\n       * @return {Boolean} This returns whether the range in between valid\n       *    index contains invalid data\n       */\n      this.isInCorrectOrder = function(sampleIndexStart, sampleIndexEnd) {\n         if (this.startIndex < this.tailIndex) {\n            // with normal order of valid data, sample should also be normal\n            // order\n            return sampleIndexStart < sampleIndexEnd;\n         }\n         // with revert order of valid data, sample can't across the bind\n         return sampleIndexStart > this.tailIndex ||\n            sampleIndexEnd < this.startIndex;\n      };\n\n      /**\n       * Using isInCorrectOrder and isInRange to check whether the sub-range\n       * are valid or not.\n       * @return {boolean} This returns whether we can access the elements in\n       *    the range.\n       */\n      this.validSubRange = function(sampleIndexStart, sampleIndexEnd) {\n         return this.isInRange(sampleIndexStart) &&\n            this.isInRange(sampleIndexEnd) &&\n            this.isInCorrectOrder(sampleIndexStart, sampleIndexEnd);\n      };\n\n      this.deleteUsed = function() {\n         this.startIndex = Math.floor(this.sampleStartIndex);\n      };\n\n      /**\n       * @return {Array} return the resampled array\n       */\n      this.getResampledArray = function() {\n         let sampleIndexStart = this.sampleStartIndex,\n            sampleIndexEnd = (sampleIndexStart + this.sampleIndexInc) %\n               this.buffSize,\n            i = 0,\n            result = [];\n\n         // while needed data are in the buff.\n         while (this.validSubRange(sampleIndexStart, sampleIndexEnd)) {\n            // get each resampled data\n            result[i] = this.getResampledData(sampleIndexStart, sampleIndexEnd);\n            // shift indexes accordingly after get the resampled data\n            i++;\n            sampleIndexStart = sampleIndexEnd;\n            sampleIndexEnd =\n               (sampleIndexStart + this.sampleIndexInc) % this.buffSize;\n         }\n         this.sampleStartIndex = sampleIndexStart;\n         this.deleteUsed();\n         return result;\n      };\n\n      /**\n       * Input data and would return the resampled array\n       * @param  {Array} data The array of length inputSize and with sample\n       *    rate originalRate\n       * @return {Array|null} This returns the array of data with sample rate\n       *    targetRate\n       */\n      this.process = function(data) {\n         let resampled;\n\n         if (data.length !== this.inputSize) {\n            return null;\n         }\n         if (!this.push(data)) {\n            return null;\n         }\n         resampled = this.getResampledArray();\n         if (!resampled) {\n            return null;\n         }\n         return resampled;\n      };\n\n      this.init();\n   };\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/audiocapture.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview devicemessagemanager.js -- DeviceMessageManager\n * Class contains the logic for device related messages, mainly works\n * as a status converter since we need to mock response to avoid pending\n * agent response for too long when agent ask whether has devices.\n */\n\n/**\n * Class contains the main logic of logic for device related messages\n * @type {function}\n */\n\nimport RTAV from './logservice';\n\nexport default function DeviceMessageManager(controller) {\n   let unprocessedMessageQueues,\n      actionMap,\n      actionIDMap,\n      permissionDialogPending,\n      localMessageController,\n      nextTargetDeviceInfo,\n      actionNames,\n      messageWaitManager;\n\n   let init = function(controller, self) {\n      unprocessedMessageQueues = {\n         audio: [],\n         video: [],\n         none: []\n      };\n      nextTargetDeviceInfo = null;\n      actionMap = [\"None\", \"Stop\"];\n      actionIDMap = {\n         \"Start\": -1,\n         \"None\": 0,\n         \"Stop\": 1\n      };\n      permissionDialogPending = {\n         audio: false,\n         video: false\n      };\n      localMessageController = controller;\n      localMessageController.deviceMessageManager = self;\n      actionNames = {\n         \"Start\": \"Start\",\n         \"None\": \"None\",\n         \"Stop\": \"Stop\"\n      };\n      messageWaitManager = new RTAV.MessageWaitManager();\n   };\n\n   let getFinalAction = function(type) {\n      let i, queue, sum;\n      if (unprocessedMessageQueues[type] === undefined || unprocessedMessageQueues[type].length === 0) {\n         return actionNames[\"None\"];\n      }\n      queue = unprocessedMessageQueues[type];\n      sum = 0;\n      for (i = 0; i < queue.length; i++) {\n         sum = sum + queue[i];\n         if (sum < 0 || sum > 1) {\n            RTAV.logService.error('unexpected agent messages detected while user not accepting permission, ');\n            return actionNames[\"None\"];\n         }\n      }\n      return actionMap[sum];\n   };\n\n   let clearQueue = function(type) {\n      RTAV.logService.trace(\"queue for \" + type + \" is cleared\");\n      unprocessedMessageQueues[type] = [];\n   };\n\n   let pushUnprocessedMessage = function(type, action) {\n      RTAV.logService.trace(action + \" is added into \" + type + \" queue\");\n      unprocessedMessageQueues[type].push(actionIDMap[action]);\n   };\n\n   let processMessage = function(messageType, self) {\n      if (!localMessageController) {\n         RTAV.logService.devError(\"uninited controller\");\n         return;\n      }\n      messageWaitManager.process(messageType, function() {\n         switch (messageType) {\n            case 'PMsgStart_A':\n               localMessageController.enableAudioIn(function(success) {\n                  if (success) {\n                     RTAV.logService.debug('audio device successfully enabled');\n                  } else {\n                     RTAV.logService.debug('audio device fail to be enabled');\n                  }\n               }, self);\n               break;\n            case 'PMsgStop_A':\n               localMessageController.disableAudioIn();\n               RTAV.logService.debug('audio device is disabled');\n               break;\n            case 'PMsgStart_V':\n               localMessageController.enableVideoIn(function(success) {\n                  if (success) {\n                     RTAV.logService.debug('video device successfully enabled');\n                  } else {\n                     RTAV.logService.debug('video device fail to be enabled');\n                  }\n               }, self);\n               break;\n            case 'PMsgStop_V':\n               localMessageController.disableVideoIn();\n               RTAV.logService.debug('video device is disabled');\n               break;\n         }\n      });\n   };\n\n   let self = {\n      /**\n       * process the action of in out type\n       * @param {string} messageType The message name\n       * @param {string} type Of audio or video to indicate which kind of device\n       *     we should operate on\n       * @param {string} action Of Start or Stop to indicate which kind of action\n       *     we should do\n       */\n      processAction: function(messageType, type, action) {\n         if (this.isPermissionPending(type)) {\n            pushUnprocessedMessage(type, action);\n         } else {\n            if (this.isPermissionPending() && action === actionNames[\"Start\"]) {\n               RTAV.logService.debug(\"hold the permission dialog for \" + type + \" for now for previous dialog still exist\");\n               nextTargetDeviceInfo = {\n                  messageType: messageType,\n                  type: type,\n                  action: action\n               };\n            } else {\n               processMessage(messageType, this);\n            }\n         }\n      },\n\n      /**\n       * should be called when get device related message\n       * @param {string} messageType Message name\n       * @param {function} callback Optimal The callback should be called with\n       *     bool indicate whether success\n       */\n      onMessage: function(messageType, callback) {\n         let type, action;\n         switch (messageType) {\n            case 'PMsgStop_A':\n               type = \"audio\";\n               action = actionNames[\"Stop\"];\n               break;\n            case 'PMsgStart_A':\n               type = \"audio\";\n               action = actionNames[\"Start\"];\n               break;\n            case 'PMsgStop_V':\n               type = \"video\";\n               action = actionNames[\"Stop\"];\n               break;\n            case 'PMsgStart_V':\n               type = \"video\";\n               action = actionNames[\"Start\"];\n               break;\n            default:\n               type = \"none\";\n               action = actionNames[\"None\"];\n         }\n\n         // start events need callback\n         if (typeof callback === \"function\") {\n            localMessageController.processWhenHaveResources(function(canProcess) {\n               callback(canProcess);\n               if (canProcess) {\n                  this.processAction(messageType, type, action);\n               } else {\n                  RTAV.logService.log(\"do nothing for \" + messageType + \" since session is not allow to be processed\");\n               }\n            }.bind(this));\n         } else {\n            this.processAction(messageType, type, action);\n         }\n         return true;\n      },\n\n      /**\n       * function to perform the hold message of another type than current\n       * @param {bool} needReinit Whether to reinit the stream\n       */\n      precessHoldMessage: function(needReinit) {\n         let pendingDeviceType,\n            pendingMessageType,\n            finalAction;\n\n         if (!!nextTargetDeviceInfo) {\n            /**\n             * since agent might send the start stop message pair, client\n             * should to cancel them, and dothing for a better user exprience,\n             * meanwhile client has to pretent it did those action to agent\n             * since RDSH agent has a almost-unfixable bug that always assume\n             * client will known the premission right after\n             */\n            pendingDeviceType = nextTargetDeviceInfo.type;\n            pendingMessageType = nextTargetDeviceInfo.messageType;\n            finalAction = getFinalAction(pendingDeviceType);\n            clearQueue(pendingDeviceType);\n            if (finalAction === actionNames[\"Stop\"]) {\n               RTAV.logService.debug(\"previous premission dialog is dismissed, but do nothing for \" +\n                  pendingDeviceType + \", since we need to start then stop it\");\n               nextTargetDeviceInfo = null;\n               return;\n            }\n            /**\n             * reset the stream status to started status for resolve bug 1750132,\n             * since it will make the status of the client to further mismatch\n             * from the status in the agent status, so we need to sync them when\n             * possible to avoid other regressions caused by the mismatch.\n             */\n            if (needReinit) {\n               RTAV.logService.debug(\"previous premission dialog just get dismissed but device released, so restart streaming\");\n               messageWaitManager.process(\"restartStream\", function() {\n                  localMessageController.restartStream();\n               });\n            }\n            RTAV.logService.debug(\"previous premission dialog is dismissed, now pop out another dialog for \" + pendingMessageType);\n            processMessage(pendingMessageType, this);\n            nextTargetDeviceInfo = null;\n         }\n      },\n\n      /**\n       * function should be called when premission is handled\n       * @param {string} type Of audio or video indicate which premission is handled\n       */\n      onPermissionHandled: function(type) {\n         RTAV.logService.trace('premission dialog is closed');\n         if (!permissionDialogPending[type]) {\n            RTAV.logService.devError(\"the inner logic is wrong, the premission dialog seems get disapper\");\n            return;\n         }\n         let action = getFinalAction(type);\n         clearQueue(type);\n         permissionDialogPending[type] = false;\n         RTAV.logService.trace('when ' + type + 'dialog get dismissed, the queued action is ' + action);\n\n         // Stop is the only message we need to handle so far\n         if (action === actionNames[\"Stop\"]) {\n            if (type === 'audio') {\n               processMessage('PMsgStop_A');\n               this.precessHoldMessage(true);\n            } else if (type === 'video') {\n               processMessage('PMsgStop_V');\n               this.precessHoldMessage(true);\n            }\n         } else {\n            messageWaitManager.process(\"restartStream\", function() {\n               localMessageController.restartStream();\n            });\n            this.precessHoldMessage(false);\n         }\n         messageWaitManager.process(\"onPermissionHandled\", function() {\n            if (!this.isPermissionPending()) {\n               localMessageController.onPermissionHandled();\n            }\n         }.bind(this));\n      },\n\n      /**\n       * function should be called when premission is asked\n       * @param {string} type Of audio or video indicate which premission is asked\n       */\n      onPermissionAsked: function(type) {\n         if (permissionDialogPending[type]) {\n            RTAV.logService.devError(\"the inner logic is wrong, the premission dialog seems get duplicated\");\n            return;\n         }\n         permissionDialogPending[type] = true;\n         RTAV.resourceManager.emitDeviceStatusChanged();\n         RTAV.logService.trace('premission dialog poped out');\n      },\n\n      /**\n       * function to known whether premission is being asked for specified type\n       * @param {string} type Of audio or video indicate which premission is asked\n       * @return {boolean} This returns whether premission is being asked for\n       *     specified type\n       */\n      isPermissionPending: function(type) {\n         if (!!nextTargetDeviceInfo && nextTargetDeviceInfo.type === type) {\n            RTAV.logService.trace(\"the premission dialog of type \" + type + \" is hold so treat as pending\");\n            return true;\n         }\n         if (type !== undefined) {\n            return permissionDialogPending[type];\n         }\n         return permissionDialogPending['audio'] || permissionDialogPending['video'] || !!nextTargetDeviceInfo;\n      }\n   };\n   init(controller, self);\n   return self;\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/devicemessagemanager.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * @fileoverview dialogservice.js -- dialogService\n * Service to decouple the dialog implementation from UI layer\n */\n\nimport RTAV from './logservice';\n\nlet dialogService = (() => {\n   let uiDialogCallback;\n   return {\n      setDialogFunction: function(dialogFunction) {\n         uiDialogCallback = dialogFunction;\n      },\n      showDialog: function(info, okCallback, cancelCallback) {\n         if (typeof uiDialogCallback !== 'function') {\n            RTAV.logService.devError('the uiDialogCallback doesn\\'t exist');\n            return;\n         }\n         uiDialogCallback(info, okCallback, cancelCallback);\n      }\n   };\n})();\n\nexport default dialogService;\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/dialogservice.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview frameratecontroller.js -- FrameRateController\n * Class to help calculate the wait time in ms with target fps,\n * when fps is 0, always return the suggested wait time as 0 ms.\n */\n\nimport RTAV from './logservice';\n\nexport default function FrameRateController() {\n   this.lastCaptureTime = 0;\n   this.targetInterval = 0;\n   this.fpsLogTime = 60;\n   this.fpsInfo = {\n      count: -1,\n      startTime: 0\n   };\n};\n\n/**\n * set the fps info for calculating the target interval in ms.\n * @param {number} fps The target frame rate.\n */\nFrameRateController.prototype.setFPS = function(fps) {\n   // fps lies here\n   if (fps < 0) {\n      RTAV.logService.devError('fps can never be a negative number');\n      return;\n   }\n   if (fps === 0) {\n      this.targetInterval = 0; // no rate limitation\n   } else {\n      this.targetInterval = (1000 / fps);\n   }\n   this.lastCaptureTime = 0;\n   this.fpsInfo = {\n      count: -1,\n      startTime: 0\n   };\n};\n\n/**\n * Get current time in ms\n * @priavte\n */\nFrameRateController.prototype.getNow = function() {\n   return (new Date()).getTime();\n};\n\n/**\n * Get the suggested wait time to capture the next frame\n * @return {number} This returns the suggested wait time to capture the next frame\n */\nFrameRateController.prototype.getWaitTime = function() {\n   let passedTime = this.getNow() - this.lastCaptureTime;\n   return Math.max(0, this.targetInterval - passedTime);\n};\n\n/**\n * Used to calculate the real-time fps, should be called when starting a frame sending\n * Currently It returns nothing and will print a log each %this.fpsLogTime% seconds\n * @param  {number} currentTime The currentTime in ms\n */\nFrameRateController.prototype.updateRealFPS = function(currentTime) {\n   let difftime;\n\n   if (this.fpsInfo.count === -1) {\n      this.fpsInfo.count = 0;\n      this.fpsInfo.startTime = currentTime;\n   } else {\n      difftime = (currentTime - this.fpsInfo.startTime) / 1000;\n      if (this.fpsLogTime > 0 && difftime >= this.fpsLogTime) {\n         RTAV.logService.trace(\"fps = \" + (this.fpsInfo.count + 1) / difftime);\n         this.fpsInfo.count = 0;\n         this.fpsInfo.startTime = currentTime;\n      } else {\n         this.fpsInfo.count++;\n      }\n   }\n};\n\n/**\n * The function to update the knowledge of when the last frame is captured\n */\nFrameRateController.prototype.onFrameCaptured = function() {\n   this.lastCaptureTime = this.getNow();\n   this.updateRealFPS(this.lastCaptureTime);\n};\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/frameratecontroller.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview mediacapture.js -- MediaCapture\n * Class based on AudioCaptuer & VideoCapture to handle media capturing\n * depend on AudioCapture, VideoCapture, and SyncTimer\n *\n * the callback is used to pull the next video frame, while audio need no such\n *    an property since it push the data out.\n *\n * API:\n * No init API, after new or clear, the instance should be in the started\n *    status\n * We need to detect stopstream instead of dealing with that message is caused\n *    by the fact that the agent doesn't implement that message.\n *\n * open: get device\n * close: release device, Close the instance with all hardware resources\n *    released. startStream: get device and ready to capture any data\n *    stopCapturing: reset and return to the original status(started) after\n *    created enable(type): enable the capturing of data of specified type\n *    disable(type): disable the capturing of data of specified type\n */\n\nimport RTAV from './logservice';\n\n\nexport default function MediaCapture() {\n   let supportHTML5Audio,\n      MediaStream;\n\n   window.AudioContext = window.AudioContext || window.webkitAudioContext ||\n      window.mozAudioContext;\n   navigator.getUserMedia =\n      navigator.getUserMedia || navigator.webkitGetUserMedia ||\n      navigator.mozGetUserMedia || navigator.msGetUserMedia ||\n      navigator.mediaDevices.getUserMedia;\n\n   supportHTML5Audio = !!window.AudioContext && !!navigator.getUserMedia;\n   if (!supportHTML5Audio) {\n      RTAV.logService.error(\n         'browser does not support HTML5 media in, creating media source fails');\n      return null;\n   }\n   RTAV.logService.log('browser supports HTML5 media in');\n   /**\n    * MediaStream is an experimental technology, so add this compatible codes\n    * to provide the same API for the new and old browsers\n    */\n   MediaStream = window.MediaStream || window.webkitMediaStream;\n   if (MediaStream !== undefined) {\n      if (!MediaStream.prototype.hasOwnProperty('stop')) {\n         MediaStream.prototype.stop = function() {\n            this.getAudioTracks().forEach(function(track) {\n               track.stop();\n            });\n            this.getVideoTracks().forEach(function(track) {\n               track.stop();\n            });\n         };\n      }\n   }\n\n   this.syncTimer = new RTAV.SyncTimer();\n   this.audioCapture = new RTAV.AudioCapture();\n   this.videoCapture = new RTAV.VideoCapture();\n   if (!this.audioCapture || !this.videoCapture || !this.syncTimer) {\n      RTAV.logService.error(\n         'capture instance is not created, creating media source fails');\n      return null;\n   }\n   this.streamStarted = false;\n   this.isEnabled = {\n      audio: false,\n      video: false\n   };\n   this.resourcesHold = {\n      audio: false,\n      video: false\n   };\n   this.localStream = {\n      audio: null,\n      video: null\n   };\n};\n\n/**\n * Stop both video and audio if possible.\n * @private\n */\nMediaCapture.prototype.disableAll = function() {\n   if (this.isEnabled.audio) {\n      this.disable('audio');\n   }\n   if (this.isEnabled.video) {\n      this.disable('video');\n   }\n};\n\n/**\n * Close the instance with all hardware resources released.\n * @param  {string} type The type name of device of the request\n */\nMediaCapture.prototype.close = function(type) {\n   if (!this.resourcesHold[type]) {\n      RTAV.logService.debug('no need to close ' + type + ' device');\n      this.localStream[type] = null;\n      return;\n   }\n   if (!!this.localStream[type] &&\n      typeof this.localStream[type].stop === 'function') {\n      this.localStream[type].stop();\n      RTAV.logService.log(\n         'rtav source is closed, ' + type + ' hardware get released');\n   } else {\n      RTAV.logService.log('rtav source is closed, but ' + type +\n         ' hardware might fail to be released');\n   }\n   this.localStream[type] = null;\n   this.resourcesHold[type] = false;\n};\n\n/**\n * Stop capture audio and video, and release the devices\n * after clear this instance should look like a new object\n */\nMediaCapture.prototype.stopCapturing = function() {\n   // ensure stop\n   if (this.streamStarted) {\n      RTAV.logService.debug(\n         'negative: there is at least one of stream capture session, so disable them before stopping capture');\n      this.disableAll();\n   }\n\n   // clear audio/video capture\n   this.syncTimer.clear();\n   if (this.audioCapture.getStatus() !==\n      RTAV.AudioCapture.statusEnum['Uninited']) {\n      this.audioCapture.clear();\n   }\n   if (this.videoCapture.getStatus() !==\n      RTAV.VideoCapture.statusEnum['Uninited']) {\n      this.videoCapture.clear();\n   }\n   this.streamStarted = false;\n   this.isEnabled.audio = false;\n   this.isEnabled.video = false;\n};\n\n/**\n * Async process to get control of audio & video devices\n * @param {string} type The device tpye name of open request\n * @param {function} openDone The callback with a bool as open succcess or not\n * @param {object} deviceMessageController This param is used to emit\n *    premission dialog related events\n */\nMediaCapture.prototype.open =\n   function(type, openDone, deviceMessageController) {\n      let deviceRequest = {\n            audio: false,\n            video: false\n         },\n         successCallback,\n         errorCallback;\n\n      successCallback = function(stream) {\n         this.localStream[type] = stream;\n         this.resourcesHold[type] = true;\n         openDone(true);\n         deviceMessageController.onPermissionHandled(type);\n      }.bind(this);\n      errorCallback = function(e) {\n         RTAV.logService.debug(\n            'negative: can\\'t get the rtav device, so rtav will not working' +\n            e);\n         openDone(false);\n         deviceMessageController.onPermissionHandled(type);\n      };\n      deviceRequest[type] = true;\n      if (!this.resourcesHold[type]) {\n         navigator.getUserMedia(deviceRequest, successCallback, errorCallback);\n         deviceMessageController.onPermissionAsked(type);\n      }\n   };\n\n/**\n * Start capture audio and video\n * This function fit for the message startstream, and will ensure both the\n * audio and video source inited\n * @param  {function} audioCallback The callback funciton used to deal with\n *    cauptured audio\n * @param  {function} videoCallback The callback funciton used to deal with\n *    cauptured video\n */\nMediaCapture.prototype.startStream =\n   function(deviceParam, audioCallback, videoCallback) {\n      if (this.streamStarted) {\n         RTAV.logService.log(\n            'the media capture has already being \"streamStarted\" status, skip start');\n         return;\n      }\n      if (!this.isEnabled.audio && !this.isEnabled.video) {\n         RTAV.logService.log(\n            'the media capture try to start with none of the video nor audio enabled, please check whether video device exist');\n      }\n\n      if (!this.resourcesHold.audio && !this.resourcesHold.video) {\n         RTAV.logService.log(\n            'no stream hold before trying to start capturing, please check whether video device exist ');\n      }\n\n      RTAV.logService.debug('starting the source stream');\n\n      this.syncTimer.reset();\n      this.audioCapture.init(deviceParam.audio, this.syncTimer,\n         function(sample) {\n            audioCallback(sample);\n         }.bind(this));\n      this.videoCapture.init(deviceParam.video, this.syncTimer,\n         function(sample) {\n            videoCallback(sample);\n         }.bind(this));\n\n      // we need to start start the audio/video capturing if that is enabled\n      if (this.isEnabled.audio) {\n         this.audioCapture.start(this.localStream['audio']);\n      }\n      if (this.isEnabled.video) {\n         this.videoCapture.start(this.localStream['video']);\n      }\n      this.streamStarted = true;\n   };\n\n/**\n * Disable the capturing of data of specified type\n * @param  {string} type This param is one of the 'audio' and 'video'.\n */\nMediaCapture.prototype.disable = function(type) {\n   if (!this.resourcesHold[type]) {\n      RTAV.logService.log(\n         'call disable when no device hold, video device might be missing');\n   }\n   if (this.streamStarted) {\n      if (type === 'audio') {\n         this.audioCapture.stop();\n      } else if (type === 'video') {\n         this.videoCapture.stop();\n      }\n      this.close(type);\n   }\n   this.isEnabled[type] = false;\n   /**\n    * this code is to detect stopStream\n    * The agent implement the stopstream this way, so client need to do work\n    * accordingly. if detected, the source will stop working but that can be\n    * recoveried by enable audio/video and startstream again.\n    */\n   if (!this.isEnabled.audio && !this.isEnabled.video) {\n      this.streamStarted = false;\n      this.stopCapturing();\n   }\n};\n\n/**\n * Enable the capturing of data of specified type\n * @param  {string} type This param is one of the 'audio' and 'video'.\n * @param  {function} openDone This param is the callback will be called with a\n *    bool to indicate success or not\n * @param  {object} deviceMessageController This param is used to emit\n *    premission dialog related events\n */\nMediaCapture.prototype.enable =\n   function(type, openDone, deviceMessageController) {\n      if (this.isEnabled[type]) {\n         RTAV.logService.error(\n            'try to re-enable a media source of type ' + type);\n         openDone(false);\n         return;\n      }\n\n      this.open(type, function(success) {\n         if (type === 'video' && !success) {\n            openDone(true, true);\n         } else {\n            openDone(success);\n         }\n         if (success) {\n            if (this.streamStarted) {\n               if (type === 'audio') {\n                  this.audioCapture.start(this.localStream[type]);\n               } else if (type === 'video') {\n                  this.videoCapture.start(this.localStream[type]);\n               }\n            }\n            this.isEnabled[type] = true;\n         }\n      }.bind(this), deviceMessageController);\n   };\n\n/**\n * return whether the device of given type is active\n * @param  {string} type This param is one of the 'audio' and 'video'.\n */\nMediaCapture.prototype.isActive = function(type) {\n   if (type === 'audio') {\n      return this.audioCapture.isActive();\n   } else if (type === 'video') {\n      return this.videoCapture.isActive();\n   }\n   return false;\n};\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/mediacapture.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview audioworker.js -- audioWorker\n * Class to wrap audio and video encoding\n * encoderStatus need to be extended to also constains wmksSessionID and param\n * if we want to support seamless window with RTAV.\n */\n\nimport RTAV from './logservice';\n\nexport default function MediaEncoder() {\n   // private Class\n   let LimitedSet,\n      // priavte properties:\n      workers,\n      headers,\n      callbacks,\n      resourcesCount,\n      enabled,\n      encodingEnvs,\n      encoderStatus,\n      messageManager,\n      // private functions:\n      resetEncoder,\n      initInstance,\n      arrayCopy,\n      setMergedHeader,\n      handleMessage,\n      handleAudioMessage,\n      handleVideoMessage,\n      encode,\n      clearWorker,\n      clear;\n\n   /**\n    * We choose to use an extra bool list instead of the special value in the buffer to mark\n    * @private\n    */\n   LimitedSet = function(capacity) {\n      this.buff = new Array(capacity);\n      this.occupied = Array.apply(null, Array(capacity)).map(Boolean.prototype.valueOf, false);\n      this.insert = function(item) {\n         let i;\n         for (i = 0; i < this.occupied.length; i++) {\n            if (!this.occupied[i]) {\n               this.buff[i] = item;\n               this.occupied[i] = true;\n               return i;\n            }\n         }\n         return -1;\n      };\n      // single thread, and inner usage, so skip id tests\n      this.fetch = function(id) {\n         this.occupied[id] = false;\n         return this.buff[id];\n      };\n   };\n\n   resetEncoder = function() {\n      headers = {\n         audio: null,\n         video: null,\n         merged: null\n      };\n      callbacks = {\n         video: null,\n         audio: null,\n         header: null\n      };\n      /**\n       * number used for PV operation avoid taking too much of resources in the event queue,\n       * and the values are get by testing on different machines, the bigger the number\n       * the less data is dropped, but the more delay might exist.\n       * in the release phase, if this object constains like 1, 1, we can change them into boolean,\n       * but better to keep it for now without testing with the finalized codes.\n       * @type {object}\n       */\n      resourcesCount = {\n         audio: 1,\n         video: 1\n      };\n      encodingEnvs = {\n         audio: new LimitedSet(resourcesCount.audio),\n         video: new LimitedSet(resourcesCount.video)\n      };\n      encoderStatus = {\n         audio: {\n            beingUsed: false\n         },\n         video: {\n            beingUsed: false\n         }\n      };\n      enabled = false;\n   };\n\n   initInstance = function() {\n      try {\n         workers = {\n            audio: new Worker(\"./audioworker.\" + __BUILD_NUMBER__ + \".js\"),\n            video: new Worker(\"./videoworker.\" + __BUILD_NUMBER__ + \".js\")\n         };\n\n      } catch (e) {\n         workers = {\n            audio: null,\n            video: null\n         };\n      }\n      workers.audio.onmessage = handleAudioMessage;\n      workers.video.onmessage = handleVideoMessage;\n\n      resetEncoder();\n   };\n\n   arrayCopy = function(src, srcPtr, dst, dstPtr, length) {\n      let srcArray = new Uint8Array(src, srcPtr, length),\n         dstArray = new Uint8Array(dst, dstPtr, length);\n\n      dstArray.set(srcArray);\n   };\n\n   setMergedHeader = function() {\n      let streamHeaderLength = RTAV.constants.streamHeaderLength,\n         videoHeaderLength = headers.video.length + streamHeaderLength,\n         audioHeaderLength = headers.audio.length,\n         mergedLength = videoHeaderLength + audioHeaderLength,\n         mergedHeaderBuffer = new ArrayBuffer(mergedLength);\n\n      arrayCopy(headers.video.buffer, 0, mergedHeaderBuffer, 0, videoHeaderLength);\n      arrayCopy(headers.audio.buffer, streamHeaderLength, mergedHeaderBuffer, videoHeaderLength, audioHeaderLength);\n\n      headers.merged = {\n         buffer: mergedHeaderBuffer,\n         length: mergedLength - streamHeaderLength\n      };\n   };\n\n   handleMessage = function(e, dataType) {\n      let message = e.data,\n         callback,\n         env;\n\n      if (!enabled) {\n         return;\n      }\n      switch (message.type) {\n         case 'InitDone':\n            headers[dataType] = message.data;\n            if (typeof callbacks.header !== 'function') {\n               RTAV.logService.devError('header callback doesn\\'t exist');\n               return;\n            }\n            if (!!headers.video && !!headers.audio) {\n               setMergedHeader();\n               callbacks.header(headers.merged);\n            }\n            break;\n         case 'Encoded':\n            env = encodingEnvs[dataType].fetch(message.envId);\n            if (!env || !env.metaData) {\n               RTAV.logService.debug('negative: bad env readed, might caused by switching devices to other desktop');\n               return;\n            }\n            callback = callbacks[dataType];\n            if (typeof callback !== 'function') {\n               RTAV.logService.devError('encoding callback doesn\\'t exist');\n               return;\n            }\n            callback(message.data, env.metaData, env.others);\n            resourcesCount[dataType]++;\n            break;\n         case 'Cleared':\n            RTAV.logService.log(dataType + ' encoder cleared:' + message.success);\n            break;\n      }\n   };\n\n   handleAudioMessage = function(e) {\n      handleMessage(e, 'audio');\n   };\n\n   handleVideoMessage = function(e) {\n      handleMessage(e, 'video');\n   };\n\n   encode = function(sample, type) {\n      let dataBuffer,\n         envId;\n\n      if (!workers[type] || !sample || !sample.data) {\n         return;\n      }\n      if (resourcesCount[type] > 0) {\n         resourcesCount[type]--;\n         dataBuffer = sample.data;\n         envId = encodingEnvs[type].insert({\n            others: sample.others,\n            metaData: sample.timeStamp\n         });\n         if (envId < 0) {\n            RTAV.logService.devError('when encoding media data, environment object can\\'t be saved');\n            return;\n         }\n         workers[type].postMessage({\n            type: 'Encode',\n            data: dataBuffer,\n            envId: envId\n         }, [dataBuffer]);\n      }\n   };\n\n   clearWorker = function(type) {\n      if (!!workers[type]) {\n         workers[type].postMessage({\n            type: 'Clear'\n         });\n      }\n   };\n\n   /**\n    * This function is to release the resources for encoding.\n    */\n   clear = function() {\n      RTAV.logService.debug('clear encoders for none of audio and video is used');\n      clearWorker('audio');\n      clearWorker('video');\n      resetEncoder();\n   };\n\n   initInstance();\n\n   return {\n      /**\n       * Init the encoder using params and register the callbacks to handle header and encoded data\n       * now we will provide no default value, so caller must prepare the good init param for initialize\n       * @param  {object} audioParam      The param used to init audio encoder\n       * @param  {object} videoParam      The param used to init video encoder\n       * @param  {function} headerCallback  The callback use to handle inited header\n       * @param  {function} audioCallback The callback use to handle encoded audio\n       * @param  {function} videoCallback The callback use to handle encoded video\n       */\n      init: function(audioParam, videoParam, headerCallback, audioCallback, videoCallback) {\n         let videoWorker = workers.video,\n            audioWorker = workers.audio;\n\n         if (!videoWorker || !audioWorker || enabled) {\n            return;\n         }\n         callbacks = {\n            header: headerCallback,\n            audio: audioCallback,\n            video: videoCallback\n         };\n         audioParam.logLevel = RTAV.logService.getLevel();\n         videoParam.logLevel = audioParam.logLevel;\n         // althought js is non-preemptive, put enabled = true to later place will add complex for UT\n         enabled = true;\n         audioWorker.postMessage({\n            type: 'Init',\n            data: audioParam,\n         });\n         videoWorker.postMessage({\n            type: 'Init',\n            data: videoParam\n         });\n      },\n\n      clear: clear,\n\n      /**\n       * @param  {object} sample {data: {Int16Array}, timeStamp: {number}}\n       */\n      encodeAudio: function(sample) {\n         encode(sample, 'audio');\n      },\n\n      /**\n       * @param  {object} sample {data: {Uint8Array}, timeStamp: {number}}\n       */\n      encodeVideo: function(sample) {\n         encode(sample, 'video');\n      },\n\n      /**\n       * When we don't need to use the encoder of type, one should call this function to release resources\n       * and also set the media encoder to be ready for re-inited. it's related to stop_A and stop_V message\n       * @param  {string} type The encoder type name, should be 'audio' or 'video'\n       */\n      disable: function(type) {\n         if (!encoderStatus[type].beingUsed) {\n            RTAV.logService.debug('negative: no need to disable a disabled encoder: ' + type);\n            return;\n         }\n         encoderStatus[type].beingUsed = false;\n         // release all the resources when both encoder are in use no more.\n         if (!encoderStatus['audio'].beingUsed && !encoderStatus['video'].beingUsed) {\n            if (!messageManager) {\n               RTAV.logService.devError(\"messageManager don't exist when disable \" + type);\n               return;\n            }\n            if (messageManager.isPermissionPending()) {\n               RTAV.logService.debug(\"skip clear encoders since the premission dialog is still pending\");\n            } else {\n               clear();\n            }\n         }\n      },\n\n      /**\n       * When we need to use the encoder of type, one should call this function to record the use status and\n       * ready to release resources after both encoder are useded no more. it's related to start_A and start_V\n       * message.\n       * @param  {string} type The encoder type name, should be 'audio' or 'video'\n       */\n      enable: function(type) {\n         if (encoderStatus[type].beingUsed) {\n            RTAV.logService.error('fail to enable a enabled encoder: ' + type);\n            return;\n         }\n         encoderStatus[type].beingUsed = true;\n      },\n\n      /**\n       * return whether this encoder is inited\n       */\n      isInited: function() {\n         return enabled;\n      },\n\n      /**\n       * Get previously generated header from the cache, it can faster the whole process and avoid blink in video\n       */\n      fetchCachedHeader: function() {\n         if (!enabled) {\n            RTAV.logService.devError(\"fail to get cached header for enc is not inited yet\");\n         }\n         if (typeof callbacks.header !== 'function') {\n            RTAV.logService.devError(\"fail to get cached header for callback is not set yet\");\n         }\n         callbacks.header(headers.merged, true);\n      },\n\n      /**\n       * Used for Unit Tests to expose some of inner varibles, NEVER use it in the code.\n       * @return {obj} This returns the obj contains UT needed data references\n       */\n      utTestingAPIs: function() {\n         return {\n            headers: headers,\n            callbacks: callbacks\n         };\n      },\n\n      /**\n       * Used for get whether the encoder is working, for bug 1750132.\n       * @return {boolean} Whether any of audio or video is being used\n       */\n      notInUse: function() {\n         return !encoderStatus['audio'].beingUsed && !encoderStatus['video'].beingUsed;\n      },\n\n      /**\n       * Used to check the mismatch status before clear up.\n       * @param {object} manager A DeviceMessageManager instance\n       */\n      setMessageManager: function(manager) {\n         messageManager = manager;\n      }\n   };\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/mediaencoder.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview devicemessagemanager.js -- DeviceMessageManager\n * Class contains the logic for device related messages, mainly works\n * as a interval control since device can't be operated too frequently,\n * and no extra cancel logic are added since driver in the agent should\n * do this.\n *\n * And we can't process start right after stop, or stop right after start,\n * since the browser init is async and some will cause unexcepted errors.\n * and the 600ms is exprimential interval value to safely process actions\n *\n * Although adding minial processing interval for all messages are more safer,\n * and easy to implement, it look not needed and will decrease the user\n * experience somehow, so not use that design.\n */\n\nimport RTAV from './logservice';\n\n/**\n * Class contains the logic of what message need to wait\n * @type {function}\n */\nexport default function MessageWaitManager() {\n   let previousActions,\n      actionQueue,\n      actionWaitMap,\n      defaultWaitTime,\n      maxRecordDuration,\n      waitTimer,\n      //functions\n      getNow,\n      init,\n      reset,\n      setMaxRecordDuration,\n      updateBufferedActions,\n      getWaitTimeForAction,\n      getWaitTime,\n      getDefaultActionWaitTime,\n      processQueue,\n      canProcess,\n      onProcess,\n      onWait;\n\n   getNow = function() {\n      return (new Date()).getTime();\n   };\n\n   reset = function() {\n      previousActions = [];\n      actionQueue = [];\n      waitTimer = null;\n   };\n\n   /**\n    * it should be >= max(actionWaitMap[k].time, defaultWaitTime), for all valid k\n    */\n   setMaxRecordDuration = function() {\n      let key;\n\n      maxRecordDuration = defaultWaitTime;\n      for (key in actionWaitMap) {\n         if (actionWaitMap.hasOwnProperty(key)) {\n            maxRecordDuration = Math.max(maxRecordDuration, actionWaitMap[key].time);\n         }\n      }\n   };\n\n   init = function() {\n      /**\n       * @private\n       * @type {Object}\n       * The format is as: {\n       *    previousActionName: {\n       *       name: laterActionName,\n       *       time: intervalTime\n       *    },\n       *    ...\n       * }\n       * and it means if previously we process the message of previousActionName,\n       * we must at least wait intervalTime before processing later action of name\n       * laterActionName.\n       * Choose the same value as the highDelay in the Agent as 600.\n       */\n      actionWaitMap = {\n         \"PMsgStart_V\": {\n            name: \"PMsgStop_V\",\n            time: 600 //ms\n         },\n         \"PMsgStop_V\": {\n            name: \"PMsgStart_V\",\n            time: 600 //ms\n         },\n         \"PMsgStart_A\": {\n            name: \"PMsgStop_A\",\n            time: 600 //ms\n         },\n         \"PMsgStop_A\": {\n            name: \"PMsgStart_A\",\n            time: 600 //ms\n         }\n      };\n      defaultWaitTime = 0; //ms for any messages\n      setMaxRecordDuration();\n      reset();\n   };\n   init();\n\n   /**\n    * clear outdated record in previousActions, which is sorted by time order\n    */\n   updateBufferedActions = function() {\n      let i,\n         oldestRecoderTime = getNow() - maxRecordDuration,\n         clipIndex = -1;\n\n      for (i = 0; i < previousActions.length; i++) {\n         if (previousActions[i].time <= oldestRecoderTime) {\n            clipIndex = i;\n         } else {\n            break;\n         }\n      }\n      if (clipIndex >= 0) {\n         previousActions.splice(0, clipIndex + 1);\n      }\n   };\n\n   /**\n    * get wait time for a specifyed action\n    */\n   getWaitTimeForAction = function(messageType, currentTime, previousAction) {\n      let alreadyWaitTime,\n         actionWaitTime,\n         waitInfo;\n\n      if (!actionWaitMap.hasOwnProperty(previousAction.name)) {\n         return 0;\n      }\n      waitInfo = actionWaitMap[previousAction.name];\n      if (waitInfo.name !== messageType) {\n         return 0;\n      }\n      actionWaitTime = waitInfo.time;\n      alreadyWaitTime = currentTime - previousAction.time;\n      return Math.max(0, actionWaitTime - alreadyWaitTime);\n   };\n\n   /**\n    * get wait time for default action, which apply to all messages\n    */\n   getDefaultActionWaitTime = function(currentTime) {\n      let alreadyWaitTime;\n\n      if (previousActions.length === 0) {\n         return 0;\n      }\n      alreadyWaitTime = currentTime - previousActions[previousActions.length - 1].time;\n\n      return Math.max(0, defaultWaitTime - alreadyWaitTime);\n   };\n\n   /**\n    * get overall wait time\n    */\n   getWaitTime = function(messageType) {\n      let i,\n         currentTime = getNow(),\n         waitTime = getDefaultActionWaitTime(currentTime);\n\n      for (i = 0; i < previousActions.length; i++) {\n         waitTime = Math.max(waitTime, getWaitTimeForAction(messageType, currentTime, previousActions[i]));\n      }\n      return waitTime;\n   };\n\n   processQueue = function() {\n      let nextAction;\n      if (actionQueue.length === 0) {\n         return;\n      }\n      nextAction = actionQueue[0];\n      if (waitTimer !== null) {\n         RTAV.logService.trace(\"there is a message waiting, wait that to be processed first\");\n         return;\n      }\n\n      RTAV.logService.trace(\"start timer for \" + nextAction.messageType);\n      waitTimer = setTimeout(function() {\n         actionQueue.shift();\n         waitTimer = null;\n         onProcess(nextAction.messageType);\n         nextAction.processingFunction();\n         processQueue();\n      }, getWaitTime(nextAction.messageType));\n   };\n\n   canProcess = function(messageType) {\n      return getWaitTime(messageType) === 0 && actionQueue.length === 0;\n   };\n   onProcess = function(messageType) {\n      RTAV.logService.debug(\"start executing message \" + messageType);\n      updateBufferedActions();\n      previousActions.push({\n         name: messageType,\n         time: getNow()\n      });\n   };\n   onWait = function(messageType, processingFunction) {\n      actionQueue.push({\n         messageType: messageType,\n         processingFunction: processingFunction\n      });\n      processQueue();\n   };\n   return {\n      /**\n       * This function will run the processingFunction as the order they passed\n       * in, and will keep them apart from each other to leave enough interval\n       * as defined in the actionWaitMap\n       * @param {string} messageType The action Name\n       * @param {funciton} processingFunction The function for the action\n       */\n      process: function(messageType, processingFunction) {\n         if (canProcess(messageType)) {\n            onProcess(messageType);\n            processingFunction();\n         } else {\n            onWait(messageType, processingFunction);\n            RTAV.logService.debug(\"waiting for message \" + messageType);\n         }\n      },\n      /**\n       * This is for UT only, and should not be used by program.\n       * @type {Object}\n       */\n      APIforUT: {\n         getPreviousActions: function() {\n            return previousActions;\n         },\n         getActionQueue: function() {\n            return actionQueue;\n         },\n         getMaxRecordDuration: function() {\n            return maxRecordDuration;\n         },\n         getWaitTimer: function() {\n            return waitTimer;\n         }\n      }\n   };\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/messagewaitmanager.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview resourcemanager.js -- resourceManager\n * Service to handle resources(mainly audio-in and video-in devices) management\n *\n * currently we only allow devices to be used by one of the wmks session, and before it\n * releases the resources, other sesion can not get the resouce.\n */\n\nimport RTAV from './logservice';\n\nlet resourceManager = (function() {\n   let activeSessionID = null,\n      resourcePool = null,\n      // private function\n      initResourcesPool,\n      deviceStatusChangeCallback;\n\n   initResourcesPool = function(onDone) {\n      let mediaSrc;\n      if (!resourcePool) {\n         resourcePool = {\n            src: new RTAV.MediaCapture(),\n            mediaEnc: new RTAV.MediaEncoder()\n         };\n      }\n      onDone(resourcePool);\n   };\n\n   return {\n      /**\n       * Used to check whether there is any usable devices\n       * cuurrently we only allow device to be used by one desktop at a time.\n       * @return {Boolean} This returns whether there is any usable devices\n       */\n      hasUsableResources: function() {\n         return activeSessionID === null;\n      },\n\n      /**\n       * Used to check whether a session have usable devices, and if not we should not\n       * process the RTAV function on that session.\n       * currently we only have one session can work, so the condition is very simple.\n       * @param {string}  sessionID The ID of the session that will be checked.\n       * @return {Boolean} This returns whether the device has already been occupied\n       */\n      hasOccupiedResources: function(sessionID) {\n         return activeSessionID === sessionID;\n      },\n\n      /**\n       * Used to occupy device for specified session.\n       * Should only be call this API when hasOccupiedResources returns false, and hasUsableResources returns true.\n       * @param {string} sessionID The ID of session that wants to occupy the devices\n       * @param {function} onDone The callback to pass resources out, null means fail to occupy\n       */\n      occupyResources: function(sessionID, onDone) {\n         if (this.hasOccupiedResources(sessionID)) {\n            RTAV.logService.devError('session \"' + sessionID + '\" has already occupy a device');\n            onDone(null);\n            return;\n         }\n         if (!this.hasUsableResources()) {\n            RTAV.logService.devError('there is no rest device for session \"' + sessionID + '\"');\n            onDone(null);\n            return;\n         }\n         activeSessionID = sessionID;\n\n         this.emitDeviceStatusChanged();\n\n         initResourcesPool(onDone);\n      },\n\n      /**\n       * Used to release device for specified session.\n       * Should only be call this API when hasOccupiedResources returns true.\n       * @param {string} sessionID The ID of session that wants to release the devices\n       * @param {bool} forcibly Whether bypass the owner ship check to release owner's devices\n       * @param {function} onDone The callback to pass resources out, null means fail to occupy\n       */\n      releaseResources: function(sessionID, forcibly) {\n         if (!forcibly && !this.hasOccupiedResources(sessionID)) {\n            RTAV.logService.error('session \"' + sessionID + '\" hasn\\'t occupied a device');\n            return;\n         }\n         activeSessionID = null;\n      },\n\n      /**\n       * Set the callback function to detect the device status changes\n       * @param {function} callback The callback function passed from the UI layer\n       */\n      onDeviceStatusChanged: function(callback) {\n         deviceStatusChangeCallback = callback;\n      },\n\n      /**\n       * Trigger DeviceStatusChanged function from outside\n       */\n      emitDeviceStatusChanged: function() {\n         if (typeof deviceStatusChangeCallback === 'function') {\n            deviceStatusChangeCallback();\n         }\n      },\n\n      /**\n       * @return {string} This returns the current device using id, if not in use, return null\n       */\n      getWorkingSessionId: function() {\n         return activeSessionID;\n      },\n\n      /**\n       * Let a new session steal device from current using session\n       * @param  {string} sessionID The new session ID\n       * @param  {function} onDone  The callback function once the device hand over is finished\n       */\n      stealSession: function(sessionID, onDone) {\n         if (!sessionID || typeof onDone !== 'function') {\n            return;\n         }\n         RTAV.wmksAdapter.userStopSession(activeSessionID);\n         this.occupyResources(sessionID, onDone);\n      },\n\n      /**\n       * Close the devices for RTAV, later usage must require another premission\n       * @param  {string} sessionID The ID of session from which this function is called\n       * since we close device when not using them, there is no need to close them manully anymore\n       */\n      closeDevices: function(sessionID) {\n         if (!sessionID || !this.hasOccupiedResources(sessionID)) {\n            return;\n         }\n         RTAV.wmksAdapter.userStopSession(sessionID);\n      }\n   };\n}());\n\nexport default resourceManager;\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/resourcemanager.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview rtav-service.js -- RTAVService\n * Service implement RTAV feature for WebClient\n */\n\nimport RTAV from './logservice';\nimport './rtavconstants';\nimport './rtavsettings';\nimport DeviceMessageManager from './devicemessagemanager';\nimport dialogService from './dialogservice';\nimport SyncTimer from './synctimer';\nimport FrameRateController from './frameratecontroller';\nimport MessageWaitManager from './messagewaitmanager';\nimport AudioCapture from './audiocapture';\nimport VideoCapture from './videocapture';\nimport MediaCapture from './mediacapture';\nimport './typedarraysupport';\nimport MediaEncoder from './mediaencoder';\nimport resourceManager from './resourcemanager';\nimport rtavProtocolService from './rtavprotocolservice';\nimport RtavSessionController from './rtavsessioncontroller';\nimport RtavSession from './rtavsession';\nimport wmksAdapter from './wmksadapter';\n\n\nRTAV.dialogService = dialogService;\nRTAV.SyncTimer = SyncTimer;\nRTAV.FrameRateController = FrameRateController;\nRTAV.MessageWaitManager = MessageWaitManager;\nRTAV.DeviceMessageManager = DeviceMessageManager;\nRTAV.AudioCapture = AudioCapture;\nRTAV.VideoCapture = VideoCapture;\nRTAV.MediaCapture = MediaCapture;\nRTAV.MediaEncoder = MediaEncoder;\nRTAV.resourceManager = resourceManager;\nRTAV.rtavProtocolService = rtavProtocolService;\nRTAV.RtavSessionController = RtavSessionController;\nRTAV.RtavSession = RtavSession;\nRTAV.wmksAdapter = wmksAdapter;\n\n\nlet RTAVService = {\n   onConnecting: RTAV.wmksAdapter.addSession,\n   onConnected: RTAV.wmksAdapter.activeSession,\n   onDisconnected: RTAV.wmksAdapter.removeSession,\n   onDeviceStatusChanged: RTAV.resourceManager.onDeviceStatusChanged,\n   setDialogHandler: RTAV.dialogService.setDialogFunction\n};\nif (Object.freeze) {\n   RTAVService = Object.freeze(RTAVService);\n}\n\nexport default RTAVService;\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/rtav-service.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview rtavconstants.js -- constants\n * object holds RTAV related constants\n */\n\nimport RTAV from './logservice';\n\nconst constants = {\n   AVPluginState: {\n      STChannelClose: 0,\n      STChannelOpen: 1,\n      STOff: 2,\n      STOn: 3,\n      STPending_AIn: 4,\n      STEnabled_AIn: 5,\n      STEnabled_V: 6,\n      STEnabled_VAIn: 7,\n      STError: 8\n   },\n   rtavTypes: {\n      PMsgGetConfig: 4,\n      PMsgSetConfig: 5,\n      PMsgGetCliSettings: 6,\n      PMsgSetCliSettings: 7,\n      PMsgStart_A: 8,\n      PMsgStart_A_Ack: 9,\n      PMsgStart_A_Ack_Err: 10,\n      PMsgStop_A: 11,\n      PMsgStop_A_Ack: 12,\n      PMsgStop_A_Ack_Err: 13,\n      PMsgStart_V: 14,\n      PMsgStart_V_Ack: 15,\n      PMsgStart_V_Ack_Err: 16,\n      PMsgStop_V: 17,\n      PMsgStop_V_Ack: 18,\n      PMsgStop_V_Ack_Err: 19,\n      PMsgStartStream: 21,\n      PMsgStopStream: 22,\n      PMsgBinData: 24\n   },\n   streamHeaderLength: 16\n};\n\nRTAV.constants = constants;\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/rtavconstants.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * @fileoverview rtavprotocolservice.js -- rtavProtocolService\n * Service implement RTAV feature for WebClient, depend on MediaCapture, and MediaEncoder\n */\n\nimport RTAV from './logservice';\n\nlet rtavProtocolService = (function() {\n   let constants = {},\n      util = {},\n      getSendingBinary,\n      parseRecievedMessage;\n\n   constants.codecTypes = {\n      CodecNone: 0,\n      CodecSpeex: 1,\n      CodecTheora: 2,\n      CodecTheoraSpeex: 3,\n      CodecVmwSpeex: 4,\n      CodecVmwTheora: 5,\n      CodecVmwTheoraSpeex: 6\n   };\n   constants.rtavTypes = RTAV.constants.rtavTypes;\n   constants.streamHeaderLength = RTAV.constants.streamHeaderLength;\n\n   util.convertU32 = function(n) {\n      return [\n         (n & 0xFF000000) >>> 24, (n & 0x00FF0000) >>> 8, (n & 0x0000FF00) << 8, (n & 0x000000FF) << 24\n      ].reduce(function(a, b) {\n         return a + b;\n      });\n   };\n\n   /**\n    * Contains protocol formation information for sending to get streamlized binary data.\n    * @type {function}\n    */\n   getSendingBinary = (function() {\n      let getNetWork,\n         uint32ToUint8,\n         getRtavControlPacket32,\n         extendZeros,\n         getDevPrefsNet,\n         streamlizersMap;\n\n      getNetWork = function(src) {\n         let i,\n            dst = [];\n\n         for (i = 0; i < src.length; i++) {\n            dst[i] = util.convertU32(src[i]);\n         }\n         return dst;\n      };\n\n      uint32ToUint8 = function(array32) {\n         let i,\n            length8 = array32.length * 4,\n            buff8 = new Uint8Array((new Uint32Array(array32)).buffer),\n            array8 = new Array(length8);\n\n         for (i = 0; i < length8; i++) {\n            array8[i] = buff8[i];\n         }\n         return array8;\n      };\n\n      getRtavControlPacket32 = function(type, dataArray) {\n         let data,\n            networkBytes,\n            headerLength = 8,\n            dataLength = dataArray.length * 4 + headerLength,\n            typeCode = constants.rtavTypes[type];\n\n         if (typeof typeCode !== 'number') {\n            return;\n         }\n         data = [typeCode, dataLength].concat(dataArray);\n         networkBytes = new Uint8Array((new Uint32Array(data)).buffer);\n         return networkBytes;\n      };\n\n      extendZeros = function(length) {\n         let i,\n            result = new Array(length);\n         for (i = 0; i < length; i++) {\n            result[i] = 0;\n         }\n         return result;\n      };\n\n      getDevPrefsNet = function(localConfig) {\n         let audioSettings = localConfig.audio,\n            videoSettings = localConfig.video,\n            audioPrefs,\n            videoPrefs,\n            audioInDevPrefsNet,\n            videoCamDevPrefsNet;\n\n         audioPrefs = {\n            audFrameUnitLenMS: 20, // cAInUnitLenMS_Def = 20\n            audFrameUnitCount: 50, // cAInCacheUnitCount_Def = 50\n            queueLen: 10, // cAInQueueLen_Def = 10, but here set as 10\n            bitsPerSample: audioSettings.bitsPerSample,\n            channels: audioSettings.channels,\n            inputStreams: 1,\n            framesPerPacket: 1,\n            samplesPerSec: audioSettings.sampleRate\n         };\n         videoPrefs = {\n            fWidth: videoSettings.width,\n            fHeight: videoSettings.height,\n            frameRate: videoSettings.fps,\n            tPauseMS: 0,\n            queueLen: 10 // cWCamQueueLen_Def = 10\n         };\n         audioInDevPrefsNet = getNetWork([audioPrefs.audFrameUnitLenMS, audioPrefs.audFrameUnitCount, audioPrefs.queueLen, audioPrefs.bitsPerSample, audioPrefs.channels, audioPrefs.inputStreams, audioPrefs.framesPerPacket, audioPrefs.samplesPerSec].concat(extendZeros(20)));\n         videoCamDevPrefsNet = getNetWork([videoPrefs.fWidth, videoPrefs.fHeight, videoPrefs.frameRate, videoPrefs.tPauseMS, videoPrefs.queueLen].concat(extendZeros(20)));\n\n         return audioInDevPrefsNet.concat(videoCamDevPrefsNet);\n      };\n\n      streamlizersMap = {\n         sendConfig: function(config) {\n            let configArray = [8 * 4, RTAV.constants.AVPluginState['STOn'], config.versionNum, config.isEnabled, config.vdoRes.width, config.vdoRes.height, config.vdoFPS, config.reserved],\n               networkArray = getNetWork(configArray);\n\n            return getRtavControlPacket32('PMsgSetConfig', networkArray);\n         },\n\n         sendStartAudioAck: function() {\n            let networkArray = [];\n            return getRtavControlPacket32('PMsgStart_A_Ack', networkArray);\n         },\n\n         sendStartAudioNak: function() {\n            let networkArray = [];\n            return getRtavControlPacket32('PMsgStart_A_Ack_Err', networkArray);\n         },\n\n         sendStopAudioAck: function() {\n            let networkArray = [];\n            return getRtavControlPacket32('PMsgStop_A_Ack', networkArray);\n         },\n\n         sendStopAudioNak: function() {\n            let networkArray = [];\n            return getRtavControlPacket32('PMsgStop_A_Ack_Err', networkArray);\n         },\n\n         sendStartVideoAck: function(localConfig) {\n            let codecPref = constants.codecTypes['CodecVmwTheoraSpeex'];\n            return getRtavControlPacket32('PMsgStart_V_Ack', getNetWork([codecPref]).concat(getDevPrefsNet(localConfig)));\n         },\n\n         sendStartVideoNak: function() {\n            let networkArray = [];\n            return getRtavControlPacket32('PMsgStart_V_Ack_Err', networkArray);\n         },\n\n         sendStopVideoAck: function() {\n            let networkArray = [];\n            return getRtavControlPacket32('PMsgStop_V_Ack', networkArray);\n         },\n\n         sendStopVideoNak: function() {\n            let networkArray = [];\n            return getRtavControlPacket32('PMsgStop_V_Ack_Err', networkArray);\n         },\n\n         sendStream: function(messageData) {\n            let streamData,\n               streamHeader;\n\n            if (!messageData || !messageData.streamData) {\n               RTAV.logService.devError('trying to send a invalid stream');\n               return null;\n            }\n            streamData = messageData.streamData;\n            streamHeader = new Uint32Array(streamData.buffer, 0, 4);\n\n            streamHeader[0] = constants.rtavTypes['PMsgBinData'];\n            streamHeader[1] = streamData.length + constants.streamHeaderLength;\n            streamHeader[2] = messageData.timeStamp;\n            streamHeader[3] = messageData.dataCount;\n\n            return new Uint8Array(streamData.buffer);\n         },\n\n         sendClientSettings: function(localConfig) {\n            let codecPref = constants.codecTypes['CodecVmwTheoraSpeex'];\n            return getRtavControlPacket32('PMsgSetCliSettings', getNetWork([codecPref]).concat(getDevPrefsNet(localConfig)));\n         },\n\n         sendStopStream: function() {\n            let networkArray = [];\n            return getRtavControlPacket32('PMsgStopStream', networkArray);\n         }\n      };\n      return function(type, data) {\n         let getStream = streamlizersMap[type];\n         if (typeof getStream !== 'function') {\n            RTAV.logService.devError('unknown type to be streamlized');\n            return null;\n         }\n         if (type !== 'sendStream') {\n            RTAV.logService.trace(\"generating response \" + type);\n         }\n         return getStream(data);\n      };\n   }());\n\n   /**\n    * Contains reciever related logic and functions\n    * @type {object}\n    */\n   parseRecievedMessage = (function() {\n      let getMessageStruct,\n         parseStruct,\n         parseAdminPolicy;\n\n      getMessageStruct = function(message) {\n         let headerLength = 8,\n            header = new Uint32Array(message.data.slice(0, headerLength));\n         if (header[1] !== message.data.byteLength) {\n            return {\n               type: \"undefined\"\n            };\n         }\n         return {\n            type: header[0],\n            dataLength: header[1] - headerLength,\n            data: message.data.slice(8)\n         };\n      };\n\n      parseStruct = function(data, formats) {\n         let i, j, k, format, result = {},\n            array;\n         for (i = 0, j = 0, k = 0; i < formats.length; i++) {\n            format = formats[i];\n            if (typeof format === 'object') {\n               array = [];\n               for (j = 0; j < format.length; j++, k++) {\n                  array[j] = util.convertU32(data[k]);\n               }\n               result[format.name] = array;\n            } else {\n               result[format] = util.convertU32(data[k]);\n               k++;\n            }\n         }\n         return result;\n      };\n\n      parseAdminPolicy = function(rtavMessage) {\n         let configArray = new Uint32Array(rtavMessage.data),\n            format = ['dataLength', 'status', 'versionNum', 'isEnabled', 'vdoMaxFPS', 'vdoMaxResHeight', 'vdoMaxResWidth', 'vdoDefResHeight', 'vdoDefResWidth', {\n               length: 20,\n               name: 'reserved'\n            }],\n            adminPolicy;\n         adminPolicy = parseStruct(configArray, format);\n         if (adminPolicy.dataLength !== rtavMessage.dataLength) {\n            return null;\n         }\n         return adminPolicy;\n      };\n\n      return function(message) {\n         let adminPolicy,\n            rtavMessage = getMessageStruct(message),\n            parsedMessage = {\n               type: rtavMessage.type,\n               data: null\n            };\n\n         switch (rtavMessage.type) {\n            case constants.rtavTypes['PMsgGetConfig']:\n               // set admin policy, and set user config back to the Agent\n               adminPolicy = parseAdminPolicy(rtavMessage);\n               RTAV.logService.log(adminPolicy);\n               parsedMessage.data = adminPolicy;\n               break;\n            case constants.rtavTypes['PMsgGetCliSettings']:\n            case constants.rtavTypes['PMsgStart_A']:\n            case constants.rtavTypes['PMsgStop_A']:\n            case constants.rtavTypes['PMsgStart_V']:\n            case constants.rtavTypes['PMsgStop_V']:\n            case constants.rtavTypes['PMsgStartStream']:\n            case constants.rtavTypes['PMsgStopStream']:\n               break;\n            default:\n               RTAV.logService.error('unknown msg');\n               RTAV.logService.error(rtavMessage);\n               return null;\n         }\n         RTAV.logService.debug('recieve rtav message:' + JSON.stringify(parsedMessage));\n         return parsedMessage;\n      };\n   }());\n\n   return {\n      /**\n       * use to get rtav protocol message object into binary stream.\n       * @param {string} type The message type\n       * @param {object} data Optional The data that will be carried by the message\n       * @return {object} This will returns the binary message constructed from the inputs\n       */\n      getSendingBinary: getSendingBinary,\n      /**\n       * use to parse rtav protocol message into object.\n       * @param  {object} message The object contains binary message\n       * @return {object} This will returns the parsed Object of input message\n       */\n      parseRecievedMessage: parseRecievedMessage\n   };\n}());\n\nexport default rtavProtocolService;\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/rtavprotocolservice.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview rtavsession.js -- RtavSession\n * Service to handle wmks session management\n *\n * Class that holds channel, setting, as well as status. It depends on RtavSessionController, rtavProtocolService,\n * and also depends on local class RtavChannel, RtavSettingManager, RtavStatus\n */\n\nimport RTAV from './logservice';\n\n\n/**\n * Class that contains functions and logic for using the rtav sub channel\n * @type {function}\n */\nlet RtavChannel = function(vvcSession) {\n   let rtavChannel = null;\n\n   return {\n      initialize: function() {\n         //halt the sending and recieving if any thing goes wrong\n         let onChannelCloseError;\n\n         if (!vvcSession) {\n            return;\n         }\n         rtavChannel = vvcSession.openChannel('MultimediaRedirChannel', 10);\n         rtavChannel.onopen = function() {\n            RTAV.logService.log('rtav channel is opened');\n         };\n         onChannelCloseError = function() {\n            this.stop();\n         }.bind(this);\n         rtavChannel.onclose = onChannelCloseError;\n\n         rtavChannel.onerror = onChannelCloseError;\n         this.send = function(networkBytes) {\n            if (!networkBytes) {\n               return;\n            }\n            try {\n               vvcSession.send(rtavChannel, networkBytes);\n            } catch (e) {\n               RTAV.logService.log('error when sending rtav message:' + e);\n            }\n         };\n      },\n\n      send: function() {},\n\n      stop: function() {\n         if (!rtavChannel) {\n            return;\n         }\n         this.send = function() {\n            RTAV.logService.debug('stop one package sending for rtav channel is closed');\n         };\n         rtavChannel.onmessage = function() {\n            RTAV.logService.debug('stop one package recieving for rtav channel is closed');\n         };\n         rtavChannel = null;\n      },\n\n      setRecievedListener: function(onMessage) {\n         if (!rtavChannel) {\n            return;\n         }\n         rtavChannel.onmessage = onMessage;\n      }\n   };\n};\n\n/**\n * Class that contains functions and logic for managing and formating RTAV configurable settings\n * @type {function}\n */\nlet RtavSettingManager = function() {\n   let adminPolicy,\n      localConfig,\n      //private function\n      setLocalConfig;\n\n   // setting the local config with admin policy and ingore local settings since we avoid provide user UI for that.\n   setLocalConfig = function(adminPolicy) {\n      let localWidth,\n         localHeight,\n         localMaxFPS;\n\n      if (adminPolicy.vdoDefResWidth !== 0) {\n         // client set has no limit, use agent default value\n         localWidth = adminPolicy.vdoDefResWidth;\n      } else {\n         if (adminPolicy.vdoMaxResWidth !== 0) {\n            localWidth = Math.min(adminPolicy.vdoMaxResWidth, RTAV.settings.video.defResWidth);\n         } else {\n            localWidth = RTAV.settings.video.defResWidth;\n         }\n      }\n      if (adminPolicy.vdoDefResHeight !== 0) {\n         // client set has no limit, use agent default value\n         localHeight = adminPolicy.vdoDefResHeight;\n      } else {\n         if (adminPolicy.vdoMaxResHeight !== 0) {\n            localHeight = Math.min(adminPolicy.vdoMaxResHeight, RTAV.settings.video.defResHeight);\n         } else {\n            localHeight = RTAV.settings.video.defResHeight;\n         }\n      }\n      if (adminPolicy.vdoMaxFPS !== 0) {\n         if (RTAV.settings.video.defMaxFPS !== 0) {\n            localMaxFPS = Math.min(RTAV.settings.video.defMaxFPS, adminPolicy.vdoMaxFPS);\n         } else {\n            localMaxFPS = adminPolicy.vdoMaxFPS;\n         }\n      } else {\n         localMaxFPS = RTAV.settings.video.defMaxFPS;\n      }\n\n      // round the resolution since cpmpression lib suggest so.\n      if (localWidth % 16 !== 0) {\n         localWidth = Math.floor(localWidth / 16) * 16;\n      }\n      if (localHeight % 16 !== 0) {\n         localHeight = Math.floor(localHeight / 16) * 16;\n      }\n\n      localConfig = {\n         versionNum: adminPolicy.versionNum,\n         isEnabled: adminPolicy.isEnabled,\n         vdoRes: {\n            width: localWidth,\n            height: localHeight\n         },\n         vdoFPS: localMaxFPS,\n         reserved: 0\n      };\n   };\n   return {\n      setAdminPolicy: function(policy) {\n         adminPolicy = policy;\n         setLocalConfig(adminPolicy);\n      },\n\n      getLocalConfig: function() {\n         return localConfig;\n      },\n\n      getAudioDeviceSetting: function() {\n         return RTAV.settings.audio;\n      },\n\n      getVideoDeviceSetting: function() {\n         return {\n            width: localConfig.vdoRes.width,\n            height: localConfig.vdoRes.height,\n            fps: localConfig.vdoFPS\n         };\n      }\n   };\n};\n\n/**\n * Class that contains functions and logic for managing and formating RTAV configurable settings\n * @type {function}\n * It hasn't been fully implemented yet\n */\nlet RtavStatus = function() {\n   let currentStatus,\n      setStatus,\n      AVPluginState = RTAV.constants.AVPluginState;\n\n   setStatus = function(statusName) {\n      if (!AVPluginState.hasOwnProperty(statusName)) {\n         RTAV.logService.error('bad statusName to be set for rtav session');\n      }\n      currentStatus = AVPluginState[statusName];\n   };\n   currentStatus = setStatus('STChannelClose');\n\n   return {\n      set: setStatus,\n\n      processAllowed: function(actionName) {\n         return true;\n      }\n   };\n};\n\n/**\n * The Class that contains all information for a rtav session.\n * @param {string} sessionId  The ID of vvcSession\n * @param {object} vvcSession The vvcSession object passed from wmks, with send and openChannel API.\n */\nexport default function RtavSession(sessionId, vvcSession) {\n   let channel,\n      settingManager,\n      status,\n      controller,\n      protocol,\n      deviceMessageManager,\n      // private function\n      onMessage,\n      sendStopStream,\n      startStream;\n\n   settingManager = new RtavSettingManager();\n   channel = new RtavChannel(vvcSession);\n   status = new RtavStatus();\n   controller = new RTAV.RtavSessionController(sessionId);\n   protocol = RTAV.rtavProtocolService;\n   deviceMessageManager = new RTAV.DeviceMessageManager(controller);\n   controller.setMessageManager(deviceMessageManager);\n\n   onMessage = function(message) {\n      let parsedMessage = protocol.parseRecievedMessage(message),\n         adminPolicy,\n         localConfig,\n         deviceConfig,\n         rtavMessageTypes = RTAV.constants.rtavTypes,\n         success,\n         binaryData;\n\n      if (!parsedMessage) {\n         RTAV.logService.warn('skip processing for unknown message');\n         return;\n      }\n\n      switch (parsedMessage.type) {\n         case rtavMessageTypes['PMsgGetConfig']:\n            // set admin policy, and set user config back to the Agent\n            adminPolicy = parsedMessage.data;\n            settingManager.setAdminPolicy(adminPolicy);\n            localConfig = settingManager.getLocalConfig();\n            binaryData = protocol.getSendingBinary('sendConfig', localConfig);\n            channel.send(binaryData);\n            break;\n         case rtavMessageTypes['PMsgGetCliSettings']:\n            deviceConfig = {\n               audio: settingManager.getAudioDeviceSetting(),\n               video: settingManager.getVideoDeviceSetting()\n            };\n            binaryData = protocol.getSendingBinary('sendClientSettings', deviceConfig);\n            channel.send(binaryData);\n            break;\n         case rtavMessageTypes['PMsgStart_A']:\n            deviceMessageManager.onMessage('PMsgStart_A', function(success) {\n               if (success) {\n                  binaryData = protocol.getSendingBinary('sendStartAudioAck');\n               } else {\n                  binaryData = protocol.getSendingBinary('sendStartAudioNak');\n               }\n               channel.send(binaryData);\n            });\n            break;\n         case rtavMessageTypes['PMsgStop_A']:\n            success = deviceMessageManager.onMessage('PMsgStop_A');\n            if (success) {\n               binaryData = protocol.getSendingBinary('sendStopAudioAck');\n            } else {\n               binaryData = protocol.getSendingBinary('sendStopAudioNak');\n            }\n            channel.send(binaryData);\n            break;\n         case rtavMessageTypes['PMsgStart_V']:\n            deviceMessageManager.onMessage('PMsgStart_V', function(success) {\n               if (success) {\n                  deviceConfig = {\n                     audio: settingManager.getAudioDeviceSetting(),\n                     video: settingManager.getVideoDeviceSetting()\n                  };\n                  binaryData = protocol.getSendingBinary('sendStartVideoAck', deviceConfig);\n               } else {\n                  binaryData = protocol.getSendingBinary('sendStartVideoNak');\n               }\n               channel.send(binaryData);\n            });\n            break;\n         case rtavMessageTypes['PMsgStop_V']:\n            success = deviceMessageManager.onMessage('PMsgStop_V');\n            if (success) {\n               binaryData = protocol.getSendingBinary('sendStopVideoAck');\n            } else {\n               binaryData = protocol.getSendingBinary('sendStopVideoNak');\n            }\n            channel.send(binaryData);\n            break;\n         case rtavMessageTypes['PMsgStartStream']:\n            startStream();\n            break;\n         case rtavMessageTypes['PMsgStopStream']:\n            controller.stopMediaIn();\n            break;\n         default:\n            RTAV.logService.error('unknown msg');\n            break;\n      }\n   };\n\n   startStream = function() {\n      // cache the sending function with closure to maintain the correct context\n      let deviceConfig = {\n         audio: settingManager.getAudioDeviceSetting(),\n         video: settingManager.getVideoDeviceSetting()\n      };\n      // currently controller only has one active session, so one can pass no session info in.\n      controller.startMediaIn(deviceConfig, function(data) {\n         let binaryStream = protocol.getSendingBinary('sendStream', data);\n         channel.send(binaryStream);\n      });\n   };\n   controller.startStream = startStream;\n\n   sendStopStream = function() {\n      let binaryData;\n      binaryData = protocol.getSendingBinary('sendStopStream');\n      channel.send(binaryData);\n   };\n\n   return {\n      /**\n       * Will always start the rtav session, but might fail to get device and thus session has no data to send.\n       */\n      start: function() {\n         channel.initialize();\n         channel.setRecievedListener(onMessage);\n         controller.initialize();\n         status.set('STChannelOpen');\n      },\n\n      /**\n       * Stop the whole rtav, will clear all recources and disconnect from agent.\n       */\n      stop: function() {\n         channel.stop();\n         controller.stop();\n         status.set('STChannelClose');\n      },\n\n      /**\n       * User want to stop the rtav from working for now, but several resources will be kept for later usage.\n       */\n      userStop: function() {\n         controller.userStop();\n         sendStopStream();\n         status.set('STOff');\n      },\n\n      /**\n       * [isUsingDevices description]\n       * @param  {string}  type Optional Indicate whether asking for audio or video, when undefined, ask for either\n       * @return {boolean} This returns whether the asked type is in usage\n       */\n      isUsingDevices: function(type) {\n         return controller.isSendingStream(type);\n      },\n\n      /**\n       * [isUsingDevices description]\n       * @param  {string}  type Optional Indicate whether asking for audio or video, when undefined, ask for either\n       * @return {boolean} This returns whether the asked type is being asked for premission\n       */\n      isAskingPremission: function(type) {\n         return deviceMessageManager.isPermissionPending(type);\n      }\n   };\n};\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/rtavsession.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview rtavsessioncontroller.js -- RtavSessionController\n * Class contains the logic for each rtav action, or how to controll classes to complete\n * a target action like \"start streaming\" or \"enable audio\".\n */\n\n\nimport RTAV from './logservice';\n\n/**\n * Class contains the main logic of rtav session, which will be used\n * by the RTAV session\n * @type {function}\n */\nexport default function RtavSessionController(sessionId) {\n   let src,\n      mediaEnc,\n      sendingFunc,\n      metaCacheA,\n      metaCacheV,\n      dataChannel = {\n         audioEnable: false,\n         videoEnable: false,\n         // this flag is for fixing bug 1647044, where the device is missing but we should treat the enable as success\n         videoMissing: false\n      },\n      hasResources = false,\n      massageManager = null,\n      /**\n       * need to bind the sending function into a map with wmksId as key if we want to support seamless window,\n       * that could be done using a new object named sessionManager, and I will not implement that for now.\n       */\n      initDoneCallback,\n      audioDataCallback,\n      videoDataCallback,\n      //private functions\n      resetProperties,\n      initResources,\n      initEncoder,\n      releaseResources,\n      closeResources,\n      setResources;\n\n   /**\n    * reset for a new stream session\n    * @param  {[type]} sendingFunction [description]\n    * @return {[type]}                 [description]\n    */\n   resetProperties = function(sendingFunction) {\n      sendingFunc = sendingFunction;\n      metaCacheA = null;\n      metaCacheV = null;\n   };\n\n   initEncoder = function(deviceParam) {\n      let headerCallback = function(libHeader, isFackInit) {\n         initDoneCallback(libHeader, deviceParam, isFackInit);\n      };\n      if (!mediaEnc.isInited()) {\n         RTAV.logService.log('init encoders');\n         mediaEnc.init(deviceParam.audio, deviceParam.video, headerCallback, audioDataCallback, videoDataCallback);\n      } else {\n         RTAV.logService.log('encoders has already been inited, so fetch the header again');\n         mediaEnc.fetchCachedHeader();\n      }\n   };\n\n   setResources = function(resources, onDone) {\n      if (!resources) {\n         RTAV.logService.log('find no avaliable audio-in or video-in devices, so RTAV function is not usable');\n         onDone(false);\n      } else {\n         src = resources.src;\n         mediaEnc = resources.mediaEnc;\n         if (!!massageManager) {\n            mediaEnc.setMessageManager(massageManager);\n         }\n         RTAV.logService.debug('session ' + sessionId + ' successfully get RTAV devices control rights');\n         onDone(true);\n      }\n   };\n\n   initResources = function(onDone) {\n      let stolenSessionId,\n         confirmDeviceSteal,\n         cancelDeviceSteal;\n\n      if (!RTAV.resourceManager.hasOccupiedResources(sessionId)) {\n         if (RTAV.resourceManager.hasUsableResources()) {\n            RTAV.resourceManager.occupyResources(sessionId, function(resources) {\n               setResources(resources, onDone);\n            });\n         } else {\n            if (!!RTAV.dialogService.showDialog) {\n               confirmDeviceSteal = function() {\n                  RTAV.resourceManager.stealSession(sessionId, function(resources) {\n                     RTAV.logService.debug('session ' + sessionId + ' trying to steal the devices from session ' + stolenSessionId);\n                     setResources(resources, onDone);\n                  });\n               };\n\n               cancelDeviceSteal = function() {\n                  RTAV.logService.log('session ' + sessionId + ' failed to occupy devices, so RTAV function is not usable');\n                  onDone(false);\n               };\n\n               stolenSessionId = RTAV.resourceManager.getWorkingSessionId();\n               // skip confirmation if devices are not used\n               if (!RTAV.wmksAdapter.isUsingDevices(stolenSessionId)) {\n                  confirmDeviceSteal();\n                  return;\n               }\n               RTAV.dialogService.showDialog({\n                  stolenSessionId: stolenSessionId\n               }, confirmDeviceSteal, cancelDeviceSteal);\n            } else {\n               RTAV.logService.log('session ' + sessionId + ' failed to occupy devices, so RTAV function is not usable');\n               onDone(false);\n            }\n         }\n      } else {\n         onDone(true);\n      }\n   };\n\n   /**\n    * release all local resources\n    */\n   releaseResources = function() {\n      // clear local refer\n      src = null;\n      mediaEnc = null;\n      // release\n      if (RTAV.resourceManager.hasOccupiedResources(sessionId)) {\n         RTAV.resourceManager.releaseResources(sessionId);\n      }\n      // reset flag\n      hasResources = false;\n      return true;\n   };\n\n   /**\n    * close the hold resources, then the resources are not usable anymore\n    */\n   closeResources = function() {\n      // release\n      if (RTAV.resourceManager.hasOccupiedResources(sessionId) && !!src) {\n         src.close();\n      }\n   };\n\n   return {\n      /**\n       * set all the callbacks\n       */\n      initialize: function() {\n         // inited header callback\n         initDoneCallback = function(libHeader, deviceParam, isFackInit) {\n            RTAV.logService.trace('\\nheader generated:');\n            if (!libHeader || !libHeader.buffer) {\n               RTAV.logService.error(\"fail to get header, RTAV will stop working\");\n               return;\n            }\n            RTAV.logService.trace(new Uint8Array(libHeader.buffer));\n            sendingFunc({\n               streamData: libHeader,\n               dataCount: 1,\n               timeStamp: 0\n            });\n            if (!isFackInit) {\n               this.deviceParam = deviceParam;\n               src.startStream(deviceParam, function(data) {\n                  mediaEnc.encodeAudio(data);\n               }, function(data) {\n                  mediaEnc.encodeVideo(data);\n               });\n            }\n         }.bind(this);\n         // audio encoded callback, no others needed to be dealt so far\n         audioDataCallback = function(result, timeStamp) {\n            let metaCount = 1;\n            if (!dataChannel.audioEnable) {\n               return;\n            }\n            if (result) {\n               if (metaCacheA !== null) {\n                  sendingFunc({\n                     streamData: result,\n                     dataCount: metaCacheA + metaCount,\n                     timeStamp: timeStamp\n                  });\n                  metaCacheA = null;\n               } else {\n                  sendingFunc({\n                     streamData: result,\n                     dataCount: metaCount,\n                     timeStamp: timeStamp\n                  });\n               }\n            } else {\n               if (metaCacheA !== null) {\n                  metaCacheA += metaCount;\n               } else {\n                  metaCacheA = metaCount;\n               }\n            }\n         };\n\n         // video encoded callback\n         videoDataCallback = function(result, timeStamp, others) {\n            let metaCount = 1,\n               onDoneCallback,\n               callbackParam;\n\n            if (!dataChannel.videoEnable) {\n               return;\n            }\n            if (result) {\n               if (metaCacheV !== null) {\n                  sendingFunc({\n                     streamData: result,\n                     dataCount: metaCacheV + metaCount,\n                     timeStamp: timeStamp\n                  });\n                  metaCacheV = null;\n               } else {\n                  sendingFunc({\n                     streamData: result,\n                     dataCount: metaCount,\n                     timeStamp: timeStamp\n                  });\n               }\n            } else {\n               if (metaCacheV !== null) {\n                  metaCacheV += metaCount;\n               } else {\n                  metaCacheV = metaCount;\n               }\n            }\n            if (!!others) {\n               onDoneCallback = others.callback;\n               callbackParam = others.callbackParam;\n               if (typeof onDoneCallback === 'function') {\n                  onDoneCallback(callbackParam);\n               }\n            }\n         };\n      },\n\n      /**\n       * The API for start a rtav streaming\n       * @param  {object} encoderParam The params that will be used to config the source and encoder which generating the stream data.\n       * @param  {function} sendingFunction The callback that will be used to send the stream data.\n       * @return {boolean} This returns whether we can start a new rtav stream task.\n       */\n      startMediaIn: function(encoderParam, sendingFunction) {\n         resetProperties(sendingFunction);\n         if (!hasResources) {\n            return false;\n         }\n         initEncoder(encoderParam);\n         return true;\n      },\n\n      /**\n       * The API for stop a rtav streaming\n       */\n      stopMediaIn: function() {\n         if (!hasResources) {\n            return;\n         }\n         if (dataChannel.audioEnable) {\n            this.disableAudioIn();\n         }\n         if (dataChannel.videoEnable) {\n            this.disableVideoIn();\n         }\n      },\n\n      /**\n       * The API for enable audio in\n       * we need to wait the sources inited which is a async process, then see whether this task can be processed successfullly\n       * @param {function} callback will return whether enable success\n       * @param {object} deviceMessageController This param is used to emit premission dialog related events\n       */\n      enableAudioIn: function(callback, deviceMessageController) {\n         let whenHasResources = function(canProcess) {\n            if (!canProcess) {\n               callback(false);\n               return;\n            }\n            src.enable('audio', function(enableSuccess) {\n               dataChannel.audioEnable = enableSuccess;\n               if (enableSuccess) {\n                  mediaEnc.enable('audio');\n               }\n               RTAV.resourceManager.emitDeviceStatusChanged();\n            }, deviceMessageController);\n            callback(true);\n         };\n         this.processWhenHaveResources(whenHasResources);\n      },\n\n      /**\n       * The API for disable audio in\n       * we need to wait the sources inited which is a async process, then see whether this task can be processed successfullly\n       * @return {boolean} This returns whether the disable action success, but treat to disable a released encoder as success\n       */\n      disableAudioIn: function() {\n         if (!hasResources) {\n            RTAV.logService.log('disable success for the encoder and src has already been released');\n         }\n         if (!dataChannel.audioEnable) {\n            RTAV.logService.log('audio has already being disabled, so no need to disable again');\n            return true;\n         }\n         src.disable('audio');\n         mediaEnc.disable('audio');\n         dataChannel.audioEnable = false;\n         RTAV.resourceManager.emitDeviceStatusChanged();\n         return true;\n      },\n\n      /**\n       * The API for enable video in\n       * we need to wait the sources inited which is a async process, then see whether this task can be processed successfullly\n       * @param {function} callback will return whether enable success\n       * @param {object} deviceMessageController This param is used to emit premission dialog related events\n       */\n      enableVideoIn: function(callback, deviceMessageController) {\n         let whenHasResources = function(canProcess) {\n            if (!canProcess) {\n               callback(false);\n               return;\n            }\n            src.enable('video', function(enableSuccess, missingDevice) {\n               dataChannel.videoEnable = enableSuccess;\n               dataChannel.videoMissing = !!missingDevice;\n               if (enableSuccess) {\n                  mediaEnc.enable('video');\n               }\n               RTAV.resourceManager.emitDeviceStatusChanged();\n            }, deviceMessageController);\n            callback(true);\n         };\n         this.processWhenHaveResources(whenHasResources);\n      },\n\n      /**\n       * The API for disable video in\n       * we need to wait the sources inited which is a async process, then see whether this task can be processed successfullly\n       * @return {boolean} This returns whether the disable action success, but treat to disable a released encoder as success\n       */\n      disableVideoIn: function() {\n         if (!hasResources) {\n            RTAV.logService.log('disable success for the encoder and src has already been released');\n            return true;\n         }\n         if (!dataChannel.videoEnable) {\n            RTAV.logService.log('video has already being disabled, so no need to disable again');\n            return false;\n         }\n         src.disable('video');\n         mediaEnc.disable('video');\n         dataChannel.videoEnable = false;\n         dataChannel.videoMissing = false;\n         RTAV.resourceManager.emitDeviceStatusChanged();\n         return true;\n      },\n\n      /**\n       * The API for user level of stop of RTAV\n       * should be called when the rtav is turned off by user for a specified session\n       * @return {boolean} This returns whether the userStop action success\n       */\n      userStop: function() {\n         this.stopMediaIn();\n         releaseResources();\n      },\n\n      /**\n       * The API for session level of stop of RTAV\n       * should be called only when the hosted session is disconnectted\n       * @return {boolean} This returns whether the stop action success\n       */\n      stop: function() {\n         this.stopMediaIn();\n         closeResources();\n         releaseResources();\n      },\n\n      /**\n       * @return {Boolean} This returns whether the controller is send stream in any kind\n       */\n      isSendingStream: function(type) {\n         if (!hasResources) {\n            return false;\n         }\n         if (type === 'video') {\n            return (dataChannel.videoEnable && !dataChannel.videoMissing && src.isActive(type)) ||\n               this.deviceMessageManager.isPermissionPending(type);\n         } else if (type === 'audio') {\n            return (dataChannel.audioEnable && src.isActive(type)) ||\n               this.deviceMessageManager.isPermissionPending(type);\n         }\n         return (dataChannel.videoEnable && !dataChannel.videoMissing && src.isActive('video')) ||\n            (dataChannel.audioEnable && src.isActive('audio')) ||\n            (this.deviceMessageManager.isPermissionPending());\n      },\n\n      /**\n       * Try to get the resource, and when do, call processFunc, and call callback(true)\n       * if not, call callback(false)\n       * @param {function} processFunc The function that will be called when the resources are ready\n       */\n      processWhenHaveResources: function(processFunc) {\n         if (!hasResources) {\n            initResources(function(success) {\n               if (success) {\n                  hasResources = success;\n                  processFunc(true);\n               } else {\n                  RTAV.logService.log('init resources fail');\n                  processFunc(false);\n               }\n            }.bind(this));\n         } else {\n            processFunc(true);\n         }\n      },\n\n      /**\n       * onPermissionHandled and setMessageManager are added to handle cases like:\n       * start_v, accept_v, start_a, stop_v, start_v, accept_a, accept_v\n       * during stop_v we should not release encoders, and only after accept_v,\n       * we should check whether we need to release encoders, since we allow the\n       * status mismatch happens between client and agent so that agent will not\n       * think it need a startstream, and client can't fake it safely, so we have\n       * to prevent that case from happening from a earily stage, which is limite\n       * the release of encoders when premiss dialog are pending, and check whether\n       * we need to do that after it get dismissed, which should work well under\n       * current design of force first desktop to handle all premission dialog then\n       * another desktop can use it.\n       *\n       * one can find a explain why we need this in bug 1750132.\n       *\n       * So here we need to release encoder if it's not in use.\n       */\n      onPermissionHandled: function() {\n         if (!mediaEnc || !mediaEnc.isInited()) {\n            return;\n         }\n         if (mediaEnc.notInUse()) {\n            RTAV.logService.debug(\"clear encoders after premission dialog dismissed\");\n            mediaEnc.clear();\n         }\n      },\n\n      /**\n       * set messageManager into encoder so that we can check the agent-client\n       * mis-match status to avoid bug 1750132.\n       * Never clear massageManager since it's const and persistent\n       * @param {object} manager A DeviceMessageManager instance\n       */\n      setMessageManager: function(manager) {\n         massageManager = manager;\n         if (!!mediaEnc) {\n            mediaEnc.setMessageManager(manager);\n         }\n      },\n\n      /**\n       * restart stream will ensure the stream status in the media capture is started\n       * i.e. it will start the stream if it has not started yet\n       */\n      restartStream: function() {\n         if(!this.deviceParam){\n            RTAV.logService.debug(\"restart will not execute before start is called\");\n            return;\n         }\n         if (!!src && !src.streamStarted) {\n            src.startStream(this.deviceParam, function(data) {\n               mediaEnc.encodeAudio(data);\n            }, function(data) {\n               mediaEnc.encodeVideo(data);\n            });\n         }\n      }\n   };\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/rtavsessioncontroller.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview rtavsettings.js -- settings\n * settings for rtav feature\n * will support setter and getter for run time change in the next patch\n */\n\nimport RTAV from './logservice';\n\nconst settings = {\n   // the default setting will be used only when no any agent setting readed.\n   video: {\n      defMaxFPS: 15, // admin might change this in the broker to avoid to use CPU too much\n      defResWidth: 320,\n      defResHeight: 240\n   },\n   audio: {\n      sampleRate: 8000,\n      channels: 1,\n      bitsPerSample: 16\n   },\n   enabled: true\n};\n\nRTAV.settings = settings;\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/rtavsettings.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * @fileoverview synctimer.js -- SyncTimer\n * Class to control timer, not support pause yet\n */\n\n\n\nexport default function SyncTimer() {\n   this.inited = false;\n   this.startTime = 0;\n};\n\n/**\n * @return {number} return current system time\n */\nSyncTimer.prototype.getNow = function() {\n   return (new Date()).getTime();\n};\n\nSyncTimer.prototype.isInited = function() {\n   return this.inited;\n};\n/**\n * reset the timer to init status\n */\nSyncTimer.prototype.reset = function() {\n   this.startTime = this.getNow();\n   this.inited = true;\n};\n\nSyncTimer.prototype.clear = function() {\n   this.startTime = 0;\n   this.inited = false;\n};\n/**\n * @return {number} This returns the time from the timer-init moment\n */\nSyncTimer.prototype.getTime = function() {\n   if (!this.inited) {\n      return 0;\n   }\n   let now = this.getNow();\n   return now - this.startTime;\n};\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/synctimer.js","/*********************************************************\n * Copyright (C) 2015 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview typedarraysupport.js -- Uint8Array.from, Int16Array.from\n * In some browsers there are some browser APIs missing(like chrome < 45),\n * so we use this file to define a simple version of these functions which\n * are enough for us to use.\n */\n\n'use strict';\n\n/*global Int16Array, Uint8Array, Array*/\n\n(function() {\n   var appendFunction = function(ArrayClass, data) {\n      var i,\n         typedArray;\n      if (!data || !data.length) {\n         return null;\n      }\n      typedArray = new ArrayClass(data.length);\n      for (i = 0; i < data.length; i++) {\n         typedArray[i] = data[i];\n      }\n      return typedArray;\n   };\n\n   if (!Uint8Array.from) {\n      Uint8Array.from = function(data) {\n         return appendFunction(Uint8Array, data);\n      };\n   }\n   if (!Int16Array.from) {\n      Int16Array.from = function(data) {\n         return appendFunction(Int16Array, data);\n      };\n   }\n   if (!Array.from) {\n      Array.from = function(data) {\n         return appendFunction(Array, data);\n      };\n   }\n}());\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/typedarraysupport.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview videocapture.js -- VideoCapture\n * Class to handle video capturing\n */\n\nimport RTAV from './logservice';\n\nexport default function VideoCapture() {\n   this.inited = false;\n   this.frameRateController = new RTAV.FrameRateController();\n};\n\nVideoCapture.statusEnum = {\n   Uninited: 'Uninited',\n   Inited: 'Inited',\n   Working: 'Working'\n};\n/**\n * Get what status this video src is in, cuurently only Uinited is detected, but keep the API as it\n * for future extension and debugging\n * @return {string} This returns one of the VideoCapture.statusEnum of 'Uninited', 'Inited', 'Working'\n */\nVideoCapture.prototype.getStatus = function() {\n   let status;\n   if (!this.inited) {\n      status = VideoCapture.statusEnum['Uninited'];\n   } else {\n      if (this.sessionID < 0) {\n         status = VideoCapture.statusEnum['Inited'];\n      } else {\n         status = VideoCapture.statusEnum['Working'];\n      }\n   }\n   return status;\n};\n\n/**\n * Deconstructure function, should be called when want to change the param, nor\n * we want a brand now capturing session.\n */\nVideoCapture.prototype.clear = function() {\n   if (!this.inited) {\n      RTAV.logService.error('this video capture is not inited, clear fail');\n      return;\n   }\n   if (this.sessionID >= 0) {\n      RTAV.logService.debug('negative: the video capture is not stopped yet, stop it before clear it.');\n      this.stop();\n   }\n   this.video = null;\n   this.canvas = null;\n   this.ctx = null;\n   this.inited = false;\n   this.syncTimer = null;\n   this.dataCallback = null;\n   this.losingDevice = false;\n   this.deviceUnpluged = false;\n   this.localStream = null;\n};\n\n/**\n * Init capturing video by binding events to the passed in stream, and later for each frame, call\n * the callback with it.\n * Similar to mVdoInput.Open for native clients, use prefs and timer, but here also pass in stream\n * and callback which is done differently for native clients.\n * and the caller should be similar to VCamServer::InitVideoSrcDev, to reset sync timer if needed.\n * it looks like \"open\" but the real open didn't happen here, it's acctually init the opened source,\n * we do not open it here to avoid anoying hint diaglog which is forced by some browsers like firefox.\n *\n * @param  {object} videoParam The parameter object that contains width, height and fps\n * @param  {object} syncTimer The timer object user to sync the audio and video\n * @param  {function} callback The frame dealing function for each frame\n */\nVideoCapture.prototype.init = function(videoParam, syncTimer, callback) {\n   if (this.inited) {\n      RTAV.logService.error('this video capture has already been inited, init fail');\n      return;\n   }\n   if (typeof callback !== 'function') {\n      return;\n   }\n\n   this.width = videoParam.width;\n   this.height = videoParam.height;\n   this.fps = videoParam.fps;\n   this.frameRateController.setFPS(this.fps);\n\n   this.dataCallback = callback;\n   // Adjust size\n   this.video = document.getElementById(\"video\");\n   this.video.setAttribute('width', this.width);\n   this.video.setAttribute('height', this.height);\n   // mute the video to fix bug 1587389\n   this.video.volume = 0;\n   // Adjust size\n   this.canvas = document.getElementById(\"canvas\");\n   this.canvas.setAttribute('width', this.width);\n   this.canvas.setAttribute('height', this.height);\n   this.ctx = this.canvas.getContext('2d');\n   if (!this.video || !this.canvas || !this.ctx || this.width !== this.canvas.width || this.height !== this.canvas.height) {\n      return;\n   }\n   /**\n    * use sessionID without sessionCount can also controll the workflow, but one can\n    * not detect the error for calling start or stop with undesired timing, so do not\n    * pick that design.\n    */\n   this.sessionID = -1; //current working sesssion ID\n   this.sessionCount = 0; //total working session number ever created\n\n   this.syncTimer = syncTimer;\n   this.inited = true;\n};\n\n/**\n * Start capturing video, and if there is another working session, do nothing.\n * @param  {object} stream The stream object obtained by the getUserMedia\n */\nVideoCapture.prototype.start = function(stream) {\n   if (!stream) {\n      RTAV.logService.error('the video stream is not valid, start fail');\n      return;\n   }\n   if (!this.inited) {\n      RTAV.logService.error('the video capture is not being inited, start fail');\n      return;\n   }\n   if (this.sessionID >= 0) {\n      RTAV.logService.error('find existing video capturing session, start fail');\n      return;\n   }\n\n   this.video.src = window.URL.createObjectURL(stream);\n   this.localStream = stream;\n\n   this.sessionID = this.sessionCount;\n   this.sessionCount++;\n   this.lastValidTime = -1;\n   this.freezeCount = 0;\n   this.losingDevice = false;\n   this.deviceUnpluged = false;\n   this.getNextFrame(this.sessionID);\n};\n\n/**\n * Stop capturing data, and enter waiting status.\n * The coming getNextFrame with old sessionID will not be processed after this call.\n */\nVideoCapture.prototype.stop = function() {\n   if (!this.inited) {\n      RTAV.logService.error('the video capture is not being inited, stop fail');\n      return;\n   }\n   if (this.sessionID < 0) {\n      RTAV.logService.debug('find no video capturing session, skip stop');\n      return;\n   }\n   this.losingDevice = false;\n   this.deviceUnpluged = false;\n   this.sessionID = -1;\n};\n\n/**\n * Will fetch a new frame if this.sessionID is the same of this.sessionID to handle\n * the async workflow of stop_V and start_V\n * maxFPS not supported yet, which it's a trival feature(would do later).\n *\n * @private\n * @param {number} sessionID The number use to mark the video srcource session,\n *     which is identical from a start_V to a stop_V to avoid parallel capturing.\n */\nVideoCapture.prototype.getNextFrame = function(sessionID) {\n   setTimeout(function() {\n      if (!this.inited) {\n         return;\n      }\n      if (this.sessionID < 0 && this.sessionID !== sessionID) {\n         return;\n      }\n      let imgData,\n         timeStamp = this.syncTimer.getTime();\n\n      this.updateActiveStatus();\n      this.ctx.drawImage(this.video, 0, 0, this.width, this.height);\n      imgData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);\n      this.frameRateController.onFrameCaptured();\n      this.dataCallback({\n         data: imgData.data.buffer,\n         timeStamp: timeStamp,\n         others: {\n            callbackParam: sessionID,\n            callback: this.getNextFrame.bind(this)\n         }\n      });\n   }.bind(this), this.frameRateController.getWaitTime());\n};\n\n/**\n * Update the device active status\n */\nVideoCapture.prototype.updateActiveStatus = function() {\n   let freezeTolerence = this.fps / 2 + 2;\n\n   if (!!this.video.currentTime) {\n      if (this.video.currentTime === this.lastValidTime) {\n         this.freezeCount = this.freezeCount + 1;\n         if (!this.losingDevice && this.freezeCount > freezeTolerence) {\n            this.losingDevice = true;\n            RTAV.logService.debug('negative: seems the video device becomes invalid, please check');\n            RTAV.resourceManager.emitDeviceStatusChanged();\n         }\n      } else {\n         this.freezeCount = 0;\n         if (this.video.currentTime > 0) {\n            this.lastValidTime = this.video.currentTime;\n         }\n         if (this.losingDevice) {\n            this.losingDevice = false;\n            RTAV.logService.debug('negative: seems the video device becomes valid again, which means it might unstable');\n            RTAV.resourceManager.emitDeviceStatusChanged();\n         }\n      }\n   }\n\n   if (!!this.localStream && typeof this.localStream.active === 'boolean') {\n      if (!this.localStream.active && !this.deviceUnpluged) {\n         this.deviceUnpluged = true;\n         RTAV.logService.debug('negative: seems the audio device is unpluged');\n         RTAV.resourceManager.emitDeviceStatusChanged();\n      }\n   }\n};\n\n/**\n * This returns whether the device can provide valid data\n */\nVideoCapture.prototype.isActive = function() {\n   return !this.losingDevice && !this.deviceUnpluged;\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/videocapture.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview wmksadapter.js -- wmksAdapter\n * Service to handle wmks session management\n *\n * Currently only support one wmks to use RTAV at the same time\n * and others have to wait the resources get released by that session\n * when it's closed.\n *\n * Should also support RTAV pause when the RTAV-active session is hidden(P2, minor, feature)\n */\n\nimport RTAV from './logservice';\n\n\nlet wmksAdapter = (function() {\n   let sessionMap = {};\n   return {\n      /**\n       * The function used to add in a wmks session\n       * @param {string} sessionId The ID of the session\n       * @param {object} session The vvcSession object that passed from wmks\n       */\n      addSession: function(sessionId, session) {\n         if (!RTAV.settings.enabled) {\n            return;\n         }\n         if (!sessionId || !session) {\n            RTAV.logService.error('can\\'t add a invalid session' + sessionId);\n            return;\n         }\n         sessionMap[sessionId] = new RTAV.RtavSession(sessionId, session);\n      },\n\n      /**\n       * The function used to remove a wmks session, should be call when the corresponding\n       * session becomes invalid\n       * @param {string} sessionId The ID of the session\n       */\n      removeSession: function(sessionId) {\n         if (!RTAV.settings.enabled) {\n            return;\n         }\n         if (!sessionId || !sessionMap[sessionId]) {\n            RTAV.logService.error('can\\'t remove a not-exist session' + sessionId);\n            return;\n         }\n         sessionMap[sessionId].stop();\n         if (sessionMap.hasOwnProperty(sessionId)) {\n            delete sessionMap[sessionId];\n         }\n      },\n\n      /**\n       * The function used to active the rtav session on a valid wmks session, should be\n       * called when the corresponding session becomes valid\n       * The active means establish rtav sub vvc channel, and finishing the configuring steps,\n       * and also tries to process the agent request when device can be obtained.\n       * Currently, There can many actived sessions, which means there are many rtav sessions on\n       * going, but only one session can send streaming data to the agent since we only allow one\n       * to access to the device and encoder to avoid cosuming too much of resources.\n       * @param {string} sessionId The ID of the session\n       */\n      activeSession: function(sessionId) {\n         if (!RTAV.settings.enabled) {\n            return;\n         }\n         if (!sessionId || !sessionMap[sessionId]) {\n            RTAV.logService.error('can\\'t active a not-exist session' + sessionId);\n            return;\n         }\n         sessionMap[sessionId].start();\n      },\n\n      userStopSession: function(sessionId) {\n         if (!RTAV.settings.enabled) {\n            return;\n         }\n         if (!sessionId || !sessionMap[sessionId]) {\n            RTAV.logService.error('can\\'t stop a not-exist session' + sessionId);\n            return;\n         }\n         sessionMap[sessionId].userStop();\n      },\n\n      isUsingDevices: function(sessionId, type) {\n         if (!RTAV.settings.enabled || !sessionId || !sessionMap[sessionId]) {\n            return false;\n         }\n         return sessionMap[sessionId].isUsingDevices(type);\n      },\n\n      isAskingPremission: function(sessionId, type) {\n         if (!RTAV.settings.enabled || !sessionId || !sessionMap[sessionId]) {\n            return false;\n         }\n         return sessionMap[sessionId].isAskingPremission(type);\n      }\n   };\n}());\n\nexport default wmksAdapter;\n\n\n// WEBPACK FOOTER //\n// ./desktop/rtav/wmksadapter.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * modal-dialog.js --\n *\n * Module to implement modal dialogs for the Blast UI using Angular JS.\n *\n */\n\n\nimport {globalArray} from '../../jscdk/jscdkClient';\nimport SetUserGlobalPrefHandler from '../../jscdk/controllers/setUserGlobalPrefHandler';\nimport AB from '../common/appblast-util';\nimport confirmDialogTemplate from '../../common/commondialog/dialog_service_confirm.html';\nimport errorDialogTemplate from '../../common/commondialog/dialog_service_error.html';\n\nexport default function settingsWindowController($scope, $rootScope, $timeout,\n                                                 wmksService,\n                                                 userGlobalPref,\n                                                 entitledItemsService, ngDialog,\n                                                 WMKS, _) {\n   // Initialize the prefs handler if this has not already been done\n   if (!globalArray[\"set-user-global-preferences\"]) {\n      globalArray[\"set-user-global-preferences\"] =\n         new SetUserGlobalPrefHandler();\n   }\n\n   // Whether high res mode is supported\n   $scope.isHighResModeSupported =\n      wmksService.isHighResModeSupported();\n\n   // Whether high res mode is enabled or not. Starts off as being\n   // disabled.\n   $scope.isHighResModeEnabled = wmksService.isHighResModeEnabled();\n\n   /**\n    * Variable for determining if the reset applications button is\n    * enabled. It will get the newset list every time setting dialog\n    * is opened.\n    */\n   entitledItemsService.hasApplicationSession()\n      .then(function(applicationSessions) {\n         $scope.resetButtonEnabled =\n            !!applicationSessions && applicationSessions.length > 0;\n      });\n\n   $scope.areMacOSXKeyMappingsSupported =\n      wmksService.areMacOSXKeyMappingsSupported();\n\n   $scope.areMacOSXKeyMappingsEnabled =\n      wmksService.areMacOSXKeyMappingsEnabled();\n\n   $scope.isMacOS = wmksService.isMacOS();\n   // Whether Windows key simulation is enabled.\n   $scope.isWindowsKeyEnabled = wmksService.isWindowsKeyEnabled();\n\n   $scope.isMP4Enabled = wmksService.isMP4Enabled();\n\n   $scope.enableDPISync =\n      (userGlobalPref.getPrefData().enableDPISync === 'true');\n\n   /*\n    * toggleDPISync\n    *\n    * wrapped with multimon imcompatible detection\n    * Since the binding is totally invalid, I think it's a good idea to\n    *    use the setting dialog in launcher page...\n    * This change is just making it working again, and refactory is needed\n    *    for this wired service...\n    *\n    * p.s. use userGlobalPref to get value since this value is not store\n    *    into the wmksService as other settings.\n    */\n   $scope.toggleDPISync = function() {\n      wmksService.whenNotInMultimon(function() {\n         $scope._toggleDPISync();\n         $timeout(function() {\n            $scope.toggleSwitches[0].isEnabled =\n               (userGlobalPref.getPrefData().enableDPISync === 'true');\n         });\n      });\n      $timeout(function() {\n         $scope.toggleSwitches[0].isEnabled =\n            (userGlobalPref.getPrefData().enableDPISync === 'true');\n      });\n   };\n\n\n   /*\n    * toggleMP4\n    */\n   $scope.toggleMP4 = function() {\n      wmksService.whenNotInMultimon(function() {\n         $scope._toggleMP4();\n         $timeout(function() {\n            $scope.toggleSwitches[3].isEnabled = $scope.isMP4Enabled;\n         });\n      });\n      $timeout(function() {\n         $scope.toggleSwitches[3].isEnabled = $scope.isMP4Enabled;\n      });\n   };\n\n   /*\n    * Method for toggling OSX Key mappings.\n    */\n   $scope.toggleUseMacOSXKeyMappings = function() {\n      $scope.areMacOSXKeyMappingsEnabled =\n         wmksService.toggleUseMacOSXKeyMappings();\n\n      userGlobalPref.updatePrefData({\n         name: 'useMacOSXKeyMappings',\n         text: $scope.areMacOSXKeyMappingsEnabled ? \"true\" : \"false\",\n         action: 'useMacOSXKeyMappings'\n      });\n      userGlobalPref.postPrefData();\n   };\n\n   /*\n    * toggleWindowsKey\n    *\n    * Method for toggling Windows key simulation functionality.\n    */\n   $scope.toggleWindowsKey = function() {\n      $scope.isWindowsKeyEnabled = wmksService.toggleWindowsKey();\n\n      userGlobalPref.updatePrefData({\n         name: 'enableWindowsKey',\n         text: $scope.isWindowsKeyEnabled ? \"true\" : \"false\",\n         action: 'enableWindowsKey'\n      });\n      userGlobalPref.postPrefData();\n   };\n\n   $scope._toggleDPISync = function() {\n      $scope.enableDPISync = !$scope.enableDPISync;\n      userGlobalPref.updatePrefData({\n         name: 'enableDPISync',\n         text: $scope.enableDPISync ? \"true\" : \"false\",\n         action: 'enableDPISync'\n      });\n      userGlobalPref.postPrefData();\n      wmksService.toggleHighResMode();\n   };\n\n   /*\n    * _toggleMP4\n    *\n    * Method for toggling MP4 functionality.\n    */\n   $scope._toggleMP4 = function() {\n      $scope.isMP4Enabled = wmksService.toggleMP4();\n\n      userGlobalPref.updatePrefData({\n         name: 'enableMP4',\n         text: $scope.isMP4Enabled ? \"true\" : \"false\",\n         action: 'enableMP4'\n      });\n      userGlobalPref.postPrefData();\n   };\n\n   $scope.toggleSwitches = [\n      {\n         id: 'dpi_syc',\n         label: _('DPI_SYNC_M'),\n         isSupported: $scope.isHighResModeSupported,\n         isEnabled: $scope.enableDPISync,\n         toggle: $scope.toggleDPISync\n      },\n      {\n         id: 'osx-keys',\n         label: _('USE_OSX_KEY_MAPPINGS_M'),\n         isSupported: wmksService.areMacOSXKeyMappingsSupported(),\n         isEnabled: $scope.areMacOSXKeyMappingsEnabled,\n         toggle: $scope.toggleUseMacOSXKeyMappings\n      },\n      {\n         id: 'win-key',\n         label: _('ENABLE_WINDOWS_KEY_T'),\n         text: _('ENABLE_WINDOWS_KEY_M',\n            $scope.isMacOS ? _('CMD_KEY') : _('WIN_KEY')),\n         isSupported: !WMKS.BROWSER.isIOS() && !WMKS.BROWSER.isAndroid(),\n         isEnabled: $scope.isWindowsKeyEnabled,\n         toggle: $scope.toggleWindowsKey\n      },\n      {\n         id: 'mp4',\n         label: _('ALLOW_MP4_T'),\n         isSupported: wmksService.isMP4Supported(),\n         isEnabled: $scope.isMP4Enabled,\n         toggle: $scope.toggleMP4\n      }\n   ];\n\n   /**\n    * _resetResultCallback\n    *\n    * Callback to handle the response from attempting to reset all\n    * apps. Brings up an error dialog if necessary.\n    *\n    * @param response the response from the server\n    */\n   function _resetResultCallback(response) {\n      AB.LOGGER.log(response);\n      $rootScope.$emit('toggleBusyOverlay');\n      if (!response.success) {\n         // tell the wmksService that our attempt to reset sessions\n         // failed for the sessions in response.error.errorDetail\n         wmksService.sessionResetDone(response.error.errorDetail);\n         ngDialog.open({\n            name: \"ResetAllError\",\n            templateUrl: errorDialogTemplate,\n            showClose: false,\n            className: \"session-ops-dialog\",\n            data: {errorMessage: response.error.userMsg}\n         });\n      }\n   }\n\n   /**\n    * resetApplications\n    *\n    * UI Handler for resetting all applications\n    */\n   $scope.resetApplications = function() {\n      AB.LOGGER.log(\"Reset all applications\");\n      $scope.closeThisDialog();\n      ngDialog.openConfirm({\n         name: \"SessionOpsConfirmation\",\n         templateUrl: confirmDialogTemplate,\n         showClose: false,\n         className: \"session-ops-dialog\",\n         closeByDocument: false,\n         data: {\n            title: _('RESET_APPS_T'),\n            message: _('RESET_APPS_M'),\n            showWarning: true\n         }\n      }).then(function() {\n         $rootScope.$emit('toggleBusyOverlay');\n         wmksService.prepareForSessionReset();\n         entitledItemsService.resetAllApplications(\n            _resetResultCallback);\n      });\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/setting-dialog/settings-window-controller.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * context-menu-manager.js --\n *\n * Module for handling context menus. The module makes sure that only one\n * context menu is opened at a time and that clicking outside of the context\n * menu closes it. The ContextMenuManager exposes two methods. toggleMenu and\n * closeMenu detailed below.\n */\n\nexport default function contextMenuManager($window) {\n   let contextMenuManager = {\n         openedMenuId: null,\n         closeCallback: null,\n         scope: null\n      },\n\n      /**\n       * Callback to be used to handle body click events when a context menu\n       * is opened. If a menu is opened the callback will close it. It will\n       * then unregister itself.\n       *\n       * @param e the jquery event for the click\n       */\n      bodySettingsMenuOpenedClickHandler = function(e) {\n         if (contextMenuManager.openedMenuId) {\n            contextMenuManager.closeCallback();\n            contextMenuManager.scope.$apply();\n            contextMenuManager.openedMenuId = null;\n            contextMenuManager.closeCallback = null;\n         }\n         $(document).off(\"click\", bodySettingsMenuOpenedClickHandler);\n      };\n\n   /**\n    * Opens a menu with a given id. The exact behavior depends on whether\n    * another menu is opened and what its id is:\n    *\n    * - If no other menu is opened it opens the menu\n    * - If the currently opened menu has the same id as menuId that menu\n    *   is closed and no other action is taken.\n    * - If the currently openend menu has an id other than menuId that menu\n    *   is closed and the new menu is opened.\n    *\n    * @param menuId an id for the menu to be opened\n    * @param scope the scope under which operations to open and close the\n    *    menu should take place\n    * @param openCallback a callback to be used to open the menu\n    * @param closeCallback a callback to be used to close the menu\n    */\n   contextMenuManager.toggleMenu = function(menuId,\n                                            scope,\n                                            openCallback,\n                                            closeCallback) {\n      let currentMenuId = contextMenuManager.openedMenuId;\n\n      if (currentMenuId) {\n         contextMenuManager.closeCallback();\n         $(document).off(\"click\", bodySettingsMenuOpenedClickHandler);\n         contextMenuManager.openedMenuId = null;\n         contextMenuManager.closeCallback = null;\n      }\n\n      if (currentMenuId === menuId) {\n         return;\n      }\n\n      openCallback();\n      contextMenuManager.openedMenuId = menuId;\n      contextMenuManager.closeCallback = closeCallback;\n      contextMenuManager.scope = scope;\n      $(document).on(\"click\", bodySettingsMenuOpenedClickHandler);\n   };\n\n   contextMenuManager.closeMenu = function() {\n      if (contextMenuManager.openedMenuId) {\n         contextMenuManager.closeCallback();\n         $(document).off(\"click\", bodySettingsMenuOpenedClickHandler);\n         contextMenuManager.openedMenuId = null;\n         contextMenuManager.closeCallback = null;\n      }\n   };\n\n   return contextMenuManager;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/sidebar/context-menu-manager.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * sidebar.js --\n *\n * Module to implement sidebar component for Blast UI.\n *\n */\n\nimport sidebarTemplate from './sidebar_template.html';\nimport settingDialogTemplate from '../setting-dialog/settings_window_template.html';\nimport errorDialogTemplate from '../../common/commondialog/dialog_service_error.html';\nimport confirmDialogTemplate from '../../common/commondialog/dialog_service_confirm.html';\nimport aboutDialogTemplate from '../../common/aboutdialog/about_dialog.html';\nimport multimonSettingWindowTemplate from '../multimon/multimon-setting-window/multimon_setting_window_template.html';\nimport util from '../../jscdk/util';\nimport AB from '../common/appblast-util';\nimport $ from 'jquery';\nimport angular from 'angular';\nimport JSCDKBrokerError from '../../jscdk/model/jscdkBrokerError';\n\nexport function runningItemsFilter() {\n   // Filter for running items given a search query string.\n   return function(runningItems, query) {\n      let output = [];\n      let i;\n      let instanceQueryFilter = function(item) {\n         return AB.UTIL.itemNameContainsQuery(item, query);\n      };\n\n      for (i = 0; i < runningItems.length; i++) {\n         if (AB.UTIL.isLoadingItem(runningItems[i]) ||\n            AB.UTIL.isLoadingApp(runningItems[i])) {\n\n            if (query === \"\") {\n               /*\n                * The special \"Loading\" item holds reconnecting sessions, and\n                * should only be displayed if and we are not searching for anything.\n                */\n               runningItems[i].queryInstances = runningItems[i].instances;\n               output.push(runningItems[i]);\n            }\n         } else if (AB.UTIL.itemNameContainsQuery(runningItems[i], query)) {\n            // If parent app matches, assume all child instances are relevant\n            runningItems[i].queryInstances = runningItems[i].instances;\n            output.push(runningItems[i]);\n         } else {\n            // If any child instances match query, both parent app and all\n            // matching child apps must be shown.\n            let matchedInstances = runningItems[i].instances.filter(\n               instanceQueryFilter);\n            if (matchedInstances.length > 0) {\n               runningItems[i].queryInstances = matchedInstances;\n               output.push(runningItems[i]);\n            }\n         }\n      }\n      output.sort(AB.UTIL.itemSortHelper);\n      return output;\n   };\n}\n\nexport function availableItemsFilter() {\n   return function(availableItems, query, onlyFavorites) {\n      let output = [];\n\n      for (let i = 0; i < availableItems.length; i++) {\n         if (!AB.UTIL.itemNameContainsQuery(availableItems[i], query)) {\n            continue;\n         } else if (onlyFavorites && !availableItems[i].favorite) {\n            continue;\n         }\n         output.push(availableItems[i]);\n      }\n\n      output.sort(AB.UTIL.itemSortHelper);\n\n      return output;\n   };\n}\n\nexport function SidebarController($scope,\n                                  $window,\n                                  $rootScope,\n                                  $timeout,\n                                  unityService,\n                                  runningItemsModel,\n                                  contextMenuManager,\n                                  wmksService,\n                                  entitledItemsModel,\n                                  entitledItemsService,\n                                  userGlobalPref,\n                                  ngDialog,\n                                  messageHandlerService,\n                                  RTAVService,\n                                  _,\n                                  WMKS,\n                                  idleSessionService,\n                                  wmksServiceEventHandler,\n                                  commonSvcService,\n                                  normalizationService) {\n   /**\n    * SECURITY_SERVER_RESET_ERROR is special handle for bug 1560096.\n    * In this case desktop/app cannot be launched after restarting\n    * the security server.\n    */\n   let SECURITY_SERVER_RESET_ERROR = 'failed launching connection: com.vmware.vdi.broker.CoManagerRequiredException: No co-management availability for protocol BLAST',\n      PROTOCOL_ERROR = 'Please try connecting via another protocol or logoff the existing session first',\n      _searchElem = $(\".search-input\"),\n      _touchDeviceRunner;\n\n   // Assign util = AB.UTIL so the view can use it\n   $scope.util = AB.UTIL;\n\n   // Control global context menu visibility\n   $scope.showGlobalContextMenu = false;\n\n   // Control sub menu position and visibility.\n   $scope.showItemContextMenu = false;\n\n   // Control content panel visibility.\n   $scope.showPanel = false;\n\n   // Control copy/paste buttons visibility\n   $scope.showClipboardButton = true;\n\n   // App (or desktop) for which a context menu is open\n   $scope.contextMenuItem = null;\n\n   // Declares running items search query object.\n   $scope.queryText = {\n      \"name\": \"\"\n   };\n\n   // Whether to show only favorites or not\n   $scope.showOnlyFavorites = false;\n\n   // Flag to indicate whether or not the preferences should be persisted\n   // when the sidebar is closed\n   $scope.arePrefsDirty = false;\n\n   // Promise used to track whether we have an outstanding timeout to\n   // persist the perferences\n   $scope.prefPromise = null;\n\n   // Whether the Not Authenticated Dialog is open or not\n   $scope.notAuthenticatedDialogOpen = false;\n\n   // Stores the idle timeout warning dialog, if open\n   $scope.idleTimeoutWarningDialog = null;\n\n   // Stores the multimon setting window dialog, if open\n   $scope.multimonSettingWindow = null;\n\n   // controll whether show the avaiable item panel for user to launch\n   // them, will be true for HWS\n   $scope.showLaunchPanel = false;\n\n   $scope.multimonOptionVisible = false;\n   $scope.multimonStarted = false;\n\n   /**\n    * Given an app item, toggle the collapsed state of its instances\n    * dropdown UI\n    *\n    * @param currentItem: the current item that requested the toggle\n    */\n   $scope.toggleIsCollapsed = function(currentItem) {\n      if (AB.UTIL.isLoadingItem(currentItem) ||\n         AB.UTIL.isApp(currentItem)) {\n         currentItem.isCollapsed = !currentItem.isCollapsed;\n      }\n   };\n\n   $scope.activateItem = function(currentItem) {\n      if (wmksService.isCurrentSession(currentItem.wmksKey)) {\n         $scope._activateItem(currentItem);\n         return;\n      }\n      wmksService.whenNotInMultimon(function() {\n         $scope._activateItem(currentItem);\n      });\n   };\n\n   /**\n    * Handler to be called when item section is clicked.\n    *\n    * If we have only one unity window, we will activate this unity\n    * Window. If there is more than one unity window we activate the\n    * first one only if the app unless on of the windows has focus in\n    * which case we bring that one to front.\n    *\n    * @TODO consider keeping track of the last window used for every app\n    *    so we can bring that window to front when the app is activated\n    *    via this method.\n    *\n    * For desktop item, do nothing in Q1 release.\n    *\n    * @param currentItem        the current item object which is clicked.\n    */\n   $scope._activateItem = function(currentItem) {\n      let index,\n         selectedItem;\n\n      // The \"Loading\" item doesn't have an associated wmksKey\n      if (!AB.UTIL.isLoadingItem(currentItem)) {\n         wmksService.changeWmksSession(currentItem.wmksKey);\n      }\n\n      if (AB.UTIL.isLoadingItem(currentItem) ||\n         AB.UTIL.isApp(currentItem)) {\n         // Only bring this app to front if it is not already in front.\n         // Bring up the most recently used window if it is known,\n         // otherwise bring up the first window in the instance list.\n         if (currentItem.focusedItem === null) {\n            if (currentItem.orderedInstances.length > 0) {\n               index = currentItem.orderedInstances.length - 1;\n               selectedItem = currentItem.orderedInstances[index];\n            } else {\n               selectedItem = currentItem.instances[0];\n            }\n         } else {\n            selectedItem = currentItem.focusedItem;\n         }\n\n         // If we clicked the \"Loading\" item, set focus to the selected\n         // instance\n         if (AB.UTIL.isLoadingItem(currentItem)) {\n            wmksService.changeWmksSession(selectedItem.wmksKey);\n         }\n         unityService.toggleWindow(selectedItem.wmksKey,\n            selectedItem.windowId);\n      }\n   };\n\n   $scope.activateWindow = function(runningItem) {\n      wmksService.changeWmksSession(runningItem.wmksKey);\n      unityService.toggleWindow(runningItem.wmksKey,\n         runningItem.windowId);\n   };\n\n   /**\n    * _findEntitledItem\n    *\n    * Helper function that when given a running item will find the\n    * matching entitled item.\n    *\n    * @return the matching entitled item or undefined\n    */\n   function _findEntitledItem(item) {\n      let list;\n\n      /* istanbul ignore if */\n      if (!item) {\n         return;\n      }\n\n      list = $scope.entitledItems.filter(function(obj) {\n         return obj.id === item.wmksKey;\n      });\n\n      /* istanbul ignore if */\n      if (list.length !== 1) {\n         return;\n      }\n\n      return list[0];\n   }\n\n   _touchDeviceRunner = function(func) {\n      let isIOSSafari = WMKS.BROWSER.isSafari() && WMKS.BROWSER.isIOS(),\n         isAndroidChrome = WMKS.BROWSER.isChrome() && WMKS.BROWSER.isAndroid();\n      //todo: Add win phone\n      if (isIOSSafari || isAndroidChrome) {\n         AB.LOGGER.log(\"Touch device supported.\");\n         return func();\n      } else {\n         return false;\n      }\n   };\n\n   /**\n    * for Q1 only suuport chrome and firefox to reduce dev efforts\n    *    and not support touch device and application sessions to reduce\n    *    the testing and bug fixing efforts\n    *\n    *    set minial chrome version to 55 since it fix a DPI setting bug\n    */\n   $scope.updateMultimonMenuVisibility = function() {\n      let isSupportedBrowser = WMKS.BROWSER.isChrome() &&\n            WMKS.BROWSER.version.major >= 55,\n         isSupportedDevice = !WMKS.BROWSER.isTouchDevice(),\n         currentSessionIsDesktop = wmksService.isCurrentSessionDesktop(),\n         agentSupportMultimon = wmksService.hasMultimonCapacity(),\n         DPIConnectionReady = wmksService.isCurrentSessionHasDPIChannelInited();\n\n      $scope.multimonOptionVisible = isSupportedBrowser &&\n         isSupportedDevice && currentSessionIsDesktop &&\n         agentSupportMultimon && DPIConnectionReady;\n   };\n\n   $scope.globalContextMenuClicked = function(event) {\n      $scope.updateMultimonMenuVisibility();\n      contextMenuManager.toggleMenu(\"globalContext\",\n         $scope,\n         function() {\n            $scope.showGlobalContextMenu = true;\n         },\n         function() {\n            $scope.showGlobalContextMenu = false;\n         });\n      event.stopPropagation();\n   };\n\n   $scope.contextMenuClicked = function(runningItem, event) {\n      contextMenuManager.toggleMenu(runningItem,\n         $scope,\n         function() {\n\n            let entitledDesktop = AB.UTIL.isDesktop(runningItem) &&\n               _findEntitledItem(runningItem);\n\n            $('.menu.item-context').css({\n               top: event.target.getBoundingClientRect().top + 'px'\n            });\n\n            $scope.contextMenuItem = runningItem;\n            $scope.showLogOffDesktop = !!entitledDesktop &&\n               !entitledDesktop.isShadow;\n\n            $scope.showResetDesktop = !!entitledDesktop &&\n               entitledDesktop['reset-allowed-on-session'] === 'true';\n\n            $scope.showRestartDesktop = !!entitledDesktop &&\n               entitledDesktop['reset-allowed-on-session'] === 'true' &&\n               util.brokerSupportRestartDesktop();\n\n            $scope.showItemContextMenu = true;\n         },\n         function() {\n            $scope.contextMenuItem = null;\n            $scope.showItemContextMenu = false;\n         });\n      event.stopPropagation();\n   };\n\n   $scope.ctrlAltDeleteClicked = function() {\n      AB.LOGGER.log(\"Sending ctrl-alt-delete to active session.\");\n      wmksService.sendCtrlAltDel();\n   };\n\n   $scope.escClicked = function() {\n      AB.LOGGER.log(\"Sending esc to active session.\");\n      wmksService.sendEsc();\n   };\n\n   /**\n    * _sessionOpResultCallback\n    *\n    * Callback to handle results from a session operation call. Pops up an\n    * error dialog if the call fails.\n    *\n    * @param item the item on which the call was performed.\n    * @param response the response to the session operation call.\n    */\n   function _sessionOpResultCallback(item, response) {\n      AB.LOGGER.log(response);\n      $rootScope.$emit('toggleBusyOverlay');\n      if (!response.success) {\n         wmksService.sessionResetDone([item.wmksKey]);\n         $scope.showErrorMessage(null, {rawMessage: response.error.userMsg});\n      }\n   }\n\n   /**\n    * _confirmSessionOp\n    *\n    * Helper function to bring up a confirmation dialog before a session\n    * operation is performed.\n    *\n    * @param title the title for the confirmation dialog\n    * @param message the message body for the dialog\n    * @param callback the callback to invoke if the user clicks on OK.\n    */\n   function _confirmSessionOp(title, message, callback, currentItem,\n                              warning) {\n      let item = $scope.contextMenuItem || currentItem,\n         isTransferringFile =\n            wmksService.isFileTransferringInSession(item.wmksKey),\n         isTransferringPrintFile =\n            wmksService.isPrintFileTransferringInSession(item.wmksKey),\n         showWarn = typeof warning === 'undefined' ? true : warning;\n\n      $scope.showPanel = !$scope.showPanel;\n      ngDialog.openConfirm({\n         name: \"SessionOpsConfirmation\", // dialog name\n         templateUrl: confirmDialogTemplate, // dialog template\n         showClose: false, // do not show default close button\n         className: \"session-ops-dialog\", // CSS class name for the dialog\n         data: {\n            title: title, // title string for the dialog\n            message: message, // user readable message\n            showWarning: showWarn, // show data loss warning\n            isTransferringFile: isTransferringFile, // Whether some\n                                                    // desktop is\n                                                    // transferring file\n            isTransferringPrintFile: isTransferringPrintFile\n         },\n         closeByEscape: true, // allow escape to close window\n         closeByDocument: false // disallow clicking on background to\n                                // close window\n      }).then(function() {\n         if (wmksService.isCurrentSession(item.wmksKey)) {\n            wmksService.quitMultimon();\n         }\n         callback(item);\n      });\n   }\n\n   $scope.closeRunningApp = function(currentItem) {\n      let i = 0,\n         sortedInstances,\n         instanceIds = [];\n\n      if (!currentItem) {\n         return;\n      }\n\n      AB.LOGGER.log(\"Close current item \" + currentItem.name);\n      if (AB.UTIL.isDesktop(currentItem)) {\n         _confirmSessionOp(_(\"CLOSE_DESKTOP_T\"),\n            _(\"CLOSE_DESKTOP_M\", $scope.contextMenuItem.name),\n            function() {\n               wmksService.requestDisconnect(currentItem.wmksKey);\n            });\n      } else {\n         // Create a shallow copy of instances and sort on window name\n         sortedInstances = currentItem.instances.slice();\n         sortedInstances.sort(function(a, b) {\n            return a.name.localeCompare(b.name);\n         });\n\n         // Close all instances in sorted order\n         for (i = 0; i < sortedInstances.length; i++) {\n            instanceIds.push(sortedInstances[i].windowId);\n         }\n         unityService.closeWindows(currentItem.wmksKey, instanceIds);\n      }\n   };\n\n   /**\n    * _logOffDesktopCallback\n    *\n    * Callback to log off a desktop.\n    *\n    * @param item the desktop to log off.\n    */\n   function _logOffDesktopCallback(item) {\n      $rootScope.$emit('toggleBusyOverlay');\n      entitledItemsService.killItem(\n         item.wmksKey || item.id,\n         entitledItemsService.itemTypeEnum.desktop,\n         function(response) {\n            _sessionOpResultCallback(item, response);\n         });\n   }\n\n   /*\n    _toggleShowPanel\n    *\n    * Toggles whether the sidebar is shown. On hide, persist dirty prefs\n    */\n   function _toggleShowPanel() {\n      $timeout(function() {\n         let showPanel = !$scope.showPanel,\n            panelElement = $('.apps-panel');\n\n         $scope.showPanel = !$scope.showPanel;\n         contextMenuManager.closeMenu();\n\n         if (panelElement && panelElement[0]) {\n            panelElement[0].scrollTop = 0;\n         }\n         $scope.queryText = {\n            \"name\": \"\"\n         };\n\n         $scope.showLaunchPanel = !messageHandlerService.isFromHWS();\n\n         // If the prefs are dirty persist them\n         if (!$scope.showPanel && $scope.arePrefsDirty) {\n            $scope.prefPromise = $timeout(function() {\n               userGlobalPref.postPrefData();\n               $scope.arePrefsDirty = false;\n               $scope.prefPromise = null;\n            });\n         }\n\n         _touchDeviceRunner(function() {\n            if (!showPanel && _searchElem.is(\":focus\")) {\n               _searchElem.blur();\n            }\n         });\n      });\n   }\n\n   // Bug 1823043 the element's height is calculted wrong.\n   function _reviseAppPanelHeight() {\n      // 98 is head-panel's height. Can't use $(\".head-panel\").height()\n      // becasue the value is 0.\n      let height = $(\"body\").height() - 98;\n      $(\".apps-panel\").css(\"max-height\", height + \"px\");\n   }\n\n   /**\n    * logOffDesktop\n    *\n    * UI handler for logging of a desktop.\n    */\n   $rootScope.collapseSidebar = function() {\n      if ($scope.showPanel) {\n         _toggleShowPanel();\n      }\n   };\n\n   /**\n    * logOffDesktop\n    *\n    * UI handler for logging of a desktop.\n    */\n   $scope.logOffDesktop = function() {\n      AB.LOGGER.log(\"Log off Desktop: \" + $scope.contextMenuItem.name);\n      _confirmSessionOp(_(\"LOGOFF_DESKTOP_T\"),\n         _(\"LOGOFF_DESKTOP_M\", $scope.contextMenuItem.name),\n         _logOffDesktopCallback);\n   };\n\n   /**\n    * _resetDesktopCallback\n    *\n    * Callback to reset a desktop.\n    *\n    * @param item the desktop to reset.\n    */\n   function _resetDesktopCallback(item) {\n      $rootScope.$emit('toggleBusyOverlay');\n      wmksService.prepareForSessionReset(item.wmksKey);\n      entitledItemsService.resetDesktop(\n         item.wmksKey,\n         function(response) {\n            _sessionOpResultCallback(item, response);\n         });\n   }\n\n   /**\n    * isRunningDesktopExist\n    *\n    * Check if there is running desktop session.\n    *\n    */\n   $scope.isRunningDesktopExist = function() {\n      for (let i = 0; i < $scope.runningItems.length; i++) {\n         if (AB.UTIL.isDesktop($scope.runningItems[i])) {\n            return true;\n         }\n      }\n      return false;\n   };\n\n   /**\n    * resetDesktop\n    *\n    * UI handler for resetting a desktop.\n    */\n\n   $scope.resetDesktop = function() {\n      AB.LOGGER.log(\"Reset Desktop: \" + $scope.contextMenuItem.name);\n      $scope.showPanel = !$scope.showPanel;\n      _confirmSessionOp(_(\"RESET_DESKTOP_T\"),\n         _(\"RESET_DESKTOP_M\", $scope.contextMenuItem.name),\n         _resetDesktopCallback);\n   };\n\n   /**\n    * _restartDesktopCallback\n    *\n    * Callback to reset a desktop.\n    *\n    * @param item the desktop to reset.\n    */\n   function _restartDesktopCallback(item) {\n      $rootScope.$emit('toggleBusyOverlay');\n      wmksService.prepareForSessionReset(item.wmksKey);\n      entitledItemsService.restartDesktop(\n         item.wmksKey,\n         function(response) {\n            _sessionOpResultCallback(item, response);\n         });\n   }\n\n   /**\n    * restartDesktop\n    *\n    * UI handler for restarting a desktop.\n    */\n\n   $scope.restartDesktop = function() {\n      AB.LOGGER.log(\"Restart Desktop: \" + $scope.contextMenuItem.name);\n      $scope.showPanel = !$scope.showPanel;\n      _confirmSessionOp(_(\"RESTART_DESKTOP_T\"),\n         _(\"RESTART_DESKTOP_M\", $scope.contextMenuItem.name),\n         _restartDesktopCallback, null, false);\n   };\n\n   /*\n    * Handler for the settings menu button.\n    *\n    * @param [in] e the jquery click event\n    */\n   $scope.settingsClicked = function() {\n      ngDialog.open({\n         name: \"SettingsWindow\", // dialog name\n         templateUrl: settingDialogTemplate, // dialog template\n         className: \"settings-window\", // CSS class name\n         controller: \"settingsWindowController\", // Window controller\n         showClose: false, // do not show close button\n         closeByEscape: true, // allow escape to close window\n         closeByDocument: true // allow clicking on background to close\n                               // window\n      });\n   };\n\n   /**\n    * In Q1, we use the dialog to show 2 vertial display message since user\n    *    is doing valid operations but the result is not a valid horizon\n    *    multimon setting.\n    * p.s. dialog service is suggested to procide identical API with options as\n    *    dialogService.error(contentKey, optimalOptions);\n    */\n   $scope.showErrorMessage = function(contentKey, options) {\n      options = options || {};\n      ngDialog.open({\n         name: \"SessionOpsError\", // dialog name\n         templateUrl: errorDialogTemplate, // dialog template\n         showClose: false, // do not show the default close button\n         className: \"session-ops-dialog\", // css class to apply\n         data: {\n            errorMessage: options.rawMessage ||\n            _(contentKey, options.massageParam)\n         }, // data object for $scope.ngDialogData\n         closeByEscape: true, // allow escape to close window\n         closeByDocument: true // allow clicking on background to\n         // close window\n      });\n   };\n\n   /**\n    * This dialog is added accoring to PM's request\n    */\n   $scope.showWarningMessage = function(contentKey, options) {\n      options = options || {};\n      ngDialog.open({\n         name: \"SessionOpsWarning\", // dialog name\n         templateUrl: errorDialogTemplate, // dialog template\n         showClose: false, // do not show the default close button\n         className: \"session-ops-dialog\", // css class to apply\n         data: {\n            title: _(\"WARNING\"),\n            errorMessage: options.rawMessage ||\n            _(contentKey, options.massageParam)\n         }, // data object for $scope.ngDialogData\n         closeByEscape: true, // allow escape to close window\n         closeByDocument: true // allow clicking on background to\n         // close window\n      });\n   };\n\n   /*\n    * Handler for the multimon menu button.\n    *\n    * @param [in] e the jquery click event\n    */\n   $scope.multimonClicked = function() {\n      var enableHighResolution = (userGlobalPref.getPrefData().enableDPISync === 'true');\n\n      normalizationService.setAgentDPI(wmksService.getCurrentSessionDPI());\n      normalizationService.setDPISync(!enableHighResolution);\n      $scope.multimonSettingWindow = ngDialog.open({\n         name: \"MultimonSettingWindow\", // dialog name\n         templateUrl: multimonSettingWindowTemplate, // dialog template\n         className: \"settings-window\", // CSS class\n         controller: \"multimonSettingWindowController\", // Window controller\n         showClose: false, // do not show close button\n         closeByEscape: false, // do not allow escape to close window\n         closeByDocument: false // do not allow clicking on background to\n                                // close\n      });\n      $scope.multimonSettingWindow.closePromise.then(function() {\n         $scope.multimonSettingWindow = null;\n      });\n   };\n\n   /*\n    * Handler for the exit multimon menu button.\n    *\n    * @param [in] e the jquery click event\n    */\n   $scope.exitMultimonClicked = function() {\n      $scope.ExitMultimonDialog = ngDialog.open({\n         name: \"ExitMultimon\",\n         templateUrl: confirmDialogTemplate,\n         className: \"session-ops-dialog\",\n         data: {\n            title: _('MM_QUIT_MULTIMON_T'),\n            message: _('MM_QUIT_MULTIMON_M'),\n            buttonLabelConfirm: _('OK'),\n            buttonLabelCancel: _('CANCEL')\n         },\n         showClose: false,\n         closeByEscape: true,\n         closeByDocument: true,\n         scope: (function() {\n            $scope.close = function() {\n               $scope.ExitMultimonDialog.close();\n            };\n            $scope.confirm = function() {\n               wmksService.quitMultimon();\n               $scope.ExitMultimonDialog.close();\n            };\n            return $scope;\n         }())\n      });\n   };\n\n   /*\n    * Handler for the about menu button.\n    *\n    * @param [in] e the jquery click event\n    */\n   $scope.aboutClicked = function() {\n      AB.LOGGER.log(\"About\");\n      ngDialog.open({\n         name: \"AboutWindow\", // dialog name\n         templateUrl: aboutDialogTemplate, // dialog template\n         className: \"about-window\", // CSS class\n         showClose: false, // do not show close button\n         closeByEscape: true, // allow escape to close window\n         closeByDocument: true // allow clicking on background to close\n      });\n   };\n\n   $scope.toggleKeyboard = function() {\n      AB.LOGGER.log(\"Toggle keyboard\");\n      wmksService.launchKeyboard();\n   };\n\n   $scope.isSupportedMobileDevice = function() {\n      return _touchDeviceRunner(function() {\n         return true;\n      });\n   };\n\n   $scope.isTouchDevice = function() {\n      return WMKS.BROWSER.isTouchDevice();\n   };\n\n   // need to remove the hover property\n   _touchDeviceRunner(function() {\n      angular.element('#cad').removeClass('icon-button-hover');\n      angular.element('#clipboard').removeClass('icon-button-hover');\n      angular.element('#contextMenu').removeClass('icon-button-hover');\n   });\n\n   /*\n    * Handler to toggle clipboard panel visibility\n    */\n   $scope.openClipboardClicked = function() {\n      $rootScope.$emit('toggleClipboardPanel');\n   };\n\n   /*\n    * Handler to toggle file transfer panel visibility\n    */\n   $scope.openFileTransferPanel = function() {\n      $rootScope.$emit('toggleFileTransferPanel');\n   };\n\n   /*\n    * Callback to be invoked once the user confirms that they want to log out\n    */\n   function _logoutCallback() {\n      AB.LOGGER.log(\"User confirmed logout\");\n      $rootScope.$emit('toggleBusyOverlay');\n\n      wmksService.quitMultimon();\n\n      wmksService.requestDisconnect();\n   }\n\n   /*\n    * Handler for when the logout button is clicked.\n    *\n    * @Note: We do not stop propagation of the event to allow the body handler to\n    *        fire. This will close the settings menu for us.\n    */\n   $scope.logoutClicked = function() {\n      ngDialog.openConfirm({\n         name: \"DisconnectDialog\",\n         templateUrl: confirmDialogTemplate,\n         className: \"session-ops-dialog\",\n         data: {\n            title: _('CONFIRM_LOGOFF_BROKER_T'),\n            message: _('CONFIRM_LOGOFF_BROKER_M'),\n            showWarning: false\n         },\n         showClose: false,\n         closeByEscape: true, // allow escape to close window\n         closeByDocument: false // disallow clicking on background to\n                                // close window\n      }).then(_logoutCallback);\n   };\n\n   commonSvcService.init(wmksService);\n\n   $scope.runningItems = runningItemsModel.getRunningItems();\n\n   runningItemsModel.addEventListener(\n      \"valueChanged\",\n      function() {\n         // hide the application context menu if the sidebar contents\n         // have changed\n         contextMenuManager.closeMenu();\n         $scope.$apply();\n      }\n   );\n\n   runningItemsModel.addEventListener(\n      \"noVisibleWindow\",\n      function() {\n         if (!$scope.showPanel) {\n            _toggleShowPanel();\n         }\n\n         // If there is no running desktop session, close ft panel\n         if (!$scope.isRunningDesktopExist()) {\n            $rootScope.$emit('toggleFileTransferPanel', true);\n         }\n      }\n   );\n\n   // Close selected item.\n   $scope.closeRunningInstance = function(instance) {\n      unityService.closeWindow(instance.wmksKey, instance.windowId);\n   };\n\n   $scope.entitledItems = entitledItemsModel.getEntitledItems();\n   entitledItemsModel.addEventListener(\n      \"valueChanged\",\n      function() {\n         $timeout(function() {\n            $scope.$apply();\n         });\n      }\n   );\n\n   /*\n    * Handler to update the list of favorites once user global prefs are read\n    */\n   $rootScope.$on('userGlobalPrefsRead', function() {\n      let prefs = userGlobalPref.getPrefData(),\n         i,\n         length = $scope.entitledItems.length;\n\n      if (prefs && prefs.favorites) {\n         for (i = 0; i < length; i++) {\n            $scope.entitledItems[i].favorite =\n               prefs.favorites.indexOf($scope.entitledItems[i].id) !== -1;\n         }\n      }\n   });\n\n   /**\n    * _notAuthenticatedCallback\n    *\n    * Callback to handle not authenticated error. Displays a dialog and\n    * then moves the user back to the login page.\n    *\n    * @param keepConnected: flags whether we should keep the broker\n    *    connection, we keep the broker connection on idle disconnect\n    * @param errorMsg the human readable message. If this is undefined a\n    *    default message will be used.\n    */\n   function _notAuthenticatedCallback(event, params) {\n      let callback = function() {\n            // Requesting a disconnect should either close this window,\n            // or take it back to the login page. But in case it doesn't\n            // we want to be able to open another dialog in case a not\n            // authenticated error comes from somewhere else\n            $scope.notAuthenticatedDialogOpen = false;\n\n            if (params && params.keepConnected) {\n               AB.UTIL.returnToLauncher();\n            } else {\n               wmksService.requestDisconnect();\n            }\n         },\n         errorMsg = _('NOT_AUTHENTICATED_M');\n\n      // No need to bring up another dialog if one is opened\n      if ($scope.notAuthenticatedDialogOpen) {\n         return;\n      }\n\n      $scope.notAuthenticatedDialogOpen = true;\n\n      if (params && params.errorMsg) {\n         errorMsg = params.errorMsg;\n      }\n\n      ngDialog.openConfirm({\n         name: \"LaunchError\",\n         templateUrl: errorDialogTemplate,\n         showClose: false,\n         className: \"session-ops-dialog\",\n         data: {\n            errorMessage: errorMsg\n         },\n         closeByEscape: false, // do not allow escape to close window\n         closeByDocument: false // do not allow clicking on background to\n                                // close window\n      }).then(callback, callback); // use the same callback regardless of\n                                   // how the dialog is closed\n   }\n\n   // Register to handle the not-authenticated event from the\n   // idleSessionService\n   idleSessionService.addEventListener('not-authenticated', function() {\n      AB.LOGGER.info(\"not-authenticated is received\");\n      $scope.$apply(_notAuthenticatedCallback);\n   });\n\n\n   function _findRunningItemNameById(wmksKey) {\n      let runningItems = runningItemsModel.getRunningItems();\n      for (let i = 0; i < runningItems.length; i++) {\n         if (runningItems[i].wmksKey === wmksKey) {\n            return runningItems[i].name;\n         }\n      }\n   }\n\n   /**\n    * Will pop out a dialog to confirm whether user wants to steal device\n    * from other session.\n    * Currently only desktops are supported, once the agent support RTAV\n    * with RDSH, this code need to be changed\n    * @param {object} info The object of RTAV device stealing, currently\n    *    only stolenSessionId exists\n    * @param {function} okCallback The ok callback\n    * @param {function} cancelCallback The cancel callback\n    */\n   function _confirmRTAVsessionSteal(info, okCallback, cancelCallback) {\n      let stolenDesktopName;\n\n      if (!!info) {\n         stolenDesktopName =\n            _findRunningItemNameById(info.stolenSessionId);\n      }\n      if (!stolenDesktopName) {\n         AB.LOGGER.error('invalid session steal');\n         return;\n      }\n      AB.LOGGER.log(\n         'detect RTAV devices are being used by' + stolenDesktopName);\n      ngDialog.open({\n         name: \"RTAVInitError\",\n         templateUrl: errorDialogTemplate,\n         className: \"session-ops-dialog\",\n         data: {\n            title: _('RTAV_DEVICE_CONFLICT_T'),\n            errorMessage: _(\"RTAV_DEVICE_CONFLICT_M\"),\n            buttonLabel: _('OK')\n         },\n         showClose: false,\n         closeByEscape: true,\n         closeByDocument: true\n      });\n      // call the cancelCallback here for we only need to show a error\n      // dialog, and then we could send response to the agent.\n      cancelCallback();\n   }\n\n   RTAVService.setDialogHandler(_confirmRTAVsessionSteal);\n\n   /*\n    * check before launch to ensure user will not loss the data for multimon\n    */\n   $scope.launchItem = function(item) {\n      wmksService.whenNotInMultimon(function() {\n         $scope._launchItem(item);\n      });\n   };\n\n   /*\n    * Launch item when user click on the entitled items.\n    *\n    * Todo: How to handle failure case. Popup a dialog or retry. :)\n    *\n    * @param item item to be launched.\n    */\n   $scope._launchItem = function(item) {\n      let onDone = function(response) {\n            $rootScope.$emit('toggleBusyOverlay', false);\n            // if the item is available, clear the timeout\n            if (!!$scope.timeoutID) {\n               clearTimeout($scope.timeoutID);\n               $scope.timeoutID = null;\n            }\n            //close the server not response dialog here.\n            if ($scope.serverNotRespondingDialog) {\n               $scope.serverNotRespondingDialog.close();\n            }\n            if ((typeof response === 'object') && !response.success) {\n               if (response.error &&\n                  response.error.errorType ===\n                  JSCDKBrokerError.JSCDK_BROKER_ERROR_DESKTOP_LAUNCH_ERROR &&\n                  response.error.userMsg.indexOf(PROTOCOL_ERROR) > -1) {\n                  /*\n                   * If we start an RDP connection to a RDSH agent,\n                   * then try to steal the session from HTML Access,\n                   * we get an error saying \"you have an existing session\n                   * that cannot be reconnected to with the specified protocol.\n                   * In this case, prompt the user whether to logoff from the RDP session.\n                   */\n                  AB.LOGGER.log(\"Log off Desktop: \" + item.name);\n                  _confirmSessionOp(_(\"LOGOFF_RDP_SESSION_T\"),\n                     _(\"LOGOFF_RDP_SESSION_M\", item.name),\n                     _logOffDesktopCallback, item, false);\n               } else if ((response.error && response.error.errorType !==\n                  JSCDKBrokerError.JSCDK_BROKER_ERROR_NOT_AUTHENTICATED) &&\n                  !(response.error && response.error.errorType ===\n                  JSCDKBrokerError.JSCDK_BROKER_ERROR_DESKTOP_LAUNCH_ERROR &&\n                  response.error.errorMsg ===\n                  SECURITY_SERVER_RESET_ERROR)) {\n                  ngDialog.open({\n                     name: \"LaunchError\",\n                     templateUrl: errorDialogTemplate,\n                     showClose: false,\n                     className: \"session-ops-dialog\",\n                     data: {\n                        errorMessage: response.error.userMsg\n                     }\n                  });\n               } else {\n                  _notAuthenticatedCallback(\n                     null, {\n                        errorMsg: response.error.userMsg\n                     }\n                  );\n               }\n            } else if ($scope.showPanel) {\n               // hides panel on successful item launch\n               _toggleShowPanel();\n               // If we successfully launch then canLogoff should be\n               // \"true\"\n               if (AB.UTIL.isDesktop(item)) {\n                  item.canLogoff = \"true\";\n               }\n            }\n         };\n      $rootScope.$emit('toggleBusyOverlay');\n      if (AB.UTIL.isApp(item)) {\n         // Launch application.\n         AB.LOGGER.log(\n            \"Application \" + item.name + \" has been selected.\");\n         wmksService.connectToApplication(item.id, item['origin-id'],\n            undefined, onDone, $scope.timeoutHandler);\n      } else {\n         AB.LOGGER.log(\"Desktop \" + item.name + \" has been selected.\");\n         wmksService.connectToDesktop(item.id, item.name, undefined,\n            item.isShadow, onDone);\n         $scope.timeoutHandler();\n      }\n   };\n\n   $scope.timeoutHandler = function() {\n      // When 30 seconds expire, display a warning dialog asking user\n      // whether to cancel the request.\n      $scope.timeoutID = setTimeout(function () {\n         $rootScope.isJSCDKResponse = false;\n         // Remove busy cursor.\n         $rootScope.$emit('toggleBusyOverlay', false);\n         $scope.timeoutID = null;\n         // if there's no sso dialog, don't show keep connect dialog again.\n         if (!!$rootScope.reAuthDialog) {\n            return;\n         }\n\n         $scope.serverNotRespondingDialog =\n             ngDialog.open({\n                name: \"ServerNotResponding\",\n                templateUrl: confirmDialogTemplate,\n                className: \"session-ops-dialog\",\n                data: {\n                   title: _('SERVER_NOT_RESP_T'),\n                   message: _('SERVER_NOT_RESP_M'),\n                   buttonLabelConfirm: _('OK'),\n                   buttonLabelCancel: _('CANCEL')\n                },\n                showClose: false,\n                closeByEscape: true,\n                closeByDocument: true,\n                scope: (function () {\n                   $scope.close = function () {\n                      // Press cancel btn, cancel launching item request.\n                      if (!$rootScope.isJSCDKResponse) {\n                         entitledItemsService.abortRequest();\n                      }\n                      $scope.serverNotRespondingDialog.close();\n                   };\n\n                   // use a new function to close the\n                   // dialog,closeThisDialog can't be rewriten here.\n                   $scope.confirm = function () {\n                      // Press OK btn, keep on waiting\n                      if (!$rootScope.isJSCDKResponse) {\n                         //if there's no error dialog, display busy cursor\n                         $rootScope.$emit('toggleBusyOverlay', true);\n                      }\n                      $scope.serverNotRespondingDialog.close();\n                   };\n                   return $scope;\n                }())\n             });\n      }, 30 * 1000);\n   };\n\n   $scope.isCopy = true;\n   $scope.isPasted = false;\n\n   /*\n    * enableShowOnlyFavorites\n    *\n    * Callback to enable favorites only mode for the available item list.\n    */\n   $scope.enableShowOnlyFavorites = function() {\n      $scope.showOnlyFavorites = true;\n   };\n\n   /*\n    * disableShowOnlyFavorites\n    *\n    * Callback to disable favorites only mode for the available item list.\n    */\n   $scope.disableShowOnlyFavorites = function() {\n      $scope.showOnlyFavorites = false;\n   };\n\n   /*\n    * toggleFavorite\n    *\n    * Callback to toggle whether an item should be a favorite or not.\n    */\n   $scope.toggleFavorite = function(item) {\n      item.favorite = !item.favorite;\n\n      userGlobalPref.updatePrefData({\n         name: 'favorite',\n         text: item.id,\n         action: item.favorite ? 'FavOn' : 'FavOff'\n      });\n\n      // Mark the prefs as dirty so we persist them when the sidebar is\n      // closed.\n      $scope.arePrefsDirty = true;\n   };\n\n   $scope.$on('togglePanel', function(event, args) {\n      _toggleShowPanel();\n      _reviseAppPanelHeight();\n   });\n\n   $scope.$on('sliderMoveStart', function(event, args) {\n      $scope.$apply(function() {\n         contextMenuManager.closeMenu();\n      });\n   });\n\n   $rootScope.setMultimonStarted = function(started) {\n      $scope.$apply(function() {\n         $scope.multimonStarted = started;\n      });\n   };\n\n   wmksServiceEventHandler.addEventListener('idleSessionWarning',\n      function() {\n         // Don't show more than one warning at a time\n         if (!!$scope.idleTimeoutWarningDialog ||\n            $scope.notAuthenticatedDialogOpen) {\n            return;\n         }\n         $scope.idleTimeoutWarningDialog =\n            ngDialog.open({\n               name: \"IdleDisconnectWarningDialog\",\n               templateUrl: errorDialogTemplate,\n               className: \"session-ops-dialog\",\n               data: {\n                  errorMessage: _(\"DESKTOP_IDLE_WARNING_M\"),\n                  title: _('DESKTOP_IDLE_WARNING_T'),\n                  buttonLabel: _('OK')\n               },\n               showClose: false,\n               closeByEscape: true,\n               closeByDocument: true\n            });\n         $scope.idleTimeoutWarningDialog.closePromise.then(function() {\n            $scope.idleTimeoutWarningDialog = null;\n         });\n      });\n\n   wmksServiceEventHandler.addEventListener('sessionConnected',\n      function(wmksKey) {\n         // On current session connection, close the sidebar\n         if ($scope.showPanel && wmksService.isCurrentSession(wmksKey)) {\n            _toggleShowPanel();\n         }\n\n         if (wmksService.isCurrentSessionApp()) {\n            $scope.isCurrentItemApp = true;\n            $rootScope.$emit('toggleFileTransferPanel', true);\n         } else {\n            $scope.isCurrentItemApp = false;\n         }\n      });\n\n   wmksServiceEventHandler.addEventListener('activeSessionChanged',\n      function(wmksKey) {\n         if (wmksService.isCurrentSessionApp()) {\n            $scope.isCurrentItemApp = true;\n            $rootScope.$emit('toggleFileTransferPanel', true);\n         } else {\n            $scope.isCurrentItemApp = false;\n         }\n      });\n\n   wmksServiceEventHandler.addEventListener('sessionDisconnected',\n      function(wmksKey, isApplicationSession) {\n         if ($scope.idleTimeoutWarningDialog) {\n            $timeout(function() {\n               $scope.idleTimeoutWarningDialog.close();\n            });\n         }\n\n         if (!$scope.showPanel && wmksService.isCurrentSession(wmksKey)) {\n            _toggleShowPanel();\n         }\n      });\n\n   wmksServiceEventHandler.addEventListener('sessionDisconnected',\n      function(wmksKey, isApplicationSession, wasCurrentSession) {\n         if (wasCurrentSession) {\n            if ($scope.multimonSettingWindow) {\n               $timeout(function() {\n                  $scope.multimonSettingWindow.close();\n               });\n            }\n            wmksService.destroyMultimon();\n         }\n      });\n\n   wmksServiceEventHandler.addEventListener('sessionDataReady',\n      function(sessionData) {\n         $scope.userName = sessionData.user;\n         $scope.userInfo = sessionData.user;\n         if (!!sessionData.domainName) {\n            $scope.userInfo += '@' + sessionData.domainName;\n         }\n         $scope.desktopInfo = sessionData.desktopName;\n      });\n   wmksServiceEventHandler.listenerReadyForModule(\n      wmksServiceEventHandler.MODULE_NAME.SIDEBAR);\n\n   // Todo: Rewrite the HTML code for focused feature to avoid call those\n   // functions many times.\n   /**\n    * Any selected application is focused.\n    *\n    * return true if current application or desktop is focused.\n    *\n    * @param [in] app the application object.\n    */\n   $scope.appHasFocus = function(currentItem) {\n      return currentItem.isFocusedItem();\n   };\n\n   /**\n    * Any selected unity window is focused.\n    *\n    * return true if the app of unity window and unity window itself are\n    * both focused\n    *\n    * @param [in] app the application object.\n    */\n   $scope.unityWindowHasFocused = function(currentApp, currentItem) {\n      return currentApp.isFocusedItem() && currentItem.isFocused;\n   };\n\n   /**\n    * Handler to be called when the window is resized.\n    *\n    * Changes the max-height of the apps panel to make sure it scrolls\n    * properly.\n    */\n   function resizeHandler() {\n      let newMaxHeight = ($(window).height()) -\n         $('.head-panel')[0].offsetHeight;\n      if (newMaxHeight < 0) {\n         newMaxHeight = 100;\n      }\n\n      $('.apps-panel').css('max-height', newMaxHeight);\n   }\n\n   resizeHandler();\n\n   angular.element($window).bind('resize', resizeHandler);\n\n   /*\n    * Handler to be called when the apps panel is scrolled. Closes a context menu\n    * if it is open. Needed because certain types of scrolling events do not\n    * issue a mouse down event before hand (example: touch pad scrolling). If\n    * the app-panel is scrolled then the menu will no longer line up with the\n    * selected app. Instead of trying to move the menu we simply close it.\n    */\n   function scrollHandler() {\n      $scope.$apply(function() {\n         contextMenuManager.closeMenu();\n      });\n   }\n\n   angular.element($('.apps-panel')).bind('scroll', scrollHandler);\n\n   $scope.$on('$destroy', function handleDestroyEvent() {\n      angular.element($window).unbind('resize', resizeHandler);\n      angular.element($('.apps-panel')).unbind('scroll', scrollHandler);\n      if (!!$scope.prefsPromise) {\n         $timeout.cancel($scope.prefsPromise);\n         $scope.prefsPromise = null;\n      }\n   });\n\n   let launchItem4HWS = function(itemType, itemId) {\n      let i,\n         item,\n         itemIsApp,\n         targetItem = null;\n\n      for (i = 0; i < $scope.entitledItems.length; i++) {\n         item = $scope.entitledItems[i];\n         itemIsApp = AB.UTIL.isApp(item);\n         if ((item.id === itemId || item.name === itemId) &&\n            ((!itemIsApp && itemType === \"Desktop\") ||\n            (itemIsApp && itemType === \"Application\"))\n         ) {\n            targetItem = item;\n         }\n      }\n      if (!!targetItem) {\n         $scope.launchItem(targetItem);\n      }\n   };\n   messageHandlerService.registerLaunchCallback(launchItem4HWS);\n}\n\nexport function sidebarDirective() {\n   return {\n      restrict: 'ACE',\n      transclude: true,\n      controller: 'SidebarController',\n      scope: {},\n      templateUrl: sidebarTemplate\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/sidebar/sidebar.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * vertical-slider.js --\n *\n * Module to implement a UI element that can be slid up and down the\n * entire document. The element is packaged as a directive named\n * verticalSlider.\n * The directive is responsible for allowing the use to move its contents by\n * dragging them. The directive also accepts allows the developer to configure\n * what action will be taken when the user clicks on the element but does not\n * move it.\n *\n * The actual visuals of the element are controlled via HTML and CSS.\n *\n * The directive expects the following attributes to be defined:\n *\n *   on-click = an expression that will be evaluated when the element is\n * clicked on on-move = an expression that will be evaluated when the element\n * is moved element-drag-styles = a list of css classes that will be toggled on\n * the element when it is dragged. body-drag-styles = a list of css classes\n * that will be toggled on the HTML body when the element is dragged.\n *\n * Sample use:\n *\n *     <vertical-slider class=\"panel-toggle-tab pointer-cursor\"\n *               on-click=\"$emit('togglePanel')\"\n *               on-move=\"$emit('sliderMoveStart')\"\n *               element-drag-styles=\"pointer-cursor resize-cursor\"\n *               body-drag-styles=\"resize-cursor\">\n *        <img src=\"img/tab.png\"/>\n *     </vertical-slider>\n *\n * Limitations:\n *    - The element can only be moved vertically and it moves the entire height\n * of the document body.\n *    - Double clicking is not supported.\n *\n */\n\nimport angular from 'angular';\n\n\nexport default function verticalSliderDirective($window, AB) {\n   function link(scope, element) {\n      let body = angular.element(document).find('body'),\n         startY = 0,\n         maxYValue = function() {\n            return ($window.innerHeight - element[0].offsetHeight);\n         },\n         clamp = function(y) {\n            return AB.UTIL.clamp(y, 0, maxYValue());\n         },\n         y = clamp(maxYValue() / 2),\n         moving = false,\n         moved = false;\n\n      element.css({\n         top: y + 'px'\n      });\n\n      function resizeHandler() {\n         y = clamp(y);\n         element.css({\n            top: y + 'px'\n         });\n      }\n\n      angular.element($window).bind('resize', resizeHandler);\n\n      function sidebarMouseMove(event) {\n         event.preventDefault();\n         event.stopPropagation();\n         let oldY = y;\n         y = event.pageY - startY;\n\n         y = clamp(y);\n\n         if (y !== oldY) {\n            moved = true;\n            element.css({\n               top: y + 'px'\n            });\n         }\n      }\n\n      function sidebarMouseUp(event) {\n         if (!moved) {\n            scope.onClick();\n         }\n\n         $(document).off('mousemove', sidebarMouseMove);\n         $(document).off('mouseup', sidebarMouseUp);\n\n         element.toggleClass(scope.elementDragStyles);\n         body.toggleClass(scope.bodyDragStyles);\n\n         moving = false;\n      }\n\n      element.on('mousedown', function(event) {\n         // Prevent default dragging of selected content\n         event.preventDefault();\n         startY = event.pageY - y;\n         moving = true;\n         moved = false;\n\n         scope.onMove();\n\n         $(document).on('mousemove', sidebarMouseMove);\n         $(document).on('mouseup', sidebarMouseUp);\n\n         element.toggleClass(scope.elementDragStyles);\n         body.toggleClass(scope.bodyDragStyles);\n      });\n\n      scope.$on('$destroy', function handleDestroyEvent() {\n         angular.element($window).unbind('resize', resizeHandler);\n         if (moving) {\n            $(document).off('mousemove', sidebarMouseMove);\n            $(document).off('mouseup', sidebarMouseUp);\n         }\n      });\n   }\n\n   return {\n      restrict: 'E',\n      link: link,\n      scope: {\n         onClick: '&',\n         onMove: '&',\n         elementDragStyles: '@',\n         bodyDragStyles: '@'\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./desktop/sidebar/vertical-slider.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * cancelAuthenticationCommand.js --\n *\n *      Cancels any currently active authentication.  Should be triggered by\n *      the application if the user cancels while partially through\n * authentication.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport DoCancelAuthenticationHandler from '../controllers/doCancelAuthenticationHandler';\n\nexport default function CancelAuthenticationCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param cancelAuthenticationAction[in]\n *        - its property 'method' has the value 'CancelAuthentication'\n */\nCancelAuthenticationCommand.prototype.execute =\n   function(cancelAuthenticationAction) {\n      let handlerList,\n         cancelAuthObject = globalArray[\"do-cancel-authentication\"],\n         router = globalArray[\"router\"];\n\n      if (!cancelAuthObject) {\n         cancelAuthObject = new DoCancelAuthenticationHandler();\n         globalArray[cancelAuthObject.messageName] = cancelAuthObject;\n         globalArray[cancelAuthObject.responseTag] = cancelAuthObject;\n      } else {\n         cancelAuthObject.resetData();\n      }\n\n      handlerList = cancelAuthObject.composeHandlerList();\n\n      router.postMessage(handlerList);\n   };\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/cancelAuthenticationCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * cancelCurrentReuqestCommand.js --\n *\n * Cancel the current AJAX request for JSCDK.\n *\n */\n\nimport $ from 'jquery';\nimport JSCDKLogger from '../jscdkLogger.js';\nimport {globalArray} from '../jscdkClient';\nimport {JSCDKSetUI} from '../jscdkClient';\n\nexport default function CancelCurrentRequestCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * Abort the current AJAX request in router.\n */\nCancelCurrentRequestCommand.prototype.execute = function(cancelRequestAction) {\n   let doneAction,\n      router = globalArray[\"router\"];\n   doneAction = cancelRequestAction.doneAction;\n   if (!!router && !!router.recentXhrObject\n      && $.isFunction(router.recentXhrObject.abort)) {\n      router.recentXhrObject.abort();\n      JSCDKLogger.debug(\"Cancel current request complete.\");\n   } else {\n      /*\n       * If router or XHR object is null, it means the current AJAX request\n       * hasn't started. Set the ajaxWasAbort flag to tell router not to\n       * fire the request.\n       */\n      router.ajaxWasAborted = true;\n      JSCDKLogger.debug(\"AJAX request hasn't started yet.\");\n   }\n   /*\n    * Set UI to user's expected page for both correct and error cases.\n    */\n   if (!!doneAction) {\n      JSCDKSetUI(JSON.stringify(doneAction));\n      JSCDKLogger.debug(\"Done action: \" + JSON.stringify(doneAction));\n   } else {\n      JSCDKLogger.error(\"Done action is not set.\");\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/cancelCurrentRequestCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * connectToApplicationCommand.js --\n *\n * Called to setup and retrieve the parameters for a application connection.\n * The returned parameters should be used to launch an appropriate client for\n * the connection protocol, e.g. an RDP client when <protocol>RDP</protocol> is\n * returned.\n *    1. GetApplicationConnection\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport GetApplicationConnectionHandler from '../controllers/getApplicationConnectionHandler';\nimport SetUserGlobalPrefHandler from '../controllers/setUserGlobalPrefHandler';\nimport Router from '../controllers/router';\n\nexport default function ConnectToApplicationCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param selectApplicationAction[in]\n *        - its property 'method' has the value 'ConnectToApplication'\n */\nConnectToApplicationCommand.prototype.execute =\n   function(selectApplicationAction) {\n      let handlerList,\n         getApplicationConnObject = globalArray[\"get-application-connection\"],\n         router = globalArray[\"router\"],\n         setPrefHandler = globalArray[\"set-user-global-preferences\"];\n\n      if (!router) {\n         JSCDKLogger.info(\"router is null.\");\n\n         router = new Router();\n         globalArray[router.name] = router;\n      }\n\n      if (!setPrefHandler) {\n         setPrefHandler = new SetUserGlobalPrefHandler();\n         globalArray[setPrefHandler.messageName] = setPrefHandler;\n      }\n      setPrefHandler.setRequestXML(selectApplicationAction.prefData);\n\n      if (!getApplicationConnObject) {\n         getApplicationConnObject = new GetApplicationConnectionHandler();\n         globalArray[getApplicationConnObject.messageName] =\n            getApplicationConnObject;\n         globalArray[getApplicationConnObject.responseTag] =\n            getApplicationConnObject;\n      } else {\n         getApplicationConnObject.resetData();\n      }\n\n      getApplicationConnObject.setRequestXML(\n         selectApplicationAction.applicationId,\n         selectApplicationAction.protocol,\n         selectApplicationAction.environmentInfo,\n         selectApplicationAction.maximized,\n         selectApplicationAction.launchParam);\n\n      getApplicationConnObject.saveOriginId(selectApplicationAction.originId);\n\n      handlerList = getApplicationConnObject.composeHandlerList();\n      router.postMessage(handlerList);\n   };\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/connectToApplicationCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * connectToBrokerCommand.js --\n *\n * First stage of authentication:\n *    1. SetLocale\n *    2. GetConfiguration\n *\n */\n\nimport util from '../util';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport Router from '../controllers/router';\nimport SetLocaleHandler from '../controllers/setLocaleHandler';\nimport {\n   GetConfigurationHandler,\n   HaveAuthTypesEnum\n} from '../controllers/getConfigurationHandler';\nimport AddClientInfoHandler from '../controllers/addClientInfoHandler';\n\n\nexport default function ConnectToBrokerCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param connectBrokerAction[in]\n *        - its property 'method' has the value 'ConnectToBroker'\n */\nConnectToBrokerCommand.prototype.execute = function(connectBrokerAction) {\n   let handlerList,\n      samlSecret,\n      unauthenticated,\n      urlHandler,\n      oneProtocol,\n      brokerUrl,\n      setLocaleObject = globalArray[\"set-locale\"],\n      getConfigurationObject = globalArray[\"get-configuration\"],\n      submitAuthenticationObject = globalArray[\"do-submit-authentication\"],\n      addClientInfoObject = globalArray[\"add-client-info\"],\n      router = globalArray[\"router\"];\n\n   //init GetConfigurationHandler to handle URL\n   if (!getConfigurationObject) {\n      getConfigurationObject = new GetConfigurationHandler();\n      globalArray[getConfigurationObject.messageName] = getConfigurationObject;\n      globalArray[getConfigurationObject.responseTag] = getConfigurationObject;\n   } else {\n      getConfigurationObject.resetData();\n   }\n\n   urlHandler = util.getObject(globalArray, \"url-handler\");\n\n   if (!!urlHandler) {\n      samlSecret = urlHandler.params.samlArt;\n      unauthenticated = urlHandler.params.unauthenticatedAccessEnabled;\n      if (!!samlSecret) {\n         globalArray[\"samlArt\"] = samlSecret;\n         getConfigurationObject.setAuthTypes(\n            HaveAuthTypesEnum.HAVEAUTHTYPE_SAML);\n      } else if (!!unauthenticated &&\n         unauthenticated.toLowerCase() === 'true') {\n         getConfigurationObject.setAuthTypes(\n            HaveAuthTypesEnum.HAVEAUTHTYPE_UNAUTH);\n      } else {\n         getConfigurationObject.setAuthTypes(\n            HaveAuthTypesEnum.HAVEAUTHTYPE_DEFAULT);\n      }\n   } else {\n      getConfigurationObject.setAuthTypes(\n         HaveAuthTypesEnum.HAVEAUTHTYPE_DEFAULT);\n   }\n\n   // read in data from connectBrokerAction\n   // \"add-client-info\" work after broker>= 9.0\n   if (connectBrokerAction.hasOwnProperty(\"clientInfo\") &&\n      util.brokerSupportApplication()) {\n      if (!addClientInfoObject) {\n         addClientInfoObject = new AddClientInfoHandler();\n         globalArray[addClientInfoObject.messageName] = addClientInfoObject;\n         globalArray[addClientInfoObject.responseTag] = addClientInfoObject;\n      } else {\n         addClientInfoObject.resetData();\n      }\n\n      addClientInfoObject.clientInfo = connectBrokerAction.clientInfo;\n   }\n\n   if (!router) {\n      JSCDKLogger.info(\"router is null.\");\n\n      router = new Router();\n      globalArray[router.name] = router;\n   }\n\n   if (!!connectBrokerAction.supportedProtocols) {\n      for (oneProtocol in connectBrokerAction.supportedProtocols) {\n         if (connectBrokerAction.supportedProtocols.hasOwnProperty(\n               oneProtocol)) {\n            oneProtocol = oneProtocol.toUpperCase();\n         }\n      }\n   } else {\n      JSCDKLogger.error(\"No supported protocols configured.\");\n      return;\n   }\n\n   globalArray[\"brokerAddress\"] = connectBrokerAction.address;\n   globalArray.supportedProtocols = connectBrokerAction.supportedProtocols;\n\n   // Configure broker post address, specify whether a timestamp is appended to\n   // the URL.\n   brokerUrl = \"https://\" + connectBrokerAction.address + \"/broker/xml\" +\n      (!!connectBrokerAction.mid ? connectBrokerAction.mid : \"\");\n   router.setBrokerUrl(brokerUrl, !!connectBrokerAction.urlParam);\n\n   // if bypassTunnel exists, put bypassTunnel into globalArray\n   if (connectBrokerAction.bypassTunnel !== undefined) {\n      globalArray.bypassTunnel = connectBrokerAction.bypassTunnel;\n   } else {\n      globalArray.bypassTunnel = true;\n   }\n\n   // reset submitAuthenticationObject for later usage when dealing with\n   // <configuration>\n   if (!!submitAuthenticationObject) {\n      submitAuthenticationObject.resetData();\n   }\n\n   // send getconfiguration & setlocal to inform broker, but not prepare to\n   // login\n   if (!setLocaleObject) {\n      setLocaleObject = new SetLocaleHandler();\n      globalArray[setLocaleObject.messageName] = setLocaleObject;\n      globalArray[setLocaleObject.responseTag] = setLocaleObject;\n   } else {\n      setLocaleObject.resetData();\n   }\n\n   getConfigurationObject.setRequestXML(true);\n   handlerList = getConfigurationObject.composeHandlerList();\n   router.postMessage(handlerList);\n};\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/connectToBrokerCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * connectToDesktopCommand.js --\n *\n * Called to setup and retrieve the parameters for a desktop connection.\n * The returned parameters should be used to launch an appropriate client for\n * the connection protocol, e.g. an RDP client when <protocol>RDP</protocol> is\n * returned.\n *    1. GetDesktopConnection\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport Router from '../controllers/router';\nimport GetDesktopConnectionHandler from '../controllers/getDesktopConnectionHandler';\nimport SetUserGlobalPrefHandler from '../controllers/setUserGlobalPrefHandler';\n\nexport default function ConnectToDesktopCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param selectDesktopAction[in]\n *        - its property 'method' has the value 'ConnectToDesktop'\n */\nConnectToDesktopCommand.prototype.execute = function(selectDesktopAction) {\n   let handlerList,\n      getDesktopConnObject = globalArray[\"get-desktop-connection\"],\n      desktopPreferences,\n      router = globalArray[\"router\"],\n      setPrefHandler = globalArray[\"set-user-global-preferences\"];\n\n   if (!router) {\n      JSCDKLogger.info(\"router is null.\");\n\n      router = new Router();\n      globalArray[router.name] = router;\n   }\n\n   if (!setPrefHandler) {\n      setPrefHandler = new SetUserGlobalPrefHandler();\n      globalArray[setPrefHandler.messageName] = setPrefHandler;\n   }\n   setPrefHandler.setRequestXML(selectDesktopAction.prefData);\n\n   if (!getDesktopConnObject) {\n      getDesktopConnObject = new GetDesktopConnectionHandler();\n      globalArray[getDesktopConnObject.messageName] = getDesktopConnObject;\n      globalArray[getDesktopConnObject.responseTag] = getDesktopConnObject;\n   } else {\n      getDesktopConnObject.resetData();\n   }\n\n   desktopPreferences = selectDesktopAction.preferences;\n\n   getDesktopConnObject.setRequestXML(selectDesktopAction.desktopId,\n      selectDesktopAction.protocol,\n      selectDesktopAction.environmentInfo,\n      selectDesktopAction.isShadow);\n\n   getDesktopConnObject.setPreferences(desktopPreferences);\n\n\n   handlerList = getDesktopConnObject.composeHandlerList();\n   router.postMessage(handlerList);\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/connectToDesktopCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * disconnectSessionCommand.js --\n *\n * logoff session.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport DisconnectSessionHandler from '../controllers/doDisconnectSessionHandler';\nimport GetLaunchItemsHandler from '../controllers/getLaunchItemsHandler';\n\nexport default function DisconnectSessionCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param disconnectSessionAction[in]\n *        - its property 'method' has the value 'DisconnectSession'\n */\nDisconnectSessionCommand.prototype.execute = function(disconnectSessionAction) {\n   let handlerList,\n      launchItemId,\n      disconnectSessionObject,\n      getLaunchItemsObject,\n      supportedProtocols,\n      supportedAppProtocols,\n      type,\n      router = globalArray['router'];\n\n   launchItemId = disconnectSessionAction.launchItemId;\n\n   // Get DisconnectSessionHandler\n   disconnectSessionObject = globalArray['disconnect-session' + launchItemId];\n   if (!disconnectSessionObject) {\n      disconnectSessionObject = new DisconnectSessionHandler();\n      globalArray[disconnectSessionObject.messageName + launchItemId] =\n         disconnectSessionObject;\n      globalArray[disconnectSessionObject.responseTag + launchItemId] =\n         disconnectSessionObject;\n   } else {\n      disconnectSessionObject.resetData();\n   }\n   // The targeted session ID.\n   disconnectSessionObject.launchItemId = launchItemId;\n\n   getLaunchItemsObject = globalArray[\"get-launch-items\" + launchItemId];\n   if (!getLaunchItemsObject) {\n      getLaunchItemsObject = new GetLaunchItemsHandler(true, true);\n      globalArray[getLaunchItemsObject.messageName + launchItemId] =\n         getLaunchItemsObject;\n      globalArray[getLaunchItemsObject.responseTag + launchItemId] =\n         getLaunchItemsObject;\n   } else {\n      getLaunchItemsObject.resetData();\n   }\n\n   getLaunchItemsObject.appendSubHandler(disconnectSessionObject);\n\n   if (!!getLaunchItemsObject && !!router) {\n      supportedProtocols = globalArray.supportedProtocols || [\"BLAST\"];\n      type = {};\n      type.name = \"remote\";\n      type.protocols = supportedProtocols;\n      supportedAppProtocols = [];\n      supportedAppProtocols[0] = type;\n      if (!!supportedProtocols) {\n         getLaunchItemsObject.setRequestXML(supportedProtocols,\n            supportedAppProtocols, false);\n         handlerList = getLaunchItemsObject.composeHandlerList();\n         router.postMessage(handlerList);\n      } else {\n         JSCDKLogger.error(\"supported protocols is invalid.\");\n      }\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/disconnectSessionCommand.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * doLockCommand.js --\n *\n *      Called to lock the broker. Should be triggered by\n *      idle timeout if the user disactive for a long time.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport DoLockHandler from '../controllers/doLockHandler';\n\nexport default function DoLockCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param DoLockAction[in]\n *        - its property 'method' has the value 'DoLock'\n */\nDoLockCommand.prototype.execute = function(DoLockAction) {\n   let doLockObject,\n      handlerList,\n      router = globalArray[\"router\"];\n   if (!util.brokerSupportApplication()) {\n      return;\n   }\n   doLockObject = globalArray[\"do-lock\"];\n   if (!doLockObject) {\n      doLockObject = new DoLockHandler();\n      globalArray[doLockObject.messageName] = doLockObject;\n      globalArray[doLockObject.responseTag] = doLockObject;\n   } else {\n      doLockObject.resetData();\n   }\n\n   if (!!doLockObject && !!router) {\n      doLockObject.setRequestXML();\n      handlerList = doLockObject.composeHandlerList();\n      router.postMessage(handlerList);\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/doLockCommand.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * doUnlockCommand.js --\n *\n *      Called to unlock the broker\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport DoUnlockHandler from '../controllers/doUnlockHandler';\n\n\nexport default function DoUnlockCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param DoUnlockAction[in]\n *        - its property 'method' has the value 'DoUnlock'\n */\nDoUnlockCommand.prototype.execute = function(DoUnlockAction) {\n   let doUnlockObject,\n      handlerList,\n      router = globalArray[\"router\"];\n   if (!util.brokerSupportApplication()) {\n      return;\n   }\n   doUnlockObject = globalArray[\"do-unlock\"];\n   if (!doUnlockObject) {\n      doUnlockObject = new DoUnlockHandler();\n      globalArray[doUnlockObject.messageName] = doUnlockObject;\n      globalArray[doUnlockObject.responseTag] = doUnlockObject;\n   } else {\n      doUnlockObject.resetData();\n   }\n\n   if (!!doUnlockObject && !!router) {\n      doUnlockObject.setRequestXML();\n      handlerList = doUnlockObject.composeHandlerList();\n      router.postMessage(handlerList);\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/doUnlockCommand.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getAuthenticationStatusCommand.js --\n *\n *      Called to get authantication status and also for idle time in the\n * broker\n *      cases that this will be called:\n *          1. timer want to know the last user active time on all tab of\n * browser through the broker\n *          2. unlock and client launched by Horizon all need send this first\n * to decide what to do next.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport GetAuthenticationStatusHandler from '../controllers/getAuthenticationStatusHandler';\n\nexport default function GetAuthenticationStatusCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param GetAuthenticationStatusAction[in]\n *        - its property 'method' has the value 'GetAuthenticationStatus'\n */\nGetAuthenticationStatusCommand.prototype.execute =\n   function(GetAuthenticationStatusAction) {\n      let getAuthenticationStatusObject,\n         handlerList,\n         router = globalArray[\"router\"];\n\n      // version check is here because GetAuthenticationStatus can not be the\n      // first send XML\n      if (!util.brokerSupportApplication()) {\n         return;\n      }\n      getAuthenticationStatusObject = globalArray[\"get-authentication-status\"];\n      if (!getAuthenticationStatusObject) {\n         getAuthenticationStatusObject = new GetAuthenticationStatusHandler();\n         globalArray[getAuthenticationStatusObject.messageName] =\n            getAuthenticationStatusObject;\n         globalArray[getAuthenticationStatusObject.responseTag] =\n            getAuthenticationStatusObject;\n      } else {\n         getAuthenticationStatusObject.resetData();\n      }\n\n      if (!!getAuthenticationStatusObject && !!router) {\n         getAuthenticationStatusObject.setRequestXML(false);\n         if (GetAuthenticationStatusAction.workForSilentMode) {\n            getAuthenticationStatusObject.setWorkForSilentModeFlag();\n         }\n         handlerList = getAuthenticationStatusObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   };\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/getAuthenticationStatusCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getDesktopsCommand.js --\n *\n * get desktop list.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport GetDesktopsHandler from '../controllers/getDesktopsHandler';\n\n\nexport default function GetDesktopsCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param getDesktopsAction[in]\n *        - its property 'method' has the value 'GetDesktops'\n */\nGetDesktopsCommand.prototype.execute = function(getDesktopsAction) {\n   let getDesktopsObject,\n      handlerList,\n      supportedProtocols,\n      router = globalArray[\"router\"];\n\n   getDesktopsObject = globalArray[\"get-desktops\"];\n   if (!getDesktopsObject) {\n      getDesktopsObject = new GetDesktopsHandler();\n      globalArray[getDesktopsObject.messageName] = getDesktopsObject;\n      globalArray[getDesktopsObject.responseTag] = getDesktopsObject;\n   } else {\n      getDesktopsObject.resetData();\n   }\n\n   if (!!getDesktopsObject && !!router) {\n      supportedProtocols = globalArray.supportedProtocols;\n      if (!!supportedProtocols) {\n         getDesktopsObject.setRequestXML(supportedProtocols);\n         handlerList = getDesktopsObject.composeHandlerList();\n         router.postMessage(handlerList);\n      } else {\n         JSCDKLogger.error(\"supported protocols is invalid.\");\n      }\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/getDesktopsCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getLaunchItemsCommand.js --\n *\n * get launchitem list.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport util from '../util';\nimport GetDesktopsHandler from '../controllers/getDesktopsHandler';\nimport GetLaunchItemsHandler from '../controllers/getLaunchItemsHandler';\n\nexport default function GetLaunchItemsCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param getLaunchItemsAction[in]\n *        - its property 'method' has the value 'GetLaunchItems'\n */\nGetLaunchItemsCommand.prototype.execute = function(getLaunchItemsAction) {\n   let getLaunchItemsObject,\n      getDesktopsObject,\n      handlerList,\n      supportedProtocols,\n      supportedAppProtocols,\n      type,\n      router = globalArray[\"router\"];\n\n   if (!util.brokerSupportApplication()) {\n      getDesktopsObject = globalArray[\"get-desktops\"];\n      if (!getDesktopsObject) {\n         getDesktopsObject = new GetDesktopsHandler();\n         globalArray[getDesktopsObject.messageName] = getDesktopsObject;\n         globalArray[getDesktopsObject.responseTag] = getDesktopsObject;\n      } else {\n         getDesktopsObject.resetData();\n      }\n\n      if (!!getDesktopsObject && !!router) {\n         supportedProtocols = globalArray.supportedProtocols;\n         if (!!supportedProtocols) {\n            getDesktopsObject.setRequestXML(supportedProtocols);\n            handlerList = getDesktopsObject.composeHandlerList();\n            router.postMessage(handlerList);\n         } else {\n            JSCDKLogger.error(\"supported protocols is invalid.\");\n         }\n      }\n\n   } else {\n\n      getLaunchItemsObject = globalArray[\"get-launch-items\"];\n      if (!getLaunchItemsObject) {\n         getLaunchItemsObject =\n            new GetLaunchItemsHandler(getLaunchItemsAction.skipTunnelAndPref, getLaunchItemsAction.skipTimer);\n         globalArray[getLaunchItemsObject.messageName] = getLaunchItemsObject;\n         globalArray[getLaunchItemsObject.responseTag] = getLaunchItemsObject;\n      } else {\n         getLaunchItemsObject.resetData();\n      }\n\n      if (!!getLaunchItemsObject && !!router) {\n         supportedProtocols = globalArray.supportedProtocols || [\"BLAST\"];\n         type = {};\n         type.name = \"remote\";\n         type.protocols = supportedProtocols;\n         supportedAppProtocols = [];\n         supportedAppProtocols[0] = type;\n         if (!!supportedProtocols) {\n            getLaunchItemsObject.setRequestXML(supportedProtocols,\n               supportedAppProtocols);\n            handlerList = getLaunchItemsObject.composeHandlerList();\n            router.postMessage(handlerList);\n         } else {\n            JSCDKLogger.error(\"supported protocols is invalid.\");\n         }\n      }\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/getLaunchItemsCommand.js","/*********************************************************\n * Copyright (C) 2013-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getTunnelConnectionCommand.js --\n *\n * get tunnel connection.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport GetTunnelConnectionHandler from '../controllers/getTunnelConnectionHandler';\n\nexport default function GetTunnelConnectionCommand()\n{\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param getTunnelConnAction[in]\n *        - its property 'method' has the value 'GetTunnelConnection'\n */\nGetTunnelConnectionCommand.prototype.execute = function(getTunnelConnAction)\n{\n   let getTunnelConnObject,\n       handlerList,\n       router = globalArray['router'];\n\n   getTunnelConnObject = globalArray['get-tunnel-connection'];\n   if (!getTunnelConnObject) {\n      getTunnelConnObject = new GetTunnelConnectionHandler();\n      globalArray[getTunnelConnObject.messageName] = getTunnelConnObject;\n      globalArray[getTunnelConnObject.responseTag] = getTunnelConnObject;\n   } else {\n      getTunnelConnObject.resetData();\n   }\n\n   getTunnelConnObject.setRequestXML(getTunnelConnAction.bypassTunnel);\n   handlerList = getTunnelConnObject.composeHandlerList();\n   router.postMessage(handlerList);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/getTunnelConnectionCommand.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * GetUserGlobalPrefCommand.js --\n *\n *      get user global preference.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport GetUserGlobalPrefHandler from '../controllers/getUserGlobalPrefHandler';\n\nexport default function GetUserGlobalPrefCommand() {\n}\n\nGetUserGlobalPrefCommand.prototype.execute = function() {\n   let getGlbUserPrefObj,\n      handlerList,\n      router = globalArray[\"router\"];\n\n   getGlbUserPrefObj = globalArray[\"get-user-global-preference\"];\n   if (!getGlbUserPrefObj) {\n      getGlbUserPrefObj = new GetUserGlobalPrefHandler();\n      globalArray[getGlbUserPrefObj.messageName] = getGlbUserPrefObj;\n      globalArray[getGlbUserPrefObj.responseTag] = getGlbUserPrefObj;\n   } else {\n      getGlbUserPrefObj.resetData();\n   }\n\n   if (!!getGlbUserPrefObj && !!router) {\n      getGlbUserPrefObj.setRequestXML();\n      handlerList = getGlbUserPrefObj.composeHandlerList();\n      router.postMessage(handlerList);\n   } else {\n      JSCDKLogger.error(\"supported protocols is invalid.\");\n      return false;\n   }\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/getUserGlobalPrefCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * handleURICommand.js --\n *\n * Store the Client URI.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport UrlHandler from '../controllers/urlHandler';\nimport util from '../util';\n\n\nexport default function HandleURICommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param handleURIAction[in]\n *        - handle (store/reset) the input parameters in an url-handler\n *    instance in JSCDK\n */\nHandleURICommand.prototype.execute = function(handleURIAction) {\n   let urlHandler = util.getObject(globalArray, \"url-handler\");\n   if (!urlHandler) {\n      urlHandler = new UrlHandler();\n      globalArray[urlHandler.name] = urlHandler;\n   }\n\n   if (handleURIAction.operationType === \"store\") {\n      urlHandler.handleUrlParams(handleURIAction);\n   } else if (handleURIAction.operationType === \"reset\") {\n      urlHandler.resetParams();\n   }\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/handleURICommand.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * initRouterCommand.js --\n *\n * init jscdkRouter with broker url\n *\n * designed to limit the JSCDK talk to one broker at a time\n * shall be the constructor of JSCDK after re-factory.\n */\n\nimport {globalArray} from '../jscdkClient';\nimport Router from '../controllers/router';\nimport JSCDKLogger from '../jscdkLogger';\n\n\nexport default function InitRouterCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param initRouterAction[in]\n *        - its property 'method' has the value 'InitRouter'\n */\nInitRouterCommand.prototype.execute = function(initRouterAction) {\n   let jscdkRouter = globalArray[\"router\"];\n   if (!jscdkRouter) {\n      JSCDKLogger.info(\"jscdkRouter is inited.\");\n      jscdkRouter = new Router();\n      globalArray[jscdkRouter.name] = jscdkRouter;\n   } else {\n      JSCDKLogger.info(\"jscdkRouter has already been inited.\");\n   }\n   jscdkRouter.setBrokerUrl(initRouterAction.brokerUrl,\n      initRouterAction.urlParam);\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/initRouterCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * killSessionCommand.js --\n *\n * to send killSession using applicationId/desktopId, or reset all application\n * sessions. can be used to logoff desktop or reset application-sessions.\n * it rely on the get getLaunchItem or getDesktops(when connecting old broker)\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport JSCDKLogger from '../jscdkLogger';\nimport KillSessionHandler from '../controllers/killSessionHandler';\nimport GetDesktopsHandler from '../controllers/getDesktopsHandler';\nimport GetLaunchItemsHandler from '../controllers/getLaunchItemsHandler';\nimport KillAllApplicationSessionsCtrl from '../controllers/killAllApplicationSessionsCtrl';\n\n\nexport default function KillSessionCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param killSessionAction[in]\n *        - its property 'method' has the value 'KillSession'\n * do not split this command into two command for its function is\n * the same. after JSCDK refactory it will be only little difference\n * between them(just parameter are different), so provide with same\n * API.\n */\nKillSessionCommand.prototype.execute = function(killSessionAction) {\n   if (killSessionAction.killAllApplicationSessions) {\n      this.killAllApplicationSessions();\n   } else {\n      this.killSingleSession(killSessionAction.itemInfo);\n   }\n};\n\nKillSessionCommand.prototype.sendGetLaunchItems =\n   function(getLaunchItemsObject) {\n      let supportedProtocols,\n         supportedAppProtocols,\n         type,\n         handlerList,\n         router = globalArray['router'];\n\n      if (!!getLaunchItemsObject && !!router) {\n         supportedProtocols = globalArray.supportedProtocols || [\"BLAST\"];\n         type = {};\n         type.name = \"remote\";\n         type.protocols = supportedProtocols;\n         supportedAppProtocols = [];\n         supportedAppProtocols[0] = type;\n         if (!!supportedProtocols) {\n            getLaunchItemsObject.setRequestXML(supportedProtocols,\n               supportedAppProtocols, false);\n            handlerList = getLaunchItemsObject.composeHandlerList();\n            router.postMessage(handlerList);\n         } else {\n            JSCDKLogger.error(\"supported protocols is invalid.\");\n         }\n      }\n   };\n\nKillSessionCommand.prototype.killAllApplicationSessions = function() {\n   let killAllApplicationSessionsObject,\n      getLaunchItemsObject,\n      //please do not worry about the naming, it will be deleted after JSCDK\n      // refactory\n      getLaunchItemsObjectNameHeader = \"pre-kill-all-application-sessions\";\n\n   if (!util.brokerSupportApplication()) {\n      JSCDKLogger.debug(\n         \"error: broker do not support kill all application sessions!\");\n      return;\n   }\n   killAllApplicationSessionsObject =\n      globalArray[\"kill-all-application-sessions\"];\n   if (!killAllApplicationSessionsObject) {\n      killAllApplicationSessionsObject = new KillAllApplicationSessionsCtrl();\n      globalArray[killAllApplicationSessionsObject.messageName] =\n         killAllApplicationSessionsObject;\n      globalArray[killAllApplicationSessionsObject.responseTag] =\n         killAllApplicationSessionsObject;\n   }\n\n   getLaunchItemsObject =\n      globalArray[getLaunchItemsObjectNameHeader + \"get-launch-items\"];\n   if (!getLaunchItemsObject) {\n      getLaunchItemsObject = new GetLaunchItemsHandler(true);\n      globalArray[getLaunchItemsObjectNameHeader +\n      getLaunchItemsObject.messageName] = getLaunchItemsObject;\n      globalArray[getLaunchItemsObjectNameHeader +\n      getLaunchItemsObject.responseTag] = getLaunchItemsObject;\n   } else {\n      getLaunchItemsObject.resetData();\n   }\n\n   getLaunchItemsObject.appendSubHandler(killAllApplicationSessionsObject);\n\n   this.sendGetLaunchItems(getLaunchItemsObject);\n};\n\nKillSessionCommand.prototype.killSingleSession = function(itemInfo) {\n   let handlerList,\n      desktopId,\n      itemId,\n      killSessionObject,\n      getDesktopsObject,\n      getLaunchItemsObject,\n      supportedProtocols,\n      router = globalArray['router'];\n\n   if (!itemInfo) {\n      JSCDKLogger.debug(\n         \"error: the itemInfo do not exist for killSingleSession\");\n      return;\n   }\n   itemId = itemInfo.id;\n   // Get KillSessionHandler\n   killSessionObject = globalArray['kill-session' + itemId];\n   if (!killSessionObject) {\n      killSessionObject = new KillSessionHandler();\n      globalArray[killSessionObject.messageName + itemId] = killSessionObject;\n      globalArray[killSessionObject.responseTag + itemId] = killSessionObject;\n   } else {\n      killSessionObject.resetData();\n   }\n   // The targeted item info.\n   killSessionObject.itemInfo = itemInfo;\n   if (!util.brokerSupportApplication()) {\n      if (!itemInfo.isDesktop) {\n         JSCDKLogger.debug(\"error: broker do not support kill application!\");\n         return;\n      }\n      desktopId = itemId;\n      // Get GetDesktopsHandler\n      getDesktopsObject = globalArray['get-desktops' + desktopId];\n      if (!getDesktopsObject) {\n         getDesktopsObject = new GetDesktopsHandler();\n         globalArray[getDesktopsObject.messageName + desktopId] =\n            getDesktopsObject;\n         globalArray[getDesktopsObject.responseTag + desktopId] =\n            getDesktopsObject;\n      } else {\n         getDesktopsObject.resetData();\n      }\n      // Trigger KillSessionHandler subsequent to GetDekstopsHandler.\n      getDesktopsObject.appendSubHandler(killSessionObject);\n\n      if (!!getDesktopsObject && !!router) {\n         supportedProtocols = globalArray.supportedProtocols || [\"BLAST\"];\n         if (!!supportedProtocols) {\n            // DO not refresh UI at get-desktops response.\n            getDesktopsObject.setRequestXML(supportedProtocols, false);\n            handlerList = getDesktopsObject.composeHandlerList();\n            router.postMessage(handlerList);\n         } else {\n            JSCDKLogger.error(\"supported protocols is invalid.\");\n         }\n      }\n   } else {\n      getLaunchItemsObject = globalArray[\"get-launch-items\" + itemId];\n      if (!getLaunchItemsObject) {\n         getLaunchItemsObject = new GetLaunchItemsHandler(true);\n         globalArray[getLaunchItemsObject.messageName + itemId] =\n            getLaunchItemsObject;\n         globalArray[getLaunchItemsObject.responseTag + itemId] =\n            getLaunchItemsObject;\n      } else {\n         getLaunchItemsObject.resetData();\n      }\n      getLaunchItemsObject.appendSubHandler(killSessionObject);\n      this.sendGetLaunchItems(getLaunchItemsObject);\n   }\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/killSessionCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * logoutBrokerBrokerCommand.js --\n *\n * Logout from broker.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport JSCDKLogger from '../jscdkLogger';\nimport DoLogoutHandler from '../controllers/doLogoutHandler';\nimport SetUserGlobalPrefHandler from '../controllers/setUserGlobalPrefHandler';\n\n\nexport default function LogoutBrokerCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param logoutBrokerAction[in]\n *        - its property 'method' has the value 'LogoutFromBroker'\n */\nLogoutBrokerCommand.prototype.execute = function(logoutBrokerAction) {\n   let handlerList,\n      logoutBrokerObject = globalArray[\"do-logout\"],\n      router = globalArray[\"router\"],\n      idleTimerObject,\n      setPrefHandler = globalArray[\"set-user-global-preferences\"];\n\n   // this code is added here instead of in onUpdate() is for avoid timer\n   // triggered after broker just log off and returning response\n   if (util.brokerSupportApplication()) {\n      idleTimerObject = globalArray[\"idle-timeout-timer\"];\n      if (!idleTimerObject) {\n         JSCDKLogger.debug(\"timer don't exist when log out\");\n      } else {\n         idleTimerObject.stop();\n      }\n   }\n\n   if (!setPrefHandler) {\n      setPrefHandler = new SetUserGlobalPrefHandler();\n      globalArray[setPrefHandler.messageName] = setPrefHandler;\n   }\n   setPrefHandler.setRequestXML(logoutBrokerAction.prefData);\n\n   if (!logoutBrokerObject) {\n      logoutBrokerObject = new DoLogoutHandler();\n      globalArray[logoutBrokerObject.messageName] = logoutBrokerObject;\n      globalArray[logoutBrokerObject.responseTag] = logoutBrokerObject;\n   } else {\n      logoutBrokerObject.resetData();\n   }\n\n   if (logoutBrokerAction.needClearURI !== false) {\n      //before sending response to UI, this flag will be cleared automaticly,\n      // no need to clear it\n      logoutBrokerObject.setNeedClearURIFlag();\n   }\n   handlerList = logoutBrokerObject.composeHandlerList();\n\n   router.postMessage(handlerList, logoutBrokerAction.async,\n      logoutBrokerAction.timeout);\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/logoutBrokerCommand.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * reconnectApplicationSessionsCommand.js --\n *\n * Called to setup and retrieve the parameters for application seesions\n * connection. The returned parameters should be used to launch appropriate\n * connection with Blast(default)\n *\n * will send getlaunchItem first, and later send\n * getApplicationSessionConnection for target sessions\n *\n * API struct \"selectApplicationSessionAction\" could be like:\n * {\n *    method                    : \"ReconnectApplicationSessions\",\n *    environmentInfo           : {%client info%},\n *    protocol                  : 'BLAST',\n *    disconnectAll             : false,\n *    targetSessionIds          : [\"id1\",\"id2\"]\n * }\n *\n * due to lacking of UT and JSCDK is about to be refacted, I will not split\n * functions, instead I just add comments.\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport JSCDKLogger from '../jscdkLogger';\nimport Router from '../controllers/router';\nimport ReconnectAllApplicationSessionsCtrl from '../controllers/reconnectApplicationSessionsCtrl';\nimport GetLaunchItemsHandler from '../controllers/getLaunchItemsHandler';\n\n\nexport default function ReconnectApplicationSessionsCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param selectApplicationSessionAction[in]\n *        - its property 'method' has the value 'ReconnectApplicationSessions'\n */\nReconnectApplicationSessionsCommand.prototype.execute =\n   function(selectApplicationSessionAction) {\n      let reconnectCtrl,\n         supportedProtocols,\n         getLaunchItemsObject,\n         //please do not worry about the naming, it will be deleted after JSCDK\n         // refactory\n         presetInfo = {},\n         getLaunchItemsHeader = \"pre-reconnect-all-application-sessions\",\n         supportedAppProtocols,\n         handlerList,\n         router = globalArray['router'];\n\n      if (!util.brokerSupportApplication()) {\n         JSCDKLogger.debug(\n            \"error: broker do not support reconnect all application sessions!\");\n         return;\n      }\n\n      if (!router) {\n         JSCDKLogger.info(\"router is null.\");\n\n         router = new Router();\n         globalArray[router.name] = router;\n      }\n\n      // config reconnectApplicationSessions Object\n      supportedProtocols = globalArray.supportedProtocols || [\"BLAST\"];\n      presetInfo.environmentInfo =\n         selectApplicationSessionAction.environmentInfo;\n      presetInfo.protocol = selectApplicationSessionAction.protocol || 'BLAST';\n      presetInfo.disconnectAll = selectApplicationSessionAction.disconnectAll;\n\n      reconnectCtrl = globalArray[\"reconnect-application-sessions\"];\n      if (!reconnectCtrl) {\n         reconnectCtrl = new ReconnectAllApplicationSessionsCtrl();\n         globalArray[reconnectCtrl.messageName] = reconnectCtrl;\n         globalArray[reconnectCtrl.responseTag] = reconnectCtrl;\n      }\n      reconnectCtrl.targetSessionIds =\n         selectApplicationSessionAction.targetSessionIds;\n      // excludedOriginalId is an id indicating the corresponding session\n      // should not to be reconnected\n      reconnectCtrl.excludedOriginalId =\n         selectApplicationSessionAction.excludedOriginalId;\n      reconnectCtrl.presetInfo = presetInfo;\n\n      // config getLaunchItems Object\n      getLaunchItemsObject =\n         globalArray[getLaunchItemsHeader + \"get-launch-items\"];\n      if (!getLaunchItemsObject) {\n         getLaunchItemsObject = new GetLaunchItemsHandler(true, true);\n         globalArray[getLaunchItemsHeader + getLaunchItemsObject.messageName] =\n            getLaunchItemsObject;\n         globalArray[getLaunchItemsHeader + getLaunchItemsObject.responseTag] =\n            getLaunchItemsObject;\n      } else {\n         getLaunchItemsObject.resetData();\n      }\n\n      getLaunchItemsObject.appendSubHandler(reconnectCtrl);\n\n      if (!!getLaunchItemsObject && !!router) {\n         // start getLaunchItem sending\n         supportedAppProtocols = [{\n            name: \"remote\",\n            protocols: supportedProtocols\n         }];\n         getLaunchItemsObject.setRequestXML(supportedProtocols,\n            supportedAppProtocols, false);\n         handlerList = getLaunchItemsObject.composeHandlerList();\n         router.postMessage(handlerList);\n      } else {\n         JSCDKLogger.error('the jscdk is in wired status');\n      }\n   };\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/reconnectApplicationSessionsCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * resetDesktopCommand.js --\n *\n * reset desktop.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport ResetDesktopHandler from '../controllers/resetDesktopHandler';\nimport {MessageHandler} from '../controllers/messageHandler';\n\n\nexport default function ResetDesktopCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param resetDesktopAction[in]\n *        - its property 'method' has the value 'ResetDesktop'\n */\nResetDesktopCommand.prototype.execute = function(resetDesktopAction) {\n   let handlerList,\n      desktopId,\n      resetDesktopObject,\n      router = globalArray[\"router\"];\n\n   desktopId = resetDesktopAction.desktopId;\n   resetDesktopObject = router.getHandler(\"reset-desktop\", desktopId);\n\n   if (!resetDesktopObject) {\n      resetDesktopObject = new ResetDesktopHandler();\n      globalArray[resetDesktopObject.messageName +\n      resetDesktopObject.requestId] = resetDesktopObject;\n      globalArray[resetDesktopObject.responseTag +\n      resetDesktopObject.requestId] = resetDesktopObject;\n      /**\n       * update MessageHandler.prototype.requestIdKV\n       * the format is {responseTag1+desktop-id1 : requestId1,\n       * responseTag2+desktop-id2 : requestId2} such as key of\n       * ResetDesktopHandler is \"reset-desktop\"+desktopId\n       */\n      MessageHandler.prototype.requestIdKV[resetDesktopObject.responseTag +\n      desktopId]\n         = resetDesktopObject.requestId;\n   } else {\n      resetDesktopObject.resetData();\n   }\n\n   if (!!desktopId) {\n      resetDesktopObject.setRequestXML(desktopId);\n      handlerList = resetDesktopObject.composeHandlerList();\n\n      router.postMessage(handlerList);\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/resetDesktopCommand.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * RestartDesktopCommand.js --\n *\n * Restart desktop.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport RestartDesktopHandler from '../controllers/restartDesktopHandler';\nimport {MessageHandler} from '../controllers/messageHandler';\n\n\nexport default function RestartDesktopCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param RestartDesktopAction[in]\n *        - its property 'method' has the value 'RestartDesktop'\n */\nRestartDesktopCommand.prototype.execute = function(RestartDesktopAction) {\n   let handlerList,\n      desktopId,\n      RestartDesktopObject,\n      router = globalArray[\"router\"];\n\n   desktopId = RestartDesktopAction.desktopId;\n   RestartDesktopObject = router.getHandler(\"restart-desktop\", desktopId);\n\n   if (!RestartDesktopObject) {\n      RestartDesktopObject = new RestartDesktopHandler();\n      globalArray[RestartDesktopObject.messageName +\n      RestartDesktopObject.requestId] = RestartDesktopObject;\n      globalArray[RestartDesktopObject.responseTag +\n      RestartDesktopObject.requestId] = RestartDesktopObject;\n      /**\n       * update MessageHandler.prototype.requestIdKV\n       * the format is {responseTag1+desktop-id1 : requestId1,\n       * responseTag2+desktop-id2 : requestId2} such as key of\n       * RestartDesktopHandler is \"Restart-desktop\"+desktopId\n       */\n      MessageHandler.prototype.requestIdKV[RestartDesktopObject.responseTag +\n      desktopId]\n         = RestartDesktopObject.requestId;\n   } else {\n      RestartDesktopObject.RestartData();\n   }\n\n   if (!!desktopId) {\n      RestartDesktopObject.setRequestXML(desktopId);\n      handlerList = RestartDesktopObject.composeHandlerList();\n\n      router.postMessage(handlerList);\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/restartDesktopCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * rollbackDesktopCommand.js --\n *\n * rollback desktop.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport RollbackCheckoutDesktopHandler from '../controllers/rollbackCheckoutDesktopHandler';\nimport {MessageHandler} from '../controllers/messageHandler';\n\n\nexport default function RollbackDesktopCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param rollbackDesktopAction[in]\n *        - its property 'method' has the value 'RollbackDesktop'\n */\nRollbackDesktopCommand.prototype.execute = function(rollbackDesktopAction) {\n   let handlerList,\n      desktopId,\n      rollbackDesktopObject,\n      router = globalArray[\"router\"];\n\n   desktopId = rollbackDesktopAction.desktopId;\n\n   if (!!router && !!desktopId) {\n      rollbackDesktopObject =\n         router.getHandler(\"rollback-checkout-desktop\", desktopId);\n      if (!rollbackDesktopObject) {\n         rollbackDesktopObject = new RollbackCheckoutDesktopHandler();\n         globalArray[rollbackDesktopObject.messageName +\n         rollbackDesktopObject.requestId] = rollbackDesktopObject;\n         globalArray[rollbackDesktopObject.responseTag +\n         rollbackDesktopObject.requestId] = rollbackDesktopObject;\n         /**\n          * update MessageHandler.prototype.requestIdKV\n          * the format is {responseTag1+desktop-id1 : requestId1,\n          * responseTag2+desktop-id2 : requestId2} such as key of\n          * RollbackCheckoutDesktopHandler is\n          * \"rollback-checkout-desktop\"+desktopId\n          */\n         MessageHandler.prototype.requestIdKV[rollbackDesktopObject.responseTag +\n         desktopId]\n            = rollbackDesktopObject.requestId;\n      } else {\n         rollbackDesktopObject.resetData();\n      }\n\n      if (!!rollbackDesktopObject) {\n         rollbackDesktopObject.setRequestXML(desktopId);\n         handlerList = rollbackDesktopObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/rollbackDesktopCommand.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * setEnvironmentInfoCommand.js --\n *\n *      This API is added to minimize the change to support:\n *      https://confluence.eng.vmware.com/pages/viewpage.action?pageId=233382996\n *      Where whenever a request is sent, environment info is needed.\n *      Since the environment content never changes and we have too many APIs to\n *      indirectly sending this XML as the first step, use this method to minimize\n *      the changes in both JSCDK, and HTML Access.\n *\n *      p.s. After JSCDK refactory, it should be in a model and shared among\n *      more XMLs with filters.\n */\n\nimport {globalArray} from '../jscdkClient';\n\n\nexport default function SetEnvironmentInfoCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param SetEnvironmentInfoAction[in]\n *        - its property 'method' has the value 'SetEnvironmentInfo'\n */\nSetEnvironmentInfoCommand.prototype.execute = function(SetEnvironmentInfoAction) {\n   globalArray['environment-information'] = SetEnvironmentInfoAction.data;\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/setEnvironmentInfoCommand.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * setLastUserActivityCommand.js --\n *\n *      Called to provent the broker from locking itself due to idle timeout.\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport SetLastUserActivityHandler from '../controllers/setLastUserActivityHandler';\n\n\nexport default function SetLastUserActivityCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param SetLastUserActivityAction[in]\n *        - its property 'method' has the value 'SetLastUserActivity'\n */\nSetLastUserActivityCommand.prototype.execute =\n   function(SetLastUserActivityAction) {\n      let setLastUserActivityObject,\n         handlerList,\n         router = globalArray[\"router\"],\n         inactiveTimeVar,\n         inactiveTimeStr;\n\n      if (!util.brokerSupportApplication()) {\n         return;\n      }\n      setLastUserActivityObject = globalArray[\"set-last-user-activity\"];\n      if (!setLastUserActivityObject) {\n         setLastUserActivityObject = new SetLastUserActivityHandler();\n         globalArray[setLastUserActivityObject.messageName] =\n            setLastUserActivityObject;\n         globalArray[setLastUserActivityObject.responseTag] =\n            setLastUserActivityObject;\n      } else {\n         setLastUserActivityObject.resetData();\n      }\n\n      if (!!setLastUserActivityObject && !!router) {\n         //accept both number and string format\n         inactiveTimeVar = SetLastUserActivityAction.data.inactiveTime;\n         inactiveTimeStr = inactiveTimeVar.toString();\n         setLastUserActivityObject.setRequestXML(inactiveTimeStr);\n         handlerList = setLastUserActivityObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   };\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/setLastUserActivityCommand.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * setUserGlobalPrefCommand.js --\n *    set user global preference command\n */\n\nimport {globalArray} from '../jscdkClient';\nimport SetUserGlobalPrefHandler from '../controllers/setUserGlobalPrefHandler';\nimport JSCDKLogger from '../jscdkLogger';\n\n\nexport default function SetUserGlobalPrefCommand() {\n}\n\nSetUserGlobalPrefCommand.prototype.execute = function(setPrefAction) {\n   let router = globalArray[\"router\"],\n      setPrefHandler = globalArray[\"set-user-global-preferences\"];\n   if (!router || !setPrefHandler) {\n      JSCDKLogger.error(\"No router or setPrefHandler instance\");\n   }\n\n   if (!setPrefHandler) {\n      setPrefHandler = new SetUserGlobalPrefHandler();\n      globalArray[setPrefHandler.messageName] = setPrefHandler;\n   }\n   setPrefHandler.setRequestXML(setPrefAction.prefData);\n\n   router.postMessage(setPrefHandler.composeHandlerList(), setPrefAction.async,\n      setPrefAction.timeout);\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/setUserGlobalPrefCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * setViewURICommand.js --\n *\n * Pass the View URI to JSCDK.\n *\n */\n\nimport UrlHandler from '../controllers/urlHandler';\nimport util from '../util';\nimport {globalArray} from '../jscdkClient';\n\nexport default function SetViewURICommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param setViewURIAction[in]\n *        - its property 'method' has the value 'SetViewURI'\n */\nSetViewURICommand.prototype.execute = function(setViewURIAction) {\n   let urlHandler = util.getObject(globalArray, \"url-handler\"),\n      url = !!setViewURIAction ? setViewURIAction.queryString : '';\n\n   if (!urlHandler) {\n      urlHandler = new UrlHandler();\n      globalArray[urlHandler.name] = urlHandler;\n   }\n\n   urlHandler.handleUrlParams(url);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/setViewURICommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * submitAuthInfoCommand.js --\n *\n * Submit the user's credential and authenticate the user against the broker\n *    1. DoSubmitAuthentication\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport Router from '../controllers/router';\nimport JSCDKLogger from '../jscdkLogger';\nimport DoSubmitAuthenticationHandler from '../controllers/doSubmitAuthenticationHandler';\nimport GetTunnelConnectionHandler from '../controllers/getTunnelConnectionHandler';\n\n\nexport default function SubmitAuthInfoCommand() {\n}\n\n/*\n * submitAuthInfoCommand.js\n *\n * Invoked by JSCDKController\n *\n * @param submitAuthInfoAction[in]\n *        - its property 'method' has the value 'SubmitAuthInfo'\n */\nSubmitAuthInfoCommand.prototype.execute = function(submitAuthInfoAction) {\n   let handlerList,\n      authInfoObject = globalArray[\"do-submit-authentication\"],\n      router = globalArray[\"router\"],\n      getTunnelConnObject = globalArray[\"get-tunnel-connection\"];\n\n   if (!router) {\n      JSCDKLogger.info(\"router is null.\");\n\n      router = new Router();\n      globalArray[router.name] = router;\n   }\n\n   if (!submitAuthInfoAction.type) {\n      JSCDKLogger.error(\"Authentication type is empty.\");\n      return;\n   }\n\n   // create message handler object\n   if (!authInfoObject) {\n      authInfoObject = new DoSubmitAuthenticationHandler();\n      globalArray[authInfoObject.messageName] = authInfoObject;\n      globalArray[authInfoObject.responseTag] = authInfoObject;\n   } else {\n      authInfoObject.resetData();\n   }\n   authInfoObject.setAuthAction(submitAuthInfoAction);\n   authInfoObject.setReAuthFlag(submitAuthInfoAction.reAuth);\n   authInfoObject.setDesktopReAuthFlag(submitAuthInfoAction.isDesktopReAuth);\n\n   if (submitAuthInfoAction.reAuth) {\n      if (!getTunnelConnObject) {\n         JSCDKLogger.debug(\n            \"error: getTunnelConnObject do not exist when reAuth is true\");\n      }\n   } else {\n      if (!getTunnelConnObject) {\n         getTunnelConnObject = new GetTunnelConnectionHandler();\n         globalArray[getTunnelConnObject.messageName] = getTunnelConnObject;\n         globalArray[getTunnelConnObject.responseTag] = getTunnelConnObject;\n      } else {\n         getTunnelConnObject.resetData();\n      }\n   }\n\n   handlerList = authInfoObject.composeHandlerList();\n   router.postMessage(handlerList);\n   authInfoObject.clearCreds();\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/submitAuthInfoCommand.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * timerCtrlCommand.js --\n *\n *      API to timer for webClient\n *\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport JSCDKLogger from '../jscdkLogger';\nimport Router from '../controllers/router';\nimport IdleTimeoutTimerController from '../timer/idleTimeoutTimerController';\n\n\nexport default function TimerCtrlCommand() {\n}\n\n/**\n * Invoked by JSCDKController\n *\n * @param timerCtrlAction[in]\n *        - its property 'method' has the value 'TimerCtrl'\n */\nTimerCtrlCommand.prototype.execute = function(timerCtrlAction) {\n   let idleTimerObject = globalArray[\"idle-timeout-timer\"],\n      idleTimeout,\n      userActivityInterval,\n      lastUserActiveTime,\n      actionType = timerCtrlAction.type,\n      initType = timerCtrlAction.initType,\n      router;\n\n   if (timerCtrlAction.bypassApplicationVersionCheck === \"true\") {\n      if (!router) {\n         JSCDKLogger.info(\"router is inited.\");\n         router = new Router();\n         globalArray[router.name] = router;\n      } else {\n         JSCDKLogger.error(\"router has already inited.\");\n      }\n      router.setBrokerUrl(timerCtrlAction.brokerUrl,\n         timerCtrlAction.brokerUrlWithTimestamp);\n   }\n   if (!util.brokerSupportApplication()) {\n      return;\n   }\n   if (actionType === \"InitTimer\") {\n      idleTimeout = timerCtrlAction.idleTimeout;\n      userActivityInterval = timerCtrlAction.userActivityInterval;\n      if (!idleTimerObject) {\n         idleTimerObject = new IdleTimeoutTimerController();\n         idleTimerObject.init(userActivityInterval, idleTimeout, initType);\n         globalArray[idleTimerObject.globalName] = idleTimerObject;\n         idleTimerObject.start();\n      } else {\n         JSCDKLogger.debug(\n            \"warning: reinit timer for Web Client reused-session unlocked\");\n         idleTimerObject.ensureStopped();\n         idleTimerObject.reset(initType);\n         idleTimerObject.start();\n      }\n   } else {\n      if (!idleTimerObject) {\n         JSCDKLogger.error(\n            \"timer do not exist when JSCDK recieve a non-init request\");\n      }\n      lastUserActiveTime = timerCtrlAction.lastUserActiveTime;\n      if (actionType === \"stopTimer\") {\n         idleTimerObject.stop();\n      } else if (actionType === \"sendLastUserActiveTime\") {\n         idleTimerObject.setlastUserActiveTime(lastUserActiveTime, true, false);//only sendXML\n      } else if (actionType === \"syncWithTimer4AboutToTimeout\" ||\n         actionType === \"syncWithTimer4Timeout\") {\n         idleTimerObject.setUITimeForCompare(lastUserActiveTime);\n         idleTimerObject.requestBrokerTimeForCompareFor(actionType);\n      } else if (actionType === \"showAboutToTimeoutDialogCallback\") {\n         idleTimerObject.setlastUserActiveTime(lastUserActiveTime, true, true);//refresh\n                                                                               // timer\n                                                                               // and\n                                                                               // sendXML\n      } else {\n         JSCDKLogger.error(\"TimerCtrlCommand recieved a undefined request\");\n      }\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/commands/timerCtrlCommand.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * AddClientInfoHandler.js --\n *\n *      Implementation of the message handler to add client info.\n */\n\nimport {MessageHandler} from './messageHandler';\nimport util from '../util';\nimport JSCDKLogger from '../jscdkLogger';\nimport {globalArray} from '../jscdkClient';\nimport $ from 'jquery';\n\nexport default function AddClientInfoHandler() {\n   let router;\n   // member variables below\n   this.messageName = \"add-client-info\";\n   this.messageText = \"add-client-info\";\n   this.responseTag = \"addClientInfo\";\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n// inherits MessageHandler prototype\nAddClientInfoHandler.prototype = new MessageHandler();\n// constructor\nAddClientInfoHandler.constructor = AddClientInfoHandler;\n\n/**\n * Add the request XML for add-client-info.\n */\nAddClientInfoHandler.prototype.setRequestXML = function() {\n   let addClientStatsListElements = \"\",\n      key,\n      addClientCommonInfo = this.clientInfo.addClientCommonInfo,\n      addClientStatsList = this.clientInfo.addClientStats,\n      clientCommonInfo = this.clientInfo.clientCommonInfo,\n      clientStatsList = this.clientInfo.clientStats;\n\n   this.requestXML = \"\";\n\n   for (key in addClientCommonInfo) {\n      if (addClientCommonInfo.hasOwnProperty(key)) {\n         this.requestXML += util.createElement(key, addClientCommonInfo[key]);\n      }\n   }\n   // Generate the <client-stats> section.\n   for (key in addClientStatsList) {\n      if (addClientStatsList.hasOwnProperty(key)) {\n         addClientStatsListElements += util.createElement(key,\n            addClientStatsList[key], {\"scrub\": \"NONE\"});\n      }\n   }\n\n   for (key in clientCommonInfo) {\n      if (clientCommonInfo.hasOwnProperty(key)) {\n         addClientStatsListElements += util.createElement('stat',\n            clientCommonInfo[key], {\"scrub\": \"NONE\", \"name\": key});\n      }\n   }\n\n   for (key in clientStatsList) {\n      if (clientStatsList.hasOwnProperty(key)) {\n         addClientStatsListElements += util.createElement('stat',\n            clientStatsList[key], {\"scrub\": \"NONE\", \"name\": key});\n      }\n   }\n\n   this.requestXML += addClientStatsListElements;\n};\n\n/**\n * Parse client information from the response XML of GetConfiguration\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return Object. key-value pairs parsed from response, if error then return\n *    null\n */\nAddClientInfoHandler.prototype.parseResult = function(responseXML) {\n   let xmlDoc = $(responseXML),\n      ret = {},\n      brokerElem,\n      resultText;\n\n   brokerElem = $(xmlDoc.children()[0]);\n   if (!brokerElem) {\n      JSCDKLogger.error(\"response of \" + this.getMessageName() + \" error\");\n      return null;\n   }\n\n   resultText = brokerElem.find(\"result\").text();\n   if (!!resultText && (resultText.trim() !== \"\")) {\n      ret[\"result\"] = resultText;\n   } else {\n      return null;\n   }\n   return ret;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/addClientInfoHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * certAuthHandler.js --\n *\n *     handle certificate authentication\n */\n\nimport {MessageHandler} from './messageHandler';\nimport util from '../util';\nimport {globalArray} from '../jscdkClient';\n\n\nexport default function CertAuthHandler() {\n   let router;\n\n   // member variables below\n   this.messageName = \"cert-auth\";\n   this.messageText = \"cert-auth\";\n\n   // register dependencies here\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\nCertAuthHandler.prototype = new MessageHandler(); // inherits MessageHandler\n                                                  // prototype\nCertAuthHandler.constructor = CertAuthHandler; // constructor\n\n/**\n * Set the request XML for saml authentication.\n *\n * @param accept [in] string containing either \"true\" or \"false\".\n */\n\nCertAuthHandler.prototype.setRequestXML = function(accept) {\n   const nameText = util.createElement(\"name\", \"accept\");\n   const acceptText = util.createElement(\"values\",\n      util.createElement(\"value\", accept));\n   const paramText = util.createElement(\"param\", nameText + acceptText);\n   const paramsText = util.createElement(\"params\", paramText);\n   this.requestXML = util.createElement(\"name\", \"cert-auth\");\n   this.requestXML += paramsText;\n   this.requestXML = util.createElement(\"screen\", this.requestXML);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/certAuthHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * changeWindowsPasswordHandler.js --\n *\n *      A sub-handler for DoSubmitAuthenticationHandler.\n */\n\nimport {MessageHandler} from './messageHandler';\nimport util from '../util';\nimport {globalArray} from '../jscdkClient';\n\n\nexport default function ChangeWindowsPasswordHandler() {\n   // member variables below\n   this.messageName = \"windows-password-expired\";\n   this.messageText = \"windows-password-expired\";\n\n   // register dependencies here\n   let router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nChangeWindowsPasswordHandler.prototype = new MessageHandler();\n// constructor\nChangeWindowsPasswordHandler.constructor = ChangeWindowsPasswordHandler;\n\n/**\n * Set the request XML for windows-password-expired request.\n *\n * @param oldPassword [in] old password for the windows-password-expired\n *    request.\n * @param newPassword1 [in] new password1 for the windows-password-expired\n *    request.\n * @param newPassword2 [in] new password2 for the windows-password-expired\n *    request.\n */\n\nChangeWindowsPasswordHandler.prototype.setRequestXML =\n   function(oldPassword, newPassword1, newPassword2) {\n      let oldPasswordText,\n         newPassword1Text,\n         newPassword2Text,\n         paramText;\n\n      this.requestXML = \"\";\n\n      oldPasswordText = util.createElement(\"name\", \"oldPassword\");\n      oldPasswordText +=\n         util.createElement(\"values\", util.createElement(\"value\", oldPassword));\n      newPassword1Text = util.createElement(\"name\", \"newPassword1\");\n      newPassword1Text += util.createElement(\"values\",\n         util.createElement(\"value\", newPassword1));\n      newPassword2Text = util.createElement(\"name\", \"newPassword2\");\n      newPassword2Text += util.createElement(\"values\",\n         util.createElement(\"value\", newPassword2));\n      paramText = util.createElement(\"param\", oldPasswordText);\n      paramText += util.createElement(\"param\", newPassword1Text);\n      paramText += util.createElement(\"param\", newPassword2Text);\n\n      paramText = util.createElement(\"params\", paramText);\n      this.requestXML = util.createElement(\"name\", \"windows-password-expired\");\n      this.requestXML += paramText;\n      this.requestXML = util.createElement(\"screen\", this.requestXML);\n   };\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/changeWindowsPasswordHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * disclaimerHandler.js --\n *\n *      A sub-handler for DoSubmitAuthenticationHandler for accepting\n *      disclaimer.\n */\n\nimport $ from 'jquery';\nimport {MessageHandler} from './messageHandler';\nimport util from '../util';\nimport {globalArray} from '../jscdkClient';\n\n\nexport default function DisclaimerHandler() {\n   // member variables below\n   this.messageName = \"disclaimer\";\n   this.messageText = \"disclaimer\";\n\n   // register dependencies here\n   let router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nDisclaimerHandler.prototype = new MessageHandler();\n// constructor\nDisclaimerHandler.constructor = DisclaimerHandler;\n\n/**\n * Set the request XML for accepting disclaimer authentication.\n */\n\nDisclaimerHandler.prototype.setRequestXML = function() {\n   let paramText,\n      acceptText = util.createElement(\"name\", \"accept\");\n   acceptText +=\n      util.createElement(\"values\", util.createElement(\"value\", \"true\"));\n   paramText = util.createElement(\"param\", acceptText);\n\n   paramText = util.createElement(\"params\", paramText);\n   this.requestXML = util.createElement(\"name\", \"disclaimer\");\n   this.requestXML += paramText;\n   this.requestXML = util.createElement(\"screen\", this.requestXML);\n};\n\n\n/**\n * parse the response of winCredsHandler\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return Object. key-value pairs parsed from response, if error then return\n *    null\n */\n\nDisclaimerHandler.prototype.parseResult = function(responseXML) {\n   let authResponse = {};\n   util.addItemForJson(authResponse, \"screen\",\n      $(responseXML).children(\"name\").text());\n   $(responseXML).children(\"params\").children(\"param\").each(function() {\n      let child = $(this);\n      let nameText = child.find(\"name\").text();\n      let valueList = [];\n      child.find(\"value\").each(function() {\n         valueList.push($(this).text());\n      });\n      util.addItemForJson(authResponse, nameText, valueList);\n   });\n\n   return authResponse;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/disclaimerHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * doCancelAuthenticationHandler.js --\n *\n *      Implementation of the message handler to cancel authentication.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {StateEnum, MessageHandler} from './messageHandler';\n\n\nexport default function DoCancelAuthenticationHandler() {\n   let router;\n\n   // member variables below\n   this.messageName = \"do-cancel-authentication\";\n   this.messageText = \"do-cancel-authentication\";\n   this.responseTag = \"cancel-authentication\";\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n   }\n}\n\n// inherits MessageHandler prototype\nDoCancelAuthenticationHandler.prototype = new MessageHandler();\n\n// constructor\nDoCancelAuthenticationHandler.constructor = DoCancelAuthenticationHandler;\n\n/**\n * parse configuration information from the response XML of GetConfiguration\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return Object. key-value pairs parsed from response, if error then return null\n */\nDoCancelAuthenticationHandler.prototype.parseResult = function(responseXML) {\n   let cancelAuthResponse = {},\n      xmlDoc = $(responseXML),\n      brokerTag,\n      responses,\n      result;\n\n   brokerTag = $(xmlDoc.children()[0]);\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of doCancelAuthenticationHandler error\");\n      return null;\n   }\n\n   responses = brokerTag.children(this.responseTag);\n   result = responses.children(\"result\").text();\n   util.addItemForJson(cancelAuthResponse, \"result\", result);\n   return cancelAuthResponse;\n};\n\nDoCancelAuthenticationHandler.prototype.onUpdated = function() {\n   let cancelAuthAction = {name: \"Portal\"};\n   let router = util.getObject(globalArray, \"router\");\n\n   MessageHandler.prototype.onUpdated.apply(this);\n   /**\n    * Currently we ignore failure because some older brokers do not support\n    * this message.  The only valid error from a broker that supports this\n    * feature is ALREADY_AUTHENTICATED, but we will hopefully never get that\n    * error because we will only trigger this handler if we aren't fully\n    * authenticated.\n    */\n   this.setState(StateEnum.DONE);\n\n   JSCDKSetUI(JSON.stringify(cancelAuthAction));\n   if (!!router) {\n      router.setDoCancelAuthentication();\n      JSCDKLogger.info(\"Cancel authentication completed.\");\n   }\n   if (!!(this.content[\"parsedResult\"]) &&\n      this.content[\"parsedResult\"][\"result\"] === \"ok\") {\n      JSCDKLogger.debug(\"Cancel authentication result is OK.\");\n   } else {\n      JSCDKLogger.error(\"Cancel authentication failed.\");\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/doCancelAuthenticationHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * disconnectSessionHandler.js --\n *\n *      Implementation of the message handler to disconnect session.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {StateEnum, MessageHandler} from './messageHandler';\nimport Router from './router';\n\n\nexport default function DisconnectSessionHandler() {\n   let router;\n\n   // member variables below\n   this.messageName = \"disconnect-session\";\n   this.messageText = \"disconnect-session\";\n   this.responseTag = \"disconnect-session\";\n   this.composedHandlerList = [];\n\n   this.launchItemId = '';\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n   }\n}\n\n// inherits MessageHandler prototype\nDisconnectSessionHandler.prototype = new MessageHandler();\n// constructor\nDisconnectSessionHandler.constructor = DisconnectSessionHandler;\n\n/**\n * parse information from the response XML of disconnect-session\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return Object. key-value pairs parsed from response, if error then return\n *    null\n */\nDisconnectSessionHandler.prototype.parseResult = function(responseXML) {\n   let disconnectSessionResponse = {},\n      xmlDoc = $(responseXML),\n      brokerTag,\n      responses,\n      result;\n\n   brokerTag = $(xmlDoc.children()[0]);\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of disconnectSessionHandler error\");\n      return null;\n   }\n\n   responses = brokerTag.children(this.responseTag);\n   result = responses.children(\"result\").text();\n   if (result === \"ok\" || result === \"error\") {\n      /*\n       * Add the \"ok\" and \"error\" response to the response JSON struct,\n       * because for the \"ok\" and \"error\" result, the response XML structure\n       * are the same, the following code can work in both cases.\n       */\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         util.addItemForJson(disconnectSessionResponse, nameText,\n            $(this).text());\n      });\n   }\n\n   return disconnectSessionResponse;\n};\n\n/**\n * Set the request XML for disconnect-session\n * @param sessionId[in] session id to disconnect-session\n *\n */\nDisconnectSessionHandler.prototype.setRequestXML = function(sessionId) {\n   let sessionIdElem;\n   sessionIdElem = util.createElement(\"session-id\", sessionId);\n   this.requestXML = sessionIdElem;\n};\n\n/**\n * callback when received notification from handlers in dependency list or\n * router\n *\n */\nDisconnectSessionHandler.prototype.onUpdated = function() {\n   let disconnectSessionAction;\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (this.state === StateEnum.DONE) {\n      if (!!(this.content[\"parsedResult\"]) &&\n         this.content[\"parsedResult\"][\"result\"] === \"ok\") {\n         JSCDKLogger.debug('disconnect-session succeeds.');\n\n         // Disconnect session succeeds\n         disconnectSessionAction = {name: \"DisconnectSession\", result: \"ok\"};\n         JSCDKSetUI(JSON.stringify(disconnectSessionAction));\n      }\n   } else if (this.state === StateEnum.FAIL) {\n      /*\n       * Disconnect session failed.\n       * The DisconnectionSessionfailed is needed to avoid bug 1374808.\n       */\n      JSCDKLogger.debug(\n         'disconnect-session failed. Session ID:' + this.launchItemId);\n      disconnectSessionAction =\n         {name: \"DisconnectSessionFailed\", result: \"failed\"};\n      JSCDKSetUI(JSON.stringify(disconnectSessionAction));\n   } else {\n      Router.prototype.pushErrorToUser(this);\n   }\n};\n\n/**\n * Triggered by the parent handler\n *\n */\nDisconnectSessionHandler.prototype.triggerExecution = function() {\n   let getLaunchItemsObject,\n      desktops,\n      targetDesktop,\n      sessionId,\n      handlerList,\n      launchItemId = this.launchItemId,\n      router = globalArray['router'];\n\n   MessageHandler.prototype.triggerExecution.apply(this);\n\n   // Get session ID of the desktop whose id equals desktopId.\n   getLaunchItemsObject = this.parentHandler;\n   if (!getLaunchItemsObject) {\n      getLaunchItemsObject = globalArray['get-launch-items' + launchItemId];\n   }\n   if (!!getLaunchItemsObject &&\n      !!getLaunchItemsObject.content[\"parsedResult\"]) {\n      desktops = getLaunchItemsObject.content[\"parsedResult\"][\"desktops\"];\n   }\n   if (!!desktops) {\n      targetDesktop = getLaunchItemsObject.findDesktop(launchItemId, desktops);\n   }\n   if (!!targetDesktop) {\n      sessionId = targetDesktop[\"session-id\"];\n   } else {\n      // While there is no desktop id associated with the session id,\n      // Assuming the launchItemId is an application session id.\n      sessionId = launchItemId;\n   }\n\n   // Disconnect the given session.\n   if (!!sessionId && (sessionId.trim() !== \"\")) {\n      this.setRequestXML(sessionId);\n      handlerList = this.composeHandlerList();\n      router.postMessage(handlerList);\n   }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/doDisconnectSessionHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * doSubmitAuthenticationHandler.js --\n *\n *      Implementation of the message handler to submit authentication.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport Router from './router';\nimport WinCredsHandler from './winCredsHandler';\nimport SecurIDPasscodeHandler from './securIDPasscodeHandler';\nimport UnauthHandler from './unauthHandler';\nimport SecurIDNextTokenCodeHandler from './securIDNextTokenCodeHandler';\nimport SecurIDPinChangeHandler from './securIDPinChangeHandler';\nimport SecurIDWaitHandler from './securIDWaitHandler';\nimport DisclaimerHandler from './disclaimerHandler';\nimport ChangeWindowsPasswordHandler from './changeWindowsPasswordHandler';\nimport SamlHandler from './samlHandler';\nimport CertAuthHandler from './certAuthHandler';\nimport GetDesktopsHandler from './getDesktopsHandler';\nimport GetLaunchItemsHandler from './getLaunchItemsHandler';\nimport GetTunnelConnectionHandler from './getTunnelConnectionHandler';\nimport IdleTimeoutTimerController from '../timer/idleTimeoutTimerController';\n\n\nexport default function DoSubmitAuthenticationHandler() {\n   let getConfigurationObject,\n      router;\n\n   // member variables below\n   this.messageName = \"do-submit-authentication\";\n   this.messageText = \"do-submit-authentication\";\n   this.responseTag = \"submit-authentication\";\n\n   this.authAction = {};\n   this.reAuthFlag = false;\n   // Cache the credential handler, clear it after sending login info\n   this.credsHandler = null;\n\n   // register dependencies below\n   getConfigurationObject = util.getObject(globalArray, 'get-configuration');\n   if (!!getConfigurationObject) {\n      this.registerHandler(getConfigurationObject, 'state');\n   }\n   router = util.getObject(globalArray, 'router');\n   if (!!router) {\n      this.registerHandler(router, 'receiver');\n      this.registerHandler(router, 'doLogout');\n      this.registerHandler(router, 'doCancelAuthentication');\n   }\n}\n\n// inherits MessageHandler prototype\nDoSubmitAuthenticationHandler.prototype = new MessageHandler();\n// constructor\nDoSubmitAuthenticationHandler.constructor = DoSubmitAuthenticationHandler;\n\n\nDoSubmitAuthenticationHandler.prototype.setReAuthFlag = function(isReAuth) {\n   this.reAuthFlag = isReAuth || false;\n};\n\nDoSubmitAuthenticationHandler.prototype.setDesktopReAuthFlag =\n   function(isDesktopReAuth) {\n      this.desktopReAuthFlag = isDesktopReAuth || false;\n   };\n\n/**\n * Set the authentication action JSON.\n * @param action[in] the authentication action.\n */\n\nDoSubmitAuthenticationHandler.prototype.setAuthAction = function(action) {\n   let handler;\n   this.authAction = action;\n   if (action.type === \"WindowsPassword\") {\n      handler = util.getObject(globalArray, \"windows-password\");\n      if (!handler) {\n         handler = new WinCredsHandler();\n      }\n      handler.setRequestXML(action.domain, action.username, action.secret);\n   } else if (action.type === \"SecurIDPasscode\") {\n      handler = util.getObject(globalArray, \"securid-passcode\");\n      if (!handler) {\n         handler = new SecurIDPasscodeHandler();\n      }\n      handler.setRequestXML(action.username, action.secret);\n   } else if (action.type === \"SecurIDNextTokenCode\") {\n      handler = util.getObject(globalArray, \"securid-nexttokencode\");\n      if (!handler) {\n         handler = new SecurIDNextTokenCodeHandler();\n      }\n      handler.setRequestXML(action.secret);\n   } else if (action.type === \"SecurIDPinChange\") {\n      handler = util.getObject(globalArray, \"securid-pinchange\");\n      if (!handler) {\n         handler = new SecurIDPinChangeHandler();\n      }\n      handler.setRequestXML(action.pin1, action.pin2);\n   } else if (action.type === \"SecurIDWait\") {\n      handler = util.getObject(globalArray, \"securid-wait\");\n      if (!handler) {\n         handler = new SecurIDWaitHandler();\n      }\n      handler.setRequestXML();\n   } else if (action.type === \"Disclaimer\") {\n      handler = util.getObject(globalArray, \"disclaimer\");\n      if (!handler) {\n         handler = new DisclaimerHandler();\n      }\n      handler.setRequestXML();\n   } else if (action.type === \"WindowsPasswordExpired\") {\n      handler = util.getObject(globalArray, \"windows-password-expired\");\n      if (!handler) {\n         handler = new ChangeWindowsPasswordHandler();\n      }\n      handler.setRequestXML(action.oldPassword, action.newPassword1,\n         action.newPassword2);\n   } else if (action.type === \"SAML\") {\n      handler = util.getObject(globalArray, \"saml\");\n      if (!handler) {\n         handler = new SamlHandler();\n      }\n      handler.setRequestXML(action.secret);\n   } else if (action.type === \"CertAuth\") {\n      handler = util.getObject(globalArray, \"cert-auth\");\n      if (!handler) {\n         handler = new CertAuthHandler();\n      }\n      handler.setRequestXML(action.accept);\n   } else if (action.type === \"Unauthenticated\") {\n      handler = util.getObject(globalArray, \"unauthenticated\");\n      if (!handler) {\n         handler = new UnauthHandler();\n      }\n      handler.setRequestXML(action.username);\n   }\n\n   if (!globalArray[handler.messageText]) {\n      globalArray[handler.messageText] = handler;\n   }\n   if (!this.subHandlerList[handler.messageText]) {\n      this.subHandlerList[handler.messageText] = handler;\n   }\n\n   if (!!handler) {\n      this.requestXML = handler.requestXML;\n      this.credsHandler = handler.messageName;\n   } else {\n      JSCDKLogger.error(\"Sub handler for authentication is not defined!\");\n   }\n};\n\n/**\n * parse the response of doSubmitAuthentication\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\n\nDoSubmitAuthenticationHandler.prototype.parseResult = function(responseXML) {\n   let authResponse = {},\n      brokerTag,\n      result,\n      xmlDoc = $(responseXML),\n      responses,\n      screenXML,\n      partialError = {};\n\n   brokerTag = $(xmlDoc.children()[0]);\n\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of doSubmitAuthentication error\");\n      return null;\n   }\n\n\n   responses = brokerTag.children(this.responseTag);\n\n   result = responses.children(\"result\").text();\n   if (result === \"ok\" || result === \"error\") {\n      /*\n       * Add the \"ok\" and \"error\" response to the response JSON struct,\n       * because for the \"ok\" and \"error\" result, the response XML structure\n       * are the same, the following code can work in both cases.\n       */\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         util.addItemForJson(authResponse, nameText, $(this).text());\n      });\n   } else if (result === \"partial\") {\n      /*\n       * For the \"partial\" result, different dialogues will be shown to user\n       * depending on different response types. Here calling the sub-handler's\n       * parseResult function to parse them.\n       */\n      screenXML = responses.find(\"screen\");\n      util.addItemForJson(partialError, \"screen\",\n         $(screenXML).children(\"name\").text());\n      $(screenXML).children(\"params\").children(\"param\").each(function() {\n         let child = $(this),\n            nameText = child.find(\"name\").text(),\n            isReadOnly = child.find(\"readonly\").length,\n            valueList = [];\n         if (isReadOnly !== 0) {\n            util.addItemForJson(partialError, nameText + \"ReadOnly\", \"yes\");\n         } else {\n            util.addItemForJson(partialError, nameText + \"ReadOnly\", \"no\");\n         }\n         child.find(\"value\").each(function() {\n            // Special handle for unauthenticated login\n            if (partialError.screen === 'unauthenticated' &&\n               nameText === 'username') {\n               valueList.push({\n                  value: $(this).text(),\n                  default: !!$(this).attr('default')\n               });\n            } else {\n               valueList.push($(this).text());\n            }\n         });\n         // If user input domain\\username, adjust the username\n         if (partialError.screen === \"windows-password\" &&\n            nameText === \"username\") {\n            let winCredsHandler =\n               util.getObject(globalArray, \"windows-password\");\n            if (!!winCredsHandler && !!winCredsHandler.cachedDomainUsername) {\n               valueList[0] = winCredsHandler.cachedDomainUsername;\n            }\n         }\n         util.addItemForJson(partialError, nameText, valueList);\n      });\n\n      util.addItemForJson(authResponse, \"result\", result);\n      $.extend(authResponse, partialError);\n   }\n   return authResponse;\n};\n\n\n/**\n * Do the desktops list connections after the authentication is done.\n *\n */\nDoSubmitAuthenticationHandler.prototype.onAuthenticationDone = function() {\n   let handlerList,\n      getDesktopsObject,\n      getLaunchItemsObject,\n      addClientInfoObject,\n      getTunnelConnObject,\n      protocolsJson = [],\n      supportedAppProtocols,\n      type,\n      router = globalArray[\"router\"],\n      idleTimerObject,\n      parsedResult,\n      userActivityInterval,\n      idleTimeout,\n      doReAuthAction;\n\n   if (!this.reAuthFlag) {\n      // \"add-client-info\" work after broker>= 9.0\n      if (util.brokerSupportApplication()) {\n         // send addClientInfo request\n         addClientInfoObject = globalArray[\"add-client-info\"];\n         if (!!addClientInfoObject &&\n            addClientInfoObject.hasOwnProperty(\"clientInfo\")) {\n            addClientInfoObject.setRequestXML();\n            if (!!router) {\n               handlerList = addClientInfoObject.composeHandlerList();\n               router.postMessage(handlerList);\n            }\n         }\n      }\n\n      // send getTunnelConnection request\n      getTunnelConnObject =\n         util.getObject(globalArray, \"get-tunnel-connection\");\n      if (!getTunnelConnObject) {\n         getTunnelConnObject = new GetTunnelConnectionHandler();\n         globalArray[getTunnelConnObject.messageName] = getTunnelConnObject;\n         globalArray[getTunnelConnObject.responseTag] = getTunnelConnObject;\n      } else {\n         getTunnelConnObject.resetData();\n      }\n\n      getTunnelConnObject.setRequestXML(globalArray.bypassTunnel);\n      if (!!getTunnelConnObject && !!router) {\n         handlerList = getTunnelConnObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   }\n\n   if (!util.brokerSupportApplication()) {\n      // send getDesktops request\n      getDesktopsObject = util.getObject(globalArray, \"get-desktops\");\n      if (!getDesktopsObject) {\n         getDesktopsObject = new GetDesktopsHandler();\n      } else {\n         getDesktopsObject.resetData();\n      }\n      globalArray[getDesktopsObject.messageName] = getDesktopsObject;\n      globalArray[getDesktopsObject.responseTag] = getDesktopsObject;\n\n      protocolsJson = util.getObject(globalArray, \"supportedProtocols\");\n\n      //In desktop page, after reauth, post a unlock message to UI.\n      if (this.desktopReAuthFlag) {\n         doReAuthAction = {name: \"unLock\", result: \"ok\"};\n         JSCDKSetUI(JSON.stringify(doReAuthAction));\n      }\n\n      if (!protocolsJson) {\n         JSCDKLogger.error(\"Supported protocols missing.\");\n         return;\n      }\n\n      getDesktopsObject.setRequestXML(protocolsJson);\n      if (!!getDesktopsObject && !!router) {\n         handlerList = getDesktopsObject.composeHandlerList();\n         router.postMessage(handlerList);\n      }\n   } else {\n      //launch idle timer\n      idleTimerObject = globalArray[\"idle-timeout-timer\"];\n      if (!idleTimerObject) {\n         idleTimerObject = new IdleTimeoutTimerController();\n         globalArray[idleTimerObject.globalName] = idleTimerObject;\n      }\n      parsedResult = this.content[\"parsedResult\"];\n      userActivityInterval =\n         parseInt(parsedResult[\"user-activity-interval\"], 10);\n      idleTimeout = parseInt(parsedResult[\"idle-timeout\"], 10);\n      //init every time user logs in, could only happen in the UI\n      idleTimerObject.init(userActivityInterval, idleTimeout, \"Portal\");\n      idleTimerObject.ensureUpdatedOrStarted();\n\n      //In desktop page, after reauth, post a unlock message to UI.\n      if (this.desktopReAuthFlag) {\n         doReAuthAction = {name: \"unLock\", result: \"ok\"};\n         JSCDKSetUI(JSON.stringify(doReAuthAction));\n      }\n\n      // send getLaunchItems request\n      getLaunchItemsObject = util.getObject(globalArray, \"get-launch-items\");\n      if (!getLaunchItemsObject) {\n         getLaunchItemsObject = new GetLaunchItemsHandler();\n         globalArray[getLaunchItemsObject.messageName] = getLaunchItemsObject;\n         globalArray[getLaunchItemsObject.responseTag] = getLaunchItemsObject;\n      } else {\n         getLaunchItemsObject.resetData();\n      }\n\n\n      protocolsJson = util.getObject(globalArray, \"supportedProtocols\");\n      if (!protocolsJson) {\n         JSCDKLogger.error(\"Supported protocols missing.\");\n         return;\n      }\n\n      if (!!getLaunchItemsObject && !!router ) {\n         type = {};\n         type.name = \"remote\";\n         type.protocols = protocolsJson;\n         supportedAppProtocols = [];\n         supportedAppProtocols[0] = type;\n         if (!!protocolsJson) {\n            getLaunchItemsObject.setRequestXML(protocolsJson,\n               supportedAppProtocols);\n            handlerList = getLaunchItemsObject.composeHandlerList();\n            router.postMessage(handlerList);\n         } else {\n            JSCDKLogger.error(\"supported protocols is invalid.\");\n         }\n      }\n   }\n};\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\n\nDoSubmitAuthenticationHandler.prototype.onUpdated = function() {\n   let errorCode,\n      parsedResult,\n      getConfigurationObject = globalArray[\"get-configuration\"];\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (this.content[\"parsedResult\"]) {\n      parsedResult = this.content[\"parsedResult\"];\n      if (!!(parsedResult[\"error-code\"])) {\n         errorCode = parsedResult[\"error-code\"];\n         if (errorCode === \"ALREADY_AUTHENTICATED\") {\n            this.setState(StateEnum.DONE);\n         }\n      }\n\n      if (parsedResult[\"result\"] === \"partial\") {\n         if (getConfigurationObject) {\n            /**\n             * GetConfigurationHandler handles the authentication related\n             * dialogs.\n             */\n            getConfigurationObject.handleParsedResult(\n               this.content[\"parsedResult\"]);\n         } else {\n            JSCDKLogger.error(\n               \"Wrong case, no get-configuration but has do-submit-authentication\");\n         }\n      }\n   }\n\n   // ensure handler has done its task and request is from \"WindowsPassword\" to\n   // JSCDK\n   if (this.state === StateEnum.DONE) {\n      this.onAuthenticationDone();\n   }\n   // push error to UI\n   Router.prototype.pushErrorToUser(this);\n};\n\n/**\n * This function is used to clear all the credential info stored in cache\n * It is requested from bug 1537589\n */\nDoSubmitAuthenticationHandler.prototype.clearCreds = function() {\n   if (!!this.credsHandler) {\n      globalArray[this.credsHandler].requestXML = '';\n   }\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/doSubmitAuthenticationHandler.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * doUnlockHandler.js --\n *\n *      Implementation of the message handler to send doUnlock.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport util from '../util';\nimport {StateEnum, MessageHandler} from './messageHandler';\nimport {HaveAuthTypesEnum} from './getConfigurationHandler';\nimport {prepareForAlreadyAuthenticated} from '../timer/timer-util';\n\n\nexport default function DoUnlockHandler() {\n   // member variables below\n   this.messageName = \"do-unlock\";\n   this.messageText = \"do-unlock\";\n   this.responseTag = \"unlock\";\n\n   // register dependencies here\n   let router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nDoUnlockHandler.prototype = new MessageHandler();\nDoUnlockHandler.constructor = DoUnlockHandler;\n\nDoUnlockHandler.prototype.setRequestXML = function() {\n   // handle SAML\n   let samlNameElem,\n      haveAuthTypesElem,\n      authTypes,\n      getConfigObject = globalArray[\"get-configuration\"];\n\n   this.requestXML = \"\";\n   if (getConfigObject) {\n      authTypes = getConfigObject.getAuthTypes();\n\n      if (authTypes === HaveAuthTypesEnum.HAVEAUTHTYPE_SAML) {\n         samlNameElem = util.createElement(\"name\", \"saml\");\n         haveAuthTypesElem =\n            util.createElement(\"have-authentication-types\", samlNameElem);\n         this.requestXML = haveAuthTypesElem;\n      }\n   }\n};\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nDoUnlockHandler.prototype.onUpdated = function() {\n\n   let parsedResult,\n      getConfigurationObject = globalArray[\"get-configuration\"],\n      router = util.getObject(globalArray, \"router\");\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (this.state === StateEnum.DONE) {\n      // prepare for already authentication case(locked is treated as already\n      // authenticated)\n      prepareForAlreadyAuthenticated();\n      // handler response to continue re-authentication\n      if (!!(this.content[\"parsedResult\"])) {\n         parsedResult = this.content[\"parsedResult\"];\n         if (getConfigurationObject) {\n            //let GetConfigurationHandler handles the authentication related\n            // dealing.\n            getConfigurationObject.handleParsedResult(parsedResult, true);\n         } else {\n            JSCDKLogger.error(\n               \"Wrong case, no get-configuration but has do-unlock\");\n         }\n      }\n   }\n   // push error to UI\n   router.pushErrorToUser(this);\n};\n\n/**\n * parse locale information from the response XML of GetConfiguration\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return Object. key-value pairs parsed from response, if error then return\n *    null\n */\nDoUnlockHandler.prototype.parseResult = function(responseXML) {\n   let responseBody,\n      brokerTag,\n      responses,\n      resultText,\n      unlockResponse = {},\n      authTag,\n      authScreenTag;\n\n   if (!responseXML || (responseXML === \"\")) {\n      return null;\n   }\n   responseBody = $(responseXML);\n   brokerTag = $(responseBody.children()[0]);\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of getAuthenticationStatus error\");\n      return null;\n   }\n   responses = brokerTag.children(this.responseTag);\n   resultText = responses.children(\"result\").text();\n   if (!!resultText && (resultText.trim() !== \"\")) {\n      unlockResponse[\"result\"] = resultText;\n   } else {\n      JSCDKLogger.error(\n         \"response of getAuthenticationStatus error, no valid result tag\");\n      return null;\n   }\n   if (resultText === \"ok\") {\n      authTag = brokerTag.find(\"authentication\");\n      if (!authTag) {\n         JSCDKLogger.error(\n            \"No authentication element in response of do-unlock\");\n         return null;\n      }\n\n      authScreenTag = authTag.children(\"screen\");\n      if (!authScreenTag) {\n         JSCDKLogger.error(\"No screen element in response of do-unlock\");\n         return null;\n      }\n      util.addItemForJson(unlockResponse, \"screen\",\n         $(authScreenTag).children(\"name\").text());\n\n      $(authScreenTag).children(\"params\").children(\"param\").each(function() {\n         let child = $(this),\n            nameText = child.find(\"name\").text(),\n            isReadOnly = child.find(\"readonly\").length,\n            valueList = [];\n\n         if (isReadOnly !== 0) {\n            util.addItemForJson(unlockResponse, nameText + \"ReadOnly\", \"yes\");\n         } else {\n            util.addItemForJson(unlockResponse, nameText + \"ReadOnly\", \"no\");\n         }\n         child.find(\"value\").each(function() {\n            valueList.push($(this).text());\n         });\n         util.addItemForJson(unlockResponse, nameText, valueList);\n      });\n   } else if (resultText === \"error\") {\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         util.addItemForJson(unlockResponse, nameText, $(this).text());\n      });\n   }\n   return unlockResponse;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/doUnlockHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * frontController.js --\n *\n * A base class for front controller,\n * that delegates requests to appropriate command classes.\n *\n * The role of front controller is to first register command handlers\n * against requests. Then per request, the front controller looks up\n * its table of registered events, finds the appropriate command for handling\n * the request and invokes the command by calling its execute() method.\n *\n */\n\nimport JSCDKLogger from '../jscdkLogger';\n\n\nexport default function FrontController()\n{\n\n   /**\n    * Dictionary of command name to command class mappings.\n    */\n   let _commands = {};\n\n   /**\n    * Register a command class with the controller,\n    * against a command name.\n    *\n    * @param commandName   command name\n    * @param commandClass  command class e.g. ConnectToBrokerClass\n    */\n   this.addCommand = function(commandName, commandClass) {\n      _commands[commandName] = commandClass;\n\n      JSCDKLogger.debug(\"Command [\" + commandName + \"] is added.\");\n   };\n\n   /**\n    * Returns the command class registered with the command name.\n    *\n    * @param commandName   command name\n    * @returns  command class\n    */\n   this.getCommand = function(commandName) {\n      if (_commands[commandName]) {\n         return _commands[commandName];\n      }\n\n      JSCDKLogger.warning(\"Command [\" + commandName + \"] is not registered.\");\n      return null;\n   };\n\n   /**\n    * Deregister a command class with the command name.\n    *\n    * @param commandName   command name\n    */\n   this.removeCommand = function(commandName) {\n      if (!!_commands[commandName]) {\n         _commands[commandName] = null;\n         delete _commands[commandName];\n\n         JSCDKLogger.debug(\"Command [\" + commandName + \"] is removed.\");\n      }\n   };\n\n   /**\n    * Check if a command name to command class mapping is registered.\n    *\n    * @param commandName   command name\n    * @returns Boolean true - registered, false - not registered\n    */\n   this.containCommand = function(commandName) {\n      return !!this.getCommand(commandName);\n   };\n\n   /**\n    * Execute a command by invoking its execute() method.\n    *\n    * @param action\n    *        action is the request object\n    *        which must contain a property called 'method'\n    *        method corresponds to command name\n    */\n   this.execute = function(action) {\n      let commandName = action.method;\n      let commandClass = this.getCommand(commandName);\n      if (commandClass) {\n         return new commandClass().execute(action);\n      }\n\n      JSCDKLogger.warning(\"Command [\" + commandName + \"] fails to execute.\");\n   };\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/frontController.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getApplicationConnectionHandler.js --\n *\n *      Implementation of the message handler to get application connection.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport Router from './router';\nimport SetUserGlobalPrefHandler from './setUserGlobalPrefHandler';\n\n\nconst BlastType = {\n   CURRENT: \"current\",\n   NEW: \"new\"\n};\n\nexport default function GetApplicationConnectionHandler() {\n   // member variables\n   this.messageName = \"get-application-connection\";\n   this.messageText = \"get-application-connection\";\n   this.responseTag = \"application-connection\";\n   // Use current blastType by default.\n   this.blastType = BlastType.CURRENT;\n\n   this.preferences = {};\n\n   this.originId = null;\n\n   // register dependencies here\n   let getLaunchItemsObject;\n   let getTunnelConnObject, setPrefObject;\n   let router;\n   getLaunchItemsObject = util.getObject(globalArray, \"get-launch-items\");\n   if (!!getLaunchItemsObject) {\n      this.registerHandler(getLaunchItemsObject, \"state\");\n   }\n   getTunnelConnObject = util.getObject(globalArray, \"get-tunnel-connection\");\n   if (!!getTunnelConnObject) {\n      this.registerHandler(getTunnelConnObject, \"state\");\n   }\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n\n   // maybe not good to invoke the SetUserGlobalPrefHandler every time, would\n   // be changed when re-factorying\n   setPrefObject = util.getObject(globalArray, \"set-user-global-preferences\");\n   if (!setPrefObject) {\n      setPrefObject = new SetUserGlobalPrefHandler();\n      globalArray[\"set-user-global-preferences\"] = setPrefObject;\n   }\n   this.composedHandlerList = [this, setPrefObject];\n}\n\nGetApplicationConnectionHandler.prototype = new MessageHandler(); // inherits\n                                                                  // MessageHandler\n                                                                  // prototype\nGetApplicationConnectionHandler.constructor = GetApplicationConnectionHandler;\n\nGetApplicationConnectionHandler.prototype.saveOriginId = function(originId) {\n   this.originId = originId;\n};\n\nGetApplicationConnectionHandler.prototype.isAppParamSupported = function() {\n   return parseFloat(globalArray[\"brokerVersion\"]) >=\n      parseFloat(globalArray[\"applicationParamVersion\"]);\n};\n\n/**\n * Generate xml  for launching params, written in a format that\n *     could be easily extended to support other params\n * @param  {object} launchParam The Object that contains launching params could\n *    be\n *     {args:[\"C:\\Users\\uesr01\\Documents\\test.docx\",\n *    C:\\Users\\uesr01\\Documents\\the_other_test.docx]}\n * @return {string} The xml in the form of string\n */\nGetApplicationConnectionHandler.prototype.getParamElement =\n   function(launchParam) {\n      let args,\n         i,\n         nameElement = \"\",\n         paramElements = \"\",\n         commandLineElement = \"\";\n\n      if (typeof launchParam !== \"object\" || !this.isAppParamSupported()) {\n         return \"\";\n      }\n\n      args = launchParam.args;\n      if (Array.isArray(args) && args.length > 0) {\n         nameElement = util.createElement(\"name\", \"appCommandLine\");\n         for (i = 0; i < args.length; i++) {\n            if (args[i] !== \"\") {\n               commandLineElement += util.createElement(\"value\", args[i]);\n            }\n         }\n         if (commandLineElement !== \"\") {\n            commandLineElement =\n               util.createElement(\"values\", commandLineElement);\n            paramElements +=\n               util.createElement(\"param\", nameElement + commandLineElement);\n         }\n      }\n\n      if (paramElements !== \"\") {\n         paramElements = util.createElement(\"params\", paramElements);\n      }\n      return paramElements;\n   };\n\n/**\n * Set the request XML for getApplicationConnection.\n *\n * @param applicationId [in] application id to connect\n * @param protocol [in] which protocol to use\n * @param environmentInfo [in] optional object containing client info key/value\n *    pairs\n */\nGetApplicationConnectionHandler.prototype.setRequestXML =\n   function(applicationId, protocol,\n            environmentInfo, maximized, launchParam) {\n      let isWS1Mode = globalArray['ws1Mode'],\n         urlHandler,\n         applicationIdElement = util.createElement(\"application-id\",\n            applicationId),\n         nameElement = util.createElement(\"name\", protocol),\n         protocolElement = util.createElement(\"protocol\", nameElement),\n         maximizedElement = (typeof maximized === 'boolean') ?\n            util.createElement(\"maximized\", maximized) :\n            util.createElement(\"maximized\", \"true\"),\n         environmentElement = \"\",\n         infoElements = \"\",\n         samlElement = \"\",\n         key,\n         paramElements;\n\n      if (isWS1Mode) {\n         urlHandler = util.getObject(globalArray, \"url-handler\");\n         if (!!urlHandler && !!urlHandler.params &&\n            !!urlHandler.params.samlArt) {\n            samlElement =\n               util.createElement(\"saml-artifact\", urlHandler.params.samlArt);\n         }\n      }\n\n      // Generate the <environment-info> section if it was specified.\n      if (typeof(environmentInfo) === \"object\") {\n         for (key in environmentInfo) {\n            if (environmentInfo.hasOwnProperty(key)) {\n               infoElements +=\n                  util.createElement(\"info\", environmentInfo[key], {\n                     \"name\": key\n                  });\n            }\n         }\n         environmentElement =\n            util.createElement(\"environment-information\", infoElements);\n      }\n\n      paramElements = this.getParamElement(launchParam);\n\n      this.requestXML = applicationIdElement + samlElement + maximizedElement +\n         protocolElement + environmentElement + paramElements;\n   };\n\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nGetApplicationConnectionHandler.prototype.onUpdated = function() {\n   let parsedResult,\n      needConnectionText,\n      protocolName,\n      token,\n      launchArgs,\n      address,\n      port,\n      userMessage,\n      showApplicationAction = {},\n      applicationResolution = {},\n      content = {},\n      router,\n      id,\n      userName,\n      domainName,\n      enableUsb,\n      enableMmr;\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (this.state === StateEnum.DONE) {\n      if (!!(this.content[\"parsedResult\"])) {\n         parsedResult = this.content[\"parsedResult\"];\n         needConnectionText = parsedResult[\"new-connection-needed\"];\n         if (needConnectionText === \"true\") {\n            protocolName = parsedResult[\"protocol\"];\n            if (protocolName.toLowerCase() === \"blast\") {\n               id = parsedResult[\"id\"];\n               userName = parsedResult[\"user-name\"];\n               domainName = parsedResult[\"domain-name\"];\n               address = parsedResult[\"address\"];\n               port = parsedResult[\"port\"];\n               token = parsedResult[\"token\"];\n               if (!!token) {\n                  launchArgs = JSON.parse(token);\n                  if (!launchArgs) {\n                     userMessage = util._(\n                        \"VMware Blast token error: JSON formatting is not valid.\");\n                     JSCDKLogger.error(\"Blast token is not a valid JSON.\");\n                  } else if (!launchArgs[\"a\"]) {\n                     userMessage = util._(\n                        \"VMware Blast token error: VMware Blast token has no 'a' property.\");\n                     JSCDKLogger.error(\"Blast token has no 'a' property.\");\n                  }\n                  if (!!userMessage) {\n                     // push error to UI\n                     Router.prototype.pushSelfDefinedError(this, userMessage);\n                  }\n               } else {\n                  //throw an error\n                  userMessage =\n                     util._(\"VMware Blast token error: token does not exist.\");\n                  JSCDKLogger.error(\"Blast token does not exist.\");\n                  Router.prototype.pushSelfDefinedError(this, userMessage);\n               }\n               enableUsb = parsedResult[\"enable-usb\"];\n               enableMmr = parsedResult[\"enable-mmr\"];\n\n               showApplicationAction.name = \"ShowAppBlastApplication\";\n               content.id = id;\n               content.userName = userName;\n               content.domainName = domainName;\n               content.url =\n                  this.createAppBlastLaunchApplicationAction(address, port,\n                     launchArgs);\n               content.enableUsb = enableUsb;\n               content.enableMmr = enableMmr;\n               content.preferences = this.preferences;\n               content.preferences.blastType = this.blastType;\n               content.isApplicationSession = true;\n               content.originId = this.originId;\n               showApplicationAction.content = content;\n            } else {\n               // PCoIP or RDP just tells the UI about all of the parameters.\n               showApplicationAction.name = \"LaunchApplication\";\n               showApplicationAction.content = parsedResult;\n            }\n         } else { // no need to connect to a application that is currently connected\n            showApplicationAction.name = \"ApplicationAlreadyConnected\"; // TODO:\n                                                                        // should\n                                                                        // add\n                                                                        // map\n                                                                        // in\n                                                                        // the\n                                                                        // UI\n                                                                        // side\n                                                                        // for\n                                                                        // this\n                                                                        // action\n            id = parsedResult[\"id\"];\n            content.id = id;\n            showApplicationAction.content = content;\n            //can throw an exception here instead if needed\n         }\n         router = globalArray[\"router\"];\n         // Common code for appblast or others.\n         if (!!router) {\n            showApplicationAction.content.brokerUrl =\n               encodeURIComponent(router.brokerUrl);\n         }\n         /**\n          * parsed results of getApplicationConnection are of no use after this\n          * function; reset data before UI refresh to avoid it triggered by\n          * dependencies for multiple times reset data should be before\n          * JSCDKSetUI to avoid unpredictable error during SetUI\n          */\n         this.content = {};\n         JSCDKSetUI(JSON.stringify(showApplicationAction));\n      }\n   }\n   // if the error is special for this handler, alert\n   Router.prototype.pushErrorToUser(this);\n};\n\n\n/**\n * parse application connection information from the response XML\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\n\nGetApplicationConnectionHandler.prototype.parseResult = function(responseXML) {\n   let brokerTag;\n   let responses;\n   let result;\n   let tokenText;\n   let applicationConnectionResponse = {};\n   let xmlDoc;\n   let listeners;\n   let listenersNode;\n   let listenerNode;\n   let listener;\n   let agentResponseNode;\n   let agentResponse;\n   let errorCode;\n   let protocol;\n   let protocolObj;\n   let i;\n\n   xmlDoc = $(responseXML);\n   brokerTag = $(xmlDoc.children()[0]);\n   responses = brokerTag.children(this.responseTag);\n   result = responses.children(\"result\").text();\n   if (result === \"ok\") {\n      /*\n       * Add the \"ok\" and \"error\" response to the response JSON struct,\n       * because for the \"ok\" and \"error\" result, the response XML structure\n       * are the same, the following code can work in both cases\n       */\n      //make no check for the new-connection-needed property existence with\n      // result set \"ok\", the absent of this property will cause response.name\n      // = \"ApplicationAlreadyConnected\" in onUpdated(), if <id> is at least\n      // provided\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         util.addItemForJson(applicationConnectionResponse, nameText,\n            $(this).text());\n      });\n\n      listenersNode =\n         util.getChildNode($(responses)[0], \"additional-listeners\", 0);\n      if (!!listenersNode) {\n         listenerNode =\n            listenersNode.getElementsByTagName(\"additional-listener\");\n      }\n      if (!!listenerNode) {\n         listeners = [];\n         for (i = 0; i < listenerNode.length; i++) {\n            listener = {};\n            util.addItemForJson(listener, \"name\",\n               listenerNode[i].getAttribute(\"name\"));\n            util.addItemForJson(listener, \"value\", $(listenerNode[i]).text());\n            listeners[i] = listener;\n         }\n\n         util.addItemForJson(applicationConnectionResponse,\n            \"additional-listeners\", listeners);\n      }\n      // handle token and default values here\n      tokenText = applicationConnectionResponse[\"protocol-settings\"];\n      if (!!tokenText) {\n         util.addItemForJson(applicationConnectionResponse, \"token\", tokenText);\n      }\n      return applicationConnectionResponse;\n   } else if (result === \"error\") {\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         util.addItemForJson(applicationConnectionResponse, nameText,\n            $(this).text());\n      });\n\n      agentResponseNode =\n         util.getChildNode($(responses)[0], \"agent-response\", 0);\n      if (!!agentResponseNode) {\n         agentResponse = {};\n         errorCode = util.getChildNode(agentResponseNode, \"error-code\", 0);\n         util.addItemForJson(agentResponse, \"error-code\", $(errorCode).text());\n\n         protocol = util.getChildNode(agentResponseNode, \"protocol\", 0);\n         if (!!protocol) {\n            protocolObj = {};\n            util.addItemForJson(protocolObj, \"name\",\n               $(util.getChildNode(protocol, \"name\", 0)).text());\n            util.addItemForJson(protocolObj, \"error-code\",\n               $(util.getChildNode(protocol, \"error-code\", 0)).text());\n            util.addItemForJson(agentResponse, \"protocol\", protocolObj);\n         }\n\n         util.addItemForJson(applicationConnectionResponse, \"agent-response\",\n            agentResponse);\n      }\n\n      return applicationConnectionResponse;\n\n   }\n   return applicationConnectionResponse;\n};\n\n\n/**\n * Create the action to launch Blast application.\n *\n * @param host[in] the host for Blast.\n * @param port[in] the port for Blast.\n * @param args[in] the launch arguments for Blast.\n * @return launchUrl as a string for the application connection.\n */\n\nGetApplicationConnectionHandler.prototype.createAppBlastLaunchApplicationAction =\n   function(host, port, args) // TODO: may need to be changed when blast url\n                           // format is known\n   {\n      /*\n       * Construct appblast application url.\n       * https://view.corp.com/r/r-token-value/?vauth=auth-token-value (BSG)\n       * OR\n       * https://view.corp.com/d/d-token-value/?vauth=auth-token-value (direct)\n       */\n      let r,\n         launchUrl;\n\n      if (args.r) {\n         r = '/r/' + args.r;\n      } else {\n         r = '/d/' + util.getUuid();\n      }\n      launchUrl = ['https://', host, ':', port, encodeURI(r), '/?vauth=',\n         encodeURIComponent(args.a)].join('');\n      JSCDKLogger.trace(\"Blast url generated\");\n      return launchUrl;\n   };\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/getApplicationConnectionHandler.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getApplicationSessionConnectionHandler.js --\n *\n *      Implementation of the message handler to get application session\n * connection.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport Router from './router';\n\n\nconst BlastType = {\n   CURRENT: \"current\",\n   NEW: \"new\"\n};\n\nexport default function GetApplicationSessionConnectionHandler() {\n   // member variables\n   this.messageName = \"get-application-session-connection\";\n   this.messageText = \"get-application-session-connection\";\n   this.responseTag = \"application-session-connection\";\n\n   this.composedHandlerList = [];\n\n   // Use current blastType by default.\n   this.blastType = BlastType.CURRENT;\n   this.callbackFunction = null;\n   this.targetAppSessionId = null;\n   this.originId = null;\n\n   this.preferences = {};\n\n   // register dependencies here\n   let getLaunchItemsObject;\n   let getTunnelConnObject;\n   let router;\n   getLaunchItemsObject = util.getObject(globalArray, \"get-launch-items\");\n   if (!!getLaunchItemsObject) {\n      this.registerHandler(getLaunchItemsObject, \"state\");\n   }\n   getTunnelConnObject = util.getObject(globalArray, \"get-tunnel-connection\");\n   if (!!getTunnelConnObject) {\n      this.registerHandler(getTunnelConnObject, \"state\");\n   }\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\nGetApplicationSessionConnectionHandler.prototype = new MessageHandler(); // inherits\n                                                                         // MessageHandler\n                                                                         // prototype\nGetApplicationSessionConnectionHandler.constructor =\n   GetApplicationSessionConnectionHandler;\n\n/**\n * using a bool to switch to call back API, which will be formal one after JSCDK\n * refactory\n */\nGetApplicationSessionConnectionHandler.prototype.setCallbackFunction =\n   function(callbackFunction) {\n      this.callbackFunction = callbackFunction;\n   };\n\nGetApplicationSessionConnectionHandler.prototype.setOriginId =\n   function(originId) {\n      this.originId = originId;\n   };\n\n\n/**\n * Set the request XML for getApplicationSessionConnection.\n *\n * @param applicationSessionId [in] applicationSession id to connect\n * @param protocol [in] which protocol to use\n * @param environmentInfo [in] optional object containing client info key/value\n *    pairs\n */\n\nGetApplicationSessionConnectionHandler.prototype.setRequestXML =\n   function(applicationSessionId, protocol,\n            environmentInfo, disconnectAll) {\n      let applicationSessionIdElement = util.createElement(\n         \"application-session-id\", applicationSessionId),\n         nameElement = util.createElement(\"name\", protocol),\n         protocolElement = util.createElement(\"protocol\", nameElement),\n         disconnectAllElement = \"\",\n         environmentElement = \"\",\n         infoElements = \"\",\n         key,\n         attrArray;\n\n      if (disconnectAll === false) {\n         disconnectAllElement =\n            util.createElement(\"disconnect-all-sessions\", false);\n      } else {\n         disconnectAllElement =\n            util.createElement(\"disconnect-all-sessions\", true);\n      }\n\n      this.targetAppSessionId = applicationSessionId;\n\n      // Generate the <environment-info> section if it was specified.\n      if (typeof(environmentInfo) === \"object\") {\n         for (key in environmentInfo) {\n            if (environmentInfo.hasOwnProperty(key)) {\n               infoElements += util.createElement(\"info\", environmentInfo[key],\n                  {\"name\": key});\n            }\n         }\n         environmentElement =\n            util.createElement(\"environment-information\", infoElements);\n      }\n\n      this.requestXML =\n         applicationSessionIdElement + disconnectAllElement + protocolElement +\n         environmentElement;\n   };\n\n\nGetApplicationSessionConnectionHandler.prototype.getConvertedResponse =\n   function(responseAction) {\n      let responseObj = {};\n\n      responseObj.success = true;\n      responseObj.sessionId = this.targetAppSessionId;\n      switch (responseAction.name) {\n         case \"ShowAppBlastApplicationSession\":\n            responseObj.protocolIsBlast = true;\n            responseObj.needNewConnectionWithBlast = true;\n            responseObj.content = responseAction.content;\n            responseObj.content.originId = this.originId;\n            break;\n         case \"LaunchApplicationSession\":\n            responseObj.protocolIsBlast = false;\n            responseObj.orgResponse = responseAction.content;\n            break;\n         case \"ApplicationSessionAlreadyConnected\":\n            responseObj.protocolIsBlast = true;\n            responseObj.needNewConnectionWithBlast = false;\n            responseObj.content = {originId: this.originId};\n            break;\n      }\n      return responseObj;\n   };\n\nGetApplicationSessionConnectionHandler.prototype.hasError = function() {\n   return !!this.content[\"error\"];\n};\n\nGetApplicationSessionConnectionHandler.prototype.getErrorResponseBy =\n   function(errorObj) {\n      return {\n         success: false,\n         error: errorObj,\n         sessionId: this.targetAppSessionId\n      };\n   };\n\n\nGetApplicationSessionConnectionHandler.prototype.handleSelfDefinedError =\n   function(userMessage) {\n      let errorObj,\n         errorResponse;\n\n      if (typeof(this.callbackFunction) === 'function') {\n         errorObj = util.getSelfDefinedErrorObjectBy(this, userMessage);\n         errorResponse = this.getErrorResponseBy(errorObj);\n         this.callbackFunction(errorObj);\n         this.callbackFunction = null;\n      } else {\n         Router.prototype.pushSelfDefinedError(this, userMessage);\n      }\n   };\n\nGetApplicationSessionConnectionHandler.prototype.handleSuccess =\n   function(responseAction) {\n      let convertedResult;\n\n      if (typeof(this.callbackFunction) === 'function') {\n         convertedResult = this.getConvertedResponse(responseAction);\n         this.callbackFunction(convertedResult);\n         this.callbackFunction = null;\n      } else {\n         JSCDKSetUI(JSON.stringify(responseAction));\n      }\n   };\n\nGetApplicationSessionConnectionHandler.prototype.handleError = function() {\n   let errorObj,\n      errorResponse,\n      key = this.messageName;\n\n   if (typeof(this.callbackFunction) === 'function') {\n      errorObj = this.content[\"error\"][key];\n      errorResponse = this.getErrorResponseBy(errorObj);\n      this.callbackFunction(errorResponse);\n      this.callbackFunction = null;\n   } else {\n      Router.prototype.pushErrorToUser(this);\n   }\n};\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nGetApplicationSessionConnectionHandler.prototype.onUpdated = function() {\n   let parsedResult,\n      needConnectionText,\n      protocolName,\n      token,\n      launchArgs,\n      address,\n      port,\n      userMessage,\n      showApplicationSessionAction = {},\n      applicationSessionResolution = {},\n      content = {},\n      router,\n      id,\n      userName,\n      domainName,\n      enableUsb,\n      enableMmr;\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (this.state === StateEnum.DONE) {\n      if (!!(this.content[\"parsedResult\"]) &&\n         this.content[\"parsedResult\"][\"result\"] === \"ok\") {\n         parsedResult = this.content[\"parsedResult\"];\n         needConnectionText = parsedResult[\"new-connection-needed\"];\n         if (needConnectionText === \"true\") {\n            protocolName = parsedResult[\"protocol\"];\n            if (protocolName.toLowerCase() === \"blast\") {\n               id = parsedResult[\"id\"];\n               userName = parsedResult[\"user-name\"];\n               domainName = parsedResult[\"domain-name\"];\n               address = parsedResult[\"address\"];\n               port = parsedResult[\"port\"];\n               token = parsedResult[\"token\"];\n               if (!!token) {\n                  launchArgs = JSON.parse(token);\n                  if (!launchArgs) {\n                     userMessage = util._(\n                        \"VMware Blast token error: JSON formatting is not valid.\");\n                     JSCDKLogger.error(\"Blast token is not a valid JSON.\");\n                  } else if (!launchArgs[\"a\"]) {\n                     userMessage = util._(\n                        \"VMware Blast token error: VMware Blast token has no 'a' property.\");\n                     JSCDKLogger.error(\"Blast token has no 'a' property.\");\n                  }\n                  if (!!userMessage) {\n                     // push error to UI\n                     this.handleSelfDefinedError(userMessage);\n                  }\n               }\n               else {\n                  //throw an error\n                  userMessage =\n                     util._(\"VMware Blast token error: token does not exist.\");\n                  JSCDKLogger.error(\"Blast token does not exist.\");\n                  this.handleSelfDefinedError(userMessage);\n               }\n               enableUsb = parsedResult[\"enable-usb\"];\n               enableMmr = parsedResult[\"enable-mmr\"];\n\n               showApplicationSessionAction.name =\n                  \"ShowAppBlastApplicationSession\";\n               content.id = id;\n               content.userName = userName;\n               content.domainName = domainName;\n               content.url =\n                  this.createAppBlastLaunchApplicationSessionAction(address,\n                     port, launchArgs);\n               content.enableUsb = enableUsb;\n               content.enableMmr = enableMmr;\n               content.preferences = this.preferences;\n               content.preferences.blastType = this.blastType;\n               content.isApplicationSession = true;\n               showApplicationSessionAction.content = content;\n            } else {\n               // PCoIP or RDP just tells the UI about all of the parameters.\n               showApplicationSessionAction.name = \"LaunchApplicationSession\";\n               showApplicationSessionAction.content = parsedResult;\n            }\n         } else {// no need to connect to a application that is currently connected\n            showApplicationSessionAction.name =\n               \"ApplicationSessionAlreadyConnected\";// TODO: should add map in\n                                                    // the UI side for this\n                                                    // action\n            id = parsedResult[\"id\"];\n            content.id = id;\n            showApplicationSessionAction.content = content;\n            //can throw an exception here instead if needed\n         }\n         router = globalArray[\"router\"];\n         // Common code for appblast or others.\n         if (!!router) {\n            showApplicationSessionAction.content.brokerUrl =\n               encodeURIComponent(router.brokerUrl);\n         }\n         /**\n          * parsed results of getApplicationSessionConnection are of no use\n          * after this function; reset data before UI refresh to avoid it\n          * triggered by dependencies for multiple times reset data should be\n          * before JSCDKSetUI to avoid unpredictable error during SetUI\n          */\n         this.content = {};\n\n         this.handleSuccess(showApplicationSessionAction);\n      }\n   }\n   // if the error is special for this handler, alert\n\n   if (this.hasError()) {\n      this.handleError();\n   }\n};\n\n\n/**\n * parse applicationSession connection information from the response XML\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\n\nGetApplicationSessionConnectionHandler.prototype.parseResult =\n   function(responseXML) {\n      let brokerTag;\n      let responses;\n      let result;\n      let tokenText;\n      let applicationSessionConnectionResponse = {};\n      let xmlDoc;\n      let listeners;\n      let listenersNode;\n      let listenerNode;\n      let listener;\n      let agentResponseNode;\n      let agentResponse;\n      let errorCode;\n      let protocol;\n      let protocolObj;\n      let i;\n\n      xmlDoc = $(responseXML);\n      brokerTag = $(xmlDoc.children()[0]);\n      responses = brokerTag.children(this.responseTag);\n      result = responses.children(\"result\").text();\n      if (result === \"ok\") {\n         /*\n          * Add the \"ok\" and \"error\" response to the response JSON struct,\n          * because for the \"ok\" and \"error\" result, the response XML structure\n          * are the same, the following code can work in both cases\n          */\n         //make no check for the new-connection-needed property existence with\n         // result set \"ok\", the absent of this property will cause\n         // response.name = \"ApplicationAlreadyConnected\" in onUpdated(), works\n         // well if <id> is at least provided\n         responses.children().each(function() {\n            let nameText = this.localName || this.baseName;\n            util.addItemForJson(applicationSessionConnectionResponse, nameText,\n               $(this).text());\n         });\n\n         listenersNode =\n            util.getChildNode($(responses)[0], \"additional-listeners\", 0);\n         if (!!listenersNode) {\n            listenerNode =\n               listenersNode.getElementsByTagName(\"additional-listener\");\n         }\n         if (!!listenerNode) {\n            listeners = [];\n            for (i = 0; i < listenerNode.length; i++) {\n               listener = {};\n               util.addItemForJson(listener, \"name\",\n                  listenerNode[i].getAttribute(\"name\"));\n               util.addItemForJson(listener, \"value\",\n                  $(listenerNode[i]).text());\n               listeners[i] = listener;\n            }\n\n            util.addItemForJson(applicationSessionConnectionResponse,\n               \"additional-listeners\", listeners);\n         }\n         // handle token and default values here\n         tokenText = applicationSessionConnectionResponse[\"protocol-settings\"];\n         if (!!tokenText) {\n            util.addItemForJson(applicationSessionConnectionResponse, \"token\",\n               tokenText);\n         }\n         return applicationSessionConnectionResponse;\n      } else if (result === \"error\") {\n         responses.children().each(function() {\n            let nameText = this.localName || this.baseName;\n            util.addItemForJson(applicationSessionConnectionResponse, nameText,\n               $(this).text());\n         });\n\n         agentResponseNode =\n            util.getChildNode($(responses)[0], \"agent-response\", 0);\n         if (!!agentResponseNode) {\n            agentResponse = {};\n            errorCode = util.getChildNode(agentResponseNode, \"error-code\", 0);\n            util.addItemForJson(agentResponse, \"error-code\",\n               $(errorCode).text());\n\n            protocol = util.getChildNode(agentResponseNode, \"protocol\", 0);\n            if (!!protocol) {\n               protocolObj = {};\n               util.addItemForJson(protocolObj, \"name\",\n                  $(util.getChildNode(protocol, \"name\", 0)).text());\n               util.addItemForJson(protocolObj, \"error-code\",\n                  $(util.getChildNode(protocol, \"error-code\", 0)).text());\n               util.addItemForJson(agentResponse, \"protocol\", protocolObj);\n            }\n\n            util.addItemForJson(applicationSessionConnectionResponse,\n               \"agent-response\", agentResponse);\n         }\n\n         return applicationSessionConnectionResponse;\n\n      }\n      return applicationSessionConnectionResponse;\n   };\n\n\n/**\n * Create the action to launch Blast applicationSession.\n *\n * @param host[in] the host for Blast.\n * @param port[in] the port for Blast.\n * @param args[in] the launch arguments for Blast.\n * @return launchUrl as a string for the applicationSession connection.\n */\n\nGetApplicationSessionConnectionHandler.prototype.createAppBlastLaunchApplicationSessionAction =\n   function(host, port, args) {\n      /*\n       * Construct appblast applicationSession url.\n       * https://view.corp.com/r/r-token-value/?vauth=auth-token-value (BSG)\n       * OR\n       * https://view.corp.com/d/d-token-value/?vauth=auth-token-value (direct)\n       */\n      let r,\n         launchUrl;\n\n      if (args.r) {\n         r = '/r/' + args.r;\n      } else {\n         r = '/d/' + util.getUuid();\n      }\n      launchUrl = ['https://', host, ':', port, encodeURI(r), '/?vauth=',\n         encodeURIComponent(args.a)].join('');\n      JSCDKLogger.trace(\"Blast url generated\");\n      return launchUrl;\n   };\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/getApplicationSessionConnectionHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * getDesktopConnectionHandler.js --\n *\n *      Implementation of the message handler to get desktop connection.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport Router from './router';\nimport SetUserGlobalPrefHandler from './setUserGlobalPrefHandler';\n\n\nconst BlastType = {\n   CURRENT: \"current\",\n   NEW: \"new\"\n};\n\nexport default function GetDesktopConnectionHandler() {\n   let getDesktopsObject,\n      getTunnelConnObject,\n      router,\n      setPrefObject;\n\n   // member variables\n   this.messageName = \"get-desktop-connection\";\n   this.messageText = \"get-desktop-connection\";\n   this.responseTag = \"desktop-connection\";\n   // Use current blastType by default.\n   this.blastType = BlastType.CURRENT;\n\n   this.preferences = {};\n\n   // register dependencies here\n   getDesktopsObject = util.getObject(globalArray, \"get-desktops\");\n   if (!!getDesktopsObject) {\n      this.registerHandler(getDesktopsObject, \"state\");\n   }\n   getTunnelConnObject = util.getObject(globalArray, \"get-tunnel-connection\");\n   if (!!getTunnelConnObject) {\n      this.registerHandler(getTunnelConnObject, \"state\");\n   }\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n\n   // maybe not good to invoke the SetUserGlobalPrefHandler every time, would\n   // be changed when re-factorying\n   setPrefObject = util.getObject(globalArray, \"set-user-global-preferences\");\n   if (!setPrefObject) {\n      setPrefObject = new SetUserGlobalPrefHandler();\n      globalArray[\"set-user-global-preferences\"] = setPrefObject;\n   }\n   this.composedHandlerList = [this, setPrefObject];\n}\n\n//inherits MessageHandler prototype\nGetDesktopConnectionHandler.prototype = new MessageHandler();\n\nGetDesktopConnectionHandler.constructor = GetDesktopConnectionHandler;\n\n\n/**\n * Set the request XML for getDesktopConnection.\n *\n * @param desktopId [in] desktop id to connect\n * @param protocol [in] which protocol to use\n * @param environmentInfo [in] optional object containing client info\n *    key/value pairs\n */\n\nGetDesktopConnectionHandler.prototype.setRequestXML =\n   function(desktopId, protocol,\n            environmentInfo, isShadow) {\n      let isWS1Mode = globalArray['ws1Mode'],\n         urlHandler,\n         desktopIdElement = util.createElement(\"desktop-id\", desktopId),\n         nameElement = util.createElement(\"name\", protocol),\n         protocolElement = util.createElement(\"protocol\", nameElement),\n         environmentElement = \"\",\n         infoElements = \"\",\n         samlElement = \"\",\n         key;\n\n      if (isShadow) {\n         desktopIdElement = util.createElement(\"shadow-session-id\", desktopId);\n      }\n\n      if (isWS1Mode) {\n         urlHandler = util.getObject(globalArray, \"url-handler\");\n         if (!!urlHandler && !!urlHandler.params &&\n            !!urlHandler.params.samlArt) {\n            samlElement =\n               util.createElement(\"saml-artifact\", urlHandler.params.samlArt);\n         }\n      }\n\n      // Generate the <environment-info> section if it was specified.\n      if (typeof(environmentInfo) === \"object\") {\n         for (key in environmentInfo) {\n            if (environmentInfo.hasOwnProperty(key)) {\n               infoElements += util.createElement(\"info\", environmentInfo[key],\n                  {\"name\": key});\n            }\n         }\n         environmentElement =\n            util.createElement(\"environment-information\", infoElements);\n      }\n\n      this.requestXML =\n         desktopIdElement + samlElement + protocolElement + environmentElement;\n   };\n\n\n/**\n * Set the preferences for getDesktopConnection.\n *\n * @param desktopPreferences [in] the desktop preferences JSON.\n */\n\nGetDesktopConnectionHandler.prototype.setPreferences =\n   function(desktopPreferences) {\n      this.preferences = desktopPreferences;\n      JSCDKLogger.debug(\"Desktop preferences is \" +\n         JSON.stringify(this.preferences));\n   };\n\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nGetDesktopConnectionHandler.prototype.onUpdated = function() {\n   let parsedResult,\n      protocolName,\n      token,\n      launchArgs,\n      address,\n      port,\n      userMessage,\n      showDesktopAction = {},\n      desktopResolution = {},\n      content = {},\n      redirectProperties,\n      router,\n      id,\n      userName,\n      domainName,\n      isShadow = false;\n\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n\n   if (this.state === StateEnum.DONE) {\n      if (!!(this.content[\"parsedResult\"])) {\n         parsedResult = this.content[\"parsedResult\"];\n         /**\n          * We need to try to find if redirection properties exist for DaaS.\n          * If so, there will be no other properties.\n          */\n         redirectProperties = parsedResult['redirect-properties'];\n         if (!!redirectProperties && redirectProperties['server-address'] &&\n            redirectProperties['desktop-name'] &&\n            redirectProperties['saml-art'] &&\n            redirectProperties['desktop-protocol'] &&\n            redirectProperties['desktop-protocol'].toLowerCase() === \"blast\") {\n            // Do the redirection\n            showDesktopAction.name = \"ShowAppBlastDesktop\";\n            content.redirectProperties = redirectProperties;\n            showDesktopAction.content = content;\n         } else {\n            // No redirection\n            protocolName = parsedResult[\"protocol\"];\n            if (protocolName.toLowerCase() === \"blast\") {\n               id = parsedResult[\"id\"];\n               if (!id) {\n                  id = parsedResult[\"shadow-session-id\"];\n                  isShadow = id ? true : false;\n               }\n               userName = parsedResult[\"user-name\"];\n               domainName = parsedResult[\"domain-name\"];\n               address = parsedResult[\"address\"];\n               port = parsedResult[\"port\"];\n               token = parsedResult[\"token\"];\n               launchArgs = JSON.parse(token);\n\n               if (!launchArgs) {\n                  userMessage = util._(\n                     \"VMware Blast token error: JSON formatting is not valid.\");\n                  JSCDKLogger.error(\"Blast token is not a valid JSON.\");\n               }\n               if (!launchArgs[\"a\"]) {\n                  userMessage = util._(\n                     \"VMware Blast token error: VMware Blast token has no 'a' property.\");\n                  JSCDKLogger.error(\"Blast token has no 'a' property.\");\n               }\n               if (!!userMessage) {\n                  // push error to UI\n                  Router.prototype.pushSelfDefinedError(this, userMessage);\n               }\n\n               showDesktopAction.name = \"ShowAppBlastDesktop\";\n               content.id = id;\n               content.userName = userName;\n               content.domainName = domainName;\n               content.url =\n                  this.createAppBlastLaunchAction(address, port, launchArgs);\n               content.preferences = this.preferences;\n               content.preferences.blastType = this.blastType;\n               content.isApplicationSession = false;\n               content.isShadow = isShadow;\n               showDesktopAction.content = content;\n            } else {\n               // PCoIP or RDP just tells the UI about all of the parameters.\n               showDesktopAction.name = \"LaunchDesktop\";\n               showDesktopAction.content = parsedResult;\n            }\n            router = globalArray[\"router\"];\n            // Common code for appblast or others.\n            if (!!router) {\n               showDesktopAction.content.brokerUrl =\n                  encodeURIComponent(router.brokerUrl);\n            }\n         }\n\n         /**\n          * parsed results of getDesktopConnection are of no use after this\n          * function; reset data before UI refresh to avoid it triggered by\n          * dependencies for multiple times reset data should be before\n          * JSCDKSetUI to avoid unpredictable error during SetUI\n          */\n         this.content = {};\n         JSCDKSetUI(JSON.stringify(showDesktopAction));\n      }\n   }\n   // if the error is special for this handler, alert\n   Router.prototype.pushErrorToUser(this);\n};\n\n\n/**\n * parse desktop connection information from the response XML\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\n\nGetDesktopConnectionHandler.prototype.parseResult = function(responseXML) {\n   let self = this;\n   let brokerTag;\n   let responses;\n   let result;\n   let tokenText;\n   let desktopConnectionResponse = {};\n   let xmlDoc;\n\n   xmlDoc = $(responseXML);\n   brokerTag = $(xmlDoc.children()[0]);\n   responses = brokerTag.children(this.responseTag);\n   result = responses.children(\"result\").text();\n   if (result === \"ok\" || result === \"error\") {\n      /*\n       * Add the \"ok\" and \"error\" response to the response JSON struct,\n       * because for the \"ok\" and \"error\" result, the response XML structure\n       * are the same, the following code can work in both cases.\n       */\n      responses.children().each(function() {\n         let nameText = this.localName || this.baseName;\n         if (nameText === 'redirect-properties') {\n            desktopConnectionResponse['redirect-properties'] =\n               self.parseRedirectProperties($(this).children());\n         } else {\n            util.addItemForJson(desktopConnectionResponse, nameText,\n               $(this).text());\n         }\n      });\n\n      // handle token and default values here\n      tokenText = desktopConnectionResponse[\"protocol-settings\"];\n      if (!!tokenText) {\n         util.addItemForJson(desktopConnectionResponse, \"token\", tokenText);\n      }\n   }\n   return desktopConnectionResponse;\n};\n\n\n/**\n * Create the action to launch Blast desktop.\n *\n * @param host[in] the host for Blast.\n * @param port[in] the port for Blast.\n * @param args[in] the launch arguments for Blast.\n * @return launchUrl as a string for the desktop connection.\n */\n\nGetDesktopConnectionHandler.prototype.createAppBlastLaunchAction =\n   function(host, port, args) {\n      /*\n       * Construct appblast desktop url.\n       * https://view.corp.com/r/r-token-value/?vauth=auth-token-value (BSG)\n       * OR\n       * https://view.corp.com/d/d-token-value/?vauth=auth-token-value (direct)\n       */\n      let r;\n      if (args.r) {\n         r = '/r/' + args.r;\n      } else {\n         r = '/d/' + util.getUuid();\n      }\n      let launchUrl = ['https://', host, ':', port, encodeURI(r), '/?vauth=',\n         encodeURIComponent(args.a)].join('');\n      JSCDKLogger.trace(\"Blast url generated\");\n      return launchUrl;\n   };\n\n\n/**\n * Parse the redirect properties from broker response\n *\n * @param properties\n * @returns object contains all the redirect properties\n */\nGetDesktopConnectionHandler.prototype.parseRedirectProperties =\n   function(properties) {\n      if (!properties || !properties.length) {\n         return {};\n      }\n\n      let i,\n         property,\n         attrName,\n         attrValue,\n         res = {};\n\n      for (i = 0; i < properties.length; i++) {\n         property = properties[i];\n         attrName = property.getAttribute('name');\n         attrValue = property.textContent;\n         if (!!attrName) {\n            res[attrName] = attrValue;\n         }\n      }\n      return res;\n   };\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/getDesktopConnectionHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * killAllApplicationSessionsCtrl.js--\n *\n *      middleware to reset all application sessions by\n *      sending multiple kill-session, will be deleted when\n *      JSCDK refactory by just using callback. It currently\n *      is used to solve the naming conflict and seperate the\n *      logic out.\n */\n\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport KillSessionHandler from './killSessionHandler';\n\n\nexport default function KillAllApplicationSessionsCtrl() {\n   // member variables below\n   this.messageName = \"kill-all-application-sessions\";\n   this.messageText = \"kill-all-application-sessions\";\n   this.responseTag = \"kill-all-application-sessions\";\n}\n\n// inherits MessageHandler prototype\nKillAllApplicationSessionsCtrl.prototype = new MessageHandler();\n// constructor\nKillAllApplicationSessionsCtrl.constructor = KillAllApplicationSessionsCtrl;\n\nKillAllApplicationSessionsCtrl.prototype.dealWithResponses =\n   function(dataList) {\n      let i,\n         data,\n         killAllApplicationSessionsAction,\n         router = globalArray['router'],\n         errorObj,\n         failIdList = [];\n\n      if (!dataList || !Array.isArray(dataList) || dataList.length <= 0) {\n         JSCDKLogger.error(\"the response list is invalid\");\n         return;\n      }\n      // here assume all error are of the same type, so only store the last one\n      for (i = 0; i < dataList.length; i++) {\n         data = dataList[i];\n         if (data.result === \"fail\") {\n            failIdList.push(data.sessionId);\n            errorObj = data.error;\n         }\n      }\n      if (failIdList.length === 0) {\n         // Kill application sessions succeeds\n         killAllApplicationSessionsAction = {\n            name: \"KillAllApplicationSessions\",\n            result: \"ok\"\n         };\n         JSCDKSetUI(JSON.stringify(killAllApplicationSessionsAction));\n      } else {\n         // this is for reusing pushErrorToUser, will be brifer after jscdk\n         // refactory, didn't rename error now\n         errorObj.errorDetail = failIdList;\n         this.content = {\n            error: {\n               test: errorObj\n            }\n         };\n         router.pushErrorToUser(this);\n      }\n   };\n\nKillAllApplicationSessionsCtrl.prototype.getApplicationSessions = function() {\n   let getLaunchItemsObject;\n   getLaunchItemsObject = this.parentHandler;\n   if (!getLaunchItemsObject) {\n      getLaunchItemsObject = globalArray[this.messageName + \"get-launch-items\"];\n   }\n   if (!!getLaunchItemsObject &&\n      !!getLaunchItemsObject.content[\"parsedResult\"]) {\n      return getLaunchItemsObject.content[\"parsedResult\"][\"application-sessions\"];\n   }\n   return null;\n};\n\nKillAllApplicationSessionsCtrl.prototype.getValidAndInvalidIdLists =\n   function(applicationSessions) {\n      let key,\n         applicationSessionId,\n         applicationSessionIdList = [],\n         invalidOriginIdList = [];\n      for (key in applicationSessions) {\n         if (applicationSessions.hasOwnProperty(key)) {\n            applicationSessionId = applicationSessions[key].id;\n            // kill one of the application session.\n            if (!!applicationSessionId &&\n               (applicationSessionId.trim() !== \"\")) {\n               applicationSessionIdList.push(applicationSessionId);\n            } else {\n               invalidOriginIdList.push(applicationSessions[key][\"origin-id\"]);\n            }\n         }\n      }\n      return {\n         valid: applicationSessionIdList,\n         invalid: invalidOriginIdList\n      };\n   };\n\n\nKillAllApplicationSessionsCtrl.prototype.pushResetFailToUser = function() {\n   let errorObj = {},\n      router = globalArray['router'],\n      errorMessage;\n\n   errorObj.name = \"JSCDK_ERROR_LOGOFF_POOL_FAILED\";\n   errorMessage = util._(\n      \"Application sessions cannot be reset. Please contact your system administrator.\");\n   router.pushSelfDefinedError(errorObj, errorMessage);\n   this.setState(StateEnum.FAIL);\n};\n\n/**\n * Triggered by the parent handler\n *\n */\nKillAllApplicationSessionsCtrl.prototype.triggerExecution = function() {\n   let validAndInvalidIdLists,\n      applicationSessionIdList,\n      targetApplicationSessionId,\n      handlerList,\n      router = globalArray['router'],\n      killSessionObject,\n      i,\n      infoCombiner;\n\n   MessageHandler.prototype.triggerExecution.apply(this);\n\n   validAndInvalidIdLists =\n      this.getValidAndInvalidIdLists(this.getApplicationSessions());\n\n   if (validAndInvalidIdLists.invalid.length === 0) {\n      applicationSessionIdList = validAndInvalidIdLists.valid;\n      if (applicationSessionIdList.length > 0) {\n         // sending kill sessions\n         infoCombiner =\n            new util.InfoCombiner(applicationSessionIdList.length, this.dealWithResponses.bind(\n               this));\n         for (i = 0; i < applicationSessionIdList.length; i++) {\n            targetApplicationSessionId = applicationSessionIdList[i];\n            killSessionObject =\n               globalArray['kill-session' + targetApplicationSessionId];\n            if (!killSessionObject) {\n               killSessionObject = new KillSessionHandler();\n               globalArray[killSessionObject.messageName +\n               targetApplicationSessionId] = killSessionObject;\n               globalArray[killSessionObject.responseTag +\n               targetApplicationSessionId] = killSessionObject;\n            } else {\n               killSessionObject.resetData();\n            }\n            killSessionObject.setCallbackFunction(infoCombiner.onInfoReceived);\n            killSessionObject.setRequestXML(targetApplicationSessionId);\n            handlerList = killSessionObject.composeHandlerList();\n            router.postMessage(handlerList);\n         }\n         this.setState(StateEnum.DONE);\n      } else { //fail to get a non-empty list, report error\n         JSCDKLogger.warning(\"There is no application session to be reset\");\n         this.pushResetFailToUser();\n      }\n   } else { //fail to get the list, report error\n      JSCDKLogger.error(\"The application sessions with origin-id(in list)\" +\n         JSON.stringify(validAndInvalidIdLists.invalid) + \" cannot be reset.\");\n      this.pushResetFailToUser();\n   }\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/killAllApplicationSessionsCtrl.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * reconnectApplicationSessionsCtrl.js--\n *\n *      middleware to reconnect application sessions by\n *      sending multiple get-application-session-connection,\n *      will be deleted when JSCDK refactory by just using\n *      callback. It currently is used to solve the naming\n *      conflict and seperate the logic out.\n *\n *      the repeating codes will be totally removed when JSCDK\n *      refactorying.\n *\n *      can't be called when last request is still being processed.\n */\n\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport {JSCDKSetUI} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport GetApplicationSessionConnectionHandler from './getApplicationSessionConnectionHandler';\n\n\nexport default function ReconnectAllApplicationSessionsCtrl() {\n   // member variables below\n   this.messageName = \"reconnect-application-sessions\";\n   this.messageText = \"reconnect-application-sessions\";\n   this.responseTag = \"reconnect-application-sessions\";\n   this.presetInfo = {};\n}\n\n// inherits MessageHandler prototype\nReconnectAllApplicationSessionsCtrl.prototype = new MessageHandler();\n// constructor\nReconnectAllApplicationSessionsCtrl.constructor =\n   ReconnectAllApplicationSessionsCtrl;\n\n/**\n * public, standard exit point\n *\n * serve as the callback to handle all of the getApplicationSessionConnect XML\n * responses. will return a merged response to UI layer.\n */\nReconnectAllApplicationSessionsCtrl.prototype.dealWithResponses =\n   function(dataList, self) {\n      let i,\n         data,\n         router = globalArray['router'],\n         errorObj,\n         failIdList = [],\n         successList = [];\n\n      if (!dataList || !Array.isArray(dataList) || dataList.length <= 0) {\n         JSCDKLogger.error(\"the response list is invalid\");\n         return;\n      }\n      // here assume all error are of the same type, so only store the last one\n      for (i = 0; i < dataList.length; i++) {\n         data = dataList[i];\n         if (data.success) {\n            successList.push(data);\n         } else {\n            failIdList.push(data.sessionId);\n            errorObj = data.error;\n         }\n      }\n      if (failIdList.length === 0) {\n         // reconnect application sessions success\n         self.pushReconnectSuccessToUser(dataList);\n      } else {\n         // this is for reusing pushErrorToUser, will be brifer after jscdk\n         // refactory, didn't rename error now\n         errorObj.errorDetail =\n            {failedSessionIdList: failIdList, successSessionList: successList};\n         self.content = {\n            error: {\n               reconnectError: errorObj\n            }\n         };\n         router.pushErrorToUser(self);\n      }\n   };\n\n\n/**\n * private, util\n * get application sesssion list from the parent handler, i.e. the\n * getLaunchItemHandler\n */\nReconnectAllApplicationSessionsCtrl.prototype.getApplicationSessions =\n   function() {\n      let getLaunchItemsObject;\n\n      getLaunchItemsObject = this.parentHandler;\n      if (!getLaunchItemsObject) {\n         getLaunchItemsObject =\n            globalArray[this.messageName + \"get-launch-items\"];\n      }\n      if (!!getLaunchItemsObject &&\n         !!getLaunchItemsObject.content[\"parsedResult\"]) {\n         return getLaunchItemsObject.content[\"parsedResult\"][\"application-sessions\"];\n      }\n      return null;\n   };\n\n/**\n * private\n *\n * @param tergetIdList out: of array\n *      will be filled with application session Ids\n * @param applicationSessions in: of Object\n *      formatted as part of get-launch-item response\n */\nReconnectAllApplicationSessionsCtrl.prototype.getAllValidAppSession =\n   function(applicationSessions) {\n      let key,\n         applicationSessionId,\n         sessionOriginId,\n         idList = [],\n         originIdList = [],\n         excludedId = this.excludedOriginalId;\n\n      for (key in applicationSessions) {\n         if (applicationSessions.hasOwnProperty(key)) {\n            applicationSessionId = applicationSessions[key].id;\n            sessionOriginId = applicationSessions[key][\"origin-id\"];\n            if (!!applicationSessionId &&\n               (applicationSessionId.trim() !== \"\") &&\n               sessionOriginId !== excludedId) {\n               idList.push(applicationSessionId);\n               originIdList.push(sessionOriginId);\n            }\n         }\n      }\n\n      return {idList: idList, originIdList: originIdList};\n   };\n\n/**\n * private\n *\n * pick out those invalid ids in the tergetIdList, and return it, the\n * definition of invalid is that the application session ID is requested but\n * not found in the valid application session list that returned from broker or\n * only consist of blanks.\n *\n * @param tergetIdList in: of Array\n *     the request application session list\n * @param applicationSessions in: of Object\n *     the active application session list get from the broker.\n */\nReconnectAllApplicationSessionsCtrl.prototype.getInvalidIdList =\n   function(tergetIdList, applicationSessions) {\n      let key,\n         applicationSessionId,\n         invalidRequestedSessionIdList = [],\n         i,\n         targetId,\n         targetSessionIdExist;\n\n      for (i = 0; i < tergetIdList.length; i++) {\n         targetId = tergetIdList[i];\n         targetSessionIdExist = false;\n         for (key in applicationSessions) {\n            if (applicationSessions.hasOwnProperty(key)) {\n               applicationSessionId = applicationSessions[key].id;\n               if (!!applicationSessionId &&\n                  (applicationSessionId.trim() !== \"\") &&\n                  targetId === applicationSessionId) {\n                  targetSessionIdExist = true;\n                  break;\n               }\n            }\n         }\n         if (!targetSessionIdExist) {\n            invalidRequestedSessionIdList.push(targetId);\n         }\n      }\n      return invalidRequestedSessionIdList;\n   };\n\n/**\n * private\n */\nReconnectAllApplicationSessionsCtrl.prototype.pushReconnectFailToUser =\n   function(errorDetail) {\n      let errorObj = {},\n         router = globalArray['router'],\n         errorMessage;\n\n      errorObj.name = \"JSCDK_ERROR_RECONNECT_POOL_FAILED\";\n      errorMessage = util._(\n         \"Application sessions cannot be reconnected. Please contact your system administrator.\");\n      router.pushSelfDefinedError(errorObj, errorMessage, errorDetail);\n      this.setState(StateEnum.FAIL);\n   };\n\n/**\n * private\n */\nReconnectAllApplicationSessionsCtrl.prototype.pushReconnectSuccessToUser =\n   function(successSessionContent) {\n      let reconnectSuccessAction = {};\n\n      reconnectSuccessAction.name = \"ReconnectAppSession\";\n      reconnectSuccessAction.content = successSessionContent;\n      JSCDKSetUI(JSON.stringify(reconnectSuccessAction));\n      this.setState(StateEnum.DONE);\n   };\n\n/**\n * private\n * return coresponding Origin Id in a list for each applicationSession that in\n * the tergetIdList(input param). the searching process is done with the input\n * param applicationSessions\n */\nReconnectAllApplicationSessionsCtrl.prototype.getOriginIdList =\n   function(tergetIdList, applicationSessions) {\n      let key,\n         applicationSessionId,\n         originIdList = [],\n         i,\n         targetId;\n\n      for (i = 0; i < tergetIdList.length; i++) {\n         targetId = tergetIdList[i];\n         for (key in applicationSessions) {\n            if (applicationSessions.hasOwnProperty(key)) {\n               applicationSessionId = applicationSessions[key].id;\n               if (targetId === applicationSessionId) {\n                  originIdList[i] = applicationSessions[key][\"origin-id\"];\n                  break;\n               }\n            }\n         }\n      }\n      return originIdList;\n   };\n\n/**\n * public, the only entry point\n *\n * Triggered by the parent handler\n * invoke getApplicationSessionConnection XML sendings\n */\nReconnectAllApplicationSessionsCtrl.prototype.triggerExecution = function() {\n   let invalidIdList,\n      allValidAppSessionInfo,\n      targetIds,\n      targetOriginIds,\n      targetId,\n      targetOriginId,\n      handlerList,\n      router = globalArray['router'],\n      AppSessionReconnector,\n      i,\n      infoCombiner;\n\n   MessageHandler.prototype.triggerExecution.apply(this);\n\n   targetIds = this.targetSessionIds;\n   if (targetIds.length === 0) {\n      allValidAppSessionInfo =\n         this.getAllValidAppSession(this.getApplicationSessions());\n      targetIds = allValidAppSessionInfo.idList;\n      targetOriginIds = allValidAppSessionInfo.originIdList;\n      if (targetIds.length === 0) {// still no targets, then just treat as success\n         this.pushReconnectSuccessToUser([]);\n         return;\n      }\n   } else {\n      invalidIdList =\n         this.getInvalidIdList(targetIds, this.getApplicationSessions());\n      if (!!invalidIdList && invalidIdList.length > 0) {\n         this.pushReconnectFailToUser(\n            {notExistingSessionIdList: invalidIdList});\n         return;\n      }\n      targetOriginIds =\n         this.getOriginIdList(targetIds, this.getApplicationSessions());\n   }\n\n   // sending reconnect sessions\n   infoCombiner =\n      new util.InfoCombiner(targetIds.length, this.dealWithResponses, this);\n   for (i = 0; i < targetIds.length; i++) {\n      targetId = targetIds[i];\n      targetOriginId = targetOriginIds[i];\n\n      // get AppSessionReconnector\n      AppSessionReconnector =\n         globalArray['get-application-session-connection' + targetId];\n      if (!AppSessionReconnector) {\n         AppSessionReconnector = new GetApplicationSessionConnectionHandler();\n         globalArray[AppSessionReconnector.messageName + targetId] =\n            AppSessionReconnector;\n         globalArray[AppSessionReconnector.responseTag + targetId] =\n            AppSessionReconnector;\n      } else {\n         AppSessionReconnector.resetData();\n      }\n\n      // config and send request\n      AppSessionReconnector.setCallbackFunction(infoCombiner.onInfoReceived);\n      AppSessionReconnector.setOriginId(targetOriginId);\n      AppSessionReconnector.setRequestXML(targetId, this.presetInfo.protocol,\n         this.presetInfo.environmentInfo, this.presetInfo.disconnectAll);\n      handlerList = AppSessionReconnector.composeHandlerList();\n      router.postMessage(handlerList);\n   }\n   this.setState(StateEnum.DONE);\n};\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/reconnectApplicationSessionsCtrl.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * rollbackCheckoutDesktopHandler.js --\n *\n *      Implementation of the message handler to rollback desktop which is\n * checked out\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport util from '../util';\nimport {MessageHandler, StateEnum} from './messageHandler';\nimport Router from './router';\nimport GetDesktopsHandler from './getDesktopsHandler';\nimport GetLaunchItemsHandler from './getLaunchItemsHandler';\n\n\nexport default function RollbackCheckoutDesktopHandler() {\n   let router;\n\n   // member variables below\n   this.messageName = \"rollback-checkout-desktop\";\n   this.messageText = \"rollback-checkout-desktop\";\n   this.responseTag = \"rollback-checkout-desktop\";\n   /**\n    * requestId will increase when a new instance is created\n    * use prototype requestId to share in all instances\n    */\n   RollbackCheckoutDesktopHandler.prototype.requestId += 1;\n\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n   }\n}\n\n// inherits MessageHandler prototype\nRollbackCheckoutDesktopHandler.prototype = new MessageHandler();\n// constructor\nRollbackCheckoutDesktopHandler.constructor = RollbackCheckoutDesktopHandler;\n\n/**\n * parse information from the response XML of rollbackCheckoutDesktop\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\nRollbackCheckoutDesktopHandler.prototype.parseResult = function(responseXML) {\n   let rollbackCheckoutDesktopResponse = {},\n      xmlDoc = $(responseXML),\n      brokerTag,\n      responses,\n      result;\n\n   brokerTag = $(xmlDoc.children()[0]);\n   if (!brokerTag) {\n      JSCDKLogger.error(\"response of rollbackCheckoutDesktopHandler error\");\n      return null;\n   }\n\n   responses = brokerTag.children(this.responseTag);\n   result = responses.children(\"result\").text();\n   util.addItemForJson(rollbackCheckoutDesktopResponse, \"result\", result);\n   return rollbackCheckoutDesktopResponse;\n};\n\n/**\n * Set the request XML for rollbackCheckoutDesktop\n * @param desktopId[in] desktop id to undo a previous checkout\n *\n */\nRollbackCheckoutDesktopHandler.prototype.setRequestXML = function(desktopId) {\n   let desktopIdElem;\n   desktopIdElem = util.createElement(\"desktop-id\", desktopId);\n   this.requestXML = desktopIdElem;\n};\n\nRollbackCheckoutDesktopHandler.prototype.onUpdated = function() {\n   let router = util.getObject(globalArray, \"router\");\n   let logoutFromBrokerAction;\n   let getDesktopsObject;\n   let getLaunchItemsObject;\n   let supportedProtocols;\n   let supportedAppProtocols;\n   let handlerList;\n   let type;\n\n   MessageHandler.prototype.onUpdated.apply(this);\n\n   if (this.state === StateEnum.DONE) {\n      if (!!(this.content[\"parsedResult\"]) &&\n         this.content[\"parsedResult\"][\"result\"] === \"ok\") {\n         JSCDKLogger.debug(\"rollbackCheckoutDesktop result is OK.\");\n         if (!util.brokerSupportApplication()) {\n            //send getDesktops request again and refresh desktop list in UI\n            getDesktopsObject = globalArray[\"get-desktops\"];\n            if (!getDesktopsObject) {\n               getDesktopsObject = new GetDesktopsHandler();\n               globalArray[getDesktopsObject.messageName] = getDesktopsObject;\n               globalArray[getDesktopsObject.responseTag] = getDesktopsObject;\n            } else {\n               getDesktopsObject.resetData();\n            }\n\n            if (!!getDesktopsObject && !!router) {\n               supportedProtocols = globalArray.supportedProtocols;\n               if (!!supportedProtocols) {\n                  getDesktopsObject.setRequestXML(supportedProtocols);\n                  handlerList = getDesktopsObject.composeHandlerList();\n                  router.postMessage(handlerList);\n               } else {\n                  JSCDKLogger.error(\"supported protocols is invalid.\");\n               }\n            }\n         } else {\n            getLaunchItemsObject = globalArray[\"get-launch-items\"];\n            if (!getLaunchItemsObject) {\n               getLaunchItemsObject = new GetLaunchItemsHandler();\n               globalArray[getLaunchItemsObject.messageName] =\n                  getLaunchItemsObject;\n               globalArray[getLaunchItemsObject.responseTag] =\n                  getLaunchItemsObject;\n            } else {\n               getLaunchItemsObject.resetData();\n            }\n\n            if (!!getLaunchItemsObject && !!router) {\n               supportedProtocols = globalArray.supportedProtocols;\n               type = {};\n               type.name = \"remote\";\n               type.protocols = supportedProtocols;\n               supportedAppProtocols = [];\n               supportedAppProtocols[0] = type;\n               if (!!supportedProtocols) {\n                  getLaunchItemsObject.setRequestXML(supportedProtocols,\n                     supportedAppProtocols);\n                  handlerList = getLaunchItemsObject.composeHandlerList();\n                  router.postMessage(handlerList);\n               } else {\n                  JSCDKLogger.error(\"supported protocols is invalid.\");\n               }\n            }\n         }\n      } else {\n         JSCDKLogger.error(\"rollbackCheckoutDesktop failed.\");\n         // XXX TODO: handle errors later(need update errorController), such as\n         // INVALID_MVDI_STATE\n      }\n   }\n\n   Router.prototype.pushErrorToUser(this);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/rollbackCheckoutDesktopHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * samlHandler.js --\n *\n *     handle SAML authentication\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler} from './messageHandler';\n\n\nexport default function SamlHandler() {\n   let router;\n\n   // member variables below\n   this.messageName = \"saml\";\n   this.messageText = \"saml\";\n\n   // register dependencies here\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nSamlHandler.prototype = new MessageHandler();\n// constructor\nSamlHandler.constructor = SamlHandler;\n\n/**\n * Set the request XML for saml authentication.\n *\n * @param secret [in] base64-encoded SAML artifact.\n */\n\nSamlHandler.prototype.setRequestXML = function(secret) {\n   let nameText = util.createElement(\"name\", \"artifact\");\n   let secretText = util.createElement(\"values\",\n      util.createElement(\"value\", secret));\n   let paramText = util.createElement(\"param\", nameText + secretText);\n   let paramsText = util.createElement(\"params\", paramText);\n   this.requestXML = util.createElement(\"name\", \"saml\");\n   this.requestXML += paramsText;\n   this.requestXML = util.createElement(\"screen\", this.requestXML);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/samlHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * securIDNextTokenCodeHandler.js --\n *\n *      A sub-handler for DoSubmitAuthenticationHandler for SecurIDNextTokenCode\n *      authentication.\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler} from './messageHandler';\n\n\nexport default function SecurIDNextTokenCodeHandler() {\n   let router;\n   // member variables below\n   this.messageName = \"securid-nexttokencode\";\n   this.messageText = \"securid-nexttokencode\";\n\n   // register dependencies here\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nSecurIDNextTokenCodeHandler.prototype = new MessageHandler();\n// constructor\nSecurIDNextTokenCodeHandler.constructor = SecurIDNextTokenCodeHandler;\n\n/**\n * Set the request XML for next token code authentication.\n *\n * @param tokenCode [in] token code for the securid authentication.\n */\n\nSecurIDNextTokenCodeHandler.prototype.setRequestXML = function(tokenCode) {\n   let tokenCodeText;\n   let paramText;\n   tokenCodeText = util.createElement(\"name\", \"tokencode\");\n   tokenCodeText +=\n      util.createElement(\"values\", util.createElement(\"value\", tokenCode));\n   paramText = util.createElement(\"param\", tokenCodeText);\n\n   paramText = util.createElement(\"params\", paramText);\n   this.requestXML = util.createElement(\"name\", this.messageName);\n   this.requestXML += paramText;\n   this.requestXML = util.createElement(\"screen\", this.requestXML);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/securIDNextTokenCodeHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * securIDPasscodeHandler.js --\n *\n *      A sub-handler for DoSubmitAuthenticationHandler for SecurIDPasscode\n *      authentication.\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler} from './messageHandler';\n\n\nexport default function SecurIDPasscodeHandler() {\n   let router;\n   // member variables below\n   this.messageName = \"securid-passcode\";\n   this.messageText = \"securid-passcode\";\n\n   // register dependencies here\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nSecurIDPasscodeHandler.prototype = new MessageHandler();\n// constructor\nSecurIDPasscodeHandler.constructor = SecurIDPasscodeHandler;\n\n/**\n * Set the request XML for Windows passcode authentication.\n *\n * @param username [in] username for the securid authentication.\n * @param passcode [in] passcode for the securid authentication.\n */\n\nSecurIDPasscodeHandler.prototype.setRequestXML = function(username, passcode) {\n   let usernameText;\n   let passcodeText;\n   let paramText;\n   usernameText = util.createElement(\"name\", \"username\");\n   usernameText +=\n      util.createElement(\"values\", util.createElement(\"value\", username));\n   passcodeText = util.createElement(\"name\", \"passcode\");\n   passcodeText +=\n      util.createElement(\"values\", util.createElement(\"value\", passcode));\n   paramText = util.createElement(\"param\", usernameText);\n   paramText += util.createElement(\"param\", passcodeText);\n\n   paramText = util.createElement(\"params\", paramText);\n   this.requestXML = util.createElement(\"name\", this.messageName);\n   this.requestXML += paramText;\n   this.requestXML = util.createElement(\"screen\", this.requestXML);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/securIDPasscodeHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * securIDPinChangeHandler.js --\n *\n *      A sub-handler for DoSubmitAuthenticationHandler for securIDPinChange\n *      authentication.\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler} from './messageHandler';\n\n\nexport default function SecurIDPinChangeHandler() {\n   let router;\n   // member variables below\n   this.messageName = \"securid-pinchange\";\n   this.messageText = \"securid-pinchange\";\n\n   // register dependencies here\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nSecurIDPinChangeHandler.prototype = new MessageHandler();\n// constructor\nSecurIDPinChangeHandler.constructor = SecurIDPinChangeHandler;\n\n/**\n * Set the request XML for securIDPinChange authentication.\n *\n * @param pin1 [in] new PIN input\n * @param pin2 [in] comfirm PIN input\n */\n\nSecurIDPinChangeHandler.prototype.setRequestXML = function(pin1, pin2) {\n   let pin1Text;\n   let pin2Text;\n   let paramText;\n   pin1Text = util.createElement(\"name\", \"pin1\");\n   pin1Text += util.createElement(\"values\", util.createElement(\"value\", pin1));\n   pin2Text = util.createElement(\"name\", \"pin2\");\n   pin2Text += util.createElement(\"values\", util.createElement(\"value\", pin2));\n   paramText = util.createElement(\"param\", pin1Text);\n   paramText += util.createElement(\"param\", pin2Text);\n\n   paramText = util.createElement(\"params\", paramText);\n   this.requestXML = util.createElement(\"name\", this.messageName);\n   this.requestXML += paramText;\n   this.requestXML = util.createElement(\"screen\", this.requestXML);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/securIDPinChangeHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * securIDWaitHandler.js --\n *\n *      A sub-handler for DoSubmitAuthenticationHandler for securIDWait\n *      authentication.\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler} from './messageHandler';\n\n\nexport default function SecurIDWaitHandler() {\n   let router;\n   // member variables below\n   this.messageName = \"securid-wait\";\n   this.messageText = \"securid-wait\";\n\n   // register dependencies here\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nSecurIDWaitHandler.prototype = new MessageHandler();\n// constructor\nSecurIDWaitHandler.constructor = SecurIDWaitHandler;\n\n/**\n * Set the request XML for securIDWait authentication.\n *\n */\n\nSecurIDWaitHandler.prototype.setRequestXML = function() {\n   let paramText;\n\n   paramText = util.createElement(\"params\", \"\");\n   this.requestXML = util.createElement(\"name\", this.messageName);\n   this.requestXML += paramText;\n   this.requestXML = util.createElement(\"screen\", this.requestXML);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/securIDWaitHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * setLocaleHandler.js --\n *\n *      Implementation of the message handler to set locale.\n */\n\nimport $ from 'jquery';\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport util from '../util';\nimport {MessageHandler} from './messageHandler';\n\n\nexport default function SetLocaleHandler() {\n   // member variables below\n   this.messageName = \"set-locale\";\n   this.messageText = \"set-locale\";\n   this.responseTag = \"set-locale\";\n   this.properties = null; // properties in xml, key-value, such as locale:en_GB\n\n   // register dependencies here\n   let router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n\n   this.requestXML = util.createElement(\"locale\", util.l10N.getLocale());\n}\n\n// inherits MessageHandler prototype\nSetLocaleHandler.prototype = new MessageHandler();\nSetLocaleHandler.constructor = SetLocaleHandler;\n\n/**\n * callback when received notification from handlers in dependency list or\n * network\n *\n */\nSetLocaleHandler.prototype.onUpdated = function() {\n   MessageHandler.prototype.onUpdated.apply(this); // call parent class's\n                                                   // onUpdated\n   // XXX TODO: more own update operations\n};\n\n/**\n * parse locale information from the response XML of GetConfiguration\n *\n * @param responseXML[in] response of xmlhttprequest from view broker\n * @return key-value pairs parsed from response, if error then return null\n */\nSetLocaleHandler.prototype.parseResult = function(responseXML) {\n   if (!responseXML || (responseXML === \"\")) {\n      return null;\n   }\n   let responseBody = $(responseXML);\n   let ret = {};\n   let brokerElem;\n   let responseTagElem;\n   let resultElem;\n   let resultText;\n   brokerElem = responseBody.find(\"broker\");\n   if (!brokerElem) {\n      JSCDKLogger.error(\"response of \" + this.getMessageName() + \" error\");\n      return null;\n   }\n   responseTagElem = brokerElem.find(this.responseTag);\n   resultElem = responseTagElem.find(\"result\");\n   resultText = resultElem.text();\n   if (!!resultText && (resultText.trim() !== \"\")) {\n      ret[\"result\"] = resultText;\n   } else {\n      return null;\n   }\n   return ret;\n};\n\n// add more functions here\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/setLocaleHandler.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * unauthHandler.js --\n *\n *      A sub-handler for DoSubmitAuthenticationHandler.\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler} from './messageHandler';\n\nexport default function UnauthHandler() {\n   let router;\n\n   // member variables below\n   this.messageName = \"unauthenticated\";\n   this.messageText = \"unauthenticated\";\n\n   // register dependencies here\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nUnauthHandler.prototype = new MessageHandler();\n// constructor\nUnauthHandler.constructor = UnauthHandler;\n\n/**\n * Set the request XML for unauthenticated.\n *\n * @param username [in] username for the windows password authentication.\n */\n\nUnauthHandler.prototype.setRequestXML = function(username) {\n   let usernameText,\n      paramText;\n\n   usernameText = util.createElement(\"name\", \"username\");\n   usernameText += util.createElement(\"values\",\n      util.createElement(\"value\", username.trim()));\n   paramText = util.createElement(\"param\", usernameText);\n\n   paramText = util.createElement(\"params\", paramText);\n   this.requestXML = util.createElement(\"name\", \"unauthenticated\");\n   this.requestXML += paramText;\n   this.requestXML = util.createElement(\"screen\", this.requestXML);\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/unauthHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * winCredsHandler.js --\n *\n *      A sub-handler for DoSubmitAuthenticationHandler.\n */\n\nimport {globalArray} from '../jscdkClient';\nimport util from '../util';\nimport {MessageHandler} from './messageHandler';\n\n\nexport default function WinCredsHandler() {\n   let router;\n\n   // member variables below\n   this.messageName = \"windows-password\";\n   this.messageText = \"windows-password\";\n   this.cachedDomainUsername = \"\";\n\n   // register dependencies here\n   router = util.getObject(globalArray, \"router\");\n   if (!!router) {\n      this.registerHandler(router, \"receiver\");\n      this.registerHandler(router, \"doLogout\");\n      this.registerHandler(router, \"doCancelAuthentication\");\n   }\n}\n\n// inherits MessageHandler prototype\nWinCredsHandler.prototype = new MessageHandler();\n// constructor\nWinCredsHandler.constructor = WinCredsHandler;\n\n/**\n * Set the request XML for Windows password authentication.\n *\n * @param domain [in] domain for the windows password authentication.\n * @param username [in] username for the windows password authentication.\n * @param password [in] password for the windows password authentication.\n */\n\nWinCredsHandler.prototype.setRequestXML = function(domain, username, password) {\n   let usernameText,\n      domainText,\n      passwordText,\n      paramText,\n      backslash;\n\n   /**\n    * Three login username format is supported:\n    * 1. username        (broker supported)\n    * 2. username@domain (broker supported)\n    * 3. domain\\username (broker not supported)\n    *\n    * We need to parse username and domain from #3\n    */\n\n   if (this.isDomainUsername(username)) {\n      this.cachedDomainUsername = username;\n      backslash = username.indexOf('\\\\');\n      domain = username.substr(0, backslash);\n      username = username.substr(backslash + 1);\n   } else {\n      this.cachedDomainUsername = \"\";\n   }\n\n   usernameText = util.createElement(\"name\", \"username\");\n   usernameText += util.createElement(\"values\",\n      util.createElement(\"value\", username.trim()));\n   domainText = util.createElement(\"name\", \"domain\");\n   domainText +=\n      util.createElement(\"values\", util.createElement(\"value\", domain.trim()));\n   passwordText = util.createElement(\"name\", \"password\");\n   passwordText +=\n      util.createElement(\"values\", util.createElement(\"value\", password));\n   paramText = util.createElement(\"param\", usernameText);\n   paramText += util.createElement(\"param\", domainText);\n   paramText += util.createElement(\"param\", passwordText);\n\n   paramText = util.createElement(\"params\", paramText);\n   this.requestXML = util.createElement(\"name\", \"windows-password\");\n   this.requestXML += paramText;\n   this.requestXML = util.createElement(\"screen\", this.requestXML);\n};\n\nWinCredsHandler.prototype.isDomainUsername = function(username) {\n   if (!username) {\n      return false;\n   }\n   return username.indexOf('\\\\') !== -1;\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/controllers/winCredsHandler.js","/*********************************************************\n * Copyright (C) 2012-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * jscdkError.js --\n *\n * A base class defining JSCDK errors,\n * each error is defined by an error codes and the associated error string.\n *\n */\n\n\nexport default function JSCDKError(errorCode, errorMessage) {\n   this.code = errorCode;\n   this.message = errorMessage;\n}\n\nJSCDKError.prototype.getErrorCode = function() {\n   return this.code;\n};\n\nJSCDKError.prototype.getErrorMessage = function() {\n   return this.message;\n};\n\nJSCDKError.prototype.toString = function() {\n   return \"Error Code: \" + this.code + \", Error Message: \" + this.message;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/model/jscdkError.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * timer.js --\n *\n * timer class\n *\n */\n\n\nimport JSCDKLogger from '../jscdkLogger';\n\n\nexport const timerTypeEnum = {\n   timeout: \"timeoutTimer\",\n   interval: \"intervalTimer\"\n};\n\n\nexport function Timer(timerType) {\n   if (timerType !== timerTypeEnum.timeout &&\n      timerType !== timerTypeEnum.interval) {\n      JSCDKLogger.error(\"unknown type string passed in Timer()\");\n      return;\n   }\n   this.type = timerType;\n   this.timerValue = -1;\n   this.timerId = null;\n   this.eventCallbackFunc = null;\n   this.enable = false;\n   this.params = null;\n   if (this.type === timerTypeEnum.timeout) {\n      this.targetTime = -1;\n      this.timerCreateFunction = function(callback, milliSecends, params) {\n         if (!!this.timerId) {\n            JSCDKLogger.error(\"timeout timerId \" + this.timerId +\n               \" do exist whild try create it\");\n            return;\n         }\n         this.timerId = setTimeout(callback, milliSecends, params);\n         JSCDKLogger.debug(\"timeout timer \" + this.timerId + \" created\");\n      };\n      this.timerStopFunction = function() {\n         if (!this.timerId) {\n            JSCDKLogger.error(\"timeout timerId don't exist when try stop it\");\n            this.setDisable();\n            return;\n         }\n         clearTimeout(this.timerId);\n         JSCDKLogger.debug(\"timeout timer \" + this.timerId + \" deleted\");\n         this.timerId = null;\n      };\n   } else {\n      this.timerCreateFunction = function(callback, milliSecends, params) {\n         if (!!this.timerId) {\n            JSCDKLogger.error(\"interval timerId \" + this.timerId +\n               \" do exist whild try create it\");\n            return;\n         }\n         this.timerId = setInterval(callback, milliSecends, params);\n         JSCDKLogger.debug(\"interval timer \" + this.timerId + \" created\");\n      };\n      this.timerStopFunction = function() {\n         if (!this.timerId) {\n            JSCDKLogger.error(\"interval timerId don't exist when try stop it\");\n            this.setDisable();\n            return;\n         }\n         clearInterval(this.timerId);\n         JSCDKLogger.debug(\"interval timer \" + this.timerId + \" deleted\");\n         this.timerId = null;\n      };\n   }\n}\n\n//only store functions in prototype\nTimer.prototype = {};\nTimer.constructor = Timer;\n\nTimer.prototype.getCurrentTime = function() {\n   return new Date().getTime();\n};\n\n\nTimer.prototype.isEnabled = function() {\n   return (this.enable === true);\n};\n\nTimer.prototype.init = function(eventCallbackFunc, timerValue, params) {\n   if (!this.isEnabled()) {\n      return;\n   }\n   if (timerValue <= 0) {//invalid\n      if (this.isEnabled()) {\n         JSCDKLogger.debug(\n            \"timer init with negtive timeout value:\" + timerValue);\n         this.discard();\n      }\n      return;\n   }\n   this.timerValue = timerValue;\n   this.eventCallbackFunc = eventCallbackFunc;\n   this.params = params;\n};\n\n\nTimer.prototype.ensureUpdatedOrStarted = function() {\n   if (!this.isEnabled()) {\n      return;\n   }\n   if (!!this.timerId) {\n      this.stop();\n      this.start();\n   } else {\n      this.start();\n   }\n};\n\nTimer.prototype.start = function() {\n   if (!this.isEnabled()) {\n      return;\n   }\n   if (this.type === timerTypeEnum.timeout) {\n      //the absolute time in secs that once reached, the callback will be\n      // triggered\n      this.targetTime = this.getCurrentTime() + this.timerValue;\n   }\n   this.timerCreateFunction(this.eventCallbackFunc, this.timerValue,\n      this.params);\n};\n\nTimer.prototype.stop = function() {\n   if (!this.isEnabled()) {\n      return;\n   }\n   this.timerStopFunction();\n};\n\nTimer.prototype.getTargetTime = function() {\n   if (!this.isEnabled()) {\n      return null;\n   }\n   var restTime = null;\n   if (this.type === timerTypeEnum.timeout && this.targetTime > 0) {\n      restTime = this.targetTime - this.getCurrentTime();\n      JSCDKLogger.debug(\"\\nget timer rest time:\" + restTime);\n   } else {\n      JSCDKLogger.error(\"getRestTime is being misused!\");\n   }\n   return this.targetTime;\n};\n\nTimer.prototype.updateTimeoutValue = function(newTimerValue) {\n   if (!this.isEnabled()) {\n      return;\n   }\n   if (this.type === timerTypeEnum.timeout) {\n      if (newTimerValue < 0) {\n         JSCDKLogger.debug(\n            \"timeout timer not reset with new timeout value:\" + newTimerValue);\n         return;\n      }\n      this.timerValue = newTimerValue;\n      this.stop();\n      this.start();\n      JSCDKLogger.debug(\n         \"timeout timer reset with new timeout value:\" + newTimerValue);\n   } else {\n      JSCDKLogger.error(\n         \"the updateTimeoutValue method is not for the intervalTimer\");\n   }\n};\n\n\nTimer.prototype.setEnable = function() {\n   this.enable = true;\n};\n\nTimer.prototype.setDisable = function() {\n   this.enable = false;\n};\n\nTimer.prototype.discard = function() {//only preserve type info\n   this.stop();\n   this.timerValue = -1;\n   this.timerId = null;\n   this.eventCallbackFunc = null;\n   this.params = null;\n   if (this.type === timerTypeEnum.timeout) {\n      this.targetTime = -1;\n   }\n   this.setDisable();\n};\n\nTimer.prototype.ensureStopped = function() {\n   if (!this.isEnabled()) {\n      return;\n   }\n   this.discard();\n};\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/timer/timer.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n/**\n * userActiveTimeSyncCtrl.js --\n *\n *      Implementation of the functions to handle response of\n * <authentication-status>.\n */\n\nimport {globalArray} from '../jscdkClient';\nimport JSCDKLogger from '../jscdkLogger';\nimport util from '../util';\nimport GetAuthenticationStatusHandler from '../controllers/getAuthenticationStatusHandler';\n\n\nexport default function UserActiveTimeSyncCtrl() {\n   this.idleTimerObject = util.getObject(globalArray, \"idle-timeout-timer\");\n   if (!this.idleTimerObject) {\n      JSCDKLogger.error(\n         \"UserActiveTimeSyncCtrl must be used after idleTimerObject is inited\");\n      return;\n   }\n   if (this.idleTimerObject.brokerVersionInvalid()) {\n      return;\n   }\n   // member variables below\n   this.ctrlName = \"get-broker-sso-time-ctrl\";\n   this.callBackType = null;\n   this.response = null;\n}\n\nUserActiveTimeSyncCtrl.prototype = {};\nUserActiveTimeSyncCtrl.constructor = UserActiveTimeSyncCtrl;\n\n\n// request send dealing functions\nUserActiveTimeSyncCtrl.prototype.requestBrokerSSOTime = function(callBackType) {\n   if (this.idleTimerObject.brokerVersionInvalid()) {\n      return;\n   }\n   this.callBackType = callBackType;\n   let getAuthenticationStatusObject,\n      handlerList,\n      router = globalArray[\"router\"];\n\n   getAuthenticationStatusObject = globalArray[\"get-authentication-status\"];\n   if (!getAuthenticationStatusObject) {\n      getAuthenticationStatusObject = new GetAuthenticationStatusHandler();\n      globalArray[getAuthenticationStatusObject.messageName] =\n         getAuthenticationStatusObject;\n      globalArray[getAuthenticationStatusObject.responseTag] =\n         getAuthenticationStatusObject;\n   } else {\n      getAuthenticationStatusObject.resetData();\n   }\n\n   if (!!getAuthenticationStatusObject && !!router) {\n      getAuthenticationStatusObject.setRequestXML(true);\n      handlerList = getAuthenticationStatusObject.composeHandlerList();\n      router.postMessage(handlerList);\n   }\n};\n\n// response dealing functions\nUserActiveTimeSyncCtrl.prototype.dealWithAuthenticationStatusXML =\n   function(response) {\n      if (this.idleTimerObject.brokerVersionInvalid()) {\n         return;\n      }\n      this.response = response;\n      if (this.callBackType === \"syncWithTimer4AboutToTimeout\" ||\n         this.callBackType === \"syncWithTimer4Timeout\") {\n         this.dealWithSSOTime();\n      } else {\n         JSCDKLogger.debug(\n            'unknown callBackType in GetAuthenticationStatusHandler');\n      }\n   };\n\nUserActiveTimeSyncCtrl.prototype.dealWithSSOTime = function() {\n   let idleTimerObject = this.idleTimerObject,\n      timeToBrokerLocked;\n\n   if (this.callBackType === \"syncWithTimer4AboutToTimeout\" ||\n      this.callBackType === \"syncWithTimer4Timeout\") {\n      if (!idleTimerObject) {\n         JSCDKLogger.error(\n            \"timerController do not exist in GetAuthenticationStatusHandler.onUpdated()\");\n         return;\n      }\n      if (this.response.sso === \"unlocked\") {\n         //push that time in the timer controller, and start the comparation\n         timeToBrokerLocked = this.response[\"time-to-sso-lock\"];\n         idleTimerObject.setBrokerTimeForCompare(timeToBrokerLocked);\n         idleTimerObject.compareToAct(this.callBackType);\n      } else {\n         this.detectBrokerLocked();\n      }\n   }\n};\n\nUserActiveTimeSyncCtrl.prototype.detectBrokerLocked = function() {\n   //deal with locked case\n   let idleTimerObject = this.idleTimerObject;\n   if (!!idleTimerObject) {\n      idleTimerObject.detectBrokerLocked();\n   } else {\n      JSCDKLogger.error(\n         \"timerController do not exist when UserActiveTimeSyncCtrl detect session locked\");\n   }\n};\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./jscdk/timer/userActiveTimeSyncCtrl.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport {globalArray} from '../../jscdk/jscdkClient';\nimport util from '../../jscdk/util';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport $ from 'jquery';\n\n\nexport default function BlastDesktopCtrl($window, $scope, $rootScope,\n                                         mainService,\n                                         connectionServerModel,\n                                         blastSessionsModel, clientModel,\n                                         connectionURIModel, multiSiteService,\n                                         viewService,\n                                         constants,\n                                         userGlobalPref, baseViewService,\n                                         jscdkLauncherInvoker) {\n   // Initialize BlastDesktopCtrl controller.\n   $scope.init = function() {\n      let data = mainService.data;\n\n      if (!!data && !!data.content) {\n         if (!!data.content.redirectProperties) {\n            // Multi-site redirection\n            try {\n               multiSiteService.redirectAndStartSession(\n                  data.content.redirectProperties);\n               return;\n            } catch (e) {\n               JSCDKLogger.debug(\n                  'Error: fail to redirect due to: ' + e);\n            }\n         }\n\n         if (data.content.isApplicationSession) {\n            blastSessionsModel.saveFromXmlResponse(data.content);\n         }\n         $scope.blastURL = data.content.url;\n         $scope.desktopId = data.content.id;\n         $scope.preferences = data.content.preferences;\n         $scope.url = data.content.url;\n         $scope.isApplicationSession =\n            data.content.isApplicationSession;\n         $scope.isShadow = data.content.isShadow;\n         if (!!data.content.userName) {\n            // Get valid username\n            let containsAt = data.content.userName.indexOf('@');\n            if (containsAt !== -1) {\n               connectionServerModel.username =\n                  data.content.userName.substr(0, containsAt);\n            } else {\n               connectionServerModel.username = data.content.userName;\n            }\n         }\n         if (!!data.content.domainName) {\n            connectionServerModel.domain = data.content.domainName;\n         }\n         // Save desktop data\n         $scope.saveDesktopData($scope.desktopId,\n            $scope.preferences.desktopName,\n            connectionServerModel.host, $scope.blastURL,\n            $scope.isApplicationSession,\n            $scope.isShadow);\n\n         /**\n          * Stop idle timeout related timers to avoid timer triggered\n          * after js is deleted.\n          */\n         jscdkLauncherInvoker.stopTimer();\n         // Display desktop full screen.\n         $('.ui-body').addClass('ui-full-page');\n         // load the appblast desktop in place of this client.\n         $rootScope.CLIENT_MODE = constants.CLIENT_MODE.DESKTOP;\n\n         viewService.goBlastPage();\n      }\n\n      // Initialize view. Hide header and hide strip.\n      $scope.initView(true, true);\n      // Set current controller.\n      mainService.currentController = this;\n   };\n\n   $scope.saveDesktopData =\n      function(desktopId, desktopName, host, blastURL,\n               isApplicationSession, isShadow) {\n         let router = globalArray['router'],\n            sessionStorage = $window.sessionStorage,\n            savedData,\n            value,\n            SAMLart,\n            closeOnExitFlag,\n            horizonId;\n\n         SAMLart =\n            util.getUrlParam($window.location.href.toLowerCase(), 'samlart');\n         if (!!SAMLart) {\n            closeOnExitFlag = true;\n         } else {\n            closeOnExitFlag = false;\n         }\n\n         horizonId = connectionServerModel.horizonId;\n         if (!horizonId && !!connectionURIModel.params) {\n            horizonId = connectionURIModel.params.horizonId;\n         }\n\n         savedData = {\n            user: connectionServerModel.username,\n            domainName: connectionServerModel.domain,\n            idleTimeout: connectionServerModel.idleTimeout,\n            userActivityXMLSendingInterval: connectionServerModel.userActivityXMLSendingInterval,\n            brokerSupportIdleTimeout: util.brokerSupportApplication(),\n            desktopId: desktopId,\n            desktopName: desktopName,\n            referer: $window.location.href,\n            rebrand: clientModel.rebrandEnable,\n            brokerUrl: router.brokerUrl,\n            brokerUrlWithTimestamp: router.brokerUrlWithTimestamp,\n            blastURL: blastURL,\n            isApplicationSession: isApplicationSession,\n            isShadow: isShadow,\n            closeOnExit: closeOnExitFlag,\n            horizonId: horizonId,\n            logLevel: clientModel.logLevel\n         };\n\n         /**\n          * write this oject into session storage\n          * seal this function here, easy for put into util-service\n          * for\n          * other usage it can also be stringify to a root name, but\n          * this will influence info-reading.\n          */\n         (function(savedData) {\n            let key;\n            for (key in savedData) {\n               if (savedData.hasOwnProperty(key)) {\n                  value = savedData[key];\n                  sessionStorage.setItem(key, value);\n               }\n            }\n         }(savedData));\n      };\n\n   $scope.$on('$locationChangeStart', function(event, next, current) {\n      /**\n       * Only post data when launching desktop/app, but not when user\n       * clicks back button.\n       */\n      if (baseViewService.isJumpingToDesktop(next, current)) {\n         userGlobalPref.postPrefData();\n      }\n   });\n\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/blastdesktop-controller.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n//should spoort highlighting both app and desktop, added to html later, then\n// filename should also be changed\n\nimport $ from 'jquery';\nimport progressCircleTemplate from './progress-circle.html';\n\nexport function scrollTopDirective() {\n   return {\n      restrict: 'A',\n      scope: {\n         isHighlighted: '&scrollTop'\n      },\n      link: function(scope, elem, attrs) {\n         // whehter this desktop is highlighted\n         if (scope.isHighlighted()) {\n            // scroll 10px to the top.\n            $('html, body').animate({\n               scrollTop: elem.offset().top - 10\n            }, 150);\n         }\n      }\n   };\n}\n\nexport function viewAutofocusDirective($timeout) {\n   return {\n      link: function(scope, elem, attrs, ctrl) {\n\n         function setFocus() {\n            if (attrs.viewAutofocus === 'true') {\n               $timeout(function() {\n                  elem[0].focus();\n               });\n            }\n         }\n\n         attrs.$observe('viewAutofocus', setFocus);\n      }\n   };\n}\n\nexport function unstorablePasswordDirective($timeout) {\n   return {\n      link: function(scope, elem, attrs) {\n         $timeout(function() {\n            $(elem[0]).prop('type', 'password');\n         }, 200);\n      }\n   };\n}\n\nexport function fallbackSrcDirective() {\n   return {\n      link: function postLink(scope, iElement, iAttrs) {\n         if (!iAttrs.ngSrc) {\n            iElement.addClass('default-icon');\n         } else {\n            iElement.bind('error', function() {\n               $(this).addClass(iAttrs.fallbackSrc);\n            });\n         }\n      }\n   };\n}\n\nexport function progressCircleDirective() {\n   return {\n      restrict: 'E',\n      templateUrl: progressCircleTemplate\n   };\n}\n\nexport function helpLinkDirective(viewClientModel, utilService, _, $timeout, $rootScope,\n         localize) {\n   return {\n      restrict: 'E',\n      replace: true,\n      link: function(scope, element) {\n         let showLink = function() {\n            $timeout(function() {\n               //Rebrand the help URL\n               let helpUrl = viewClientModel.rebrandHelpUrl ||\n                     utilService.getLinkByType('helpPages'),\n                  name = _('help_with_vmware_horizon');\n               element.html(name);\n               element.attr('href', helpUrl);\n               scope.showHelpLink = true;\n            });\n         };\n\n         $rootScope.$on(\"model:localizationReady\", function(event,\n                                                            data) {\n            /**\n             * In most cases,\n             * localize.translate('help_with_vmware_horizon') does not\n             * get the correct result because the resource is downloaded\n             * asynchronously. model:localizationReady event is emitted\n             * by localize service when the downloaded is finished using\n             * $timeout to un-block the waiting widget UI using\n             * '$rootScope' not 'scope' to register the event is for\n             * performance consideration.  $emit is cheaper than\n             * $broadcast\n             */\n            showLink();\n         });\n\n         if (localize.localizationReady) {\n            showLink();\n         }\n      },\n      template: '<a class=\"home-link\" id=\"helpLink\" href=\"\" target=\"_blank\" ng-show=\"showHelpLink\"></a>'\n   };\n}\n\nexport function downloadLinkdirective(_, $timeout, $rootScope, viewClientModel, localize) {\n   return {\n      restrict: 'E',\n      replace: true,\n      link: function(scope, element) {\n         let showLink = function() {\n            $timeout(function() {\n               //Rebrand the installer URL\n               let name = _(viewClientModel.osLiteral);\n               element.html(name);\n               element.attr('href', viewClientModel.nativeInstallerLink);\n               // For unit testing\n               scope.nativeInstallerLink =\n                  viewClientModel.nativeInstallerLink;\n            });\n         };\n\n         $rootScope.$on(\"model:localizationReady\", function(event,\n                                                            data) {\n            /**\n             * In most cases,\n             * localize.translate('help_with_vmware_horizon') does not\n             * get the correct result because the resource is downloaded\n             * asynchronously. model:localizationReady event is emitted\n             * by localize service when the downloaded is finished using\n             * $timeout to un-block the waiting widget UI using\n             * '$rootScope' not 'scope' to register the event is for\n             * performance consideration.  $emit is cheaper than\n             * $broadcast\n             */\n            showLink();\n         });\n\n         if (localize.localizationReady) {\n            showLink();\n         }\n      },\n      template: '<a class=\"home-link\" id=\"downloadLink\" href=\"\" target=\"_blank\"></a>'\n   };\n}\n\nexport function highlightDirective() {\n   return {\n      restrict: 'A',\n      link: function(scope, elem, attrs) {\n         let toggle = function(enabled) {\n            if (enabled) {\n               elem.addClass('highlight');\n            } else {\n               elem.removeClass('highlight');\n            }\n         };\n\n         toggle(scope[attrs.highlight]);\n         scope.$watch(attrs.highlight, toggle);\n      }\n   };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/common-directive.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport settingDialogTemplate from '../setting-dialog/setting-dialog-launcher.html';\nimport aboutDialogTemplate from '../../common/aboutdialog/about_dialog.html';\nimport $ from 'jquery';\nimport headerTemplate from './header-default.html';\n\n\nexport function headerDirective() {\n   return {\n      replace: true,\n      restrict: 'E',\n      templateUrl: headerTemplate\n   };\n}\n\nexport function HeaderCtrl($rootScope, $scope, connectionServerModel,\n                                   utilService,\n                                   dialogService) {\n   $scope.init = function() {\n      let searchInput = $('#header-search');\n\n      // Portal URL.\n      $scope.host = 'https://' + connectionServerModel.host;\n      // Logout function.\n      $scope.logout = function() {\n         utilService.showLogoutDialog();\n      };\n\n      $scope.showAllStyle = 'show-all-on';\n      $scope.showFavStyle = 'show-fav-off';\n      // Bind close dialog method.\n      $('#closeAboutBtn').on('click', $scope.closeAboutDialog);\n      // Focus on search input on receiving searchFocus event.\n      $rootScope.$on('searchFocus', function() {\n         searchInput.focus();\n      });\n   };\n\n   $scope.showAll = function() {\n      $rootScope.onlyFavorites = false;\n      $scope.showAllStyle = 'show-all-on';\n      $scope.showFavStyle = 'show-fav-off';\n   };\n\n   $scope.showFavorites = function() {\n      $rootScope.onlyFavorites = true;\n      $scope.showAllStyle = 'show-all-off';\n      $scope.showFavStyle = 'show-fav-on';\n   };\n\n   $scope.showSetting = function() {\n      dialogService.predefined({\n         name: \"SettingsWindowLauncher\",\n         templateUrl: settingDialogTemplate,\n         className: \"settings-window\",\n         controller: \"LauncherSettingsWindowController\",\n         showClose: false,\n         closeByEscape: true,\n         closeByDocument: true\n      });\n   };\n\n   $scope.showHelp = function() {\n      dialogService.predefined({\n         name: \"AboutWindow\", // dialog name\n         templateUrl: aboutDialogTemplate, // dialog template\n         className: \"about-window\", // CSS class\n         showClose: false, // do not show close button\n         closeByEscape: true, // allow escape to close window\n         closeByDocument: true // allow clicking on background to close\n      });\n   };\n\n   $scope.enterKeypress = function(evt, callback) {\n      if ($rootScope.isDialogServiceKeyPress === true) {\n         /**\n          * When dialog is closed, the focus could go back to header\n          * element. And at this time it is possible that user is still\n          * holding the key and then the the key up event is received.\n          * That's not what we want.\n          */\n         $rootScope.isDialogServiceKeyPress = false;\n         return;\n      }\n      if (!!evt && evt.keyCode === 13 &&\n         typeof callback === 'function') {\n         // Enter key is pressed.\n         callback();\n         // Prevent default behavior.\n         evt.preventDefault();\n      }\n   };\n\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/header-controller.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function HomeWarningCtrl($scope, utilService,\n         mainService, viewClientModel, storageService) {\n   $scope.init = function() {\n      let browserCompatible = utilService.isCompatibleBrowser(),\n         cookieEnabled = storageService.cookie.isEnabled(),\n         canvasSupported = utilService.hasCanvasAndContext();\n\n      $scope.helpLinkAddress = utilService.getLinkByType('helpPages');\n      $scope.MIN_VERSION = viewClientModel.MIN_VERSION;\n      // Name of the controller.\n      $scope.name = 'Warning';\n      // Set current controller.\n      mainService.currentController = this;\n      // The browser is compatible but the cookie is disabled, show\n      // cookie warning msg.\n      $scope.showCookieWarning = browserCompatible &&\n         canvasSupported && !cookieEnabled;\n      // Allow to use web client if cookie is enabled and canvas is\n      // supported.\n      $scope.continueAllowed = cookieEnabled && canvasSupported;\n      // Initialize view. Hide header and show strip.\n      $scope.initView();\n      // Display mobile layout on Android and Windows Phone.\n      $scope.isMobileBrowser = viewClientModel.mIsAndroid ||\n         viewClientModel.mIsWinMobile;\n      // Native client installer URL\n      $scope.nativeInstallerLink = viewClientModel.nativeInstallerLink;\n   };\n\n   $scope.cancel = function() {\n      window.location.href = viewClientModel.nativeInstallerLink;\n   };\n\n   $scope.goNext = function() {\n      mainService.show('Brokers');\n   };\n\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/homewarning-controller.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport angular from 'angular';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport $ from 'jquery';\n\nexport default function jscdkLauncherInvoker($window, viewClientModel,\n                                             connectionURIModel, userGlobalPref,\n                                             dpiService,\n                                             storageService,\n                                             connectionServerModel, constants) {\n   this.applicationSessionArray = [];\n   this.mainService = null;\n\n   this._invokeJSCDK = action => {\n      // TODO: Move to jscdkUIAdapter later\n      this.mainService.invokeJSCDK(action);\n   };\n\n   /**\n    * send last user active time of this local tab to timer-controller\n    * in JSCDK Invoke it recieving action from JSCDK in main-service/\n    * show()\n    */\n   this.sendLastUserActiveTimeToTimerCtrl = (actionTrigger,\n                                             lastUserActiveTime) => {\n      if (!angular.isNumber(lastUserActiveTime)) {\n         JSCDKLogger.warning('lastUserActiveTime is NOT a valid number!');\n         return;\n      }\n\n      let sendLastUserActiveTimeAction,\n         actionType = null;\n\n      switch (actionTrigger) {\n         case 'RequestLastUserActiveTime':\n            actionType = 'sendLastUserActiveTime';\n            break;\n         case 'AboutToTimeout':\n            actionType = 'syncWithTimer4AboutToTimeout';\n            break;\n         case 'Timeout':\n            actionType = 'syncWithTimer4Timeout';\n            break;\n         case 'showAboutToTimeoutDialogCallback':\n            actionType = 'showAboutToTimeoutDialogCallback';\n            break;\n         default:\n            JSCDKLogger.warning(\n               'unknown actionTrigger in' +\n               ' sendLastUserActiveTimeToTimerCtrl()');\n            return;\n      }\n\n      // send UI detected last user active time as default value\n      sendLastUserActiveTimeAction = {\n         method: 'TimerCtrl',\n         type: actionType,\n         lastUserActiveTime: lastUserActiveTime\n      };\n      this.mainService.invokeTimerCtrl(sendLastUserActiveTimeAction);\n   };\n\n   this.sendInitTimerXML = onlyEnableIntervalTimer => {\n      let initTimerAction;\n\n      initTimerAction = {\n         method: 'TimerCtrl',\n         type: 'InitTimer',\n         initType: 'Portal',\n         idleTimeout: connectionServerModel.idleTimeout,\n         userActivityInterval: connectionServerModel.userActivityXMLSendingInterval\n      };\n      if (onlyEnableIntervalTimer) {\n         initTimerAction.idleTimeout = -1;\n      }\n      this.mainService.invokeTimerCtrl(initTimerAction);\n   };\n\n   /**\n    * send do-unlock command\n    * Invoke it after recieving dolock success massage and triggered by\n    * user click ok in get-my-things-back dialog\n    */\n   this.sendDoUnlock = () => {\n      const sendDoUnlockAction = {\n         method: 'DoUnlock'\n      };\n      this._invokeJSCDK(sendDoUnlockAction);\n   };\n\n   /**\n    * Logoff desktop\n    *\n    * @param desktopId Desktop ID\n    */\n   this.logoffDesktop = desktopId => {\n      let logoffDesktopAction = {};\n      logoffDesktopAction.method = 'KillSession';\n      logoffDesktopAction.itemInfo = {\n         id: desktopId,\n         isDesktop: true\n      };\n      this._invokeJSCDK(logoffDesktopAction);\n   };\n\n   /**\n    * Reset all application sessions\n    * will send <kill-session> to the broker to kill the specified\n    * application session\n    *\n    * will be changed when refactory JSCDK to merge handler & XMLs\n    *\n    * the orignal idea is\n    */\n   this.resetAllApplicationSessions = () => {\n      let resetApplicationSessionAction = {};\n      resetApplicationSessionAction.method = 'KillSession';\n      resetApplicationSessionAction.killAllApplicationSessions = true;\n      this._invokeJSCDK(resetApplicationSessionAction);\n   };\n\n   /**\n    * Reset desktop\n    *\n    * @param desktopId Desktop ID\n    */\n   this.reset = desktopId => {\n      let resetDesktopAction = {};\n      resetDesktopAction.method = 'ResetDesktop';\n      resetDesktopAction.desktopId = desktopId;\n      this._invokeJSCDK(resetDesktopAction);\n   };\n\n   /**\n    * Restart desktop\n    *\n    * @param desktopId Desktop ID\n    */\n   this.restart = desktopId => {\n      let restartDesktopAction = {};\n      restartDesktopAction.method = 'RestartDesktop';\n      restartDesktopAction.desktopId = desktopId;\n      this._invokeJSCDK(restartDesktopAction);\n   };\n\n   /**\n    * Cancel the current JSCDK request, if one exists. This function is\n    * used to cancel things like authentication requests.\n    *\n    * @param doneAction[in] action to request after cancellation.\n    */\n   this.cancelCurrentRequest = doneAction => {\n      this._invokeJSCDK({\n         method: 'CancelCurrentRequest',\n         doneAction: doneAction\n      });\n   };\n\n   this.cancelAuthentication = () => {\n      this._invokeJSCDK({\n         method: 'CancelAuthentication'\n      });\n   };\n\n   // stop the idle timeout related timers in the jscdk\n   this.stopTimer = () => {\n      const stopTimerAction = {\n         method: 'TimerCtrl',\n         type: 'stopTimer'\n      };\n      this.mainService.invokeTimerCtrl(stopTimerAction);\n   };\n\n   // Logout the connection server.\n   this.logout = needClearURI => {\n      let logoutAction = {\n         method: 'LogoutFromBroker',\n         prefData: userGlobalPref.toFlatFormat()\n      };\n      // Clear session cookies.\n      storageService.cookie.clearSessionCookies();\n      // Reset server model.\n      connectionServerModel.reset();\n      // Clear URI model for normal logout.\n      if (needClearURI === false) {\n         logoutAction.needClearURI = false;\n      } else {\n         connectionURIModel.clear(false);\n         //need to close the tab when logged out or when try to do\n         // that?\n      }\n      this._invokeJSCDK(logoutAction);\n   };\n\n   /**\n    * Go back to server landing page.\n    * It will go to homeconnectctrl.\n    * For both webclient and Chromeclient, homeconnectctrl is\n    * used for connect to broker.\n    * For webclient, there is a cloud btn.\n    * For Chromeclient, there is no UI.\n    */\n   this.goServerLanding = () => {\n      this.mainService.show('Brokers');\n   };\n\n   this.setURI = () => {\n      let viewURIAction = {\n         method: 'SetViewURI',\n         queryString: $window.location.href,\n         brokerURL: $window.location.hostname\n      };\n\n      this._invokeJSCDK(viewURIAction);\n   };\n\n   /**\n    * Retrieve launchitemss of the current session.\n    * Invoke it when ALREADY_AUTHENTICATED.\n    */\n   this.retrieveLaunchItems = () => {\n      const getLaunchItemsAction = {\n         method: 'GetLaunchItems'\n      };\n      this._invokeJSCDK(getLaunchItemsAction);\n   };\n\n   this._findApplicationSession = function(application) {\n      let i,\n         applicationOriginId = application['origin-id'];\n\n      for (i = 0; i < this.applicationSessionArray.length; i++) {\n         if (applicationOriginId ===\n            this.applicationSessionArray[i]['origin-id']) {\n            return i;\n         }\n      }\n      return -1;\n   };\n\n   this.isApplicationConnected = function(application) {\n      let i = this._findApplicationSession(application);\n\n      return i !== -1 && this.applicationSessionArray[i].state ===\n         'connected';\n   };\n\n   /**\n    * Disconnect the application session if it's currently connected\n    * and the application's origin-id matches an application session's\n    * origin-id. The disconnection is needed to avoid bug 1369190 but\n    * and we only disconnect connected application sessions to avoid\n    * bug\n    * 1374799.\n    *\n    * @return true if this function disconnected an application\n    *    session, false if it did not.\n    */\n   this.disconnectApplication = application => {\n      if (!this.isApplicationConnected(application)) {\n         JSCDKLogger.debug('Application: ' + application.id +\n            ' does not have a corresponding application session.');\n         return;\n      }\n\n      let i = this._findApplicationSession(application);\n      this._invokeJSCDK({\n         method: 'DisconnectSession',\n         launchItemId: this.applicationSessionArray[i].id\n      });\n   };\n\n   /**\n    * this method should be moved to a service for better unit testing\n    * there's another connectToBroker method in util-service.  Should\n    * consider to combine both of the method\n    */\n   this.connectToBroker = () => {\n      let connectBrokerAction = {},\n         clientCommonInfo,\n         clientStats,\n         addClientCommonInfo,\n         addClientStats,\n         userAgent = navigator.userAgent,\n         isHandheldDevice = !!userAgent.match(\n            /(iPad)|(iPhone)|(iPod)|(android)|(IEMobile)|(webOS)/i),\n         matches,\n         browserName = 'unknown',\n         browserVersion,\n         browserArch = navigator.platform,\n         key;\n\n      // Connect To the Broker\n      connectBrokerAction.method = 'ConnectToBroker';\n      connectBrokerAction.address = connectionServerModel.host;\n      connectBrokerAction.supportedProtocols =\n         connectionServerModel.supportedProtocols;\n\n      //ignore ISO for now\n      if (!!connectionURIModel.isF5Session()) {\n         connectBrokerAction.mid = connectionURIModel.getF5postFix();\n      }\n\n      if (userAgent.toLowerCase().match(/(iphone|ipod|ipad)/i)) {\n         // Apple iOS6 introduced a new xml post bug where the browser\n         // would cache response if the request data did not change.\n         // Hack to make sure we always request a new url, by adding a\n         // timestamp whenever get an iOS browser\n         connectBrokerAction.urlParam = '?_ab=' + $.now();\n      }\n\n      // Match pattern like 'Chrome/26.0.1410.64' to retrieve browser\n      // name and version.\n      matches = userAgent.match(\n         /(opera|chrome|safari|firefox|msie|trident)\\/?\\s*(\\.?\\d+(\\.\\d+)*)/i);\n      if (!!matches) {\n         browserName = matches[1];\n         browserVersion = matches[2];\n      }\n\n      // For Microsoft Edge, the useragent is like:\n      // \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36\n      // (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36\n      // Edge/12.0\". Match pattern Edge, because there's a \"chrome\"\n      // string in it.\n      if (userAgent.toLowerCase().indexOf('edge')) {\n         matches = userAgent.match(/(edge)\\/?\\s*(\\.?\\d+(\\.\\d+)*)/i);\n         if (!!matches) {\n            browserName = matches[1];\n            browserVersion = matches[2];\n         }\n      }\n\n      if (browserName === 'Safari') {\n         // For Safari, the version is in 'Version/6.0.3'.\n         matches = userAgent.match(/version\\/([\\.\\d]+)/i);\n         if (!!matches) {\n            browserVersion = matches[1];\n         }\n      } else if (browserName === 'Trident') {\n         // For IE 11, the version is in 'rv:11.0'.\n         browserName = 'Internet Explorer';\n         matches = userAgent.match(/rv[:\\s]([\\w.]+)/i);\n         if (!!matches) {\n            browserVersion = matches[1];\n         }\n      }\n      // For Chromebook, detect browser-arch from userAgent text.\n      matches = userAgent.match(/cros\\s*[a-z0-9_\\.]*/i);\n      if (!!matches) {\n         browserArch = matches[0];\n      }\n\n      // Client common info\n      clientCommonInfo = {\n         // 'VMware'\n         'client-vendor': viewClientModel.vendor,\n         // 'VMware Horizon HTML Access'\n         'client-product': viewClientModel.product,\n         // View client version\n         'client-version': viewClientModel.version + '-' +\n         viewClientModel.buildNum,\n         // 'Chrome Apps'\n         'client-arch': viewClientModel.arch\n      };\n      // Client platform specific info\n      clientStats = {\n         // Browser info\n         'browser-user-agent': userAgent,\n         // Browser core\n         'browser-core': browserName,\n         // Browser version\n         'browser-version': browserVersion,\n         // System info\n         'browser-arch': browserArch,\n         // Is mobile device\n         'browser-is-handheld': isHandheldDevice ? 'true' : 'false'\n      };\n\n      addClientCommonInfo = {\n         'entity-type': 'CLIENT',\n         'data-type': 'configuration'\n      };\n\n      addClientStats = {\n         // the same with windows client\n         'entity-id': 'singleton'\n      };\n\n      connectBrokerAction.clientInfo = {\n         'clientCommonInfo': clientCommonInfo,\n         'clientStats': clientStats,\n         'addClientCommonInfo': addClientCommonInfo,\n         'addClientStats': addClientStats,\n      };\n\n      viewClientModel.onReady(()=>{\n         /**\n          * sync model into jscdk to init environment info for get-launch-item to\n          * support: https://jira-hzn.eng.vmware.com/browse/DPM-1211\n          * decouple from current _getEnvironmentInfo since they are different,\n          * and under current code structure better to be seperated.\n          */\n         let environmentInfo = {};\n\n         if (!!viewClientModel.ipAddress) {\n            environmentInfo['IP_Address'] =\n               viewClientModel.ipAddress;\n            environmentInfo['Machine_Name'] =\n               viewClientModel.machineName;\n         }\n         if (!!viewClientModel.clientID) {\n            environmentInfo['Client_ID'] = viewClientModel.clientID;\n         }\n         environmentInfo['Client_Version'] = viewClientModel.version + '-' +\n            viewClientModel.buildNum;\n         environmentInfo['Type'] = constants.viewclientType;\n         this._invokeJSCDK({\n            \"method\": \"SetEnvironmentInfo\",\n            \"data\": environmentInfo\n         });\n\n         this._invokeJSCDK(connectBrokerAction);\n      });\n   };\n\n   this.checkAuthenticationStatus = () => {\n      const authStatusCheckAction = {\n         method: 'GetAuthenticationStatus',\n         workForSilentMode: true\n      };\n\n      this._invokeJSCDK(authStatusCheckAction);\n   };\n\n   this.launchApplication = appInfo => {\n      let application = appInfo.application,\n         args = appInfo.args,\n         selectApplicationAction = {};\n\n      // connect to application\n      selectApplicationAction.method = 'ConnectToApplication';\n      /*\n       * launch application for the specific protocol\n       * currently, only BLAST is allowed.\n       */\n      selectApplicationAction.protocol =\n         connectionServerModel.connectionProtocol;\n      selectApplicationAction.applicationId = application.id;\n      selectApplicationAction.originId =\n         application['origin-id'];\n      selectApplicationAction.maximized = 'false';\n      selectApplicationAction.environmentInfo =\n         this._getEnvironmentInfo(false);\n\n      selectApplicationAction.preferences = {\n         applicationName: application.name,\n         resolution: {\n            'x': 0,\n            'y': 0,\n            'w': $(window).width(),\n            'h': $(window).height()\n         }\n      };\n      if (!!args) {\n         selectApplicationAction.launchParam = {\n            \"args\": args\n         };\n      }\n\n      selectApplicationAction.prefData =\n         userGlobalPref.toFlatFormat();\n      this._invokeJSCDK(selectApplicationAction);\n   };\n\n   this.launchDesktop = desktop => {\n      let selectDesktopAction = {},\n         ratio = 1;\n\n      selectDesktopAction.method = 'ConnectToDesktop';\n      /* launch desktop for the specific protocol\n       * currently, only BLAST is allowed.\n       */\n      selectDesktopAction.protocol =\n         connectionServerModel.connectionProtocol;\n      selectDesktopAction.desktopId = desktop.id;\n      selectDesktopAction.isShadow = desktop.isShadow;\n      if (!selectDesktopAction.isShadow) {\n         selectDesktopAction.environmentInfo =\n            this._getEnvironmentInfo(true);\n      }\n\n      selectDesktopAction.preferences = {\n         desktopName: desktop.name,\n         resolution: {\n            'x': 0,\n            'y': 0,\n            'w': $(window).width() * ratio,\n            'h': $(window).height() * ratio\n         }\n      };\n\n      selectDesktopAction.prefData =\n         userGlobalPref.toFlatFormat();\n      this._invokeJSCDK(selectDesktopAction);\n   };\n\n   this.acceptDisclaimer = () => {\n      const submitAuthInfoAction = {\n         method: 'SubmitAuthInfo',\n         type: 'Disclaimer'\n      };\n\n      this._invokeJSCDK(submitAuthInfoAction);\n   };\n\n   this.changePassword = (oldPassword, newPassword1,\n                          newPassword2) => {\n      const submitAuthInfoAction = {\n         method: 'SubmitAuthInfo',\n         type: 'WindowsPasswordExpired'\n      };\n      submitAuthInfoAction.oldPassword = oldPassword;\n      submitAuthInfoAction.newPassword1 = newPassword1;\n      submitAuthInfoAction.newPassword2 = newPassword2;\n\n      this._invokeJSCDK(submitAuthInfoAction);\n   };\n\n   this.submitUnauthenticated = username => {\n      const submitAuthInfoAction = {\n         method: 'SubmitAuthInfo',\n         type: 'Unauthenticated',\n         username: username\n      };\n\n      this._invokeJSCDK(submitAuthInfoAction);\n   };\n\n   this.submitWindowsPassword = (username, password,\n                                 domain, reAuth) => {\n      const submitAuthInfoAction = {\n         method: 'SubmitAuthInfo',\n         type: 'WindowsPassword',\n         username: username,\n         secret: password,\n         domain: domain\n      };\n      if (reAuth) {\n         submitAuthInfoAction.reAuth = true;\n      }\n\n      this._invokeJSCDK(submitAuthInfoAction);\n   };\n\n   this.submitSecurIDNextTokenCode = passcode => {\n      const submitAuthInfoAction = {\n         method: 'SubmitAuthInfo',\n         type: 'SecurIDNextTokenCode',\n         secret: passcode\n      };\n\n      this._invokeJSCDK(submitAuthInfoAction);\n   };\n\n   this.submitSecurIDPasscode = (username, passcode) => {\n      const submitAuthInfoAction = {\n         method: 'SubmitAuthInfo',\n         type: 'SecurIDPasscode',\n         username: username,\n         secret: passcode\n      };\n\n      this._invokeJSCDK(submitAuthInfoAction);\n   };\n\n   this.submitSecurIDPinChange = (pin1, pin2) => {\n      const submitAuthInfoAction = {\n         method: 'SubmitAuthInfo',\n         type: 'SecurIDPinChange',\n         pin1: pin1,\n         pin2: pin2\n      };\n\n      this._invokeJSCDK(submitAuthInfoAction);\n   };\n\n   this.submitSecurIDWait = () => {\n      const submitAuthInfoAction = {\n         method: 'SubmitAuthInfo',\n         type: 'SecurIDWait'\n      };\n\n      this._invokeJSCDK(submitAuthInfoAction);\n   };\n\n   this._getEnvironmentInfo = function(isDesktop) {\n      let environmentInfo = {};\n\n      if (!!viewClientModel.ipAddress) {\n         environmentInfo['IP_Address'] =\n            viewClientModel.ipAddress;\n         environmentInfo['Machine_Name'] =\n            viewClientModel.machineName;\n      }\n      if (!!viewClientModel.clientID) {\n         environmentInfo['Client_ID'] = viewClientModel.clientID;\n      }\n      if (!!viewClientModel.version) {\n         environmentInfo['Client_Version'] = viewClientModel.version + '-' +\n            viewClientModel.buildNum;\n      }\n      if (!!viewClientModel.windowsTimezone && isDesktop) {\n         environmentInfo['TZID'] =\n            viewClientModel.windowsTimezone;\n      }\n      environmentInfo['Type'] = constants.viewclientType;\n\n      environmentInfo['Displays.SystemDpi'] =\n         dpiService.getDPI();\n\n      return environmentInfo;\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/jscdk-launcher-invoker.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport {\n   globalArray,\n   jscdkClientSetUIController,\n   UIEventToJSCDK\n} from '../../jscdk/jscdkClient';\nimport JSCDKBrokerError from '../../jscdk/model/jscdkBrokerError';\nimport util from '../../jscdk/util';\nimport $ from 'jquery';\n\n\nexport default function mainService($rootScope,\n                                    utilService, $route,\n                                    dialogService, viewClientModel,\n                                    connectionURIModel,\n                                    _, viewService,\n                                    timeoutService,\n                                    userGlobalPref, brokerSessionStorageService,\n                                    viewCtrlService,\n                                    jscdkLauncherInvoker,\n                                    constants,\n                                    $window,\n                                    ws1Service) {\n   let COMANAGEMENT_ERROR = 'failed launching desktop: No co-management availability for protocol BLAST',\n      TUNNEL_ERROR = 'failed launching desktop: com.vmware.vdi.sessionclientapi.TunnelManager$TunnelManagerException',\n      PROTOCOL_ERROR = 'Please try connecting via another protocol or logoff the existing session first';\n\n   // Data got from JSCDK library.\n   this.data = null;\n   // View controller for the current workspace.\n   this.currentController = null;\n\n   // Initialize JSCDK library.\n   this.init = function() {\n      // Product version (e.g. 1.0-00000)\n      // if (!!VIEWCLIENT.clientVersion) {\n      //    viewClientModel.version = VIEWCLIENT.clientVersion;\n      // }\n      // Configure rebrand name to replace the title element\n      if (!!viewClientModel.rebrandName) {\n         utilService.rebrand(viewClientModel.rebrandName);\n      }\n\n      jscdkClientSetUIController(this);\n      //jscdkClientSetSessionStorage(window.sessionStorage); for replace\n      // the sso with session storage\n      jscdkLauncherInvoker.mainService = this;\n\n      //init lastUserActiveTime\n      timeoutService.bindUserActivity();\n   };\n   /**\n    * Call JSCDK lib.\n    *\n    * @param action [in] the action sent to JSCDK\n    */\n   this.invokeJSCDK = function(action) {\n      let actionString = JSON.stringify(action);\n\n      JSCDKLogger.debug(\n         'UI request to JSCDK : ' + util.censorMessage(actionString, 'JSON'));\n      // Clear data.\n      this.data = null;\n      UIEventToJSCDK(actionString);\n      // Change cursor to busy and disable buttons.\n      this.currentController.connecting();\n   };\n\n   /**\n    * Call timer controller in JSCDK lib.\n    *\n    * need this for chrome client, or this is no valid currentController\n    * for this.currentController.connecting(); and the truth that sending\n    * a request to timerCtrl should not change the UI in any way.\n    *\n    * @param action Object:\n    *     the action sent to timer controller\n    * @return nothing\n    */\n   this.invokeTimerCtrl = function(action) {\n      let actionString = JSON.stringify(action);\n\n      if (action.method !== 'TimerCtrl') {\n         JSCDKLogger.debug(\n            'invokeTimerCtrl must be used to send action with method = \\'TimerCtrl\\'\\nreturn');\n         return;\n      }\n      JSCDKLogger.debug('UI request to TimerCtrl : ' +\n         util.censorMessage(actionString, 'JSON'));\n      UIEventToJSCDK(actionString);\n   };\n\n   /**\n    * Switch page at JSCDK response.\n    *\n    * @param action [in] the action from JSCDK\n    */\n   this.responseToJSCDKEvent = function(action) {\n      let data = $.parseJSON(action),\n         content = data.content;\n\n      if (!data.ignoreData) {\n         this.data = data;\n      }\n\n      if (!content) {\n         JSCDKLogger.debug(\n            'JSCDK response to UI : ' + util.censorMessage(action, 'JSON'));\n      } else {\n         JSCDKLogger.debug('JSCDK response to UI : { name: ' + data.name +\n            ', content: ' +\n            util.censorMessage(JSON.stringify(content), 'JSON'));\n      }\n      this.show(data.name);\n   };\n\n   /**\n    * Check if the current controller is of mapping name.\n    *\n    * @param controller [in] view controller instance\n    * @param name       [in] mapping name registered\n    *                        in the controllers' dictionary\n    * @returns true if matched; false if not matched\n    */\n   this.isCurrentController = function(name) {\n      return this.currentController.name === name;\n   };\n\n   /**\n    * return whether the input UI change request is an authentication one\n    *\n    * 'WindowsPasswordExpired', 'Disclaimer', 'SecurIDNextTokenCode',\n    * 'SecurIDPinChange', 'SecurIDWait' must happen with either\n    * 'SecurIDPasscode' or 'WindowsPassword', so do not do the clear work\n    *\n    * the HWS case is not supported yet.\n    */\n   this.isNewAuthenticating = function(name, data) {\n      let i,\n         authenticationNameList = ['SecurIDPasscode'];\n      if (name === 'WindowsPassword' &&\n         !(data.content.usernameReadOnly === 'yes' &&\n         data.content.domainReadOnly === 'yes')) {\n         return true;\n      }\n      for (i = 0; i < authenticationNameList.length; i++) {\n         if (name === authenticationNameList[i]) {\n            return true;\n         }\n      }\n      return false;\n   };\n\n   /**\n    * Switch pages.\n    *\n    * @param name [in] mapping name registered\n    *                  in the controllers' dictionary\n    * @param obj  [in] initialization parameter\n    */\n   this.show = function(name) {\n      let okCallback = null,\n         favoriteHandler = null;\n\n      // Handler special cases.\n      switch (name) {\n         case 'ShowError':\n            // Enable current page.\n            this.currentController.enable();\n            // Show error dialog.\n            this.showError(this.data);\n            return;\n         case 'Timeout':\n            /**\n             * TODO: should hide or disable error dialog, current dialog\n             * is not support multi-thread\n             */\n            jscdkLauncherInvoker.sendLastUserActiveTimeToTimerCtrl(name,\n               timeoutService.getLastUserActivityTime());\n            return;\n         case 'RequestLastUserActiveTime':\n         case 'AboutToTimeout':\n            jscdkLauncherInvoker.sendLastUserActiveTimeToTimerCtrl(name,\n               timeoutService.getLastUserActivityTime());\n            return;\n         case 'showAboutToTimeoutDialog':\n            okCallback = function(currentController) {\n               jscdkLauncherInvoker.sendLastUserActiveTimeToTimerCtrl(\n                  'showAboutToTimeoutDialogCallback',\n                  timeoutService.getLastUserActivityTime());\n               currentController.enable();\n            };\n            let timeoutDialog = dialogService.error({\n               data: {\n                  title: _('dialog_title_about_to_timeout'),\n                  errorMessage: _('dialog_confirm_about_to_timeout')\n               },\n               controller: ['$scope', $scope => {\n                  $scope.close = () => {\n                     okCallback(this.currentController);\n                     timeoutDialog.close();\n                  };\n               }]\n            });\n            return;\n         case 'AlreadyLock':\n            // Logout broker if it is in anonymous mode\n            if (viewClientModel.isAnonymousMode) {\n               jscdkLauncherInvoker.logout();\n               return;\n            }\n            break;\n         case 'DoLock':\n            okCallback = function() {\n               jscdkLauncherInvoker.sendDoUnlock();\n            };\n            let doLockDialog = dialogService.error({\n               data: {\n                  title: _('dialog_title_locked'),\n                  errorMessage: _('dialog_confirm_locked')\n               },\n               controller: ['$scope', function($scope) {\n                  $scope.close = function() {\n                     okCallback();\n                     doLockDialog.close();\n                  };\n               }]\n            });\n            return;\n         case 'SessionUnlocked':\n            if (!!connectionURIModel.params) {\n               // URI connection reuses the previous session.\n               connectionURIModel.reuseSession = true;\n            }\n            // Already authenticated, navigate to the desktops or\n            // launchitems page and ensure the timer is started\n            if (util.brokerSupportApplication()) {\n               timeoutService.initTimers();\n            }\n            jscdkLauncherInvoker.retrieveLaunchItems();\n            return;\n         case 'LockedNewTab': // open a new tab and found it locked\n            if (!!connectionURIModel.params) {\n               // URI connection reuses the previous session.\n               connectionURIModel.reuseSession = true;\n            }\n            timeoutService.initIntervalTimer();\n            jscdkLauncherInvoker.sendDoUnlock();\n            return;\n         // two cases for user act in the select page in slient mode\n         case 'AuthenticationStatusLocked': // found locked, when try to launch a desktop\n            jscdkLauncherInvoker.sendDoUnlock();\n            return;\n         case 'AuthenticationStatusUnlocked':\n            if (!utilService.authenticationStatusCheck.isLaunchAction()) {\n               this.currentController.enable();\n            }\n            utilService.authenticationStatusCheck.doAction(\n               this.currentController);\n            return;\n         // this case try to disconnect first\n         case 'ApplicationAlreadyConnected':\n            jscdkLauncherInvoker.disconnectApplication(\n               this.currentController.currentApplication);\n            return;\n         /**\n          * As disconnectsession is only use in this case, if there're\n          * other cases add a flag. The DisconnectionSessionfailed is\n          * needed to avoid bug 1374808. Ignore the disconnect error and\n          * launch the application anyway.\n          */\n         case 'DisconnectSession':\n         case 'DisconnectSessionFailed':\n            if (this.currentController.name === 'GetLaunchItems') {\n               this.currentController.ajaxBusy = false;\n               this.currentController.launchApplication(\n                  this.currentController.currentApplication,\n                  this.currentController.focusElement,\n                  this.currentController.bufferedArgs);\n               this.currentController.bufferedArgs = null;\n            } else {\n               JSCDKLogger.debug('Not in the launchitems page.');\n            }\n            return;\n         case 'GetUserGlobalPref':\n            favoriteHandler =\n               globalArray['get-user-global-preferences'];\n            userGlobalPref.setPrefData(favoriteHandler.prefData);\n            if (!!this.data && !!this.data.content) {\n               if (!!this.data.content.applications) {\n                  favoriteHandler.markFavorite(\n                     this.data.content.applications);\n               }\n               if (!!this.data.content.desktops) {\n                  favoriteHandler.markFavorite(\n                     this.data.content.desktops);\n               }\n            }\n            return;\n         case 'SetUserGlobalPref':\n            userGlobalPref.onDataSent();\n            return;\n         case 'Brokers': // clear preference data when logout\n            userGlobalPref.clearPrefData();\n            break;\n         case 'KillAllApplicationSessions':\n            this.currentController.enable();\n            $rootScope.applicationCanSet = false;\n            return;\n         case 'CertAuth':\n            // Certificate authentication.\n            $rootScope.certAuth = true;\n            return;\n      }\n\n      if (!!this.data && !!this.data.content &&\n         !!this.data.content.clientConfig) {\n         utilService.updateClientConfig(this.data.content.clientConfig);\n      }\n\n      // clear brokerSessionStorage for previous broker session exist no\n      // more\n      if (this.isNewAuthenticating(name, this.data)) {\n         brokerSessionStorageService.clear();\n         viewClientModel.isAnonymousMode = false;\n         $rootScope.showPreference = true;\n         if (utilService.supportLocalStorage()) {\n            window.localStorage.removeItem(constants.CLIENT_LOGIN_KEY);\n         }\n      }\n\n      // Reset certAuth flag to false.\n      if ($rootScope.certAuth) {\n         $rootScope.certAuth = false;\n      }\n\n      if (this.isCurrentController(name)) {\n         // Enable current page.\n         this.currentController.enable(name, this.data);\n         // Refresh current page.\n         this.currentController.init();\n      } else {\n         // Tear down the current page.\n         this.currentController.tearDown();\n\n         viewService.switchView({\n            action: name,\n            controller: this.currentController,\n            data: this.data\n         });\n      }\n   };\n\n   this.getOKCallbackOnBrokerError = (callbackFunc, callbackParams) => {\n         return () => {\n            utilService.runFunctionIfNotHWSOrF5.call(this, callbackFunc,\n               callbackParams);\n         };\n      };\n\n   /**\n    * Handle error response from the connection server.\n    *\n    */\n   this.showError = data => {\n      let errorType,\n         userMsg,\n         errorMsg,\n         okCallback = null;\n\n      if (!!data && !!data.content) {\n         errorType = data.content.errorType;\n         userMsg = data.content.errorText;\n         errorMsg = data.content.errorMessage;\n\n         if (errorType ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_ALREADY_AUTHENTICATED) {\n            if (!!data.content.workspaceOneServerHostname &&\n               !ws1Service.isLaunchedFromWS1()) {\n               // Invalid session, handle off to WS1\n               ws1Service\n                  .redirectToWS1(data.content.workspaceOneServerHostname,\n                     $window);\n               return;\n            }\n\n            if (!!connectionURIModel.params) {\n               // URI connection reuses the previous session.\n               connectionURIModel.reuseSession = true;\n            }\n            // Already authenticated, navigate to the desktops or\n            // launchitems page and ensure the timer is started\n            if (util.brokerSupportApplication()) {\n               timeoutService.initTimers();\n            }\n            jscdkLauncherInvoker.retrieveLaunchItems();\n            return;\n         }\n\n         if (errorType ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_AUTHENTICATION_FAILED) {\n            // Check if invalid workspace one mode first\n            if (!!data.content.workspaceOneServerHostname) {\n               // Invalid session, handle off to WS1\n               ws1Service\n                  .redirectToWS1(data.content.workspaceOneServerHostname,\n                     $window);\n               return;\n            }\n\n            if ($rootScope.certAuth) {\n               // Certificate authentication failed. Press OK, go back to\n               // portal page.\n               okCallback =\n                  this.getOKCallbackOnBrokerError(viewService.gotoPortal);\n            } else {\n               // Press OK, close the error dialog and navigate back to\n               // the home page.\n               okCallback =\n                  this.getOKCallbackOnBrokerError.call(utilService,\n                     jscdkLauncherInvoker.goServerLanding);\n            }\n         } else if (errorType ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_TIMEOUT) {\n            // Press OK, close the error dialog and navigate back to the\n            // home page.\n            okCallback = this.getOKCallbackOnBrokerError.call(utilService,\n               jscdkLauncherInvoker.goServerLanding);\n         } else if (errorType ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_NOT_ENTITLED) {\n            /**\n             * Not an entitled user to the item. need to update the UI.\n             * Refresh the select page with the newest data\n             */\n            okCallback = this.getOKCallbackOnBrokerError.call(utilService,\n               function() {\n                  if (util.brokerSupportApplication()) {\n                     timeoutService.initTimers();\n                  }\n                  jscdkLauncherInvoker.retrieveLaunchItems();\n               });\n         } else if (errorType ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_DESKTOPS_ERROR ||\n            errorType ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_LAUNCH_ITEMS_ERROR ||\n            errorType ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_TUNNEL_ERROR) {\n            /**\n             * Not able to show the select page. Needs to go back and\n             * login with another username. Logout the broker.\n             */\n            okCallback = this.getOKCallbackOnBrokerError.call(utilService,\n               jscdkLauncherInvoker.logout);\n         } else if (errorType ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_NOT_AUTHENTICATED) {\n            // clear brokerSessionStorage for broker session exist no more\n            brokerSessionStorageService.clear();\n            if (utilService.supportLocalStorage()) {\n               window.localStorage.removeItem(constants.CLIENT_LOGIN_KEY);\n            }\n            userMsg = _('error_not_authenticated');\n            // Press OK, close the error dialog and navigate back to the\n            // home page.\n            okCallback = this.getOKCallbackOnBrokerError.call(utilService,\n               jscdkLauncherInvoker.goServerLanding);\n         } else if (errorType ===\n            JSCDKBrokerError.JSCDK_BROKER_ERROR_DESKTOP_LAUNCH_ERROR) {\n            // When tunnel connection hasn't been established\n            // successfully, if Blast Secure Gateway is turned on, a 'No\n            // co-management error' is returned; otherwise, a\n            // 'TunnelManagerException' error is returned.\n            if (errorMsg.indexOf(COMANAGEMENT_ERROR) >= 0 ||\n               errorMsg.indexOf(TUNNEL_ERROR) >= 0) {\n               // Probably caused by the tunnel connection problem.\n               userMsg = _('error_no_comanagement');\n               okCallback =\n                  this.getOKCallbackOnBrokerError.call(utilService,\n                     jscdkLauncherInvoker.logout);\n            } else {\n               okCallback =\n                  this.getOKCallbackOnBrokerError.call(utilService);\n            }\n\n            if (userMsg.indexOf(PROTOCOL_ERROR) >= 0 &&\n               this.currentController.currentDesktop) {\n               // if the desktop need to logoff first, show confirm\n               // dialog instead of error dialog.\n               utilService.logOffConfirmation(\n                  this.currentController.currentDesktop);\n               return;\n            }\n\n         } else if (errorType === 'JSCDK_ERROR_LOGOFF_POOL_FAILED') {\n            // Desktop is disabled before user logs off\n            okCallback = this.getOKCallbackOnBrokerError.call(utilService,\n               jscdkLauncherInvoker.goServerLanding);\n         } else if (errorType === 'CONNECT_TO_BROKER_ERROR') {\n            // back to sever selector page when connection to broker fails\n            okCallback =\n               this.getOKCallbackOnBrokerError(viewService.gotoPortal);\n         }\n\n         // Show error dialog.\n         let dialog = dialogService.error({\n            data: {\n               title: _('ERROR'),\n               errorMessage: userMsg\n            },\n            closeByEscape: false,\n            closeByDocument: false,\n            controller: ['$scope', function($scope) {\n               $scope.close = function() {\n                  if (typeof okCallback === 'function') {\n                     okCallback();\n                  }\n                  dialog.close();\n               };\n            }]\n         });\n\n      } else {\n         // Refresh current page.\n         $route.reload();\n      }\n   };\n\n   this.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/main-service.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n/**\n * @fileoverview tabsync-service.js -- tabSyncService\n * This service will send and listen to storage sync event on the IE\n * with version below or equal to 11, and will close the host tab if\n * information is processed by other tabs.\n */\n\nexport default function tabSyncService($window, utilService) {\n   /**\n    * @this tabSyncService\n    * @param  {object} event The browser event triggered by changes in\n    *    other tab\n    */\n   let onStorageChange = function(event) {\n      let message,\n         eventKey = this.eventKey;\n\n      if (event.key === eventKey) {\n         message = JSON.parse(event.newValue);\n         if (message.origin === 'oldTab' && message.data === 'Merged') {\n            $window.opener = null;\n            $window.open(\"\", \"_self\");\n            $window.close();\n         }\n      }\n   };\n\n   /**\n    * init function used to set the url informations, will add response\n    * listener and send out a event right away if all params are valid.\n    * works only for IE with version below 11 which not support\n    * postMessage well.\n    * @param  {object} uriInfo         The object contains info about uri\n    * @param  {string} brokerAddress   The current broker address\n    * @param  {object} localStorageObj The localStorageObject use for\n    *    Unit Testing\n    */\n   this.init = function(uriInfo, brokerAddress, localStorageObj) {\n      let itemType,\n         itemId,\n         horizonId,\n         userName,\n         domainName;\n\n      if (utilService.supportPostMessage() || this.inited || !uriInfo) {\n         return;\n      }\n      horizonId = uriInfo.horizonId;\n      userName = encodeURIComponent(uriInfo.userName);\n      domainName = uriInfo.domainName;\n      if (!!uriInfo.desktopId) {\n         itemType = 'Desktop';\n         itemId = encodeURIComponent(uriInfo.desktopId);\n      } else if (!!uriInfo.applicationId) {\n         itemType = 'Application';\n         itemId = encodeURIComponent(uriInfo.applicationId);\n      }\n      if (!localStorageObj) {\n         localStorageObj = $window.localStorage;\n      }\n      if (!!horizonId && !!userName && !!domainName && !!itemType &&\n         !!itemId && !!localStorageObj) {\n         $window.addEventListener(\"storage\", onStorageChange.bind(this),\n            false);\n\n         this.eventKey = \"HWS_BKA_\" + brokerAddress;\n         localStorageObj.setItem(this.eventKey, JSON.stringify({\n            origin: 'newTab',\n            data: {\n               horizonId: horizonId,\n               userName: userName,\n               domainName: domainName,\n               itemType: itemType,\n               itemId: itemId\n            }\n         }));\n         this.inited = true;\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/tabsync-service.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport $ from 'jquery';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\nexport default function timeoutService($window, connectionServerModel,\n                                       storageService,\n                                       jscdkLauncherInvoker) {\n   let userActivityTime = 0;\n\n   this.setUserActivityTime = function() {\n      userActivityTime = new Date().getTime();\n   };\n\n   this.getLastUserActivityTime = function() {\n      return userActivityTime;\n   };\n\n   this.bindUserActivity = () => {\n      this.setUserActivityTime();\n      // Listen to all the events for tracking user activity.\n      $(document).bind(\n         'mousemove.useractivity mousedown.useractivity mouseup.useractivity',\n         this.setUserActivityTime);\n      $(document).bind('keydown.useractivity keyup.useractivity',\n         this.setUserActivityTime);\n      $(document).bind(\n         'touchstart.useractivity touchmove.useractivity touchend.useractivity',\n         this.setUserActivityTime);\n      $(document)\n         .bind('orientationchange.useractivity', this.setUserActivityTime);\n      $(document)\n         .bind('extendedmonitoruse.useractivity', this.setUserActivityTime);\n      $(document)\n         .bind('primarymonitoruse.useractivity', this.setUserActivityTime);\n   };\n\n   this._readTimerFromCookieToConnectionServerModel = function() {\n      let idleTimeout,\n         userActivityXMLSendingInterval;\n\n      // Current idleTimeout value\n      idleTimeout = connectionServerModel.idleTimeout;\n      if (!idleTimeout) {\n         // Read idleTimeout from cookie\n         idleTimeout = storageService.cookie.read(\n            storageService.cookie.COOKIE_IDLE_TIMEOUT);\n         if (!idleTimeout) {\n            JSCDKLogger.debug(\n               'error: idleTimeout don\\'t exist in the cookie');\n         }\n         // Cache idleTimeout in the server model.\n         connectionServerModel.idleTimeout = idleTimeout;\n      } else {\n         JSCDKLogger.debug(\n            'warning: idleTimeout already exist in the connectionServerModel');\n      }\n      // Current user-activity-interval value\n      userActivityXMLSendingInterval =\n         connectionServerModel.userActivityXMLSendingInterval;\n      if (!userActivityXMLSendingInterval) {\n         // Read user-activity-interval value from cookie\n         userActivityXMLSendingInterval = storageService.cookie.read(\n            storageService.cookie.COOKIE_SEND_TIME_INTERVAL);\n         if (!userActivityXMLSendingInterval) {\n            JSCDKLogger.debug(\n               'error: userActivityXMLSendingInterval don\\'t exist in the cookie');\n         }\n         // Cache user-activity-interval value in the server model.\n         connectionServerModel.userActivityXMLSendingInterval =\n            userActivityXMLSendingInterval;\n      } else {\n         JSCDKLogger.debug(\n            'warning: userActivityXMLSendingInterval already exist in the connectionServerModel');\n      }\n   };\n\n   // name the interface with clear name instead of flag\n   this.initTimers = function() {\n      this._readTimerFromCookieToConnectionServerModel();\n      jscdkLauncherInvoker.sendInitTimerXML();\n   };\n\n   this.initIntervalTimer = function() {\n      this._readTimerFromCookieToConnectionServerModel();\n      jscdkLauncherInvoker.sendInitTimerXML(true);\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/timeout-service.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport util from '../../jscdk/util';\n\nexport default function utilService(connectionURIModel, _, dialogService,\n                                    localize,\n                                    brokerSessionStorageService,\n                                    viewClientModel,\n                                    jscdkLauncherInvoker, $window) {\n   /**\n    * The desktop is open on the server but it is running a different\n    * protocol, press OK to log off the current session.\n    *\n    */\n   this.logOffConfirmation = function(desktop) {\n      let dialog = dialogService.confirm({\n         data: {\n            title: _('dialog_title_logoff_retry'),\n            message: _('dialog_confirm_logoff_retry')\n         },\n         controller: ['$scope', function($scope) {\n            $scope.confirm = function() {\n               jscdkLauncherInvoker.logoffDesktop(desktop.id);\n               dialog.close();\n            };\n         }]\n      });\n   };\n\n   // Case insensitive string compare.\n   this.ignoreCaseEquals = function(str1, str2) {\n      if (!str1 || !str2) {\n         return false;\n      }\n\n      return str1.toLowerCase() === str2.toLowerCase();\n   };\n\n   // Rebrand page title\n   this.rebrand = function(rebrandName) {\n      $window.document.title = rebrandName;\n   };\n\n   // Detect whether the browser supports sessionStorage.\n   this.isSessionStorageAllowed = function() {\n      try {\n         $window.sessionStorage.setItem('closeOnExit', false);\n         return true;\n      } catch (e) {\n         JSCDKLogger.error(\n            'This browser does not support sessionStorage. ' + e);\n         return false;\n      }\n   };\n\n   // Detect if it's a WebKit browser.\n   this.isWebKitBrowser = function() {\n      return (/AppleWebKit/).test(navigator.userAgent);\n   };\n\n   // Get link by its type\n   this.getLinkByType = function(type) {\n      let locale = localize.getLocale(),\n         map = viewClientModel.linkModel[type];\n\n      if (map.hasOwnProperty(locale)) {\n         return map[locale];\n      }\n\n      return map.en;\n   };\n\n   this.showLogoutDialog = function() {\n      let dialog = dialogService.confirm({\n         data: {\n            title: _('dialog_title_logout'),\n            message: _('dialog_confirm_logout')\n         },\n         controller: ['$scope', function($scope) {\n            $scope.confirm = function() {\n               jscdkLauncherInvoker.logout();\n               dialog.close();\n            };\n         }],\n         closeByDocument: false\n      });\n   };\n\n\n   // Get query string from model\n   this.getQueryStringFromModel = function(model) {\n      let queryString = 'https://' + model.host + '?',\n         keys;\n\n      for (keys in model) {\n         if (model.hasOwnProperty(keys) && keys !== 'host') {\n            queryString += keys + '=' + model[keys] + '&';\n         }\n      }\n      return queryString.substring(0, queryString.length - 1);\n   };\n\n   // Get largest icon from icons\n   this.getLargestIcon = function(icons) {\n      let iconsLength = Object.keys(icons).length,\n         i,\n         largeFlag = 0;\n\n      for (i = 0; i < iconsLength; i++) {\n         if (parseInt(icons[i].height, 10) >\n            parseInt(icons[largeFlag].height, 10)) {\n            largeFlag = i;\n         }\n      }\n      return largeFlag;\n   };\n\n   /* in silent mode, when user want to do action in the selector page,\n    * the authentication status must be checked before allow user do it\n    *\n    * this handler can only record one request at a time, but ajaxBusy\n    * will force user send most one request at a time.\n    */\n   this.authenticationStatusCheck = (function() {\n      let callbackFunc = null,\n         callbackParams = null,\n         action = null,\n         itemType = null;\n\n      return {\n         callBackWhenUnlocked: function(callbackFunction,\n                                        callbackParameters,\n                                        actionName, targetItemType) {\n            callbackFunc = callbackFunction;\n            callbackParams = callbackParameters;\n            action = actionName;\n            itemType = targetItemType;\n\n            jscdkLauncherInvoker.checkAuthenticationStatus();\n         },\n\n         clearAction: function() {\n            callbackFunc = null;\n            callbackParams = null;\n            action = null;\n            itemType = null;\n         },\n\n         doAction: function(scope) {\n            if (typeof callbackFunc === 'function') {\n               callbackFunc.call(scope, callbackParams);\n               this.clearAction();\n            }\n         },\n\n         popAction: function(scope) {\n            let result = {\n               item: callbackParams,\n               action: action,\n               itemType: itemType\n            };\n            /**\n             * launch item without valid check, act same as always stay in\n             * select page. by adding this will provide a better animation\n             * effect after finishing re-auth.\n             */\n            if (action === 'start-session' ||\n               (action === 'reset-all' && itemType === 'application')) {\n               this.doAction(scope);\n               return null;\n            }\n            if (typeof callbackFunc === 'function') {\n               this.clearAction();\n            }\n            return result;\n         },\n\n         isLaunchAction: function() {\n            return (action === 'start-session');\n         }\n      };\n\n   }());\n\n   /**\n    * hasCanvasAndContext\n    *\n    *    Tests if the browser supports the use of <canvas> elements\n    * properly with the ability to retrieve its draw context.\n    *\n    * @return Boolean. true if the browser supports HTML5 canvas; false\n    *    otherwise.\n    */\n   this.hasCanvasAndContext = function() {\n      try {\n         let canvas = $window.document.createElement('canvas');\n         let result = !!canvas.getContext; // convert to Boolean, invert\n                                           // again.\n         canvas = null; // was never added to DOM, don't need to remove\n         return result;\n      } catch (e) {\n         return false;\n      }\n   };\n\n   /**\n    * runFunctionIfNotHWSOrF5\n    *\n    * Handle callback function according to runtime\n    * If in HWSession/ F5 instead of normal session, window should be\n    * closed directly, or run the callback function\n    */\n   this.runFunctionIfNotHWSOrF5 = function(callbackFunc, callbackParams) {\n      if (connectionURIModel.isHWSession() ||\n         connectionURIModel.isF5Session()) {\n         // NOTE: This won't work in any modern browser when the window\n         // is not opened via script / ahref.\n         $window.open('', '_self', '');\n         $window.close();\n         return;\n      }\n\n      let self = this;\n      if (typeof callbackFunc === 'function') {\n         callbackFunc.call(self, callbackParams);\n      } else {\n         JSCDKLogger.info('Param callbackFunc is not a function.');\n      }\n   };\n\n   /**\n    * isCompatibleBrowser\n    *\n    *    Verifies the version of the browser and check if it's supported.\n    *\n    * @return Boolean. true if the browser is supported; false otherwise.\n    */\n   this.isCompatibleBrowser = function() {\n      // Add Android support first\n      if (viewClientModel.mIsWinMobile) {\n         return false;\n      } else if (viewClientModel.mIsAndroid) {\n         return viewClientModel.mIsChrome &&\n            viewClientModel.mVersionChrome >=\n            viewClientModel.MIN_VERSION.Chrome;\n      } else if (viewClientModel.mIsIOS) {\n         return viewClientModel.mIsIOSSafari;\n      } else {\n         return (viewClientModel.mIsIE &&\n            viewClientModel.mVersionIE >=\n            viewClientModel.MIN_VERSION.IE) ||\n            (viewClientModel.mIsChrome &&\n            viewClientModel.mVersionChrome >=\n            viewClientModel.MIN_VERSION.Chrome) ||\n            (viewClientModel.mIsGecko &&\n            viewClientModel.mVersionGecko >=\n            viewClientModel.MIN_VERSION.Gecko) ||\n            (viewClientModel.mIsWebKit &&\n            viewClientModel.mVersionWebKit >=\n            viewClientModel.MIN_VERSION.WebKit);\n      }\n   };\n\n   /**\n    * @return This returns whether the host browser is supporting\n    *    postMessage API well\n    */\n   this.supportPostMessage = function() {\n      return !(viewClientModel.mIsIE && viewClientModel.mVersionIE <= 11);\n   };\n\n   /**\n    * position\n    *\n    *    Returns the position of the element.\n    *\n    * @param jQuery element\n    * @return position of the element.\n    */\n   this.position = function(elem) {\n      return elem.position();\n   };\n\n   /**\n    * isHidden\n    *\n    *    Check whether an element is hidden.\n    *\n    * @param jQuery element.\n    * @return it is hidden or not.\n    */\n   this.isHidden = function(elem) {\n      return elem.is(':hidden');\n   };\n\n   this.isVADC = function() {\n      return util.getUrlParam($window.location.href.toLowerCase(), 'vadc') !==\n         null;\n   };\n\n   this.updateClientConfig = function(clientConfig) {\n      if (!clientConfig) {\n         return;\n      }\n\n      /**\n       * Store the value after authentication, otherwise they could be\n       * deleted.\n       */\n      if (typeof clientConfig['clientHideDomainList'] !== 'undefined') {\n         viewClientModel.clientHideDomainList =\n            clientConfig['clientHideDomainList'];\n      }\n      if (typeof clientConfig['clientHideServerInformation'] !==\n         'undefined') {\n         viewClientModel.clientHideServerInformation =\n            clientConfig['clientHideServerInformation'];\n      }\n      if (typeof clientConfig['enableCredentialCleanupForHTMLAccess'] !==\n         'undefined') {\n         viewClientModel.credentialCleanup =\n            clientConfig['enableCredentialCleanupForHTMLAccess'];\n      }\n   };\n\n   this.storeClientConfig = function() {\n      /**\n       * Store the values in items-controller.js\n       * NOTE: the values should be the same with baseviewclient-model.js\n       */\n      brokerSessionStorageService.write('clientHideDomainList',\n         viewClientModel.clientHideDomainList);\n      brokerSessionStorageService.write('clientHideServerInformation',\n         viewClientModel.clientHideServerInformation);\n      brokerSessionStorageService.write('credentialCleanup',\n         viewClientModel.credentialCleanup);\n   };\n\n   this.supportLocalStorage = function() {\n      try {\n         $window.localStorage.setItem('testKey', 'foobar');\n         $window.localStorage.removeItem('testKey');\n         return true;\n      } catch (err) {\n         return false;\n      }\n   };\n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/util-service.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport function equalToDirective() {\n   return {\n      require: 'ngModel',\n      link: function(scope, elem, attrs, ctrl) {\n         function checkEquals(changedTagValue) {\n            let currentTagValue = ctrl.$viewValue;\n            let anotherTagValue = attrs.equalTo;\n            // set validity\n            ctrl.$setValidity('equalTo',\n               currentTagValue === anotherTagValue);\n            return currentTagValue;\n         }\n\n         // watch own value and re-validate on change\n         ctrl.$parsers.unshift(checkEquals);\n         attrs.$observe('equalTo', checkEquals);\n      }\n   };\n}\n\nexport function serverNameDirective() {\n   return {\n      require: 'ngModel',\n      link: function(scope, elem, attrs, ctrl) {\n         function checkForProtocol(val) {\n            if (!val ||\n               (!!val &&\n               val.match(/^(https:\\/\\/)?([a-z0-9\\-\\.:\\[\\]])+$/i))) {\n               // Protocol must be https. Host name only contains\n               // characters, numbers, -, :, [ or ].\n               ctrl.$setValidity('serverName', true);\n               return val;\n            }\n\n            // set validity\n            ctrl.$setValidity('serverName', false);\n         }\n\n         // watch own value and re-validate on change\n         ctrl.$parsers.unshift(checkForProtocol);\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/validate-directive.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport angular from 'angular';\n\nexport default function viewService($location, $timeout,\n                                    utilService, connectionURIModel,\n                                    tabSyncService,\n                                    baseViewService,\n                                    URIParamValidator, dialogService,\n                                    jscdkLauncherInvoker,\n                                    _,\n                                    constants, ws1Service) {\n   // View controllers' dictionary.\n   this.map = {\n      Start: '/home',\n      WindowsPasswordExpired: '/changepassword',\n      SecurIDNextTokenCode: '/securidnexttoken',\n      SecurIDPinChange: '/securidpinchange',\n      SecurIDWait: '/securidwait',\n      GetLaunchItems: '/launchitems',\n      ShowAppBlastDesktop: '/blastdesktop',\n      ShowAppBlastApplication: '/blastdesktop',\n      Warning: '/warning',\n      Portal: () => {\n         this.gotoPortal();\n      },\n      Logout: () => {\n         if (utilService.supportLocalStorage()) {\n            window.localStorage.removeItem(constants.CLIENT_LOGIN_KEY);\n         }\n         let logoutToPortal = this.logoutToPortal;\n         if (logoutToPortal && !utilService.isVADC()) {\n            this.gotoPortal(); // default behavior\n         } else {\n            this.logoutToPortal = true; // reset the stupid flag\n            $timeout(function() {\n               utilService.authenticationStatusCheck.clearAction();\n               baseViewService.changeLocation('/home');\n            });\n         }\n      },\n      Brokers: param => {\n         this.connectToBroker(param.data);\n      },\n      SecurIDPasscode: param => {\n         this.gotoStart(param);\n      },\n      WindowsPassword: param => {\n         this.gotoStart(param);\n      },\n      Disclaimer: param => {\n         this.gotoStart(param);\n      },\n      Unauthenticated: param => {\n         this.gotoStart(param);\n      }\n   };\n\n   /**\n    * It's terrible to use a flag, however this is the only way doing it at the\n    * time For logout behavior, normally when a user logs out, it goes to\n    * portal.  However, if user A already logged in, user B uses URI to launch\n    * a desktop in the same browser instance.  We need B to confirm if logs out\n    * user A.  In this case, it goes to login page, not portal.  The root cause\n    * of adding this flag is, as of now, when sending logout command to broker,\n    * main service gets the response.\n    * (the truth is whatever it is sending or who ever is sending, main service\n    * gets the respnose).  The 'show' method of main service is invoked with\n    * 'logout' passed.  However, main service does not know which case it is\n    * (normal logout or another user is acting this behavior). That's why a\n    * flag is required when user logs out to indicate which page is goes to. We\n    * need to let the caller of jscdk to get the response instead of main\n    * service.\n    */\n   this.logoutToPortal = true;\n\n   this.gotoStart = function(param) {\n      /** if current controller name or its parent name is not start,\n       ** change location to show the page.\n       */\n      if (param.controller.isAuthenticating()) {\n         param.controller.enable(param.action, param.data);\n      } else {\n         baseViewService.changeLocation('/home');\n      }\n   };\n\n   this.gotoPortal = function() {\n      baseViewService.gotoPortal();\n   };\n\n   this.connectToBroker = data => {\n      if (!!data && !!data.params) {\n         // Store URI parameters.\n         connectionURIModel.params = data.params;\n         tabSyncService.init(connectionURIModel.params, $location.host());\n\n         // Validate the URI params\n         if (!URIParamValidator.isValid(connectionURIModel.params)) {\n            let dialog = dialogService.error({\n               data: {\n                  title: _('ERROR'),\n                  errorMessage: _('LOGIN_URI_PARAMS')\n               },\n               controller: ['$scope', $scope => {\n                  $scope.close = () => {\n                     this.gotoPortal();\n                     dialog.close();\n                  };\n               }]\n            });\n            return;\n         }\n      }\n\n      // If spID exist in URI, update it to local storage\n      let spID = connectionURIModel.getSpID();\n      if (!!spID) {\n         ws1Service.storeSpId(spID);\n      }\n\n      // cancel previous user launch/reset/logoff trial\n      utilService.authenticationStatusCheck.clearAction();\n\n      jscdkLauncherInvoker.connectToBroker();\n   };\n\n   /** switch view according to the map,\n    ** param include action name and current controller's message.\n    */\n   this.switchView = function(param) {\n      let value;\n      if (!!param.action && this.map.hasOwnProperty(param.action)) {\n         value = this.map[param.action];\n         if (angular.isFunction(value)) {\n            value(param);\n         } else {\n            // it's path name\n            $timeout(function() {\n               baseViewService.locationChange = true;\n               $location.path(value);\n            });\n         }\n      } else {\n         param.controller.enable(param.action, param.data);\n      }\n   };\n\n   this.goBlastPage = function() {\n      // TODO wait for html5 mode change\n      baseViewService.changeLocation('/desktop');\n   };\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/view-service.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function viewCtrlService($rootScope, $timeout) {\n   // Header buttons visibility\n   $rootScope.header = {\n      hide: true,\n      logout: false,\n      home: false,\n      add: true,\n      log: false,\n      striphide: false\n   };\n\n   // Footer visibility\n   $rootScope.footer = {\n      protocolRegister: false\n   };\n\n   // Exit button control\n   $rootScope.exit = {\n      sendLogoff: false,\n      isExit: false\n   };\n\n   $rootScope.initView = function(hideHeader, hideStrip) {\n      if (typeof hideHeader === 'undefined') {\n         // Hide header by default.\n         hideHeader = true;\n      }\n      if (typeof hideStrip === 'undefined') {\n         // Show strip by default.\n         hideStrip = false;\n      }\n\n      // Disabled submit button or not.\n      $rootScope.disabled = false;\n      // Busy indicator.\n      $rootScope.ajaxBusy = false;\n      // Show the header.\n      $rootScope.header.hide = hideHeader;\n      // Show the strip.\n      $rootScope.header.striphide = hideStrip;\n   };\n\n   // Connecting to JSCDK.\n   $rootScope.connecting = function() {\n      $rootScope.ajaxBusy = true;\n      $rootScope.disabled = true;\n   };\n\n   // Enable view.\n   $rootScope.enable = function() {\n      $timeout(function() {\n         $rootScope.ajaxBusy = false;\n         $rootScope.disabled = false;\n      });\n   };\n\n   // Tear down a view. Do some cleanup work.\n   $rootScope.tearDown = function() {\n      // For sub controllers to override.\n   };\n\n   $rootScope.isAuthenticating = function() {\n      return this.parentController === 'Start' || this.name === 'Start';\n   };\n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/common/viewctrl-service.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\nimport $ from 'jquery';\n\n\nexport default function LaunchItemsCtrl($scope, $rootScope, $timeout,\n                                        connectionServerModel,\n                                        viewClientModel, mainService,\n                                        storageService,\n                                        LaunchItemsCtrlService, utilService,\n                                        safeStorageService,\n                                        userGlobalPref, _, connectionURIModel,\n                                        dialogService,\n                                        credCleanService, timezone,\n                                        jscdkLauncherInvoker,\n                                        brokerSessionStorageService,\n                                        constants) {\n   // Timeout timer ID\n   let timeoutID = null;\n\n   // Store user info in the local storage.\n   let storeUserInfo = function() {\n      let tokenUsername,\n         username,\n         domain,\n         horizonId;\n\n      // Current token user name\n      tokenUsername = connectionServerModel.tokenUsername;\n      if (!!tokenUsername) {\n         // Write domain name into cookie\n         storageService.cookie.write(\n            storageService.cookie.COOKIE_TOKEN_USER_NAME,\n            tokenUsername);\n      }\n      // Current user name\n      username = connectionServerModel.username;\n      if (!username) {\n         // Read user name from cookie\n         username = storageService.cookie.read(\n            storageService.cookie.COOKIE_USER_NAME);\n         if (!username) {\n            // If username is not available, use token username\n            // instead.\n            username = tokenUsername;\n         }\n         // Cache user name in the server model.\n         connectionServerModel.username = username;\n      } else {\n         // Write user name into cookie\n         storageService.cookie.write(\n            storageService.cookie.COOKIE_USER_NAME, username);\n      }\n      // Current domain name\n      domain = connectionServerModel.domain;\n      if (!domain) {\n         // Read domain name from cookie\n         domain = storageService.cookie.read(\n            storageService.cookie.COOKIE_DOMAIN_NAME);\n         // Cache domain name in the server model.\n         connectionServerModel.domain = domain;\n      } else {\n         // Write domain name into cookie\n         storageService.cookie.write(\n            storageService.cookie.COOKIE_DOMAIN_NAME, domain);\n      }\n      // HWS session indentifier\n      horizonId = connectionServerModel.horizonId;\n      if (!!horizonId) {\n         // Write Horizon ID into cookie\n         storageService.cookie.write(\n            storageService.cookie.COOKIE_HORIZON_ID, horizonId);\n      }\n   };\n\n   let writeTimerInfoFromConnectionServerModel2Cookie = function() {\n      let idleTimeout,\n         userActivityXMLSendingInterval;\n\n      // Current idleTimeout value\n      idleTimeout = connectionServerModel.idleTimeout;\n      if (!idleTimeout) {\n         JSCDKLogger.error(\n            'idleTimeout don\\'t exist in connectionServerModel');\n      } else {\n         // Write user idleTimeout into cookie\n         storageService.cookie.write(\n            storageService.cookie.COOKIE_IDLE_TIMEOUT, idleTimeout);\n      }\n      // Current user-activity-interval value\n      userActivityXMLSendingInterval =\n         connectionServerModel.userActivityXMLSendingInterval;\n      if (!userActivityXMLSendingInterval) {\n         JSCDKLogger.error(\n            'idleTimeout don\\'t exist in connectionServerModel');\n      } else {\n         // Write user-activity-interval value into cookie\n         storageService.cookie.write(\n            storageService.cookie.COOKIE_SEND_TIME_INTERVAL,\n            userActivityXMLSendingInterval);\n      }\n   };\n\n   let storeInfoForBlastSideBar = function(objectSet) {\n      let key;\n      for (key in objectSet) {\n         if (objectSet.hasOwnProperty(key)) {\n            safeStorageService.setItem(key, objectSet[key], null);\n         }\n      }\n   };\n   // Initialize LaunchItemsCtrl controller.\n   $scope.init = function() {\n      let data = mainService.data,\n         userAgent = navigator.userAgent,\n         brokerUrl;\n\n      if (!!data && !!data.timerInfo) {\n         if (!!data.timerInfo.idleTimeout) {\n            connectionServerModel.idleTimeout =\n               data.timerInfo.idleTimeout;\n         }\n         if (!!data.timerInfo.userActivityXMLSendingInterval) {\n            connectionServerModel.userActivityXMLSendingInterval =\n               data.timerInfo.userActivityXMLSendingInterval;\n         }\n      } else {\n         JSCDKLogger.error('launchItemsResponse have no data!');\n      }\n      $scope.activeItem = null;\n      // Name of the controller.\n      $scope.name = 'GetLaunchItems';\n      // Desktops binding model.\n      $scope.desktops = [];\n      //Applications binding model.\n      $scope.applications = [];\n      // Current click application.\n      $scope.currentApplication = null;\n      // Buffered app launching cmd.\n      $scope.bufferedArgs = null;\n      // Current click desktop.\n      $scope.currentDesktop = null;\n      // Whether to show the available items. It should be true for HWS\n      $scope.showLaunchPanel = !connectionURIModel.isHWSession();\n      /**\n       * Initialize view. Show header and show strip.\n       * Hide the header if in WS1 mode\n       */\n      $scope.initView(!$scope.showLaunchPanel);\n      // Show logout button in none-HWS env.\n      if (connectionURIModel.isHWSession()) {\n         $rootScope.header.logout = false;\n      } else {\n         $rootScope.header.logout = true;\n      }\n\n      $rootScope.onlyFavorites = false;\n      // Set current controller.\n      mainService.currentController = this;\n      writeTimerInfoFromConnectionServerModel2Cookie();\n\n      brokerUrl =\n         'https://' + connectionServerModel.host + '/broker/xml';\n      if (!!connectionURIModel.isF5Session()) {\n         brokerUrl += connectionURIModel.getF5postFix();\n      }\n\n      storeInfoForBlastSideBar({\n         EntitledItems: mainService.data,\n         ClientInfo: {\n            id: viewClientModel.clientID,\n            ip: viewClientModel.ipAddress,\n            machineName: viewClientModel.machineName,\n            windowsTimezone: viewClientModel.windowsTimezone\n         },\n         BrokerUrlInfo: {\n            url: brokerUrl,\n            urlParam: userAgent.toLowerCase()\n               .match(/(iphone|ipod|ipad)/i)\n         }\n      });\n\n      // Render launchItems.\n      LaunchItemsCtrlService.renderLaunchItems.call($scope,\n         mainService.data);\n      // Store user info.\n      storeUserInfo();\n      // Show the searchbar.\n      $rootScope.header.searchbar = true;\n\n      $scope.favTip = _('mark_fav');\n      $scope.unfavTip = _('unmark_fav');\n      $scope.showline = true;\n\n      if (jscdkLauncherInvoker.applicationSessionArray.length > 0) {\n         $rootScope.applicationCanSet = true;\n      } else {\n         $rootScope.applicationCanSet = false;\n      }\n\n      // Listen to up/down arrow keyup event.\n      $(document).on('keydown', $scope.moveFocus);\n\n      $timeout(function() {\n         $rootScope.$emit('searchFocus');\n      });\n\n      credCleanService.init();\n      utilService.storeClientConfig();\n\n      /**\n       * If user enters launch items page, and there is no user switch dialog,\n       * we can say they login broker session successfully.\n       *\n       * And at this moment we should add a flag to mark the session already\n       * logged in. See app-center-controller.js for the log off part\n       *\n       * NOTE: don't put this code before\n       * LaunchItemsCtrlService.renderLaunchItems.\n       *\n       * Because it should handle URI first\n       * And if there is a switch user dialog, user might cancel the dialog and\n       * decide not to switch session\n       */\n      if (!$scope.switchUserDialog) {\n         /**\n          * Don't use brokerSessionStorageService here because it may use\n          * COOKIE to simulate localStorage\n          */\n         if (utilService.supportLocalStorage()) {\n            window.localStorage.setItem(constants.CLIENT_LOGIN_KEY, true);\n         }\n\n         /**\n          * Mark this session as anonymous.\n          *\n          * When user first login with anonymous account, there must be\n          * unauthenticatedAccessEnabled=true in URI.\n          *\n          * But later if user reuses the session, it is possible that\n          * unauthenticatedAccessEnabled=true doesn't exist in URI.\n          *\n          * That's to say, we can only use URI to check anonymous mode in\n          * the first time. Then please use\n          * viewClientModel.isAnonymousMode instead.\n          */\n         if (connectionURIModel.isAnonymous()) {\n            brokerSessionStorageService\n               .write(constants.ANONYMOUS_MODE_KEY, true);\n            viewClientModel.isAnonymousMode = true;\n            $rootScope.showPreference = false;\n         }\n      }\n   };\n\n   $scope.$watch('header.search', function() {\n      $scope.search = $scope.header.search;\n   });\n\n   $scope.launchDesktop = function(desktop, event) {\n      $scope.currentDesktop = desktop;\n      viewClientModel.windowsTimezone = timezone.getWindowsTimezone();\n      LaunchItemsCtrlService.launchDesktop.call($scope, desktop,\n         event);\n   };\n\n   $scope.logoffDesktop = function(desktop) {\n      LaunchItemsCtrlService.logoffDesktop.call($scope, desktop);\n   };\n\n   $scope.resetDesktop = function(desktop) {\n      LaunchItemsCtrlService.resetDesktop.call($scope, desktop);\n   };\n\n   $scope.restartDesktop = function(desktop) {\n      LaunchItemsCtrlService.restartDesktop.call($scope, desktop);\n   };\n\n   $scope.launchApplication = function(application, event, args) {\n      LaunchItemsCtrlService.launchApplication.call($scope,\n         application,\n         event, args);\n   };\n\n   $scope.highlightItems = function(item, event) {\n      LaunchItemsCtrlService.highlightItems.call($scope, item, event);\n   };\n\n   $scope.isHighlighted = function(item) {\n      return LaunchItemsCtrlService.isHighlighted.call($scope, item);\n   };\n\n   $scope.launchCurrentApplication = function(application, event, args) {\n      // Save application data to use for reconnection.\n      $scope.currentApplication = application;\n      // Check whether the application is in the already connected\n      // application session.\n      if (jscdkLauncherInvoker.isApplicationConnected(application)) {\n         jscdkLauncherInvoker.disconnectApplication(application);\n      } else {\n         // if the application's origin-id is not found in the already\n         // connected farm, launch this Application directly.\n         $scope.launchApplication(application, event, args);\n      }\n   };\n\n   $scope.show = function(item) {\n      if ($rootScope.onlyFavorites) {\n         return item.favorite;\n      } else {\n         return true;\n      }\n   };\n\n   $scope.makeFavorite = function(item, event) {\n      if (event) {\n         event.stopPropagation();\n      }\n      item.favorite = !item.favorite;\n      userGlobalPref.updatePrefData({\n         name: 'favorite',\n         text: item.id,\n         action: item.favorite ? 'FavOn' : 'FavOff'\n      });\n\n   };\n\n   $scope.showNoFavorites = function(desktops, applications) {\n      let noDesktopFav = true,\n         noAppFavorites = true,\n         i;\n\n      for (i = 0; i < desktops.length; i++) {\n         if (desktops[i].favorite) {\n            noDesktopFav = false;\n            break;\n         }\n      }\n      for (i = 0; i < applications.length; i++) {\n         if (applications[i].favorite) {\n            noAppFavorites = false;\n            break;\n         }\n      }\n      if ((noDesktopFav || noAppFavorites) &&\n         $rootScope.onlyFavorites) {\n         $scope.showline = false;\n      } else {\n         $scope.showline = true;\n      }\n\n      return noDesktopFav && noAppFavorites &&\n         $rootScope.onlyFavorites;\n   };\n\n   $scope.itemTitle = function(item) {\n      if (!!item.favorite) {\n         return this.unfavTip;\n      } else {\n         return this.favTip;\n      }\n   };\n\n   $scope.keypressHandler = function(evt) {\n      if (!!evt && evt.keyCode === 32) {\n         // Prevent default behavoir when Space key is pressed.\n         evt.preventDefault();\n      }\n   };\n\n   $scope.keyboardHandler = function(evt, item, isDesktop) {\n      let callback,\n         callbackParams;\n\n      if (!evt) {\n         return;\n      }\n\n      switch (evt.keyCode) {\n         case 13:  // Enter key\n            callback = isDesktop ?\n               $scope.launchDesktop : $scope.launchCurrentApplication;\n            callbackParams = [item, evt.target];\n            break;\n         case 32:  // Space key\n            callback = $scope.makeFavorite;\n            callbackParams = [item, evt];\n            break;\n         default:\n      }\n\n      if (typeof callback === 'function') {\n         // Invoke keyboard handler.\n         callback.apply($scope, callbackParams);\n         // Prevent default behavior.\n         evt.preventDefault();\n      }\n   };\n\n   $scope.moveFocusUpRow = function(list, curr) {\n      let position,\n         top,\n         left,\n         above,\n         elem,\n         i;\n\n      if (!list || curr < 0 || curr >= list.length) {\n         return -1;\n      }\n\n      // Get the top and left position of the focused element.\n      position = utilService.position($(list[curr]));\n      top = position.top;\n      left = position.left;\n\n      // Find backwards from the current position.\n      for (i = curr - 1; i > -1; i--) {\n         elem = $(list[i]);\n\n         if (utilService.isHidden(elem)) {\n            continue;\n         }\n\n         position = utilService.position(elem);\n\n         if (!above && position.top !== top) {\n            // Top position of the above row.\n            above = position.top;\n         }\n\n         if (position.top === above &&\n            position.left <= left) {\n            /*\n             * Element is on the above row and\n             * it is left aligned with focused element\n             * or is the last element of the row.\n             */\n            return i;\n         }\n      }\n\n      return -1;\n   };\n\n   $scope.moveFocusDownRow = function(list, curr) {\n      let i,\n         position,\n         top,\n         left,\n         bottom,\n         elem,\n         next = -1;\n\n      if (!list || curr < 0 || curr >= list.length) {\n         return -1;\n      }\n\n      // Get the top and left position of the focused element.\n      position = utilService.position($(list[curr]));\n      top = position.top;\n      left = position.left;\n\n      // Down arrow key is pressed.\n      for (i = curr + 1; i < list.length; i++) {\n         elem = $(list[i]);\n\n         if (utilService.isHidden(elem)) {\n            continue;\n         }\n\n         position = utilService.position(elem);\n\n         if (!bottom && position.top !== top) {\n            // Top position of the bottom row.\n            bottom = position.top;\n         }\n\n         if (!!bottom &&\n            (position.top !== bottom || position.left > left)) {\n            // Return when the bottom row is scanned or the left align\n            // element is found.\n            break;\n         }\n\n         if (position.top === bottom &&\n            position.left <= left) {\n            /*\n             * Element is on the bottom row and\n             * it is left aligned with the focused element\n             * or is the last element of the row.\n             */\n            next = i;\n         }\n      }\n\n      return next;\n   };\n\n   $scope.moveFocusLeft = function(list, curr) {\n      let next = -1,\n         elem,\n         i;\n\n      if (!list || curr < 0 || curr >= list.length) {\n         return -1;\n      }\n\n      for (i = curr - 1; i > -1; i--) {\n         elem = $(list[i]);\n\n         if (utilService.isHidden(elem)) {\n            continue;\n         }\n\n         // Previous element.\n         next = i;\n         break;\n      }\n\n      return next;\n   };\n\n   $scope.moveFocusRight = function(list, curr) {\n      let next = -1,\n         elem,\n         i;\n\n      if (!list || curr < 0 || curr >= list.length) {\n         return -1;\n      }\n\n      for (i = curr + 1; i < list.length; i++) {\n         elem = $(list[i]);\n\n         if (utilService.isHidden(elem)) {\n            continue;\n         }\n\n         // Next element.\n         next = i;\n         break;\n      }\n\n      return next;\n   };\n\n   $scope.moveFocus = function(evt) {\n      let list,\n         index,\n         next,\n         elem,\n         i;\n\n      if (dialogService.hasDialogOpen() > 0 || !evt ||\n         evt.keyCode < 37 ||\n         evt.keyCode > 40) {\n         /**\n          * Return if a dialog is popped up, or\n          * key other than up/down/left/right arrow key is pressed.\n          */\n         return;\n      }\n\n      // Get desktop and application elements list.\n      list = $('ul.ui-desktop-list li');\n\n      // Find out the index of focused element in the list.\n      index = Array.prototype.indexOf.call(list, $scope.focusElement);\n\n      // If no element is focused, focus on the first one when down\n      // arrow key is pressed.\n      if (index === -1) {\n         // Down arrow key is pressed.\n         if (evt.keyCode === 40) {\n            // Focus on the first visible element if down arrow key is\n            // pressed.\n            for (i = 0; i < list.length; i++) {\n               elem = $(list[i]);\n\n               if (utilService.isHidden(elem)) {\n                  continue;\n               }\n\n               elem.focus();\n               break;\n            }\n\n            // Prevent default behavior.\n            evt.preventDefault();\n         }\n\n         return;\n      }\n\n      switch (evt.keyCode) {\n         case 38:\n            // Up arrow key is pressed.\n            next = $scope.moveFocusUpRow(list, index);\n            break;\n\n         case 40:\n            // Down arrow key is pressed.\n            next = $scope.moveFocusDownRow(list, index);\n            break;\n\n         case 37:\n            // Left arrow key is pressed.\n            next = $scope.moveFocusLeft(list, index);\n            break;\n\n         case 39:\n            // Right arrow key is pressed.\n            next = $scope.moveFocusRight(list, index);\n            break;\n\n         default:\n      }\n\n      if (next > -1) {\n         // Set focus\n         $(list[next]).focus();\n         // Prevent default behavior.\n         evt.preventDefault();\n      } else if (evt.keyCode === 38) {\n         /**\n          *  Up arrow key is pressed while focus is\n          *  on the first line. Set focus in the search\n          *  input box.\n          */\n         $rootScope.$emit('searchFocus');\n         // Prevent default behavior.\n         evt.preventDefault();\n      }\n   };\n\n   $scope.removeHighlight = function() {\n      $scope.activeItem = null;\n      $scope.focusElement = null;\n   };\n\n   // Override connecting method\n   $scope.connecting = function() {\n      // Invoke parent's connecting method.\n      $rootScope.connecting();\n      // Clear timer.\n      $scope.clearTimer();\n\n      // Is launching a desktop or an application.\n      if ($scope.isLaunchingItem) {\n         $scope.isLaunchingItem = false;\n\n         /**\n          * When 30 seconds expire, display a dialog\n          * asking user whether to cancel the request.\n          */\n         timeoutID = setTimeout(function() {\n            // Remove busy cursor.\n            $rootScope.enable();\n\n            timeoutID = null;\n            let dialog = dialogService.confirm({\n               data: {\n                  title: _('dialog_title_cancel_startsession'),\n                  message: _('dialog_confirm_cancel_startsession')\n               },\n               closeByEscape: false,\n               closeByDocument: false,\n               controller: ['$scope', function($scope) {\n                  $scope.confirm = function() {\n                     // Press OK btn, display busy cursor.\n                     $rootScope.connecting();\n                     dialog.close();\n                  };\n                  $scope.close = function() {\n                     // Press cancel btn, cancel launching item request.\n                     jscdkLauncherInvoker.cancelCurrentRequest();\n                     // Remove busy cursor.\n                     $rootScope.enable();\n                     dialog.close();\n                  };\n               }]\n            });\n         }, 30 * 1000);\n      }\n   };\n\n   // Clear timeout timer.\n   $scope.clearTimer = function() {\n      if (timeoutID !== null) {\n         // Clear timer.\n         clearTimeout(timeoutID);\n         timeoutID = null;\n      }\n   };\n\n   // Override teardown method\n   $scope.tearDown = function() {\n      // Remove event listener.\n      $(document).off('keydown', $scope.moveFocus);\n      // Clear timeout timer.\n      $scope.clearTimer();\n   };\n\n   $scope.enable = function() {\n      // Invoke parent's enable method.\n      $rootScope.enable();\n      // Clear timer.\n      $scope.clearTimer();\n   };\n\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/launchitems/items-controller.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport util from '../../jscdk/util';\nimport $ from 'jquery';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\n\nexport default function LaunchItemsCtrlService(connectionServerModel,\n          mainService, utilService, dialogService, safeStorageService,\n          _, connectionURIModel,\n          viewService, jscdkLauncherInvoker) {\n   // Process URI action for application.\n   function processURIAction4App(self, application, action, args) {\n      if (utilService.ignoreCaseEquals(action, 'start-session') || !action) {\n         // We need to fill in the mainService.currentController with\n         // self or otherwise launching an application will fail if\n         // we need to steal a session.\n         mainService.currentController = self;\n         self.currentApplication = application;\n         self.bufferedArgs = args;\n         // Launch application.\n         self.launchCurrentApplication(application, null, args);\n      } else if (utilService.ignoreCaseEquals(action, 'browse')) {\n         // Highlight the application.\n         self.highlightItems(application);\n      }\n   }\n\n   // Process URI action for desktop.\n   function processURIAction4Desktop(self, desktop, action) {\n      if (utilService.ignoreCaseEquals(action, 'logoff')) {\n         if (desktop.logoffEnabled) {\n            // Logoff desktop.\n            self.logoffDesktop(desktop);\n         } else {\n            // Failed to logoff the desktop.\n            self.highlightItems(desktop);\n            // Show error dialog.\n            dialogService.error({\n               data: {\n                  title: _('ERROR'),\n                  errorMessage: _('error_logoff_no_session', desktop.name)\n               }\n            });\n         }\n      } else if (utilService.ignoreCaseEquals(action, 'reset')) {\n         if (desktop.resetEnabled) {\n            // Reset desktop.\n            self.resetDesktop(desktop);\n         } else {\n            // Failed to reset the desktop.\n            self.highlightItems(desktop);\n            dialogService.error({\n               data: {\n                  title: _('ERROR'),\n                  errorMessage: _('error_reset_not_allowed', desktop.name)\n               }\n            });\n         }\n      } else if (utilService.ignoreCaseEquals(action, 'restart')) {\n         if (desktop.restartEnabled) {\n            // Restart desktop.\n            self.restartDesktop(desktop);\n         } else {\n            // Failed to restart the desktop.\n            self.highlightItems(desktop);\n            dialogService.error({\n               data: {\n                  title: _('ERROR'),\n                  errorMessage: _('error_restart_not_allowed', desktop.name)\n               }\n            });\n         }\n      } else if (utilService.ignoreCaseEquals(action, 'browse')) {\n         // Highlight desktop.\n         self.highlightItems(desktop);\n      } else if (utilService.ignoreCaseEquals(action,\n            'start-session') || !action) {\n         // Launch desktop.\n         self.launchDesktop(desktop);\n      }\n   }\n\n   /**\n    * storeLaunchingItemInfoForBlastSideBar\n    *\n    * store the current launching item info. If item is desktop,\n    * desktopId and desktopName is required. originID is clear to\n    * empty string. If item is application, originID is required.\n    */\n   function storeLaunchingItemInfoForBlastSideBar(desktopInfo,\n                                                  originID) {\n      safeStorageService.setItem('OriginDesktop', desktopInfo);\n      safeStorageService.setItem('OriginAppID', originID);\n      safeStorageService.setItem('TriedSSLVerify', {});\n      // Hack for now for we need an API in safeStorageService.\n      window.sessionStorage.removeItem('SSS_RunningSession');\n   }\n\n   /**\n    * URI handler\n    * return {canContinuePreviousAction: bool,\n             * shouldClearPreviousAction: bool}. and if first flag is true, the\n    * second one should not be defined, i.e.\n    * {canContinuePreviousAction: true}\n    */\n   function handleURI(self, desktops, applications) {\n      let i,\n         length,\n         desktop,\n         application,\n         searchedItems = false;\n\n      /** TODO: this async design will cause bug.\n       *  The shouldClearPreviousAction will not be set true as\n       * expected. To solve this bug, the whole function will be\n       * redesigned.\n       */\n      if (connectionURIModel.reuseSession) {\n         let shouldClearPreviousAction = false;\n         connectionURIModel.isIdenticalUser(connectionServerModel.host,\n            function (isIdentical) {\n               if (!isIdentical) {\n                  /**\n                   * Current URI connection has different connection\n                   * info from that of the session. Confirm with the\n                   * user whether to reuse the present session.\n                   */\n                  connectionURIModel.reuseSession = false;\n                  shouldClearPreviousAction = true;\n                  /*\n                   * If it's a HWS session, logout connection server immediately.\n                   * Otherwise, confirm with the user whether to logout or not.\n                   */\n                  if (connectionURIModel.isHWSession()) {\n                     // Logout desktop, but with uri info in jscdk and\n                     // UI reserved.\n                     jscdkLauncherInvoker.logout(false);\n                     viewService.logoutToPortal = false;\n                  } else {\n                     self.switchUserDialog = dialogService.confirm({\n                        data: {\n                           title: _('dialog_title_logout'),\n                           message: _('dialog_confirm_logout')\n                        },\n                        controller: ['$scope', function ($scope) {\n                           $scope.confirm = function () {\n                              // Logout desktop, but with uri info in\n                              // jscdk and UI reserved.\n                              jscdkLauncherInvoker.logout(false);\n                              viewService.logoutToPortal = false;\n                              self.switchUserDialog.close();\n                              self.switchUserDialog = null;\n                           };\n                        }]\n                     });\n                  }\n               } else { // if is identical user, update connecting info accordingly\n                  if (connectionURIModel.isHWSession()) {\n                     /**\n                      * only for HWS, should not move this line out of\n                      * the \"if\" condition, or the normal URL will\n                      * have a corner regression\n                      */\n                     connectionServerModel.loadFromURIModel(\n                        connectionURIModel);\n                  }\n               }\n            });\n         if (shouldClearPreviousAction) {\n            return {\n               canContinuePreviousAction: false,\n               shouldClearPreviousAction: true\n            };\n         }\n      } else {\n         /**\n          * When first time launched by vIDM(workspace),\n          * connectionServerModel should be updated as well. Otherwise\n          * nothing could be stored in cookie. When next time launched by\n          * vIDM with a different user, client wouldn't be able to realize\n          * it is a different session. See bug 1766419\n          *\n          */\n         if (connectionURIModel.isHWSession()) {\n            connectionServerModel.loadFromURIModel(connectionURIModel);\n         }\n      }\n\n      /**\n       * NOTE:\n       * This is for vIDM integration case. See bug 1770485\n       *\n       * vIDM uses the wrong URI to launch application, e.g.\n       * https://pod2-vcs1.blr.trcint.com/portal/webclient/index.html?\n       * applicationId=cn%3Dwordpad,ou%3Dapplications,dc%3Dvdi,dc%3Dvmware,\n       * dc%3Dint&SAMLart=AAQAAA/Hs7t/WV3jvQAZ6XcIqPsJs0EeMl%2BMImpRKY8RlqOW\n       * %2Bhg%2BGCOOGWg%3D&user=idmadmin&domainName=blr.trcint.com&\n       * desktopName=WordPad&horizonId=184a3bbe-aa23-49ce-8372-857c0abb44ae\n       * #/launchitems\n       *\n       * This URI contains applicationId and desktopName at the same time.\n       * In our early code, desktopName is not supported. So the launch can\n       * work. However, we introduce desktopName as a new parameter in 16q4,\n       * which cause vIDM cannot launch application.\n       *\n       * As vIDM already releases at this time (2016-11-24), we have to\n       * provide a workaround for them.\n       *\n       * Above all, we still first search the desktop list and then\n       * the application list.\n       * if none can be found in both list, we will then prompt a dialog.\n       *\n       * If we don't even search the list (while there is no desktop or\n       * application info), we will still use the old code to return.\n       */\n      if (!!connectionURIModel.params &&\n         (!!connectionURIModel.params.desktopId ||\n          !!connectionURIModel.params.desktopName ||\n          !!connectionURIModel.params.collabSessionId) &&\n          !!desktops) {\n\n         searchedItems = true;\n\n         for (i = 0, length = desktops.length; i < length; i++) {\n            desktop = desktops[i];\n            if (utilService.ignoreCaseEquals(desktop.id,\n                  connectionURIModel.params.desktopId) ||\n               utilService.ignoreCaseEquals(desktop.name,\n                  connectionURIModel.params.desktopId) ||\n               utilService.ignoreCaseEquals(desktop.name,\n                  connectionURIModel.params.desktopName) ||\n               utilService.ignoreCaseEquals(desktop.id,\n                  connectionURIModel.params.collabSessionId)) {\n               // Process URI action.\n               processURIAction4Desktop(self, desktop,\n                  connectionURIModel.params.action);\n               // delete desktopId to avoid further usage, can't clear\n               // all the params for bug 1450429.\n               connectionURIModel.params.desktopId = null;\n               // help to fix a logic defect introduced when songlil\n               // added the desktopName support, or the desktopName\n               // might get reused later if launch is canceled\n               connectionURIModel.params.desktopName = null;\n\n               connectionURIModel.params.collabSessionId = null;\n               return {\n                  canContinuePreviousAction: false,\n                  shouldClearPreviousAction: false\n               };\n            }\n         }\n      }\n\n      if (!!connectionURIModel.params &&\n         (!!connectionURIModel.params.applicationId || !!connectionURIModel.params.applicationName) && !!applications) {\n\n         searchedItems = true;\n\n         for (i = 0, length = applications.length; i < length; i++) {\n            application = applications[i];\n            if (utilService.ignoreCaseEquals(application.id,\n                  connectionURIModel.params.applicationId) ||\n               utilService.ignoreCaseEquals(application.name,\n                  connectionURIModel.params.applicationId) ||\n               utilService.ignoreCaseEquals(application.name,\n                  connectionURIModel.params.applicationName)) {\n               processURIAction4App(self, application,\n                  connectionURIModel.params.action,\n                  connectionURIModel.params.args);\n               // delete applicationId, applicationName and args to\n               // avoid further usage.\n               connectionURIModel.params.applicationId = null;\n               connectionURIModel.params.applicationName = null;\n               connectionURIModel.params.args = null;\n               return {\n                  canContinuePreviousAction: false,\n                  shouldClearPreviousAction: false\n               };\n            }\n         }\n      }\n\n      if (searchedItems) {\n         // Show error dialog.\n         let dialog = dialogService.error({\n            data: {\n               title: _('ERROR'),\n               errorMessage: _('error_item_not_found',\n                  connectionURIModel.params.desktopId ||\n                  connectionURIModel.params.desktopName ||\n                  connectionURIModel.params.applicationId ||\n                  connectionURIModel.params.applicationName ||\n                  connectionURIModel.params.collabSessionId)\n            },\n            controller: ['$scope', function ($scope) {\n               $scope.close = function () {\n                  utilService.runFunctionIfNotHWSOrF5(null);\n                  dialog.close();\n               };\n            }]\n         });\n         return {\n            canContinuePreviousAction: false,\n            shouldClearPreviousAction: true\n         };\n      }\n\n      return {\n         canContinuePreviousAction: true\n      };\n   }\n\n   /**\n    * add this function cause the desktop object for display is not\n    * the same before and after the reauth. And whether the action can\n    * be processed now is also unknown, so check the validation of\n    * action again, even some times ago it's valid.\n    *\n    * should be old broker compatible cause the applications will be\n    * empty, and this function should never be involved.\n    *\n    * the itemType is just in case application and desktop have same\n    * id, could be added in the action string, but I choose not to for\n    * easy to be understanded.\n    */\n   function handlePreviousAction(self, desktops, applications,\n                                 previousAction) {\n      let previousTargetItem = previousAction.item,\n         action = previousAction.action,\n         itemType = previousAction.itemType,\n         args,\n         targetItemId,\n         i, length,\n         desktop,\n         application;\n\n      if (!previousTargetItem || !action || !itemType) {\n         return;\n      }\n      if (itemType === \"application\") {\n         previousTargetItem = previousTargetItem.application;\n         args = previousTargetItem.args;\n      }\n\n      targetItemId = previousTargetItem.id;\n      if (!targetItemId) {\n         JSCDKLogger.debug(\n            'error: cann\\'t find the id in previousAction Object');\n         return;\n      }\n\n      //search desktops\n      if (!!desktops && itemType === 'desktop') {\n         for (i = 0, length = desktops.length; i < length; i++) {\n            desktop = desktops[i];\n            if (utilService.ignoreCaseEquals(desktop.id,\n                  targetItemId)) {\n               processURIAction4Desktop(self, desktop, action);\n               return;\n            }\n         }\n      }\n      //search applications\n      if (!!applications && itemType === 'application') {\n         for (i = 0, length = applications.length; i < length; i++) {\n            application = applications[i];\n            if (utilService.ignoreCaseEquals(application.id,\n                  targetItemId)) {\n               processURIAction4App(self, application, action, args);\n               return;\n            }\n         }\n      }\n      // not found target\n      JSCDKLogger.warning(\n         'can\\'t find the target of previous action, please check with system admin');\n   }\n\n   function _launchDesktop(desktop) {\n      /*jshint validthis: true*/\n      let errorMsg = '',\n         scope = this;\n\n      if (utilService.isSessionStorageAllowed()) {\n         if (!!desktop) {\n            // Store current desktop to persistent storage\n            storeLaunchingItemInfoForBlastSideBar({\n               id: desktop.id,\n               name: desktop.name\n            }, '');\n            scope.isLaunchingItem = true;\n\n            jscdkLauncherInvoker.launchDesktop(desktop);\n         }\n      } else {\n         if (utilService.isWebKitBrowser()) {\n            errorMsg = 'error_private_browsing';\n         } else {\n            errorMsg = 'error_unsupported_browser';\n         }\n\n         mainService.currentController.enable();\n         dialogService.error({\n            data: {\n               title: _('ERROR'),\n               errorMessage: _(errorMsg)\n            }\n         });\n      }\n   }\n\n   function _logoffDesktop(desktop) {\n      let logoffCallback;\n\n      logoffCallback = function (desktop) {\n         // Disable logoff button.\n         desktop.logoffEnabled = false;\n         // Logoff desktop.\n         jscdkLauncherInvoker.logoffDesktop(desktop.id);\n      };\n\n      let dialog = dialogService.confirm({\n         data: {\n            title: _('dialog_title_logoff'),\n            message: _('dialog_confirm_logoff')\n         },\n         controller: ['$scope', function ($scope) {\n            $scope.confirm = function () {\n               logoffCallback(desktop);\n               dialog.close();\n            };\n         }]\n      });\n   }\n\n   function _resetDesktop(desktop) {\n      let resetCallback;\n\n\n      resetCallback = function (desktop) {\n         // Logoff desktop.\n         jscdkLauncherInvoker.reset(desktop.id);\n      };\n\n      let dialog = dialogService.confirm({\n         data: {\n            title: _('dialog_title_reset'),\n            message: _('dialog_confirm_reset')\n         },\n         controller: ['$scope', function ($scope) {\n            $scope.confirm = function () {\n               resetCallback(desktop);\n               dialog.close();\n            };\n         }]\n      });\n   }\n\n   function _restartDesktop(desktop) {\n      let restartCallback;\n\n      restartCallback = function (desktop) {\n         jscdkLauncherInvoker.restart(desktop.id);\n      };\n\n      let dialog = dialogService.confirm({\n         data: {\n            title: _('dialog_title_restart'),\n            message: _('dialog_confirm_restart')\n         },\n         controller: ['$scope', function ($scope) {\n            $scope.confirm = function () {\n               restartCallback(desktop);\n               dialog.close();\n            };\n         }]\n      });\n   }\n\n   function _launchApplication(appInfo) {\n      /*jshint validthis: true*/\n      let application = appInfo.application,\n         errorMsg = '',\n         scope = this;\n\n      if (!application) {\n         JSCDKLogger.error('Can\\'t get the application data.');\n         return;\n      }\n\n      if (utilService.isSessionStorageAllowed()) {\n         if (!!application) {\n            // Store current application to persistent storage\n            storeLaunchingItemInfoForBlastSideBar({\n               id: '',\n               name: ''\n            }, application['origin-id']);\n            scope.isLaunchingItem = true;\n\n            jscdkLauncherInvoker.launchApplication(appInfo);\n         }\n      } else {\n         /*\n          * In private browsing mode,Safari,iOS safari and the Android browsers\n          * do not support setting sessionStorage or loaclStorage.\n          * In this case,there's no Android browsers, so use webkit to check whether it's private mode.\n          */\n         if (utilService.isWebKitBrowser()) {\n            errorMsg = 'error_private_browsing';\n         } else {\n            errorMsg = 'error_unsupported_browser';\n         }\n\n         dialogService.error({\n            data: {\n               title: _('ERROR'),\n               errorMessage: _(errorMsg)\n            }\n         });\n      }\n   }\n\n   return {\n      // Render launch items list.\n      renderLaunchItems: function (data) {\n         let desktops,\n            desktop,\n            desktopKey,\n            shadowSessions,\n            shadowSession,\n            shadowSessionKey,\n            applications,\n            application,\n            applicationKey,\n            applicationSessions,\n            applicationSessionKey,\n            nextStepFlags,\n            previousAction;\n         jscdkLauncherInvoker['applicationSessionArray'] = [];\n\n         if (!!data && !!data.content) {\n            desktops = data.content.desktops;\n            for (desktopKey in desktops) {\n               if (desktops.hasOwnProperty(desktopKey)) {\n                  desktop = desktops[desktopKey];\n\n                  if (desktop['protocol-match'] === 'false') {\n                     // Don't show this desktop because its display\n                     // protocol is not allowed.\n                     continue;\n                  }\n\n                  $.extend(desktop, {\n                     isShadow: false,\n                     resetEnabled: false,\n                     restartEnabled: false,\n                     logoffEnabled: false,\n                     highlight: false\n                  });\n\n                  if (desktop.canLogoff === 'true' &&\n                     desktop.state !== '') {\n                     desktop.logoffEnabled = true;\n                  }\n\n                  if ((desktop['reset-allowed'] === 'true') &&\n                     (desktop['reset-allowed-on-session'] ===\n                     'true')) {\n                     desktop.resetEnabled = true;\n                  }\n\n                  if ((desktop['reset-allowed'] === 'true') &&\n                     (desktop['reset-allowed-on-session'] ===\n                     'true')&& util.brokerSupportRestartDesktop()) {\n                     desktop.restartEnabled = true;\n                  }\n\n                  this.desktops.push(desktop);\n               }\n            }\n\n            shadowSessions = data.content.shadowSessions;\n            for (shadowSessionKey in shadowSessions) {\n               if (shadowSessions.hasOwnProperty(shadowSessionKey)) {\n                  shadowSession = shadowSessions[shadowSessionKey];\n                  // We treat all shadow sessions as desktop sessions.\n                  if (shadowSession['protocol-match'] === 'false') {\n                     continue;\n                  }\n\n                  $.extend(shadowSession, {\n                     isShadow: true,\n                     resetEnabled: false,\n                     restartEnabled: false,\n                     logoffEnabled: false,\n                     highlight: false\n                  });\n\n                  this.desktops.push(shadowSession);\n               }\n            }\n\n            applications = data.content.applications;\n            for (applicationKey in applications) {\n               if (applications.hasOwnProperty(applicationKey)) {\n                  application = applications[applicationKey];\n\n                  if (application['protocol-match'] === 'false') {\n                     // Don't show this application because its\n                     // display protocol is not allowed.\n                     continue;\n                  }\n\n                  $.extend(application, {\n                     resetEnabled: false,\n                     logoffEnabled: false,\n                     highlight: false\n                  });\n                  application.icon =\n                     application.icons[utilService.getLargestIcon(\n                        application.icons)];\n\n                  this.applications.push(application);\n               }\n            }\n            //store the application-sessions data\n            applicationSessions = data.content.applicationSessions;\n            for (applicationSessionKey in applicationSessions) {\n               if (applicationSessions.hasOwnProperty(\n                     applicationSessionKey)) {\n                  jscdkLauncherInvoker['applicationSessionArray'].push(\n                     applicationSessions[applicationSessionKey]);\n               }\n            }\n\n            if (this.desktops.length > 0 ||\n               this.applications.length > 0) {\n               // Handle URI.\n               nextStepFlags =\n                  handleURI(this, this.desktops, this.applications);\n               if (nextStepFlags.canContinuePreviousAction) {\n                  // continue action.\n                  previousAction =\n                     utilService.authenticationStatusCheck.popAction(\n                        this);\n                  if (!!previousAction) {\n                     handlePreviousAction(this, this.desktops,\n                        this.applications, previousAction);\n                  }\n               } else if (nextStepFlags.shouldClearPreviousAction) {\n                  utilService.authenticationStatusCheck.clearAction();\n               }\n            } else {\n               let dialog = dialogService.error({\n                  data: {\n                     title: _('ERROR'),\n                     errorMessage: _('error_none_desktops')\n                  },\n                  controller: ['$scope', function ($scope) {\n                     $scope.close = function () {\n                        // Logout desktop.\n                        utilService.runFunctionIfNotHWSOrF5(function () {\n                           jscdkLauncherInvoker.logout();\n                        });\n                        dialog.close();\n                     };\n                  }]\n               });\n               utilService.authenticationStatusCheck.clearAction();\n            }\n         }\n      },\n\n      launchDesktop: function (desktop, event) {\n         this.highlightItems(desktop, event);\n         this.isLaunchingItem = true;\n         if (this.ajaxBusy) {\n            return;\n         }\n         if (!util.brokerSupportApplication()) {\n            _launchDesktop.call(this, desktop);\n         } else {\n            utilService.authenticationStatusCheck.callBackWhenUnlocked(\n               _launchDesktop, desktop, 'start-session', 'desktop');\n         }\n      },\n\n      logoffDesktop: function (desktop) {\n         if (!desktop.logoffEnabled || this.ajaxBusy) {\n            return;\n         }\n         if (!util.brokerSupportApplication()) {\n            _logoffDesktop(desktop);\n         } else {\n            utilService.authenticationStatusCheck.callBackWhenUnlocked(\n               _logoffDesktop, desktop, 'logoff', 'desktop');\n         }\n      },\n\n      resetDesktop: function (desktop) {\n         if (!desktop.resetEnabled || this.ajaxBusy) {\n            return;\n         }\n         if (!util.brokerSupportApplication()) {\n            _resetDesktop(desktop);\n         } else {\n            utilService.authenticationStatusCheck.callBackWhenUnlocked(\n               _resetDesktop, desktop, 'reset', 'desktop');\n         }\n      },\n\n      restartDesktop: function (desktop) {\n         if (!desktop.restartEnabled || this.ajaxBusy) {\n            return;\n         }\n         utilService.authenticationStatusCheck.callBackWhenUnlocked(\n            _restartDesktop, desktop, 'restart', 'desktop');\n      },\n\n      highlightItems: function (item, event) {\n         this.activeItem = item;\n         if (!!event) {\n            this.focusElement = event.target;\n         }\n      },\n\n      launchApplication: function (application, event, args) {\n         this.highlightItems(application, event);\n         this.isLaunchingItem = true;\n         if (this.ajaxBusy) {\n            return;\n         }\n         if (!util.brokerSupportApplication()) {\n            JSCDKLogger.error(\n               'application is not supported by the broker');\n         } else {\n            utilService.authenticationStatusCheck.callBackWhenUnlocked(\n               _launchApplication, {\n                  application: application,\n                  args: args\n               }, 'start-session', 'application');\n         }\n      },\n\n      isHighlighted: function (item) {\n         return item === this.activeItem;\n      },\n\n      handleURI: handleURI\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/launchitems/itemsctrl-service.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport $ from 'jquery';\n\nexport default function anonymousSelectDirective($timeout) {\n   return {\n      restrict: 'A',\n      require: '?ngModel',\n      link: function(scope, element, attrs, ngModel) {\n         let widget = null;\n         element.selectmenu({\n            position: {my: \"left top+5\", at: \"left bottom\"}\n         });\n         widget = element.selectmenu('widget');\n         element.selectmenu('menuWidget').addClass('overflow');\n         widget.addClass('anonymous-select');\n\n         scope.$watch(attrs.ngModel, function() {\n            element.selectmenu('refresh');\n         });\n         element.on('selectmenuselect', function($event, ui) {\n            // Refer to http://api.jqueryui.com/selectmenu/#event-select\n            let userName = ui.item.value;\n            for (let i = 0; i < scope.usernames.length; i++) {\n               if (scope.usernames[i].value.toLocaleLowerCase() ===\n                  userName.toLocaleLowerCase()) {\n                  //use timeout to solve $digest already in progress, make\n                  // the scope.credential.domain binded with select value.\n                  $timeout(function() {\n                     scope.credential.username = scope.usernames[i];\n                  });\n                  return;\n               }\n            }\n            throw 'Select username error!';\n         });\n         widget.keydown(function(e) {\n            let c = e.keyCode;\n            // Call login when press enter.\n            if (c === 13) {\n               scope.$apply(attrs.selectMenu);\n            } else if (c === 40) {\n               //Expand the dropdown when press down key.\n               let isExpand = widget.attr('aria-expanded');\n               if (isExpand === 'false') {\n                  element.selectmenu('open');\n               }\n            }\n         });\n\n         scope.$watch(function() {\n            return scope.ajaxBusy;\n         }, function(newValue, oldValue) {\n            if (newValue === true) {\n               $(\"#unauthenticatedUsername\")\n                  .selectmenu(\"option\", \"disabled\", true);\n            } else {\n               $(\"#unauthenticatedUsername\")\n                  .selectmenu(\"option\", \"disabled\", false);\n            }\n         });\n\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/login/anonymous-select-directive.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function ChangePasswordCtrl($scope, $timeout, mainService,\n                                           utilService,\n                                           connectionServerModel,\n                                           jscdkLauncherInvoker) {\n   let renderData = function(data) {\n      if (!!data && !!data.content) {\n         if (!!data.content.username) {\n            $scope.username = data.content.username;\n         }\n         if (!!data.content.oldpassword) {\n            $scope.credential.oldpassword = data.content.oldpassword;\n         }\n         // Set error message.\n         if (!!data.content.error) {\n            $scope.error = data.content.error;\n         }\n      }\n   };\n\n   // Initialize ChangePasswordCtrl controller.\n   $scope.init = function() {\n      $scope.loadingAllow = true;\n      let data = mainService.data;\n\n      // Name of the controller.\n      $scope.name = 'WindowsPasswordExpired';\n      // Set host address.\n      $scope.host = connectionServerModel.host;\n      // Error message.\n      $scope.error = '';\n      // User credentials.\n      $scope.credential = {\n         oldpassword: '',\n         newpassword: '',\n         newpasswordRepeat: ''\n      };\n      // Initialize view. Hide header and show strip.\n      $scope.initView();\n      // Set current controller.\n      mainService.currentController = this;\n\n      renderData(data);\n   };\n\n   $scope.changePassword = function(form) {\n      if (form.$valid && !$scope.ajaxBusy) {\n         jscdkLauncherInvoker\n            .changePassword($scope.credential.oldpassword,\n               $scope.credential.newpassword,\n               $scope.credential.newpasswordRepeat);\n      }\n   };\n\n   $scope.cancel = function() {\n      $scope.loadingAllow = false;\n      if ($scope.ajaxBusy) {\n         jscdkLauncherInvoker.cancelCurrentRequest({\n            name: 'WindowsPasswordExpired',\n            content: {\n               oldpassword: $scope.credential.oldpassword,\n               error: $scope.error\n            }\n         });\n      } else {\n         jscdkLauncherInvoker.cancelAuthentication();\n      }\n   };\n\n   $scope.keyPress = function(event, form) {\n      if (!!event && event.keyCode === 13) {\n         // Press enter key.\n         $scope.changePassword(form);\n      }\n   };\n\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/login/changepassword-controller.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function DisclaimerCtrl($scope, $rootScope, $timeout,\n                                       mainService, utilService,\n                                       jscdkLauncherInvoker) {\n   let renderData = function(data) {\n      let message;\n\n      if (!!data && !!data.content) {\n         message = data.content.label;\n         // Normalize pre-login message that each newline starts with\n         // '\\n'.\n         $scope.disclaimerText =\n            message.replace(/(\\r\\n|\\r|\\n)/g, '\\n');\n      }\n   };\n\n   $scope.init = function() {\n      $scope.loadingAllow = true;\n      let data = mainService.data;\n\n      // Name of the controller.\n      $scope.name = 'Disclaimer';\n      // Initialize view. Hide header and show strip.\n      $scope.initView();\n      // Set current controller.\n      mainService.currentController = this;\n\n      renderData(data);\n      this.parentController = \"Start\";\n   };\n\n   $scope.accept = function() {\n      jscdkLauncherInvoker.acceptDisclaimer();\n   };\n\n   $scope.cancel = function() {\n      $scope.loadingAllow = false;\n      utilService.runFunctionIfNotHWSOrF5(function() {\n         jscdkLauncherInvoker.cancelAuthentication();\n      });\n   };\n\n   $scope.init();\n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/login/disclaimer-controller.js","/*********************************************************\n * Copyright (C) 2016-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport $ from 'jquery';\n\nexport default function domainSelectMenuDirective($timeout, viewClientModel) {\n   return {\n      restrict: 'A',\n      require: '?ngModel',\n      link: function(scope, element, attrs, ngModel) {\n         let widget = null;\n         element.selectmenu({\n            position: {my: \"left top+5\", at: \"left bottom\"}\n         });\n         widget = element.selectmenu('widget');\n         element.selectmenu('menuWidget').addClass('overflow');\n         widget.addClass('domain-select');\n\n         scope.$watch(attrs.ngModel, function() {\n            element.selectmenu('refresh');\n         });\n         element.on('selectmenuselect', function() {\n            // Value of element is 'string:xxx'\n            let domainName = element.val().substr(\"string:\".length),\n               i;\n            for (i = 0; i < scope.domains.length; i++) {\n               if (scope.domains[i].toLocaleLowerCase() ===\n                  domainName.toLocaleLowerCase()) {\n                  break;\n               }\n            }\n            if (i >= scope.domains.length) {\n               throw 'Select domain error!';\n            }\n            //use timeout to solve $digest already in progress, make\n            // the scope.credential.domain binded with select value.\n            $timeout(function() {\n               scope.$apply(scope.credential.domain =\n                  scope.domains[i]);\n            });\n         });\n         widget.keydown(function(e) {\n            let c = e.keyCode;\n            // Call login when press enter.\n            if (c === 13) {\n               scope.$apply(attrs.selectMenu);\n            } else if (c === 40) {\n               //Expand the dropdown when press down key.\n               let isExpand = widget.attr('aria-expanded');\n               if (isExpand === 'false') {\n                  element.selectmenu('open');\n               }\n            }\n         });\n         scope.$watch(function() {\n            return scope.domainReadOnly;\n         }, function(newValue, oldValue) {\n            if (newValue === true) {\n               $(\"#domain\").selectmenu(\"option\", \"disabled\", true);\n            } else {\n               $(\"#domain\").selectmenu(\"option\", \"disabled\", false);\n            }\n         });\n\n         /**\n          * Hide domain list\n          * clientHideDomainList is set in getConfigurationHandler.js\n          */\n         if (viewClientModel.clientHideDomainList) {\n            $(\"#domain-button\").addClass('ui-hide');\n\n            // Use the same way to hide domain\n            if (scope.isPhone) {\n               $(\"#domain\").addClass('ui-hide');\n            }\n         }\n      }\n   };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/login/domain-select-menu-directive.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport function LoginCtrl($scope, $rootScope,\n                          mainService,\n                          utilService, storageService,\n                          jscdkLauncherInvoker) {\n   const widgets = ['Waiting', 'SecurIDPasscode', 'WindowsPassword',\n      'Disclaimer', 'Unauthenticated'];\n\n   $scope.init = function() {\n      // Name of the controller.\n      $scope.name = 'Start';\n      // Initialize view. Hide header and show strip.\n      $scope.initView();\n      // Set current controller.\n      mainService.currentController = this;\n      $scope.connectToBroker();\n   };\n\n   $scope.connectToBroker = function() {\n      // first time enter authentication\n      if (!$rootScope.initialized) {\n         $rootScope.initialized = true;\n         $scope.doCompatibilityCheckAndInitialize();\n      } else {\n         // idletimeout don't clear user's last action\n         if (mainService.data &&\n            widgets.indexOf(mainService.data.name) >= 0) {\n            $scope.enable(mainService.data.name,\n               mainService.data.content);\n         } else {\n            jscdkLauncherInvoker.connectToBroker();\n         }\n      }\n   };\n\n   /*\n    * doCompatibilityCheckAndInitialize\n    *\n    *    Verifies the version of the browser and check if cookie is enabled.\n    *    If the browser is supported and cookie is enabled, launch\n    *    web client. Otherwise, display the browser compatibility warning.\n    *\n    * @param data Locale and product data retrieved from the server.\n    *             null if the request failed.\n    */\n   $scope.doCompatibilityCheckAndInitialize = function() {\n      let ok = utilService.isCompatibleBrowser();\n\n      if (!storageService.cookie.isEnabled()) {\n         // User cannot login the connection server when the cookie is\n         // disabled.\n         ok = false;\n      }\n\n      // Enable browser support warning everytime instead of first use\n      // only.\n      if (ok) {\n         if (!window.location.search) {\n            // cancel previous user launch/reset/logoff trial\n            utilService.authenticationStatusCheck.clearAction();\n\n            jscdkLauncherInvoker.connectToBroker();\n         } else {\n            jscdkLauncherInvoker.setURI();\n         }\n      } else {\n         // Display browser warnings.\n         mainService.show('Warning');\n      }\n   };\n\n   $scope.enable = function(name, data) {\n      let i, e;\n      if (!name) {\n         /*If action name is null, set the action's name to waiting.*/\n         name = 'Waiting';\n      }\n      for (i = 0; i < widgets.length; i++) {\n         e = widgets[i];\n         if (e === name) {\n            $scope['show' + name] = true;\n            $rootScope.enable();\n         } else {\n            $scope['show' + e] = false;\n         }\n      }\n   };\n\n   $scope.init();\n\n}\n\nexport function WaitingCtrl($scope, $rootScope) {\n   $rootScope.showWaiting = true;\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/login/login-controller.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function SecuridNextTokenCodeCtrl($scope, $rootScope, $timeout,\n                                                 connectionServerModel,\n                                                 mainService, utilService,\n                                                 jscdkLauncherInvoker, _) {\n   let renderData = function(data) {\n      if (!!data && !!data.content) {\n         if (!!data.content.label) {\n            $scope.title = data.content.label;\n         }\n\n         if (!!data.content.authChallenge) {\n            $scope.challengeString = data.content.authChallenge;\n         }\n      }\n   };\n\n   // Initialize LoginCtrl controller.\n   $scope.init = function() {\n      $scope.loadingAllow = true;\n      let data = mainService.data;\n\n      // Name of the controller.\n      $scope.name = 'SecurIDNextTokenCode';\n      // Set host address.\n      $scope.host = connectionServerModel.host;\n      // User credentials.\n      $scope.credential = {\n         passcode: ''\n      };\n      // Dialog title.\n      $scope.title = _('dialog_title_login');\n      // Challenge string.\n      $scope.challengeString = _('dialog_challenge_nexttoken');\n      // Initialize view. Hide header and show strip.\n      $scope.initView();\n      // Set current controller.\n      mainService.currentController = this;\n\n      renderData(data);\n   };\n\n   // Login method.\n   $scope.login = function(form) {\n      if (form.$valid) {\n         jscdkLauncherInvoker\n            .submitSecurIDNextTokenCode($scope.credential.passcode);\n      }\n   };\n\n   $scope.cancel = function() {\n      $scope.loadingAllow = false;\n      if ($scope.ajaxBusy) {\n         jscdkLauncherInvoker.cancelCurrentRequest({\n            name: 'SecurIDNextTokenCode',\n            content: {\n               label: $scope.title,\n               authChallenge: $scope.challengeString\n            }\n         });\n      } else {\n         jscdkLauncherInvoker.cancelAuthentication();\n      }\n   };\n\n   $scope.keyPress = function(event, form) {\n      if (!!event && event.keyCode === 13) {\n         // Press enter key.\n         $scope.login(form);\n      }\n   };\n\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/login/securidnexttokencode-controller.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport $ from 'jquery';\n\nexport default function SecuridPasscodeCtrl($scope, $rootScope, $timeout,\n                                            connectionServerModel,\n                                            mainService, utilService,\n                                            jscdkLauncherInvoker, _) {\n   let renderData = function(data) {\n      if (!!data && !!data.content) {\n         if (!!data.content.username) {\n            $scope.credential.username = data.content.username;\n         }\n\n         if (!!data.content.error) {\n            $scope.error = data.content.error;\n         }\n\n         if (!!data.content.label) {\n            $scope.title = data.content.label;\n            $scope.titleString =\n               _('dialog_prompt_passcode', data.content.label);\n         }\n\n         if (!!data.content.authType) {\n            $scope.authType = data.content.authType.toUpperCase();\n         }\n      }\n   };\n\n   // Initialize LoginCtrl controller.\n   $scope.init = function() {\n      $scope.loadingAllow = true;\n      let data = mainService.data;\n\n      // Name of the controller.\n      $scope.name = 'SecurIDPasscode';\n      // Set host address.\n      $scope.host = connectionServerModel.host;\n      // Error message.\n      $scope.error = '';\n      // Is RSA authentication.\n      $scope.authType = 'RSA';\n      // User credentials.\n      $scope.credential = {\n         username: '',\n         passcode: ''\n      };\n      // Dialog title.\n      $scope.title = _('dialog_title_login');\n      // Initialize view. Hide header and show strip.\n      $scope.initView();\n      // Set current controller.\n      mainService.currentController = this;\n\n      renderData(data);\n      this.parentController = \"Start\";\n   };\n\n   // Login method.\n   $scope.login = function(form) {\n      if (form.$valid) {\n         connectionServerModel.tokenUsername =\n            $scope.credential.username;\n\n         jscdkLauncherInvoker\n            .submitSecurIDPasscode($scope.credential.username,\n               $scope.credential.passcode);\n      }\n   };\n\n   $scope.cancel = function() {\n      $scope.loadingAllow = false;\n      if ($scope.ajaxBusy) {\n         jscdkLauncherInvoker.cancelCurrentRequest({\n            name: 'SecurIDPasscode',\n            content: {\n               username: $scope.credential.username,\n               label: $scope.title,\n               authType: $scope.authType\n            }\n         });\n      } else {\n         jscdkLauncherInvoker.cancelAuthentication();\n      }\n   };\n\n   $scope.keyPress = function(event, form) {\n      if (!!event && event.keyCode === 13) {\n         // Press enter key.\n         $scope.login(form);\n      }\n   };\n\n   /**\n    * Fix Bug 1229360: The sign in button is inactive when Username\n    * only contains Non-ASCII characters in IE11 browser.\n    *\n    * The reason is in IE11, entering non-ASCII codes in the text\n    * input\n    * doesn't dispatch change event, while AngularJS 1.2.2 library\n    * relies on change event to do data-binding.\n    *\n    * The workaround is at focus out, update binding value if\n    * necessary. TODO: Update AngularJS library.\n    */\n   $scope.updateUsername = function() {\n      let value = $('#securUsername').val();\n      if ($scope.credential && value !== $scope.credential.username) {\n         $scope.credential.username = value;\n      }\n   };\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/login/securidpasscode-controller.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function SecuridPinChangeCtrl($scope, $rootScope, $timeout,\n                                             connectionServerModel,\n                                             mainService, utilService,\n                                             jscdkLauncherInvoker, _) {\n   let renderData = function(data) {\n      if (!!data && !!data.content) {\n         if (!!data.content.error) {\n            $scope.error = data.content.error;\n         }\n\n         if (!!data.content.message) {\n            $scope.prompt =\n               _('dialog_prompt_pinchange') + data.content.message;\n         }\n\n         /**\n          * handle UI of three types of PIN change\n          *\n          * (1) MUST_CHOOSE_PIN: show textfields (pin1 and pin2) with\n          * blank\n          * (2) CANNOT_CHOOSE_PIN: show textfield pin1 with value\n          * readonly returned from broker\n          * (3) USER_SELECTABLE: show textfield pin1 with value\n          * editable returned from broker\n          *\n          */\n         if (!!data.content.pin1) {\n            $scope.pin1Type = 'text';\n            $scope.pin1 = data.content.pin1;\n         }\n         if (data.content.pin1ReadOnly === 'yes') {\n            $scope.pin1ReadOnly = true;\n         }\n      }\n   };\n\n   // Initialize LoginCtrl controller.\n   $scope.init = function() {\n      $scope.loadingAllow = true;\n      let data = mainService.data;\n\n      // Name of the controller.\n      $scope.name = 'SecurIDPinChange';\n      // Error message.\n      $scope.error = '';\n      $scope.pin1 = '';\n      $scope.pin2 = '';\n      $scope.prompt = '';\n      $scope.pin1Type = 'password';\n      $scope.pin1ReadOnly = false;\n      // Initialize view. Hide header and show strip.\n      $scope.initView();\n      // Set current controller.\n      mainService.currentController = this;\n\n      renderData(data);\n   };\n\n   // Login method.\n   $scope.login = function(form) {\n      if (form.$valid) {\n         jscdkLauncherInvoker.submitSecurIDPinChange($scope.pin1,\n            $scope.pin2);\n      }\n   };\n\n   $scope.cancel = function() {\n      $scope.loadingAllow = false;\n      if ($scope.ajaxBusy) {\n         jscdkLauncherInvoker.cancelCurrentRequest({\n            name: 'SecurIDPinChange',\n            content: {\n               message: $scope.prompt,\n               pin1: $scope.pin1,\n               pin1ReadOnly: $scope.pin1ReadOnly\n            }\n         });\n      } else {\n         jscdkLauncherInvoker.cancelAuthentication();\n      }\n   };\n\n   $scope.keyPress = function(event, form) {\n      if (!!event && event.keyCode === 13) {\n         // Press enter key.\n         $scope.login(form);\n      }\n   };\n\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/login/securidpinchange-controller.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function SecuridWaitCtrl($scope, $rootScope, $timeout,\n                                        connectionServerModel,\n                                        mainService, utilService,\n                                        jscdkLauncherInvoker) {\n   // Initialize LoginCtrl controller.\n   $scope.init = function() {\n      $scope.loadingAllow = true;\n      let data = mainService.data;\n\n      // Name of the controller.\n      $scope.name = 'SecurIDWait';\n      // Set host address.\n      $scope.host = connectionServerModel.host;\n      // Initialize view. Hide header and show strip.\n      $scope.initView();\n      // Set current controller.\n      mainService.currentController = this;\n   };\n\n   // Login method.\n   $scope.login = function() {\n      jscdkLauncherInvoker.submitSecurIDWait();\n   };\n\n   $scope.cancel = function() {\n      $scope.loadingAllow = false;\n      if ($scope.ajaxBusy) {\n         jscdkLauncherInvoker.cancelCurrentRequest({\n            name: 'SecurIDWait'\n         });\n      } else {\n         jscdkLauncherInvoker.cancelAuthentication();\n      }\n   };\n\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/login/securidwait-controller.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nexport default function UnauthenticatedCtrl($scope, connectionServerModel, _,\n                                            viewService,\n                                            mainService, jscdkLauncherInvoker,\n                                            connectionURIModel, utilService,\n                                            dialogService) {\n   $scope._getDefaultUser = function(usernames) {\n      for (let i = 0; i < usernames.length; i++) {\n         if (usernames[i].default) {\n            return usernames[i];\n         }\n      }\n\n      // If not find the default username, just use the first one\n      return usernames[0];\n   };\n\n   $scope._renderData = function(data) {\n      if (!!data && !!data.content) {\n         if (!!data.content.usernames) {\n            $scope.usernames = data.content.usernames;\n\n            $scope.credential.username =\n               $scope._getDefaultUser(data.content.usernames);\n\n            $scope._setDisplayName($scope.usernames);\n         }\n\n         if (!!data.content.currentUsername) {\n            $scope.credential.username = data.content.currentUsername;\n         }\n\n         if (!!data.content.error) {\n            $scope.error = data.content.error;\n         }\n\n         $scope._tryAutoConnect(data);\n      }\n   };\n\n   $scope._setDisplayName = function(usernames) {\n      usernames.forEach(username => {\n         if (username.default) {\n            // Append ' (default)' to default username\n            username.displayName = username.value +\n               _('DEFAULT_FOR_ANONYMOUS');\n         } else {\n            username.displayName = username.value;\n         }\n      });\n   };\n\n   $scope._verifyUsername = function(username, usernames) {\n      for (let i = 0; i < usernames.length; i++) {\n         if (utilService.ignoreCaseEquals(username,\n               usernames[i].value)) {\n            return usernames[i];\n         }\n      }\n      return null;\n   };\n\n   $scope._tryAutoConnect = function(data) {\n      // If unauthenticatedAccessAccount exists in URL, use it\n      if (!!connectionURIModel.params &&\n         !!connectionURIModel.params.unauthenticatedAccessAccount) {\n         let usernameObj = $scope._verifyUsername(\n            connectionURIModel.params.unauthenticatedAccessAccount,\n            data.content.usernames);\n\n         if (usernameObj !== null) {\n            $scope.credential.username = usernameObj;\n            $scope._loginWithUsername(usernameObj.value);\n         } else {\n            let dialog = dialogService.error({\n               data: {\n                  title: _('ERROR'),\n                  errorMessage: _('ANONYMOUS_USERNAME_NOT_FOUND',\n                     connectionURIModel.params.unauthenticatedAccessAccount)\n               },\n               closeByEscape: false,\n               closeByDocument: false,\n               controller: ['$scope', function($scope) {\n                  $scope.close = function() {\n                     viewService.gotoPortal();\n                     dialog.close();\n                  };\n               }]\n            });\n         }\n         return;\n      }\n\n      /**\n       * If no unauthenticatedAccessAccount exists but there is only\n       * one username, use it\n       */\n      if (data.content.usernames.length === 1) {\n         $scope._loginWithUsername(data.content.usernames[0].value);\n      }\n   };\n\n   $scope._loginWithUsername = function(username) {\n      connectionServerModel.username = username;\n      jscdkLauncherInvoker.submitUnauthenticated(username);\n   };\n\n   // Initialize LoginCtrl controller.\n   $scope.init = function() {\n      $scope.loadingAllow = true;\n      let data = mainService.data;\n\n      // Name of the controller.\n      $scope.name = 'Unauthenticated';\n      // Error message.\n      $scope.error = '';\n      // User credentials.\n      $scope.credential = {\n         username: ''\n      };\n      // Initialize view. Hide header and show strip.\n      $scope.initView();\n      // Set current controller.\n      mainService.currentController = this;\n\n      $scope._renderData(data);\n      this.parentController = \"Start\";\n   };\n\n   // Login method.\n   $scope.login = function(form) {\n      if (form.$valid) {\n         $scope._loginWithUsername($scope.credential.username.value);\n      }\n   };\n\n   $scope.cancel = function() {\n      $scope.loadingAllow = false;\n      if ($scope.ajaxBusy) {\n         jscdkLauncherInvoker.cancelCurrentRequest({\n            name: 'Unauthenticated',\n            content: {\n               usernames: $scope.usernames,\n               currentUsername: $scope.credential.username\n            }\n         });\n      } else {\n         jscdkLauncherInvoker.cancelAuthentication();\n      }\n   };\n\n   $scope.keyPress = function(event, form) {\n      if (!!event && event.keyCode === 13) {\n         // Press enter key.\n         $scope.login(form);\n      }\n   };\n\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/login/unauthenticated-controller.js","/*********************************************************\n * Copyright (C) 2015-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\n\nimport $ from 'jquery';\n\nexport default function WindowsPasswordCtrl($scope, connectionServerModel,\n                                            mainService,\n                                            utilService, _, dialogService,\n                                            viewClientModel,\n                                            connectionURIModel, viewService,\n                                            usernameUtil,\n                                            jscdkLauncherInvoker) {\n   let isReauthentication = function(data) {\n      if (!data || !data.content) {\n         return false;\n      }\n      return data.content.usernameReadOnly === 'yes' &&\n         data.content.domainReadOnly === 'yes';\n   };\n\n   let renderData = function(data) {\n      let domain, i;\n\n      if (!!data && !!data.content) {\n         // Initialize credential data binding model.\n         $scope.credential.username = data.content.username;\n         // Set username input editability.\n         if (data.content.usernameReadOnly === 'yes') {\n            $scope.userNameReadOnly = true;\n         } else {\n            $scope.userNameReadOnly = false;\n         }\n         // Set available domains.\n         $scope.domains = data.content.domains;\n         // Set domainName input editability.\n         if (data.content.domainReadOnly === 'yes') {\n            $scope.domainReadOnly = true;\n         } else {\n            $scope.domainReadOnly = false;\n         }\n         // Set current domain.\n         if (!!$scope.domains && $scope.domains.length > 0) {\n            if (!!data.content.domainName) {\n               domain = data.content.domainName;\n            }\n\n            for (i = 0; i < $scope.domains.length; i++) {\n               if (utilService.ignoreCaseEquals($scope.domains[i],\n                     domain)) {\n                  break;\n               }\n            }\n            if (i >= $scope.domains.length) {\n               i = 0;\n            }\n\n            $scope.credential.domain = $scope.domains[i];\n         }\n         // Set error message.\n         if (!!data.content.error) {\n            $scope.error = data.content.error;\n         }\n         // Check username only when it exists\n         if (!!$scope.credential.username) {\n            $scope._checkUsername($scope.credential.username);\n         }\n      }\n   };\n\n   let checkSameUser = function() {\n      if (!connectionURIModel.reuseSession) {\n         return;\n      }\n\n      connectionURIModel.isIdenticalUser(connectionServerModel.host,\n         function(isIdentical) {\n            if (!isIdentical) {\n               /**\n                * Current URI connection has different connection\n                * info from that of the session. Confirm with the user\n                * whether to reuse the present session.\n                */\n               connectionURIModel.reuseSession = false;\n               let dialog = dialogService.confirm({\n                  data: {\n                     title: _('dialog_title_logout'),\n                     message: _('dialog_confirm_logout')\n                  },\n                  controller: ['$scope', function($scope) {\n                     $scope.confirm = function() {\n                        // Logout broker, but with uri info in jscdk and\n                        // UI reversed.\n                        jscdkLauncherInvoker.logout(false);\n                        viewService.logoutToPortal = false;\n                        dialog.close();\n                     };\n                  }]\n               });\n            }\n         });\n   };\n\n   // Initialize LoginCtrl controller.\n   $scope.init = function() {\n      $scope.loadingAllow = true;\n      let data = mainService.data;\n      //check platform to use native select.\n      if (viewClientModel.mIsAndroid || viewClientModel.mIsIEMobile ||\n         viewClientModel.mIsIOS) {\n         $scope.isPhone = true;\n      } else {\n         $scope.isPhone = false;\n      }\n      // Name of the controller.\n      $scope.name = 'WindowsPassword';\n      // Set host address.\n      $scope.host = connectionServerModel.host;\n      // Error message.\n      $scope.error = '';\n      // User credentials.\n      $scope.credential = {\n         username: connectionServerModel.username,\n         password: '',\n         domain: ''\n      };\n      // User name input editability.\n      $scope.userNameReadOnly = false;\n      // Domain select disable\n      $scope.domainReadOnly = false;\n      // If it is re-authentication\n      $scope.isReauthentication = false;\n      // Initialize View. Hide header and show strip.\n      $scope.initView();\n      // Set current controller.\n      mainService.currentController = this;\n\n      renderData(data);\n      $scope.activeDownlist = false;\n\n      // show logout dialog if is not identical user\n      if (isReauthentication(data)) {\n         if (viewClientModel.isAnonymousMode) {\n            // Don't do re-authentication for anonymous mode\n            $scope.enable();\n            jscdkLauncherInvoker.logout(false);\n            viewService.logoutToPortal = false;\n         } else {\n            checkSameUser();\n            $scope.isReauthentication = true;\n         }\n      }\n\n      this.parentController = \"Start\";\n   };\n\n   // Login method.\n   $scope.login = function(form) {\n      let domain,\n         reAuth = false;\n\n      if (form.$valid && $scope._isUsernameAndDomainLegal()) {\n         if (usernameUtil.domainInUsername($scope.credential.username)) {\n            /**\n             * If username contains domain, store that one rather than\n             * $scope.credential.domain\n             *\n             * connectionServerModel is used in storeUserInfo of\n             * items-controller.js\n             */\n            domain = usernameUtil.getDomain($scope.credential.username);\n         } else {\n            domain = $scope.credential.domain;\n         }\n\n         //deal with reauth case\n         if ($scope.userNameReadOnly && $scope.domainReadOnly) {\n            reAuth = true;\n         }\n\n         // Store username and domain\n         connectionServerModel.username = $scope.credential.username;\n         connectionServerModel.domain = domain;\n\n         jscdkLauncherInvoker.submitWindowsPassword(\n            $scope.credential.username,\n            $scope.credential.password, domain, reAuth);\n      }\n   };\n\n   $scope.cancel = function() {\n      $scope.loadingAllow = false;\n      // wirte in datas that needed when back to login page\n      let backContent = {\n         username: $scope.credential.username,\n         domains: $scope.domains,\n         domainName: $scope.credential.domain\n      };\n      if ($scope.userNameReadOnly === true) {\n         backContent.usernameReadOnly = 'yes';\n      }\n      if ($scope.domainReadOnly === true) {\n         backContent.domainReadOnly = 'yes';\n      }\n      // cancel current request\n      if ($scope.ajaxBusy) {\n         jscdkLauncherInvoker.cancelCurrentRequest({\n            name: 'WindowsPassword',\n            content: backContent\n         });\n      } else {\n         // cancel previous user launch/reset/logoff trial\n         utilService.authenticationStatusCheck.clearAction();\n         if ($scope.domainReadOnly && $scope.userNameReadOnly) { //re-authentication\n            // Logout the broker.\n            jscdkLauncherInvoker.logout(true);\n         } else {\n            jscdkLauncherInvoker.cancelAuthentication();\n         }\n      }\n   };\n\n   $scope.keyPress = function(event, form) {\n      if (!!event && event.keyCode === 13) {\n         // Press enter key.\n         $scope.login(form);\n      }\n   };\n\n   /**\n    * Fix Bug 1229360: The sign in button is inactive when Username\n    * only contains Non-ASCII characters in IE11 browser.\n    *\n    * The reason is in IE11, entering non-ASCII codes in the text input\n    * doesn't dispatch change event, while AngularJS 1.2.2 library relies\n    * on change event to do data-binding.\n    *\n    * The workaround is at focus out, update binding value if necessary.\n    * TODO: Update AngularJS library.\n    */\n   $scope.updateUsername = function() {\n      let value = $('#username').val();\n      if (value !== $scope.credential.username) {\n         $scope.credential.username = value;\n      }\n   };\n\n   // When username changed, detect whether use UPN name\n   $scope.usernameChange = function() {\n      $scope._checkUsername($scope.credential.username);\n   };\n\n   $scope._checkUsername = function(username) {\n      // do nothing in the case of re-auth\n      if ($scope.userNameReadOnly || !username) {\n         return;\n      }\n      /**\n       * 1. UPN. username@domain\n       * 2. domain\\username\n       */\n      if (username.indexOf('\\\\') !== -1 ||\n         username.indexOf('@') !== -1) {\n         $scope.domainReadOnly = true;\n      } else {\n         $scope.domainReadOnly = false;\n      }\n   };\n\n   $scope._isUsernameAndDomainLegal = function() {\n      /**\n       * Basic username check\n       * 1. If username contains both @ and \\\n       * 2. If hide domain enabled, and username doesn't contain domain\n       * Note: we don't need to check #2 if it is re-authentication as\n       * user cannot change username at that time\n       */\n      if (!usernameUtil.isUsernameLegal($scope.credential.username) ||\n         (viewClientModel.clientHideDomainList && !usernameUtil\n            .domainInUsername($scope.credential.username) &&\n         !$scope.isReauthentication)) {\n         dialogService.error({\n            data: {\n               title: _('ERROR'),\n               errorMessage: _('USERNAME_DOMAIN_ILLEGAL')\n            }\n         });\n         return false;\n      }\n\n      // No more check for UPN or normal username\n      if (usernameUtil.isUPN($scope.credential.username) ||\n         !usernameUtil.domainInUsername($scope.credential.username)) {\n         return true;\n      }\n\n      /**\n       * Begin to check domain\\username now!\n       * First check if domain is valid\n       */\n      let domain = usernameUtil.getDomain($scope.credential.username);\n      if (!usernameUtil.isDomainLegal(domain)) {\n         dialogService.error({\n            data: {\n               title: _('ERROR'),\n               errorMessage: _('USERNAME_DOMAIN_ILLEGAL')\n            }\n         });\n         return false;\n      }\n\n      // If domain is not hidden, check if the input domain in domain list\n      if (!viewClientModel.clientHideDomainList &&\n         !usernameUtil.isDomainInDomainList(domain, $scope.domains)) {\n         dialogService.error({\n            data: {\n               title: _('ERROR'),\n               errorMessage: _('DOMAIN_NOT_IN_LIST')\n            }\n         });\n         return false;\n      }\n\n      return true;\n   };\n\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/login/windowspassword-controller.js","/*********************************************************\n * Copyright (C) 2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport loginTemplate from './login/login.html';\nimport changePasswordTemplate from './login/change-password.html';\nimport securidNextTokenCodeTemplate from './login/securid-nexttokencode.html';\nimport securidPinchangeTemplate from './login/securid-pinchange.html';\nimport securidWaitTemplate from './login/securid-wait.html';\nimport launchitemsTemplate from './launchitems/launchitems.html';\nimport blastDesktopTemplate from './common/blast-desktop.html';\nimport warningTemplate from './common/home-warning.html';\n\n\nexport default function routeConfig($routeProvider) {\n   $routeProvider\n      .when('/', {\n         templateUrl: loginTemplate,\n         controller: 'LoginCtrl'\n      })\n      .when('/home', {\n         templateUrl: loginTemplate,\n         controller: 'LoginCtrl'\n      })\n      .when('/changepassword', {\n         templateUrl: changePasswordTemplate,\n         controller: 'ChangePasswordCtrl'\n      })\n      .when('/securidnexttoken', {\n         templateUrl: securidNextTokenCodeTemplate,\n         controller: 'SecuridNextTokenCodeCtrl'\n      })\n      .when('/securidpinchange', {\n         templateUrl: securidPinchangeTemplate,\n         controller: 'SecuridPinChangeCtrl'\n      })\n      .when('/securidwait', {\n         templateUrl: securidWaitTemplate,\n         controller: 'SecuridWaitCtrl'\n      })\n      .when('/launchitems', {\n         templateUrl: launchitemsTemplate,\n         controller: 'LaunchItemsCtrl'\n      })\n      .when('/blastdesktop', {\n         templateUrl: blastDesktopTemplate,\n         controller: 'BlastDesktopCtrl'\n      })\n      .when('/warning', {\n         templateUrl: warningTemplate,\n         controller: 'HomeWarningCtrl'\n      })\n      .otherwise({\n         redirectTo: '/'\n      });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/route.js","/*********************************************************\n * Copyright (C) 2014-2017 VMware, Inc. All rights reserved.\n *********************************************************/\n\nimport $ from 'jquery';\nimport JSCDKLogger from '../../jscdk/jscdkLogger';\n\nexport default function LauncherSettingsWindowController($scope, $rootScope,\n                                                         utilService,\n                                                         userGlobalPref, _,\n                                                         dialogService,\n                                                         mainService,\n                                                         viewClientModel,\n                                                         prefData,\n                                                         timezone, $timeout,\n                                                         jscdkLauncherInvoker) {\n   $scope.init = function() {\n      $scope.setUp();\n\n      /**\n       * set the timezone default value in the select menu when\n       * dialog is shown. This will make sure select menu has been\n       * included. The dialog display time is a later than run inin(),\n       * watch on the dialog to show default value.\n       */\n      $scope.$on('ngDialog.opened', function(e, $dialog) {\n         if ($dialog.name === 'SettingsWindowLauncher') {\n            $scope.showDefaultTimezone();\n            // When the dialog is show, set focus on close button.\n            $('#closeSettingsBtn').focus();\n         }\n      });\n\n      $scope.$on('$destroy', function() {\n         // save timezone setting when controller destroy\n         $scope.saveTimezone();\n      });\n   };\n\n   /**\n    * same logic exist in the setting-window-controller.js\n    * @return {boolean}\n    */\n   $scope.supportDPISync = function () {\n      return window.devicePixelRatio && window.devicePixelRatio > 1 &&\n               window.navigator.userAgent.toLowerCase().indexOf('iphone') === -1;\n   };\n\n   $scope.setUp = function() {\n      $scope.enableDPISync =\n         prefData.enableDPISync === 'true';\n      // OSX key mappings setting is available only on Mac OS.\n      $scope.areMacOSXKeyMappingsSupported = viewClientModel.mIsMacOS;\n      $scope.areMacOSXKeyMappingsEnabled =\n         prefData.useMacOSXKeyMappings !== 'false';\n      // Windows key setting.\n      $scope.isWindowsKeyEnabled =\n         prefData.enableWindowsKey === 'true';\n      // MP4 setting.\n      $scope.isMP4Enabled = prefData.enableMP4 === 'true';\n      $scope.isMP4Supported = viewClientModel.mIsChrome &&\n         (viewClientModel.mVersionChrome >= 45) && !viewClientModel.mIsAndroid;\n      if ($scope.isMP4Supported) {\n         try {\n            let testObject = new window.MediaSource();\n            testObject = null;\n         } catch (e) {\n            $scope.isMP4Supported = false;\n         }\n      }\n\n      $scope.isAutoTimezoneEnabled = !prefData.timezoneSync;\n\n      $scope.toggleSwitches = [\n         {\n            id: 'dpi_sync',\n            label: _('DPI_SYNC_M'),\n            isSupported: $scope.supportDPISync(),\n            isEnabled: $scope.enableDPISync,\n            toggle: $scope.toggleDPISync\n         },\n         {\n            id: 'osxKeys',\n            label: _('use_osx_key_mappings'),\n            isSupported: $scope.areMacOSXKeyMappingsSupported,\n            isEnabled: $scope.areMacOSXKeyMappingsEnabled,\n            toggle: $scope.toggleUseMacOSXKeyMappings\n         },\n         {\n            id: 'winKey',\n            label: _('enable_windows_key_t'),\n            text: _('enable_windows_key_m',\n               viewClientModel.mIsMacOS ? _('cmd_key') : _('win_key')),\n            isSupported: !viewClientModel.mIsIOS && !viewClientModel.mIsAndroid,\n            isEnabled: $scope.isWindowsKeyEnabled,\n            toggle: $scope.toggleWindowsKey\n         },\n         {\n            id: 'mp4',\n            label: _('allow_mp4_key_t'),\n            isSupported: $scope.isMP4Supported,\n            isEnabled: $scope.isMP4Enabled,\n            toggle: $scope.toggleMP4\n         },\n         {\n            id: 'timezone',\n            label: _('allow_timezone_key_t'),\n            isSupported: !$scope.mIsTouchDevice,\n            isEnabled: $scope.isAutoTimezoneEnabled,\n            toggle: $scope.toggleTimezone\n         }];\n   };\n\n   $scope.showDefaultTimezone = function() {\n      $timeout(function() {\n         let defaultTimezone = timezone.getWindowsTimezone();\n         $(\"#timezoneList\").val(defaultTimezone).change();\n      });\n   };\n\n   // Reset application.\n   $scope.resetApplications = function() {\n      let applicationSession = jscdkLauncherInvoker.applicationSessionArray;\n\n      if ($rootScope.applicationCanSet &&\n         applicationSession.length > 0) {\n         utilService.authenticationStatusCheck.callBackWhenUnlocked(\n            jscdkLauncherInvoker.resetAllApplicationSessions, null, mainService,\n            'reset-all', 'application');\n         $rootScope.applicationCanSet = false;\n      }\n\n   };\n\n   $scope.showResetConfirmDialog = function() {\n      let resetApplications = $scope.resetApplications;\n      if ($rootScope.applicationCanSet) {\n         $scope.closeThisDialog();\n         let dialog = dialogService.confirm({\n            data: {\n               title: _('dialog_title_resetapp'),\n               message: _('dialog_confirm_resetapp')\n            },\n            controller: ['$scope', function($scope) {\n               $scope.confirm = function() {\n                  resetApplications();\n                  dialog.close();\n               };\n            }]\n         });\n      }\n   };\n\n   $scope.toggleDPISync = function() {\n      $scope.enableDPISync = !$scope.enableDPISync;\n      userGlobalPref.updatePrefData({\n         name: 'enableDPISync',\n         text: $scope.enableDPISync ? \"true\" : \"false\",\n         action: 'enableDPISync'\n      });\n   };\n\n   // Method for toggling OSX key mappings.\n   $scope.toggleUseMacOSXKeyMappings = function() {\n      $scope.areMacOSXKeyMappingsEnabled = !$scope.areMacOSXKeyMappingsEnabled;\n      userGlobalPref.updatePrefData({\n         name: 'useMacOSXKeyMappings',\n         text: $scope.areMacOSXKeyMappingsEnabled ? 'true' : 'false',\n         action: 'useMacOSXKeyMappings'\n      });\n   };\n\n   // Method for toggling Windows key simulation functionality.\n   $scope.toggleWindowsKey = function() {\n      $scope.isWindowsKeyEnabled = !$scope.isWindowsKeyEnabled;\n\n      userGlobalPref.updatePrefData({\n         name: 'enableWindowsKey',\n         text: $scope.isWindowsKeyEnabled ? 'true' : 'false',\n         action: 'enableWindowsKey'\n      });\n   };\n\n   // Method for toggling MP4 functionality.\n   $scope.toggleMP4 = function() {\n      $scope.isMP4Enabled = !$scope.isMP4Enabled;\n\n      userGlobalPref.updatePrefData({\n         name: 'enableMP4',\n         text: $scope.isMP4Enabled ? 'true' : 'false',\n         action: 'enableMP4'\n      });\n   };\n\n   // Method for set timezone automatically functionality.\n   $scope.toggleTimezone = function() {\n      $scope.isAutoTimezoneEnabled = !$scope.isAutoTimezoneEnabled;\n      if (!!$scope.isAutoTimezoneEnabled) {\n         // is enable save , need a parameter.\n         userGlobalPref.updatePrefData({\n            name: 'timezoneSync',\n            text: '',\n            action: 'timezoneSync'\n         });\n      }\n      $scope.showDefaultTimezone();\n   };\n\n   // Save for timezone syncing.\n   $scope.saveTimezone = function() {\n      let timezoneList = $(\"#timezoneList\")[0],\n         timezone;\n      if ($scope.isAutoTimezoneEnabled) {\n         return;\n      }\n\n      if (!!timezoneList) {\n         timezone =\n            timezoneList.options[timezoneList.selectedIndex].value;\n      } else {\n         JSCDKLogger.debug('error: cann\\'t find timezone list');\n      }\n\n      if (!$scope.isAutoTimezoneEnabled && timezone) {\n         userGlobalPref.updatePrefData({\n            name: 'timezoneSync',\n            text: timezone,\n            action: 'timezoneSync'\n         });\n      }\n   };\n\n   $scope.onKeypress = function(evt) {\n      if (!!evt && evt.keyCode === 32) {\n         // Space key is pressed.\n         if (evt.target.children && evt.target.children[0]) {\n            $(evt.target.children[0]).trigger('click');\n         }\n         // Prevent default behavior.\n         evt.preventDefault();\n      }\n   };\n\n   $scope.init();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./launcher/setting-dialog/setting-dialog-controller.js","module.exports = __webpack_public_path__ + \"icons-1/Desktop2x.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./icons/Desktop2x.png\n// module id = 249\n// module chunks = 0","module.exports = __webpack_public_path__ + \"icons-1/attention2x.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./icons/attention2x.png\n// module id = 250\n// module chunks = 0","module.exports = __webpack_public_path__ + \"icons-1/icon-app-202x.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./icons/icon-app-202x.png\n// module id = 251\n// module chunks = 0","module.exports = __webpack_public_path__ + \"icons-1/icon-app-282x.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./icons/icon-app-282x.png\n// module id = 252\n// module chunks = 0","module.exports = __webpack_public_path__ + \"icons-1/shadow-desktop2x.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./icons/shadow-desktop2x.png\n// module id = 253\n// module chunks = 0","module.exports = __webpack_public_path__ + \"icons-1/spinner-login2x.gif\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./icons/spinner-login2x.gif\n// module id = 254\n// module chunks = 0","module.exports = __webpack_public_path__ + \"icons-1/spinner2x.gif\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./icons/spinner2x.gif\n// module id = 255\n// module chunks = 0","var path = 'common/commondialog/dialog_service_cancel_confirm.html';\nvar html = \"<div class=\\\"dialog-title\\\">{{ngDialogData.title}}</div>\\n<div class=\\\"dialog-content\\\">\\n   <div class=\\\"session-ops-window-text\\\">{{ngDialogData.message}}</div>\\n</div>\\n<div class=\\\"dialog-button-row\\\" dialog-tab-scope>\\n   <button class=\\\"modal-button-base modal-button-right modal-button-grey\\\" ng-click=\\\"confirm() || closeThisDialog()\\\" id=\\\"okDialogBtn\\\" dialog-tabindex=\\\"2\\\" dialog-prevent-key-up>\\n      {{(ngDialogData.buttonLabelConfirm) || ('OK' | i18n)}}\\n   </button>\\n   <button class=\\\"modal-button-base modal-button-right modal-button-blue ok-button\\\" ng-click=\\\"close() || closeThisDialog()\\\" id=\\\"cancelDialogBtn\\\" dialog-tabindex=\\\"1\\\" dialog-prevent-key-up>\\n      {{(ngDialogData.buttonLabelCancel) || ('CANCEL' | i18n)}}\\n   </button>\\n</div>\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./common/commondialog/dialog_service_cancel_confirm.html\n// module id = 256\n// module chunks = 0","var path = 'common/timezone/time-zone-list.html';\nvar html = \"<select id=\\\"timezoneList\\\" ng-disabled=\\\"isAutoTimezoneEnabled\\\" ng-class=\\\"{disable:isAutoTimezoneEnabled===true}\\\">\\n   <option value=\\\"Etc/GMT-12\\\">(UTC -12:00) {{\\\"Etc/GMT-12\\\" | i18n}}</option>\\n   <option value=\\\"Etc/GMT-11\\\">(UTC -11:00) {{\\\"Etc/GMT-11\\\" | i18n}}</option>\\n   <option value=\\\"Pacific/Honolulu\\\">(UTC -10:00) {{\\\"Pacific/Honolulu\\\" | i18n}}</option>\\n   <option value=\\\"America/Anchorage\\\">(UTC -09:00) {{\\\"America/Anchorage\\\" | i18n}}</option>\\n   <option value=\\\"America/Tijuana\\\">(UTC -08:00) {{\\\"America/Tijuana\\\" | i18n}}</option>\\n   <option value=\\\"America/Los_Angeles\\\">(UTC -08:00) {{\\\"America/Los_Angeles\\\" | i18n}}</option>\\n   <option value=\\\"America/Chihuahua\\\">(UTC -07:00) {{\\\"America/Chihuahua\\\" | i18n}}</option>\\n   <option value=\\\"America/Denver\\\">(UTC -07:00) {{\\\"America/Denver\\\" | i18n}}</option>\\n   <option value=\\\"America/Phoenix\\\">(UTC -07:00) {{\\\"America/Phoenix\\\" | i18n}}</option>\\n   <option value=\\\"America/Guatemala\\\">(UTC -06:00) {{\\\"America/Guatemala\\\" | i18n}}</option>\\n   <option value=\\\"America/Chicago\\\">(UTC -06:00) {{\\\"America/Chicago\\\" | i18n}}</option>\\n   <option value=\\\"America/Mexico_City\\\">(UTC -06:00) {{\\\"America/Mexico_City\\\" | i18n}}</option>\\n   <option value=\\\"America/Regina\\\">(UTC -06:00) {{\\\"America/Regina\\\" | i18n}}</option>\\n   <option value=\\\"America/Bogota\\\">(UTC -05:00) {{\\\"America/Bogota\\\" | i18n}}</option>\\n   <option value=\\\"America/New_York\\\">(UTC -05:00) {{\\\"America/New_York\\\" | i18n}}</option>\\n   <option value=\\\"America/Indiana/Indianapolis\\\">(UTC -05:00) {{\\\"America/Indiana/Indianapolis\\\" | i18n}}</option>\\n   <option value=\\\"America/Caracas\\\">(UTC -04:00) {{\\\"America/Caracas\\\" | i18n}}</option>\\n   <option value=\\\"America/Cuiaba\\\">(UTC -04:00) {{\\\"America/Cuiaba\\\" | i18n}}</option>\\n   <option value=\\\"America/La_Paz\\\">(UTC -04:00) {{\\\"America/La_Paz\\\" | i18n}}</option>\\n   <option value=\\\"America/Santiago\\\">(UTC -04:00) {{\\\"America/Santiago\\\" | i18n}}</option>\\n   <option value=\\\"America/Asuncion\\\">(UTC -04:00) {{\\\"America/Asuncion\\\" | i18n}}</option>\\n   <option value=\\\"America/Halifax\\\">(UTC -04:00) {{\\\"America/Halifax\\\" | i18n}}</option>\\n   <option value=\\\"America/St_Johns\\\">(UTC -03:30) {{\\\"America/St_Johns\\\" | i18n}}</option>\\n   <option value=\\\"America/Montevideo\\\">(UTC -03:00) {{\\\"America/Montevideo\\\" | i18n}}</option>\\n   <option value=\\\"America/Buenos_Aires\\\">(UTC -03:00) {{\\\"America/Buenos_Aires\\\" | i18n}}</option>\\n   <option value=\\\"America/Cayenne\\\">(UTC -03:00) {{\\\"America/Cayenne\\\" | i18n}}</option>\\n   <option value=\\\"America/Godthab\\\">(UTC -03:00) {{\\\"America/Godthab\\\" | i18n}}</option>\\n   <option value=\\\"America/Sao_Paulo\\\">(UTC -03:00) {{\\\"America/Sao_Paulo\\\" | i18n}}</option>\\n   <option value=\\\"America/Noronha\\\">(UTC -02:00) {{\\\"Etc/GMT+2\\\" | i18n}}</option>\\n   <option value=\\\"Atlantic/Azores\\\">(UTC -01:00) {{\\\"Atlantic/Azores\\\" | i18n}}</option>\\n   <option value=\\\"Atlantic/Cape_Verde\\\">(UTC -01:00) {{\\\"Atlantic/Cape_Verde\\\" | i18n}}</option>\\n   <option value=\\\"DMT\\\">(UTC) {{\\\"DMT\\\" | i18n}}</option>\\n   <option value=\\\"Africa/Casablanca\\\">(UTC +00:00) {{\\\"Africa/Casablanca\\\" | i18n}}</option>\\n   <option value=\\\"Europe/London\\\">(UTC +00:00) {{\\\"Europe/London\\\" | i18n}}</option>\\n   <option value=\\\"Atlantic/Reykjavik\\\">(UTC +00:00) {{\\\"Atlantic/Reykjavik\\\" | i18n}}</option>\\n   <option value=\\\"Europe/Berlin\\\">(UTC +01:00) {{\\\"Europe/Berlin\\\" | i18n}}</option>\\n   <option value=\\\"Europe/Budapest\\\">(UTC +01:00) {{\\\"Europe/Budapest\\\" | i18n}}</option>\\n   <option value=\\\"Europe/Paris\\\">(UTC +01:00) {{\\\"Europe/Paris\\\" | i18n}}</option>\\n   <option value=\\\"Europe/Warsaw\\\">(UTC +01:00) {{\\\"Europe/Warsaw\\\" | i18n}}</option>\\n   <option value=\\\"Africa/Lagos\\\">(UTC +01:00) {{\\\"Africa/Lagos\\\" | i18n}}</option>\\n   <option value=\\\"Africa/Windhoek\\\">(UTC +01:00) {{\\\"Africa/Windhoek\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Amman\\\">(UTC +02:00) {{\\\"Asia/Amman\\\" | i18n}}</option>\\n   <option value=\\\"Europe/Athens\\\">(UTC +02:00) {{\\\"Europe/Athens\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Beirut\\\">(UTC +02:00) {{\\\"Asia/Beirut\\\" | i18n}}</option>\\n   <option value=\\\"Africa/Cairo\\\">(UTC +02:00) {{\\\"Africa/Cairo\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Damascus\\\">(UTC +02:00) {{\\\"Asia/Damascus\\\" | i18n}}</option>\\n   <option value=\\\"Africa/Johannesburg\\\">(UTC +02:00) {{\\\"Africa/Johannesburg\\\" | i18n}}</option>\\n   <option value=\\\"Europe/Kiev\\\">(UTC +02:00) {{\\\"Europe/Kiev\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Jerusalem\\\">(UTC +02:00) {{\\\"Asia/Jerusalem\\\" | i18n}}</option>\\n   <option value=\\\"STAT\\\">(UTC +03:00) {{\\\"Europe/Minsk\\\" | i18n}}</option>\\n   <option value=\\\"Europe/Istanbul\\\">(UTC +03:00) {{\\\"Europe/Istanbul\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Baghdad\\\">(UTC +03:00) {{\\\"Asia/Baghdad\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Riyadh\\\">(UTC +03:00) {{\\\"Asia/Riyadh\\\" | i18n}}</option>\\n   <option value=\\\"Europe/Moscow\\\">(UTC +03:00) {{\\\"Europe/Moscow\\\" | i18n}}</option>\\n   <option value=\\\"Africa/Nairobi\\\">(UTC +03:00) {{\\\"Africa/Nairobi\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Tehran\\\">(UTC +03:30) {{\\\"Asia/Tehran\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Dubai\\\">(UTC +04:00) {{\\\"Asia/Dubai\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Baku\\\">(UTC +04:00) {{\\\"Asia/Baku\\\" | i18n}}</option>\\n   <option value=\\\"Indian/Mauritius\\\">(UTC +04:00) {{\\\"Indian/Mauritius\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Tbilisi\\\">(UTC +04:00) {{\\\"Asia/Tbilisi\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Yerevan\\\">(UTC +04:00) {{\\\"Asia/Yerevan\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Kabul\\\">(UTC +04:30) {{\\\"Asia/Kabul\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Yekaterinburg\\\">(UTC +05:00) {{\\\"Asia/Yekaterinburg\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Karachi\\\">(UTC +05:00) {{\\\"Asia/Karachi\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Tashkent\\\">(UTC +05:00) {{\\\"Asia/Tashkent\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Calcutta\\\">(UTC +05:30) {{\\\"Asia/Calcutta\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Colombo\\\">(UTC +05:30) {{\\\"Asia/Colombo\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Katmandu\\\">(UTC +05:45) {{\\\"Asia/Katmandu\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Almaty\\\">(UTC +06:00) {{\\\"Asia/Almaty\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Dhaka\\\">(UTC +06:00) {{\\\"Asia/Dhaka\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Novosibirsk\\\">(UTC +06:00) {{\\\"Asia/Novosibirsk\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Rangoon\\\">(UTC +06:30) {{\\\"Asia/Rangoon\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Bangkok\\\">(UTC +07:00) {{\\\"Asia/Bangkok\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Krasnoyarsk\\\">(UTC +07:00) {{\\\"Asia/Krasnoyarsk\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Shanghai\\\">(UTC +08:00) {{\\\"Asia/Shanghai\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Irkutsk\\\">(UTC +08:00) {{\\\"Asia/Irkutsk\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Singapore\\\">(UTC +08:00) {{\\\"Asia/Singapore\\\" | i18n}}</option>\\n   <option value=\\\"Australia/Perth\\\">(UTC +08:00) {{\\\"Australia/Perth\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Taipei\\\">(UTC +08:00) {{\\\"Asia/Taipei\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Ulaanbaatar\\\">(UTC +08:00) {{\\\"Asia/Ulaanbaatar\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Tokyo\\\">(UTC +09:00) {{\\\"Asia/Tokyo\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Seoul\\\">(UTC +09:00) {{\\\"Asia/Seoul\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Yakutsk\\\">(UTC +09:00) {{\\\"Asia/Yakutsk\\\" | i18n}}</option>\\n   <option value=\\\"Australia/Adelaide\\\">(UTC +09:30) {{\\\"Australia/Adelaide\\\" | i18n}}</option>\\n   <option value=\\\"Australia/Darwin\\\">(UTC +09:30) {{\\\"Australia/Darwin\\\" | i18n}}</option>\\n   <option value=\\\"Australia/Brisbane\\\">(UTC +10:00) {{\\\"Australia/Brisbane\\\" | i18n}}</option>\\n   <option value=\\\"Australia/Sydney\\\">(UTC +10:00) {{\\\"Australia/Sydney\\\" | i18n}}</option>\\n   <option value=\\\"Pacific/Port_Moresby\\\">(UTC +10:00) {{\\\"Pacific/Port_Moresby\\\" | i18n}}</option>\\n   <option value=\\\"Australia/Hobart\\\">(UTC +10:00) {{\\\"Australia/Hobart\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Vladivostok\\\">(UTC +10:00) {{\\\"Asia/Vladivostok\\\" | i18n}}</option>\\n   <option value=\\\"Australia/Lord_Howe\\\">(UTC +11:00) {{\\\"Australia/Lord_Howe\\\" | i18n}}</option>\\n   <option value=\\\"Etc/GMT+11\\\">(UTC +11:00) {{\\\"Asia/Magadan\\\" | i18n}}</option>\\n   <option value=\\\"PONT\\\">(UTC +11:00) {{\\\"Pacific/Guadalcanal\\\" | i18n}}</option>\\n   <option value=\\\"Pacific/Auckland\\\">(UTC +12:00) {{\\\"Pacific/Auckland\\\" | i18n}}</option>\\n   <option value=\\\"Etc/GMT+12\\\">(UTC +12:00) {{\\\"Etc/GMT+12\\\" | i18n}}</option>\\n   <option value=\\\"Pacific/Fiji\\\">(UTC +12:00) {{\\\"Pacific/Fiji\\\" | i18n}}</option>\\n   <option value=\\\"Asia/Kamchatka\\\">(UTC +12:00) {{\\\"Asia/Kamchatka\\\" | i18n}}</option>\\n   <option value=\\\"Tonga\\\">(UTC +13:00) {{\\\"Pacific/Tongatapu\\\" | i18n}}</option>\\n</select>\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./common/timezone/time-zone-list.html\n// module id = 258\n// module chunks = 0","var path = 'desktop/clipboard/clipboard_template.html';\nvar html = \"<div class='base-panel clipboard-panel ng-hide' ng-click=\\\"focusInput()\\\" ng-controller='clipboardController' ng-show=\\\"showClipboardPanel\\\">\\n\\n   <div ng-class=\\\"{'clipboard-focused': focused, 'clipboard-unfocused': !focused}\\\">\\n      <div class=\\\"clipboard-header clipboard-handle\\\">\\n         <div class=\\\"clipboard-label unselectable\\\">{{'COPY_PASTE' | i18n}}</div>\\n         <div class=\\\"clipboard-icon close\\\" ng-click=\\\"toggleClipboardPanel($event)\\\" title=\\\"{{'CLOSE_CLIPBOARD_T' | i18n}}\\\"></div>\\n         <div class=\\\"clipboard-icon minimize\\\" ng-if=\\\"showClipboardText\\\" ng-click=\\\"toggleClipboardText()\\\" title=\\\"{{'MINIMIZE_CLIPBOARD_T' | i18n}}\\\"></div>\\n         <div class=\\\"clipboard-icon restore\\\" ng-if=\\\"!showClipboardText\\\" ng-click=\\\"toggleClipboardText()\\\" title=\\\"{{'RESTORE_CLIPBOARD_T' | i18n}}\\\"></div>\\n         <div class=\\\"clipboard-icon help\\\" ng-click=\\\"openClipboardHelp()\\\" title=\\\"{{'CLIPBOARD_HELP_T' | i18n}}\\\"></div>\\n      </div>\\n      <div class=\\\"clipboard-input-container\\\">\\n         <label for=\\\"clipboard-input\\\">clipboard-input</label>\\n         <clipboard-input id=\\\"clipboard-input\\\" ng-copy=\\\"clipboardCopy($event)\\\" ng-paste=\\\"clipboardPaste($event)\\\" ng-focus=\\\"clipboardFocus()\\\" ng-blur=\\\"clipboardBlur()\\\"></clipboard-input>\\n      </div>\\n      <div class='clipboard-content' ng-focus=\\\"focusInput()\\\" ng-show=\\\"showClipboardText\\\">\\n         <div class=\\\"clipboard-area clipboard-handle unselectable\\\" ng-class=\\\"{'inactive': !hasClipboardData, 'focused': hasClipboardData && focused}\\\" ng-show=\\\"showClipboardText\\\">\\n            <span id=\\\"clipboard-text-element\\\" ng-if=\\\"hasClipboardData\\\" class=\\\"text-display\\\">{{clipboard.text}}</span>\\n            <span id=\\\"clipboard-policy-text-element\\\" ng-if=\\\"!hasClipboardData\\\" class=\\\"text-display\\\">{{clipboardPolicy.text}}</span>\\n         </div>\\n      </div>\\n      <div class=\\\"clipboard-footer clipboard-handle\\\">\\n         <span class=\\\"clipboard-clear\\\" ng-click=\\\"clipboardClear()\\\" ng-show=\\\"hasClipboardData && showClipboardText\\\">{{'CLEAR_CLIPBOARD_T' | i18n}}</span>\\n      </div>\\n   </div>\\n\\n   <panel-notification></panel-notification>\\n</div>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./desktop/clipboard/clipboard_template.html\n// module id = 259\n// module chunks = 0","var path = 'desktop/common/desktop.html';\nvar html = \"<div id=\\\"desktop-controller-place-holder\\\"></div>\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./desktop/common/desktop.html\n// module id = 260\n// module chunks = 0","var path = 'desktop/filetransfer/file_transfer_template.html';\nvar html = \"<div class='base-panel file-transfer-panel ng-hide' ng-controller='fileTransferController' ng-click=\\\"focusInput()\\\" ng-show=\\\"showFileTransferPanel\\\">\\n   <div file-drop=\\\"uploadHandler(event)\\\" ng-class=\\\"{'file-transfer-focused': focused, 'file-transfer-unfocused': !focused}\\\">\\n      <div class=\\\"file-transfer-header file-transfer-handle\\\">\\n         <div class=\\\"file-transfer-title\\\" >{{'FILE_TRANSFER_TITLE' | i18n}}</div>\\n         <div class=\\\"file-transfer-icon close\\\" ng-click=\\\"toggleFileTransferPanel($event)\\\" title=\\\"{{'CLOSE_FT_T' | i18n}}\\\"></div>\\n         <div class=\\\"file-transfer-icon help\\\" ng-click=\\\"openFileTransferHelp()\\\" title=\\\"{{'FT_HELP_T' | i18n}}\\\"></div>\\n      </div>\\n      <div class=\\\"file-transfer-input-container\\\">\\n         <label for=\\\"file-transfer-input-container\\\">file-transfer-container</label>\\n         <file-transfer-input id=\\\"file-transfer-input-container\\\" ng-focus=\\\"ftPanelFocus()\\\" ng-blur=\\\"ftPanelBlur()\\\"></file-transfer-input>\\n      </div>\\n      <div class=\\\"file-content\\\">\\n         <div class=\\\"file-area\\\">\\n            <div class=\\\"file-area-header\\\">\\n               <div ng-if=\\\"downloadEnabled\\\" class=\\\"file-transfer-tab download-tab\\\" ng-click=\\\"switchFileTab(PANEL_TAB.DOWNLOAD)\\\" ng-class=\\\"{'active': showFileDownload}\\\">{{'FILE_DOWNLOAD' | i18n}}</div>\\n               <div ng-if=\\\"uploadEnabled\\\" class=\\\"file-transfer-tab upload-tab\\\" ng-click=\\\"switchFileTab(PANEL_TAB.UPLOAD)\\\" ng-class=\\\"{'active': showFileUpload}\\\">{{'FILE_UPLOAD' | i18n}}</div>\\n            </div>\\n            <div ng-if=\\\"downloadEnabled\\\" ng-show=\\\"showFileDownload\\\" class=\\\"unselectable file-list-container\\\">\\n               <ul id=\\\"ft-download-list\\\" class=\\\"file-content-list\\\" ng-show=\\\"downloadFiles.length != 0\\\">\\n                  <li class=\\\"file-item\\\" ng-repeat=\\\"file in downloadFiles\\\">\\n                     <span class=\\\"file-name\\\">{{file.relPath}}</span>\\n                     <span class=\\\"readable-file-size\\\">{{'- ' + file.readableSize}}</span>\\n                     <span ng-if=\\\"file.transferError == false\\\" ng-style=\\\"{'width': file.progress + '%'}\\\" class=\\\"transfer-progress\\\" ng-class=\\\"{'transfer-done': file.progress == 100}\\\"></span>\\n                     <span ng-if=\\\"file.transferError == true\\\" class=\\\"transfer-progress transfer-error\\\"></span>\\n                     <span ng-if=\\\"file.stopTransfer == true\\\" class=\\\"transfer-progress transfer-stop\\\"><div class=\\\"file-transfer-file-icon stopped-transfer\\\"></div></span>\\n                     <div ng-if=\\\"file.transferError == true\\\" title=\\\"{{'FT_FAILED_HINT' | i18n}}\\\" class=\\\"file-transfer-file-icon transfer-error\\\"></div>\\n                     <div ng-if=\\\"file.progress == 100\\\" ng-click=\\\"saveFile(file)\\\" class=\\\"file-transfer-file-icon save-file\\\"></div>\\n                     <div ng-if=\\\"file.transferError == false && file.stopTransfer == false && file.progress < 100\\\" ng-click=\\\"stopFileDownload(file)\\\" class=\\\"file-transfer-file-icon cancel-upload\\\"></div>\\n                  </li>\\n               </ul>\\n               <div id=\\\"ft-download-step-hint\\\" class=\\\"hint-container file-transfer-handle\\\" ng-show=\\\"downloadFiles.length == 0 && downloadEnabled == true\\\">\\n                  <p class=\\\"hint-title\\\">{{'FT_DOWNLOAD_HINT_TITLE' | i18n}}</p>\\n                  <div class=\\\"hint-step-container\\\">\\n                     <p>{{'FT_DOWNLOAD_HINT1' | i18n}}</p>\\n                     <p>{{'FT_DOWNLOAD_HINT2' | i18n : modKey }}</p>\\n                     <p>{{'FT_DOWNLOAD_HINT3.1' | i18n}}<span class=\\\"file-transfer-hint-icon save-file\\\"></span>{{'FT_DOWNLOAD_HINT3.2' | i18n}}</p>\\n                  </div>\\n               </div>\\n               <div id=\\\"ft-download-disable-hint\\\" class=\\\"hint-container file-transfer-handle\\\" ng-show=\\\"downloadEnabled == false\\\">\\n                  <p class=\\\"hint-disable-title\\\">{{'FT_DOWNLOAD_DISABLE_HINT_TITLE' | i18n}}</p>\\n               </div>\\n            </div>\\n            <div ng-if=\\\"uploadEnabled\\\" ng-show=\\\"showFileUpload\\\" class=\\\"unselectable file-list-container\\\">\\n               <ul id=\\\"ft-upload-list\\\" class=\\\"file-content-list\\\" ng-show=\\\"uploadFiles.length != 0\\\">\\n                  <li ng-repeat=\\\"file in uploadFiles\\\" class=\\\"file-item\\\">\\n                     <span class=\\\"file-name\\\">{{file.relPath}}</span>\\n                     <span class=\\\"readable-file-size\\\">{{'- ' + file.readableSize}}</span>\\n                     <span ng-if=\\\"file.transferError == false\\\" ng-style=\\\"{'width': file.progress + '%'}\\\" class=\\\"transfer-progress\\\" ng-class=\\\"{'transfer-done': file.progress == 100}\\\"></span>\\n                     <span ng-if=\\\"file.transferError == true\\\" class=\\\"transfer-progress transfer-error\\\"></span>\\n                     <span ng-if=\\\"file.stopTransfer == true\\\" class=\\\"transfer-progress transfer-stop\\\"><div class=\\\"file-transfer-file-icon stopped-transfer\\\"></div></span>\\n                     <div ng-if=\\\"file.transferError == true\\\" title=\\\"{{'FT_FAILED_HINT' | i18n}}\\\" class=\\\"file-transfer-file-icon transfer-error\\\"></div>\\n                     <div ng-if=\\\"file.transferError == false && file.stopTransfer == false && file.progress < 100\\\" ng-click=\\\"stopFileUpload(file)\\\" class=\\\"file-transfer-file-icon cancel-upload\\\"></div>\\n                  </li>\\n                  <div class=\\\"btn-hint-container\\\">\\n                     <button ng-show=\\\"uploadFiles.length != 0\\\" onclick=\\\"chooseUploadFiles()\\\" class=\\\"choose-files-button\\\">{{'FT_CHOOSE_FILES_BTN2' | i18n}}</button>\\n                  </div>\\n               </ul>\\n               <div id=\\\"ft-upload-step-hint\\\" class=\\\"hint-container file-transfer-handle\\\" ng-show=\\\"uploadFiles.length == 0 && uploadEnabled == true\\\">\\n                  <p class=\\\"hint-title\\\">{{'FT_UPLOAD_HINT_TITLE' | i18n}}</p>\\n                  <form>\\n                     <label for=\\\"upload-file-input\\\">upload-file-input</label>\\n                     <input type=\\\"file\\\" multiple=\\\"multiple\\\" id=\\\"upload-file-input\\\" class=\\\"upload-file-input\\\" file-change=\\\"uploadHandler(event)\\\"/>\\n                  </form>\\n                  <div class=\\\"hint-step-container\\\">\\n                     <p>{{'FT_UPLOAD_HINT1' | i18n}}</p>\\n                     <p>{{'FT_UPLOAD_HINT2' | i18n}}</p>\\n                     <p>{{'FT_UPLOAD_HINT3' | i18n}}</p>\\n                  </div>\\n                  <button onclick=\\\"chooseUploadFiles()\\\" class=\\\"choose-files-button\\\">{{'FT_CHOOSE_FILES_BTN' | i18n}}</button>\\n               </div>\\n               <div id=\\\"ft-upload-disable-hint\\\" class=\\\"hint-container file-transfer-handle\\\" ng-show=\\\"uploadEnabled == false\\\">\\n                  <p class=\\\"hint-disable-title\\\">{{'FT_UPLOAD_DISABLE_HINT_TITLE' | i18n}}</p>\\n               </div>\\n            </div>\\n         </div>\\n      </div>\\n      <div class=\\\"file-transfer-footer file-transfer-handle\\\">\\n         <span id=\\\"ft-clear-upload-list-btn\\\" class=\\\"file-transfer-clear\\\" ng-show=\\\"showFileUpload\\\" ng-click=\\\"clearUploadList()\\\">{{'CLEAR_LIST' | i18n}}</span>\\n         <span id=\\\"ft-clear-download-list-btn\\\" class=\\\"file-transfer-clear\\\" ng-show=\\\"showFileDownload\\\" ng-click=\\\"clearDownloadList()\\\">{{'CLEAR_LIST' | i18n}}</span>\\n      </div>\\n   </div>\\n\\n   <panel-notification></panel-notification>\\n</div>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./desktop/filetransfer/file_transfer_template.html\n// module id = 261\n// module chunks = 0","var path = 'desktop/multimon/multimon-setting-window/multimon_setting_window_template.html';\nvar html = \"<scrollable-dialog>\\n   <div class=\\\"dialog-title\\\">{{'MULTIMON' | i18n}}</div>\\n\\n   <div class=\\\"dialog-content\\\" fuzzy-free>\\n      <div class=\\\"about-dialog-content selectable\\\">\\n         {{ 'MM_INTRODUCTION_ADD' | i18n }}\\n      </div>\\n\\n      <div class=\\\"settings-container\\\">\\n         <div id=\\\"add-monitor-detector-btn\\\" class=\\\"modal-button-base modal-button-blue modal-button-add-display\\\" ng-class=\\\"{'disable' : !addButtonEnabled}\\\" ng-click=\\\"addButtonEnabled && addMonitor()\\\" title=\\\"{{'MM_ADD_MONITOR_T' | i18n}}\\\">{{'MM_ADD' | i18n}}</div>\\n      </div>\\n\\n      <div class=\\\"about-dialog-content selectable\\\">\\n         <canvas id=\\\"topology-preview-canvas\\\" width=\\\"380\\\" height=\\\"220\\\" class=\\\"multimon-preview\\\"></canvas>\\n      </div>\\n   </div>\\n\\n   <div class=\\\"dialog-button-row\\\">\\n      <div id=\\\"multimon-setting-cancel\\\" class=\\\"modal-button-base modal-button-right modal-button-blue\\\" ng-click=\\\"multimonCancelClicked()\\\">\\n         {{'CANCEL' | i18n}}\\n      </div>\\n      <div id=\\\"multimon-setting-ok\\\" class=\\\"modal-button-base modal-button-right modal-button-blue no-disable-hover\\\" ng-class=\\\"{'disable' : !startConfiguring || hasConflictedDetector || !allReady}\\\" ng-click=\\\"multimonOkClicked()\\\">\\n         {{ 'OK' | i18n }}\\n      </div>\\n   </div>\\n</scrollable-dialog>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./desktop/multimon/multimon-setting-window/multimon_setting_window_template.html\n// module id = 263\n// module chunks = 0","var path = 'desktop/re-auth/dialog_service_reauth.html';\nvar html = \"<div class=\\\"ui-center-panel desktop-reauth\\\" >\\n    <div class=\\\"ui-pattern-logo\\\"></div>\\n    <div ng-controller=\\\"reAuthCtrl\\\" class=\\\"ui-widget-home\\\" ng-if=\\\"!$root.reWindowsPasswordExpired\\\">\\n        <div class=\\\"ui-panel-content \\\">\\n           <div class=\\\"alert alert-danger\\\">\\n              <span class=\\\"error\\\" ng-if=\\\"error\\\"></span>{{error}}\\n           </div>\\n           <form id=\\\"loginForm\\\" name=\\\"loginForm\\\" role=\\\"form\\\" class=\\\"form-horizontal\\\" method=\\\"post\\\" autocomplete=\\\"off\\\" novalidate>\\n              <input id=\\\"username\\\" name=\\\"username\\\" type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_username' | i18n}}\\\" ng-model=\\\"credential.username\\\" ng-keypress=\\\"keyPress($event, loginForm, true)\\\" ng-trim=\\\"false\\\" ng-disabled=\\\"userNameReadOnly\\\" required view-autofocus=\\\"{{!userNameReadOnly}}\\\">\\n              <input id=\\\"password\\\" name=\\\"password\\\" unstorable-password class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_password' | i18n}}\\\" ng-model=\\\"credential.password\\\" ng-keypress=\\\"keyPress($event, loginForm, true)\\\" ng-trim=\\\"false\\\" view-autofocus=\\\"{{userNameReadOnly}}\\\">\\n              <select id=\\\"domain\\\" name=\\\"domain\\\" class=\\\"form-control form-select\\\" ng-model=\\\"credential.domain\\\" ng-keypress=\\\"keyPress($event, loginForm, true)\\\"  ng-disabled=\\\"domainReadOnly\\\" ng-options=\\\"domain for domain in domains\\\" domain-select-menu>\\n              </select>\\n           </form>\\n        </div>\\n        <div class=\\\"ui-panel-footer\\\">\\n           <button id=\\\"loginButton\\\" type=\\\"submit\\\" class=\\\"btn btn-primary\\\" ng-class=\\\"{btnPrimaryWaiting:ajaxBusy && loadingAllow}\\\" ng-click=\\\"login(loginForm,true)\\\" ng-disabled=\\\"(ajaxBusy && loadingAllow) || !loginForm.$valid\\\">{{ (ajaxBusy && loadingAllow) ? 'dialog_btn_signin_waiting' : 'dialog_btn_signin' | i18n}}<progress-circle></progress-circle></button>\\n           <button id=\\\"cancelLoginBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\" >{{'dialog_quit_cancel' | i18n}}</button>\\n        </div>\\n    </div>\\n    <div ng-controller=\\\"reAuthChangePasswordCtrl\\\" class=\\\"ui-widget-home\\\" ng-if=\\\"$root.reWindowsPasswordExpired\\\">\\n        <div class=\\\"ui-panel-content\\\">\\n            <div ng-if=\\\"!error\\\" class=\\\"ui-login-hint-text\\\">{{'dialog_prompt_changepwd' | i18n}}</div>\\n            <div class=\\\"alert alert-danger\\\" ng-if=\\\"error\\\">\\n                <span class=\\\"error\\\"></span>{{error}}\\n            </div>\\n            <form id=\\\"changePasswordForm\\\" name=\\\"changePasswordForm\\\" role=\\\"form\\\" class=\\\"change-password-form form-horizontal\\\" method=\\\"post\\\" autocomplete=\\\"off\\\" novalidate>\\n                <input id=\\\"username\\\" name=\\\"username\\\" type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_username' | i18n}}\\\" ng-model=\\\"username\\\" readonly>\\n\\n                <input id=\\\"oldpassword\\\" name=\\\"oldpassword\\\" unstorable-password class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_oldpwd' | i18n}}\\\" ng-model=\\\"credential.oldpassword\\\" ng-keypress=\\\"keyPress($event, changePasswordForm)\\\" ng-trim=\\\"false\\\" view-autofocus=\\\"true\\\">\\n\\n\\n                <input id=\\\"newpassword1\\\" name=\\\"newpassword1\\\" unstorable-password class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_newpwd' | i18n}}\\\" ng-model=\\\"credential.newpassword\\\" ng-keypress=\\\"keyPress($event, changePasswordForm)\\\" equal-to=\\\"{{credential.newpasswordRepeat}}\\\" ng-trim=\\\"false\\\">\\n\\n                <div class=\\\"ui-text-left-align\\\">\\n                    <input id=\\\"newpassword2\\\" name=\\\"newpassword2\\\" unstorable-password class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_newpwd2' | i18n}}\\\" ng-model=\\\"credential.newpasswordRepeat\\\" ng-keypress=\\\"keyPress($event, changePasswordForm)\\\" equal-to=\\\"{{credential.newpassword}}\\\" ng-trim=\\\"false\\\">\\n                    <label for=\\\"newpassword2\\\" class=\\\"ui-password-dismatch-text\\\" ng-show=\\\"!changePasswordForm.$valid\\\">{{'validation_equals' | i18n}}</label>\\n                </div>\\n            </form>\\n        </div>\\n        <div class=\\\"ui-panel-footer\\\">\\n            <button id=\\\"changePasswordSubmitBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-primary\\\" ng-class=\\\"{btnPrimaryWaiting:ajaxBusy&& loadingAllow}\\\" ng-click=\\\"changePassword(changePasswordForm)\\\" ng-disabled=\\\"ajaxBusy&& loadingAllow\\\">{{ (ajaxBusy && loadingAllow) ? 'dialog_btn_signin_waiting' : 'dialog_btn_signin' | i18n}}<progress-circle></progress-circle></button>\\n            <button id=\\\"changePasswordCancelBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\">{{'dialog_quit_cancel' | i18n}}</button>\\n        </div>\\n    </div>\\n</div>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./desktop/re-auth/dialog_service_reauth.html\n// module id = 264\n// module chunks = 0","var path = 'desktop/setting-dialog/settings_window_template.html';\nvar html = \"<scrollable-dialog>\\n   <div class=\\\"dialog-title\\\">{{'SETTINGS' | i18n}}</div>\\n\\n   <div class=\\\"dialog-content\\\" fuzzy-free>\\n      <div ng-repeat=\\\"switch in toggleSwitches\\\" ng-if=\\\"switch.isSupported\\\">\\n         <div class=\\\"settings-container\\\">\\n            <div class=\\\"settings-toggle-container\\\">\\n               <div class=\\\"settings-switch-label\\\">{{'OFF_CAPS_M' | i18n}}</div>\\n               <div class=\\\"toggle-opt\\\">\\n                  <input class=\\\"tgl tgl-light\\\" id=\\\"{{switch.id}}\\\" type=\\\"checkbox\\\" ng-show=\\\"false\\\" ng-model=\\\"switch.isEnabled\\\" ng-change=\\\"switch.toggle()\\\">\\n                  <label class=\\\"tgl-btn unselectable\\\" for=\\\"{{switch.id}}\\\"></label>\\n               </div>\\n               <div class=\\\"settings-switch-label\\\">{{'ON_CAPS_M' | i18n}}</div>\\n            </div>\\n            <span class=\\\"settings-label\\\">{{switch.label}}</span>\\n            <span class=\\\"settings-text\\\" ng-show=\\\"{{!!switch.text}}\\\">{{switch.text}}</span>\\n         </div>\\n         <div class=\\\"settings-separator\\\" ng-show='switch.isSupported'></div>\\n      </div>\\n\\n      <div class=\\\"settings-container\\\">\\n         <div class=\\\"modal-button-base modal-button-blue modal-button-reset\\\" ng-class=\\\"{'disable' : !resetButtonEnabled}\\\" ng-click=\\\"resetButtonEnabled && resetApplications()\\\" title=\\\"{{'RESET_APPS_T' | i18n}}\\\">{{'RESET_M' | i18n}}</div>\\n         <span class=\\\"settings-label\\\">{{'RESET_APPS_M' | i18n}}</span>\\n         <span class=\\\"settings-text warning\\\">{{'UNSAVED_WORK_M' | i18n}}</span>\\n      </div>\\n   </div>\\n\\n   <div class=\\\"dialog-button-row\\\">\\n      <div class=\\\"modal-button-base modal-button-right modal-button-blue\\\" ng-click=\\\"closeThisDialog()\\\">\\n         {{'CLOSE' | i18n}}\\n      </div>\\n   </div>\\n</scrollable-dialog>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./desktop/setting-dialog/settings_window_template.html\n// module id = 265\n// module chunks = 0","var path = 'desktop/sidebar/sidebar_template.html';\nvar html = \"<div id=\\\"sidebar\\\" class=\\\"sidebar-panel unselectable ng-hide\\\" ng-show=\\\"showPanel\\\">\\n   <div class=\\\"head-panel\\\">\\n      <div class=\\\"color-bar\\\"></div>\\n      <div>\\n         <div class=\\\"horizon-logo-image\\\" title=\\\"{{'ABOUT_T' | i18n}}\\\" ng-click=\\\"aboutClicked()\\\"></div>\\n         <div class=\\\"head-panel-button-bar\\\">\\n            <ul>\\n               <li id=\\\"keyboard\\\"\\n                   class=\\\"icon-button icon-keyboard-image\\\"\\n                   ng-show=\\\"isSupportedMobileDevice()\\\"\\n                   ng-click=\\\"toggleKeyboard()\\\"\\n                   title=\\\"{{'TOGGLE_KEYBOARD' | i18n}}\\\"></li>\\n               <li id=\\\"cad\\\"\\n                   class=\\\"icon-button icon-cad-image icon-button-hover\\\"\\n                   ng-class=\\\"{'disable': runningItems.length === 0}\\\"\\n                   ng-click=\\\"runningItems.length !== 0 && ctrlAltDeleteClicked()\\\"\\n                   title=\\\"{{'CTRL_ALT_DEL' | i18n}}\\\"></li>\\n               <li id=\\\"fileTransfer\\\"\\n                   class=\\\"icon-button icon-file-transfer-image icon-button-hover\\\"\\n                   ng-hide=\\\"isTouchDevice()\\\"\\n                   ng-class=\\\"{'disable': isCurrentItemApp === true || isRunningDesktopExist() === false || $root.disableFTPanel}\\\"\\n                   ng-click=\\\"isCurrentItemApp !== true && isRunningDesktopExist() === true && !$root.disableFTPanel && openFileTransferPanel()\\\"\\n                   title=\\\"{{(isCurrentItemApp === true ? 'DISABLE_FT_FOR_APP' : ($root.disableFTPanel ? 'DISABLE_FT_PANEL' : 'OPEN_FILE_TRANSFER')) | i18n}}\\\"></li>\\n               <li id=\\\"clipboard\\\"\\n                   class=\\\"icon-button icon-clipboard-image icon-button-hover\\\" ng-click=\\\"openClipboardClicked()\\\" title=\\\"{{'OPEN_COPY_PASTE_T' | i18n}}\\\"\\n                   ng-hide=\\\"isTouchDevice()\\\"></li>\\n               <li id=\\\"contextMenu\\\"\\n                   class=\\\"icon-button icon-context-menu-image icon-button-hover\\\" ng-click=\\\"globalContextMenuClicked($event)\\\" title=\\\"{{'OPEN_MENU_T' | i18n}}\\\"></li>\\n            </ul>\\n         </div>\\n      </div>\\n      <div class=\\\"search-panel\\\">\\n         <div class=\\\"search-icon\\\"></div>\\n         <label for=\\\"search-input\\\">{{'SEARCH_PH_M' | i18n}}</label>\\n         <input id=\\\"search-input\\\" class=\\\"search-input\\\" ng-model=\\\"queryText.name\\\" type=\\\"search\\\" placeholder=\\\"{{'SEARCH_PH_M' | i18n}}\\\"/>\\n      </div>\\n      <div class=\\\"separator\\\"></div>\\n   </div>\\n   <div class=\\\"apps-panel\\\">\\n      <div class=\\\"running-title-panel\\\">\\n         <div class=\\\"running-title\\\">{{'RUNNING_T' | i18n}}</div>\\n      </div>\\n      <div ng-show=\\\"!runningItems || runningItems.length === 0\\\" class=\\\"no-items-label\\\">{{'NO_RUNNING_ITEMS_T' | i18n}}</div>\\n      <div class=\\\"running-content-panel\\\">\\n         <div ng-repeat=\\\"runningItem in runningItems | runningItemsFilter : queryText.name\\\">\\n         <ul class=\\\"running-app\\\">\\n            <ul class=\\\"icon-and-name-container\\\" ng-click=\\\"activateItem(runningItem)\\\" title=\\\"{{'BRING_ITEM_TO_FRONT_T' | i18n : runningItem.name}}\\\">\\n               <li ng-class=\\\"{'running-app-border': !appHasFocus(runningItem), 'focused-app-border': appHasFocus(runningItem)}\\\">\\n                  <img alt=\\\"{{runningItem.name}} icon\\\" ng-class=\\\"{'running-app-icon': !appHasFocus(runningItem), 'focused-app-icon': appHasFocus(runningItem), 'nonready' : !util.isConnected(runningItem)}\\\" ng-src=\\\"{{runningItem.iconSrc}}\\\" ng-show=\\\"!util.isDesktop(runningItem)\\\"/>\\n                  <img alt=\\\"{{runningItem.name}} icon\\\" ng-class=\\\"{'running-app-icon': !appHasFocus(runningItem), 'focused-app-icon': appHasFocus(runningItem), 'nonready' : !util.isConnected(runningItem)}\\\"  src=\\\"\" + require(\"../../icons/desktop-small2x.png\") + \"\\\" ng-show=\\\"util.isDesktop(runningItem) && !runningItem.isShadow\\\"/>\\n                  <img alt=\\\"{{runningItem.name}} icon\\\" ng-class=\\\"{'running-app-icon': !appHasFocus(runningItem), 'focused-app-icon': appHasFocus(runningItem), 'nonready' : !util.isConnected(runningItem)}\\\"  src=\\\"\" + require(\"../../icons/shadow-desktop-small2x.png\") + \"\\\" ng-show=\\\"util.isDesktop(runningItem) && runningItem.isShadow\\\"/>\\n                  <div class=\\\"running-item-overlay loading\\\" ng-show=\\\"util.isConnecting(runningItem)\\\"></div>\\n                  <div class=\\\"running-item-overlay attention\\\" ng-show=\\\"util.isDisconnected(runningItem)\\\"></div>\\n               </li>\\n               <li ng-class=\\\"{'focused-app-name': appHasFocus(runningItem), 'running-app-name': true}\\\">\\n                  {{runningItem.name}}\\n               </li>\\n            </ul>\\n            <li class=\\\"running-app-window-count-container\\\" ng-show=\\\"!util.isDesktop(runningItem) && runningItem.instances.length > 0 && (!queryText || queryText.name ==='')\\\">\\n               <div class=\\\"running-app-window-count\\\" ng-click=\\\"toggleIsCollapsed(runningItem)\\\">\\n                  <div ng-if=\\\"runningItem.isCollapsed && runningItem.instances.length > 1\\\" title=\\\"{{'CLICK_EXPAND_T' | i18n}}\\\">{{runningItem.instances.length}}</div>\\n                  <div ng-if=\\\"runningItem.isCollapsed && runningItem.instances.length === 1\\\" class=\\\"icon-up-arrow-image vertical-flip\\\" title=\\\"{{'CLICK_EXPAND_T' | i18n}}\\\"></div>\\n                  <div ng-if=\\\"!runningItem.isCollapsed\\\" class=\\\"icon-up-arrow-image\\\" title=\\\"{{'CLICK_COLLAPSE_T' | i18n}}\\\"></div>\\n               </div>\\n            </li>\\n            <li ng-show=\\\"util.isDesktop(runningItem)\\\" class=\\\"icon-button icon-context-menu-image running-app-context-menu\\\" ng-click=\\\"contextMenuClicked(runningItem, $event)\\\" title=\\\"{{'OPEN_MENU_T' | i18n}}\\\" id=\\\"{{runningItem.name}}-contextMenu\\\"></li>\\n            <li ng-show=\\\"util.isApp(runningItem)\\\" class=\\\"icon-button icon-close-app-image running-app-context-menu\\\" ng-click=\\\"closeRunningApp(runningItem)\\\" title=\\\"{{'CLOSE' | i18n}}\\\"></li>\\n            <li class=\\\"running-session-rtav-containner\\\">\\n            <div id=\\\"rtav-using-microphone-icon\\\" ng-show=\\\"util.isUsingMicrophone(runningItem)\\\" class=\\\"running-session-using-rtav microphone\\\" ng-class=\\\"{'blocked': util.isAskingMicrophone(runningItem)}\\\" title=\\\"{{(util.isAskingMicrophone(runningItem) === true? 'ASKING_MICROPHONE' : 'USING_MICROPHONE') | i18n}}\\\"></div>\\n            <div id=\\\"rtav-using-webcam-icon\\\" ng-show=\\\"util.isUsingWebcam(runningItem)\\\" class=\\\"running-session-using-rtav webcam\\\" ng-class=\\\"{'blocked': util.isAskingWebcam(runningItem)}\\\" title=\\\"{{(util.isAskingWebcam(runningItem) === true? 'ASKING_WEBCAM' : 'USING_WEBCAM') | i18n}}\\\"></div>\\n            </li>\\n         </ul>\\n         <ul class=\\\"running-window-list\\\" ng-show=\\\"!runningItem.isCollapsed || (queryText && queryText.name !== '')\\\">\\n            <li ng-repeat=\\\"instance in runningItem.queryInstances | orderBy:'name'\\\" class=\\\"running-window\\\">\\n               <ul>\\n                  <ul class=\\\"icon-and-name-container\\\" ng-click=\\\"activateWindow(instance)\\\" title=\\\"{{'BRING_ITEM_TO_FRONT_T' | i18n : instance.name}}\\\">\\n                     <li ng-class=\\\"{'running-window-border': !unityWindowHasFocused(runningItem, instance), 'focused-window-border': unityWindowHasFocused(runningItem, instance)}\\\">\\n                        <img alt=\\\"{{instance.name}} icon\\\" ng-class=\\\"{'running-window-icon': !unityWindowHasFocused(runningItem, instance), 'focused-window-icon': unityWindowHasFocused(runningItem, instance), 'nonready': !util.isConnected(instance)}\\\" ng-src=\\\"{{instance.iconSrc}}\\\"/>\\n                        <div class=\\\"running-window-overlay loading\\\" ng-show=\\\"util.isConnecting(runningItem)\\\"></div>\\n                        <div class=\\\"running-window-overlay attention\\\" ng-show=\\\"util.isDisconnected(runningItem)\\\"></div>\\n                     </li>\\n                     <li ng-class=\\\"{'focused-window-name': unityWindowHasFocused(runningItem, instance), 'running-window-name': true}\\\">{{instance.name}}</li>\\n                  </ul>\\n                  <li class=\\\"icon-button icon-close-image icon-close-running-window\\\" ng-click=\\\"closeRunningInstance(instance)\\\" title=\\\"{{'CLOSE_WINDOW_T' | i18n}}\\\" ng-show=\\\"!util.isLoadingItem(runningItem)\\\"></li>\\n               </ul>\\n            </li>\\n         </ul>\\n      </div>\\n      </div>\\n      <div ng-show=\\\"showLaunchPanel\\\" class=\\\"separator\\\"></div>\\n      <div ng-show=\\\"showLaunchPanel\\\" class=\\\"available-title-panel\\\">\\n         <span class=\\\"running-title\\\">{{'AVAILABLE_T' | i18n}}</span>\\n         <div ng-if=\\\"$root.showPreference\\\" class=\\\"available-button-bar\\\">\\n            <div class=\\\"icon-button all-apps-button\\\" ng-class=\\\"{'on': !showOnlyFavorites}\\\" ng-click=\\\"disableShowOnlyFavorites()\\\" title=\\\"{{'SHOW_ALL_T' | i18n}}\\\"></div>\\n            <div class=\\\"icon-button favorite-apps-button\\\" ng-class=\\\"{'on': showOnlyFavorites}\\\" ng-click=\\\"enableShowOnlyFavorites()\\\" title=\\\"{{'SHOW_FAVORITES_T' | i18n}}\\\"></div>\\n         </div>\\n      </div>\\n      <div ng-show=\\\"showLaunchPanel\\\" class=\\\"available-content-panel\\\">\\n         <div ng-repeat =\\\"entitledItem in filteredEntitledItems = (entitledItems | availableItemsFilter:queryText.name:showOnlyFavorites)\\\">\\n            <ul class=\\\"running-app\\\" title=\\\"Launch {{entitledItem.name}}\\\">\\n               <ul class=\\\"icon-and-name-container\\\" ng-click=\\\"launchItem(entitledItem)\\\" title=\\\"{{'LAUNCH_ITEM_T' | i18n : entitledItem.name}}\\\" id=\\\"{{'available-'+entitledItem.name}}\\\">\\n                  <li class=\\\"running-app-border\\\">\\n                     <img alt=\\\"{{entitledItem.name}} icon\\\" class=\\\"running-app-icon\\\" ng-src=\\\"{{entitledItem.iconSrc}}\\\" ng-show=\\\"util.isApp(entitledItem)\\\"/>\\n                     <img alt=\\\"{{entitledItem.name}} icon\\\" class=\\\"running-app-icon\\\" src=\\\"\" + require(\"../../icons/desktop-small2x.png\") + \"\\\" ng-show=\\\"util.isDesktop(entitledItem) && !entitledItem.isShadow\\\" />\\n                     <img alt=\\\"{{entitledItem.name}} icon\\\" class=\\\"running-app-icon\\\" src=\\\"\" + require(\"../../icons/shadow-desktop-small2x.png\") + \"\\\" ng-show=\\\"util.isDesktop(entitledItem) && entitledItem.isShadow\\\" />\\n                  </li>\\n                  <li class=\\\"available-app-name\\\">{{entitledItem.name}}</li>\\n               </ul>\\n               <li ng-if=\\\"$root.showPreference && entitledItem.favorite\\\"\\n                   class=\\\"available-app-favorite-button on\\\"\\n                   title=\\\"{{'REMOVE_FAVORITE_T' | i18n : entitledItem.name}}\\\"\\n                   ng-click=\\\"toggleFavorite(entitledItem)\\\">\\n               </li>\\n               <li ng-if=\\\"$root.showPreference && !entitledItem.favorite\\\"\\n                   class=\\\"available-app-favorite-button off\\\"\\n                   title=\\\"{{'ADD_FAVORITE_T' | i18n : entitledItem.name}}\\\"\\n                   ng-click=\\\"toggleFavorite(entitledItem)\\\">\\n               </li>\\n            </ul>\\n         </div>\\n         <div ng-show=\\\"showOnlyFavorites && filteredEntitledItems.length === 0\\\">\\n            <div class=\\\"no-items-label\\\">{{'NO_FAVORITES_T' | i18n}}</div>\\n         </div>\\n      </div>\\n   </div>\\n</div>\\n<vertical-slider id=\\\"sidebar-toggler\\\"\\n                class=\\\"panel-toggle-tab pointer-cursor sidebar-tab-image\\\"\\n                on-click=\\\"$emit('togglePanel')\\\"\\n                on-move=\\\"$emit('sliderMoveStart')\\\"\\n                element-drag-styles=\\\"pointer-cursor resize-cursor\\\"\\n                body-drag-styles=\\\"resize-cursor\\\">\\n</vertical-slider>\\n\\n<div ng-show=\\\"showGlobalContextMenu\\\" class=\\\"menu global-context ng-hide\\\">\\n   <div class=\\\"bubble\\\">\\n      <div class=\\\"triangle\\\"></div>\\n      <div class=\\\"triangle-border\\\"></div>\\n      <div class=\\\"menu-content\\\">\\n         <div class=\\\"menu-item inactive\\\" title=\\\"{{userInfo}}\\\" ng-click=\\\"\\\" id=\\\"sidebar-user-info\\\">\\n            <div class=\\\"menu-item-icon icon-user-image\\\"></div>\\n            <div class=\\\"menu-item-title unselectable\\\">{{userName}}</div>\\n         </div>\\n         <div class=\\\"separator\\\"></div>\\n         <div class=\\\"menu-item\\\" ng-click=\\\"settingsClicked()\\\" id=\\\"sidebar-settings-button\\\">\\n            <div class=\\\"menu-item-icon icon-settings-image\\\"></div>\\n            <div class=\\\"menu-item-title\\\">{{'SETTINGS' | i18n}}</div>\\n         </div>\\n         <div class=\\\"menu-item\\\" ng-if=\\\"multimonOptionVisible && multimonStarted\\\" ng-click=\\\"escClicked()\\\" id=\\\"sidebar-esc-button\\\">\\n            <div class=\\\"menu-item-icon icon-esc-image\\\"></div>\\n            <div class=\\\"menu-item-title\\\">{{'ESC' | i18n}}</div>\\n         </div>\\n         <div class=\\\"menu-item\\\" ng-if=\\\"multimonOptionVisible && !multimonStarted\\\" ng-click=\\\"multimonClicked()\\\" id=\\\"sidebar-multimon-button\\\">\\n            <div class=\\\"menu-item-icon icon-multimon-image\\\"></div>\\n            <div class=\\\"menu-item-title\\\" title=\\\"{{'MULTIMON' | i18n}}\\\">{{'MULTIMON' | i18n}}</div>\\n         </div>\\n         <div class=\\\"menu-item\\\" ng-click=\\\"aboutClicked()\\\" id=\\\"sidebar-about-button\\\">\\n            <div class=\\\"menu-item-icon icon-about-image\\\"></div>\\n            <div class=\\\"menu-item-title\\\">{{'ABOUT' | i18n}}</div>\\n         </div>\\n         <div class=\\\"menu-item\\\" ng-click=\\\"logoutClicked()\\\" id=\\\"sidebar-logout-button\\\">\\n            <div class=\\\"menu-item-icon icon-logoff-desktop-image\\\"></div>\\n            <div class=\\\"menu-item-title\\\">{{'LOGOUT_T' | i18n}}</div>\\n         </div>\\n      </div>\\n   </div>\\n</div>\\n\\n<div ng-show=\\\"showItemContextMenu\\\" class=\\\"menu item-context ng-hide\\\">\\n   <div class=\\\"bubble\\\">\\n      <div class=\\\"triangle\\\"></div>\\n      <div class=\\\"triangle-border\\\"></div>\\n      <div class=\\\"menu-content\\\">\\n         <div class=\\\"menu-item\\\" ng-click=\\\"logOffDesktop()\\\" ng-show=\\\"showLogOffDesktop\\\">\\n            <div class=\\\"menu-item-icon icon-logoff-desktop-image\\\"></div>\\n            <div class=\\\"menu-item-title\\\">{{'LOGOFF_T' | i18n}}</div>\\n         </div>\\n         <div class=\\\"menu-item\\\" ng-click=\\\"resetDesktop()\\\" ng-show=\\\"showResetDesktop\\\">\\n            <div class=\\\"menu-item-icon icon-reset-image\\\"></div>\\n            <div class=\\\"menu-item-title\\\">{{'RESET_M' | i18n}}</div>\\n         </div>\\n         <div class=\\\"menu-item\\\" ng-click=\\\"restartDesktop()\\\" ng-show=\\\"showRestartDesktop\\\">\\n            <div class=\\\"menu-item-icon icon-restart-image\\\"></div>\\n            <div class=\\\"menu-item-title\\\">{{'RESTART_M' | i18n}}</div>\\n         </div>\\n         <div class=\\\"menu-item\\\" ng-click=\\\"closeRunningApp(contextMenuItem)\\\">\\n            <div class=\\\"menu-item-icon icon-close-desktop-image\\\"></div>\\n            <div class=\\\"menu-item-title\\\">{{'CLOSE' | i18n}}</div>\\n         </div>\\n      </div>\\n   </div>\\n</div>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./desktop/sidebar/sidebar_template.html\n// module id = 266\n// module chunks = 0","var path = 'launcher/common/blast-desktop.html';\nvar html = \"<div class=\\\"ui-icon-loading\\\"></div>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./launcher/common/blast-desktop.html\n// module id = 267\n// module chunks = 0","var path = 'launcher/common/header-default.html';\nvar html = \"<header ng-if=\\\"!header.hide\\\" class=\\\"navbar ui-navbar\\\" role=\\\"banner\\\" ng-controller=\\\"HeaderCtrl\\\">\\n   <div class=\\\"container\\\" >\\n      <div class=\\\"navbar-header pull-left\\\">\\n         <button type=\\\"button\\\" class=\\\"navbar-toggle\\\" data-toggle=\\\"collapse\\\" data-target=\\\".ui-navbar-links\\\" tabindex=\\\"-1\\\">\\n            <span class=\\\"sr-only\\\">Toggle navigation</span>\\n            <span class=\\\"icon-bar\\\"></span>\\n            <span class=\\\"icon-bar\\\"></span>\\n            <span class=\\\"icon-bar\\\"></span>\\n         </button>\\n         <a class=\\\"navbar-brand ui-brand\\\" tabindex=\\\"-1\\\"></a>\\n      </div>\\n      <div class=\\\"search-bar\\\" ng-class=\\\"{ searchFocus: focus, searchBlur: blur }\\\" ng-show=\\\"header.searchbar\\\">\\n         <span class=\\\"search-icon\\\"></span>\\n         <label for=\\\"header-search\\\">{{'Search' | i18n}}</label>\\n         <input id=\\\"header-search\\\" ng-model=\\\"header.search\\\" class=\\\"search-input\\\" type=\\\"search\\\" placeholder=\\\"{{'Search' | i18n}}\\\" ng-focus=\\\"focus=true;blur=false;\\\" ng-blur=\\\"blur=true;focus=false;\\\" autofocus tabindex=\\\"0\\\">\\n      </div>\\n      <div class=\\\"navbar-header pull-right ui-navbar-links\\\">\\n         <ul class=\\\"nav navbar-nav navbar-right\\\">\\n            <li ng-if=\\\"$root.showPreference\\\" class=\\\"all-choice\\\" tabindex=\\\"0\\\" ng-keyup=\\\"enterKeypress($event, showAll)\\\">\\n               <a id=\\\"showAllBtn\\\" ng-click=\\\"showAll()\\\" href=\\\"\\\" ng-class=\\\"showAllStyle\\\" title=\\\"{{'show_all' | i18n}}\\\" tabindex=\\\"-1\\\">{{'show_all' | i18n}}</a>\\n            </li>\\n            <li ng-if=\\\"$root.showPreference\\\" class=\\\"favorite-choice\\\" tabindex=\\\"0\\\" ng-keyup=\\\"enterKeypress($event, showFavorites)\\\">\\n               <a id=\\\"showFavoritesBtn\\\" ng-click=\\\"showFavorites()\\\" href=\\\"\\\" ng-class=\\\"showFavStyle\\\" title=\\\"{{'show_fav' | i18n}}\\\" tabindex=\\\"-1\\\">{{'show_fav' | i18n}}</a>\\n            </li>\\n            <li tabindex=\\\"0\\\" ng-keyup=\\\"enterKeypress($event, showSetting)\\\">\\n               <a id=\\\"settingsBtn\\\" href=\\\"\\\" class=\\\"setting\\\" title=\\\"{{'settings' | i18n}}\\\" ng-click=\\\"showSetting()\\\" tabindex=\\\"-1\\\">{{'settings' | i18n}}</a>\\n            </li>\\n            <li tabindex=\\\"0\\\" ng-keyup=\\\"enterKeypress($event, showHelp)\\\">\\n               <a id=\\\"helpBtn\\\" href=\\\"\\\" ng-click=\\\"showHelp()\\\" target=\\\"_blank\\\" title=\\\"{{'header_help_link' | i18n}}\\\" class=\\\"help\\\" tabindex=\\\"-1\\\">{{'header_help_link' | i18n}}</a>\\n            </li>\\n            <li tabindex=\\\"0\\\" ng-show=\\\"header.logout\\\" ng-keyup=\\\"enterKeypress($event, logout)\\\">\\n               <a id=\\\"logoutBtn\\\" ng-click=\\\"logout()\\\" title=\\\"{{'dialog_title_logout' | i18n}}\\\" class=\\\"logout\\\" tabindex=\\\"-1\\\">{{'dialog_title_logout' | i18n}}</a>\\n            </li>\\n         </ul>\\n      </div>\\n   </div>\\n</header>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./launcher/common/header-default.html\n// module id = 268\n// module chunks = 0","var path = 'launcher/common/home-warning.html';\nvar html = \"<div class=\\\"ui-content-area login-bg\\\">\\n   <div class=\\\"container\\\">\\n      <div class=\\\"ui-center-panel\\\">\\n         <div class=\\\"ui-pattern-logo\\\"></div>\\n            <div id=\\\"warningContainer\\\" ng-class=\\\"{'ui-browser-mobile': isMobileBrowser}\\\">\\n               <div class=\\\"ui-browser-warning ui-browser-warning-unsupport\\\">\\n                     <p class=\\\"top-warning\\\"><span class=\\\"ui-warning-logo\\\"></span>{{\\\"browser_compatibility_warn\\\" | i18n}}</p>\\n                     <p class=\\\"top-warning\\\" id=\\\"cookieWarning\\\" ng-show=\\\"showCookieWarning\\\">{{\\\"browser_compatibility_cookie\\\" | i18n}}</p>\\n               </div>\\n               <div class=\\\"portal-ui-list\\\">\\n                  <div class=\\\"portal-list-item pull-left\\\">\\n                     <a id=\\\"nativeClient\\\" ng-href=\\\"{{nativeInstallerLink}}\\\" title=\\\"\\\">\\n                        <div class=\\\"portal-native-client\\\"></div>\\n                        <div class=\\\"portal-list-title\\\">{{\\\"install_native_client\\\" | i18n}}</div>\\n                     </a>\\n                  </div>\\n                  <div class=\\\"middle-line\\\"></div>\\n                  <div class=\\\"portal-list-item pull-right\\\" ng-show=\\\"continueAllowed\\\">\\n                     <a ng-click=\\\"goNext()\\\" id=\\\"browserWarningContinue\\\">\\n                        <div class=\\\"portal-list-title\\\">{{\\\"browser_compatibility_continue\\\" | i18n}}</div>\\n                        <div class=\\\"portal-list-title\\\">{{\\\"browser_compatibility_not_recommended\\\" | i18n}}</div>\\n                     </a>\\n                  </div>\\n               </div>\\n            </div>\\n         </div>\\n      </div>\\n   </div>\\n   <div class=\\\"bottom-logo\\\"></div>\\n</div>\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./launcher/common/home-warning.html\n// module id = 269\n// module chunks = 0","var path = 'launcher/common/progress-circle.html';\nvar html = \"<span class=\\\"progress-circle\\\" ng-if=\\\"ajaxBusy && loadingAllow\\\"><img src=\\\"\" + require(\"../../icons/spinner-login2x.gif\") + \"\\\"></span>\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./launcher/common/progress-circle.html\n// module id = 270\n// module chunks = 0","var path = 'launcher/launchitems/launchitems.html';\nvar html = \"<div class=\\\"container\\\" ng-class=\\\"ajaxBusy ? 'ui-fade' : ''\\\">\\n   <ul class=\\\"ui-desktop-list\\\" ng-show=\\\"showLaunchPanel\\\">\\n      <li ng-show=\\\"show(desktop)\\\" ng-repeat=\\\"desktop in desktops | filter:{name:search} | orderBy:'name'\\\" id=\\\"{{desktop.id}}\\\" scroll-top=\\\"isHighlighted(desktop)\\\" tabindex=\\\"0\\\" ng-click=\\\"launchDesktop(desktop, $event)\\\" ng-keypress=\\\"keypressHandler($event)\\\" ng-keyup=\\\"keyboardHandler($event, desktop, true)\\\" ng-focus=\\\"highlightItems(desktop, $event)\\\" ng-blur=\\\"removeHighlight()\\\">\\n         <div class=\\\"ui-btn ui-btn-a ui-desktop-corner\\\" ng-class=\\\"{highlight:activeItem===desktop}\\\" id=\\\"launch-{{desktop.id}}\\\"  title=\\\"{{desktop.name}}\\\">\\n            <span class=\\\"ui-desktop-icon\\\">\\n               <img src=\\\"\" + require(\"../../icons/Desktop2x.png\") + \"\\\" alt=\\\"{{desktop.name}} icon\\\"class=\\\"ui-desktop-icon\\\" ng-show=\\\"{{!desktop.isShadow}}\\\">\\n               <img src=\\\"\" + require(\"../../icons/shadow-desktop2x.png\") + \"\\\" alt=\\\"desktop icon\\\" class=\\\"ui-desktop-icon\\\" ng-show=\\\"{{desktop.isShadow}}\\\">\\n               <span class=\\\"desktop-auto-start\\\" ng-show=\\\"\\\"></span>\\n            </span>\\n            <div class=\\\"ellipsis\\\">\\n               <p class=\\\"ui-desktop-name\\\" title=\\\"{{desktop.name}}\\\">{{desktop.name}}</p>\\n            </div>\\n            <div ng-if=\\\"$root.showPreference\\\" class=\\\"favorite-btn\\\">\\n               <a ng-click=\\\"makeFavorite(desktop,$event);\\\" id=\\\"favorite-{{desktop.id}}\\\" ng-class=\\\"desktop.favorite ? 'favorite-on' : 'favorite-off'\\\"  title=\\\"{{ desktop.favorite ? unfavTip : favTip}}\\\"></a>\\n            </div>\\n         </div>\\n      </li>\\n   </ul>\\n</div>\\n<div class=\\\"ui-desktop-list-line\\\" ng-show=\\\"showLaunchPanel && (desktops | filter:{name:search}).length > 0 && (applications  | filter:{name:search}).length > 0 && showline\\\"></div>\\n<div class=\\\"container\\\" ng-class=\\\"ajaxBusy ? 'ui-fade' : ''\\\">\\n   <ul class=\\\"ui-desktop-list\\\" ng-show=\\\"showLaunchPanel\\\">\\n      <li ng-show=\\\"show(application)\\\" ng-repeat=\\\"application in applications  | filter:{name:search} | orderBy:'name'\\\" id=\\\"{{application.id}}\\\" scroll-top=\\\"isHighlighted(application)\\\" tabindex=\\\"0\\\" ng-click=\\\"launchCurrentApplication(application, $event)\\\" ng-keypress=\\\"keypressHandler($event)\\\" ng-keyup=\\\"keyboardHandler($event, application, false)\\\" ng-focus=\\\"highlightItems(application, $event)\\\" ng-blur=\\\"removeHighlight()\\\">\\n          <div class=\\\"ui-btn ui-btn-a ui-desktop-corner\\\" ng-class=\\\"{highlight:activeItem===application}\\\" id=\\\"launch-{{application.id}}\\\" title=\\\"{{application.name}}\\\">\\n            <img ng-src=\\\"{{application.icon.path}}\\\" alt=\\\"{{application.name}} icon\\\" class=\\\"ui-desktop-icon ui-app-icon\\\" fallback-src=\\\"replace-icon\\\" >\\n            <div class=\\\"ellipsis\\\">\\n               <p class=\\\"ui-desktop-name\\\" title=\\\"{{application.name}}\\\">{{application.name}}</p>\\n            </div>\\n            <div ng-if=\\\"$root.showPreference\\\" class=\\\"favorite-btn\\\">\\n               <a ng-click=\\\"makeFavorite(application,$event);\\\" id=\\\"favorite-{{application.id}}\\\" ng-class=\\\"application.favorite ? 'favorite-on' : 'favorite-off'\\\" title=\\\"{{ application.favorite ? unfavTip : favTip}}\\\"></a>\\n            </div>\\n         </div>\\n      </li>\\n   </ul>\\n</div>\\n<div class=\\\"container\\\" ng-show=\\\"showNoFavorites(desktops,applications)\\\">\\n   <div class=\\\"no-favorites\\\"></div>\\n   <div class=\\\"no-favorites-word\\\">{{'noFavorites' | i18n}}</div>\\n</div>\\n<div ng-show=\\\"ajaxBusy\\\" class=\\\"ui-icon-loading\\\"></div>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./launcher/launchitems/launchitems.html\n// module id = 271\n// module chunks = 0","var path = 'launcher/login/change-password.html';\nvar html = \"<div class=\\\"ui-content-area login-bg\\\">\\n   <div class=\\\"container\\\">\\n      <div class=\\\"ui-center-panel ui-widget-home\\\">\\n         <div class=\\\"ui-pattern-logo\\\"></div>\\n         <div class=\\\"ui-panel-content\\\">\\n            <div ng-if=\\\"!error\\\" class=\\\"ui-login-hint-text\\\">{{'dialog_prompt_changepwd' | i18n}}</div>\\n            <div class=\\\"alert alert-danger\\\" ng-if=\\\"error\\\">\\n               <span class=\\\"error\\\"></span>{{error}}\\n            </div>\\n            <form id=\\\"changePasswordForm\\\" name=\\\"changePasswordForm\\\" role=\\\"form\\\" class=\\\"change-password-form form-horizontal\\\" method=\\\"post\\\" autocomplete=\\\"off\\\" novalidate>\\n               <input id=\\\"username\\\" name=\\\"username\\\" type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_username' | i18n}}\\\" ng-model=\\\"username\\\" readonly>\\n\\n               <input id=\\\"oldpassword\\\" name=\\\"oldpassword\\\" unstorable-password class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_oldpwd' | i18n}}\\\" ng-model=\\\"credential.oldpassword\\\" ng-keypress=\\\"keyPress($event, changePasswordForm)\\\" ng-trim=\\\"false\\\" view-autofocus=\\\"true\\\">\\n\\n\\n               <input id=\\\"newpassword1\\\" name=\\\"newpassword1\\\" unstorable-password class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_newpwd' | i18n}}\\\" ng-model=\\\"credential.newpassword\\\" ng-keypress=\\\"keyPress($event, changePasswordForm)\\\" equal-to=\\\"{{credential.newpasswordRepeat}}\\\" ng-trim=\\\"false\\\">\\n\\n               <div class=\\\"ui-text-left-align\\\">\\n                  <input id=\\\"newpassword2\\\" name=\\\"newpassword2\\\" unstorable-password class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_newpwd2' | i18n}}\\\" ng-model=\\\"credential.newpasswordRepeat\\\" ng-keypress=\\\"keyPress($event, changePasswordForm)\\\" equal-to=\\\"{{credential.newpassword}}\\\" ng-trim=\\\"false\\\">\\n                  <label for=\\\"newpassword2\\\" class=\\\"ui-password-dismatch-text\\\" ng-show=\\\"!changePasswordForm.$valid\\\">{{'validation_equals' | i18n}}</label>\\n               </div>\\n            </form>\\n         </div>\\n         <div class=\\\"ui-panel-footer\\\">\\n            <button id=\\\"changePasswordSubmitBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-primary\\\" ng-class=\\\"{btnPrimaryWaiting:ajaxBusy&& loadingAllow}\\\" ng-click=\\\"changePassword(changePasswordForm)\\\" ng-disabled=\\\"ajaxBusy&& loadingAllow\\\">{{ (ajaxBusy && loadingAllow) ? 'dialog_btn_signin_waiting' : 'dialog_btn_signin' | i18n}}<progress-circle></progress-circle></button>\\n            <button id=\\\"changePasswordCancelBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\">{{'dialog_quit_cancel' | i18n}}</button>\\n         </div>\\n      </div>\\n      <help-link></help-link>\\n   </div>\\n   <div class=\\\"bottom-logo\\\"></div>\\n</div>\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./launcher/login/change-password.html\n// module id = 272\n// module chunks = 0","var path = 'launcher/login/login.html';\nvar html = \"<div class=\\\"ui-content-area login-bg\\\">\\n   <div class=\\\"container\\\">\\n      <div class=\\\"ui-center-panel\\\">\\n         <div class=\\\"ui-pattern-logo\\\"></div>\\n         <div ng-controller=\\\"WaitingCtrl\\\" ng-show=\\\"showWaiting\\\" class=\\\"ui-widget-home ui-icon-loading-container\\\">\\n            <div class=\\\"ui-panel-content\\\"></div>\\n            <div class=\\\"ui-icon-loading\\\"></div>\\n         </div>\\n         <div ng-controller=\\\"DisclaimerCtrl\\\" ng-if=\\\"showDisclaimer\\\" class=\\\"ui-disclaimer-panel\\\">\\n            <div class=\\\"ui-panel-content\\\" >\\n              <pre class=\\\"ui-disclaimer-text pre-scrollable\\\" tabindex=\\\"0\\\">{{disclaimerText}}</pre>\\n            </div>\\n\\n            <div class=\\\"ui-panel-footer\\\">\\n              <button id=\\\"acceptDisclaimerBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-primary\\\" ng-class=\\\"{btnPrimaryWaiting:ajaxBusy&& loadingAllow}\\\" ng-disabled=\\\"ajaxBusy&& loadingAllow\\\" ng-click=\\\"accept()\\\" view-autofocus=\\\"true\\\">{{'dialog_wait_accept' | i18n}}<progress-circle></progress-circle></button>\\n              <button id=\\\"cancelDisclaimerBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\">{{'dialog_quit_cancel' | i18n}}</button>\\n            </div>\\n         </div>\\n         <div ng-controller=\\\"WindowsPasswordCtrl\\\" class=\\\"ui-widget-home\\\" ng-if=\\\"showWindowsPassword\\\">\\n            <div class=\\\"ui-panel-content \\\">\\n               <div class=\\\"alert alert-danger\\\">\\n                  <span class=\\\"error\\\" ng-if=\\\"error\\\"></span>{{error}}\\n               </div>\\n               <form id=\\\"loginForm\\\" name=\\\"loginForm\\\" role=\\\"form\\\" class=\\\"form-horizontal\\\" method=\\\"post\\\" autocomplete=\\\"off\\\" novalidate>\\n                  <label for=\\\"username\\\">{{'dialog_placeholder_username' | i18n}}</label>\\n                  <input id=\\\"username\\\" name=\\\"username\\\" type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_username' | i18n}}\\\" ng-model=\\\"credential.username\\\" ng-keypress=\\\"keyPress($event, loginForm)\\\" ng-change=\\\"usernameChange()\\\" ng-trim=\\\"false\\\" ng-disabled=\\\"userNameReadOnly\\\" ng-blur=\\\"updateUsername()\\\" required view-autofocus=\\\"{{!userNameReadOnly}}\\\">\\n                  <label for=\\\"password\\\">{{'dialog_placeholder_password' | i18n}}</label>\\n                  <input id=\\\"password\\\" name=\\\"password\\\" unstorable-password class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_password' | i18n}}\\\" ng-model=\\\"credential.password\\\" ng-keypress=\\\"keyPress($event, loginForm)\\\" ng-trim=\\\"false\\\" view-autofocus=\\\"{{userNameReadOnly}}\\\">\\n                  <label for=\\\"domain\\\">{{'dialog_label_domain' | i18n}}</label>\\n                  <select id=\\\"domain\\\" name=\\\"domain\\\" class=\\\"form-control form-select\\\" ng-model=\\\"credential.domain\\\" ng-keypress=\\\"keyPress($event, loginForm)\\\"  ng-disabled=\\\"domainReadOnly\\\" ng-options=\\\"domain for domain in domains\\\" domain-select-menu>\\n                  </select>\\n               </form>\\n            </div>\\n            <div class=\\\"ui-panel-footer\\\">\\n               <button id=\\\"loginButton\\\" type=\\\"submit\\\" class=\\\"btn btn-primary\\\" ng-class=\\\"{btnPrimaryWaiting:ajaxBusy && loadingAllow}\\\" ng-click=\\\"login(loginForm)\\\" ng-disabled=\\\"(ajaxBusy && loadingAllow) || !loginForm.$valid\\\">{{ (ajaxBusy && loadingAllow) ? 'dialog_btn_signin_waiting' : 'dialog_btn_signin' | i18n}}<progress-circle></progress-circle></button>\\n               <button id=\\\"cancelLoginBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\" >{{'dialog_quit_cancel' | i18n}}</button>\\n            </div>\\n         </div>\\n         <div ng-controller=\\\"SecuridPasscodeCtrl\\\" class=\\\"ui-widget-home\\\" ng-if=\\\"showSecurIDPasscode\\\">\\n            <div class=\\\"ui-panel-content securid-passcode\\\">\\n               <div ng-if=\\\"!error && (authType !== 'RADIUS')\\\" class=\\\"ui-login-hint-text\\\">\\n                  <span class=\\\"ui-icon-rsa\\\"></span>\\n                  {{'dialog_prompt_passcode' | i18n:'RSA SecurID'}}\\n               </div>\\n               <div ng-if=\\\"!error && (authType === 'RADIUS')\\\" class=\\\"ui-login-hint-text\\\">{{titleString}}</div>\\n               <div class=\\\"alert alert-danger\\\" ng-if=\\\"error\\\" >\\n                  <span class=\\\"error\\\"></span>{{error}}\\n               </div>\\n               <form id=\\\"securidPasscodeForm\\\" name=\\\"securidPasscodeForm\\\" role=\\\"form\\\" class=\\\"form-horizontal\\\" method=\\\"post\\\" autocomplete=\\\"off\\\" novalidate>\\n                  <input id=\\\"securUsername\\\" name=\\\"username\\\" type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_username' | i18n}}\\\" ng-model=\\\"credential.username\\\" ng-keypress=\\\"keyPress($event, securidPasscodeForm)\\\" ng-change=\\\"usernameChange()\\\" ng-trim=\\\"false\\\" ng-blur=\\\"updateUsername()\\\" required view-autofocus=\\\"true\\\">\\n                  <div ng-if=\\\"authType !== 'RADIUS'\\\" class=\\\"ui-input-group\\\">\\n                     <input id=\\\"passcode\\\" name=\\\"passcode\\\" unstorable-password class=\\\"form-control ui-input-group-textfield-addon\\\" placeholder=\\\"{{'dialog_placeholder_passcode' | i18n}}\\\" ng-model=\\\"credential.passcode\\\" ng-keypress=\\\"keyPress($event, securidPasscodeForm)\\\" ng-trim=\\\"false\\\" required>\\n                  </div>\\n                  <input ng-if=\\\"authType === 'RADIUS'\\\" id=\\\"passcode\\\" name=\\\"passcode\\\" unstorable-password class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_passcode' | i18n}}\\\" ng-model=\\\"credential.passcode\\\" ng-keypress=\\\"keyPress($event, securidPasscodeForm)\\\" ng-trim=\\\"false\\\">\\n               </form>\\n            </div>\\n            <div class=\\\"ui-panel-footer\\\">\\n               <button id=\\\"securLoginButton\\\" type=\\\"submit\\\" class=\\\"btn btn-primary\\\" ng-click=\\\"login(securidPasscodeForm)\\\" ng-class=\\\"{btnPrimaryWaiting:ajaxBusy&& loadingAllow}\\\" ng-disabled=\\\"(ajaxBusy&& loadingAllow) || !securidPasscodeForm.$valid\\\">{{ (ajaxBusy && loadingAllow) ? 'dialog_btn_signin_waiting' : 'dialog_btn_signin' | i18n}}<progress-circle></progress-circle></button>\\n               <button id=\\\"securCancelLoginBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\">{{'dialog_quit_cancel' | i18n}}</button>\\n            </div>\\n         </div>\\n         <div ng-controller=\\\"UnauthenticatedCtrl\\\" class=\\\"ui-widget-home\\\" ng-if=\\\"showUnauthenticated\\\">\\n            <div class=\\\"ui-panel-content \\\">\\n               <div class=\\\"alert alert-danger\\\">\\n                  <span class=\\\"error\\\" ng-if=\\\"error\\\"></span>{{error}}\\n               </div>\\n               <form id=\\\"unauthenticatedForm\\\" name=\\\"unauthenticatedForm\\\" role=\\\"form\\\" class=\\\"form-horizontal\\\" method=\\\"post\\\" autocomplete=\\\"off\\\" novalidate>\\n                  <select id=\\\"unauthenticatedUsername\\\" name=\\\"unauthenticatedUsername\\\" class=\\\"form-control form-select\\\" ng-model=\\\"credential.username\\\" ng-keypress=\\\"keyPress($event, unauthenticatedForm)\\\" ng-options=\\\"username.displayName for username in usernames track by username.value\\\" view-autofocus=\\\"true\\\" anonymous-select>\\n                  </select>\\n               </form>\\n            </div>\\n            <div class=\\\"ui-panel-footer\\\">\\n               <button id=\\\"unauthenticatedLoginButton\\\" type=\\\"submit\\\" class=\\\"btn btn-primary\\\" ng-class=\\\"{btnPrimaryWaiting:ajaxBusy && loadingAllow}\\\" ng-click=\\\"login(unauthenticatedForm)\\\" ng-disabled=\\\"(ajaxBusy && loadingAllow) || !unauthenticatedForm.$valid\\\">{{ (ajaxBusy && loadingAllow) ? 'dialog_btn_signin_waiting' : 'dialog_btn_signin' | i18n}}<progress-circle></progress-circle></button>\\n               <button id=\\\"unauthenticatedCancelLoginBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\" >{{'dialog_quit_cancel' | i18n}}</button>\\n            </div>\\n         </div>\\n      </div>\\n      <help-link></help-link>\\n      <download-link></download-link>\\n   </div>\\n   <div class=\\\"bottom-logo\\\"></div>\\n</div>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./launcher/login/login.html\n// module id = 273\n// module chunks = 0","var path = 'launcher/login/securid-nexttokencode.html';\nvar html = \"<div class=\\\"ui-content-area login-bg\\\">\\n   <div class=\\\"container\\\">\\n      <div class=\\\"ui-center-panel ui-widget-home\\\">\\n         <div class=\\\"ui-pattern-logo\\\"></div>\\n         <div class=\\\"ui-panel-content next-token\\\">\\n            <div class=\\\"ui-login-hint-text ui-multi-line-margin ui-multi-line ui-text-left-align selectable\\\">{{challengeString}}</div>\\n            <form id=\\\"securidNextTokenForm\\\" name=\\\"securidNextTokenForm\\\" role=\\\"form\\\" class=\\\"form-horizontal\\\" method=\\\"post\\\" autocomplete=\\\"off\\\" novalidate>\\n               <input id=\\\"passcode\\\" name=\\\"passcode\\\" unstorable-password class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_nexttoken' | i18n}}\\\" ng-model=\\\"credential.passcode\\\" ng-keypress=\\\"keyPress($event, securidNextTokenForm)\\\" ng-trim=\\\"false\\\" required view-autofocus=\\\"true\\\">\\n            </form>\\n         </div>\\n         <div class=\\\"ui-panel-footer\\\">\\n            <button id=\\\"loginButton\\\" type=\\\"submit\\\" class=\\\"btn btn-primary\\\" ng-class=\\\"{btnPrimaryWaiting:ajaxBusy&& loadingAllow}\\\" ng-click=\\\"login(securidNextTokenForm)\\\" ng-disabled=\\\"(ajaxBusy&& loadingAllow)||!securidNextTokenForm.$valid\\\">{{'dialog_wait_continue' | i18n}}<progress-circle></progress-circle></button>\\n            <button id=\\\"cancelLoginBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\">{{'dialog_quit_cancel' | i18n}}</button>\\n         </div>\\n      </div>\\n      <help-link></help-link>\\n   </div>\\n   <div class=\\\"bottom-logo\\\"></div>\\n</div>\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./launcher/login/securid-nexttokencode.html\n// module id = 274\n// module chunks = 0","var path = 'launcher/login/securid-pinchange.html';\nvar html = \"<div class=\\\"ui-content-area login-bg\\\">\\n   <div class=\\\"container\\\">\\n      <div class=\\\"ui-center-panel ui-widget-home\\\">\\n         <div class=\\\"ui-pattern-logo\\\"></div>\\n         <div class=\\\"ui-panel-content\\\">\\n            <div class=\\\"alert alert-danger\\\" >\\n               <span class=\\\"error\\\" ng-if=\\\"error\\\"></span>{{error}}\\n            </div>\\n            <h3 class=\\\"ui-multi-line ui-text-left-align\\\" ng-if=\\\"!!prompt\\\"><small>{{prompt}}</small></h3>\\n            <form id=\\\"securidPinChangeForm\\\" name=\\\"securidPinChangeForm\\\" role=\\\"form\\\" class=\\\"form-horizontal\\\" method=\\\"post\\\" autocomplete=\\\"off\\\" novalidate>\\n               <input id=\\\"pin1\\\" name=\\\"pin1\\\" type=\\\"{{pin1Type}}\\\" class=\\\"form-control\\\" placeholder=\\\"{{'dialog_placeholder_pin1' | i18n}}\\\" ng-model=\\\"pin1\\\" ng-readonly=\\\"pin1ReadOnly\\\" ng-trim=\\\"false\\\" required view-autofocus=\\\"{{!pin1ReadOnly}}\\\">\\n               <div class=\\\"ui-text-left-align\\\">\\n                  <input id=\\\"pin2\\\" name=\\\"pin2\\\" unstorable-password class=\\\"form-control bottom-input\\\" placeholder=\\\"{{'dialog_placeholder_pin2' | i18n}}\\\" ng-model=\\\"pin2\\\" ng-keypress=\\\"keyPress($event, securidPinChangeForm)\\\" equal-to=\\\"{{pin1}}\\\" ng-trim=\\\"false\\\" view-autofocus=\\\"{{pin1ReadOnly}}\\\">\\n                  <label for=\\\"pin2\\\" class=\\\"ui-password-dismatch-text\\\" ng-show=\\\"securidPinChangeForm.pin2.$invalid\\\">{{'validation_equals' | i18n}}</label>\\n               </div>\\n            </form>\\n         </div>\\n         <div class=\\\"ui-panel-footer\\\">\\n            <button id=\\\"loginButton\\\" type=\\\"submit\\\" class=\\\"btn btn-primary\\\" ng-class=\\\"{btnPrimaryWaiting:ajaxBusy && loadingAllow}\\\" ng-click=\\\"login(securidPinChangeForm)\\\" ng-disabled=\\\"(ajaxBusy && loadingAllow) || !securidPinChangeForm.$valid\\\">{{ (ajaxBusy && loadingAllow) ? 'dialog_btn_signin_waiting' : 'dialog_btn_signin' | i18n}}<progress-circle></progress-circle></button>\\n            <button id=\\\"cancelLoginBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\">{{'dialog_quit_cancel' | i18n}}</button>\\n         </div>\\n      </div>\\n      <help-link></help-link>\\n   </div>\\n   <div class=\\\"bottom-logo\\\"></div>\\n</div>\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./launcher/login/securid-pinchange.html\n// module id = 275\n// module chunks = 0","var path = 'launcher/login/securid-wait.html';\nvar html = \"<div class=\\\"ui-content-area login-bg\\\">\\n   <div class=\\\"container\\\">\\n      <div class=\\\"ui-center-panel ui-widget-home\\\">\\n         <div class=\\\"ui-pattern-logo\\\"></div>\\n         <div class=\\\"ui-panel-content ui-text-left-align panel-text\\\">\\n            <h3 class=\\\"ui-rsa-title\\\"><small>{{'dialog_wait_help1' | i18n}}</small></h3>\\n            <h3><small>{{'dialog_wait_help2' | i18n}}</small></h3>\\n         </div>\\n         <div class=\\\"ui-panel-footer\\\">\\n            <button id=\\\"loginButton\\\" type=\\\"submit\\\" class=\\\"btn btn-primary\\\" ng-class=\\\"{btnPrimaryWaiting:ajaxBusy&& loadingAllow}\\\" ng-click=\\\"login()\\\" ng-disabled=\\\"disabled\\\">{{'dialog_wait_continue' | i18n}}<progress-circle></progress-circle></button>\\n            <button id=\\\"cancelLoginBtn\\\" type=\\\"submit\\\" class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\">{{'dialog_quit_cancel' | i18n}}</button>\\n         </div>\\n      </div>\\n      <help-link></help-link>\\n   </div>\\n   <div class=\\\"bottom-logo\\\"></div>\\n</div>\\n\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./launcher/login/securid-wait.html\n// module id = 276\n// module chunks = 0","var path = 'launcher/setting-dialog/setting-dialog-launcher.html';\nvar html = \"<scrollable-dialog>\\n   <div class=\\\"dialog-title\\\">{{'SETTINGS' | i18n}}</div>\\n\\n   <div class=\\\"dialog-content\\\" fuzzy>\\n      <div ng-repeat=\\\"switch in toggleSwitches\\\" ng-if='switch.isSupported'>\\n         <div class=\\\"settings-container clearfix\\\" >\\n            <div class=\\\"settings-toggle-container\\\">\\n               <div class=\\\"settings-switch-label\\\">{{'OFF_CAPS_M' | i18n}}</div>\\n               <div class=\\\"toggle-opt\\\" tabindex=\\\"0\\\" ng-keyup=\\\"onKeypress($event)\\\">\\n                  <input class=\\\"tgl tgl-light\\\" id=\\\"{{switch.id}}\\\" type=\\\"checkbox\\\" ng-show=\\\"false\\\" ng-model=\\\"switch.isEnabled\\\" ng-change=\\\"switch.toggle()\\\">\\n                  <label class=\\\"tgl-btn unselectable\\\" for=\\\"{{switch.id}}\\\"></label>\\n               </div>\\n               <div class=\\\"settings-switch-label\\\">{{'ON_CAPS_M' | i18n}}</div>\\n            </div>\\n            <span class=\\\"settings-label\\\">{{switch.label}}</span>\\n            <span class=\\\"settings-text\\\" ng-show=\\\"{{!!switch.text}}\\\">{{switch.text}}</span>\\n            <div ng-if=\\\"switch.id==='timezone'\\\" id=\\\"setTimezone\\\" class=\\\"clearfix\\\">\\n               <div id=\\\"timezone-list-container\\\">\\n                  <timezone-list></timezone-list>\\n               </div>\\n            </div>\\n         </div>\\n         <div class=\\\"settings-separator\\\" ng-show='switch.isSupported'></div>\\n      </div>\\n\\n      <div class=\\\"settings-container\\\">\\n         <button class=\\\"modal-button-base modal-button-blue modal-button-reset\\\" ng-class=\\\"{disable:applicationCanSet===false}\\\" ng-click=\\\"showResetConfirmDialog()\\\" title=\\\"{{'RESET_APPS_T' | i18n}}\\\">{{'RESET_M' | i18n}}</button>\\n         <span class=\\\"settings-label\\\">{{'RESET_APPS_M' | i18n}}</span>\\n         <span class=\\\"settings-text warning\\\">{{'UNSAVED_WORK_M' | i18n}}</span>\\n      </div>\\n   </div>\\n\\n   <div class=\\\"dialog-button-row\\\">\\n      <button id=\\\"closeSettingsBtn\\\" class=\\\"modal-button-base modal-button-right modal-button-blue\\\" ng-click=\\\"closeThisDialog()\\\" dialog-prevent-key-up>\\n         {{'CLOSE' | i18n}}\\n      </button>\\n   </div>\\n</scrollable-dialog>\";\nwindow.angular.module('com.vmware.vdi.htmlaccess.template').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./launcher/setting-dialog/setting-dialog-launcher.html\n// module id = 277\n// module chunks = 0"],"sourceRoot":""}